<%@LANGUAGE = VBScript%>
<%Option Explicit%>
<%
'**********************************************************************************************
'*  1. Module Name			: Production
'*  2. Function Name		: 
'*  3. Program ID			: p4211mb2.asp
'*  4. Program Name			: List Component Requirement (Reservation) (Query)
'*  5. Program Desc			: Used By Goods Issue For Production Order
'*  6. Comproxy List		: DB AGENT							  
'*  7. Modified date(First)	: 2000/03/28
'*  8. Modified date(Last)	: 2002/08/21
'*  9. Modifier (First)		: Park, BumSoo
'* 10. Modifier (Last)		: Chen, Jae Hyun
'* 11. Comment				:
'**********************************************************************************************
%>
<!-- #Include file="../../inc/IncSvrMain.asp" -->
<!-- #Include file="../../inc/IncSvrDate.inc" -->
<!-- #Include file="../../inc/IncSvrNumber.inc" -->
<!-- #Include file="../../inc/IncSvrDBAgent.inc" -->
<!-- #Include file="../../inc/IncSvrDBAgentVariables.inc" -->
<!-- #Include file="../../ComAsp/LoadInfTB19029.asp" -->
<%													'☜ : 여기서 부터 개발자 비지니스 로직을 처리하는 내용이 시작된다 
Call LoadBasisGlobalInf
Call loadInfTB19029B("I", "*", "NOCOOKIE","MB")

Dim ADF														'ActiveX Data Factory 지정 변수선언 
Dim strRetMsg												'Record Set Return Message 변수선언 
Dim UNISqlId, UNIValue, UNILock, UNIFlag, rs0				'DBAgent Parameter 선언 

'=======================================================================================================
'	아래 선언되어 있는 변수들은 COOL:Gen 의 Record Return Count 의 제한에 따른 것이다.
'	따라서, ADO를 사용할 경우 그와같은 문제성이 없기 때문에 아래의 변수들은 사용하지 않지만 추후 
'	uniERP2000 에서 한번에 조회되는 Record Count 의 수를 30으로 제한하고 있는 만큼 그에 따른 
'	표준은 동시에 추가될 예정이므로 변수삭제는 하지 않고 그대로 놔둔다.
'=======================================================================================================
Dim i

Call HideStatusWnd

On Error Resume Next

	'=======================================================================================================
	'	만약, 선언한 변수가 배열이라면 아래와같은 Fix 된 배열로 Redim 을 해서 넘겨줘야 한다.
	'=======================================================================================================
	Redim UNISqlId(0)
	Redim UNIValue(0, 2)

	UNISqlId(0) = "p4211mb2"

	UNIValue(0, 0) = "^"
	UNIValue(0, 1) = FilterVar(UCase(Request("txtProdtOrderNo")), "''", "S")
	UNIValue(0, 2) = FilterVar(UCase(Request("txtOprNo")), "''", "S")
	
	UNILock = DISCONNREAD :	UNIFlag = "1"
	
    Set ADF = Server.CreateObject("prjPublic.cCtlTake")
    strRetMsg = ADF.QryRs(gDsnNo, UNISqlId, UNIValue, UNILock, UNIFlag, rs0)

	If rs0.EOF And rs0.BOF Then
		Call DisplayMsgBox("900014", vbInformation, "", "", I_MKSCRIPT)	'⊙: DB 에러코드, 메세지타입, %처리, 스크립트유형 
		rs0.Close
		Set rs0 = Nothing				
		%>
		<Script Language=vbscript>
		    LngMaxRow = 0
			Parent.DbDtlQueryNotOk(LngMaxRow)
		</Script>
		<%
		Response.End													'☜: 비지니스 로직 처리를 종료함 
	End If
%>

<Script Language=vbscript>
Dim LngMaxRow
Dim LngMaxRows
Dim strData, strData1
Dim TmpBuffer, TmpBuffer1
Dim iTotalStr, iTotalStr1
    	
With parent																	'☜: 화면 처리 ASP 를 지칭함 
	LngMaxRow = .frm1.vspdData2.MaxRows										'Save previous Maxrow
	LngMaxRows = .frm1.vspdData3.MaxRows
	ReDim TmpBuffer(<%=rs0.RecordCount-1 %>)
	ReDim TmpBuffer1(<%=rs0.RecordCount-1 %>)
<%  
    For i=0 to rs0.RecordCount-1 
%>
		strData = ""
		strData = strData & Chr(11) & Trim("<%=ConvSPChars(rs0("Item_Cd"))%>")								'☆: Item Code
		strData = strData & Chr(11) & ""																	'☆: Item Code Popup	
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Item_Nm"))%>"									'☆: Item Name
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("spec"))%>"										'☆: Spec
		strData = strData & Chr(11) & "<%=UniConvNumberDBToCompany(rs0("Req_Qty"), ggQty.DecPoint, ggQty.RndPolicy, ggQty.RndUnit, 0)%>"			'☆: Required Quantity
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Base_Unit"))%>"									'☆: Base Unit
		strData = strData & Chr(11) & "<%=UniConvNumberDBToCompany(rs0("Issued_Qty"), ggQty.DecPoint, ggQty.RndPolicy, ggQty.RndUnit, 0)%>"			'☆: Required Quantity
		strData = strData & Chr(11) & "<%=UNIDateClientFormat(rs0("Req_Dt"))%>"								'☆: Required Date	
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Tracking_No"))%>"								'☆: Tracking No.
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Sl_Cd"))%>"										'☆: Storage Location Code
		strData = strData & Chr(11) & ""																	'☆: Storage Location Popup
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Sl_Nm"))%>"										'☆: Storage Location Name
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Resv_Status"))%>"								'☆: Reseve Status
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Resv_Desc"))%>"									'☆: Reseve Status
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Issue_Mthd"))%>"									'☆: Issue Method
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Issue_Mthd_Desc"))%>"							'☆: Issue Method
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Req_No"))%>"										'☆: Required No.
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Seq"))%>"										'☆: Sequence
		strData = strData & Chr(11) & "<%=ConvSPChars(Request("txtPlantCd"))%>"								'☆: Plant Code
		strData = strData & Chr(11) & Trim("<%=ConvSPChars(rs0("Prodt_Order_No"))%>")						'☆: Production Order No.
		strData = strData & Chr(11) & "<%=ConvSPChars(rs0("Wc_Cd"))%>"										'☆: Work Center
		strData = strData & Chr(11) & Trim("<%=ConvSPChars(rs0("Opr_No"))%>")								'☆: Operation No.	
		strData = strData & Chr(11) & Trim("<%=ConvSPChars(rs0("Item_Cd"))%>")								'☆: Item Code
		strData = strData & Chr(11) & Trim("<%=ConvSPChars(rs0("Order_Status"))%>")							'☆: Item Code
		strData = strData & Chr(11) & LngMaxRow + <%=i%>
		strData = strData & Chr(11) & Chr(12)
		
		TmpBuffer(<%=i%>) = strData

		' Insert Into Hidden Grid
		strData1 = ""
		strData1 = strData1 & Chr(11) & Trim("<%=ConvSPChars(rs0("Item_Cd"))%>")								'☆: Item Code
		strData1 = strData1 & Chr(11) & ""																		'☆: Item Code Popup	
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Item_Nm"))%>"										'☆: Item Name
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("spec"))%>"											'☆: Spec
		strData1 = strData1 & Chr(11) & "<%=UniConvNumberDBToCompany(rs0("Req_Qty"), ggQty.DecPoint, ggQty.RndPolicy, ggQty.RndUnit, 0)%>"			'☆: Required Quantity
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Base_Unit"))%>"									'☆: Base Unit
		strData1 = strData1 & Chr(11) & "<%=UniConvNumberDBToCompany(rs0("Issued_Qty"), ggQty.DecPoint, ggQty.RndPolicy, ggQty.RndUnit, 0)%>"			'☆: Required Quantity
		strData1 = strData1 & Chr(11) & "<%=UNIDateClientFormat(rs0("Req_Dt"))%>"								'☆: Required Date	
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Tracking_No"))%>"									'☆: Tracking No.
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Sl_Cd"))%>"										'☆: Storage Location Code
		strData1 = strData1 & Chr(11) & ""																		'☆: Storage Location Popup
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Sl_Nm"))%>"										'☆: Storage Location Name
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Resv_Status"))%>"									'☆: Reserve Status
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Resv_Desc"))%>"									'☆: Reserve Status
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Issue_Mthd"))%>"									'☆: Issue Method
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Issue_Mthd_Desc"))%>"									'☆: Issue Method
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Req_No"))%>"										'☆: Required No.
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Seq"))%>"											'☆: Sequence
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(Request("txtPlantCd"))%>"								'☆: Plant Code
		strData1 = strData1 & Chr(11) & Trim("<%=ConvSPChars(rs0("Prodt_Order_No"))%>")							'☆: Production Order No.
		strData1 = strData1 & Chr(11) & "<%=ConvSPChars(rs0("Wc_Cd"))%>"										'☆: Work Center
		strData1 = strData1 & Chr(11) & Trim("<%=ConvSPChars(rs0("Opr_No"))%>")									'☆: Operation No.	
		strData1 = strData1 & Chr(11) & Trim("<%=ConvSPChars(rs0("Item_Cd"))%>")								'☆: Item Code
		strData1 = strData1 & Chr(11) & Trim("<%=ConvSPChars(rs0("Order_Status"))%>")							'☆: Item Code
		strData1 = strData1 & Chr(11) & LngMaxRows + <%=i%>
		strData1 = strData1 & Chr(11) & Chr(12)
		
		TmpBuffer1(<%=i%>) = strData1
<%		
		rs0.MoveNext
	Next
%>
		iTotalStr = Join(TmpBuffer, "")
		.ggoSpread.Source = .frm1.vspdData2
		.ggoSpread.SSShowDataByClip iTotalStr
		
		iTotalStr1 = Join(TmpBuffer1, "")
		.ggoSpread.Source = .frm1.vspdData3
		.ggoSpread.SSShowDataByClip iTotalStr1
		
		.frm1.hProdOrderNo.value= "<%=ConvSPChars(Request("txtProdtOrderNo"))%>"
		
<%			
		rs0.Close
		Set rs0 = Nothing
%>
	.DbDtlQueryOk(LngMaxRow+1)
End With	
</Script>	
<%
Set ADF = Nothing												'☜: ActiveX Data Factory Object Nothing
%>
