//
//	  Copyright (C) 2003-2014 GrapeCity Inc.	All rights reserved.
//

if(typeof GrapeCity=="undefined")GrapeCity={};if(!GrapeCity.Web)GrapeCity.Web={};if(!GrapeCity.Web.Spread)GrapeCity.Web.Spread={};GrapeCity.Web.Spread.FpSpread=function(domElement,options){if(!domElement)return;var element=$$(domElement).element;element.__gcfocus=element.focus;if(!element.document)element.document=document;element.Behavior=this;var SelectionBlockOptions=new function(){this.None=0;this.Cells=1;this.Rows=2;this.Columns=4;this.Sheet=8},fpSpreadJS=null,mvc,spreadView=null,virtualScrollPagingFormatString,needScrollToTopRow,SPLController,rowHeaders=1,colHeaders=1,working=false,editing=false,editor=null,lastEditingInfo=null,editingValue=null,editingFormula=null,editorMargin=new Margin(-1,-1,-1,-1),editorSelectedIndex=-1,sizeColumn=null,sizeRow=null,activeX=-1,activeY=-1,activeElement=null,anchorCell=null,oldAnchorCell=null,leadingCell=null,leadingCellRow=null,leadingCellCol=null,selectStartRow=null,selectStartCol=null,selectedBackColor="#aabbff",anchorBackColor="#bbccff",useDefaultSelectionBackColor=false,xmlData=null,spanCells=[],rowSpanCells=[],colSpanCells=[],topTable=null,tableView=null,viewport=null,rowHeader=null,colHeader=null,commandBar=null,viewport0=null,viewport1=null,viewport2=null,scrollvp=null,vpholder_setSizeCallback=null,corner=null,frozColHeader=null,frozColFooter=null,footerCorner=null,colFooter=null,frozRowHeader=null,editorList=[],validatorList=[],validationMsg=null,dirty=false,initialized=false,operationMode="Normal",textBox=null,sizeBar=null,xhtml=false,frzRows=0,frzCols=0,rowCount=0,ignoreBlur=false,ignoreChange=false,dataBuff=null,selectType="",selectionUnit="Cell",scrollLeft=0,scrollTop=0,retainSelectionBlock=true,editModePermanent=false,enableRowEditTemplate="false",hiddenColumns=[],selectedCols=[],vp2List=null,vpList=null,rhList=null,current=-1,currentCount=-1,newTop=0,newPageCount=0,smartPaint=false,uiVirtualization=false,bSuspendLayout=false,left=37,right=39,up=38,down=40,tab=9,enter=13,shift=16,space=32,altkey=18,home=36,end=35,pup=33,pdn=34,backspace=8,hierBar=null,pager1=null,pager2=null,dummy=null,vpholder=null,groupBar=null,movingCol=null,dragCol=-1,dragViewCol=-1,dragSlideBar=null,allowColMove=null,allowGroup=null,activePager=null,error=false,cb_btn=null,msgStyle=null,ignoreSynRowHeight=false,ignorePostbackEditmode=false,ignoreEditorFocus=false,ignorePaintSelection=false,ignoreElementActive=false,ignoreFireSelectionChanged=false,isEndingEdit=false,engine=null,attachedScrollEvents=false,isJustClickOnGrayArea=false,isPressTABKeyFromOutSide=false,needCheckSelectText=false,elementWheelListener=null,vpHolderWheelListener=null,selectionBlockOptions=SelectionBlockOptions.Cells|SelectionBlockOptions.Rows|SelectionBlockOptions.Columns|SelectionBlockOptions.Sheet,msgList=null,isMouseMoving=null,mouseX=null,mouseY=null,copymultiCol,activeChartObj,displayingVirtualScrollingContent=null,forcePaintAnchorCell=false,ignorePropertyChanged=false,currentPageIndex=null,lastPageIndex=null,clipboardLock=-1,_delayFocus=false,$element,rootSpread=null,_keepCurrentScrollValue=-1,lastTextBoxPosition=null,displayObserver,DEFAULT_TEMP_BORDER="#d0d7e5",grayareacursor=null;function propertyChanged(){try{if(getTopSpread(element).resizing)return;!ignorePropertyChanged&&event.propertyName=="style.display"&&element.style.display!="none"&&initLayout()}catch(a){$$.DEBUG.Log(a,"propertyChange")}}function getAttributeInternal(a){return element.getAttribute(a)}function dispose(){spreadView.EventHandlers.DetachAll();var f=FpSpreadJS.getChildViews(element);if(f)for(var d=0;d<f.length;d++)f[d].Behavior.dispose();spreadView.__previousSelectionNode=null;displayObserver!=null&&displayObserver.disconnect();spreadView.EventTracker.Clear();detachScrollEvents();var g=[getParent(getFrozColHeader()),getParent(getFrozColFooter()),getParent(getFrozRowHeader()),getParent(viewport0),getViewportHolder(),element];$$.utils.cleanArray(g);for(var d=0;d<g.length;d++){var k=g[d];$$.j(k).off("scroll",noScroll)}$$.browser.chrome&&anchorCell&&RadioButtonListCellType_detachEvent(anchorCell);var i=element.document||window.document,j=getParentSpread(),a=$$.utils;a.detachEvent(element,"Scroll");a.detachEvent(element,"ActiveCellChanging");a.detachEvent(element,"ActiveCellChanged");a.detachEvent(element,"DataChanged");a.detachEvent(element,"SelectionChanged");a.detachEvent(element,"EditStart");a.detachEvent(element,"EditStopped");a.detachEvent(element,"CallBackStart");a.detachEvent(element,"CallBackStopped");a.detachEvent(element,"ColumnDragMove");a.detachEvent(element,"ColumnDragMoveCompleted");a.detachEvent(element,"ErrorMessageShown");a.detachEvent(element,"AutoFilteringColumn");a.detachEvent(element,"AutoFilteredColumn");a.detachEvent(element,"ColWidthChanged");a.detachEvent(element,"RowHeightChanged");a.detachEvent(element,"CopyData");a.detachEvent(element,"LoadRowsStart");a.detachEvent(element,"LoadRowsStopped");a.detachEvent(element,"TouchStripOpening");a.detachEvent(element,"TouchStripOpened");a.detachEvent(element,"TouchStripClosed");a.detachEvent(element,"MenuItemClicked");a.detachEvent(element,"ContextMenuClosed");a.detachEvent(element,"ContextMenuOpening");a.detachEvent(element,"ContextMenuOpened");var b=$$.j(i);b.off("keyup",keyup);b.off("keydown",translateKey);b.off("keypress",keypress);b.off("mousedown",setActiveSpread);if(spreadView.UseWorkArroundClipboard()){b.off("paste",documentOnPaste);b.off("copy",documentOnCopy);b.off("cut",documentOnCopy)}$element.off("documentready",init);$element.off("mousedown",mouseDown);$element.off("mouseup",mouseUp);$element.off("mouseout",mouseOut);$element.off("mousemove",mouseMove);$element.off("dblclick",dblclick);$element.off("resize",processResize);$element.off("propertychange",propertyChanged);$$.j(window).off("resize",processResize);$$.utils.detachEvent(element,elementWheelListener.eventName,elementWheelListener.eventHandler,true);vpholder&&$$.utils.detachEvent(vpholder,vpHolderWheelListener.eventName,vpHolderWheelListener.eventHandler,true);j==null&&window.document.removeEventListener("mouseup",documentMouseUp,true);stopHandlingDocumentMouse();var l=getTopSpread(element),e=window.document.getElementById(l.id+"_textBox"),c=e!=null?$$.j(e):null;if($$.browser.ie){if(e!=null)e.onactivate=null;element.onactivate=null}else{$element.off("focusin",elementOnFocus);$element.off("focusout",elementOnFocusOut)}if(c){c.off("compositionstart",onTextBoxCompositionStart);c.off("compositionupdate",onTextBoxCompositionUpdate);c.off("keydown",onTextBoxKeyDown);c.off("keyup",onTextBoxKeyUp);c.off("blur",onTextBoxBlur)}var h=window.document.getElementById(element.id+"_scrollvp");h!=null&&$$.j(h).off("resize",processResize);chartDispose();$element.removeData()}function syncBehavior(e){var d=e.style.behavior,a=GetChildSpreads(e.id);if(a!=null&&a.length>0)for(var c=0,f=a.length;c<f;c++){var b=a[c];if(b.style.behavior!=d){b.style.behavior=d;syncBehavior(b)}}}var _ignoreVirtualPagingCount=0,ignoreVirtualPagingPropertySettings={"get":function(){return _ignoreVirtualPagingCount>0},"set":function(a){if(a)_ignoreVirtualPagingCount++;else if(_ignoreVirtualPagingCount>0)_ignoreVirtualPagingCount--}};function getCorner(){return corner}function getColHeader(){return colHeader}function getFrozColHeader(){return frozColHeader}function getColFooter(){return colFooter}function getFrozColFooter(){return frozColFooter}function getFooterCorner(){return footerCorner}function getRowHeader(){return rowHeader}function getFrozRowHeader(){return frozRowHeader}function getViewport(){return viewport}function getViewport0(){return viewport0}function getViewport1(){return viewport1}function getViewport2(){return viewport2}function getScrollvp(){return scrollvp}function getCommandBar(){return commandBar}function msAjaxEnabled(){return typeof Sys!="undefined"&&Sys.Application!=null}function init(e,r){if($$.browser.ie&&$$.browser.version!=$$.browser.ieversion&&!$$.browser.quirksMode)return;if(typeof mvcSpread=="undefined"||typeof GrapeCity=="undefined"||GrapeCity.Web==null||GrapeCity.Web.Spread==null||GrapeCity.Web.Spread.SpreadView==null){setTimeout(function(){init(e)},10);return}if(msAjaxEnabled()&&Sys.Application.add_load&&getParentSpread()==null){element._pageLoadCallback=monitorDisplay;Sys.Application.add_load(element._pageLoadCallback)}if(!$$.JQueryBootstrap(Function.CreateDelegate(this,function(){this.init(e)})))return;initialized=false;element.initialized=false;element.initLayoutCompleted=false;initFields();initElementBehavior();var a=element.document||window.document,D=$$.j(a),o=$$.utils;fpSpreadJS=new FpSpreadJS(element,getSpreadContext(),fpSpreadJS);element.fpSpreadJS=fpSpreadJS;var m=e=="LoadOnDemand";if(spreadView==null||!m||error||spreadView.LoadOnDemandMode!="Background"&&spreadView.GetPendingRequestLength()==0){var A=m?spreadView.FilterEditors:null;spreadView&&spreadView.HideFloatingElements();spreadView=new GrapeCity.Web.Spread.SpreadView(element);spreadView.SyncData=syncData;m&&spreadView.SetFilterEditors(A)}var i=GetChildSpreads();if(i!=null){for(var c=0;c<i.length;c++)if(window.$DEBUG)var G=new GrapeCity.Web.Spread.FpSpread(i[c]);else try{var G=new GrapeCity.Web.Spread.FpSpread(i[c])}catch(F){}spreadView.LoadChildSpreadViews()}mvc=new mvcSpread(element);if(element.parentNode==null)return;var w=$$.browser;w.ieversion>=9&&syncBehavior(element);if(a.FpActiveSheetView!=null)a.FpActiveSheetView=a.getElementById(a.FpActiveSheetView.id);element.ignoreVirtualPaging=true;var H=window.navigator.userAgent,w=$$.browser,E=w.ie;getIEMode();if(xmlData==null||!xmlData.belongToElement(element)){xmlData=$$.fn.createXMLDOMWrapper(element);element.getXmlDataObject=function(){return xmlData}}this.xmlData=xmlData;var n=window.document.getElementById(element.id+"_data");if(n!=null){var x=n.getAttribute("data");if(x!=null){xmlData.loadXML(x);n.value=""}}saveData();if(scrollvp!=null)$$.j(scrollvp).on("resize",processResize);else if(uiVirtualization){scrollvp=a.createElement("div");scrollvp.id=element.id+"_scrollvp";scrollvp.style.position="relative";scrollvp.style.display="none";scrollvp.style.overflowX=tableView.style.overflowX;scrollvp.style.overflowY=tableView.style.overflowY;tableView.style.overflowX="hidden";tableView.style.overflowY="hidden";tableView.parentNode.insertBefore(scrollvp,tableView);dummy=a.createElement("div");dummy.id=element.id+"_dummy";dummy.style.width="100%";dummy.style.height="100%";scrollvp.insertBefore(dummy,null);vpholder=a.createElement("div");vpholder.id=element.id+"_vpholder";vpholder.style.position="relative";tableView.parentNode.insertBefore(vpholder,tableView);var f=a.createElement("table");f.cellspacing="0";f.cellpadding="0";f.border="0";f.style.borderWidth="0px";f.style.borderCollapse="collapse";vpholder.insertBefore(f,null);var C=f.insertRow(),l=C.insertCell();l.align="left";l.valign="top";l.style.padding="0px";l.insertBefore(tableView,null);FpSpreadJS._applyScrollbarAppearances(tableView,scrollvp)}hiddenColumns=fpSpreadJS.initHiddenColumns(element);if(element.getAttribute("virtualPaging")=="true"){var t=a.getElementById(element.id+"_VirtualPaging_Top");if(t==null)element.virtualPagingTop=element.virtualTop=0;else element.virtualPagingTop=element.virtualTop=parseInt(t.style.height);if(element.virtualTop>0&&a.compatMode=="BackCompat")for(var h=[viewport0,viewport1,viewport2,viewport],c=0;c<h.length;c++)if(h[c]!=null&&(h[c].style.position==""||h[c].style.position=="static"))h[c].style.position="relative"}else element.virtualPagingTop=element.virtualTop=0;element.preventScrollView=element.preventScrollView||false;var g=a.FpActiveSpread==null;if(element.getAttribute("mcctCellType")==null&&e!=null){fpSpreadJS.loadScriptResources(function(){initChartObj()&&spreadView.IsLayoutInitialized()&&sizeSpread(true)});g=false}else{if(g)ignoreMainScroll=true;initChartObj();if(g){ignoreMainScroll=false;g=true}}if(spreadView.GetPendingRequestLength()==0){initSpan(getViewport0(),spanCells);initSpan(getViewport1(),spanCells);initSpan(getViewport2(),spanCells);initSpan(getViewport(),spanCells);initSpan(getColHeader(),colSpanCells);initSpan(getFrozColHeader(),colSpanCells);initSpan(getRowHeader(),rowSpanCells);initSpan(getFrozRowHeader(),rowSpanCells)}spreadView._InitDataModel();if(frzRows!=0||frzCols!=0){rowCount=0;if(getViewport1()!=null)rowCount+=getViewport1().rows.length;if(getViewport()!=null)rowCount+=getViewport().rows.length}fpSpreadJS.countChildViews();if(options==null)options={};options.ActiveRow=getXmlActiveRow();options.ActiveColumn=getXmlActiveCol();var u=getParentSpread();if(spreadView.GetPendingRequestLength()==0){initLayout(true,function(){r!=null&&r();spreadView._InitScrollbarState();if(spreadView.RequireUpdateTextBoxLocation()){var b=getTopSpread(element);if(b.getAttribute("mcctCellType")!="true")if(lastTextBoxPosition==null){var a=b.getBoundingClientRect();$$(textBox).moveToPosition(Math.floor(a.left+a.width/2),Math.floor(a.top+a.height/2))}else{b.ignoreUpdateTextBoxLocation=true;textBox.style.top=lastTextBoxPosition.top;textBox.style.left=lastTextBoxPosition.left;lastTextBoxPosition=null}}},e);if(smartPaint){backUpStyleSetting();initSmartPaint();restoreStyleSetting();sizeSpread(true)}}if(activeChartObj==null){spreadView.SuspendPaintSelection();this.initSelection();spreadView.ResumePaintSelection()}var v=null;if(u==null){if(xmlData!=null){var b=null,B=xmlData.selectSingleNode("root activespread");v=xmlData.selectSingleNode("root activechild");var q=xmlData.textContent(B),d=xmlData.textContent(v);if(d==null||d.length==0)d=q;if(q!=null&&q.length>0)if(d!=null&&d!=""){b=spreadView.GetActiveSpread();if(b!=null&&!o.contains(a.body,b))b=a.getElementById(b.id);(b==null||o.contains(element,b,true))&&spreadView.ActivateSpread(a.getElementById(d),true);var z=getTopSpread(a.FpActiveSpread);z!=null&&z.getSpreadView()._HookDocumentFocusInEvent()}b=spreadView.GetActiveSpread();var j=window.FpChartUtil?window.FpChartUtil:null;if(o.contains(element,b,true)||d!=null&&d!=""&&retainSelectionBlock&&(b=a.getElementById(d))!=null){if(!j||!j.IsActiveChartExisted(b)){var s=b.getSpreadView().GetSpreadContext();s.paintSelections(true);s.paintAnchorCell(true,null,true)}}else if(retainSelectionBlock&&(!j||!j.IsActiveChartExisted(element))&&!spreadView.IsMultiColumnComboBox){paintSelections(true);paintAnchorCell(true,null,true)}}if(a.FpActiveSpread==element&&(element.getAttribute("AllowInsert")=="false"||element.getAttribute("IsNewRow")=="true")){spreadView.GetCommandBar().EnableButton("Insert",false);spreadView.GetCommandBar().EnableButton("Add",false)}e!="LoadOnDemand"&&GetActiveChartObj()==null&&spreadView.GetCommandBar().EnableButton("Update",false)}initialized=true;dirty=true;needActive=spreadView.GetAttribute("hostspread")==null&&u==null&&(a.FpActiveSpread==element||isChild(a.FpActiveSpread,element));syncColSelection();element.getAttribute("ajax")=="false"&&fireOperationEndEvent();$$.browser.quirksMode&&autoFitTextBoxEditors(element);setTimeout(function(){element.ignoreVirtualPaging=false},100);fpSpreadJS.setImeMode(element,textBox,anchorCell);spreadView._DisableSpreadValidators();SPLController=new ClientSparklinesController(element);!spreadView.IsInitialized&&element.initLayoutCompleted&&doOnSpreadInitialized(e);if(g){var y=GetActiveChartObj();if(y!=null){y.scrollChartIntoView();scrollView()}}(spreadView.IsSpreadActive()||retainSelectionBlock)&&anchorCell!=null&&containsNumericCellType(anchorCell)&&setTimeout(function(){paintSelectedCell(anchorCell,true,true)},50);((window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&typeof MSGesture!="undefined"||"ontouchstart"in a.documentElement&&$$.browser.webkit)&&this.initPlugIns(e,options);element.initialized=true;var p=getScrollvp()||getViewport().parentNode;if(p!=null&&e=="LoadOnDemand"&&!spreadView.IsBackgroundMode){var k=getXmlScrollValues();k.ScrollTop!=-1&&spreadView.RegisterTimeoutTask(function(){if(k.ScrollTop!=-1&&p.scrollTop!=k.ScrollTop){detachScrollEvents();p.scrollTop=k.ScrollTop;attachScrollEvents()}},0,"LoadOnDemandValidateScrollPosition")}grayareacursor=getgrayAreaCursor();$$.j(element).trigger("SpreadInitialized");$$.j(window).on("unload."+element.id,function(){if(xmlData){xmlData.dispose();xmlData=null}if(spreadView)spreadView.__previousSelectionNode=null;$$.j(window).off("unload."+element.id)})}function initFields(){$element=$$.j(element);xhtml=!$$.browser.quirksMode;_ignoreVirtualPaging=[];needScrollToTopRow=element.getAttribute("scrollToTopRow")=="true";current=-1;currentCount=-1;newTop=0;newPageCount=0;smartPaint=false;uiVirtualization=getTopSpread().getAttribute("hierView")!="true"&&element.getAttribute("UIVirtualization")=="True"&&element.getAttribute("virtualPaging")!="true"&&element.getAttribute("ClientAutoSize")!="True";uiVirtualization&&element.setAttribute("scrollContentTime",500);selectionBlockOptions=parseInt(element.getAttribute("selectionBlockOptions"));topTable=$$.j("#"+element.id+"_top_table")[0];tableView=window.document.getElementById(element.id+"_view");if(tableView!=null)viewport=window.document.getElementById(element.id+"_viewport");viewport0=window.document.getElementById(element.id+"_viewport0");viewport1=window.document.getElementById(element.id+"_viewport1");viewport2=window.document.getElementById(element.id+"_viewport2");rowHeader=window.document.getElementById(element.id+"_rowHeader");if(smartPaint){vp2List=new TableBuff(element,getViewport2());vpList=new TableBuff(element,getViewport());rhList=new TableBuff(element,getRowHeader())}isJustClickOnGrayArea=false;anchorCell=null;leadingCell=null;groupBar=null;hierBar=null;pager1=null;pager2=null;dummy=null;vpholder=null;frozRowHeader=null;frozColHeader=null;frozColFooter=null;frzRows=0;frzCols=0;validationMsg=null;editorList=[];validatorList=[];spanCells=[];rowSpanCells=[];colSpanCells=[];dragCol=dragViewCol=-1;movingCol=dragSlideBar=allowColMove=allowGroup=activePager=null;cb_btn=null;msgStyle=null;editor=sizeColumn=sizeRow=null;working=editing=false;scrollLeft=0;scrollTop=0;lastPageIndex=currentPageIndex;currentPageIndex=GetCurrentPageIndex();ignoreSynRowHeight=false;bSuspendLayout=false;editModePermanent=element.getAttribute("EditModePermanent")!=null;if(element.getAttribute("RetainSelectionBlock")!=null&&element.getAttribute("RetainSelectionBlock")=="false")retainSelectionBlock=false;msgList=null;copymultiCol=false;selectedBackColor=element.getAttribute("selectedBackColor");anchorBackColor=element.getAttribute("anchorBackColor");useDefaultSelectionBackColor=element.getAttribute("useDefaultSelectionBackColor");allowColMove=element.getAttribute("colMove");allowGroup=element.getAttribute("allowGroup");operationMode=element.getAttribute("OperationMode");corner=window.document.getElementById(element.id+"_corner");if(corner!=null&&corner.children.length>0)corner=$$.j(corner).children().first().get(0);frzRows=viewport1!=null?viewport1.rows.length:0;if(viewport0!=null||viewport2!=null){var c=getColGroup(viewport0||viewport2);if(c!=null)frzCols=c.children.length}var a=window.document.getElementById(element.id+"_frozColHeader");if(a!=null){frozColHeader=$$.j(a).children().first().get(0);frzCols=getColGroup(frozColHeader).children.length}a=window.document.getElementById(element.id+"_frozColFooter");if(a!=null)frozColFooter=$$.j(a).children().first().get(0);colFooter=window.document.getElementById(element.id+"_colFooter");if(colFooter!=null)colFooter=$$.j(colFooter).children().first().get(0);footerCorner=window.document.getElementById(element.id+"_footerCorner");if(footerCorner!=null&&footerCorner.children.length>0)footerCorner=$$.j(footerCorner).children().first().get(0);a=window.document.getElementById(element.id+"_frozRowHeader");if(a!=null)frozRowHeader=$$.j(a).children().first().get(0);if(rowHeader!=null)rowHeader=$$.j(rowHeader).children().first().get(0);colHeader=window.document.getElementById(element.id+"_colHeader");if(colHeader!=null)colHeader=$$.j(colHeader).children().first().get(0);commandBar=window.document.getElementById(element.id+"_commandBar");scrollvp=window.document.getElementById(element.id+"_scrollvp");rowHeaders=parseInt(element.getAttribute("RowHeaders"));colHeaders=parseInt(element.getAttribute("ColHeaders"));enableRowEditTemplate=element.getAttribute("EnableRowEditTemplate");if(element.getAttribute("selectionUnit")!=null)selectionUnit=element.getAttribute("selectionUnit");virtualScrollPagingFormatString=element.getAttribute("virtualScrollPagingFormatString");var b=getViewport();if(b!=null){element.RowCount=b.rows.length;element.ColCount=b.getAttribute("cols")}_keepCurrentScrollValue=-1;getParentSpread()==null&&$$.browser.webkit&&window.fpPostOn==null&&fixSafariAutoFormat()}function attachEvents(){var b=$$.j(document||window.document),d=getParentSpread();d==null&&window.document.addEventListener("mouseup",documentMouseUp,true);$element.on("mousedown",mouseDown);$element.on("mousemove",mouseMove);$element.on("mouseout",mouseOut);$element.on("mouseover",mouseOver);$element.on("dblclick",dblclick);$element.on("propertychange",propertyChanged);element.onresize=processResize;var c=[getParent(getFrozColHeader()),getParent(getFrozColFooter()),getParent(getFrozRowHeader()),getParent(viewport0),getViewportHolder(),element];$$.utils.cleanArray(c);for(var e=0;e<c.length;e++){var g=c[e];$$.j(g).on("scroll",noScroll)}elementWheelListener=$$.utils.addWheelListener(element,doMouseWheel,true);var f=getViewportHolder();if(f!=null)vpHolderWheelListener=$$.utils.addWheelListener(f,doMouseWheel,true);if(!$$.browser.ie){$element.on("focusin",elementOnFocus);$element.on("focusout",elementOnFocusOut)}else{textBox.onactivate=null;textBox.onactivate=textBoxActive;element.onactivate=null;element.onactivate=spreadActive}if(d==null&&$$.browser.version>10){$window=$$.j(window);$window.off("resize",processResize);$window.on("resize",processResize)}b.off("keyup",keyup);b.on("keyup",keyup);b.off("keydown",translateKey);b.on("keydown",translateKey);b.off("keypress",keypress);b.on("keypress",keypress);b.off("mousedown",setActiveSpread);b.on("mousedown",setActiveSpread);var a=$$.utils;a.attachEvent(element,"Scroll");a.attachEvent(element,"ActiveCellChanging");a.attachEvent(element,"ActiveCellChanged");a.attachEvent(element,"DataChanged");a.attachEvent(element,"SelectionChanged");a.attachEvent(element,"EditStart");a.attachEvent(element,"EditStopped");a.attachEvent(element,"CallBackStart");a.attachEvent(element,"CallBackStopped");a.attachEvent(element,"ColumnDragMove");a.attachEvent(element,"ColumnDragMoveCompleted");a.attachEvent(element,"ErrorMessageShown");a.attachEvent(element,"AutoFilteringColumn");a.attachEvent(element,"AutoFilteredColumn");a.attachEvent(element,"ColWidthChanged");a.attachEvent(element,"RowHeightChanged");a.attachEvent(element,"CopyData");a.attachEvent(element,"LoadRowsStart");a.attachEvent(element,"LoadRowsStopped");a.attachEvent(element,"TouchStripOpening");a.attachEvent(element,"TouchStripOpened");a.attachEvent(element,"TouchStripClosed");a.attachEvent(element,"MenuItemClicked");a.attachEvent(element,"ContextMenuClosed");a.attachEvent(element,"ContextMenuOpening");a.attachEvent(element,"ContextMenuOpened");if(d==null)if($$.browser.chrome)monitorDisplay();else if(element._pageLoadCallback==null){element._windowOnLoad=function(){(element.offsetWidth==0||element.offsetHeight==0)&&monitorDisplay();$$.j(window).off("load",element._windowOnLoad);element._windowOnLoad=null};$$.j(window).on("load",element._windowOnLoad)}}function initElementBehavior(){createTextbox();createFocusBorder();createSizebar();typeof element.ActiveRow=="undefined"&&Object.defineProperty(element,"ActiveRow",{"get":getActiveRow});typeof element.ActiveCol=="undefined"&&Object.defineProperty(element,"ActiveCol",{"get":getActiveCol});element.SetActiveCell=SetActiveCell;element.GetCellByRowCol=GetCellByRowCol;element.GetValue=GetValue;element.SetValue=SetValue;element.GetFormula=GetFormula;element.SetFormula=SetFormula;element.GetHiddenCellValue=GetHiddenCellValue;element.SetHiddenCellValue=SetHiddenCellValue;element.GetHiddenValue=GetHiddenValue;element.SetHiddenValue=SetHiddenValue;element.GetSheetRowIndex=GetSheetRowIndex;element.GetSheetColIndex=GetSheetColIndex;element.GetTopRowIndex=GetTopRowIndex;element.GetLeftColIndex=GetLeftColIndex;element.GetRowByKey=getRowByKey2;element.GetColByKey=getColByKey2;element.GetRowKeyFromRow=getRowKeyFromRow2;element.GetColKeyFromCol=getColKeyFromCol3;element.GetRowCount=GetRowCount;element.GetColCount=GetColCount;element.GetParentSpread=getParentSpread;element.GetChildSpread=GetChildSpread;element.GetChildSpreads=GetChildSpreads;element.GetSpread=getSpreadControl;element.GetParentRowIndex=GetParentRowIndex;element.GetActiveChildSheetView=GetActiveChildSheetView;element.UpdatePostbackData=UpdatePostbackData;element.SizeToFit=SizeToFit;element.SetColWidth=setColWidth;element.ExpandRow=ExpandRow;element.SortColumn=SortColumn;element.CallBack=CallBack;element.AddKeyMap=AddKeyMap;element.RemoveKeyMap=RemoveKeyMap;element.MoveToPrevCell=MoveToPrevCell;element.MoveToNextCell=MoveToNextCell;element.MoveToNextRow=MoveToNextRow;element.MoveToPrevRow=MoveToPrevRow;element.MoveToFirstColumn=MoveToFirstColumn;element.MoveToLastColumn=MoveToLastColumn;element.CopyLikeExcel=CopyLikeExcel;element.CutLikeExcel=CutLikeExcel;element.PasteLikeExcel=PasteLikeExcel;element.ScrollTo=ScrollTo;element.GetTotalRowCount=GetTotalRowCount;element.GetPageCount=GetPageCount;element.Edit=Edit;element.IsValid=IsValid;element.LoadData=LoadData;element.GetCurrentPageIndex=GetCurrentPageIndex;element.Copy=Copy;element.Paste=Paste;element.Clear=Clear;element.Update=Update;element.Cancel=Cancel;element.Add=Add;element.Insert=Insert;element.Delete=Delete;element.Prev=Prev;element.Next=Next;element.StartEdit=StartEdit;element.EndEdit=EndEdit;element.Print=Print;element.PrintPDF=PrintPDF;element.GetSelectedRange=GetSelectedRange;element.GetSelectedRanges=GetSelectedRanges;element.SetSelectedRange=SetSelectedRange;element.ClearSelection=ClearSelection;element.AddSelection=AddSelection;element.SuspendLayout=SuspendLayout;element.ResumeLayout=ResumeLayout;element.ShowMessage=ShowMessage;element.HideMessage=HideMessage;element.SetActiveSpreadID=setActiveSpreadID;element.Cells=Cells;element.Rows=Rows;element.Columns=Columns;element.GetTitleInfo=GetTitleInfo;element.SetActiveChart=SetActiveChart;element.GetActiveChart=GetActiveChart;element.getCommandBar=getCommandBar;element.getRowHeader=getRowHeader;element.getColHeader=getColHeader;element.getViewport=getViewport;element.getCorner=getCorner;element.getFrozColHeader=getFrozColHeader;element.getFrozRowHeader=getFrozRowHeader;element.getViewport0=getViewport0;element.getViewport1=getViewport1;element.getViewport2=getViewport2;element.getScrollvp=getScrollvp;element.setColWidth=setColWidth;element.waitForAttachBehavior=waitForAttachBehavior;element.printSpread=printSpread;element.sizeSpread=sizeSpread;element.processKeyMap=processKeyMap;element.syncRowRange=syncRowRange;element.syncRowRangeSafeMode=syncRowRangeSafeMode;element.getPagers=getPagers;element.getColHeader=getColHeader;element.getParentSpread=getParentSpread;element.getRowByKey=getRowByKey;element.getColByKey=getColByKey;element.clearCellData=clearCellData;element.Filter=Filter;element.init=init;element.loadScrollbarState=loadScrollbarState;element.fireCallBackStartEvent=fireCallBackStartEvent;element.fireCallBackStoppedEvent=fireCallBackStoppedEvent;element.fireActiveCellChangingEvent=fireActiveCellChangingEvent;element.fireActiveCellChangedEvent=fireActiveCellChangedEvent;element.fireDataChangedEvent=fireDataChangedEvent;element.fireSelectionChangedEvent=fireSelectionChangedEvent;element.fireEditStartEvent=fireEditStartEvent;element.fireEditStoppedEvent=fireEditStoppedEvent;element.fireAutoFilterColumnCompleted=fireAutoFilterColumnCompleted;element.setCellValueFromView=setCellValueFromView;element.setActiveField=setActiveField;element.getAttributeInternal=getAttributeInternal;element.getCellFromRowCol=getCellFromRowCol;element.isHeaderCell=isHeaderCell;element.getEditor=getEditor;element.setEditorFocus=setEditorFocus;element.GetActiveRow=getActiveRow;element.GetActiveCol=getActiveCol;element.setColHeaderRowHeight=setColHeaderRowHeight;element.getColFooter=getColFooter;element.getFrozColFooter=getFrozColFooter;element.getFooterCorner=getFooterCorner;element.setRowHeaderColWidth=setRowHeaderColWidth;element.setRowHeight2=setRowHeight2;element.getPreferredRowHeight=getPreferredRowHeight;element.getCellEditorID=getCellEditorID;element.getCellEditor=getCellEditor;element.getRowHeightInternal=getRowHeightInternal;element.getRowHeightInternal2=getRowHeightInternal2;element.paintFocusRect=paintFocusRect;element.paintAnchorCell=paintAnchorCell;element.textBoxActive=textBoxActive;element.spreadActive=spreadActive;element.AddSpan=AddSpan;element.RemoveSpan=RemoveSpan;element.GetSheetIndex=GetSheetIndex;element.getTopSpread=getTopSpread;element.OpenWaitMsg=openWaitMsg;element.CloseWaitMsg=closeWaitMsg;element.inactiveAllChart=inactiveAllChart;element.RefreshChart=RefreshChart;element.GetActiveChartObj=GetActiveChartObj;element.SetActiveChartObj=SetActiveChartObj;element.getViewportSize=getViewPortSize;element.rowEditTemplateContainer_keyDown=rowEditTemplateContainer_keyDown;element.rowEditTemplateContainer_textBoxFocus=rowEditTemplateContainer_textBoxFocus;element.doGetFocus=doGetFocus;element.isSizeSpread=false;element.getSpreadJS=function(){return fpSpreadJS};element.isMVCSpread=function(){return mvc!=null&&mvc.inMvcFramework()};element.getSpreadContext=getSpreadContext;element.getSpreadView=function(){return spreadView};element.findContentTag=findContentTag;element.getSelectionBlockOptions=function(){return selectionBlockOptions};element.UpdateRowHeight=UpdateRowHeight;element.GetTouchStrip=function(a){if(spreadView&&spreadView.Touch)return spreadView.Touch.GetTouchStrip(a)};element.isEditing=function(){return editing};element.getEditingInfo=function(){return editing?{Editor:editor,EditingValue:editingValue,RenderAsEditor:renderAsEditor}:null};element.isHandleEvent=isHandleEvent;element.__attachOnActiveEvent=__attachOnActiveEvent;element.__detachOnActiveEvent=__detachOnActiveEvent;element.getAnchorCell=function(){return anchorCell};element.focus=focus;element.onclickCell=onclickCell;element.blur=blur;typeof element.ignoreVirtualPaging=="undefined"&&Object.defineProperty(element,"ignoreVirtualPaging",ignoreVirtualPagingPropertySettings);element.stopVirtualPaging=function(){element.ignoreVirtualPaging=true};element.startVirtualPaging=function(){element.ignoreVirtualPaging=false};if(typeof Sys!="undefined")element.SetCellValue=setCellValue;if(element.inDesign){element.getCellType=getCellType;element.getEditor=getEditor;element.getFunction=getFunction}}function subscribeEvents(){}function getXmlScrollValues(){var b=xmlData.selectSingleNode("root scrollTop");if(b!=null&&xmlData.textContent(b)!="")b=parseInt(xmlData.textContent(b));else b=-1;var a=xmlData.selectSingleNode("root scrollLeft");if(a!=null&&xmlData.textContent(a)!="")a=parseInt(xmlData.textContent(a));else a=-1;return{ScrollTop:b,ScrollLeft:a}}function clearSelectedNumericCellTypeCell(a){a!=null&&containsNumericCellType(a)&&paintSelectedCell(a,false)}function doOnSpreadInitialized(c){spreadView.OnSpreadInitialized(c);spreadView.ignoreShowScrollingContent=true;loadScrollbarState(element,true);ignoreEditorFocus=true;needActive&&doSetFocus(c);ignoreEditorFocus=false;var a=null;if(needActive&&editing&&editor!=null&&document.activeElement!=editor&&spreadView.NeedSetEditorFocusOnActiveCell()){a=spreadView._GetViewportFromCell(anchorCell);if(a!=null)a=a.parentNode;setEditorFocus(editor);if(a==(viewport2||viewport).parentNode&&a.scrollTop<element.virtualTop)a.scrollTop=element.virtualTop}scrollView({target:a});attachEvents();setTimeout(function(){attachScrollEvents();if(spreadView.lastScrollTimeoutId==null)spreadView.ignoreShowScrollingContent=false;else setTimeout(function(){spreadView.ignoreShowScrollingContent=false},100)},0);if(spreadView.Parent==null&&(!$$.browser.ie||$$.browser.version>=10)){var b=$$.j(textBox);b.on("compositionstart",onTextBoxCompositionStart);b.on("compositionupdate",onTextBoxCompositionUpdate);b.on("keydown",onTextBoxKeyDown);b.on("keyup",onTextBoxKeyUp);b.on("blur",onTextBoxBlur);inTextBoxKeyDown=false}}function doSetFocus(a){if(typeof window.__smartNav=="undefined")try{if(a!="LoadOnDemand"){var c=anchorCell;if(!spreadView.IsSpreadActive())document.FpActiveSpread.focus();else{focus();if(a!=null&&isInTouchAjax()&&(spreadView.OperationMode!=$$.OperationModes.NORMAL&&spreadView.OperationMode!=$$.OperationModes.ROW_MODE||anchorCell==null&&(spreadView.RowCount==0||spreadView.ColumnCount==0)))spreadView.IsSpreadActive()&&!spreadView.IsPopupOpened()&&spreadView.GetTopSpreadView().Spread.GetActiveChartObj()==null&&!$$.utils.contains(element,document.activeElement)&&document.activeElement!=getTextBox()&&setTextBoxFocus()}a!="Update"&&c!=anchorCell&&anchorCell!=null&&spreadView.GetCommandBar().EnableButton("Update",true)}}catch(d){$$.DEBUG.Log(d,"startVirtualPaging")}if(spreadView.IsSpreadActive()&&a!="LoadOnDemand"&&anchorCell!=null&&anchorCell.getAttribute("RowEditTemplate")!="true"&&spreadView.NeedSetEditorFocusOnActiveCell()){var b=fpSpreadJS.GetInlineEditor(anchorCell);b!=null&&updateEditingInfo(b)}}var ___this=this;function getSpreadContext(){return ___this}function frzRowCount(){return frzRows}function frzColCount(){return frzCols}function fireSpreadEvent(name,evt){var eventObj=eval(name);eventObj!=null&&eventObj.fire(evt)}function isWorking(){return working}function isInitialized(){return initialized&&element.initialized}function isIgnorePostbackEditmode(){return ignorePostbackEditmode}function GetPageActiveSpread(){return element.document.FpActiveSpread}function setActiveField(){}function fireOperationEndEvent(){fireAutoFilterColumnCompleted()}function getIEMode(){if(document.documentMode)engine=document.documentMode;else{engine=5;if(document.compatMode)if(document.compatMode=="CSS1Compat")engine=7}}var ignoreScroll=false,ignoreMainScroll=false;function fireAutoFilteringColumn(c,b){var a,d={spread:element,cancel:false,col:c,filterString:b};a=$$.utils.createEvent("AutoFilteringColumn",false,true,d);element.dispatchEvent(a);return a}function fireAutoFilterColumnCompleted(a){if(element.getAttribute("isFiltering")=="true"&&(a==null||a==element.getAttribute("FilteringString")||GrapeCity.Web.Spread.FilterEditor.IsFilterCommand(a)))if(element.getAttribute("isFilteringCancel")!="true"){var b={spread:element,col:element.getAttribute("FilteringCol"),filterString:element.getAttribute("FilteringString")},c=$$.utils.createEvent("AutoFilteredColumn",false,true,b);element.dispatchEvent(c)}}function blur(){setActiveSpreadID(element,"","",false)}function onTextEditorCompositionStart(b){spreadView.IsInTouchMode()&&spreadView._PerformTouchTranslateKey(b);b.target.isIMEComposing=true;var a=$$.j(b.target);$$.browser.ie&&a.off("compositionstart",onTextEditorCompositionStart);a.off("compositionend",onTextEditorCompositionEnd);a.on("compositionend",onTextEditorCompositionEnd)}function onTextEditorCompositionEnd(a){a.target.isIMEComposing=false;$$.j(a.target).off("compositionend",onTextEditorCompositionEnd);if($$.browser.webkit&&!IsValid()){var c=a.target,b=c.value;b.length>c.maxLength&&setTimeout(function(){if(c.value!=b&&!IsValid()&&(document.FpActiveSpread==null||getTopSpread(document.FpActiveSpread)!=getTopSpread(element)))a.target.value=b},0)}}var inTextBoxKeyDown=false;function onTextBoxKeyDown(){inTextBoxKeyDown=true}function onTextBoxKeyUp(){inTextBoxKeyDown=false}function onTextBoxBlur(){inTextBoxKeyDown=false}function onTextBoxCompositionStart(a){ensureEditingState(a)}function onTextBoxCompositionUpdate(a){!$$.browser.webkit&&ensureEditingState(a)}function ensureEditingState(b){var a=spreadView.GetActiveSpreadView(false,true)||spreadView;!inTextBoxKeyDown&&!a.Spread.isEditing()&&a.IsSpreadActive()&&!a._PerformTouchTranslateKey(b)&&setTimeout(function(){!a.Spread.isEditing()&&a.Spread.getAnchorCell()!=null&&a.Spread.StartEdit()},0)}function createTextbox(){var e=element.getAttribute("mcctCellType")!="true"?getTopSpread(element):element;textBox=window.document.getElementById(e.id+"_textBox");var b=element.getAttribute("OperationMode"),a="text";if($$.browser.webkit){var c=element.getAttribute("EditModePermanent")!=null;a=!c||enableRowEditTemplate=="true"&&b=="RowMode"||b!="Normal"&&b!="RowMode"?"checkbox":"text";if(textBox&&c){var d=$$.utils.isTextControl(textBox);if(d&&a=="checkbox"||!d&&a!="checkbox"){textBox.parentNode.removeChild(textBox);textBox=null}}}if(textBox==null){textBox=createHiddenText("INPUT",a,e.id+"_textBox");if($$.utils.isTextControl(textBox))if($$.browser.webkit){textBox.style.fontSize="0px";textBox.style.width=textBox.style.height="18px";textBox.setAttribute("readonly","readonly")}else textBox.style.textIndent="-1em"}updateTabIndex()}function createHiddenText(d,c,e){var a=window.document.getElementById(e);if(a==null){var b=document.createElement("div");b.style.position="absolute";b.style.left=b.style.top="-100px";b.style.width=b.style.height="0px";b.style.overflow=$$.browser.ie||$$.browser.webkit?"hidden":"visible";$$.j(b).addClass("Unselectable");a=document.createElement(d);if(d.toLowerCase()=="input"&&c!=null)a.type=c;a.style.overflow="hidden";a.style.position="absolute";a.style.borderWidth="0px";a.style.borderStyle="none";a.style.resize="none";a.style.outline="none";a.style.padding="0px";a.style.margin="0px";a.style.top="10px";a.style.left="-100px";a.style.width="1px";a.style.height="1px";a.style.color="transparent";a.style.backgroundColor="transparent";a.id=e;a.tabIndex=-1;a.setAttribute("autocomplete","off");b.appendChild(a);getTopSpread().appendChild(b)}return a}function getClipboardBuffer(){var b=getTopSpread(element),a=window.document.getElementById(b.id+"_clipboardBuffer");if(a==null){a=createHiddenText("TEXTAREA",null,b.id+"_clipboardBuffer");a.style.lineHeight="1px";a.style.fontSize="1px";a.tabIndex=-1}return a}function updateTabIndex(){var a=getTopSpread(element);if(a==element){if(element.tabIndex>=0){textBox.tabIndex=element.tabIndex;element.tabIndex=-1}}else if(element.tabIndex!=null)element.tabIndex=-1}var needActive=false;function textBoxBlur(){if(!ignoreBlur)if(!retainSelectionBlock){paintAnchorCell();paintSelections(false);paintAnchorCellHeader(false);spreadView.HideFocusRectangle()}}function hideFocusBorder(){var b=element.document;if(!b.getElementById)b=window.document;var c=element.id,a=b.getElementById(c+"_focusRectT");if(a==null)return;a.style.left="-1000px";a.style.width="0px";a=b.getElementById(c+"_focusRectB");a.style.left="-1000px";a.style.width="0px";a=b.getElementById(c+"_focusRectL");a.style.left="-1000px";a.style.width="0px";a=b.getElementById(c+"_focusRectR");a.style.left="-1000px";a.style.width="0px"}function getSizeHeader(){var a=getTopSpread(element);return a.getAttribute("sizeHeader")!=null}function createLineBorder(c){var b=element.document;if(!b.getElementById)b=window.document;var a=b.getElementById(c);if(a==null){a=b.createElement("img");a.style.position="absolute";a.style.left="-1000px";a.style.top="0px";a.style.overflow="hidden";a.style.border="1px solid black";if(element.getAttribute("FocusBorderColor")!=null)a.style.borderColor=element.getAttribute("FocusBorderColor");if(element.getAttribute("FocusBorderStyle")!=null)a.style.borderStyle=element.getAttribute("FocusBorderStyle");a.id=c;var d=getViewport().parentNode;d.insertBefore(a,null)}return a}function createFocusBorder(){if(frzRows>0||frzCols>0)return;if(getTopSpread().getAttribute("hierView")=="true")return;if(element.getAttribute("showFocusRect")=="false")return;if(getViewport()==null)return;var b=element.id,a=createLineBorder(b+"_focusRectT");a.style.height="0px";a=createLineBorder(b+"_focusRectB");a.style.height="0px";a=createLineBorder(b+"_focusRectL");a.style.width="0px";a=createLineBorder(b+"_focusRectR");a.style.width="0px"}function createSizebar(){var a=element.document;if(!a.createElement)a=window.document;sizeBar=window.document.getElementById(element.id+"_sizeBar");var b=getSizeHeader();if(sizeBar==null&&(b||frzRows>0||frzCols>0)){sizeBar=a.createElement("img");sizeBar.style.position="absolute";sizeBar.style.borderWidth="1px";sizeBar.style.top="0px";sizeBar.style.left="-400px";sizeBar.style.width="2px";sizeBar.style.height="2px";sizeBar.style.background="black";sizeBar.style.zIndex=1e3;sizeBar.id=element.id+"_sizeBar";$element.append(sizeBar)}}var posIndicator=null;function getPosIndicator(){if(posIndicator==null)createPosIndicator();else posIndicator.parentNode!=element&&$element.append(posIndicator);return posIndicator}function createPosIndicator(){var a=element.document;if(!a.createElement)a=window.document;posIndicator=window.document.getElementById(element.id+"_posIndicator");if(posIndicator==null){posIndicator=a.createElement("img");posIndicator.style.position="absolute";posIndicator.style.borderWidth=1;posIndicator.style.top="0px";posIndicator.style.left="-400px";posIndicator.style.width="10px";posIndicator.style.height="10px";posIndicator.style.zIndex=1e3;posIndicator.id=element.id+"_posIndicator";if(element.getAttribute("clienturl")!=null)posIndicator.src=element.getAttribute("clienturl")+"down.gif";else posIndicator.src=element.getAttribute("clienturlres");$element.append(posIndicator)}}function initSpan(b,i,h){var j=h||0;if(b!=null){if(b==getViewport())rowCount=b.rows.length;for(var f=b.rows,k=GetColCount(),c=j;c<f.length;c++)if(IsChildSpreadRow(b,c)){if(b==getViewport())rowCount--}else for(var e=f[c].cells,d=0;d<e.length;d++){var a=e[d];if(a!=null&&a.getAttribute("FpSpread")!="rowpadding"&&(a.rowSpan!=null&&a.rowSpan>1||a.colSpan!=null&&a.colSpan>1)){var l=getRowFromCell(a),g=parseInt(a.getAttribute("scol"));g<k&&AddSpan(l,g,a.rowSpan,a.colSpan,i)}}}}function getColWithSpan(e,a,d){var f=0,c=0;if(d==0)while(isCovered(e,c,a))c++;for(var b=0;b<a.length;b++)if(a[b].rowCount>1&&(a[b].col<=d||d==0&&a[b].col<c)&&e>=a[b].row&&e<a[b].row+a[b].rowCount)f+=a[b].colCount;return f}function AddSpan(f,e,d,c,a){if(a==null)a=spanCells;var b=new Range;b.Set("Cell",f,e,d,c);a.push(b);!spreadView.IsInTouchMode()&&initialized&&spreadView.ShowFocusRectangle(true)}function RemoveSpan(g,f,a){if(a==null)a=spanCells;for(var b=0;b<a.length;b++){var d=a[b];if(d.row==g&&d.col==f){for(var e=a.length-1,c=b;c<e;c++)a[c]=a[c+1];a.length=a.length-1;break}}!spreadView.IsInTouchMode()&&spreadView.ShowFocusRectangle(true)}function onclickCell(){mouseDown()}function textBoxActive(a,u){if(ignoreChange||ignoreElementActive)return;if(activeChartObj!=null)return;var e=spreadView!=null&&!spreadView.OnSetTextBoxFocus(a);if(a!=null&&a.target!=null&&a.target!=element){var m=$$(a.target).getParent("DIV",0,{FpSpread:"Spread"});if(m!=null&&element!=m&&editModePermanent&&!u)return}!e&&!ignoreBlur&&editModePermanent&&doGetFocus({PreventSwitchingKeyboard:true});if(!e&&!$$.browser.ie)e=$$.utils.isNativeControl(document.activeElement)&&$$.utils.contains(element,document.activeElement);var b=getTopSpread(element);if(element.document.FpActiveSpread==null){var g=$$.fn.createXMLDOMWrapper(b),f=g.selectSingleNode("root activechild"),o=element.document.FpActiveSheetView;try{if(f!=null&&g.textContent(f)!=null&&g.textContent(f)!=""){var n=element.document.getElementById(g.textContent(f));spreadView.ActivateSpread(n!=null?n:element)}else if(o!=null&&b==getTopSpread(o))spreadView.ActivateSpread(element.document.FpActiveSheetView);else if(b.getAnchorCell()!=null&&b.getAnchorCell().paintSelected)spreadView.ActivateSpread(b);else{for(var t=null,r=getAllSpreads(),k=0;k<r.length;k++){var j=r[k];if(j.getAnchorCell()!=null&&j.getAnchorCell().paintSelected){spreadView.ActivateSpread(j);t=true;break}}!t&&spreadView.ActivateSpread(b)}}catch(v){if(element.document.FpActiveSheetView!=null)spreadView.ActivateSpread(element.document.FpActiveSheetView);else spreadView.ActivateSpread(b);$$.DEBUG.Log(v,"textBoxActive")}getTopSpread(element.document.FpActiveSpread).getSpreadView()._HookDocumentFocusInEvent()}var i=element.document.FpActiveSpread;if($$.utils.contains(b,i,true)){var s=i==null?"":i.id;setActiveSpreadID(b,s,s)}element.document.FpActiveSheetView=element.document.FpActiveSpread;if(element.document.FpActiveSpread!=element){var h=element.document.FpActiveSpread!=null?element.document.FpActiveSpread.getSpreadView():null;if(h!=null&&h.IsMultiColumnComboBox&&getTopSpread(h.GetHostSpread())==getTopSpread(element))return;ClearSelection(true,element.document.FpActiveSpread,false);!e&&setTextBoxFocus();element.document.FpActiveSpread!=null&&element.document.FpActiveSpread.getAttribute("hostspread")==null&&element.document.FpActiveSpread.textBoxActive(null,true);setActiveField(false);return}element.document.FpActiveSpread.setActiveField(true);ClearSelection(true,element,false);var l=false;if((a==null||!spreadView.IsInTouchMode()||getChartObj(a.target)==null)&&!(l=initAnchorCell(a)))if(window.event!=null&&window.event.target==element||a!=null&&a.target==element)!e&&setTextBoxFocus(null,null,{PreventSwitchKeyboard:true});l&&fpSpreadJS.keepGeneratedSelectionFromAnchorCell();if(retainSelectionBlock||element.document.FpActiveSpread==element){if(!ignorePaintSelection){ignorePaintSelection=true;paintSelections(true);ignorePaintSelection=false}else paintSelections(true);paintAnchorCell(element.document.FpActiveSpread==element)}var d=getOffsetTop(element,element.document.body),c=getOffsetLeft(element,element.document.body),q=d+element.clientHeight<element.document.body.scrollTop||d>element.document.body.scrollTop+element.document.body.clientHeight;if(xhtml)q=d+element.clientHeight<element.document.body.parentNode.scrollTop||d>element.document.body.parentNode.scrollTop+element.document.body.parentNode.clientHeight;if(q)if(xhtml)element.document.body.parentNode.scrollTop=d;else element.document.body.scrollTop=d;var p=c+element.clienWidth<element.document.body.scrollLeft||c>element.document.body.scrollLeft+element.document.body.clientWidth;if(xhtml)p=c+element.clienWidth<element.document.body.parentNode.scrollLeft||c>element.document.body.parentNode.scrollLeft+element.document.body.parentNode.clientWidth;if(p)if(xhtml)element.document.body.parentNode.scrollLeft=c;else element.document.body.scrollLeft=c;if(engine>=9){element.ignoreVirtualPaging=true;scrollView();element.ignoreVirtualPaging=false}}function initAnchorCell(c){var l=operationMode;if((!$$.utils.contains(element,element.document.activeElement)||!GCWS.FilterEditor.IsFilterControl(element.document.activeElement))&&anchorCell==null&&l!="MultiSelect"&&l!="ExtendedSelect"&&GetRowCount()>0&&GetColCount()>0){anchorCell=findAnchorCell();if(anchorCell)return true;var f=c||window.event,o=GetColCount(),m=GetRowCountInternal(),e=c&&c.type=="keydown"&&c.keyCode==tab,a,b;if(spreadView.IsInTouchMode()){var g=spreadView.SelectionModel._GetFocusRange();if(g==null){a=0;b=0}else{a=g.top;b=g.left}}else{a=getNextCellRowIndex(0,0,e,true);var j=needScrollToTopRow?spreadView.GetAttribute("topRow"):null;if(a>=frzRows&&j!=null){var i=frzRows+spreadView._GetKeyedTableRowIndex(j,true);if(a<i)a=getNextCellRowIndex(i,0,e,true)}b=getNextCellColIndex(0,0,e,true)}if(m>0&&a<m&&b<o){var h=fireActiveCellChangingEvent(a,b,element,0),d=getTopSpread(element);if(!h)if(d!=element)h=d.fireActiveCellChangingEvent(a,b,element,0);if(!h){if(!(element.getAttribute("OperationMode")=="Normal"&&(element.getAttribute("SelectionPolicy")=="MultiRange"&&element.getAttribute("multiRange")=="true"||element.getAttribute("SelectionPolicy")=="Range")))(!spreadView.IsInTouchMode()||a>=0&&b>=0)&&ClearSelection(false,null,false);leadingCellRow=a;leadingCellCol=b;updateAnchorCell(leadingCellRow,leadingCellCol);var n=e&&(d.getAttribute("ProcessTab")=="true"||d.getAttribute("ProcessTab")=="True")&&getCellFromRowCol(leadingCellRow,leadingCellCol)!=null&&getCellFromRowCol(leadingCellRow,leadingCellCol).getAttribute("TabStop")!=null&&getCellFromRowCol(leadingCellRow,leadingCellCol).getAttribute("TabStop")=="false";n&&!editing&&nextCell(f.keyCode,null,null,{Event:f});spreadView.GetCommandBar().UpdateCopyCutPaste();spreadView.GetCommandBar().EnableButton("Update",true);var k=c!=null&&c.simulatedEvent||f!=null&&$$.utils.isSelectControl(f.target,true);if(k)ignorePostbackEditmode=true;fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0,c!=null&&c.ignoreEditMode);d!=element&&d.fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0);if(k)ignorePostbackEditmode=false}}return true}return false}function selectAllText(e,d,c){if(anchorCell==null)return;var a=d||getEditor(anchorCell);if(a!=null&&a.select){if(!c){var b=a.getValue?a.getValue():a.value;if(a.setValue){a.setValue("");a.setValue(b)}else{a.value="";a.value=b}}try{var f=a.tagName=="INPUT"&&(a.type=="button"||a.type=="submit");if(!f)if(!e)$$.utils.selectAll(a);else spreadView.RegisterTimeoutTask(function(){a==element.document.activeElement&&$$.utils.selectAll(a)},0,"EditorSelectAllText")}catch(g){$$.DEBUG.Log(g,"selectAllText")}}}function suspendVirtualScrollPaging(){element.ignoreVirtualPaging=true}function restoreVirtualScrollPaging(){setTimeout(function(){element.ignoreVirtualPaging=false},0)}function spreadActive(a){doSpreadActive(a);isJustClickOnGrayArea=false;isPressTABKeyFromOutSide=false;needCheckSelectText=false}function doSpreadActive(b){var a=element.document;if(a.PreviousActiveSpread!=null&&a.PreviousActiveSpread!=a.FpActiveSpread){a.PreviousActiveSpread.getSpreadView().OnSpreadLostActive();a.PreviousActiveSpread=null}if(!b)b=window.event;if(spreadView!=null&&!spreadView.OnSetTextBoxFocus(b))return;b&&$$.utils.cancelBubble(b,!$$.utils.isNativeControl(b.target));var c=a.FpActiveSpread;if(c!=null&&c.getAttribute("mcctCellType")=="true"){var g=FarPoint.System.WebControl.MultiColumnComboBoxCellType.GetMcctObject(c.id);g!=null&&g.getHostSpread()==element&&!g.getIsDrop()&&setActiveSpreadManually(element)}if(anchorCell!=null&&anchorCell.getAttribute("fpcelltype")=="ExtenderCellType"&&anchorCell.getAttribute("celltype2")=="NumericUpDownCellType"){var i=a.activeElement;isPressTABKeyFromOutSide&&scrollToCell(anchorCell,{IgnoreSyncScrollByCell:true});if(i!=null&&isChild(i,anchorCell)&&getEditor(anchorCell)!=null)return}detachOnActiveEvents();!editing&&textBoxActive(b);var d=spreadView.GetActiveSpreadView(false,true)||spreadView;c=d.Spread;var f=c.getAnchorCell(),e=d.GetSpreadContext();if(f!=null&&isPressTABKeyFromOutSide&&!d.IsPopupOpened()&&c.GetActiveChartObj()==null&&d.GetTabIndex()!="-1"){d.GetActiveSpread()==null&&d.ActivateSpread(c);var k=e.getEditor(f);if(k!=null&&spreadView.NeedSetEditorFocusOnActiveCell())e.setEditorFocus(k);else if(a.activeElement!=textBox){var j=e.getCell(a.activeElement);if(j!=null&&j!=f){var h=a.activeElement?e.getCell(a.activeElement):null;if(h&&getCellType(h)=="ExtenderCellType")setTimeout(function(){e.setTextBoxFocus()},0);else e.setTextBoxFocus()}}$$.utils.isElementHidden(element,element.document.body,true)&&element.scrollIntoView()}attachOnActiveEvents();if(!editing&&enableRowEditTemplate=="true"&&operationMode=="RowMode")editing=IsInRowEditTemplate(b.target)}function elementOnFocus(d){if(!spreadView.IsMultiColumnComboBox){var h=getTopSpread(element),f={spread:element,event:d,cancel:false};FarPoint.Web.Spread.CallBacks.topic(h.id).topic("Focus").publish(f);if(f.cancel)return}var g=lastEditingInfo&&lastEditingInfo.Editor.isIMEComposing;if(g){clearOldEditorValue();var b=spreadView.GetActiveSpread();if(b&&b!=element&&spreadView.GetTopSpreadView()!=b.getSpreadView().GetTopSpreadView())return}var a=getSpreadControl(d.target);if(a!=null&&a.spreadActive){var e=a.getSpreadView&&!a.getSpreadView().IsSpreadActive();a.spreadActive(d);e&=a.getSpreadView&&a.getSpreadView().IsSpreadActive();if(e&&!editing&&anchorCell!=null&&window.document.activeElement==textBox){var c=getEditor(anchorCell,true);c&&$$.utils.isTextControl(c)&&c.disabled&&fpSpreadJS.setImeMode(element,textBox,anchorCell)}}}function elementOnFocusOut(b){var a=b.target;if(a==textBox||!a||!$$.utils.isTextControl(a))return;if(a){if(!a.__autocomplete)a.__autocomplete=a.getAttribute("autocomplete");a.setAttribute("autocomplete","off")}!spreadView.EventHandlers.Has("focusin",a)&&spreadView.EventHandlers.Attach(new FarPoint.Web.Spread.EventHandler(a.id+"focusin","focusin",a,function(){if(a)if(a.__autocomplete!=null&&a.__autocomplete!=""){a.setAttribute("autocomplete",a.__autocomplete);a.__autocomplete=null}else a.removeAttribute("autocomplete")}));$$.utils.cancelBubble(b,false)}function attachOnActiveEvents(){setTimeout(function(){detachOnActiveEvents();if($$.browser.ie)for(var b=getAllSpreads(),a=0;a<b.length;a++){var c=b[a];typeof c.__attachOnActiveEvent!="undefined"&&c.__attachOnActiveEvent()}else{var d=getTopSpread();d.__attachOnActiveEvent()}},0)}function detachOnActiveEvents(){if($$.browser.ie)for(var b=getAllSpreads(),a=0;a<b.length;a++){var c=b[a];typeof c.__detachOnActiveEvent!="undefined"&&c.__detachOnActiveEvent()}else{var d=getTopSpread();d.__detachOnActiveEvent()}}function __attachOnActiveEvent(){if(textBox!=null)if($$.browser.ie){textBox.onactivate=null;textBox.onactivate=textBoxActive;element.onactivate=null;element.onactivate=spreadActive}else $element.on("focusin",elementOnFocus)}function __detachOnActiveEvent(){if(textBox!=null)if($$.browser.ie){textBox.onactivate=null;element.onactivate=null}else $element.off("focusin",elementOnFocus)}function endEditSpread(b){var a=getEditingSpread();return a!=null?a.EndEdit(b):true}function getEditingSpread(){for(var c=getAllSpreads(),b=0;b<c.length;b++){var a=c[b];if(typeof a.isEditing!="undefined"&&a.isEditing())return a}return null}function getAllSpreads(){var b=getTopSpread(element),a=[b];__getAllChildSpreads(b.id,a);return a}function __getAllChildSpreads(e,b){for(var c=GetChildSpreads(e),a=0;a<c.length;a++){var d=c[a];b.push(d);__getAllChildSpreads(d.id,b)}}function isEditModeReplace(b){var a=getCellType(b);return a=="ExtenderCellType"?false:element.getAttribute("EditMode")=="replace"}function setTextBoxFocus(raiseActiveEvent,event,args){if(spreadView!=null&&spreadView.IsSuspendFocusSpread()||$$.browser.webkit&&window.document.activeElement==textBox)return;if(textBox!=null&&textBox.ownerDocument!=null){!raiseActiveEvent&&detachOnActiveEvents();if(!args||!args.PreventUpdateLocation)if(isEndingEdit){var lastMouseDownEvent=spreadView.GetLastMouseDownEvent();if(lastMouseDownEvent&&!$$.utils.contains(spreadView.GetTopSpreadView().Spread,lastMouseDownEvent.target)){var docView={left:(window.innerWidth||window.clientWidth)/2,top:(window.innerHeight||window.clientHeight)/2};spreadView.UpdateTextBoxLocation(docView)}else spreadView.UpdateTextBoxLocation(anchorCell&&spreadView.IsViewportCell(anchorCell)?anchorCell:null,true)}else spreadView.UpdateTextBoxLocation(anchorCell&&spreadView.IsViewportCell(anchorCell)?anchorCell:null);var curActive=window.document.activeElement,cellType=getCellType(anchorCell);if(cellType=="MultiColumnComboBoxCellType"){var mccbId=getMccbID(anchorCell,element),obj=eval(mccbId+"_Obj"),input=obj?obj.getInputControl():null;if(input&&curActive!=input)curActive=input}var shouldRemoveReadOnly=$$.browser.webkit&&$$.utils.isCheckboxControl(textBox)&&$$.utils.isTextControl(curActive)&&curActive.getAttribute("readonly")!=null;if(!isJustClickOnGrayArea){spreadView.Style.BackupAndClear(textBox,"textIndent");if(shouldRemoveReadOnly){curActive.removeAttribute("readonly");textBox.focus();curActive.setAttribute("readonly","readonly")}else textBox.focus();setTimeout(function(){spreadView.Style.Restore(textBox,"textIndent")},0)}else setTimeout(function(){spreadView.Style.BackupAndClear(textBox,"textIndent");if(shouldRemoveReadOnly){curActive.removeAttribute("readonly");textBox.focus();curActive.setAttribute("readonly","readonly")}else textBox.focus();setTimeout(function(){spreadView.Style.Restore(textBox,"textIndent")},0)},0);if($$.browser.ieversion>=11){if(textBox.value=="123")textBox.value="456";else if(textBox.value=="456"||textBox.value=="")textBox.value="123";if(textBox==element.document.activeElement&&args&&args.ResetSelection)textBox.selectionStart=textBox.selectionEnd=0}!raiseActiveEvent&&attachOnActiveEvents()}}function getTextBox(){return textBox}function focus(d,r,b){if(spreadView&&!spreadView.OnSetTextBoxFocus(d||window.event))return;if(!b)b={};if(!b.Event)b.Event=d||window.event;var z=getTopSpread(element),l=$$.fn.createXMLDOMWrapper(z),h=l.selectSingleNode("root activechild");if(h!=null&&l.textContent(h)!=""){var g=element.document.getElementById(l.textContent(h));if(g!=null&&g!=element){g.focus(null,null,b);return}}var a=d||window.event||b.Event,q=element.document.FpActiveSpread;if(q!=null&&!q.IsValid())return;var j=a!=null&&element==getSpreadControl(a.target)&&isEditModeReplace(anchorCell)&&(typeof b.SelectText=="undefined"||b.SelectText);if(editing&&j){var v=a!=null&&a.type=="mouseup"&&spreadView.IsInTouchMode();needCheckSelectText=false;selectAllText(v);j=false}if(editing)return;if(a!=null&&(a.type=="mousedown"||a.type=="mouseup")){var w=getSpreadControl(a.target);if(w!=element)return;if(a.target.tagName=="INPUT"||$$.utils.isSelectControl(a.target,true)||a.target.tagName=="TEXTAREA")return}var k=a!=null?a.target:null;if(k!=null&&spreadView._IsGrayArea(k,null,true)){var e=getParent(getViewport());if(a&&a.type=="mousedown"&&k==e){var o=e.getBoundingClientRect(),t=e.clientHeight,u=e.clientWidth,x=a.clientX+element.document.documentElement.scrollLeft,y=a.clientY+element.document.documentElement.scrollTop;(y>o.top+t||x>o.left+u)&&setTextBoxFocus()}return}if(activeChartObj!=null){doClearSelection();element.ignoreVirtualPaging=true;activeChartObj.scrollChartIntoView();activeChartObj.Focus();element.ignoreVirtualPaging=false;return}var m=false;if(element.document.FpActiveSpread!=element){m=true;setActiveSpreadManually(element)}var n=getSelection(),s=!(isInTouchAjax()||spreadView.IsInTouchMode())||n==null||n.childNodes.length==0||element.getAttribute("SelectionPolicy")=="MultiRange",p=operationMode;if(anchorCell==null&&s&&p!="MultiSelect"&&p!="ExtendedSelect"&&GetRowCount()>0&&GetColCount()>0){setAnchorCellForFirstTime(a);if(anchorCell){fpSpreadJS.updateSelectionRangeFromCell(anchorCell);fpSpreadJS.keepGeneratedSelectionFromAnchorCell()}}if(element.document.FpActiveSpread==element&&m){paintSelections(true,r);paintAnchorCell()}if(b&&b.RaiseActivateEvent){var i=anchorCell&&spreadView.IsViewportCell(anchorCell)?getEditor(anchorCell):null;if(i!=null&&!IsInRowEditTemplate(i)&&spreadView.NeedSetEditorFocusOnActiveCell()){var c=getEditor(anchorCell);c!=null&&updateEditingInfo(c);setEditorFocus(i)}else setTextBoxFocus(true)}else{var c=null,f=b==null?false:!b.FocusEditor&&b.FocusSpreadOnly;if((typeof b.FocusEditor=="undefined"||b.FocusEditor)&&anchorCell!=null){c=spreadView._GetViewportFromCell(anchorCell,false)!=null?getEditor(anchorCell):null;if(c!=null&&(d==null||(d.type=="mouseup"||spreadView.Touch&&spreadView.Touch.IsClickSimulating)&&c.getAttribute("Extenders")==null||editing)){if(spreadView.IsShowEditor(anchorCell)&&isChild(element.document.activeElement,anchorCell))c=null}else{c=null;f=true}}if(!$$.browser.webkit||!spreadView.EditModePermanent||window.document.activeElement!=textBox&&!$$.utils.contains(element,window.document.activeElement,true))if(c!=null||f){setTextBoxFocus(null,null,{PreventSwitchKeyboard:true});!ignoreEditorFocus&&!f&&spreadView.NeedSetEditorFocusOnActiveCell()&&setEditorFocus(c)}}j&&spreadView.NeedSetEditorFocusOnActiveCell()&&selectAllText();spreadView.GetCommandBar().UpdateCopyCutPaste()}function setAnchorCellForFirstTime(f){if(!anchorCell)anchorCell=findAnchorCell();if(anchorCell)return true;var k=GetColCount(),l=GetRowCountInternal(),e=f&&f.type=="keydown"&&f.keyCode==tab,a,b;if(spreadView.IsInTouchMode()){var d=spreadView.SelectionModel._GetFocusRange();if(d==null){a=0;b=0}else{a=d.top;b=d.left}}else{var j=needScrollToTopRow?spreadView.GetAttribute("topRow"):null;a=getNextCellRowIndex(0,0,e,true);if(a>=frzRows&&j!=null){var i=frzRows+spreadView._GetKeyedTableRowIndex(j,true);if(a<i)a=getNextCellRowIndex(i,0,e,true)}b=getNextCellColIndex(0,0,e,true)}if(a<l&&b<k){var g=fireActiveCellChangingEvent(a,b,element,0),c=getTopSpread(element);if(!g)if(c!=element)g=c.fireActiveCellChangingEvent(a,b,element,0);if(!g){element.inDesign&&doClearSelection();var h=!element._processingFilterBarCommand;leadingCellCol=b;leadingCellRow=a;h&&updateAnchorCell(leadingCellRow,leadingCellCol);spreadView.GetCommandBar().UpdateCopyCutPaste();spreadView.GetCommandBar().EnableButton("Update",true);if(h){fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0);c!=element&&c.fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0)}}}}function GetTotalRowCount(){return parseInt(element.getAttribute("totalRowCount"))}function GetPageCount(){return parseInt(element.getAttribute("pageCount"))}function GetColCount(){return frzCols+parseInt(element.ColCount)}function GetRowCount(){return rowCount}function GetRowCountInternal(){return frzRows+parseInt(element.RowCount)}function IsChildSpreadRow(a,b){return FpSpreadJS.isChildSpreadRow(a,b)}function GetChildSpread(e,c){var b=getViewport();if(b!=null){var a=GetDisplayIndex(e)+1;if(typeof c=="number")a+=c;if(a>=0&&a<b.rows.length)if(b.rows[a].cells.length>0&&b.rows[a].cells[0]!=null&&b.rows[a].cells[0].children.length>0){var d=$$.j(b.rows[a].cells[0]).children().first().get(0);if(d.getAttribute("FpSpread")=="Spread")return d}}return null}function GetChildSpreads(b){var a=element.document;if(!a.getElementById)a=window.document;var c=b==null?element:a.getElementById(b);return c==null?[]:FpSpreadJS.getChildViews(c)}function GetDisplayIndex(a){return fpSpreadJS.getDisplayIndex(a)}function GetSheetIndex(b,a){return a!=null&&getViewport()!=a?getSpreadControl(a,true).GetSheetIndex(b):fpSpreadJS.getSheetIndex(b)}function GetParentRowIndex(){var c=getParentSpread();if(c==null)return-1;var b=window.document.getElementById(c.id+"_viewport");if(b==null)return-1;for(var d=element.parentElement.parentElement,a=d.rowIndex-1;a>0;a--)if(IsChildSpreadRow(b,a))continue;else break;return GetSheetIndex(a,b)}function SizeToFit(a,d,g){if(a==null||a<0)a=0;var h=getViewport();if(h!=null){for(var j=createTestBox(),b=0,k=GetRowCountInternal(),c=0;c<k;c++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(h,c))continue;var f=getCellFromRowCol(c,a);if(d)f=getHeaderCellFromRowCol(c,a,false);if(f.colSpan>1)continue;var i=spreadView._getPreferredCellWidth(f,j);if(i>b)b=i}var e=false;if(d)e=setRowHeaderColWidth(a,b,true);else e=setColWidth(a,b,null,true);(g==null||g)&&spreadView.UpdateUI();e&&fireColWidthChangedEvent(d,a,b)}}function getPreferredCellWidth(c,a){if(a==null)a=createTestBox();var b=getRender(c),f=getCellType(c),q=getEditor(c);if(b!=null){var d=$$.j(b);a.style.fontFamily=d.css("fontFamily");a.style.fontSize=d.css("fontSize");a.style.fontWeight=d.css("fontWeight");a.style.fontStyle=d.css("fontStyle")}a.style.width="";if(b!=null&&$$.utils.isSelectControl(b)){for(var i="",h=0;h<b.children.length;h++){var g=b.children[h];if(xmlData.textContent(g)!=null&&xmlData.textContent(g).length>i.length)i=xmlData.textContent(g)}a.innerHTML=i}else if(b!=null&&b.tagName=="INPUT")if(b.type=="submit")a.innerHTML=b.outerHTML;else a.innerHTML=b.value;else{var p=c.getElementsByTagName("TABLE");if(p!=null&&p.length>0)a.style.width="20px";if(c.getAttribute("FpCellType")=="ExtenderCellType"&&b!=null&&b.getAttribute("cfContentBound")==null&&c.getElementsByTagName("DIV").length>0){var n=getEditor(c),o=getFunction("ExtenderCellType_getEditorValue");if(n!=null&&o!=null)a.innerHTML=o(n)}else if(b!=null&&b.tagName!="TABLE")a.innerHTML=b.innerHTML;else a.innerHTML=c.innerHTML}if(b!=null&&f=="MultiColumnComboBoxCellType"){var k=a.getElementsByTagName("Table")[0];if(k!=null){k.style.tableLayout="";a.style.width=a.offsetWidth+3+"px"}}if(b!=null&&f=="ListBoxCellType"){var l=a.getElementsByTagName("Table")[0];if(l!=null){l.style.width="";a.style.width=""}}if(b!=null&&f=="RadioButtonListCellType"){var j=a.getElementsByTagName("Table")[0];if(j!=null){j.style.width="";a.style.width=""}}var m=$$.j(c),e=a.offsetWidth+4;if(!xhtml)e+=parseInt(m.css("paddingLeft"))+parseInt(m.css("paddingRight"));e+=3;if(b!=null&&$$.utils.isSelectControl(b))e+=24;a.innerHTML="";return e}function getGroupBar(){if(groupBar==null)groupBar=window.document.getElementById(element.id+"_groupBar");return groupBar}function getHierBar(){if(hierBar==null)hierBar=window.document.getElementById(element.id+"_hierBar");return hierBar}function getPager1(){if(pager1==null)pager1=window.document.getElementById(element.id+"_pager1");return pager1}function getPager2(){if(pager2==null)pager2=window.document.getElementById(element.id+"_pager2");return pager2}function getPagers(a){if(a==null)return[];var b=[a.getPager1?a.getPager1():element.document.getElementById(a.id+"_pager1"),a.getPager2?a.getPager2():element.document.getElementById(a.id+"_pager2")];$$.utils.cleanArray(b);return b}function getDummy(){if(dummy==null)dummy=window.document.getElementById(element.id+"_dummy");return dummy}function getViewportHolder(){if(vpholder==null)vpholder=window.document.getElementById(element.id+"_vpholder");return vpholder}function getMaxCellHeight(b){for(var c=0,a=0;a<b.cells.length;a++)if(b.cells[a].rowSpan==1&&b.cells[a].style.display!="none"){var d=b.cells[a].offsetHeight;if(d>c)c=d}return c}function getFirstNonSpanCell(b){var a=null;if(b.cells.length>0){a=b.cells[0];var c=1;while(a.rowSpan>1&&c<b.cells.length){a=b.cells[c];c++}if(a.rowSpan>1)a=null}return a}function skipRowSpan(b){for(var c=false,a=0;a<b.cells.length;a++)if(b.cells[a].rowSpan>1&&b.cells[a].style.display!="none"||c){b.cells[a].savedRowSpan=b.cells[a].rowSpan;b.cells[a].rowSpan=1}}function restoreRowSpan(b){for(var a=0;a<b.cells.length;a++)if(b.cells[a].savedRowSpan!=null){b.cells[a].rowSpan=b.cells[a].savedRowSpan;b.cells[a].savedRowSpan=null}}function sync2Tables(a,b,g,i,c){if((a==null||b==null)&&!c||c&&a==null&&b==null)return;var e=current,d=a!=null?a.rows.length:0;if(b!=null){if(a!=null&&a==getCorner()&&d!=b.rows.length&&spreadView.HasFilterBar()){if(a.rows.length>0)a.rows[0].style.height="";return}if(smartPaint&&a==getRowHeader())d=Math.min(currentCount,b.rows.length);else d=Math.min(d,b.rows.length);if(e<0)e=0}else e=0;var h=a==getCorner();c&&restoreSynDelt([a,b],-1);if(a!=null&&b!=null)for(var f=0;f<d;f++)if(!h)synRowHeight(a,b,e+f,g,i,c);else synRowHeight(a,b,f,g,false,c)}function sync3Tables(a,b,c,f,d){if(ignoreSynRowHeight)return;if(a==null&&b==null&&c==null)return;var e=a==getRowHeader()||a==getFrozRowHeader();if(a==null){e=b==getRowHeader()||b==getFrozRowHeader();sync2Tables(b,c,f,e,d)}else if(b==null)sync2Tables(a,c,f,e,d);else if(c==null)sync2Tables(a,b,f,e,d);else{var h=[a,b,c],i=current,j=a.rows.length;if(smartPaint&&(a==getRowHeader()||c==getViewport()))j=Math.min(currentCount,c.rows.length);else i=0;if(d)restoreSynDelt(h,-1);else for(var g=0;g<j;g++)syncRowsHeight(h,i+g,f,e,d)}}function syncRowsHeight(d,e,u,w,f){for(var g=-Number.MAX_VALUE,l=Number.MAX_VALUE,m=[],b=0;b<d.length;b++){var k=d[b],a=k.rows[e];if(a==null)return;l=Math.min(l,k.rows.length);var c=getFirstNonSpanCell(a);if(!f&&a.synDelt!=null){if(c!=null&&c.style.height!="")c.style.height=Math.max($$(c).height()-a.synDelt,0)+"px";if(a.style.height!="")a.style.height=Math.max($$(a).height()-a.synDelt,0)+"px";a.synDelt=null}!f&&c!=null&&setElementHeight(c,Math.max(0,c.offsetHeight));setElementHeight(a,Math.max(0,a.offsetHeight));m[b]=getRowOffsetTop(a,k);g=Math.max(g,a.offsetHeight+m[b])}for(var j=-Number.MAX_VALUE,t=0;t<2;t++){for(var b=0;b<d.length;b++){var k=d[b],a=k.rows[e],c=getFirstNonSpanCell(a),h=m[b],i=Math.max(0,g-h);a.style.height=i+"px";if(!f&&c!=null){var p=a.offsetHeight;c.style.height=i+"px";if(a.offsetHeight>p)c.style.height=i-(a.offsetHeight-p)+"px"}c!=null&&(!f||c.style.height.length>0)&&setElementHeight(c,i);setElementHeight(a,Math.max(0,g-h));j=Math.max(j,a.offsetHeight+h)}if(j==g)break;g=j}if(e<l-1){for(var n=getRowOffsetTop(d[0].rows[e+1],d[0]),q=false,b=1;b<d.length;b++){var a=d[b].rows[e+1],h=getRowOffsetTop(a,d[b]);if(n>h){n=h;q=true}}if(q)for(var b=0;b<d.length;b++){var a=d[b].rows[e],v=d[b].rows[e+1],o=getRowOffsetTop(v,d[b])-n;if(o>0){var c=getFirstNonSpanCell(a);!f&&c!=null&&setElementHeight(c,c.offsetHeight-o);setElementHeight(a,a.offsetHeight-o)}}}for(var a,c,b=0;b<d.length;b++){a=d[b].rows[e];if(f&&a.synDelt!=null)continue;c=getFirstNonSpanCell(a);if(c!=null&&(!f||c.style.height.length>0))c.style.height=$$(c).height()+1+"px";a.style.height=$$(a).height()+1+"px";a.synDelt=1}for(var b=0;b<d.length;b++)if(!xhtml&&d[b].rows[e]!=null){var r=$$(d[b].rows[e]);r.height()<0&&r.height(0)}if(u){var s=getParentSpread();s!=null&&s.UpdateRowHeight(element)}}function getRowOffsetTop(a,b){if(a==null)return 0;if($$.featureDetector.IsLeftTopBorderStyle){if(b==null)b=a.parentNode.tagName=="TBODY"?a.parentNode.parentNode:a.parentNode;return a.getBoundingClientRect().top-b.getBoundingClientRect().top}else return a.offsetTop}function restoreSynDelt(a,c){if(a.length>0)if(Object.prototype.toString.call(a[0]).slice(8,-1)=="Array")for(var b=0;b<a.length;b++){$$.utils.cleanArray(a[b]);_restoreSynDelt(a[b],c)}else _restoreSynDelt(a,c)}function _restoreSynDelt(e,h){$$.utils.cleanArray(e);for(var l=e.length,p=Number.MAX_VALUE,g=getViewport(),k=false,a=0;a<e.length;a++)if(e[a]==g){k=true;break}k&=g!=null&&fpSpreadJS.childViewIndexes.length>0;var s=$$.browser.quirksMode;if(typeof h!="undefined")if(h==-1)for(var b=0;b<l;b++)for(var d=e[b],a=0;a<d.rows.length;a++){var c=d.rows[a];if(c.synDelt!=null){var n=k&&FpSpreadJS.isChildSpreadRow(g,a);if(n)continue;var m=getFirstNonSpanCell(c);if(m!=null)m.style.height="";c.style.height=$$(c).height()-c.synDelt+"px";c.synDelt=null}}else for(var b=0;b<l;b++){var d=e[b];if(d.rows[h].synDelt!=null){var n=k&&FpSpreadJS.isChildSpreadRow(g,a);if(n)continue;d.rows[h].style.height=$$(d.rows[h]).height()-d.rows[h].synDelt+"px";d.rows[h].synDelt=null}}for(var b=0;b<l;b++){var d=e[b];p=Math.min(d.rows.length,p)}for(var i=[],f=[],b=0;b<l;b++){var d=e[b],j=d.rows;if(j.length==0)continue;for(var a=0;a<p;a++){var c=j[a],q=j[a].synDelt==null?null:j[a].synDelt,o=q==null;if(o)q=0;var n=k&&FpSpreadJS.isChildSpreadRow(g,a),r=Math.max($$(c).height()-q,0);if(i.length<=a){i.push(r);if(n)f.push(Math.max(0,g.rows[a].cells[0].children[0].offsetHeight+1));else f.push(Math.max(0,c.offsetHeight+(o?1:0)))}else{i[a]=Math.max(i[a],r);if(n)f[a]=Math.max(f[a],Math.max(0,g.rows[a].cells[0].children[0].offsetHeight+1));else f[a]=Math.max(f[a],Math.max(0,c.offsetHeight+(o?1:0)))}if(o)j[a].synDelt=1}}for(var b=0;b<l;b++)for(var d=e[b],j=d.rows,a=0;a<p;a++){var c=j[a];if(c.synDelt!=null){if(i[a]==f[a])continue;c.style.height=Math.max(i[a],f[a])+"px";var m=getFirstNonSpanCell(c);if(m!=null)m.style.height=""}}}function setTableRowHeight(a,d,e,f){var b=getFirstNonSpanCell(a);if(b!=null){var c=d-a.offsetTop-f;b.style.height=c+"px";if(getOffsetHeight(a)+a.offsetTop>d){c-=getOffsetHeight(a)+a.offsetTop-d;b.style.height=c+"px"}if(e&&$$(b).height()<getOffsetHeight(a)){var g=b.innerHTML;b.innerHTML="";b.innerHTML=g}}else{var c=d-a.offsetTop;a.style.height=c+"px";if(getOffsetHeight(a)+a.offsetTop>d){c-=getOffsetHeight(a)+a.offsetTop-d;a.style.height=c+"px"}}}function synRowHeight(a,b,f,d,e,c){if(a==null||b==null)return;syncRowsHeight([a,b],f,d,e,c)}function setElementHeight(a,b){if(a.offsetHeight==b)return;a.style.height=b+"px";var c=null;while(a.offsetHeight>b){c=a.offsetHeight;var d=parseInt(a.style.height)-(a.offsetHeight-b);a.style.height=Math.max(1,d)+"px";if(d<1||a.offsetHeight==c)break}while(a.offsetHeight<b){c=a.offsetHeight;var d=parseInt(a.style.height)+1;a.style.height=d+"px";if(d>b||a.offsetHeight==c)break}return a.offsetHeight}function getMaxRowSpanInRow(a){if(a==null)return 0;for(var c=1,b=0;b<a.cells.length;b++)if(a.cells[b].rowSpan>1&&a.cells[b].rowSpan>c)c=a.cells[b].rowSpan;return c}function getOffsetHeight(a){for(var c=a.offsetHeight,e=false,b=0;b<a.cells.length;b++)if(a.cells[b].rowSpan==1){c=a.cells[b].offsetHeight;e=true;break}if(!e)if(a.cells.length>0){var d=window.document.createElement("td");a.insertBefore(d,a.cells[0]);c=d.offsetHeight;a.removeChild(d)}return c}function setRowHeaderColWidth(a,b,m){var k=false,j=getRowHeader(),c=getCorner();if(j==null)return false;if(b>element.clientWidth)b=Math.max(element.clientWidth-10,10);var h=[getCorner(),getFrozRowHeader(),getRowHeader(),getFooterCorner()];$$.utils.cleanArray(h);restoreTableWidth(h);var f=getColGroup(j),l=a;if(element.getAttribute("layoutMode")&&f&&parseInt(a)>=f.children.length)a=f.children.length-1+"";var g=b-parseInt(f.children[a].width);frozRowHeader&&setTableColumnWidth(frozRowHeader,a,b,true);setTableColumnWidth(j,a,b,true);if(c!=null)if(spreadView.Corner.AllowTableCorner)setTableColumnWidth(c,a,b,true);else{c.parentNode.style.width=$$(c.parentNode).width()+g+"px";if(c.style.width!="")c.style.width=$$(c).width()+g+"px"}var d=getFooterCorner();if(d!=null){d.parentNode.style.width=$$(d.parentNode).width()+g+"px";if(d.style.width!="")d.style.width=$$(d).width()+g+"px"}fixMissedColumns(h,a);if(m){syncRowRange(-1,-1,true);syncRowRangeSafeMode(-1,-1,false);syncRowRange(-1,-1,false,true);sizeSpread(true)}if(element.getAttribute("layoutMode")&&l)a=l;var i=addColInfo(a,true);if(i!=null){xmlData.switchNodeContext(i);var e=xmlData.selectSingleNode("width");xmlData.resetNodeContext();if(e==null){e=xmlData.createElement("width");i.appendChild(e)}var n=xmlData.textContent(e);k=n!=b;xmlData.textContent(e,b)}spreadView.GetCommandBar().EnableButton("Update",true);dirty=true;return k}function setColHeaderRowHeight(c,d,i,g){var b=getColHeader();if(b==null)return;var h=b.rows[c];h.style.height=d+"px";if(b.__bkStyleHeight==null)b.__bkStyleHeight=b.style.height;b.style.height="";var a=getFrozColHeader();if(a!=null){h=a.rows[c];h.style.height=d+"px";if(a.__bkStyleHeight==null)a.__bkStyleHeight=a.style.height;a.style.height=""}if(i){syncRowRange(c.rowIndex,c.rowIndex,true);sizeSpread(true)}b.style.height=b.__bkStyleHeight;if(a!=null){a.style.height=a.__bkStyleHeight;a.__bkStyleHeight=null}b.__bkStyleHeight=null;var f=addRowInfo(c,true);if(f!=null){xmlData.switchNodeContext(f);var e=xmlData.selectSingleNode("height");xmlData.resetNodeContext();if(e==null){e=xmlData.createElement("height");f.appendChild(e)}if(g!=null&&g.synDelt!=null)d-=g.synDelt;xmlData.textContent(e,d)}spreadView.GetCommandBar().EnableButton("Update",true);dirty=true}function EnsureRowHeight(a){var b=a;if(getViewport1()!=null)b=a-frzRows;if(getViewport0()!=null&&getViewport1()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getViewport0(),getViewport1(),a,false,false);synRowHeight(getViewport0(),getViewport1(),a,false,false)}if(getViewport()!=null&&getViewport2()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getViewport2(),getViewport(),b,false,false);synRowHeight(getViewport2(),getViewport(),b,false,false)}if(getFrozRowHeader()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getFrozRowHeader(),getViewport1(),a,false,true);synRowHeight(getFrozRowHeader(),getViewport0(),a,false,true)}if(getRowHeader()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getRowHeader(),getViewport(),b,false,true);synRowHeight(getRowHeader(),getViewport2(),b,false,true)}if(getViewport0()!=null&&getViewport1()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getViewport0(),getViewport1(),a,false,false);synRowHeight(getViewport0(),getViewport1(),a,false,false)}if(getViewport()!=null&&getViewport2()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getViewport2(),getViewport(),b,false,false);synRowHeight(getViewport2(),getViewport(),b,false,false)}if(getFrozRowHeader()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getFrozRowHeader(),getViewport1(),a,false,true);synRowHeight(getFrozRowHeader(),getViewport0(),a,false,true)}if(getRowHeader()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getRowHeader(),getViewport(),b,false,true);synRowHeight(getRowHeader(),getViewport2(),b,false,true)}}function cleanElementsStyle(e,b,c){if(e==null||e.length==0||typeof b=="undefined"||b==null)return;var h=typeof c=="function";if(c==null)c="";for(var d=null,f=0;f<e.length;f++){d=e[f];for(var g=[],a=0;a<b.length;a++){d.setAttribute("__bkStyle"+b[a],d.style[b[a]]);g.push(h?c(d,b[a]):c)}for(var a=0;a<b.length;a++)d.style[b[a]]=g[a]}}function restoreElementsStyle(c,a){if(c==null||c.length==0||typeof a=="undefined"||a==null)return;for(var d=null,f=null,e=0;e<c.length;e++){d=c[e];for(var b=0;b<a.length;b++){f=d.getAttribute("__bkStyle"+a[b]);d.style[a[b]]=f;d.removeAttribute("__bkStyle"+a[b])}}}function cleanTablesStyle(b,a){var c=getSpreadTables();cleanElementsStyle(c,b,a)}function restoreTablesStyle(a){var b=getSpreadTables();restoreElementsStyle(b,a)}function getSpreadTables(){var a=[getCorner(),getFrozColHeader(),getColHeader(),getFrozRowHeader(),getRowHeader(),getViewport0(),getViewport1(),getViewport2(),getViewport(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(a);return a}function EnsureAllRowHeights(a){cleanTablesStyle(["height"]);sync3Tables(getFrozRowHeader(),getViewport0(),getViewport1(),false,a);var h=getViewport();sync3Tables(getRowHeader(),getViewport2(),h,false,a);a&&frzRows==0&&$$.browser.quirksMode&&syncRowRange(0,0);sync2Tables(getFrozColFooter(),getColFooter(),false,false,a);var d=getCorner(),b=getColHeader(),c=getFrozColHeader();if(d!=null){var f=b||c;if(d.getAttribute("allowTableCorner")!=null){sync3Tables(d,c,b,false,a);sync3Tables(d,c,b,false,a)}else{sync2Tables(c,b,false,false,a);sync2Tables(c,b,false,false,a);spreadView.HasFilterBar()&&spreadView.SyncCornerWithFilterBar(d,f)}}else sync2Tables(c,b,false,false,a);if(getViewport()!=null){var e=getViewport(),g=e.align;e.align="middle";e.align=g}restoreTablesStyle(["height"])}function SuspendLayout(){bSuspendLayout=true}function ResumeLayout(e,d){bSuspendLayout=false;if(e){var b=[getFrozColHeader(),getColHeader(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(b);for(var a=0;a<b.length;a++){var c=b[a];c.__bkStyleHeight=c.style.height}syncRowRangeSafeMode(-1,-1);syncRowRange(-1,-1,true);syncRowRange(-1,-1,false,true);sizeSpread(true);for(var a=0;a<b.length;a++){var c=b[a];c.style.height=c.__bkStyleHeight;c.__bkStyleHeight=null}(d==null||d)&&spreadView.UpdateUI()}}function processResize(f){try{if(spreadView==null)return;var c=false;if(element.oldHeight==null){element.oldHeight=element.offsetHeight;c=true}else if(element.oldHeight!=element.offsetHeight){var d=getParentSpread();if(d!=null&&d.initialized){element.oldHeight=element.offsetHeight;d.UpdateRowHeight(element)}c=true}if(getViewport()!=null&&getViewport().parentElement!=null&&!getTopSpread(element).resizing){f&&f.type=="resize"&&$element.removeData("style.lastHeight");sizeSpread(true);var a=getViewport2();if(a){var e=a.style.position;a.style.position="";var b=a.offsetWidth-parseInt(a.cellSpacing);if(a!=null&&$$(a.parentElement).width()!=b)a.parentElement.style.width=b+"px";a.style.position=e}a=getViewport0();if(a){var e=a.style.position;a.style.position="";b=a.offsetWidth-parseInt(a.cellSpacing);if(a!=null&&$$(a.parentElement).width()!=b)a.parentElement.style.width=b+"px";a.style.position=e}}if(element.oldHeight!=element.offsetHeight||element.oldWidth!=element.offsetWidth)c=true;if(c){element.oldHeight=element.offsetHeight;element.oldWidth=element.offsetWidth;spreadView!=null&&spreadView.OnSizeChanged()}}catch(g){$$.DEBUG.Log(g,"processResize")}}function backUpStyleSetting(){var b=false;ignorePropertyChanged=true;var a=element;while(a!=null&&a!=element.document&&a!=element.document.body){if(a.style.display=="none"){a.displaySetting=a.style.display;a.style.display="";b=true}else if($$.j(a).css("display")=="none"){a.displaySetting="";a.style.display="block";b=true}a=a.parentNode}ignorePropertyChanged=false;return b}function restoreStyleSetting(){ignorePropertyChanged=true;var a=element;while(a!=null&&a!=element.document&&a!=element.document.body){if(a.displaySetting!=null&&a.displaySetting!="null"){a.style.display=a.displaySetting;a.displaySetting=null}a=a.parentNode}ignorePropertyChanged=false}function backupTablePositions(f){if(!$$.browser.ie)return null;for(var c=arguments.length>1?arguments:f,d=[],b=0;b<c.length;b++){var a=c[b];if(a!=null){var e={table:a,position:null};d.push(e);if(a.offsetWidth<=1){e.position=a.style.position;a.style.position=""}}}return d}function restoreTablePositions(a){if(!$$.browser.ie||!a)return;for(var c=0;c<a.length;c++){var b=a[c];if(b.position!=null)b.table.style.position=b.position}}function getChildSpreadOffsetWidth(b){if(typeof b=="undefined"||b==null)return 0;var e=0,f=0,a=element.document;if(!a.getElementById)a=window.document;var h=a.getElementById(b.id+"_rowHeader"),i=a.getElementById(b.id+"_viewport"),g=backupTablePositions(h,i),c=a.getElementById(b.id+"_corner");if(c!=null)e=parseInt(c.offsetWidth);c=a.getElementById(b.id+"_rowHeader");if(c!=null)e=Math.max(e,parseInt(c.offsetWidth));var d=a.getElementById(b.id+"_colHeader");if(d!=null)f=parseInt(d.offsetWidth);d=a.getElementById(b.id+"_viewport");if(d!=null)f=Math.max(f,parseInt(d.offsetWidth));restoreTablePositions(g);return e+f}function prepairSpreadLayout(){for(var b=[getViewport(),getViewport0(),getViewport1(),getViewport2()],d=[],c=[],e=null,g=0,j=0,i=0,a=0;a<b.length;a++)if(b[a]!=null)for(var f=0;f<b[a].rows.length;f++){e=getFirstNonSpanCell(b[a].rows[f]);if(e!=null){g=e.clientHeight;var h=$$.j(e);j=parseInt(h.css("paddingTop"));i=parseInt(h.css("paddingBottom"));g-=j+i;d.push(g);c.push(e)}else{d.push(b[a].rows[f].clientHeight);c.push(b[a].rows[f])}}for(var a=0;a<c.length;a++)if(d[a]>0)c[a].style.height=d[a]+"px";d=null;c=null}function syncRowHeaderWidth(){return}function setResizingFlag(b){var a=getTopSpread(element);if(b)a.resizing=true;if(a.resizePending==null)a.resizePending=0;if(b)a.resizePending=a.resizePending+1;else a.resizePending=Math.max(0,a.resizePending-1);if(!b&&a.resizePending==0){var c=element.offsetHeight;a.resizing=false}}function sizeSpread(l,g,a){if(!a)a={};spreadView.SuspendAction(element,GCWS.Actions.OBSERVER);var e=false,b=element.document.activeElement;if($$.browser.ieversion>10&&editing&&b==editor&&b!=null&&$$.utils.isSelectControl(b)&&b.size>1&&$$.utils.contains(anchorCell,b)){var c=parseInt(b.style.height);if(!isNaN(c)&&b.offsetHeight<b.parentNode.offsetHeight){b.style.height=c-1+"px";e=true}}var m=getParentSpread(),f=m==null?spreadView.IsClientAutoSize()&&(spreadView.ClientAutoSizeMaxWidth()!=0||spreadView.ClientAutoSizeMaxHeight()!=0):false;if(f){if(!a)a={};a.AutoSizeWidth=a.AutoSizeHeight=-1;a.IgnoreAutoSize=false}setResizingFlag(true);_sizeSpread(l,g,a);setResizingFlag(false);if(f){var d=getScrollvp()||getViewport().parentNode,j=parseInt(element.style.width),h=parseInt(element.style.height);if(d.offsetHeight==d.clientHeight&&a.AutoSizeHeight<h&&a.AutoSizeHeight>-1||d.offsetWidth==d.clientWidth&&a.AutoSizeWidth<j&&a.AutoSizeWidth>-1){element.onresize=null;if(a.AutoSizeHeight<h)element.style.height=a.AutoSizeHeight+"px";if(a.AutoSizeWidth<j){element.style.width=a.AutoSizeWidth+"px";var i=getTitleBar()||getSubTitleBar();if(i!=null){var k=$$(i).getParent("TABLE");k.style.width=k.parentElement.clientWidth+"px"}}element.onresize=processResize;a.IgnoreAutoSize=true;_sizeSpread(true,g,a)}}if(e&&editing&&editor!=null){var c=parseInt(editor.style.height);if(!isNaN(c))editor.style.height=c+1+"px"}spreadView.ResumeAction(element,GCWS.Actions.OBSERVER)}function shouldIgnoreSizeSpread(){return bSuspendLayout||viewport==null?true:($$(element).height()==0||$$(element).width()==0)&&element.getAttribute("hostspread")!=null?true:element.isSizeSpread==true?true:element.offsetWidth==0||element.offsetHeight==0?true:false}function adjustCornerWithFilterBar(){if(colHeader!=null&&colHeader.rows.length>0&&corner!=null&&corner.getAttribute("allowTableCorner")==null&&parseInt(corner.cellSpacing)==0){var b=colHeader.rows.length-1,a=null;while(b>=0){if(colHeader.rows[b].getAttribute("FpSpread")=="fb"){a=colHeader.rows[b];break}b--}if(a!=null&&a.rowIndex!=0){var c=corner.rows[0].cells[0];c.style.height="";c.style.paddingBottom=a.offsetHeight+"px"}}}function layoutNoRowElements(){if(uiVirtualization||GetRowCountInternal()>0){var c=backupTablePositions(viewport0,viewport1),a=0;if(frozColHeader!=null)a=frozColHeader.offsetWidth-parseInt(frozColHeader.cellSpacing);var b=getNoRow(0);if(b!=null)b.style.width=a+"px";if(viewport0!=null)a=Math.max(a,viewport0.offsetWidth-parseInt(viewport0.cellSpacing));b=getNoRow(2);if(b!=null)b.style.width=a+"px";a=0;if(colHeader!=null){var d=colHeader;a=d.offsetWidth}b=getNoRow(1);if(b!=null)b.style.width=a+"px";if(viewport1!=null)a=Math.max(a,viewport1.offsetWidth);b=getNoRow(-1);if(b!=null)b.style.width=a+"px";restoreTablePositions(c)}}function _sizeSpread(x,o,e){if(shouldIgnoreSizeSpread())return;element.isSizeSpread=true;syncMsgs();var D=viewport.parentNode.scrollLeft,A=backupTablePositions(viewport0,viewport1,viewport2,viewport),k=getParentSpread();layoutNoRowElements();var z=element.getAttribute("ClientAutoSize")=="True",j=null;if(!e||!e.IgnoreAutoSize){j=updateAutoSize();if(e){e.AutoSizeWidth=j.AutoSizeWidth;e.AutoSizeHeight=j.AutoSizeHeight}z=j.restrictAutoSize?false:z}var p=getColGroup(topTable);needFixMissedColumns=e!=null&&e.NeedFixMissedColumns;needFixMissedColumns&&fixMissedColumns();adjustCornerWithFilterBar();var c=0,m=spreadView.Corner.AllowTableCorner,a=[frozRowHeader,rowHeader];$$.utils.cleanArray(a);if(a.length>0&&spreadView.RowHeader.IsVisible()){corner&&m&&a.push(corner);for(var r=true,b=0;b<a.length;b++){c=Math.max(a[b].offsetWidth,c);r&=a[b].rows.length==0}if(corner)c=r?corner.parentNode.offsetWidth+parseInt(spreadView.CellSpacing):c;corner&&!m&&a.push(corner);if(footerCorner){c=r&&corner==null?footerCorner.parentNode.offsetWidth+parseInt(spreadView.CellSpacing):c;a.push(footerCorner)}for(var b=0;b<a.length;b++){a[b].style.width=c+"px";a[b].parentNode.style.width=c-(c>0?spreadView.CellSpacing:0)+"px"}p.children[0].width=c-(c>0?spreadView.CellSpacing:0);if(c>0)c-=spreadView.CellSpacing}var g=0;a=[frozColHeader,viewport0,viewport2];$$.utils.cleanArray(a);if(a.length>0){for(var b=0;b<a.length;b++)g=Math.max(a[b].offsetWidth,g);frozColFooter&&a.push(frozColFooter);for(var b=0;b<a.length;b++)a[b].parentNode.style.width=g-(g>0?spreadView.CellSpacing:0)+"px";var B=frozRowHeader||rowHeader||corner?1:0;p.children[B].width=g-(g>0?spreadView.CellSpacing:0);var E=window.document.getElementById(element.id+"_hidencol2");E.style.width=p.children[B].width+"px";if(g>0)g-=spreadView.CellSpacing}var y=element.clientWidth-c-g;if(x==null||x==false){if(o)try{syncChildViewColumnRange(element,-1,-1)}catch(F){$$.DEBUG.Log(F,"An exception is thrown when synchronize child view columns")}EnsureAllRowHeights(o)}var d=element.clientHeight,t=$element.data("style.lastHeight"),w=false,i=element.style.height;if(i=="")i=$$(element).style("height");if(i.indexOf("%")!=-1){var u=$element.data("style.lastPercentageHeight");if(u==null||u!=i){$element.data("style.lastPercentageHeight",i);if(element.style.pixelHeight)d=element.style.pixelHeight;else d=parseFloat(i)*d/100;w=true}else if(t)d=t}if(commandBar!=null)d-=commandBar.offsetHeight;if(hierBar!=null)d-=hierBar.offsetHeight;if(groupBar!=null)d-=groupBar.offsetHeight;if(spreadView.Pager.IsVisible())d-=spreadView.Pager.GetHeight();if(getTitleBar()!=null)d-=getTitleBar().offsetHeight;if(getSubTitleBar()!=null)d-=getSubTitleBar().offsetHeight;var l=0;a=[frozColHeader,colHeader];$$.utils.cleanArray(a);if(a.length>0){corner&&m&&a.push(corner);for(var b=0;b<a.length;b++)l=Math.max(a[b].offsetHeight,l);corner&&!m&&a.push(corner);for(var b=0;b<a.length;b++)a[b].parentNode.style.height=l+"px"}var n=0;a=[frozColFooter,colFooter];$$.utils.cleanArray(a);if(a.length>0){for(var b=0;b<a.length;b++)n=Math.max(a[b].offsetHeight,n);footerCorner&&a.push(footerCorner);for(var b=0;b<a.length;b++)a[b].parentNode.style.height=n+"px"}d-=l+n;var f=0;a=[frozRowHeader,viewport0,viewport1];$$.utils.cleanArray(a);if(a.length>0){for(var b=0;b<a.length;b++)f=Math.max(a[b].offsetHeight,f);if(f>0)f-=spreadView.CellSpacing;f=Math.min(f,d);for(var b=0;b<a.length;b++){a[b].parentNode.style.height=f+"px";if(spreadView.CellSpacing>0)a[b].style.marginTop=-spreadView.CellSpacing+"px"}}var s=d-f,v=0,q=0;if(scrollvp){scrollvp.style.width=Math.max(1,element.clientWidth-c)+"px";scrollvp.style.height=Math.max(1,s+f)+"px";spreadView._UpdateDummyHeight(true);q=scrollvp.offsetHeight-scrollvp.clientHeight;v=scrollvp.offsetWidth-scrollvp.clientWidth;vpholder.style.width=scrollvp.clientWidth+"px";vpholder.style.height=scrollvp.clientHeight+"px";vpholder.style.marginBottom=q+"px"}a=[colHeader,viewport1,viewport,colFooter];$$.utils.cleanArray(a);if(a.length>0)for(var b=0;b<a.length;b++){var h=a[b];if(h==colHeader||h==colFooter)h.parentNode.style.width=y+"px";else h.parentNode.style.width=Math.max(1,y-v)+"px"}a=[rowHeader,viewport2,viewport];$$.utils.cleanArray(a);for(var b=0;b<a.length;b++){var h=a[b];if(h==rowHeader)h.parentNode.style.height=Math.max(1,s)+"px";else h.parentNode.style.height=Math.max(1,s-q)+"px";if(spreadView.CellSpacing>0)h.style.marginTop=(h==rowHeader?element.virtualTop:0)-spreadView.CellSpacing+"px"}spreadView._UpdateEmptyViewportsHeight();!spreadView.IsMultiColumnComboBox&&spreadView._UpdatePaddingDivs();spreadView.Pager.Layout();spreadView.ColumnHeader.Layout();spreadView.Corner.Layout();spreadView.ColumnFooter.Layout();spreadView.RowHeader.Layout();spreadView.CommandBar&&spreadView.CommandBar.Layout();(colHeader!=null||frozColHeader!=null)&&spreadView.LayoutEditingFilterIndicator();(!e||!e.IgnoreAutoSize)&&(!j||!j.restrictAutoSize)&&updateAutoSize();A&&restoreTablePositions(A);element.ignoreVirtualPaging=true;var C=D!=viewport.parentNode.scrollLeft;if(uiVirtualization&&GetRowCountInternal()==0&&colHeader!=null&&(C||spreadView.ActiveContextMenu!=null&&spreadView.ActiveContextMenu.IsFilterMenu))scrollView({target:colHeader.parentNode});else scrollView();element.ignoreVirtualPaging=false;(document.FpActiveSpread==element||retainSelectionBlock&&!spreadView.IsInTouchMode())&&spreadView.ShowFocusRectangle(true);spreadView.RepaintCDFs();if(spreadView.Parent!=null){element.style.width="100%";element.style.height=""}if(k!=null&&typeof k.UpdateRowHeight=="function"&&k.initialized){!o&&k.UpdateRowHeight(element,o);(e==null||!e.IgnoreLayoutParent)&&k.sizeSpread(true)}w&&t&&$element.data("style.lastHeight",element.clientHeight);element.isSizeSpread=false}function refreshTablesPosition(){var a=arguments;if(a.length==0)return;for(var d=[],b=0;b<a.length;b++){var c=a[b];if(c){d[b]=c.style.position;c.style.position=""}}setTimeout(function(){for(var b=0;b<a.length;b++){var c=a[b];if(c)c.style.position=d[b]}if(retainSelectionBlock||element.document.FpActiveSpread==element)element.getSpreadView().GetTopSpreadView().Spread.GetActiveChartObj()==null&&spreadView.ShowFocusRectangle(true)},0)}function getMaxLastRowBorderHeight(a){if(a==null)return 0;for(var d=0,b=0;b<a.rows.length;b++)for(var e=a.rows[b],c=0;c<e.cells.length;c++){if(b+e.cells[c].rowSpan!=a.rows.length)continue;var f=getBorderWidth(e.cells[c],2);if(f>d)d=f}return d}function updateAutoSize(){var r=element.document,H=r.documentElement!=null&&!$$.string.IsNullOrEmpty($$.j(r.documentElement).css("height")),i=element.getAttribute("ClientAutoSize")=="True"||getParentSpread()!=null,q=spreadView.ClientAutoSizeMaxWidth(),p=spreadView.ClientAutoSizeMaxHeight(),h=i&&q+p>0&&getParentSpread()==null,j={restrictAutoSize:false},x=$$.browser.quirksMode;if(i||!x&&!H&&element.style.position!="absolute"||x&&element.style.position!="absolute"&&element.style.position!="relative")if(i||element.style.height!=null&&element.style.height.indexOf("%")>=0){var G=getRowHeader(),o=getViewport1(),F=getViewport2(),v=getViewport(),u=getViewport0(),N=getFrozRowHeader(),L=getCorner(),M=getFooterCorner(),K=backupTablePositions(G,o,F,v,u),d=spreadView._GetViewportSize();if(i){var b=r.getElementById(element.id+"_view");if(b!=null&&spreadView.Parent==null&&q==0&&p==0){b.style.overflowX="hidden";b.style.overflowY="hidden"}var c=0;if(spreadView.RowHeader.IsVisible())c+=getMaxWidth([G,N,L,M]);var g=u||F;if(g!=null)c+=getMaxWidth([g,g.rows.length==0?getNoRow(u!=null?0:2):null])+parseInt(g.cellSpacing);var k=[];FpSpreadJS.loadAllChildViews(element,k);if(k.length>0){for(var m=b.getBoundingClientRect().left,t=m+d.width,w=0;w<k.length;w++){var C=k[w],D=C.getBoundingClientRect().left,O=D+getChildSpreadOffsetWidth(C)+2;m=Math.min(m,D);t=Math.max(t,O)}c+=t-m}else if(v.rows.length>0)c+=d.width;else c+=getMaxWidth([getColHeader(),o,v,getColFooter()]);if(!h){element.style.width=c+"px";if(spreadView.Parent==null){var l=getTitleBar()||getSubTitleBar();if(l!=null){var n=$$(l).getParent("TABLE");n.style.width=n.parentElement.clientWidth+"px"}}}}var a=0,s=spreadView.CellSpacing;if(getTitleBar()!=null)a+=getTitleBar().offsetHeight;if(getSubTitleBar()!=null)a+=getSubTitleBar().offsetHeight;if(getCommandBar()!=null)a+=getCommandBar().offsetHeight;if(spreadView.ColumnHeader.IsVisible())a+=getMaxHeight([getColHeader(),getFrozColHeader()])-s;if(spreadView.ColumnFooter.IsVisible())a+=getMaxHeight([getColFooter(),getFrozColFooter()]);if(o!=null)a+=o.offsetHeight-s;a+=element.GetRowCount()>frzRows?d.height:d.height+s;if(getPager1()!=null)a+=getPager1().offsetHeight;if(getPager2()!=null)a+=getPager2().offsetHeight;if(getHierBar()!=null)a+=getHierBar().offsetHeight;if(getGroupBar()!=null)a+=getGroupBar().offsetHeight;if(h){var E=getScrollvp()||getViewport().parentNode;if(d.height<$$.utils.detectScrollbarWidthHeight()&&E.offsetHeight!=E.clientHeight&&GetRowCount()==0&&hasChart())a=a-d.height+$$.utils.detectScrollbarWidthHeight()}if(!h)element.style.height=a+"px";j.AutoSizeWidth=c;j.AutoSizeHeight=a;if(h){element.onresize=null;var I=b!=null?b.style.overflowX:null,J=b!=null?b.style.overflowY:null,f=spreadView.CheckAutoSizeScrollBar(Math.floor(c),Math.floor(a),q,p,I,J),B=f[0],A=f[1],y=f[2],z=f[3];element.style.width=B+"px";element.style.height=A+"px";var l=getTitleBar()||getSubTitleBar();if(l!=null){var n=$$(l).getParent("TABLE");n.style.width=n.parentElement.clientWidth+"px"}var e=getScrollvp()||b;if(e){if(spreadView.HorizontalScrollBarPolicy()!="never"&&e.style.overflowX!=y)e.style.overflowX=y;if(spreadView.VerticalScrollBarPolicy()!="never"&&e.style.overflowY!=z)e.style.overflowY=z}element.onresize=processResize;if(Math.floor(c)!=B||Math.floor(a)!=A)j.restrictAutoSize=true}restoreTablePositions(K)}return j}function getNoRow(a){return spreadView._GetNoRow(a)}function getMaxWidth(c){for(var a=0,b=0;b<c.length;b++){var d=c[b];if(d==null)continue;a=Math.max(a,d.offsetWidth)}return a}function getMaxHeight(c){for(var a=0,b=0;b<c.length;b++){var d=c[b];if(d==null)continue;a=Math.max(a,d.offsetHeight)}return a}function getViewPortSize(){return spreadView._GetViewportSize()}function hasChart(){if(element.chartCount!=null)return element.chartCount>0;var a=typeof FpChartUtil!=="undefined"?FpChartUtil.getChartsIdCollection(element).length:-1;if(a!=-1)element.chartCount=a;return a>0}function doMouseWheel(i){var n={event:i,cancel:false};spreadView.CallBacks.topic("MouseWheel").publish(n);if(n.cancel)return;var a=i||window.event;if(spreadView&&spreadView.GetTopSpreadView().ActiveContextMenu!=null||GrapeCity.Web.DatePicker.IsShowing()){FarPoint.System.CancelDefault(a);return false}if(a.ctrlKey){sizeSpread();return}var s=a.wheelDelta!=null&&a.wheelDelta>0||a.deltaY!=null&&a.deltaY<0,r=a.wheelDelta!=null&&a.wheelDelta<0||a.deltaY!=null&&a.deltaY>0,f=a.srcElement||a.target,p=getSpreadControl(f,true),o=$$.utils.contains(element.document.activeElement,f)&&f.tagName=="OPTION"||element.document.activeElement==f&&$$.utils.isSelectControl(f);if(o)return;var g=getTopSpread(),b=spreadView.GetActiveSpread(true);if(b){var d=b.getSpreadView?b.getSpreadView():null;if(getTopSpread(b)==g||d&&d.IsMultiColumnComboBox&&$$.utils.contains(g,b.getSpreadView().GetHostSpread(),true)){if(!d||!d.IsMultiColumnComboBox||!$$.utils.contains(b,i.target,true))if(element.document.activeElement==null||!isChild(element.document.activeElement,element)){ignorePostbackEditmode=true;setTextBoxFocus();textBoxActive(a);ignorePostbackEditmode=false}var m=true,h=b;if(d&&d.IsMultiColumnComboBox&&p!=b)h=getEditingSpread();if(h){var j=h.getSpreadView().GetSpreadContext();j.detachScrollEvents();m=h.EndEdit({Event:a,FromMouseWheel:true});j.attachScrollEvents();if(!m)return}}}var g=getTopSpread();if(g.getAttribute("ClientAutoSize")!="True"||spreadView.IsVerticalRestricClientAutoSize()){var l=g.getScrollvp(),e=l;if(e==null)e=getParent(g.getViewport());if(e!=null){var q=e.scrollTop,c=a.wheelDelta!==undefined?-1/40*a.wheelDelta:a.deltaY;if(c>0&&c<6)c=6;else if(c<0&&c>-6)c=-6;e.scrollTop+=2*c;var k=q==e.scrollTop;l!=null&&!k&&vpscroll(a);!k&&a.preventDefault()}frzCols>0&&hasChart()&&a.preventDefault()}a.stopPropagation()}var waittimeAdj=20,waittime=200,startTime=null;function vpscroll(g){if(uiVirtualization){if(spreadView.EditModePermanent&&spreadView.IsInTouchMode()){var h=spreadView._GetTimeoutTask("ProcessEditMode");if(h!=null){spreadView.UnregisterTimeoutTask("ProcessEditMode");spreadView.ProcessEditModePermanent(h.Delay,true)}}var a=false;if(editing&&anchorCell!=null){a=$$.utils.contains(getViewport0(),anchorCell);if(!a){var f=getScrollvp();if(f.scrollTop!=e)a=$$.utils.contains(getViewport1(),anchorCell);if(!a&&f.scrollLeft!=d)a=$$.utils.contains(getViewport2(),anchorCell)}a|=anchorCell.getAttribute("RowEditTemplate")=="true"&&window.document.activeElement&&IsInRowEditTemplate(window.document.activeElement)}if(!editing||a){var c=getViewport().parentNode.scrollLeft!=g.target.scrollLeft,i=getViewport().parentNode.scrollTop!=g.target.scrollTop;element.getAttribute("scrollContent")&&(c||i)&&showScrollingContent(c);startTime=new Date;setTimeout(function(){stopScroll(!c,!i)},waittime)}}else{var b=getScrollvp(),e=b.scrollTop,d=b.scrollLeft;scrollView({target:b});var j={spread:element},k=$$.utils.createEvent("Scroll",false,true,j);element.dispatchEvent(k);if(!attachedScrollEvents&&(e!=b.scrollTop||d!=b.scrollLeft))b._requiresSynchroningScroll=true}}function stopScroll(g,c){var b=1e3;if(startTime!=null){var d=new Date;b=d.getTime()-startTime.getTime()}if(b>=waittime-waittimeAdj){var a=getScrollvp();smartPaint&&reloadRowsInView(a);if(editModePermanent&&editing&&!IsValid()){a.scrollTop=scrollTop;a.scrollLeft=scrollLeft}else{scrollView({target:a},true);if(arguments.length<2||!c){var e={spread:element},f=$$.utils.createEvent("Scroll",false,true,e);element.dispatchEvent(f)}}}}function getTopRow(e){var b=element.getViewport();if(b.rows.length==0)return-1;var c=e;if(element.getAttribute("virtualPaging")=="true"){var g=getParent(b),f=getTopSpread(),d=document.getElementById(f.id+"_VirtualPaging_Top").style.height;d=parseInt(d);c=c-d;if(c<0)c=0}var a=current;if(a==-1)a=0;if(c<b.rows[a].offsetTop+b.rows[a].offsetHeight)while(a>0){a--;if(c>=b.rows[a].offsetTop+b.rows[a].offsetHeight)return Math.max(0,a)}else for(a=current+1;a<b.rows.length;a++)if(c<b.rows[a].offsetTop+b.rows[a].offsetHeight)break;a=Math.max(0,a);return a}function GetTopRowIndex(){var a=element.getViewport(),b=frzRows+getTopRow(a.parentNode.scrollTop);return b}function GetLeftColIndex(){var e=element.getViewport(),c=e.parentNode.scrollLeft;if(scrollvp!=null)c=scrollvp.scrollLeft;for(var d=0,a=0,b=GetColCount(),a=0;a<b;a++){d+=getColWidthFromCol(frzCols+a);if(d>c)break}return d>c?frzCols+a:b>0&&frzCols==b?b:a-1}function setScrollbarValues(e,f,j){var b=getTopSpread();if(b!=element)return;var i=getParent(b.getRowHeader()),h=getParent(b.getColHeader()),g=getParent(b.getColFooter()),a=getParent(b.getViewport()),d=b.getScrollvp();if(d!=null){d.scrollLeft=f;if(e!=null)d.scrollTop=e;d.scrollLeft=f}if(a!=null){a.scrollLeft=f;if(e!=null)a.scrollTop=e}var c=getParent(b.getViewport2());if(c!=null&&c.scrollTop!=a.scrollTop)c.scrollTop=a.scrollTop;c=getParent(b.getViewport1());if(c!=null&&c.scrollLeft!=a.scrollLeft)c.scrollLeft=a.scrollLeft;if(i!=null&&i.scrollTop!=a.scrollTop)i.scrollTop=a.scrollTop;if(h!=null&&h.scrollLeft!=a.scrollLeft)h.scrollLeft=a.scrollLeft;if(g!=null&&g.scrollLeft!=a.scrollLeft)g.scrollLeft=a.scrollLeft;scrollView({target:d||a},null,j)}function fixMissedColumns(a,d){if($$.browser.ieversion>=11||!$$.browser.ie)return;if(a==null)a=getSpreadTables();$$.utils.cleanArray(a);for(var e=false,c=0;c<a.length;c++){var f=a[c];if(f.rows.length>0){var b=f.getAttribute("LastDisplayedColumn");if(b!=null){b=parseInt(b);if(d!=null&&d<b)continue;e|=fixMissedColumnsForTable(a[c])}}}return e}function fixMissedColumnsForTable(c){if(c==null)return false;var a=c.getAttribute("LastDisplayedColumn");if(a!=null){a=parseInt(a);var g=spreadView.IsLoadOnDemand&&element.getAttribute("AllRowsLoaded")!="true",h=getColGroup(c),b=h.getElementsByTagName("COL"),f=c==getColHeader()||c==getColFooter()?b.length-1:b.length;if(a>=f-1){!g&&c.removeAttribute("LastDisplayedColumn");return false}for(var e=0,d=a+1;d<f;d++)e+=parseInt(b[d].width)+parseInt(c.cellSpacing);b[a].setAttribute("__originalWidth",b[a].width);b[a].width=parseInt(b[a].width)+e+"px";return true}return false}function restoreTableWidth(b,c){if(typeof b.length!="undefined"&&b.length>0)for(var e=0;e<b.length;e++)restoreTableWidth(b[e],c);else{if(b==null)return;var a=b.getAttribute("LastDisplayedColumn");if(a==null)return;a=parseInt(a);if(c!=null&&c<a)return;var d=getColGroup(b);if(a<d.children.length){var f=d.children[a].getAttribute("__originalWidth");f!=null&&d.children[a].setAttribute("width",f)}}}function fixBrokenColumn(c){if(!$$.browser.ie)return;$$.utils.cleanArray(c);var d=$$.utils.getMinColumnsWidth(c,getRealColWidth);if(d==null)return;for(var e=0;e<c.length;e++){var g=c[e],a=g.getElementsByTagName("COLGROUP");if(a==null||a.length==0)continue;a=a[0];for(var b=0;b<d.length;b++){var f=a.children[b];if(parseInt(f.width)<d[b])f.width=d[b]}}}function fixBrokenColumns(){if(!$$.browser.ie)return;var a=[getFrozRowHeader(),getRowHeader()];$$.utils.cleanArray(a);var b=getCorner();b!=null&&b.getAttribute("allowTableCorner")&&a.push(b);if(a.length>0){cleanElementsStyle(a,["width"],"");var c=a[0].offsetHeight;restoreElementsStyle(a,["width"]);cleanElementsStyle(a,["width"],"1px");fixBrokenColumn(a);restoreElementsStyle(a,["width"])}a=[getColHeader(),getViewport1(),getViewport(),getColFooter()];$$.utils.cleanArray(a);if(a.length>0){cleanElementsStyle(a,["width"],"");var c=a[0].offsetHeight;restoreElementsStyle(a,["width"]);cleanElementsStyle(a,["width"],"1px");fixBrokenColumn(a);restoreElementsStyle(a,["width"])}if(frzCols>0){a=[getFrozColHeader(),getViewport0(),getViewport2(),getFrozColFooter()];$$.utils.cleanArray(a);if(a.length>0){cleanElementsStyle(a,["width"],"");var c=a[0].offsetHeight;restoreElementsStyle(a,["width"]);cleanElementsStyle(a,["width"],"1px");fixBrokenColumn(a);restoreElementsStyle(a,["width"])}}}function synInlineTextEditorWidths(f){for(var d=0;d<GetRowCountInternal();d++){var b=getCellFromRowCol(d,f);if(b&&b.offsetParent){var g=getCellType(b,true);if(g=="TextCellType"){var a=getEditor(b,true);if(a&&(a.tagName=="TEXTAREA"||a.tagName=="INPUT")){var e=a.offsetWidth-a.clientWidth,c=6;if(a.tagName=="INPUT")if($$.browser.webkit)c=8;else if($$.browser.mozilla)c=4;a.style.width=Math.max(b.clientWidth-c,e)+"px"}}}}}function monitorDisplay(){if(typeof MutationObserver!="undefined"){if(displayObserver)try{displayObserver.disconnect()}catch(a){}displayObserver=new MutationObserver(monitorDisplayCallback);var c={attributes:true,substree:true,attributeFilter:["style","class"]},a=element;while(a.parentNode!=null){var b=$$.j?$$.j(a):$$(a);if($$.browser.chrome||b.css("display")=="none"||b.css("visibility")=="hidden"){displayObserver.observe(a,c);$$.browser.chrome&&b.data("zoom",b.css("zoom"))}a=a.parentNode}}element._pageLoadCallback&&msAjaxEnabled()&&Sys.Application.remove_load&&Sys.Application.remove_load(element._pageLoadCallback)}function monitorDisplayCallback(c,d){if(element.offsetWidth!=0&&element.offsetHeight!=0){!spreadView.layoutInitialized&&$$.spread.ready(element,function(){spreadView.ReInitLayout()});if(!$$.browser.chrome)d.disconnect();else{var a=$$.j(c[0].target),b=a.css("zoom");if(a.data("zoom")!=b){sizeSpread();a.data("zoom",b)}}}}function hasCellBorder(b,e,d){if(b!=null)for(var c=0;c<b.cells.length;c++){var j=b.cells[c],a=$$(j).border("all"),i=e&&a.top!=0,f=e&&a.bottom!=0,h=d&&a.left!=0,g=d&&a.right!=0;if(i||f||h||g)return true}return false}function syncBorders(){if(spreadView.CellSpacing==0){var f=[getFrozRowHeader(),getRowHeader()];$$.utils.cleanArray(f);for(var i=0;i<f.length;i++){var d=f[i];if(d!=null&&d.rows.length>0){var l=d.getAttribute("__defaultBackColor"),t=l!=null?l:DEFAULT_TEMP_BORDER;if(hasCellBorder(d.rows[0],true,false))d.style.borderTop="1px solid "+t;if($$.browser.ie&&spreadView.CellSpacing==0){var e=d.rows[d.rows.length-1];if(hasCellBorder(e,true,true)){e.style.borderBottomWidth="1px";if($$(e).style("border-bottom-style")=="none")e.style.borderBottomStyle="solid"}}}}var b=getCorner(),o=getFooterCorner();if(spreadView.CellSpacing==0){var c=[];b&&b.rows&&b.rows.length==1&&c.push(b);o&&c.push(o);if(spreadView.Corner.AllowTableCorner==false)if(b!=null&&b.nextSibling!=null&&b.nextSibling.getAttribute("fb")=="1"){var s=b.nextSibling;c.push($$(s).firstChild("TABLE"))}for(var a=0;a<c.length;a++){var u=c[a].rows[0].cells&&c[a].rows[0].cells.length>0?$$.j(c[a].rows[0].cells[0]).css("background-color"):"transparent";$$.j(c[a]).css("border-left","solid "+u+" 1px")}}}for(var p=[getFrozColHeader(),getColHeader()],r=[getFrozColFooter(),getColFooter()],w=[getViewport0(),getViewport2()],x=[getViewport1(),getViewport()],v=[w,x],a=0;a<p.length;a++){var g=p[a],h=r[a],q=v[a],n=false,m=false;if(g||h)for(var k=0;k<q.length;k++){var j=q[k];if(j==null)continue;if(g&&!n)n=copyBorderInfo(j,g);if(h&&!m)m=copyBorderInfo(j,h)}}if($$.browser.ie){spreadView.SyncBorderTop([getFrozRowHeader(),getViewport0(),getViewport1()]);spreadView.SyncBorderTop([getRowHeader(),getViewport(),getViewport2()])}}function copyBorderInfo(b,a){var c=a.getAttribute("__defaultBackColor"),d=c!=null?c:DEFAULT_TEMP_BORDER;if(b.style.borderLeftWidth!=a.style.borderLeftWidth){if(a.style.borderLeftStyle=="")a.style.borderLeftStyle=b.style.borderLeftStyle;a.style.borderLeftWidth=b.style.borderLeftWidth;if(a.style.borderRightStyle=="")a.style.borderRightStyle=b.style.borderRightStyle;a.style.borderRightWidth=b.style.borderRightWidth;a.style.borderLeftColor=d;return true}return false}function fixSafariAutoFormat(){for(var c=["GeneralCellType","TextCellType","DateTimeCellType","DoubleCellType","PercentCellType","IntegerCellType","CurrencyCellType","ListBoxCellType","RadioButtonListCellType","MultiColumnComboBoxCellType","CheckBoxCellType","ComboBoxCellType","ExtenderCellType","readonly"],b="",a=0;a<c.length;a++){b+=" TD[FpCellType='"+c[a]+"'] A[href^='tel:'],";b+=" TD[CellType='"+c[a]+"'] A[href^='tel:'],";b+=" TD[celltype2='"+c[a]+"'] A[href^='tel:'],"}b+=" TD[FpRef] A[href^='tel:'], ";b+=" TR[previewrow] TD A[href^='tel:'], ";b+=" TR[group] TD A[href^='tel:']";for(var g=/<a\shref="tel:[^<]+">([^<]+)<\/a>/g,e=$element.find(b),a=0;a<e.length;a++){var d=e[a],f=d.outerHTML.replace(g,"$1");$$.j(d).before(f);d.parentNode.removeChild(d)}}function decorate(){var a=[frozRowHeader,rowHeader,viewport0,viewport1,viewport2,viewport];$$.utils.cleanArray(a);for(var e=getScrollvp(),g=getParentSpread(),b=0;b<a.length;b++){var c=a[b];if(spreadView.CellSpacing>0)c.style.borderCollapse="separate";c.style.position="relative";c.parentNode.style.position="relative";c.parentNode.style.outline="none";if(g!=null)c.parentNode.style.overflow="visible";if(c.rows.length>0&&c.style.display=="none")c.style.display=""}if(viewport.cellSpacing>0){a=[viewport0,viewport1,viewport2,viewport];$$.utils.cleanArray(a);for(var b=0;b<a.length;b++)a[b].style.borderWidth="0px"}a=getSpreadTables();var f=[getPager1(),getPager2(),getTitleBar()||getSubTitleBar(),getHierBar(),getGroupBar(),getCommandBar(),getFooterCorner()];$$.utils.cleanArray(f);a=a.concat(f);for(var b=0;b<a.length;b++)$$(a[b].parentNode).appendCssClass("Unselectable");if(e!=null){e.style.display="block";e.style.position="absolute";e.style.outline="none"}if(!$$.browser.ie){var a=[getFrozColHeader(),getColHeader(),getFrozRowHeader(),getRowHeader(),getCorner(),getFooterCorner(),getFrozColFooter(),getColFooter(),getHierBar(),getGroupBar()];$$.utils.cleanArray(a);for(var b=0;b<a.length;b++)a[b].removeAttribute("rules");if($$.browser.webkit&&window.fpPostOn==null){a=a.concat([getTitleBar(),getSubTitleBar(),getCommandBar()]);for(var b=0;b<a.length;b++)a[b]&&FarPoint.Web.Spread.SafariPatch.FixTelephoneAutoFormat(a[b])}}syncBorders();var d=getViewportHolder();if(d!=null){d.parentNode.style.position="relative";d.style.overflow="hidden";d.style.position="relative";d.style.outline="none"}spreadView.Pager.ApplyStyle();spreadView.Corner.ApplyStyle();spreadView.ColumnHeader.ApplyStyle();spreadView.RowHeader.ApplyStyle();spreadView.ColumnFooter.ApplyStyle();spreadView.CommandBar&&spreadView.CommandBar.ApplyStyle()}function initLayout(f,m,i,o){var h=o&&o.ReInitLayout,d=getParentSpread();if(!h){var n=fpSpreadJS.childViewIndexes.length,g=element.getAttribute("childViewsLoaded");if(n>0&&(g==null||n>parseInt(g)))return}if(m!=null){if(!spreadView.layoutCompletedCallbacks)spreadView.layoutCompletedCallbacks=$$.j.Callbacks("once unique");spreadView.layoutCompletedCallbacks.add(m)}if(h||!shouldIgnoreSizeSpread()){setResizingFlag(true);fixBrokenColumns();setResizingFlag(false);decorate();needFixMissedColumns=true;sizeSpread(false,f,{NeedSyncColumns:true,NeedFixMissedColumns:true});needFixMissedColumns=false;xhtml&&!f&&sizeSpread(false,f);for(var p=GetColCount(),l=0;l<p;l++)synInlineTextEditorWidths(l);if(f)if(fpSpreadJS.childViewIndexes.length>0){syncRowRange(-1,-1);sizeSpread(true);processUpdateRowHeight()}else if(element.offsetHeight>0){var a=[];if(frzRows>0){getFrozRowHeader()!=null&&a.push(getFrozRowHeader().rows[0]);getViewport0()!=null&&a.push(getViewport0().rows[0]);getViewport1()!=null&&a.push(getViewport1().rows[0])}else{getRowHeader()!=null&&a.push(getRowHeader().rows[0]);getViewport2()!=null&&a.push(getViewport2().rows[0]);getViewport()!=null&&a.push(getViewport().rows[0])}$$.utils.cleanArray(a);for(var c=[],e=-Number.MAX_VALUE,b=0;b<a.length;b++){c.push(getRowOffsetTop(a[b]));if(e<c[b])e=c[b]}for(var b=0;b<a.length;b++)a[b].style.height=Math.max(0,$$(a[b]).height()-(e-c[b]))+"px";syncRowRange(0,0);if(frzRows>0){a=[];getRowHeader()!=null&&a.push(getRowHeader().rows[0]);getViewport2()!=null&&a.push(getViewport2().rows[0]);getViewport()!=null&&a.push(getViewport().rows[0]);$$.utils.cleanArray(a);for(var c=[],e=-Number.MAX_VALUE,b=0;b<a.length;b++){c.push(getRowOffsetTop(a[b]));if(e<c[b])e=c[b]}for(var b=0;b<a.length;b++)a[b].style.height=Math.max(0,$$(a[b]).height()-(e-c[b]))+"px";syncRowRange(frzRows,frzRows)}sizeSpread(true)}else sizeSpread(true);if(d!=null)f&&d.UpdateRowHeight(element,true);d==null&&(element.style.width.indexOf("%")!=-1||$$(element).style("width")=="100%")&&setTimeout(function(){$element.offsetParent!=null&&$element.data("style.lastWidth")!=element.clientWidth&&sizeSpread(true)},100);spreadView.layoutInitialized=true}if(!h){if(d!=null){var g=d.getAttribute("childViewsLoaded")==null?1:parseInt(d.getAttribute("childViewsLoaded"))+1;d.setAttribute("childViewsLoaded",g)}spreadView.InitFilterUI(i);getRowHeader()==null&&frzCols==0&&prepairSpreadLayout();element.initLayoutCompleted=true;if(element.initialized&&!spreadView.IsInitialized){doOnSpreadInitialized(i);if(element.__pendingCallbakStoppedTargetId!=null){spreadView.OnSpreadCallbackStopped(element.__pendingCallbakStoppedTargetId);element.__pendingCallbakStoppedTargetId=null;i!="LoadOnDemand"&&getEditor(anchorCell)==null&&fpSpreadJS.setImeMode(element,textBox,anchorCell,true)}}}if(spreadView.layoutInitialized&&spreadView.layoutCompletedCallbacks){spreadView.layoutCompletedCallbacks.fire();spreadView.layoutCompletedCallbacks=null}if(spreadView.IsEnablejQueryTheme()){var j=spreadView.Pager.GetSlideBar(getPager1()),k=spreadView.Pager.GetSlideBar(getPager2());j&&j.length>0&&spreadView.JQueryThemeSupporter.RegisterClickableItem($$.j(j[0]).find("img"),false);k&&k.length>0&&spreadView.JQueryThemeSupporter.RegisterClickableItem($$.j(k[0]).find("img"),false);spreadView.JQueryThemeSupporter.RegisterClickableItem($$.j(getCommandBar()).find("input"),function(){return this.getAttribute("disabled")!="true"&&this.getAttribute("disabled")!="disabled"})}$element.data("style.lastHeight",element.clientHeight);$element.data("style.lastWidth",element.clientWidth)}function cheaderScroll(b){var a=b.target;if(a.scrollTop!=0)a.scrollTop=0;element.ignoreVirtualPaging=true;scrollView({target:getParent(getColHeader())});element.ignoreVirtualPaging=false}function cFooterScroll(b){var a=b.target;if(a.scrollTop!=0)a.scrollTop=0;element.ignoreVirtualPaging=true;scrollView({target:getParent(getColFooter())});element.ignoreVirtualPaging=false}function rheaderScroll(c){var a=getParent(getViewport());if(a==null)return;if(a.fromScrollTo==true){a.fromScrollTo=false;return}var b=c.target;if(b.scrollLeft!=0)b.scrollLeft=0;scrollView({target:getParent(getRowHeader())})}function vp1Scroll(b){var a=b.target;if(a.scrollTop!=0)a.scrollTop=0;scrollView({target:getParent(getViewport1())})}function vp2Scroll(b){var a=b.target;if(a.scrollLeft!=0)a.scrollLeft=0;scrollView({target:getParent(getViewport2())})}function noScroll(e){var c=(e||window.event).target,d=$$.j(c);d.off("scroll",noScroll);if(c.scrollTop!=0){c.scrollTop=0;if(c==vpholder)for(var b=[viewport0,viewport1],a=0;a<b.length;a++){if(b[a]==null)continue;if(b[a].parentNode.scrollTop!=0)b[a].parentNode.scrollTop=0}}if(c.scrollLeft!=0){c.scrollLeft=0;if(c==vpholder)for(var b=[viewport0,viewport2],a=0;a<b.length;a++){if(b[a]==null)continue;if(b[a].parentNode.scrollLeft!=0)b[a].parentNode.scrollLeft=0}}d.on("scroll",noScroll)}function getRowByKey2(a){return getRowByKey(a,-1)}function getRowByKey(b,a){return fpSpreadJS.getRowByKey(b,a)}function getColByKey2(a){return getColByKey(a,-1)}function getColByKey(e,g){if(e=="-1")return-1;var b=null,c=getViewport0();if(c==null)c=getViewport2();if(c!=null){b=getColGroup(c);if(b!=null)for(var a=0;a<b.children.length;a++){var h=b.children[a];if(h.getAttribute("FpCol")==e)return a}}var d=getViewport();if(d==null)d=getViewport1();if(d!=null){var f=getColGroup(d);if(f!=null)for(var a=0;a<f.children.length;a++){var h=f.children[a];if(h.getAttribute("FpCol")==e){if(b!=null)a+=b.children.length;return a}}}return g?g:0}function isRowSelected(e){var d=getSelection();if(d!=null){var a=xmlData.firstElementChild(d);while(a!=null){var b,c;if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect")){var f=parseInt(a.getAttribute("row"));b=getFirstRowFromKey(f)}else b=parseInt(a.getAttribute("rowIndex"));if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))c=parseInt(element.getAttribute("layoutRowCount"));else c=parseInt(a.getAttribute("rowcount"));if(b<=e&&e<b+c)return true;a=xmlData.nextElementSibling(a)}}}function setAnchorCell(d,e){if(anchorCell==d)return;var a=anchorCell;anchorCell=d;if(e)oldAnchorCell=null;if(a!=null&&(!spreadView.IsInTouchMode()||spreadView.OperationMode==$$.OperationModes.NORMAL||spreadView.OperationMode==$$.OperationModes.ROW_MODE)){var b=GetSelectedRanges(true);if(b!=null)for(var g=parseInt(getRowFromCell(a)),f=parseInt(getColFromCell(a)),c=0;c<b.length;c++)if(b[c].IsIntersectWith(g,f))return;paintSelectedCell(a,false,true)}}function initSelection(r){oldAnchorCell=null;forcePaintAnchorCell=r;var n=getSelection();if(element.document.FpActiveSpread!=null&&element.document.FpActiveSpread.id==element.id)anchorCell=findAnchorCell();var m=this.xmlData.selectSingleNode("root state activeRow"),l=this.xmlData.selectSingleNode("root state activeColumn"),q=m!=null?parseInt(this.xmlData.textContent(m)):-1,p=l!=null?parseInt(this.xmlData.textContent(l)):-1,c=Math.max(q,0),b=Math.max(p,0);if(element.getAttribute("layoutMode")){var i=getCellByRowCol2(c,b);if(i){c=getRowFromCell(i);b=getColFromCell(i)}}else{c=getRowByKey(c);b=getColByKey(b)}leadingCellRow=c;leadingCellCol=b;if(q>-1&&p>-1){var o=element;if(getParentSpread()!=null){var s=getTopSpread(element);o=s}var h=$$.fn.createXMLDOMWrapper(o),e=h.selectSingleNode("root activechild");if(getParentSpread()==null&&(e==null||h.textContent(e)=="")||e!=null&&element.id==h.textContent(e)){var t=retainSelectionBlock||element.document.FpActiveSheetView!=null&&element.document.FpActiveSheetView.id==element.id;updateAnchorCell(c,b,t)}}var a=this.xmlData.firstChild(n),k=false;while(a!=null){updateSelectionViewIndexes(a);a=this.xmlData.nextSibling(a);k=true}a=this.xmlData.lastChild(n);if(element.getAttribute("LayoutMode")&&anchorCell!=null&&a!=null&&a.getAttribute("col")!="-1"&&a.getAttribute("row")=="-1"&&a.getAttribute("rowcount")=="-1")copymultiCol=true;var f=element.document.FpActiveSheetView;if(f!=null&&f!=element&&getTopSpread(f)==getTopSpread(element)){forcePaintAnchorCell=false;return}if(!retainSelectionBlock){var j=element.document.FpActiveSheetView;if(j==null||j.id!=element.id){forcePaintAnchorCell=false;return}}var d=getParentSpread(element),g=findAnchorCell();if(k){if(g!=null)anchorCell=g;paintSelections(true);if(g!=null)while(d!=null&&typeof d.paintAnchorCell!="undefined"){d.paintAnchorCell(false);d=getSpreadControl(d.parentElement)}}spreadView.ShowFocusRectangle(true);forcePaintAnchorCell=false}function paintSelections(e,h){if(spreadView.IsSuspendPaintSelection())return;!h&&fpSpreadJS.updateSelectionRangeFromCell(anchorCell);(e==null||e)&&paintSelections(false,h&&spreadView.IsInTouchMode());var f=getSelection();if(f!=null){var a=xmlData.firstChild(f);if(a==null){e&&anchorCell!=null&&paintAnchorCell();return}while(a!=null){var b=a.getAttribute("row"),c=parseInt(a.getAttribute("col"));if(a.getAttribute("rowIndex")==null||a.getAttribute("rowIndex")=="-1"){if(b=="newRow"||parseInt(b)>-1)b=getRowByKey(b,0)}else b=parseInt(a.getAttribute("rowIndex"));if(a.getAttribute("colIndex")==null||a.getAttribute("colIndex")=="-1"){if(c>-1){if(element.getAttribute("layoutMode")){var d=null;if(b==-1)d=spreadView._GetFirstCellFromLayoutCol(c);else{var l=getRowKeyFromRow(b);d=getCellByRowCol2(l,c)}if(d){b=getRowFromCell(d);c=getColFromCell(d)}}if(element.getAttribute("layoutMode")==null)c=getColByKey(c,0)}}else c=parseInt(a.getAttribute("colIndex"));var g=parseInt(a.getAttribute("rowcount")),j=parseInt(a.getAttribute("colcount")),k=GetRowCountInternal();if(k==0&&ignorePaintSelection)return;a.setAttribute("rowIndex",b);a.setAttribute("colIndex",c);if(element.getAttribute("layoutMode")&&a.getAttribute("col")>=0&&a.getAttribute("row")>=0&&(a.getAttribute("rowcount")>=1||a.getAttribute("colcount")>=1)){var i=xmlData.nextSibling(a);if(i!=null){typeof activeRow!="undefined"&&typeof activeCol!="undefined"&&activeRow!=null&&activeCol!=null&&(parseInt(a.getAttribute("row"))!=parseInt(xmlData.textContent(activeRow))||parseInt(a.getAttribute("col"))!=parseInt(xmlData.textContent(activeCol)))&&f.removeChild(a);a=i;continue}}if(element.getAttribute("layoutMode")&&a.getAttribute("col")=="-1"&&a.getAttribute("colcount")=="-1"&&a.getAttribute("row")!=-1)g=parseInt(element.getAttribute("layoutRowCount"));if(element.getAttribute("layoutMode")&&a.getAttribute("col")!="-1"&&a.getAttribute("row")=="-1"&&a.getAttribute("rowcount")=="-1"){var d=spreadView._GetFirstCellFromLayoutCol(a.getAttribute("col"));if(d){b=parseInt(d.parentElement.getAttribute("row"));c=getColFromCell(d)}paintMultipleRowSelection(b,c,1,1,e)}else if(element.getAttribute("OperationMode")=="Normal"&&element.getAttribute("SelectionPolicy")=="MultiRange")paintSelection2(b,c,g,j,e);else paintSelection(b,c,g,j,e);a=xmlData.nextSibling(a)}}}var rowEditTemplateContainer_keyDownEvent=null,rowEditTemplateContainer_textBoxFocusing=false;function rowEditTemplateContainer_keyDown(a){if(a.keyCode==tab)if(!rowEditTemplateContainer_textBoxFocusing){if(spreadView._PerformTouchTranslateKey(a))return true;var b=document.createEvent("CustomEvent");b.initCustomEvent("keydown",true,true,null);b.keyCode=a.keyCode;b.target=a.target;b.altKey=a.altKey;b.altLeft=a.altLeft;b.ctrlKey=a.ctrlKey;b.ctrlLeft=a.ctrlLeft;b.shiftKey=a.shiftKey;b.shiftLeft=a.shiftLeft;b.sourceElement=a.target;rowEditTemplateContainer_keyDownEvent=b}else{var d=false;if(window.event==null){d=true;window.event=a}rowEditTemplateContainer_textBoxFocusing=false;editing=false;setTextBoxFocus();translateKey(a);isCalledTranslateKeyFunction=true;if(d)window.event=null}else{if(spreadView._PerformTouchTranslateKey(a))return true;var c=getCell(element.document.activeElement);if(c&&c.getAttribute("RowEditTemplate")=="true"&&spreadView._IsCellHidden(c)&&getParentSpread()==null&&a.target){spreadView.keydownOnEditingTemplate=true;a.target.onkeyup=function(){spreadView.keydownOnEditingTemplate=false;this.onkeyup=null}}rowEditTemplateContainer_keyDownEvent=null}if(!rowEditTemplateContainer_textBoxFocusing&&(a.keyCode==tab||a.keyCode==enter))spreadView.GetAttribute("error")=="true"&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();!$$.utils.isFunctionKey(a.keyCode)&&$$.utils.cancelBubble(a,false);return true}function rowEditTemplateContainer_textBoxFocus(){if(rowEditTemplateContainer_keyDownEvent&&rowEditTemplateContainer_keyDownEvent.keyCode==tab){rowEditTemplateContainer_textBoxFocusing=true;$$.utils.fireEvent(rowEditTemplateContainer_keyDownEvent.sourceElement,rowEditTemplateContainer_keyDownEvent)}}var keyMap=[];function KeyAction(e,c,b,d,a){this.key=e;this.ctrl=c;this.shift=b;this.alt=d;this.action=a}function RemoveKeyMap(e,g,f,h){for(var d=keyMap.length,b=0;b<d;b++){var a=keyMap[b];if(a!=null&&a.key==e&&a.ctrl==g&&a.shift==f&&a.alt==h){for(var c=b+1;c<d;c++)keyMap[c-1]=keyMap[c];keyMap.length=keyMap.length-1;break}}}function AddKeyMap(a,d,c,e,b){var f=getKeyAction(a,d,c,e);if(f!=null)f.action=b;else{var g=keyMap.length;keyMap.length=g+1;keyMap[g]=new KeyAction(a,d,c,e,b)}}function getKeyAction(c,e,d,f){for(var g=keyMap.length,b=0;b<g;b++){var a=keyMap[b];if(a!=null&&a.key==c&&a.ctrl==e&&a.shift==d&&a.alt==f)return a}return null}function IsValid(){return element.valid!=null?element.valid:true}function MoveToPrevCell(b,a){var c=spreadView.TryStopEditing();if(c){if(b)nextCell(tab,true);else nextCell(left,false);if(a==null||a){if(spreadView.IsInTouchMode())spreadView.Touch.ResizeLocation=null;spreadView.UpdateUI()}}}function MoveToNextCell(b,a){var c=spreadView.TryStopEditing();if(c){if(b)nextCell(tab,false);else nextCell(right,false);if(a==null||a){if(spreadView.IsInTouchMode())spreadView.Touch.ResizeLocation=null;spreadView.UpdateUI()}}}function MoveToNextRow(c,a){var b=spreadView.TryStopEditing();if(b){nextCell(down,false,c);if(a==null||a){if(spreadView.IsInTouchMode())spreadView.Touch.ResizeLocation=null;spreadView.UpdateUI()}}}function MoveToPrevRow(c,a){var b=spreadView.TryStopEditing();if(b){nextCell(up,false,c);if(a==null||a){if(spreadView.IsInTouchMode())spreadView.Touch.ResizeLocation=null;spreadView.UpdateUI()}}}function MoveToFirstColumn(a){var b=spreadView.TryStopEditing();if(b){nextCell(home,false);if(a==null||a){if(spreadView.IsInTouchMode())spreadView.Touch.ResizeLocation=null;spreadView.UpdateUI()}}}function MoveToLastColumn(a){var b=spreadView.TryStopEditing();if(b){nextCell(end,false);if(a==null||a){if(spreadView.IsInTouchMode())spreadView.Touch.ResizeLocation=null;spreadView.UpdateUI()}}}function CopyLikeExcel(){if(spreadView._NeedUseBrowserBehavior())return;Copy(keyActionInfo&&keyActionInfo.CanCopy,true);keyActionInfo=null}function CutLikeExcel(){if(spreadView._NeedUseBrowserBehavior())return;Clear(keyActionInfo&&keyActionInfo.CanCut,true);keyActionInfo=null}function PasteLikeExcel(){if(spreadView._NeedUseBrowserBehavior())return;var b=getTopSpread(element);if(keyActionInfo&&keyActionInfo.CanPaste&&b.getAttribute("clipboard")==null){var a=$$.j(window.document);a.off("paste",documentOnPaste);a.on("paste",documentOnPaste);__focusTextBoxTemporary(b,"")}else{Paste(getClipboardData(),true);keyActionInfo=null}}function UpdatePostbackData(){saveData()}function addBrowserDocumentMode(){var e=xmlData.selectSingleNode("root"),a=xmlData.selectSingleNode("browser");if(a==null){a=xmlData.createElement("browser");var c=xmlData.createElement("documentmode");xmlData.textContent(c,document.documentMode);a.appendChild(c);var b=xmlData.createElement("ieversion"),d=$$.browser;xmlData.textContent(b,d.ieversion);a.appendChild(b);e.appendChild(a)}}function saveData(f){try{if(element.childNodes.length==0)return;var d=element.document;if(!d.all)d=window.document;addBrowserDocumentMode();for(var a=getSelection(),b=0;b<a.childNodes.length;b++)if(a.childNodes[b].getAttribute("anchor")!=null){a.removeChild(a.childNodes[b]);break}var g=element.id+"_data",c=window.document.getElementById(g);if(c!=null){var e=encodeURIComponent(xmlData.serializeXML());if((!f||!f.notUsedTimeout)&&$$.browser.ieversion>=11&&element.document.activeElement&&$$.utils.isSelectControl(element.document.activeElement))setTimeout(function(){c.value=e},0);else c.value=e}}catch(h){$$.DEBUG.Log(h,"saveData")}}function setActiveSpreadID(c,f,e,g){var a=$$.fn.createXMLDOMWrapper(c),d=a.selectSingleNode("root activespread"),b=a.selectSingleNode("root activechild");if(d==null||b==null)return;var h=getParentSpread();if(h!=null&&f!=e&&a.textContent(b)!=element.id)return;if(g&&b!=null&&a.textContent(b)!="")a.textContent(d,a.textContent(b));else{a.textContent(d,f==null?"":f);e!=null&&a.textContent(b,e)}c!=element&&c.fpSpreadJS!=null&&c.fpSpreadJS.context.saveData();saveData();dirty=false}function setActiveSpread(a,g){if(document.FpActiveSpread!=element&&a!=null&&a.type=="mousedown"&&a.target!=element&&!$$.utils.contains(element,a.target)&&(spreadView==null||spreadView.GetHostSpread(a.target)!=element))return;if(a.type=="mousedown"||a.type=="MSPointerDown"||a.type.toLowerCase()=="pointerdown"){if(spreadView.ActiveDialog!=null&&spreadView.GetActiveSpread()==element&&($$.utils.contains(spreadView.ActiveDialog.Dialog,a.target)||spreadView.ActiveDialog.Dialog==a.target))return;var b=GrapeCity.Web.DatePicker.GetInstance();if(b!=null&&getTopSpread(b.Target)==getTopSpread()){var d=b._GetDatePickerContainer();if($$.utils.contains(d,a.target)||d==a.target)return}}var f=spreadView.GetComboBoxBehavior();if(f!=null&&!f.getIsDrop())return;if(anchorCell!=null&&anchorCell.getAttribute("fpcelltype")=="ExtenderCellType"&&anchorCell.getAttribute("celltype2")=="NumericUpDownCellType"){var e=element.document.activeElement,h=getTopSpread();if(e!=null&&$$.utils.contains(anchorCell,e)&&getEditor(anchorCell)!=null&&$$.utils.contains(h,a.target))return}if(!a)a=window.event;setActiveSpreadManually(a.target,a,g);ignoreEditorFocus=false;if(a!=null)if(!editing&&spreadView.IsInTouchMode()&&spreadView.IsSpreadActive()&&!$$.utils.contains(element,document.activeElement)&&!spreadView.IsPopupOpened()&&spreadView.GetHostSpread(a.target)==element)if($$.utils.isOverScrollbar(a))setTextBoxFocus(true);else{var c=GCWS.FilterEditor.GetEditor(a.target);c!=null&&c.Behavior.IsFilterBar&&(c.disabled||a.target.disabled)&&setTimeout(function(){setTextBoxFocus()},0)}anchorCell!=null&&element.document.FpActiveSpread==element&&!isHeaderCell(anchorCell)&&!(a!=null&&a.type=="mousedown"&&$$.utils.isTextControl(a.target)&&IsInRowEditTemplate(a.target)&&a.target.style.imeMode!="")&&fpSpreadJS.setImeMode(element,textBox,anchorCell)}var setActiveSpreadManuallyCalling=false;function setActiveSpreadManually(d,e,b){if(setActiveSpreadManuallyCalling)return;setActiveSpreadManuallyCalling=true;var a=document.FpActiveSheetView||document.FpActiveSpread,c=a!=null?getTopSpread(a).getSpreadView():getTopSpread(element).getSpreadView();c._DetachDocumentFocusIn();__setActiveSpread(d,e,b);a=document.FpActiveSheetView||document.FpActiveSpread;a!=null&&getTopSpread(a).getSpreadView()._HookDocumentFocusInEvent();setActiveSpreadManuallyCalling=false}function __setActiveSpread(d,b,H){try{var c=element.document;if(!c.getElementById)c=window.document;var J=isExtenderPopupControl(d);if(c.FpActiveSpread==element&&J)return;var s=getTopSpread(element).getSpreadView();if(s.ActiveContextMenu!=null&&s.ActiveContextMenu.IsMenuElement(d)&&c.FpActiveSpread==element)return;c.FpActiveSpread!=null&&c.FpActiveSpread.setActiveField(true);ignoreElementActive=false;if(d==null||d.parentElement==null&&d.tagName!="HTML"&&d.tagName!="BODY")return;var a=null,A=null;if(spreadView.Touch!=null&&(A=spreadView.Touch.GetTouchHandle(d))!=null)a=c.getElementById(A.getAttribute("HostSpreadID"));if(a==null&&spreadView._IsFocusRectangle(d)){var e=spreadView.GetActiveSpread();if(e!=null&&e.getSpreadView().GetTopSpreadView()==spreadView.GetTopSpreadView())a=e}if(a==null)a=H?element:getSpreadControl(d);if(a==null)a=spreadView.GetHostSpread(d);if(a==null)ignoreEditorFocus=true;else if(b!=null&&b.type=="mousedown"&&getTopSpread(a)!=getTopSpread(element))return;var l=b!=null&&b.type&&(b.type=="mousedown"||b.type.toLowerCase()=="mspointerdown"||b.type.toLowerCase()=="pointerdown"),m=false;if(l){m=a==null&&$$.utils.isTextControl(b.target);l=m||a!=null&&!$$.utils.isNativeControl(b.target)}if(c.FpActiveSpread!=a&&!isExtenderPopupControl(d)){if(d!=editor&&editor!=null)if(typeof editor.blur!="undefined"&&editor.parentElement!=null){if(!l){if(editor==element.document.activeElement&&isEditModeReplace(getCell(editor))&&$$.utils.isTextControl(editor))editor.selectionStart=editor.selectionEnd=0;(!b||b.target.tagName!="SELECT")&&editor.blur()}if(spreadView.IsInTouchMode())$$.utils.contains(editor,c.activeElement)&&c.activeElement.blur()}if(!$$.browser.isTouchEventModel||a!=null)if((b==null||b.type!="mousedown"||d!=b.target)&&spreadView.NeedSetEditorFocusOnActiveCell())if(typeof d.focus!="undefined"&&(d.tagName=="INPUT"||d.tagName=="TEXTAREA"||$$.utils.isSelectControl(d,true))){var k=a!=null?a.getSpreadView():null;k!=null&&k.GetSpreadContext().detachOnActiveEvents();d.focus();k!=null&&k.GetSpreadContext().attachOnActiveEvents()}var r=true,e=c.FpActiveSpread;if(e==null)e=element;var F=b!=null?getCell(b.target):null,K=e==element&&b!=null&&b.type=="mousedown"&&(F!=anchorCell||F==b.target)&&getSpreadControl(b.target,true)==element;if(!K&&e!=null&&!isHandleEvent(b)&&(a==null||a.getAttribute("mcctCellType")!="true")){var h=e.getSpreadView(),n=a!=null&&a.getSpreadView().IsInTouchMode()&&a!=e&&h.GetTopSpreadView()!=a.getSpreadView().GetTopSpreadView(),w=e.getEditingInfo(),L={ignoreEditorFocus:n||a&&w&&w.RenderAsEditor,SafeEditorRemove:l,OutsideEvent:b};n&&h.SuspendSpreadFocus();if(!e.EndEdit(L)&&getTopSpread(e)==getTopSpread(element))r=false;n&&h.ResumeSpreadFocus();if(!$$.browser.isTouchEventModel||a!=null)!editing&&m&&element.document.activeElement==textBox&&b.target.focus()}if(a==null)ignoreEditorFocus=false;if(!r&&(c.FpActiveSpread!=null||a==null||e!=element)){if(element.document.FpActiveSpread==element){a=getSpreadControl(b.target,true);a==null&&spreadView.ActivateSpread(null,true)}else element.document.FpActiveSpread==null&&a==element&&b!=null&&b.type=="mousedown"&&spreadView.ActivateSpread(a,true);return}var h=c.FpActiveSpread!=null?c.FpActiveSpread.getSpreadView():null;if(editing&&editModePermanent&&(h==null||!h.IsMultiColumnComboBox||element!=h.GetHostSpread())){ignoreBlur=false;textBoxBlur()}}var C=hitCommandBar(b);if(a==null){a=getSpreadControl(d,true);if(C&&a!=c.FpActiveSpread){var r=a.EndEdit({IgnoreFireErrorEvent:b!=null&&b.type=="mousedown"});if(!r)return}}if(a==null&&c.FpActiveSpread==null&&b!=null&&b.type=="mousedown")if(getSpreadControl(b.target,true)==null)return;if(a==null||c.FpActiveSpread!=null&&getTopSpread(c.FpActiveSpread)!=getTopSpread(element)){a==null&&(b==null||b.type=="mousedown"&&!isChild(d,editor)&&!fpSpreadJS.isAjaxPopup(editor,d))&&element.EndEdit();var e=c.FpActiveSpread,G=e!=null?e.getSpreadView():null;(e==null||!G.IsMultiColumnComboBox||element!=G.GetHostSpread())&&hideSelectionBlock()}var M=getCell(d,true);if(M==null&&dirty){saveData();dirty=false}if(dirty&&(c.FpActiveSpread!=element||a==null||C)){saveData();dirty=false}if(dirty&&c.FpActiveSpread==element&&d.tagName=="INPUT"&&(d.type=="submit"||d.type=="button"||d.type=="image")){saveData();dirty=false}if(a!=null&&a!=element)return;if(a!=null&&a.getAttribute("OperationMode")=="ReadOnly")return;if(a!=null&&getParentSpread()!=null&&s.ContextMenus!=null&&b&&$$.utils.isRightClick(b))return;var i=null;if(a==null){i=getTopSpread(element);setActiveSpreadID(i,"",null);if(element.document.FpActiveSpread==element){spreadView.ActivateSpread(null);anchorCell!=null&&spreadView.IsInTouchMode()&&spreadView.IsRetainSelection()&&spreadView.GetTopSpreadView().Spread.GetActiveChartObj()==null&&setTimeout(function(){spreadView.ShowFocusRectangle(true)},0)}}else{i=getTopSpread(a);var f=getEditingSpread();if(f!=null&&f!=element&&!f.IsValid()){var t=f.getEditingInfo();if(t!=null&&t.Editor!=null){var I=f.getSpreadContext();I.scrollToCell(f.getAnchorCell(),{IgnoreSyncScrollByCell:true,visibleOnTop:f.getSpreadView().Parent!=null});f.getSpreadView().NeedSetEditorFocusOnActiveCell()&&t.Editor.focus()}b!=null&&b.type=="mousedown"&&$$.utils.cancelBubble(b);return}var g=element.document.FpActiveSpread,D=g!=null&&getTopSpread(g)==getTopSpread(a),y=d,N=FpSpreadJS.getTableRow(y);if(sizeRow!=null||sizeColumn!=null||spreadView._IsGrayArea(y,true,true)){var q=$$.fn.createXMLDOMWrapper(i),p=q.selectSingleNode("root activechild");if(p!=null&&q.textContent(p)!="")spreadView.ActivateSpread(element.document.getElementById(q.textContent(p)));else{for(var B=FpSpreadJS.getAllSpreads(i),v=0;v<B.length;v++){var u=B[v];if(u.getAnchorCell()!=null&&u.getAnchorCell().paintSelected){a=u;break}}spreadView.ActivateSpread(a)}c.FpActiveSheetView=c.FpActiveSpread;setActiveSpreadID(i,c.FpActiveSpread.id,c.FpActiveSpread.id)}else{if(g!=a&&D&&!a.getSpreadView().IsMultiColumnComboBox){g.ClearSelection(a,null,false);var o=g.getSpreadView();o.IsInTouchMode()&&o.AllowTapToAddSelection()&&o.SetAnchorCell(null)}spreadView.ActivateSpread(a,true)}if(g!=null&&!D){var j=g.getSpreadView();g.getAnchorCell()!=null&&j.IsInTouchMode()&&j.IsRetainSelection()&&j.GetTopSpreadView().Spread.GetActiveChartObj()==null&&setTimeout(function(){j.ShowFocusRectangle(true)},0)}c.FpActiveSpread!=element&&hideSelectionBlock()}if(c.FpActiveSpread!=null){c.FpActiveSpread.setActiveField(true);if(c.FpActiveSpread==element){var z=$$.utils.contains(element,c.activeElement,true);if(editor!=null&&!z){var E=spreadView.GetTopSpreadView();if(E.ActiveContextMenu==null&&E.ActiveDialog==null){anchorCell&&spreadView._IsCellHidden(anchorCell,true)&&scrollToCell(anchorCell);spreadView.NeedSetEditorFocusOnActiveCell()&&$$(editor).focus()}}else if(z&&spreadView.IsInTouchMode()){var x=getSpreadControl(c.activeElement);x!=null&&x!=element&&setTimeout(function(){var a=getSpreadControl(c.activeElement);a!=null&&a!=element&&spreadView.FocusSpread()},0)}}}e!=null&&e!=spreadView.GetActiveSpread()&&e.getSpreadView().OnSpreadLostActive(d)}catch(O){$$.DEBUG.Log(O,"setActiveSpread")}}function hideSelectionBlock(){if(!retainSelectionBlock){paintSelections(false);anchorCell!=null&&updateSelectedCell(anchorCell,[],false);var b=document.FpActiveSpread,a=b==null;if(!a)a=getTopSpread(b)!=getTopSpread(element)||b==element;a&&spreadView.HideFocusRectangle()}}function isExtenderPopupControl(d){var c=getFunction("ExtenderCellType_isExtenderPopupControl"),a=c?c(d,editor):"",b=a.length!=0;if(a=="AutoCompleteCellType")b&=editing;return b}function getCellOffsetX(b){if(b==null)return 0;var d=getViewport();if(d==null)return 0;var a=b,c=b.offsetLeft;if(b.parentElement.getAttribute("FpSpread")!="rh")c-=d.parentElement.scrollLeft;while(a.offsetParent!=null&&a.offsetParent!=element){c+=a.offsetParent.offsetLeft;a=a.offsetParent}return c}function getCellOffsetY(b){if(b==null)return 0;var d=getViewport();if(d==null)return 0;var a=b,c=b.offsetTop;if(b.parentElement.getAttribute("FpSpread")!="ch")c-=d.parentElement.scrollTop;while(a.offsetParent!=null&&a.offsetParent!=element){c+=a.offsetParent.offsetTop;a=a.offsetParent}return c}function getSpreadControl(c,d){var a=c;while(a!=null&&a.tagName!=null&&a.tagName!="BODY"){if(a.getAttribute("FpSpread")=="Spread"){if(!d){var b=c;while(b!=null&&b!=a){if(b.id==a.id+"_commandBar"||b.id==a.id+"_pager1"||b.id==a.id+"_pager2")return null;b=b.parentElement}}return a}a=a.parentElement}return null}function ScrollTo(d,c){var a=GetCellByRowCol(d>=0?d:~d,c>=0?c:~c);if(a==null)return;var b=getViewport().parentElement;b.fromScrollTo=true;var e=false;if(d>=0&&b.scrollTop!=a.offsetTop){b.scrollTop=a.offsetTop;e=true}if(c>=0&&b.scrollLeft!=a.offsetLeft){b.scrollLeft=a.offsetLeft;e=true}e&&!attachedScrollEvents&&scrollView()}function attachScrollEvents(a){detachScrollEvents(a);var b=getScrollvp();if(b!=null&&b._requiresSynchroningScroll){scrollView();b._requiresSynchroningScroll=false}if(b!=null&&b!=a)$$.j(b).on("scroll",vpscroll);var f=getParent(getViewport1());if(f!=null&&f!=a)$$.j(f).on("scroll",vp1Scroll);var g=getParent(getViewport2());if(g!=null&&g!=a)$$.j(g).on("scroll",vp2Scroll);var h=getParent(getViewport());if(h!=null&&h!=a)$$.j(h).on("scroll",scrollView);var e=getParent(getRowHeader());if(e!=null&&e!=a)$$.j(e).on("scroll",rheaderScroll);var d=getParent(getColHeader());if(d!=null&&d!=a)$$.j(d).on("scroll",cheaderScroll);var c=getParent(getColFooter());if(c!=null&&c!=a)$$.j(c).on("scroll",cFooterScroll);attachedScrollEvents=true}function detachScrollEvents(a){scrollvp!=null&&scrollvp!=a&&$$.j(scrollvp).off("scroll",vpscroll);var e=getParent(getViewport1());e!=null&&e!=a&&$$.j(e).off("scroll",vp1Scroll);var f=getParent(getViewport2());f!=null&&f!=a&&$$.j(f).off("scroll",vp2Scroll);var g=getParent(getViewport());g!=null&&g!=a&&$$.j(g).off("scroll",scrollView);var d=getParent(getRowHeader());d!=null&&d!=a&&$$.j(d).off("scroll",rheaderScroll);var c=getParent(getColHeader());c!=null&&c!=a&&$$.j(c).off("scroll",cheaderScroll);var b=getParent(getColFooter());b!=null&&b!=a&&$$.j(b).off("scroll",cFooterScroll);attachedScrollEvents=false}function reloadRowsInView(a,d){var c=a.scrollTop,e=newTop;newTop=getTopRow(c);var b=newPageCount;newPageCount=getRowsPerPage(newTop);if(e!=newTop||b!=newPageCount){var a=getViewport().parentNode,f=a.scrollTop;doUpdate(d)}}function getSafeMaxScrollValues(){for(var c={MaxScrollTop:Number.MAX_VALUE,MaxScrollLeft:Number.MAX_VALUE},d=[getScrollvp(),getParent(getViewport()),getParent(getViewport2()),getParent(getRowHeader())],b=0;b<d.length;b++){var a=d[b];if(a){var f=Math.max(a.scrollHeight-a.clientHeight,0);c.MaxScrollTop=Math.min(c.MaxScrollTop,f)}}for(var e=[getScrollvp(),getParent(getViewport()),getParent(getViewport1()),getParent(getColHeader()),getParent(getColFooter())],b=0;b<e.length;b++){var a=e[b];if(a){var f=Math.max(a.scrollWidth-a.clientWidth,0);c.MaxScrollLeft=Math.min(c.MaxScrollLeft,f)}}return c}var _oldScrollLeft=null,_oldScrollTop=null;function scrollView(b,e,c){if(_keepCurrentScrollValue>=0){var d=getViewport().parentNode;if(b)d=b.target;d.scrollTop=_keepCurrentScrollValue}else if(spreadView.keydownOnEditingTemplate){scrollToCell(anchorCell);spreadView.keydownOnEditingTemplate=false}else{var a=null;if(c)a={handler:c};__scrollView(b,e,a);a&&!a.callSynchronizeScroll&&a.handler()}}function __scrollView(f,w,c){if(ignoreMainScroll)return;var q=getTopSpread();if(q!=element)return;var e=getScrollvp(),r=getParent(q.getViewport()),z=f?f.target:null,a=z||r;if(a==null)return;if(spreadView.IsInTouchMode()&&$$.browser.isTouchEventModel&&f&&f.type!=null){var o=a.scrollWidth-a.clientWidth,p=a.scrollHeight-a.clientHeight,t,u,m=$$.j(a).data("FpLastMaxScrolls");if(m){t=m.horizontal;u=m.vertical}$$.j(a).data("FpLastMaxScrolls",{horizontal:o,vertical:p});if(a.scrollLeft<0||a.scrollTop<0||a.scrollLeft>o&&o>=t||a.scrollTop>p&&p>=u)return}if($$.browser.webkit&&spreadView.IsInsideViewport(a)&&a.scrollTop==0&&editing&&editor&&!$$.utils.contains(editor,window.document.activeElement,true)){a.scrollTop=scrollTop;return}var i=getSafeMaxScrollValues(),b=scrollTop,d=scrollLeft,j=null;if(a==r||a==e){b=a.scrollTop;d=a.scrollLeft}else if(a==getParent(getRowHeader())||a==getParent(getViewport2())){j="VerticalOnly";b=a.scrollTop}else{j="HorizontalOnly";d=a.scrollLeft}if(b>i.MaxScrollTop){b=i.MaxScrollTop;a.scrollTop=b}if(d>i.MaxScrollLeft){d=i.MaxScrollLeft;a.scrollLeft=d}if($$.browser.webkit){var v=window.document.getElementById(a.id+"_forcer");if(v){var y=v.getAttribute("direction");if(y=="vertical")a.scrollTop=0;else a.scrollLeft=0}}var h=spreadView._GetScrollValuesState();if(scrollTop==b&&scrollLeft==d){if(h==0)return;if(uiVirtualization&&(e.scrollTop!=scrollTop||e.scrollLeft!=scrollLeft)){if(e.onscroll==null)e.onscroll=vpscroll;return}}var l=scrollTop!=b||(h&2)==2,k=scrollLeft!=d||(h&1)==1,s=k||l;if(engine>=9&&e!=null){k=scrollLeft!=e.scrollLeft||(h&1)==1;l=scrollTop!=e.scrollTop||(h&2)==2;s=k||l;if(!s){a.scrollTop=scrollTop;a.scrollLeft=scrollLeft;if(getViewport2()!=null)getViewport2().parentNode.scrollTop=scrollTop;if(getViewport1()!=null)getViewport1().parentNode.scrollLeft=scrollLeft}}var n=null,g=false;if(_oldScrollLeft==null)_oldScrollLeft=scrollLeft;if(_oldScrollTop==null)_oldScrollTop=scrollTop;if(uiVirtualization){scrollTop=b;scrollLeft=d}var x=f?f.fromStartEdit:false;if(c)c.callSynchronizeScroll=true;spreadView.SynchronizeScroll(a,j,function(Q){if(uiVirtualization){scrollTop=_oldScrollTop;scrollLeft=_oldScrollLeft;_oldScrollTop=_oldScrollLeft=null}if(Q!=null){a.scrollTop=scrollTop;a.scrollLeft=scrollLeft;c&&c.handler&&c.handler();return}if(editing&&spreadView.IsInTouchMode()&&$$.utils.contains(spreadView.Spread,editor)){var C=getCell(editor);C&&spreadView._IsCellHidden(C)&&spreadView.TryStopEditing(false,false)}var K=spreadView._GetTimeoutTask("ProcessEditMode");if(scrollTop!=b){if(smartPaint&&!w){reloadRowsInView(a,x);if(editModePermanent&&!IsValid()){a.scrollTop=scrollTop;a.scrollLeft=scrollLeft;spreadView._SynchronizeScroll(a,j);reloadRowsInView(a,true);c&&c.handler&&c.handler();return}}n=scrollTop<b;g=true}if(editing)if($$.utils.contains(spreadView.Spread,editor)){var N=$$.j(editor).css("position")||editor.style.position,f=getCell(editor);if(N=="absolute"&&f!=null){var v=editor.offsetParent,G=f.getBoundingClientRect(),H=v.getBoundingClientRect();editor.style.top=G.top-H.top+v.scrollTop+f.clientTop+"px";editor.style.left=G.left-H.left+v.scrollLeft+f.clientLeft+"px"}if(f){var U=getCellType(f);if(U=="MultiColumnComboBoxCellType"){var P=editor.id+"_Obj",E=window[P];E&&E.ShowHideContainerInScroll()}}}else editor!=null&&spreadView.TryStopEditing(false,false);if(spreadView.EditModePermanent){var h=spreadView.Spread.getAnchorCell(),B,p=false;if(spreadView._IsCellHidden(h,true)&&((B=spreadView._GetViewportFromCell(h))==null||Math.floor(h.parentNode.getBoundingClientRect().left)!=Math.floor(h.getBoundingClientRect().left)||B.parentNode.clientWidth>h.offsetWidth)){spreadView.UnregisterTimeoutTask("ProcessEditMode");p=true}else{var F=spreadView._GetTimeoutTask("ProcessEditMode");if(F!=null)F.ReRegister();else if(K!=null)spreadView.ProcessEditModePermanent(200);else p=true}$$.browser.webkit&&p&&$$.utils.isTextControl(textBox)&&switchHiddenTextBox(true)}!IsValid()&&setValidatorPos();if(getParentSpread()==null){if(g){var O=scrollTop>b;if(element.getAttribute("virtualPaging")=="true"){var J=element.ignoreVirtualPaging?b:null;if(O)spreadView._SetSafeScrollingMIN(J);else spreadView._SetSafeScrollingMAX(J)}}var T=getColHeader()&&getColHeader().parentNode==a?true:null;saveScrollbarState(b,d,null,T)}if(s){var M=scrollTop,L=scrollLeft,R={spread:element,vertical:l,horizontal:k},W=$$.utils.createEvent("Scroll",false,true,R);element.dispatchEvent(W);if(smartPaint){if(M!=scrollTop)_oldScrollTop=scrollTop;if(L!=scrollLeft)_oldScrollLeft=scrollLeft}}scrollTop=b;scrollLeft=d;if(g&&n&&$$.browser.chrome&&!spreadView.AllowVirtualScrollPaging&&spreadView.IsLoadOnDemand&&(!spreadView.IsBackgroundMode||spreadView.IsOffsetBasedMode)&&element.getAttribute("AllRowsLoaded")!="true"){var m=[getViewport().parentNode];getViewport2()&&m.push(getViewport2().parentNode);getScrollvp()&&m.push(getScrollvp());for(var u=0;u<m.length;u++){var y=m[u],V=y.id+"_loadondemand",e=element.document.getElementById(V);if(!e){e=element.document.createElement("div");y.appendChild(e);e.id=y.id+"_loadondemand";e.innerHTML="&nbsp;";e.style.height="80px";e.style.width="1px"}}}var A=false,I=q.getViewport(),o=spreadView.GetAttribute("error")=="true"&&spreadView._LoadOnDemandTimerId==-1;if(!o&&spreadView._GetTopRowIndex()==spreadView._GetTopDisplayedTableRowIndex(false))o=true;var S=2;if(!o&&g&&n&&spreadView.IsLoadOnDemand&&!spreadView.AllRowsLoaded&&(!spreadView.IsBackgroundMode&&b+a.offsetHeight+S>=I.offsetHeight||spreadView.IsBackgroundMode&&spreadView.GetHiddenBottomRowCount()<=spreadView.LoadOffsetFromBottom))if(!editing||getEditor(anchorCell)!=null||smartPaint&&typeof element.forceLOD!="undefined"&&element.forceLOD){if(!spreadView.IsBackgroundMode){if(element.LoadState!=null){c&&c.handler&&c.handler();return}element.LoadState=true}A=true;saveData();if(!spreadView.IsBackgroundMode){var D=function(){LoadData(true,true)};if($$.browser.chrome&&!spreadView.IsBackgroundMode)_keepCurrentScrollValue=a.scrollTop;if(!spreadView._isRetrievingFilterBarMenus)setTimeout(D,0);else spreadView.RegisterDelayedRequest(Function.CreateDelegate(this,D))}else spreadView.LoadOnDemandInAction()}if(smartPaint&&typeof element.forceLOD!="undefined")element.forceLOD=null;if(!A&&!element.LoadState&&element.__scrollByEditing)element.__scrollByEditing=null;if(element.getAttribute("virtualPaging")=="true"&&g&&!element.ignoreVirtualPaging&&!element.virtualPagingProcessing&&isChild(I,r))if(spreadView.IsLoadOnDemand&&spreadView.IsBackgroundMode||spreadView.GetAttribute("loadOnDemand")!="true"){var i=scrollView,z=false;try{while(i.caller!=null){i=i.caller;var t=i.toString();callerFuncName=t.substring(t.indexOf("function")+9,t.indexOf("("))||"anoynmous";if(callerFuncName=="processData"){z=true;break}}}catch(W){}if(!z&&canMoveToPage().canMove){element.virtualPagingProcessing=true;setTimeout(doVirtualPaging,0)}}c&&c.handler&&c.handler()})}function doVirtualPaging(){var e=getTopSpread(),d=e.getViewport(),c=getParent(d);if(d==null||c==null)return;var a=c.scrollTop;if(element.virtualPagingCurrentScroll!=null&&a==element.virtualPagingCurrentScroll&&(!spreadView.IsInTouchMode()||spreadView.TryStopEditing())){var f=element.GetCurrentPageIndex(),b=canMoveToPage();if(b.canMove){element.getSpreadView().UnregisterTimeoutTask("ProcessEditMode");GotoPage(b.ToPage,true)}element.virtualPagingProcessing=false}else{element.virtualPagingCurrentScroll=a;setTimeout(doVirtualPaging,500)}}function canMoveToPage(){return spreadView._CanMoveToPage()}function LoadData(d,a){if(!a&&!editing&&element.getAttribute("loadOnDemand")=="true")smartPaint=false;if(!a&&spreadView.IsLoadOnDemand&&spreadView.IsBackgroundMode){spreadView._StopLoadOnDemandTimer();spreadView._DoLoadOnDemand()}else{var b=smartPaint&&!spreadView.IsBackgroundMode,c=0;CallBack("LoadOnDemand",d,!b?null:function(){c=(spreadView.Viewport2||spreadView.Viewport).rows.length;return true},!b?null:function(){spreadView.Rows!=null&&spreadView.Rows._LoadRows(c,getRowHeader(),spreadView.Viewport2||spreadView.Viewport)})}}function saveScrollbarState(e,d,g,a){if(!g&&!initialized)return;if(!spreadView._IsInitScrollbarState||getParentSpread()!=null)return;var c=xmlData.selectSingleNode("root scrollTop"),b=xmlData.selectSingleNode("root scrollLeft");if(!a)a=xmlData.textContent(b)!=d;var f=xmlData.textContent(c)!=e;if(element.getAttribute("scrollContent")&&!spreadView.ignoreShowScrollingContent)if(c!=null&&b!=null&&(a||f))if(a&&f){showScrollingContent(true);showScrollingContent(false)}else showScrollingContent(a);else lastPageIndex!=null&&currentPageIndex!=null&&lastPageIndex!=currentPageIndex&&showScrollingContent(false);c!=null&&e>=0&&xmlData.textContent(c,e);b!=null&&d>=0&&xmlData.textContent(b,d);dirty=true}function loadScrollbarState(c,d){if(getParentSpread()!=null)return;if(element.getAttribute("ClientAutoSize")=="True"&&(getParentSpread()!=null||spreadView.ClientAutoSizeMaxHeight()==0&&spreadView.ClientAutoSizeMaxWidth()==0))return;if(smartPaint&&(typeof d=="undefined"||!d))return;var a=xmlData.selectSingleNode("root scrollTop");if(a!=null&&xmlData.textContent(a)!="")a=parseFloat(xmlData.textContent(a));else a=0;if(!smartPaint)c.virtualPagingProcessing=false;var e=getViewport();a=a>0&&a>=c.virtualTop?a:a+c.virtualTop;var b=xmlData.selectSingleNode("root scrollLeft");if(b!=null&&xmlData.textContent(b)!="")b=parseFloat(xmlData.textContent(b));else b=0;if(isNaN(a))a=0;if(isNaN(b))b=0;if(!smartPaint)element.ignoreVirtualPaging=true;setScrollbarValues(smartPaint?null:a,b,function(){if(!smartPaint)element.ignoreVirtualPaging=false})}function getParent(a){return a==null?null:a.parentElement}var Range=GCWS.Range;function Margin(){this.left;this.top;this.right;this.bottom}function findContentTag(a){xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("[content='true']");xmlData.resetNodeContext();return b}function getRender(a){return fpSpreadJS.getRender(a)}var getCell=$$.utils.GetCell;function inFrozCols(a){return isChild(a,getFrozColHeader())||isChild(a,getViewport0())||isChild(a,getViewport2())}function inFrozRows(a){isChild(a,getFrozRowHeader())||isChild(a,getViewport0())||isChild(a,getViewport1())}function inRowHeader(a){return isChild(a,getFrozRowHeader())||isChild(a,getRowHeader())}function inColHeader(a){return isChild(a,getFrozColHeader())||isChild(a,getColHeader())}function isHeaderCell(a){return a!=null&&(a.tagName=="TD"||a.tagName=="TH")&&(a.parentElement.getAttribute("FpSpread")=="ch"||a.parentElement.getAttribute("FpSpread")=="rh")}function getRealColWidth(c,e){var a=c.__LastDisplayedColumn;if(a==null){a=c.getAttribute("LastDisplayedColumn");if(a==null)a=-1;c.__LastDisplayedColumn=a}var f=getColGroup(c),d=f.children[e],b;if(a>=0&&e==a){b=d.getAttribute("__originalWidth");if(b==null)b=d.width}else b=d.width;return parseInt(b)}function showSizeBar(e){var d=getSizeHeader();if(!(d||frzRows>0||frzCols>0))return;if(e){var a=getScrollvp();if(a==null)a=getViewport().parentElement;if(getRowHeader()!=null)sizeBar.style.width=getRowHeader().parentNode.offsetWidth+a.clientWidth+"px";else sizeBar.style.width=a.clientWidth+"px";sizeBar.style.cursor=getResizeCursor(true);sizeBar.style.height="2px";var b=0;if(!xhtml)b+=parseInt(element.style.borderWidth);$$(sizeBar).moveToPosition(element.getBoundingClientRect().left,activeY-b)}else{var a=getScrollvp();if(a==null)a=getViewport().parentElement;sizeBar.style.cursor=getResizeCursor(false);var b=0;if(!xhtml)b+=parseInt(element.style.borderWidth);var c=spreadView.ColumnHeader.IsVisible()?(frozColHeader||colHeader).getBoundingClientRect().top:(getViewportHolder()||getViewport().parentNode).getBoundingClientRect().top;$$(sizeBar).moveToPosition(activeX-b,c);if(getColHeader()!=null)sizeBar.style.height=getColHeader().offsetHeight+a.clientHeight+"px";else sizeBar.style.height=a.offsetHeight+"px";sizeBar.style.width="2px"}}function getSizeColumn(i,n){if(!n)n=window.event;var r=getSizeHeader();if(!r&&getColHeader()==null&&getFrozColHeader()==null)return null;if(i==null||i.tagName=="INPUT"||i.tagName=="TEXTAREA"||$$.utils.isSelectControl(i)||i.tagName=="BR")return null;if(!$$.utils.contains([getColHeader(),getFrozColHeader(),getRowHeader(),getFrozRowHeader()],i,true))return null;var f=3,a=-1,b=getCell(i),g=n.offsetX||n.clientX-(b?b.getBoundingClientRect().left:0);while(b!=null&&b.parentElement!=null){if(b.parentElement.getAttribute("FpSpread")=="ch"){if(g<f&&getOffsetLeft(i,b)<f)a=getColFromCell(b)-1;else if(g>b.offsetWidth-(f+1)){a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,colSpanCells);if(d!=null)a=d.col+d.colCount-1}else{a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,colSpanCells);if(d!=null){var j=0;a=-1;for(var e=d.col;e<d.col+d.colCount&&e<GetColCount();e++){if(isChild(b,getColHeader()))j+=getRealColWidth(getColHeader(),e-frzCols);else j+=getRealColWidth(getFrozColHeader(),e);if(g>j-f&&g<j+f){a=e;break}}}else a=-1}if(isNaN(a)||a<0)return null;var k=0,m=GetColCount(),l=true,t=null,c=a+1;while(c<m){if(c>=frzCols){var o=getColGroup(getColHeader());if(c-frzCols<o.children.length)k=getRealColWidth(getColHeader(),c-frzCols)}else{var o=getColGroup(getFrozColHeader());if(c<o.children.length)k=getRealColWidth(getFrozColHeader(),c)}if(k>1){l=false;break}c++}if(l){c=a+1;while(c<m){if(getSizable(c)){a=c;break}c++}}return!getSizable(a)?null:isChild(b,getColHeader())?g<f&&a+1==frzCols&&b.cellIndex==0&&getFrozColHeader()!=null?window.document.getElementById(element.id+"col"+(frzCols-1)):window.document.getElementById(element.id+"col"+a):window.document.getElementById(element.id+"col"+a)}else if(b.parentElement.getAttribute("FpSpread")=="rh"){if(!getSizeHeader())return null;var h=getColGroup(getRowHeader());if(h==null||h.children.length==0)return null;if(g<f)a=getColFromCell(b)-1;else if(g>b.offsetWidth-(f+1)){a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,rowSpanCells);if(d!=null)a=d.col+d.colCount-1}else{a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,rowSpanCells);if(d!=null){var j=0;a=-1;for(var s=h.children.length,e=d.col;e<d.col+d.colCount&&e<s;e++){j+=parseInt(h.children[e].width);if(g>j-f&&g<j+f){a=e;break}}}else a=-1}if(isNaN(a)||a<0)return null;var k=0,m=h.children.length,l=true,c=a+1;while(c<m){var q=h.children[c];if(q!=null)k=parseInt(q.width);if(k>1){l=false;break}c++}if(l){c=a+1;while(c<m){if(getSizable(h.children[c])){a=c;break}c++}}var p=h.children[a];return!getSizable(p)?null:p}b=b.parentElement}return null}function getElementById(c,b){if(c==null)return null;var a=xmlData.firstElementChild(c,true);while(a!=null){if(a.id==b||a.getAttribute("name")==b)return a;var d=getElementById(a,b);if(d!=null)return d;a=xmlData.nextElementSibling(a,true)}return null}function getSizeRow(f,o){var l=GetRowCount();if(l==0)return null;if(element.getAttribute("layoutMode"))return null;if(f==null||f.tagName=="INPUT"||f.tagName=="TEXTAREA"||$$.utils.isSelectControl(f))return null;if(!$$.utils.contains([getColHeader(),getFrozColHeader(),getRowHeader()?getRowHeader().parentNode:null,getFrozRowHeader()],f,true))return null;if(!o)o=window.event;var e=3,g=o.offsetY||o.pageY-$$.j(o.target).offset().top,j=getCell(f);if(j==null){if(f.getAttribute("FpSpread")=="rowpadding"){if(g<e){var q=[getRowHeader(),getFrozRowHeader()];$$.utils.cleanArray(q);for(var i=0;i<q.length;i++){var r=q[i],l=r.rows?r.rows.length:0;if(l>0){var u=r.rows[l-1];if(getSizable(u))return u}}}if(f!=null&&f.style!=null&&(f.getAttribute("FpSpread")=="rowpadding"||f.getAttribute("ControlType")=="chgrayarea"))f.style.cursor=getgrayAreaCursor()}var t=getCorner();if(t!=null&&$$.utils.contains(t,f,false))if(g>f.offsetHeight-(e+1)){var b=getFrozRowHeader(),a=0;if(b!=null){while(a<b.rows.length&&b.rows[a].offsetHeight<e-1&&!getSizable(b.rows[a]))a++;if(a<b.rows.length&&getSizable(b.rows[a])&&b.rows[a].offsetHeight<e-1)return b.rows[a]}b=getRowHeader();if(b!=null){while(a<b.rows.length&&b.rows[a].offsetHeight<e-1&&!getSizable(b.rows[a]))a++;if(a<b.rows.length&&getSizable(b.rows[a])&&b.rows[a].offsetHeight<e-1)return b.rows[a]}}else f.style.cursor="";return null}var n=isChild(j,getFrozRowHeader()),d=j;while(d!=null){if(d.getAttribute("FpSpread")=="rh"){var a=-1,m=0;if(n)m=getFrozRowHeader().cellSpacing;else m=getRowHeader().cellSpacing;if(g<e&&getOffsetTop(f,d)-d.offsetTop<m+e){if(d.rowIndex>0)a=d.rowIndex-1;else if(d.rowIndex==0&&!n&&getFrozRowHeader()!=null){n=true;a=frzRows-1}}else if(g>getOffsetHeight(d)-(e+1)-m){var k=getSpanCell(getRowFromCell(j),getColFromCell(j),rowSpanCells);if(k!=null)for(var h=0,i=k.row;i<k.row+k.rowCount;i++){if(n)h+=getOffsetHeight(getFrozRowHeader().rows[i]);else h+=getOffsetHeight(getRowHeader().rows[i-frzRows]);if(g>h-e&&g<h+e){a=i;break}}else if(d.rowIndex>=0)a=d.rowIndex}else break;var h=0,l=getRowHeader().rows.length;if(n)l=getFrozRowHeader().rows.length;var p=true,b=null;if(n)b=getFrozRowHeader();else b=getRowHeader();var c=a+1;while(c<l){if(b.rows[c].style.height!="")h=$$(b.rows[c]).height();else h=getOffsetHeight(b.rows[c]);if(h>1){p=false;break}c++}if(p){c=a+1;while(c<l){if(getSizable(getRowHeader().rows[c])){a=c;break}c++}}if(a>=0&&getSizable(b.rows[a]))return b.rows[a];else if(g<e){while(a>1&&getOffsetHeight(b.rows[a])==0&&!getSizable(b.rows[a]))a--;return a>=0&&getSizable(b.rows[a])?b.rows[a]:null}}else if(d.getAttribute("FpSpread")=="ch"){if(!getSizeHeader())return;var b=getColHeader();if(b==null)return null;if(getColFromCell(j)==GetColCount())return null;var s=GCWS.FilterEditor.GetEditor(o.target);if(s!=null)g+=s.offsetTop-s.parentNode.offsetTop;var m=0;if(getFrozColHeader()!=null)m=getFrozColHeader().cellSpacing;else m=getColHeader().cellSpacing;var a=-1;if(g<e){if(d.rowIndex>0)a=d.rowIndex-1}else if(g>getOffsetHeight(d)-(e+1)-m){var k=getSpanCell(getRowFromCell(j),getColFromCell(j),colSpanCells);if(k!=null)for(var h=parseInt(b.cellSpacing),i=k.row;i<k.row+k.rowCount;i++){h+=$$(b.rows[i]).height();if(g>h-e&&g<h+e){a=i;break}}else if(d.rowIndex>=0)a=d.rowIndex}else break;var h=0,l=b.rows.length,p=true,c=a+1;while(c<l){if(b.rows[c].style.height!="")h=$$(b.rows[c]).height();else h=getOffsetHeight(b.rows[c]);if(h>1){p=false;break}c++}if(p){c=a+1;while(c<l){if(getSizable(b.rows[c])){a=c;break}c++}}if(a>=0&&getSizable(b.rows[a]))return b.rows[a];else if(g<e){while(a>1&&getOffsetHeight(b.rows[a])==0&&!getSizable(b.rows[a]))a--;return a>=0&&getSizable(b.rows[a])?b.rows[a]:null}}d=d.parentElement}j.style.cursor="";return null}function getSizable(b){var a;if(typeof b=="number")if(b<frzCols){var c=window.document.getElementById(element.id+"col"+b);return c!=null&&((a=c.getAttribute("Sizable"))==null||a=="True")}else{var c=window.document.getElementById(element.id+"col"+b);return c!=null&&((a=c.getAttribute("Sizable"))==null||a=="True")}return b!=null&&((a=b.getAttribute("Sizable"))==null||a=="True")}function getSpanWidth(c,f){var e=0,a=getViewport2();if(a==null)a=getViewport0();if(frzCols>0&&c<frzCols&&a!=null){var d=getColGroup(a);if(d!=null)for(var b=c;b<c+f&&b<frzCols;b++)e+=parseInt(d.children[b].width)}a=getViewport();if(a==null)a=getViewport1();var d=getColGroup(a);if(d!=null)for(var b=Math.max(c,frzCols);b<c+f;b++)e+=parseInt(d.children[b-frzCols].width);return e}function getCellType(a,d){var b=a!=null?a.getAttribute("FpCellType"):null;if(d)if(b=="readonly"&&a.getAttribute("locked")!="true"&&a.getAttribute("CellType")!=null)return a.getAttribute("CellType");if(b!=null&&(!d||a.getAttribute("FpRef")==null))return b;if(a!=null&&a.getAttribute("FpRef")!=null){var c=element.document;if(!c.getElementById)c=window.document;var e=c.getElementById(a.getAttribute("FpRef"));return e.getAttribute("FpCellType")}return b||"text"}function getCellType2(b){if(b!=null&&b.getAttribute("FpRef")!=null){var c=element.document;if(!c.getElementById)c=window.document;b=c.getElementById(b.getAttribute("FpRef"))}var a=null;if(b!=null){a=b.getAttribute("FpCellType");if(typeof a=="undefined"||a==null||a=="readonly")a=b.getAttribute("CellType");if(a==null)a=b.getAttribute("CellType2")}return a!=null?a:"text"}function getCellEditorID(a){if(a!=null&&a.getAttribute("FpRef")!=null){var b=element.document;if(!b.getElementById)b=window.document;var d=b.getElementById(a.getAttribute("FpRef")),c=d.getAttribute("FpEditorID");if(c==null)c=element.getAttribute("FpDefaultEditorID");return c}return a!=null&&a.getAttribute("FpEditorID")!=null?a.getAttribute("FpEditorID"):element.getAttribute("FpDefaultEditorID")}function EditorMap(a,b){this.id=a;this.editor=b}function ValidatorMap(a,b){this.id=a;this.validator=b}function getCellEditor(c,f){for(var a=null,d=0;d<editorList.length;d++){var e=editorList[d];if(e.id==c){a=e.editor;break}}if(a==null){var b=element.document;if(!b.getElementById)b=window.document;a=b.getElementById(c);editorList[editorList.length]=new EditorMap(c,a)}return f?a:a.cloneNode(true)}function getCellValidatorID(a){return a==null?null:a.getAttribute("FpValidatorID")}function getCellValidator(b){for(var a=null,c=0;c<validatorList.length;c++){var e=validatorList[c];if(e.id==b){a=e.validator;break}}if(a==null){var d=element.document;if(!d.getElementById)d=window.document;a=window.document.getElementById(b);validatorList[validatorList.length]=new ValidatorMap(b,a)}return a}function getTableRow(c){var a=xmlData.selectSingleNode("data");if(a==null)return null;xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("row[key='"+c+"']");xmlData.resetNodeContext();return b}function getTableCell(a,c){if(a==null)return null;xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("cell[key='"+c+"']");xmlData.resetNodeContext();return b}function addTableRow(b){if(b==null)return null;var a=getTableRow(b);if(a!=null)return a;var c=xmlData.selectSingleNode("data");if(c==null)return null;a=xmlData.createElement("row");a.setAttribute("key",b);c.appendChild(a);return a}function addTableCell(b,c){if(b==null)return null;var a=getTableCell(b,c);if(a!=null)return a;a=xmlData.createElement("cell");if(c==null)a.setAttribute("key","");else a.setAttribute("key",c);b.appendChild(a);return a}function getCellValue(b,c){if(b==null)return null;var e=getRowKeyFromCell(b),d=element.getAttribute("layoutMode")?getColKeyFromCell2(b):getColKeyFromCell(b),a=getTableCell(getTableRow(e),d);return a!=null?c&&a.getAttribute("type")!=null?{value:xmlData.textContent(a),isXmlValue:true}:xmlData.textContent(a):null}function setCellValue(a,b,o,p){if(a==null)return;if(b==" ")a.setAttribute("whiteSpace","1");else a.removeAttribute("whiteSpace");a.getAttribute("specialValue")!=null&&a.removeAttribute("specialValue");if(b==""){var k=getCellEditorID(a);if(k!=null){var j=getCellEditor(k,true);j!=null&&$$.utils.isSelectControl(j)&&a.setAttribute("specialValue","1")}}var n=getCellType(a);if(n=="readonly"&&a.getAttribute("locked")=="true"&&a.getAttribute("CellType2")!="MutuallyExclusiveCheckBoxCellType")return;var i=getRowKeyFromCell(a),g=element.getAttribute("layoutMode")?getColKeyFromCell2(a):getColKeyFromCell(a);if(i==null||g==null)return;var e=addTableCell(addTableRow(i),g);if(b.getFullYear){b=spreadView.GetDateValueXmlString(b);e.setAttribute("type","Date")}else if(typeof b=="number")e.setAttribute("type","Number");else e.removeAttribute("type");xmlData.textContent(e,b);if(!o){fireDataChangedEvent(a,b,element,i,g);var l=getTopSpread(element);l!=element&&l.fireDataChangedEvent(a,b,element,i,g)}if(smartPaint){var f=getRowFromCell(a)-frzRows,m=getViewport(),q=getViewport2(),c=null;if(isChild(a,m)){saveRowsImp(m,f,1,vpList);c=vpList.getRow(f)}else if(isChild(a,q)){saveRowsImp(viewport2,f,1,vp2List);c=vp2List.getRow(f)}if(c!=null)for(var h=0;h<c.cells.length;h++){var d=$$.utils.cloneNode(c.cells[h]);if(d.paintSelected=="null")d.paintSelected=null;c.replaceChild(d,c.cells[h]);paintSelectedCell(d,false,false)}}spreadView.GetCommandBar().EnableButton("Update",true);spreadView.GetCommandBar().EnableButton("Cancel",true);dirty=true;p&&updateValues()}function clearCellData(){var f=xmlData.selectSingleNode("data");if(f==null)return null;if(dataBuff!=null){var c=xmlData.firstChild(dataBuff);while(c!=null){var j=c.getAttribute("key"),d=xmlData.firstChild(c);while(d!=null){var i=d.getAttribute("key"),a=xmlData.firstChild(f);while(a!=null){var h=a.getAttribute("key");if(j==h){var e=false,b=xmlData.firstChild(a);while(b!=null){var g=b.getAttribute("key");if(i==g){a.removeChild(b);e=true;break}b=xmlData.nextSibling(b)}if(e)break}a=xmlData.nextSibling(a)}d=xmlData.nextSibling(d)}c=xmlData.nextSibling(c)}}dataBuff=null;spreadView.GetCommandBar().EnableButton("Cancel",false)}function storePostData(){var a=xmlData.selectSingleNode("data");if(a!=null)dataBuff=a.cloneNode(true)}function GetSelectedRanges(f){for(var g=getSelection(),a=[],c=g.childNodes,b=0,h=c.length;b<h;b++){var i=c[b],d=new Range;getRangeFromNode(i,d,f);var e=a.length;a.length=e+1;a[e]=d}return a}function GetSelectedRange(){var c=new Range,a=getSelection();if(a!=null){var b=xmlData.lastChild(a);b!=null&&getRangeFromNode(b,c)}return c}function getRangeFromNode(a,i,n){if(a==null||i==null)return;i.anchor=a.getAttribute("anchor")!=null;updateSelectionViewIndexes(a);var b=parseInt(a.getAttribute("rowIndex")),f=parseInt(a.getAttribute("colIndex")),c=parseInt(a.getAttribute("rowcount")),h=parseInt(a.getAttribute("colcount")),e;if(frzRows==0&&frzCols==0&&!n){var g=getViewport();if(g!=null){for(var m=b,j=m;j<m+c;j++)if(IsChildSpreadRow(g,j))c--;b=GetSheetIndex(b,g)}}if(element.getAttribute("layoutMode")){var l=parseInt(a.getAttribute("col"));if(l!=-1&&parseInt(a.getAttribute("row"))==-1&&c==-1){b=parseInt(a.getAttribute("row"));e=parseInt(a.getAttribute("rowIndex"));if(e==-1){var o=getRowKeyFromRow(0),k=getCellByRowCol2(o,l);if(k)e=getRowFromCell(k)}}}var d=null;if(b<0&&f<0&&c!=0&&h!=0)d="Table";else if(b<0&&f>=0&&h>0)d="Column";else if(f<0&&b>=0&&c>0)d="Row";else d="Cell";i.Set(d,b,f,c,h,e)}function getSelection(){return xmlData.selectSingleNode("selection")}function getRowKeyFromRow2(b){var a=getRowKeyFromRow(b);return a==null?-1:a}function getRowKeyFromRow(b){if(b<0)return null;var a=null;if(b<frzRows){a=getViewport0();if(a==null)a=getViewport1()}else{a=getViewport2();if(a==null)a=getViewport()}if(b>=frzRows)b-=frzRows;return a.rows[b]==null&&a.rows[b]==null?-1:a.rows[b]!=null?a.rows[b].getAttribute("FpKey"):a.rows[b].getAttribute("FpKey")}function getColKeyFromCol(b){if(b<0)return null;var a=null;if(b>=frzCols){a=getViewport1();if(a==null)a=getViewport();if(a==null)a=getColHeader()}else{a=getViewport0();if(a==null)a=getViewport2();if(a==null)a=getFrozColHeader()}if(b>=frzCols)b=b-frzCols;var c=getColGroup(a);return c!=null&&b>=0&&b<c.children.length?c.children[b].getAttribute("FpCol"):null}function getColKeyFromCol3(b){var a=getColKeyFromCol(b);return a==null?-1:a}function getColGroup(b){if(b==null)return null;var a=b.getElementsByTagName("COLGROUP");return a!=null&&a.length>0?a[0]:null}function getRowKeyFromCell(a){return a.parentElement.getAttribute("FpKey")}function getColKeyFromCol2(c,b){var a=getCellFromRowCol(c,b);return a?getColKeyFromCell2(a):b}function getColKeyFromCell2(a){return!a?-1:a.getAttribute("col")?a.getAttribute("col")=="-1"?"0":a.getAttribute("col"):getColKeyFromCell(a)}function getRowTemplateRowFromCell(a){if(!a)return-1;try{var b;if(a.getAttribute("group")!=null)b=getRowTemplateRowFromGroupCell(a);else b=parseInt(a.parentElement.getAttribute("row"));return b}catch(c){$$.DEBUG.Log(c,"getRowTemplateRowFromCell");return-1}}function getRowTemplateRowFromGroupCell(b,k){var l=GetColCount(),h=getColHeader();if((!element.getAttribute("allowGroup")||k)&&h!=null)for(var f=0;f<h.rows.length;f++)for(var i=0;i<l;i++){var j=h.rows[f].cells[i],g=isNaN(b)?parseInt(b.getAttribute("col")):b;if(j!=null&&b!=null&&parseInt(j.getAttribute("col"))==g)return f}var d=getViewport1();if(d!=null)for(var a=0;a<d.rows.length;a++)for(var c=0;c<d.rows[a].cells.length;c++){var g=isNaN(b)?parseInt(b.getAttribute("col")):b;if(d.rows[a].cells[c].getAttribute("col")==g&&d.rows[a].cells[c].getAttribute("group")==null)return parseInt(d.rows[a].getAttribute("FpKey"))}var e=getViewport();if(e!=null)for(var a=0;a<e.rows.length;a++)for(var c=0;c<e.rows[a].cells.length;c++){var g=isNaN(b)?parseInt(b.getAttribute("col")):b;if(e.rows[a].cells[c].getAttribute("col")==g&&e.rows[a].cells[c].getAttribute("group")==null)return parseInt(e.rows[a].getAttribute("FpKey"))}return-1}function getColTemplateRowFromGroupCell(e){var g=GetColCount(),a=getColHeader(),h=getRowTemplateRowFromGroupCell(e,true),f=null;if(a==null)return-1;for(var c=0;c<a.rows.length;c++)for(var d=0;d<g;d++){var b=a.rows[c].cells[d];if(b!=null&&parseInt(b.getAttribute("col"))==e){f=b;break}}return getColFromCell(f)}function getRowTemplateRowFromGroupCell2(c){var d=getViewport1();if(d!=null)for(var a=0;a<d.rows.length;a++)for(var b=0;b<d.rows[a].cells.length;b++){var f=isNaN(c)?parseInt(c.getAttribute("col")):c;if(d.rows[a].cells[b].getAttribute("col")==f&&d.rows[a].cells[b].getAttribute("group")==null)return parseInt(d.rows[a].getAttribute("FpKey"))}var e=getViewport();if(e!=null)for(var a=0;a<e.rows.length;a++)for(var b=0;b<e.rows[a].cells.length;b++){var f=isNaN(c)?parseInt(c.getAttribute("col")):c;if(e.rows[a].cells[b].getAttribute("col")==f&&e.rows[a].cells[b].getAttribute("group")==null)return parseInt(e.rows[a].getAttribute("FpKey"))}return-1}function getCellByRowCol2(c,b){if(c==null||b==null||c.length<=0||b.length<=0||c=="-1"||b=="-1")return null;var d=getRowByKey(c,-1);if(d==-1)return null;for(var h=element.getAttribute("LayoutMode")!=null?parseInt(element.getAttribute("LayoutRowCount")):1,f=d;f<d+h;f++)for(var g=getTableRows(f),a=0;a<g.length;a++)for(var e=g[a],a=0;a<e.cells.length;a++)if(e.cells[a].getAttribute("col")==b)return e.cells[a];return null}function getTableRows(c){var d=[],a=[getViewport0(),getViewport1()];if(c>=frzRows){c-=frzRows;a=[getViewport2(),getViewport()]}for(var b=0;b<a.length;b++)a[b]!=null&&a[b].rows[c]!=null&&d.push(a[b].rows[c]);return d}function paintMultipleRowSelection(l,h,f,d,e,i){if(spreadView.IsSuspendPaintSelection())return;for(var k=GetRowCountInternal(),j=GetColCount(),g=true,a=0;a<k;a++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(getViewport(),a))continue;for(var c=null,b=h;b<h+d&&b<j;b++){if(isCovered(a,b,spanCells))continue;c=getCellFromRowCol(a,b,c);if(c!=null&&parseInt(c.parentElement.getAttribute("row"))==l){paintViewportSelection(a,b,f,d,e);getColHeader()!=null&&operationMode=="Normal"&&g&&paintHeaderSelection(a,b,f,d,e,true);getRowHeader()!=null&&paintHeaderSelection(a,b,f,d,e,false);g=false}}}!i&&paintAnchorCell()}function getRowFromViewPort(b,e){if(b<0||e<0)return null;var a=null;if(b<frzRows)a=getViewport1();else a=getViewport();if(b>=0&&b<a.rows.length)for(var c=0;c<a.rows.length;c++){var d=a.rows[c].getAttribute("row");if(d!=null&&parseInt(d)==b)return c}return 0}function getFirstRowFromKey(b){var a=getRowByKey(b,-1);return a>-1?a:null}function getFirstMultiRowFromViewport(f,h){var a=null,c=null;if(f<frzRows)a=getViewport1();else a=getViewport();if(!h){c=getRowKeyFromRow(f);if(c!=null)return getRowByKey(c,-1)}for(var g=parseInt(element.getAttribute("layoutRowCount")),e,b=0;b<a.rows.length;b++){e=0;if(c!=null){if(a.rows[b].getAttribute("FpKey")==c)return frzRows!=null&&f<frzRows?b:b+frzRows}else for(var d=b+1;d<a.rows.length;d++){if(a.rows[b]!=null&&a.rows[d]!=null&&a.rows[b].getAttribute("FpKey")==a.rows[d].getAttribute("FpKey"))e++;if(e==g-1)return b}}}function getDisplayIndex(b){if(b==null)return-1;if(!element.getAttribute("allowGroup"))return b!=null?GetDisplayIndex(b):0;else{var d=getViewport1();if(d!=null)for(var a=b;a<d.rows.length;a++)if(d.rows[a].getAttribute("row")==b)return a;var c=getViewport();if(c!=null)for(var a=b;a<c.rows.length;a++){if(IsChildSpreadRow(c,a))continue;if(c.rows[a].getAttribute("row")==b)return a}}return-1}function getColKeyFromCell(c){var a=getColFromCell(c);if(a>=frzCols){vp=getViewport();if(vp==null||!isChild(c,vp))vp=getViewport1();var b=getColGroup(vp);if(b!=null&&a-frzCols>=0&&a-frzCols<b.children.length)return b.children[a-frzCols].getAttribute("FpCol")}else{vp=getViewport0();if(vp==null||!isChild(c,vp))vp=getViewport2();var b=getColGroup(vp);if(b!=null&&a>=0&&a<b.children.length)return b.children[a].getAttribute("FpCol")}return null}function setSelection(c,b,j,i,g,e,h){var o=xmlData.selectSingleNode("selection");if(o==null)return;if(j==-1&&e!=null)e=-1;if(i==-1&&h!=null)h=-1;var d=c,m=h==null?b:h;if(typeof c!="undefined"&&parseInt(c)>=0){c=getRowKeyFromRow(c);if(c!="newRow")c=parseInt(c)}if(typeof b!="undefined"&&parseInt(b)>=0)if(element.getAttribute("layoutMode")){var p=d>-1?d:e;if(p>-1){var q=getCellFromRowCol(p,m);if(q&&q.getAttribute("col")!="-1")b=parseInt(getColKeyFromCol2(d,b));else b=-1}}else b=parseInt(getColKeyFromCol(b));if(element.getAttribute("layoutMode")&&e!=null)d=e;if(g==null)g=element.getAttribute("multiRange")=="true"&&(!spreadView.IsInTouchMode()||spreadView._RequireAddSelection());var f=true,a=xmlData.lastChild(o);if(a==null||g){a=createSelectionNode(c,b,j,i,d,m);o.appendChild(a)}else{a.setAttribute("row",c);a.setAttribute("col",b);a.setAttribute("rowcount",j);a.setAttribute("colcount",i);a.setAttribute("rowIndex",d);a.setAttribute("colIndex",m)}if(!g&&spreadView.__previousSelectionNode){var n=["row","col","rowcount","colcount","rowIndex","colIndex"];f=false;for(var l=0;!f&&l<n.length;l++)if(spreadView.__previousSelectionNode.getAttribute(n[l])!=a.getAttribute(n[l]))f=true}(j>1||i>1)&&a.removeAttribute("anchor");dirty=true;spreadView.GetCommandBar().EnableButton("Update",true);inactiveAllChart(element);if(f||spreadView.IsMultiColumnComboBox){fireSelectionChangedEvent(element);var k=getTopSpread(element);if(k!=element)k.inactiveAllChart(k),k.fireSelectionChangedEvent(element)}spreadView.ShowFocusRectangle(true);!(selectType=="c"&&activeElement!=null&&$$.utils.isSelectControl(activeElement))&&!($$.utils.isTextControl(activeElement)&&IsInRowEditTemplate(activeElement)&&activeElement.style.imeMode!="")&&fpSpreadJS.setImeMode(element,textBox,anchorCell)}function createSelectionNode(g,f,d,b,e,c){var a=xmlData.createElement("range");a.setAttribute("row",g);a.setAttribute("col",f);a.setAttribute("rowcount",d);a.setAttribute("colcount",b);a.setAttribute("rowIndex",e);a.setAttribute("colIndex",c);return a}function addRowToSelection(d,a){if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))return;var b=a;if(typeof a!="undefined"&&parseInt(a)>=0){a=getRowKeyFromRow(a);if(a!="newRow")a=parseInt(a)}if(!isRowSelected(a)&&!isNaN(a)){var c=createSelectionNode(a,-1,1,-1,b,-1);d.appendChild(c)}}function RemoveSelection(e,j,i){var d=xmlData.selectSingleNode("selection");if(d==null)return;var h=spreadView.IsInTouchMode(),a=xmlData.firstChild(d);while(a!=null){var b,c;if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect")){var k=parseInt(a.getAttribute("row"));b=getFirstRowFromKey(k)}else b=parseInt(a.getAttribute("rowIndex"));if(element.getAttribute("layoutMode")&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))c=parseInt(element.getAttribute("layoutRowCount"));else c=parseInt(a.getAttribute("rowcount"));if(b<=e&&e<b+c){d.removeChild(a);if(!h||j!=-1||b!=e||i!=c)for(var f=b;f<b+c;f++)f!=e&&addRowToSelection(d,f);break}a=xmlData.nextSibling(a)}dirty=true;spreadView.GetCommandBar().EnableButton("Update",true);fireSelectionChangedEvent(element);var g=getTopSpread(element);g!=element&&g.fireSelectionChangedEvent(element)}function updateSelectionViewIndexes(c){if(c.getAttribute("rowIndex")==null||c.getAttribute("colIndex")==null){var a=c.getAttribute("row"),f=parseInt(c.getAttribute("col")),e=a==-1?-1:null,d=f==-1?-1:null;if(element.getAttribute("layoutMode")){var b=null;if(f>-1)if(a=="newRow"||parseInt(a)>-1){b=getCellByRowCol2(a,f);if(b){e=getRowFromCell(b);d=getColFromCell(b)}}else{b=getFirstCellFromCol(c.getAttribute("col"));if(b)d=getColFromCell(b)}else if(a=="newRow"||parseInt(a)>-1)e=getFirstRowFromKey(a)}else{if(a=="newRow"||parseInt(a)>-1)e=getRowByKey(a,-1);if(f>-1)d=getColByKey(f,-1)}e!=null&&c.setAttribute("rowIndex",e);d!=null&&c.setAttribute("colIndex",d)}}function getColInfo(d,f){var c=null;if(f)return xmlData.selectSingleNode("colinfo col[key='"+d+"'][header='true']");else{var a=xmlData.selectNodes("colinfo col[key='"+d+"']");if(a!=null)for(var b=0;b<a.length;b++){var e=a[b];if(e.getAttribute("header")!="true"){c=e;break}}}return c}function getColWidthFromCol(b){if(b<0)return 0;if(b<frzCols){var a=getColGroup(getViewport0());if(a==null||a.children.length==0)a=getColGroup(getViewport2());if(a==null||a.children.length==0)a=getColGroup(getFrozColHeader());return a!=null&&b<a.children.length?parseInt(a.children[b].width):0}else{var a=getColGroup(getViewport1());if(a==null||a.children.length==0)a=getColGroup(getViewport());if(a==null||a.children.length==0)a=getColGroup(getColHeader());return a!=null&&b-frzCols<a.children.length?parseInt(a.children[b-frzCols].width):0}}function getColWidth(a){if(a==null)return null;xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("width");xmlData.resetNodeContext();return b!=null?xmlData.textContent(b):null}function addColInfo(d,b){var e=false;if(b)e=true;var a=getColInfo(d,e);if(a!=null)return a;var c=xmlData.selectSingleNode("colinfo");if(c==null)return null;a=xmlData.createElement("col");a.setAttribute("key",d);b&&a.setAttribute("header","true");c.appendChild(a);return a}function setTableColumnWidth(a,d,c,e){var b=getColGroup(a);if(b==null)return;if(e){var f=parseInt(b.children[d].width)-c;a.style.width=parseInt(a.style.width)-f+"px"}b.children[d].width=c}function getFrozViewportColWidth(b){var c=0,a=getColGroup(getFrozColHeader());if(a==null||a.children.length==0)a=getColGroup(getViewport0());if(a==null||a.children.length==0)a=getColGroup(getViewport2());if(a!=null&&0<=b&&b<a.children.length)c=parseInt(a.children[b].width);return c}function setColWidth(f,e,c,a,b){if(arguments.length<4)a=true;var d=setColWidthInternal(f,e,c,a);(b==null||b)&&spreadView.UpdateUI();return d}function setColWidthInternal(a,b,l,r){if(a==null)return false;a=parseInt(a);if(b<10)b=10;var u=0,m=null;if(l!=null)m=b-l;var c=null,t=getColWidthFromCol(a),n=a,k=a<frzCols?[getFrozColHeader(),getViewport0(),getViewport2(),getFrozColFooter()]:[getColHeader(),getViewport1(),getViewport(),getColFooter()];$$.utils.cleanArray(k);restoreTableWidth(k,a);if(a<frzCols){var h=l;if(h==null)h=getFrozViewportColWidth(a);m=b-h;spreadView.ColumnHeader.SetColumnWidth(a,b);spreadView.ColumnFooter.SetColumnWidth(a,b);viewport0&&setTableColumnWidth(viewport0,a,b);viewport2&&setTableColumnWidth(viewport2,a,b);var p=viewport0||viewport2;if(p!=null){var d=getColGroup(p);if(d.children.length==0)d=getColGroup(getFrozColHeader());c=addColInfo(d.children[a].getAttribute("FpCol"))}if(getFrozColHeader()!=null){var o=window.document.getElementById(element.id+"_hidencol2");o.style.width=$$(o).width()+b-h+"px";var q=getFrozColHeader().parentElement,j=getColGroup(topTable);if(j!=null){var s=getRowHeader()!=null||getFrozRowHeader()!=null;j.children[s?1:0].width=parseInt(j.children[q.parentNode.cellIndex].width)+(b-h)}if(b<=0)b=1;window.document.getElementById(element.id+"col"+a).width=b}}else{spreadView.ColumnHeader.SetColumnWidth(a,b);spreadView.ColumnFooter.SetColumnWidth(a,b);a-=frzCols;if(viewport!=null){var d=getColGroup(getViewport());if(d.children.length==0)d=getColGroup(getColHeader());c=addColInfo(d.children[a].getAttribute("FpCol"));if(b<=0)b=1;setTableColumnWidth(viewport,a,b)}else if(viewport1!=null)c=addColInfo(getColGroup(viewport1).children[a].getAttribute("FpCol"));viewport1!=null&&setTableColumnWidth(viewport1,a,b)}fixMissedColumns(k,n);synInlineTextEditorWidths(n);if(r){var f=[getCorner(),getFrozColHeader(),getColHeader(),getFooterCorner(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(f);for(var e=0;e<f.length;e++){var g=f[e];if(g.__bkStyleHeight==null)g.__bkStyleHeight=g.style.height}syncRowRange(-1,-1,true);syncRowRangeSafeMode(-1,-1,false);syncRowRange(-1,-1,false,true);sizeSpread(true);for(var e=0;e<f.length;e++){var g=f[e];g.style.height=g.__bkStyleHeight}}if(c!=null){xmlData.switchNodeContext(c);var i=xmlData.selectSingleNode("width");xmlData.resetNodeContext();if(i==null){i=xmlData.createElement("width");c.appendChild(i)}xmlData.textContent(i,Math.floor(b))}spreadView.GetCommandBar().EnableButton("Update",true);dirty=true;getRowHeader()==null&&frzCols==0&&prepairSpreadLayout();return t!=b}function createTestBox(){var b=element.document;if(!b.createElement)b=window.document;var a=window.document.getElementById(element.id+"_testBox");if(a==null){a=b.createElement("span");a.style.position="absolute";a.style.borderWidth=0;a.style.top="-500px";a.style.left="-100px";a.id=element.id+"_testBox";$element.append(a)}return a}function getPreferredRowHeight(d){var a=createTestBox();d=GetDisplayIndex(d);var c=null;if(d<frzRows){c=getViewport1();if(c==null)c=getViewport0()}else{c=getViewport();if(c==null)c=getViewport2();d-=frzRows}var f=0,h=c.rows[d].offsetHeight;n=c.rows[d].cells.length;for(var j=0;j<n;j++){var g=c.rows[d].cells[j],b=getRender(g);if(b!=null){var e=$$.j(b);a.style.fontFamily=e.css("fontFamily");a.style.fontSize=e.css("fontSize");a.style.fontWeight=e.css("fontWeight");a.style.fontStyle=e.css("fontStyle")}var m=getColFromCell(g);a.style.width=getColWidthFromCol(m)+"px";if(b!=null&&$$.utils.isSelectControl(b)){for(var l="",k=0;k<b.children.length;k++){var i=b.children[k];if(xmlData.textContent(i)!=null&&xmlData.textContent(i).length>l.length)l=xmlData.textContent(i)}a.innerHTML=l}else if(b!=null&&b.tagName=="INPUT")a.innerHTML=b.value;else a.innerHTML=g.innerHTML;h=a.offsetHeight;if(h>f)f=h}return Math.max(0,f)+3}function getRowHeightInternal(b){var a=null;if(b<frzRows){if(getFrozRowHeader()!=null)a=getFrozRowHeader().rows[b];else if(getViewport1()!=null)a=getViewport1().rows[b];else if(getViewport0()!=null)a=getViewport0().rows[b]}else{b-=frzRows;if(getRowHeader()!=null)a=getRowHeader().rows[b];else if(getViewport()!=null)a=getViewport().rows[b];else if(getViewport2()!=null)a=getViewport2().rows[b]}return a!=null?a.offsetHeight:0}function getRowHeightInternal2(b){var a=null;if(b<frzRows){if(getFrozRowHeader()!=null)a=getFrozRowHeader().rows[b];else if(getViewport1()!=null)a=getViewport1().rows[b];else if(getViewport0()!=null)a=getViewport0().rows[b]}else{b-=frzRows;if(getRowHeader()!=null)a=getRowHeader().rows[b];else if(getViewport()!=null)a=getViewport().rows[b];else if(getViewport2()!=null)a=getViewport2().rows[b]}if(a!=null){var c=$$(a).height();return a.style!=null&&c!=0?c:a.offsetHeight}else return 0}function setRowHeight2(c,j,r,m,n,q,o){if(j<1)j=1;var l=c;c=GetDisplayIndex(c);var a=null,e=getViewport2(),b=null,d=null;if(c<frzRows){if(getFrozRowHeader()!=null)a=getFrozRowHeader().rows[c];b=getViewport1();if(b==null)b=getViewport0();e=getViewport0()}else{c-=frzRows;if(getRowHeader()!=null)a=getRowHeader().rows[c];b=getViewport();if(b==null)b=getViewport2()}if(a!=null)a.style.height=j+"px";if(a!=null){b.rows[a.rowIndex].style.height=a.style.height;d=getFirstNonSpanCell(b.rows[a.rowIndex]);if(d!=null)d.style.height="";if(e!=null){e.rows[a.rowIndex].style.height=b.rows[a.rowIndex].style.height;d=getFirstNonSpanCell(e.rows[a.rowIndex]);if(d!=null)d.style.height=""}}else{if(b!=null){b.rows[c].style.height=j+"px";d=getFirstNonSpanCell(b.rows[c]);if(d!=null)d.style.height=""}if(e!=null){e.rows[c].style.height=b.rows[c].style.height;d=getFirstNonSpanCell(e.rows[c]);if(d!=null)d.style.height=""}a=b.rows[c]}var s=rowSpanCells.length;if(n==null||n){var i=null;if(r)i=addRowInfo(a.getAttribute("FpKey"),false,true);else i=addRowInfo(a.getAttribute("FpKey"));i!=null&&setRowHeight(i,$$(a).height()-(a.synDelt!=null?a.synDelt:0))}if(m){var g=[getCorner(),getFrozColHeader(),getColHeader(),getFooterCorner(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(g);for(var f=0;f<g.length;f++){var h=g[f];if(h.__bkStyleHeight==null)h.__bkStyleHeight=h.style.height}syncRowRange(l,l);sizeSpread(true);for(var f=0;f<g.length;f++){var h=g[f];h.style.height=h.__bkStyleHeight}}var p=getParentSpread();p!=null&&p.UpdateRowHeight(element);if(!q){var k=getScrollvp();if(k!=null)k.style.width=$$(k).width()-1+"px"}else!m&&sizeSpread(true);(o==null||o)&&spreadView.UpdateUI()}function getRowInfo(e,f){var b=null;if(f)b=xmlData.selectSingleNode("rowinfo row[key='"+e+"'][header='true']");else{var a=xmlData.selectNodes("rowinfo row[key='"+e+"']");if(a!=null)for(var c=0;c<a.length;c++){var d=a[c];if(d.getAttribute("header")!="true"){b=d;break}}}return b}function getRowHeight(a){if(a==null)return null;xmlData.switchNodeContext(a);var b=xmlData.selectSingleNode("height");xmlData.resetNodeContext();return b!=null?xmlData.textContent(b):null}function addRowInfo(b,c,f){if(b==null)return;var e=false;if(c)e=true;var a=getRowInfo(b,e,f);if(a!=null)return a;var d=xmlData.selectSingleNode("rowinfo");if(d==null)return null;a=xmlData.createElement("row");a.setAttribute("key",b);c&&a.setAttribute("header","true");d.appendChild(a);return a}function getTopSpread(a){if(a==null)a=element;if(a==element&&rootSpread!=null)return rootSpread;var c=a,b=a.parentElement;while(b!=null){if(b.getAttribute("FpSpread")=="Spread")if(b.getAttribute("hierView")=="true")c=b;else break;b=b.parentElement}if(a==element&&a.getAttribute("mcctCellType")!="true")rootSpread=c;return c}function getParentSpread(){try{if(element.getAttribute("hostspread")!=null)return null;var a=element.parentElement;while(a!=null&&a.getAttribute("FpSpread")!="Spread")a=a.parentElement;return a!=null&&a.getAttribute("hierView")=="true"?a:null}catch(b){$$.DEBUG.Log(b,"getParentSpread");return null}}function setRowHeight(b,c){if(b==null)return;xmlData.switchNodeContext(b);var a=xmlData.selectSingleNode("height");xmlData.resetNodeContext();if(a==null){a=xmlData.createElement("height");b.appendChild(a)}xmlData.textContent(a,Math.floor(c));spreadView.GetCommandBar().EnableButton("Update",true);dirty=true}function findAnchorCell(){var h=xmlData.selectSingleNode("root state activeRow"),g=xmlData.selectSingleNode("root state activeColumn"),a=h!=null?parseInt(xmlData.textContent(h)):-1,b=g!=null?parseInt(xmlData.textContent(g)):-1;if(getSelection().childNodes.length==0||a>-1&&b>-1){var c=null;if(a==-1&&b===-1)return null;else if(element.getAttribute("layoutMode")){if(b>-1){if(a>-1)c=getCellByRowCol2(xmlData.textContent(h),xmlData.textContent(g));if(c==null){var e=0;if(needScrollToTopRow){e=spreadView._GetKeyedTableRowIndex(spreadView.GetAttribute("topRow"),true);if(e!=-1)e+=frzRows;else e=0}c=spreadView._GetFirstCellFromLayoutCol(xmlData.textContent(g),false,e)}}if(c==null){a=getFirstRowFromKey(a);if(a==null)a=0;for(var t=parseInt(element.getAttribute("layoutRowCount")),s=GetColCount(),q=false,d=a;d<a+t;d++){for(var m=0;m<s;m++){c=getCellFromRowCol(d,m);if(c!=null){q=true;break}}if(q)break}}}else{if(h!=null&&a!=-1)a=getRowByKey(xmlData.textContent(h),0);else if(!element._processingFilterBarCommand){var e=0;if(needScrollToTopRow){var r=spreadView.GetAttribute("topRow"),o=spreadView._GetKeyedTableRowIndex(r,true);e=o!=-1?frzRows+o:0}a=getNextCellRowIndex(e,0,false,true)}b=g!=null&&b!=-1?getColByKey(xmlData.textContent(g),0):0;c=getCellFromRowCol(a,b)}if(c!=null&&!isInTouchAjax()&&!spreadView.IsInTouchMode()&&c.getAttribute("canFocus")=="false"&&!element._processingFilterBarCommand){a=getRowFromCell(c);b=getColFromCell(c);var k=moveRightInternal(a,b,false);if(k!=null)c=getCellFromRowCol(k.row,k.col)}if(c!=null)saveAnchorCell(c);else if(element._processingFilterBarCommand&&operationMode=="Normal"&&b>=0&&a<0){setActiveRow(-1);setActiveCol(b);selectColumn(b,1,true)}return c}else if(a<=-1&&b>-1||a>-1&&b<=-1)if(a<=-1&&b>-1){var j=b>=frzCols?getColHeader():getFrozColHeader();if(j){var n=j.rows.length-spreadView.FilterBarRowCount;a=n+a;if(a>=0&&a<n){for(var f=j.rows[a],d=0;d<f.cells.length;d++)if(f.cells[d].getAttribute("col")!=null&&parseInt(f.cells[d].getAttribute("col"))==b)return f.cells[d];for(var l=getColGroup(j),d=0;d<l.children.length;d++)if(l.children[d].getAttribute("FpCol")!=null&&parseInt(l.children[d].getAttribute("FpCol"))==b)return f.cells[d]}}}else{var i=getRowByKey(a,-1),p=i>=frzRows?getRowHeader():getFrozRowHeader();if(p&&i>=0){if(i>=frzRows)i-=frzRows;var f=p.rows[i];b=f.cells.length+b;return f.cells[b]}}return null}function saveAnchorCell(a){if(a==null)return;var b=a.parentElement.getAttribute("FpSpread");if(b=="r"||b=="rh"||b=="ch"){var f=null,c=null;if(b=="r"||b=="ch")if(a.getAttribute("col")!=null&&a.getAttribute("col")!="-1")c=parseInt(a.getAttribute("col"));else if(a.getAttribute("col")==null){var d=getColFromCell(a);if(d>=frzCols)d=d-frzCols;var g=getColGroup(a.parentElement.parentElement.parentElement);if(g.children.length>d&&g.children[d].getAttribute("FpCol")!=null)c=parseInt(g.children[d].getAttribute("FpCol"))}else c=0;else{c=-1;for(var e=a.parentElement.cells.length-1;e>=0;e--){if(e==a.cellIndex)break;c--}}if(b=="r"||b=="rh")f=getRowKeyFromCell(a);else{f=-1;for(var h=a.parentElement.parentElement.parentElement,e=h.rows.length-1-spreadView.FilterBarRowCount;e>=0;e--){if(e==a.parentElement.rowIndex)break;f--}}if(f!=null&&c!=null){setActiveRow(f);setActiveCol(c)}}else if(isChild(a,getCorner())){setActiveRow(-1);setActiveCol(-1)}}function getXmlActiveRow(){var a=xmlData.selectSingleNode("root state activeRow");return a!=null?parseInt(xmlData.textContent(a)):-1}function getXmlActiveCol(){var a=xmlData.selectSingleNode("root state activeColumn");return a!=null?parseInt(xmlData.textContent(a)):-1}function setActiveRow(a,c){if(GetRowCount()<1&&!c)return;if(a==null)a=-1;var b=xmlData.selectSingleNode("root state activeRow");if(b==null)return;xmlData.textContent(b,a);if(typeof a!="undefined"&&element.getAttribute("IsNewRow")!="true"&&element.getAttribute("AllowInsert")=="true"){spreadView.GetCommandBar().EnableButton("Insert",true);spreadView.GetCommandBar().EnableButton("Add",true)}else{spreadView.GetCommandBar().EnableButton("Insert",false);spreadView.GetCommandBar().EnableButton("Add",false)}if(typeof a!="undefined"&&element.getAttribute("IsNewRow")!="true"&&element.getAttribute("AllowDelete")=="true")spreadView.GetCommandBar().EnableButton("Delete",a!=-1);else spreadView.GetCommandBar().EnableButton("Delete",false);dirty=true}function setActiveCol(b){var a=xmlData.selectSingleNode("root state activeColumn");if(a==null)return;xmlData.textContent(a,b);dirty=true}function getActiveRow(){if(anchorCell==null)return-1;var a=getRowFromCell(anchorCell);return GetSheetIndex(a)}function getActiveCol(){if(anchorCell==null)return-1;var a=getColFromCell(anchorCell);return a}function getLeadingCellRow(){return leadingCellRow}function getLeadingCellCol(){return leadingCellCol}function setLeadingCell(c,b){if(arguments.length==1&&arguments[0].nodeType==1){var a=arguments[0];c=getRowFromCell(a);b=getColFromCell(a)}leadingCellRow=c;leadingCellCol=b}function setStartSelectLocation(c,b){if(arguments.length==1&&arguments[0].nodeType==1){var a=arguments[0];c=getRowFromCell(a);b=getColFromCell(a)}selectStartRow=c;selectStartCol=b}function GetActiveChildSheetView(j){var c=getTopSpread(element),d=$$.fn.createXMLDOMWrapper(c),a=null;if(d!=null){var e=d.selectSingleNode("root activechild");if(e!=null&&d.textContent(e)!="")a=document.getElementById(d.textContent(e));else for(var i=FpSpreadJS.getAllSpreads(c),g=0;g<i.length;g++){var f=i[g];if(f.getAnchorCell()!=null&&f.getAnchorCell().paintSelected){a=f;break}}}if(j)return a;if(a!=null)return a!=c?a:null;var b=element.document.FpActiveSheetView;if(typeof b=="undefined")return null;var c=getTopSpread(element),h=getTopSpread(b);return h!=c?null:b==h?null:b}function getTextElement(a){if(a.tagName.toUpperCase()=="INPUT"&&a.type=="text"||a.tagName.toUpperCase()=="TEXTAREA")return a;for(var b=0;b<a.children.length;b++){var c=a.children[b];if(!c.tagName)continue;var d=getTextElement(c);if(d!=null)return d}return null}function isHandleEvent(event,editingCell){var cell=editingCell||anchorCell;if(!editing||event==null||cell==null)return false;var ct=getCellType(cell);if(ct!=null){if(ct=="text")ct="TextCellType";var fn=null;try{fn=eval(ct+"_isHandleEvent")}catch(e){}if(fn)return fn.apply(this,arguments)}return false}function getEditor(c,g){if(c==null)return null;var e=getCellType(c,g);if(e=="readonly"&&!g)return null;var a=c.getElementsByTagName("DIV");if(a!=null&&a.length>0&&!a[0].select){var b=getTextElement(a[0]);if(b!=null&&b.select){a[0].select=Function.CreateDelegate(b,b.select);if(!b.getValue)b.getValue=function(){return this.value};if(!b.setValue)b.setValue=function(a){this.value=a};a[0].getValue=Function.CreateDelegate(b,b.getValue);a[0].setValue=Function.CreateDelegate(b,b.setValue)}}if(e=="MultiColumnComboBoxCellType")return $$(c).getChildTag("DIV","fpeditor","MultiColumnComboBoxCellType");if(e=="ExtenderCellType"){var f=$$(c).getChildTag("DIV","fpeditor","ExtenderEditor");if(f!=null){f.type="div";return f}}a=c.getElementsByTagName("INPUT");if(a!=null&&a.length>0){var d=a[0];while(d!=null&&d.getAttribute("FpEditor")==null)d=d.parentElement;return d}a=c.getElementsByTagName("SELECT");if(a!=null&&a.length>0)return a[0];a=c.getElementsByTagName("TEXTAREA");if(a!=null&&a.length>0){var d=a[0];if(e=="text"||e=="TextCellType")return d}return null}var renderAsEditor=-1;function dblclick(b){if(b){if(spreadView.IsInTouchMode()&&!$$.utils.isTouchEvent(b))return}else b=window.event;if(element.document.FpActiveSpread==null||element.document.FpActiveSpread!=element)return;var a=getCell(b.target||b.target,true),d=getSpreadControl(a,false);if(d!=element)return;if(a!=null&&!isHeaderCell(a)&&a==anchorCell&&operationMode=="RowMode"&&enableRowEditTemplate=="true"&&!element.getAttribute("layoutMode")){var c=a.getElementsByTagName("DIV");if(c!=null&&c.length>0&&c[0].id==element.id+"_RowEditTemplateContainer")return;Edit(getRowKeyFromCell(a));spreadView.GetCommandBar().EnableButton("Cancel",true);return}if(a!=null&&!isHeaderCell(a)&&a==anchorCell){$$.browser.ie&&a.getAttribute("canFocus")!="false"&&document.releaseCapture();StartEdit(a)}}function isAllInitialized(){var c=getTopSpread(element);if(!c.initialized)return false;for(var b=FpSpreadJS.getAllChildViews(c),a=0;a<b.length;a++)if(!b[a].initialized)return false;return true}function prepairEditCell(a,d){if(smartPaint&&a!=null&&(a.offsetParent==null||getRowFromCell(a)>=frzRows&&a.parentElement.rowIndex==0&&newTop!=0)){var b=getRowFromCell(a),e=getColFromCell(a);if(d)element.__scrollByEditing=true;if(smartPaint&&vpList.table.rows.length>0&&b>=frzRows)if(b<current+frzRows)showRows(b-frzRows,current+frzRows-b+1);else b-frzRows>=current+currentCount&&showRows(b-frzRows,1);anchorCell=findAnchorCell();paintAnchorCell(true);detachScrollEvents();var c=getViewport().parentElement;if(getRowFromCell(anchorCell)>=frzRows)c.scrollTop=anchorCell.offsetTop+element.virtualTop;if(getColFromCell(anchorCell)>=frzCols)c.scrollLeft=anchorCell.offsetLeft;scrollView();newTop=getTopRow(scrollvp.scrollTop);doUpdate();newTop=getTopRow(scrollvp.scrollTop);newPageCount=getRowsPerPage(newTop);scrollvp!=null&&setTimeout(function(){attachScrollEvents()},10);a=anchorCell}return a}function scrollToCell(b,a){if(a&&a.visibleOnTop&&spreadView.Parent!=null){var A=getTopSpread();A.getSpreadView().GetSpreadContext().scrollToCell(b,a);return}var q=a&&a.visibleOnTop;element.ignoreVirtualPaging=true;var y=a&&a.fromStartEdit?a.fromStartEdit:null,j=a&&a.afterScrollHandler?a.afterScrollHandler:null,B=a&&a.needScrollWebPage?a.needScrollWebPage:null,D=$$.utils.contains,c=!q?spreadView._GetViewportFromCell(b,true):viewport,x=getParent(getViewport()),l=c&&c==getViewport(),n=c&&c==getViewport1(),o=c&&c==getViewport2(),e=l?x:n?getParent(getViewport1()):o?getParent(getViewport2()):null,d=e,f=false,g=false,m={target:null,fromStartEdit:y};if(l||n||o){var C=spreadView.IsInTouchMode(),z=b.parentNode,p=$$.featureDetector.IsLeftTopBorderStyle;if(l||n){var k=b.getBoundingClientRect().right-c.getBoundingClientRect().left;if(spreadView.CellSpacing==0&&p&&k<c.offsetWidth)k+=1;if(b.offsetWidth<e.clientWidth&&k>e.scrollLeft+e.clientWidth){var s=Math.round(k-e.clientWidth);if(d.scrollLeft!=s){g=spreadView.InvalidateLayout();d.scrollLeft=s;f=true}}var v=b.offsetParent!=null?b.getBoundingClientRect().left-c.getBoundingClientRect().left:b.offsetLeft,h=Math.floor(v);if(!p&&spreadView.CellSpacing==0&&h>0&&h==v)h-=1;if(h<e.scrollLeft){f=d.scrollLeft!=h;if(f){if(!g)g=spreadView.InvalidateLayout();d.scrollLeft=h}}}if(l||o){var i,w=Math.floor(z.getBoundingClientRect().bottom);if(p&&spreadView.CellSpacing==0)w+=1;var r=w-Math.floor(c.getBoundingClientRect().top);if(r>d.scrollTop-element.virtualTop+e.clientHeight&&b.offsetHeight<e.clientHeight){i=element.virtualTop+r-e.clientHeight;if(d.scrollTop!=i){if(!g)g=spreadView.InvalidateLayout();d.scrollTop=i;f=true}}var t=Math.floor(b.getBoundingClientRect().top-c.getBoundingClientRect().top);if(t<d.scrollTop-element.virtualTop&&b.offsetHeight<e.offsetHeight){i=t+element.virtualTop;if(d.scrollTop!=i){if(!g)g=spreadView.InvalidateLayout();d.scrollTop=i;f=true}}}if(f){m.target=d;scrollView(m,null,j)}}if(!q&&(!a||!a.IgnoreSyncScrollByCell||spreadView._IsCellHidden(b,true,c))){var u=syncScrollByCell(b,up,a);if(u!=null&&(engine>=9||!$$.browser.ie)&&getScrollvp()!=null){m.target=u;scrollView(m,null,j);f=true}}!f&&j&&j();element.ignoreVirtualPaging=false}function StartEdit(editCell,args){if(isEndingEdit)return;if(operationMode=="SingleSelect"||operationMode=="ReadOnly"||editing)return;if(operationMode=="RowMode"&&enableRowEditTemplate=="true"&&!element.getAttribute("layoutMode"))return;if(editModePermanent&&!isAllInitialized())return;var cell=editCell;if(cell==null)cell=anchorCell;if(cell==null)return;var $cell=$$.j(cell);if(cell.getAttribute("canFocus")=="false"||isHeaderCell(cell)||spreadView.IsInFilterBar(cell))return;var waitToLoadRows=smartPaint&&(!args||!args.DelayStartEdit)&&!$$.utils.contains(element,cell);if(waitToLoadRows){scrollToCell(cell,{fromStartEdit:true,afterScrollHandler:function(){!editing&&StartEdit(anchorCell,{DelayStartEdit:true})},needScrollWebPage:true,visibleOnTop:spreadView.Parent!=null});return}else scrollToCell(cell,{fromStartEdit:true,afterScrollHandler:null,needScrollWebPage:true,visibleOnTop:spreadView.Parent!=null});cell=prepairEditCell(cell,args&&args.FromKeyDown||window.event!=null&&window.event.type=="keydown");cell.getAttribute("FpCellType")==$$.CellTypes.MCCBCT&&fpSpreadJS.InitMCCBCT(cell);if(cell.children.length>0&&cell.children[0].getAttribute("FpSpread")=="Spread")return;$$.browser.ie&&element.document.focus();(element.document.FpActiveSpread!=element||editModePermanent&&!$$.utils.contains(element,element.document.activeElement,true))&&focus();renderAsEditor=-1;var cellType=getCellType(cell),checkbox=getEditor(cell);if(checkbox!=null){updateEditingInfo(checkbox);setEditorFocus(checkbox,null,true,null,{CorrectIMEState:$$.browser.webkit&&$$.utils.isTextControl(checkbox)&&(!args||!args.FromKeyDown)})}if(cell!=null){var r=getRowFromCell(cell),c=getColFromCell(cell),er=GetSheetIndex(r);if(fireEditStartEvent(er,c,cell,element))return;var ts=getTopSpread(element);if(ts!=element)if(ts.fireEditStartEvent(er,c,cell,element))return;if(cellType=="readonly")return;if(anchorCell!=cell){anchorCell=cell;setActiveRow(getRowKeyFromCell(cell));setActiveCol(element.getAttribute("layoutMode")?getColKeyFromCell2(cell):getColKeyFromCell(cell))}if(checkbox==null){var ctController=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,cell);ctController&&ctController.StartEdit&&ctController.StartEdit();var render=ctController&&ctController.GetRender?ctController.GetRender():getRender(cell);editingFormula=getFormulaFromCell(cell);var needEditingValue=editingFormula==null||editingFormula=="",text=getValueFromRender(render,true,needEditingValue),isXmlValue=text!=null&&text.isXmlValue;if(isXmlValue)text=text.value;editingValue=text;if(editingFormula!=null)text=editingFormula;var cellHeight=cell.clientHeight;clearOldEditorValue(true);var editorID=getCellEditorID(cell);if(editorID!=null&&typeof editorID!="undefined"){editor=getCellEditor(editorID,true);editor.style.display="inline";spreadView._EnableSpreadValidators()}else{editor=document.createElement("input");editor.type="text";editor.__defaultEditor=1}var $editor=$$.j(editor);$editor.off("focus",editorOnFocus);$editor.on("focus",editorOnFocus);if(editor.style.imeMode==""){var imemode=cell.getAttribute("ime-mode");if(imemode!=null){editor.style.imeMode=imemode;cell.setAttribute("cellImeMode","1")}}var $render=$$.j(render);$editor.css("fontFamily",render.style.fontFamily||$render.css("fontFamily"));($render.css("fontSize")==null||$render.css("fontSize").indexOf("%")<0)&&$editor.css("fontSize",render.style.fontSize||$render.css("fontSize"));$editor.css("fontWeight",render.style.fontWeight||$render.css("fontWeight"));$editor.css("fontStyle",render.style.fontStyle||$render.css("fontStyle"));$editor.css("textDecoration",render.style.textDecoration);$editor.css("position","absolute");var cellViewport=spreadView._GetViewportFromCell(cell)||getViewport(),cellHeightBefore=cell.offsetHeight,rowHeightBefore=cell.parentNode.offsetHeight,viewportHeightBefore=cellViewport.offsetHeight,requireRelayout=cell.rowSpan>1;try{if(render!=cell){$render.css("display","none");cell.getAttribute("cdf")!=null&&spreadView.StartEditCDFCell(cell,editor,cellType)}else if(xmlData.firstElementChild(render)!=null&&xmlData.firstElementChild(render).tagName=="NOBR")xmlData.firstElementChild(render).innerHTML="&nbsp;";else render.innerHTML="&nbsp;"}catch(ex){$$.DEBUG.Log(ex,"StartEdit");return}!editing&&editor==element.document.activeElement&&setTextBoxFocus();$cell.append(editor);var isSELECT=cellType=="MultiColumnComboBoxCellType"||cellType=="ComboBoxCellType"||$$.utils.isSelectControl(editor),delt=xhtml&&isSELECT?1:0,cellBound=cell.getBoundingClientRect();$$(editor).moveToPosition(Math.round(cellBound.left)+cell.clientLeft-delt,Math.round(cellBound.top)+cell.clientTop-delt);if($$.utils.isTextControl(editor,true)){$editor.addClass("DefaultInput");$$.browser.webkit&&$editor.addClass(spreadView.GenerateBrowserBaseCssClass("DefaultTextEditor"));editor.type!="password"&&$editor.css("border",$$.browser.version>=9?"none":"")}var pL=parseInt($editor.css("paddingLeft")),pR=parseInt($editor.css("paddingRight")),pT=parseInt($editor.css("paddingTop")),pB=parseInt($editor.css("paddingBottom"));$editor.css("width",Math.max(1,cell.clientWidth-(isSELECT?0:pL+pR)-1)+"px");if($$.utils.isSelectControl(editor)||editor.tagName.toLowerCase()=="textarea"){var scrollbarWidth=$$.utils.detectScrollbarWidthHeight(),rEditor=editor.getBoundingClientRect(),rCell=cell.getBoundingClientRect(),rBorderCell=getBorderWidth(cell,3)/2;if(rEditor.right-rCell.left-rBorderCell<=scrollbarWidth)if(editor.tagName.toLowerCase()=="textarea"||$editor.attr("size")>1)$editor.css("overflow","hidden");else $editor.css("-webkit-appearance","none");else{$editor.css("overflow","");$editor.css("-webkit-appearance","")}}if($$.utils.isTextControl(editor)){editor.setAttribute("autocomplete","off");$editor.css("height",Math.max(1,cellHeight-pT-pB-1)+"px");if(editor.type!="password"){if(editor.style.backgroundColor==""||typeof editor.backColorSet!="undefined"){$editor.css("backgroundColor",$cell.css("backgroundColor"));editor.backColorSet=true}if(editor.style.color==""||typeof editor.colorSet!="undefined"){editor.style.color=$cell.css("color");editor.colorSet=true}}if(spreadView.IsShowFocusRectangle()&&!$$.browser.ie&&(getScrollvp()==null||uiVirtualization)&&spreadView.Parent==null){var pl=parseInt($editor.css("paddingLeft"));if(c==0&&pl<2)$editor.css("paddingLeft","2px");else pl<1&&$editor.css("paddingLeft","1px")}}else if(isSELECT){$editor.css("height","");if(cellType=="MultiColumnComboBoxCellType"){var mccbId=getMccbID(cell,element),obj=eval(mccbId+"_Obj"),input=obj.getInputControl();input.style.height="";if(editor.offsetHeight>cellHeight){var h=Math.max(1,cell.clientHeight-4);input.style.height=h-2+"px";editor.style.height=h+"px"}}else if(editor.offsetHeight>cellHeight)if($$.browser.ieversion>=11){$editor.css("height","1px");spreadView.RegisterTimeoutTask(function(){var a=Math.max(1,cell.clientHeight);$editor.css("height",a+"px")},0,"AdjustEditorHeightforIE11")}else{var h=Math.max(1,cell.clientHeight);$editor.css("height",h+"px")}}renderAsEditor=0;spreadView._SetTargetInputOldValue(cell,text);setEditorValue(editor,text,isXmlValue);if(text!=null&&text!=""&&text.charAt(0)!="=")editingValue=getEditorValue(editor);if($$.utils.isSelectControl(editor)){editorSelectedIndex=editor.selectedIndex;if(text==null||text==""&&cell.getAttribute("specialValue")==null)editor.selectedIndex=editorSelectedIndex=-1}if(editor.offsetHeight<cell.clientHeight&&editor.tagName!="TEXTAREA")if(cell.vAlign=="middle")$editor.css("top",$$(editor).top()+(cellHeight-editor.offsetHeight)/2+"px");else cell.vAlign=="bottom"&&$editor.css("top",$$(editor).top()+(cellHeight-editor.offsetHeight)+"px");if(element.__scrollByEditing)editor.__bkLength=text!=null?text.length:0;editing=true;setEditorFocus(editor,true,editModePermanent,null,{CorrectIMEState:$$.browser.webkit&&$$.utils.isTextControl(editor)&&(!args||!args.FromKeyDown)});var view=getViewport().parentNode;if(view.scrollTop<element.virtualTop)view.scrollTop=element.virtualTop;var isTextInput=editor.tagName=="INPUT"&&editor.type=="text",divView=spreadView.Parent?spreadView.GetTopSpreadView().Spread.getViewport().parentNode:spreadView._GetViewportFromCell(editor).parentNode;if(isTextInput&&spreadView._IsCellHidden(editor,true)){var rtDivView=divView.getBoundingClientRect(),caretPosition=$editor.height()/2+editor.getBoundingClientRect().top,scrollbar=divView.offsetHeight-divView.clientHeight,fontsize=parseInt($editor.css("font-size"));if(caretPosition<rtDivView.top)divView.scrollTop=divView.scrollTop+caretPosition-rtDivView.top-rtDivView.height+scrollbar+fontsize/2;else if(caretPosition>rtDivView.bottom)divView.scrollTop=divView.scrollTop+caretPosition-rtDivView.bottom+scrollbar+fontsize/2}if(isTextInput&&$$.browser.chrome){var _editor=editor,currentPaddingTop=_editor.style.paddingTop,tempPadding=parseInt(currentPaddingTop);_editor.style.paddingTop=isNaN(tempPadding)?"0px":tempPadding+1+"px";setTimeout(function(){_editor.style.paddingTop=currentPaddingTop},0)}requireRelayout|=cellHeightBefore!=cell.offsetHeight||rowHeightBefore!=cell.parentNode.offsetHeight;var rc=cell.rowSpan;if(isNaN(rc))rc=1;var _r=getRowFromCell(cell);setResizingFlag(true);(!args||!args.FromKeyDown)&&spreadView.UnregisterTimeoutTask("EndEdit.LayoutSpread");var doPerformLayout=function(a){spreadView.RegisterTimeoutTask(function(){var a;if($$.browser.ie&&editor){a=parseFloat(editor.style.top);if(!isNaN(a))editor.style.top=a-1+"px"}var c=isChild(cell,getViewport2())||isChild(cell,getViewport())?spreadView._GetViewportFromCell(cell).parentNode.scrollTop:null;syncRowRangeSafeMode({startRow:_r,endRow:_r+rc-1,fixZoomPrecision:$$.browser.chrome&&!requireRelayout});ignoreMainScroll=true;var b=spreadView.IsInTouchMode();b&&spreadView.SuspendShowFocusRectangle();sizeSpread(true);b&&spreadView.ResumeShowFocusRectangle();c!=null&&spreadView._MakeSureScrollableTo(c,true);ignoreMainScroll=false;setResizingFlag(false);if($$.browser.ie&&!isNaN(a)&&editor)editor.style.top=a+"px"},a,"StartEdit.LayoutSpread")};if($$.browser.ie&&isTextInput&&args&&args.FromKeyDown)$$.j(editor).one("focus",function(){doPerformLayout(100)});else doPerformLayout(0);pL=$$.j(editor).css("paddingLeft")}$$.browser.webkit&&editor.tagName=="INPUT"&&editor.type=="text"&&FarPoint.Web.Spread.SafariPatch.FixTextBox(editor);if(spreadView.EditModePermanent&&$$.browser.webkit)if($$.utils.isTextControl(editor))textBox.removeAttribute("readonly");else textBox.setAttribute("readonly","readonly");spreadView.GetCommandBar().EnableButton("Update",true);spreadView.GetCommandBar().EnableButton("Clear",false);spreadView.GetCommandBar().EnableButton("Copy",false);spreadView.GetCommandBar().EnableButton("Paste",false);spreadView.AfterSpreadStartEdit(r,c,cell,cellType,editor)}}function editorOnFocus(){$$.browser.ie&&document.releaseCapture();if(editor&&spreadView.EditModePermanent&&$$.browser.webkit)if($$.utils.isTextControl(editor))textBox.removeAttribute("readonly");else textBox.setAttribute("readonly","readonly")}function setEditorFocus(e,t,n,y,g){if(ignoreEditorFocus||spreadView!=null&&spreadView.IsSuspendFocusSpread())return;var b=getCell(e,true),d=spreadView._GetViewportFromCell(b),f=$$.utils.contains(element,b)?d.parentNode:null,p,q;b&&!isHeaderCell(b)&&spreadView._IsCellHidden(b,true)&&!spreadView.IsInTouchMode()&&scrollToCell(b);if(f!=null){p=f.scrollLeft;q=f.scrollTop}var s=getCellType(b),k=s!=null?getFunction(s+"_setFocus"):null;if(s=="ExtenderCellType"&&k==null){_delayFocus=true;return}var o=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,b),l=spreadView.IsSpreadActive();l&&detachOnActiveEvents();var m=g&&g.CorrectIMEState?e.value:null,c=false,a=null,w=isEditModeReplace(b);if(k||o&&o.SetEditorFocus){c=$$.utils.contains(a,element.document.activeElement,true);if(c&&$$.browser.webkit&&$$.utils.isTextControl(window.document.activeElement))return;a=e;if(k)k(e,g);else o.SetEditorFocus(e,g)}else try{a=getEditor(b);var j=false;if(a!=null){c=$$.utils.contains(a,element.document.activeElement,true);if(c&&$$.browser.webkit&&$$.utils.isTextControl(window.document.activeElement))return;if(b.getAttribute("RowEditTemplate")!="true"){if((a.type=="text"||a.tagName=="TEXTAREA")&&(a.selectionStart||a.selectionEnd)&&a!=document.activeElement){a.selectionStart=0;a.selectionEnd=0}j=true}}else{var r=getCellEditorID(b);if(r!=null&&typeof r!="undefined"){a=getCellEditor(r,true);if(a!=null&&$$.utils.contains(b,a)){c=$$.utils.contains(a,element.document.activeElement,true);if(c&&$$.browser.webkit&&$$.utils.isTextControl(window.document.activeElement))return;if((a.type=="text"||a.tagName=="TEXTAREA")&&(a.selectionStart||a.selectionEnd)){a.selectionStart=0;a.selectionEnd=0}j=true}}else if(editor!=null&&$$.utils.contains(b,editor)){a=editor;c=$$.utils.contains(a,element.document.activeElement,true);if(c&&$$.browser.webkit&&$$.utils.isTextControl(window.document.activeElement))return;if((editor.type=="text"||editor.tagName=="TEXTAREA")&&(editor.selectionStart||editor.selectionEnd)&&editor!=document.activeElement){editor.selectionStart=0;editor.selectionEnd=0}j=true}}if(a!=null&&j){var h=-1,i=-1;if(n&&spreadView._IsCellHidden(a,true,d)){h=d.parentNode.scrollLeft;i=d.parentNode.scrollTop}a.focus();if(!c&&$$.utils.isTextControl(a)){a.selectionStart=0;a.selectionEnd=0;if($$.browser.webkit&&a.tagName=="INPUT"&&!a.__fixedSafariCursor&&a.value.length>0){a.blur();a.focus();a.__fixedSafariCursor=true}}if(n&&d!=getViewport0()){if(h!=-1&&d.parentNode.scrollLeft!=h){d.parentNode.scrollLeft=h;p=h}if(i!=-1&&d.parentNode.scrollTop!=i){d.parentNode.scrollTop=i;q=i}scrollView({target:d.parentNode})}}}catch(z){$$.DEBUG.Log(z,"setEditorFocus")}!attachedScrollEvents&&f!=null&&(p!=f.scrollLeft||q!=f.scrollTop)&&scrollView({target:f});if($$.browser.ieversion>=11&&window.event!=null&&window.event.type=="keydown"&&window.event.keyCode==27)setTimeout(function(){fpSpreadJS.BackupBackgroundProperties(b,"edit")},0);else fpSpreadJS.BackupBackgroundProperties(b,"edit");if(!t&&!editing&&spreadView.IsInTouchMode()){var u=getEditor(b);$$.utils.contains(u,element.document.activeElement,true)&&updateEditingInfo(u)}!y&&!c&&w&&checkTextEditorSelect(a,b,g);l&&spreadView.IsInTouchMode()&&spreadView.ShowFocusRectangle(true);if(element.document.activeElement!=null&&$$.utils.contains(editor,element.document.activeElement,true)&&$$.utils.isTextControl(element.document.activeElement)){var v=$$.j(element.document.activeElement);v.off("compositionstart",onTextEditorCompositionStart);v.on("compositionstart",onTextEditorCompositionStart)}l&&attachOnActiveEvents();if(m!=null){var x=window.document.activeElement;setTimeout(function(){window.document.activeElement!=x&&setEditorFocus(e,t,n);if(m!=e.value)e.value=m},0)}}function updateEditingInfo(a,b){editing=true;editor=a;editingValue=getEditorValue(a,b);renderAsEditor=1}function checkTextEditorSelect(a,b,d){if(b==null)b=anchorCell;if(a==null)a=editor;if(b==null||a==null)return;var e=element.document.activeElement;if($$.utils.contains(a,e,true)&&$$.utils.isTextControl(e)){var c=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,b);if(c&&c.SelectAllText)c.SelectAllText();else selectAllText(d&&d.useTimeout?d.useTimeout:false,a,true);needCheckSelectText=true}}function setEditorValue(b,c,g){var d=getCell(b,true),a=getCellType(d);if(a!=null){if(d!=null&&_setEditorValueEditMode(d,b,c,a,g))return;var e=getFunction(a+"_setEditorValue");if(e!=null){e(b,c,element);return}}a=b.getAttribute("FpEditor");if(a!=null){var e=getFunction(a+"_setEditorValue");if(e!=null){e(b,c,element);return}}var f=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,d);if(f&&f.SetEditorValue)return f.SetEditorValue(c,g);b.value=c}function _setEditorValueEditMode(e,a,f,c,d){if(a!=null&&(a.getAttribute("edf")!=null||a.getAttribute("ef")!=null||a.getAttribute("enf")!=null||a.getAttribute("efp")!=null)){var b=null;if(c=="text"&&getCellType2(e)=="DateTimeCellType")b=DateTimeCellType_setEditorValueEditMode;else b=getFunction(c+"_setEditorValueEditMode");if(b!=null){b(a,f,element,d);return true}}return false}function getEditorValue(a,e){var f=getCell(a,true),b=getCellType(f);if(b!=null){var c=getFunction(b+"_getEditorValue");if(c!=null)return c(a,element,e)}b=a.getAttribute("FpEditor");if(b!=null){var c=getFunction(b+"_getEditorValue");if(c!=null)return c(a,element,e)}var d=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,f);return d&&d.GetEditorValue?d.GetEditorValue():typeof a.value=="boolean"?a.value?"True":"False":a.value}function getCurrency(a){var b=a.getAttribute("CurrencySymbol");if(b!=null)return b;var c=window.document.getElementById(a.id+"cs");return c!=null?xmlData.textContent(c):""}function waitForAttachBehavior(a){if(editor==null)return;if(editor.readyState=="complete"){setEditorFocus(editor,a,editModePermanent);(element.document.activeElement==null||element.document.activeElement!=editor)&&setEditorFocus(editor,a,editModePermanent);return}setTimeout(function(){var b=document.getElementById(element.id);b.waitForAttachBehavior(a)},20)}function getValueFromRender(a,h,g){var e=getCell(a),c=getCellType2(e);if(c!=null){if(h&&(c=="DateTimeCellType"||c=="IntegerCellType"||c=="DoubleCellType"||c=="CurrencyCellType")){var f=getCellValue(e,true);if(f!=null&&f.isXmlValue!=null)return f}var d=null;if(c=="ExtenderCellType"){d=getFunction(c+"_getEditor");if(d!=null)if(d(a)!=null)d=getFunction(c+"_getEditorValue");else d=null}else d=getFunction(c+"_getValue");if(d!=null)return d(a,element,g)}if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")a=xmlData.firstElementChild(a);if(e!=null&&trim(a.innerHTML)=="&nbsp;")return e.getAttribute("whiteSpace")==null?"":" ";var b=a.value;if(e!=null&&a.tagName=="NOBR")b=e.value;if(typeof b=="undefined")if(a.innerText)b=trim(a.innerText);else{b=$$.utils.getPlainHtmlText(a.innerHTML);b=b.trim();b=$$.utils.htmlDecode(b)}return b}function GetFormula(a,d){a=GetDisplayIndex(a);var c=getCellFromRowCol(a,d),b=getFormulaFromCell(c);return b}function SetFormula(a,f,c,e,d){a=GetDisplayIndex(a);var b=getCellFromRowCol(a,f);b.setAttribute("FpFormula",c);!d&&setCellValue(b,c,null,e)}function getFormulaFromCell(b){var a=null;if(b.getAttribute("FpFormula")!=null)a=b.getAttribute("FpFormula");if(a!=null)a=trim(new String(a));return a}function setValueToRender(a,b,f){var c=null,e=getCell(a),d=getCellType2(e);if(d!=null)if(d=="ExtenderCellType"){c=getFunction(d+"_getEditor");if(c!=null)if(c(a)!=null)c=getFunction(d+"_setEditorValue");else c=null}else c=getFunction(d+"_setValue");if(c!=null)if(spreadView.IsSupportEditModeFormat(d)){var g=getEditor(e);if(g==null){var i=getCellEditorID(e);if(i!=null)g=getCellEditor(i,true)}b=c(a,b,f?null:g)}else c(a,b,element);else{var h=true;if(a.tagName=="NOBR")a=a.parentElement;if(typeof a.value!="undefined"){if(b==null)b="";if(typeof a.maxLength!="undefined"&&a.maxLength>0)b=b.substring(0,a.maxLength);if(h)a.value=b;a.style.display="block"}else if(h)if(b==null||b=="")if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")xmlData.firstElementChild(a).innerHTML="&nbsp;";else a.innerHTML="&nbsp;";else if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")xmlData.textContent(xmlData.firstElementChild(a),b);else xmlData.textContent(a,b)}if(a.tagName=="NOBR")a=e;(typeof f=="undefined"||!f)&&a.getAttribute("FpFormula")!=null&&a.setAttribute("FpFormula",b);return b}function trim(b){var a=b.match(new RegExp("^\\s*(\\S+(\\s+\\S+)*)\\s*$"));return a==null?"":a[1]}function getOffsetLeft(d,f,e){var b=f;if(b==null)b=getViewportFromCell(d);var c=0,a=d;while(a!=null&&a!=b&&isChild(a,b)){c+=a.offsetLeft;if(!e)c+=a.clientLeft;a=a.offsetParent;if(a!=null&&a!=b)c-=a.scrollLeft}return c}function getElementOffsetLeft(c){var b=0;b+=c.offsetLeft;b+=c.clientLeft;var a=c.offsetParent;while(a&&(a.tagName=="TD"||a.tagName=="TR"||a.tagName=="TBODY"||a.tagName=="TABLE")&&a.style.position!="relative"&&a.style.position!="absolute"){b+=a.offsetLeft;b+=a.clientLeft;a=a.offsetParent}return b}function getOffsetTop(d,f,e){var b=f;if(b==null)b=getViewportFromCell(d);var c=0,a=d;while(a!=null&&a!=b&&isChild(a,b)){c+=a.offsetTop;if(!e)c+=a.clientTop;a=a.offsetParent;if(a!=null&&isChild(a,b))c-=a.scrollTop}return c}function getElementOffsetTop(c){var b=0;b+=c.offsetTop;b+=c.clientTop;var a=c.offsetParent;while(a&&(a.tagName=="TD"||a.tagName=="TR"||a.tagName=="TBODY"||a.tagName=="TABLE")&&a.style.position!="relative"&&a.style.position!="absolute"){b+=a.offsetTop;b+=a.clientTop;a=a.offsetParent}return b}function getScrollTop(d){var c=0,a=d,b=element.document.body;while(a!=null&&a!=b){c+=a.scrollTop;a=a.offsetParent}c+=b.parentElement.scrollTop||b.scrollTop;return c}function getScrollLeft(c){var b=0,a=c;while(a!=null&&a!=element.document.body.parentElement){b+=a.scrollLeft;a=a.offsetParent}if(element.document.body.parentElement!=null)b+=element.document.body.parentElement.scrollLeft;return b}function getFunction(fn){if(fn==null||fn=="")return null;try{return eval(fn)}catch(ex){return null}}function getMaskedEditValidtor(b){if(typeof Page_Validators!="undefined"){var a=null;for(i=0;i<Page_Validators.length;i++){a=Page_Validators[i];if(typeof a.enabled=="undefined"||a.enabled!=false)if(a.id==b+"")return a}}}function preventDefault(a){$$.utils.cancelDefault(a)}function cancelBubble(a){if(a.stopPropagation)a.stopPropagation();else a.cancelBubble=true}function cancelKeyDownOfselectControl(b){var a=b&&b.target;if(a&&spreadView.IsInViewport(a)&&$$.utils.isSelectControl(a)&&a.disabled==false)if($$.browser.mozilla){a.disabled=true;setTimeout(function(){a.disabled=false},0)}else preventDefault(b)}function DoEndEdit(b){editing&&EndEdit(b);var a=b.byElement;if(a!=null&&enableRowEditTemplate=="true"&&operationMode=="RowMode"&&element.getAttribute("layoutMode")==null)editing=IsInRowEditTemplate(a)}function EndEdit(a,c){if(a==null)a={};var b=false;if(!isEndingEdit){try{isEndingEdit=true;b=__EndEdit(a);b&&a.ignoreEditorFocus&&spreadView.UnregisterTimeoutTask("EditorSelectAllText")}finally{isEndingEdit=false}if(a.RemainFocusOnSpread&&!$$.utils.contains(element,element.document.activeElement)){spreadView.FocusSpread();spreadView.EditModePermanent&&doGetFocus()}b&&spreadView.GetAttribute("error")=="true"&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();spreadView.AfterSpreadEndEdit(c)}return b}function __EndEdit(args){if(args==null)args={};if(editor==null||editor.parentElement==null){editing=false;return true}element.valid=true;var event=args.Event||window.event,cell=getCell(editor.parentElement);if(cell==null)return;spreadView.GetTopSpreadView().InvalidateLayout();var val=getEditorValue(editor),tval=val;if(typeof val=="string")tval=trim(val);var ignoreValidation=element.getAttribute("AcceptFormula")=="true"&&tval!=null&&tval.charAt(0)=="=",checkbox=renderAsEditor!=0;checkbox&&spreadView._EnableSpreadValidators();var canExtenderValidation=false,maskedEditExtenderDiv=cell.getElementsByTagName("div")[0],maskedEditValidtorItem;if(typeof maskedEditExtenderDiv!="undefined"&&maskedEditExtenderDiv!=null)if(maskedEditExtenderDiv.getAttribute("Extenders")!=null&&maskedEditExtenderDiv.getAttribute("Extenders").indexOf("MaskedEditExtender")!=-1){canExtenderValidation=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"))!=null;maskedEditValidtorItem=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"))}var isValidValue=false;if(!ignoreValidation||canExtenderValidation){if(spreadView.HasValidators(cell)&&typeof Page_ValidationVer!="undefined"){var validator=spreadView.GetInvalidValidator(cell,val,event),msg="";hideMsg();if(validator==null)isValidValue=true;else{if(validator.errormessage!=null&&validator.errormessage!=""){msg=validator.errormessage;validator.style.position="absolute";validator.style.visibility="visible";validator.style.display="block";var position=setValidatorPos(validator,true);showMsg(validator,position)}element.valid=false;if(maskedEditValidtorItem!=null&&maskedEditValidtorItem.focusOnError==null)return true}fireOnErrorMessage(cell,isValidValue,msg);if(!isValidValue)return false;val=getEditorValue(editor)}else if(!checkbox||canExtenderValidation){var msg=null;if(!checkbox)if(typeof editor.isValid!="undefined")msg=editor.isValid(val);else{var ct=getCellType(cell);if(ct!=null){var f=getFunction(ct+"_isValid");if(ct=="text"&&getCellType2(cell)=="DateTimeCellType")f=DateTimeCellType_isValid;if(f!=null){msg=f(cell,val,editor);fireOnErrorMessage(cell,msg=="",msg)}}}if(canExtenderValidation){var exvalidator=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"));if(exvalidator)try{ExtenderCellType_validateValue&&ExtenderCellType_validateValue(editor);var crtret=true;if(typeof exvalidator.evaluationfunction=="function"){crtret=exvalidator.evaluationfunction(exvalidator);if(!crtret)if(typeof exvalidator.errormessage=="string"){if(msg!="")msg+=", ";msg=exvalidator.errormessage}}else if(typeof exvalidator.evaluationfunction=="string"){eval("crtret = "+exvalidator.evaluationfunction+"("+exvalidator.id+")");if(!crtret)if(typeof exvalidator.errormessage=="string"){if(msg!="")msg+=", ";msg=exvalidator.errormessage}}if(ExtenderCellType_setValidateEditor)if(!crtret){var inputs=editor.getElementsByTagName("INPUT");for(i=0;i<inputs.length;i++){var textInput=inputs[i];if(textInput.type=="text")textInput.isInvalid=true}ExtenderCellType_setValidateEditor(element,editor)}else{var inputs=editor.getElementsByTagName("INPUT");for(i=0;i<inputs.length;i++){var textInput=inputs[i];if(textInput.type=="text"&&textInput.isInvalid)textInput.isInvalid=null}ExtenderCellType_setValidateEditor(element,null)}if(!crtret&&typeof exvalidator.focusOnError=="string"&&exvalidator.focusOnError=="t"){var ctrl=editor.getElementsByTagName("input")[0];ctrl!=null&&ctrl.focus!="undefined"&&ctrl.focus!=null&&setTimeout(function(){try{ctrl.focus()}catch(a){$$.DEBUG.Log(a,"EndEdit")}},0)}}catch(ex){$$.DEBUG.Log(ex,"EndEdit")}}if(msg!=null&&msg!=""){if(validationMsg==null){var document=element.document;if(!document.createElement)document=window.document;validationMsg=document.createElement("div");validationMsg.style.position="absolute";var vh=getViewportHolder();if(vh==null)vh=getViewport().parentElement;$$.j(vh).append(validationMsg)}validationMsg.innerHTML=msg;validationMsg.style.top="-1000px";validationMsg.style.left="-1000px";validationMsg.style.position="absolute";validationMsg.style.visibility="visible";validationMsg.style.display="block";if($$.browser.quirksMode)validationMsg.style.whiteSpace="nowrap";var position=setValidatorPos(null,true),sourceEvent=window.event?window.event:args?args.Event:null,isTouchAction=sourceEvent&&$$.browser.isTouchEventModel&&sourceEvent.type==$$.TouchEvents.TouchStart&&!$$.utils.isNativeControl(sourceEvent.target),needCancelDefault=getSpreadControl(element.document.activeElement)==element||spreadView.NeedSetEditorFocusOnActiveCell();sourceEvent&&!isTouchAction&&(sourceEvent.type!="mousedown"||needCancelDefault&&!$$.utils.isOverScrollbar(sourceEvent)&&($$.utils.contains(element,sourceEvent.target)||sourceEvent.target==element))&&preventDefault(sourceEvent);showMsg(validationMsg,position);element.valid=false;spreadView.EditModePermanent&&$$.browser.webkit&&textBox.setAttribute("readonly","readonly")}else hideMsg();if(msg!=null&&msg!=""||crtret!=null&&!crtret)return false}}else{hideMsg();isValidValue=true}var isTextEditor=$$.utils.isTextControl(editor)||element.document.activeElement!=null&&$$.utils.isTextControl(element.document.activeElement)&&$$.utils.contains(editor,element.document.activeElement,true);if(isTextEditor&&element.document.activeElement!=null){var $active=$$.j(element.document.activeElement);$active.off("compositionstart",onTextEditorCompositionStart);$active.off("compositionend",onTextEditorCompositionEnd)}var ctController=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,cell),fpEditor=ctController?ctController.GetEditor():null,otherSpread=null,safeReset=$$.browser.webkit&&($$.utils.isTextControl(editor)||fpEditor&&fpEditor.ClearOldValue)&&event&&($$.utils.isTextControl(event.target)||(otherSpread=getSpreadControl(event.target))!=null&&otherSpread!=element);if(safeReset)lastEditingInfo=element.getEditingInfo();if(isTextEditor&&$$.browser.chrome)args.SafeEditorRemove=args.FromMouseWheel;var ct=getCellType(cell),selectedIndex=-1;if(!checkbox){ctController&&ctController.EndEdit&&ctController.EndEdit();isValidValue&&spreadView._DisableSpreadValidators();$$.j(editor).off("focus",editorOnFocus);if($$.utils.isSelectControl(editor))selectedIndex=editor.selectedIndex;!xhtml&&textBox!=null&&textBox.blur();var _editor=editor;if(!args.SafeEditorRemove)if(editor.getAttribute("FpEditor")=="ExtenderEditor"&&typeof ExtenderCellType_blur=="function")ExtenderCellType_blur(editor);else{var func=getFunction(ct+"_blur");if(func!=null)func(editor);else args.InvokeEditorBlur&&element.document.activeElement==editor&&isTextEditor&&editor.blur()}if(args.SafeEditorRemove&&$$.utils.contains(editor,element.document.activeElement,true)&&(isTextEditor||!$$.browser.ie)){if($$.browser.webkit&&isTextEditor&&args.OutsideEvent&&args.OutsideEvent.type=="mousedown"&&$$.utils.isTextControl(args.OutsideEvent.target))args.OutsideEvent.target.focus();else setTextBoxFocus();if(spreadView.AllowVirtualScrollPaging&&$$.browser.ieversion>10){var vp=spreadView._GetViewportFromCell(cell);if(vp)vp.offsetHeight}}var cellViewport=spreadView._GetViewportFromCell(cell)||getViewport(),cellHeightBefore=cell.offsetHeight,rowHeightBefore=cell.parentNode.offsetHeight,viewportHeightBefore=cellViewport.offsetHeight,requireRelayout=cell.rowSpan>1;$$.browser.webkit&&ct=="MultiColumnComboBoxCellType"&&window.document.activeElement==window.document.body&&setTextBoxFocus();editor=_editor;if(event&&$$.utils.contains(editor,event.target,true)){editor.style.display="none";cell.removeChild(editor)}else{cell.removeChild(editor);editor.style.display="none"}if(smartPaint){var realEditor=element.document.getElementById(editor.id);if(realEditor!=null){realEditor.style.display="none";if(!$$.utils.contains(element,cell))cell=$$.utils.GetCell(realEditor);realEditor.parentNode.removeChild(realEditor);editor=realEditor}}if(cell.getAttribute("cellImeMode")=="1")editor.style.imeMode="";!editor.__defaultEditor&&cellViewport.parentNode.appendChild(editor);if(safeReset)setTimeout(function(){clearOldEditorValue()},2e3);else{lastEditingInfo=null;setEditorValue(editor,"")}if($$.utils.isSelectControl(editor))editor.selectedIndex=-1;var rd=getRender(cell);if(cell.getAttribute("cdf")!=null)spreadView.EndEditCDFCell(cell,rd);else if(rd.style.display=="none")rd.style.display="";if(editingFormula!=null&&editingFormula==val)setValueToRender(rd,editingValue,true);else val=setValueToRender(rd,val);if(getFirstNonSpanCell(cell.parentNode)==null&&cell.style.height!="")cell.style.height=""}else if(!safeReset||!editor.isIMEComposing)lastEditingInfo=null;var isEditModeReplaceCell=isEditModeReplace(cell);if(spreadView.IsInTouchMode()&&editor!=null){spreadView.UnregisterTimeoutTask("EditorSelectAllText");if(editor.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"){var mccbId=getMccbID(cell,element);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval("window."+mccbId+"_Obj");if(editorObj!=null){var ip=editorObj.getInputControl();if(ip!=null&&ip.selectionStart!=ip.selectionEnd)ip.selectionStart=ip.selectionEnd=-1;editorObj.getIsDrop()&&editorObj.ShowHideContainer(false,true)}}}else if(isEditModeReplaceCell&&element.document.activeElement==editor&&$$.utils.isTextControl(editor))editor.selectionStart=editor.selectionEnd=-1}$$.browser.ieversion>=11&&spreadView.UnregisterTimeoutTask("AdjustEditorHeightforIE11");$$.browser.webkit&&editor.tagName=="INPUT"&&editor.type=="text"&&FarPoint.Web.Spread.SafariPatch.RemoveTextBoxFix(editor);var _editor=editor;editor=null;var valueChanged=false;if(editingFormula!=null&&editingFormula!==val||editingFormula==null&&editingValue!==val||$$.utils.isSelectControl(_editor)&&editorSelectedIndex!=selectedIndex){if(ct=="RadioButtonListCellType"&&val==null)val="";setCellValue(cell,val,true);if(val!=null&&val.length>0&&trim(val).indexOf("=")==0)cell.setAttribute("FpFormula",val);else cell.removeAttribute("FpFormula");valueChanged=true}editing=false;editorSelectedIndex=-1;if(valueChanged){var r=getRowKeyFromCell(cell),c=element.getAttribute("layoutMode")?getColKeyFromCell2(cell):getColKeyFromCell(cell);if(r!=null&&c!=null){fireDataChangedEvent(cell,val,element,r,c);var ts=getTopSpread(element);ts!=element&&ts.fireDataChangedEvent(cell,val,element,r,c)}}requireRelayout|=cellHeightBefore!=cell.offsetHeight||rowHeightBefore!=cell.parentNode.offsetHeight;if(!checkbox){var rc=cell.rowSpan;if(isNaN(rc))rc=1;var r1=getRowFromCell(cell),vp=spreadView._GetViewportFromCell(cell);if(vp==null)return true;setResizingFlag(true);var view=vp.parentNode,scrollTop=view.scrollTop;syncRowRangeSafeMode({startRow:r1,endRow:r1+rc-1,fixZoomPrecision:$$.browser.chrome&&!requireRelayout});if(view.scrollTop<scrollTop)view.scrollTop=scrollTop;spreadView.RegisterTimeoutTask(function(){sizeSpread(true);setResizingFlag(false)},requireRelayout?0:500,"EndEdit.LayoutSpread")}else if(isEditModeReplaceCell&&isTextEditor&&$$.browser.chrome){var selStart=_editor.selectionStart,selEnd=_editor.selectionEnd,v=_editor.value;_editor.value="";_editor.value=v;if(selStart||selEnd){_editor.selectionStart=selStart;_editor.selectionEnd=selEnd}}fireEditStoppedEvent(cell,element);var ts=getTopSpread(element);ts!=element&&ts.fireEditStoppedEvent(cell,element);var ae=element.document.activeElement;if(!args.IgnoreFocus&&(ae==null||!isChild(ae,element.document.body)||editModePermanent||ae==element||isChild(ae,element)))if(args.ignoreEditorFocus)setTextBoxFocus();else if((args.FromMouseWheel||element.getAttribute("virtualPaging")=="true")&&element.getAttribute("EditModePermanent")){ignorePostbackEditmode=true;!ignoreEditorFocus&&setTextBoxFocus();ignorePostbackEditmode=false}else if(!checkbox||!isEditModeReplaceCell||!$$.utils.isTextControl(_editor)||args.FromMouseWheel){focus(null,null,{Event:event});focus(null,null,{Event:event})}else{focus(null,null,{SelectText:false,FocusSpreadOnly:true});focus(null,null,{SelectText:false,FocusSpreadOnly:true})}fpSpreadJS.RestoreBackgroundProperties(cell,true);var data=getClipboardData();spreadView.GetCommandBar().EnableButton("Clear",true);spreadView.GetCommandBar().EnableButton("Copy",true);spreadView.GetCommandBar().EnableButton("Paste",data!=null);var autoCalc=element.getAttribute("autoCalc");if(autoCalc!="false")if(editingFormula!=null&&editingFormula!=val||editingFormula==null&&editingValue!=val)if(args&&args.shouldDelayUpdateValues)spreadView.DelayUpdateValues=true;else updateValues();if(!editing){renderAsEditor=-1;editingValue=null;editingFormula=null}getRowHeader()==null&&frzCols==0&&prepairSpreadLayout();$$.browser.chrome&&ct=="RadioButtonListCellType"&&anchorCell&&RadioButtonListCellType_detachEvent(anchorCell);return true}function clearOldEditorValue(b){if(lastEditingInfo&&!lastEditingInfo.RenderAsEditor&&(!editing||lastEditingInfo.Editor!=editor||b)){var a=$$.j(lastEditingInfo.Editor).data("FpEditor");if(a&&a.ClearOldValues)a.ClearOldValues();else lastEditingInfo.Editor.value=""}lastEditingInfo=null}function fireOnErrorMessage(a,c,d){var b={spread:element,row:getRowFromCell(a),col:getColFromCell(a),errorMessage:d,isValid:c};if(!spreadView.EventTracker.IsFired("ErrorMessageShown",b,true)){var e=$$.utils.createEvent("ErrorMessageShown",false,true,b);element.dispatchEvent(e)}}function showMsg(b,e){var i=getTopSpread(element),k=spreadView.GetTopSpreadView(),f=element.document;if(!f.getElementById)f=window.document;var a=f.getElementById(i.id+"mholder");if(a==null){if($$.browser.webkit)a=f.createElement("div");else{a=f.createElement("iframe");a.frameBorder="no";a.scrolling="no";a.src="javascript:false;"}i.appendChild(a);a.style.position="absolute";a.id=i.id+"mholder";e=setValidatorPos(b,true)}else{k.OnDetachErrorMessage();if(a.tagName=="IFRAME"&&a.contentWindow==null)return}b.parentNode==null&&i.insertBefore(b,null);getMsgStyle();if(msgStyle!=null){if(msgStyle.fontFamily!=null)b.style.fontFamily=msgStyle.fontFamily;if(msgStyle.fontSize!=null)b.style.fontSize=msgStyle.fontSize;if(msgStyle.fontStyle!=null)b.style.fontStyle=msgStyle.fontStyle;if(msgStyle.fontVariant!=null)b.style.fontVariant=msgStyle.fontVariant;if(msgStyle.fontWeight!=null)b.style.fontWeight=msgStyle.fontWeight}if(e==null&&(b.style.top==""||b.style.left==""))e=setValidatorPos(b,true);if(e){a.style.top=e.top;a.style.left=e.left}else{a.style.top=b.style.top;a.style.left=b.style.left}if($$.browser.webkit)a.innerHTML=b.innerHTML;else if(!a.contentWindow.document.body||a.contentWindow.document.body.innerHTML!=b.innerHTML){a.contentWindow.document.write(b.innerHTML);a.contentWindow.document.close()}b.style.left="0px";var d=b.parentNode,j=d.id.indexOf("_ValidatorHold")!=-1;if(j){d.style.display="";d.style.width="1000px";d.style.height="1000px"}a.width=b.offsetWidth+6;a.height=b.offsetHeight+6;if(j){d.style.display="none";d.style.width="";d.style.height=""}if($$(a).left()+parseInt(a.width)>a.parentElement.offsetWidth+a.parentElement.scrollLeft)a.style.left=a.parentElement.offsetWidth-parseInt(a.width)+a.parentElement.scrollLeft+"px";var l=$$(a).top();if(($element.css("position")=="absolute"||$element.css("position")=="relative")&&l+parseInt(a.height)>a.parentElement.offsetHeight)a.style.top=l-parseInt(a.height)-anchorCell.offsetHeight+"px";var c=$$.browser.webkit?a:a.contentWindow.document.body;c.style.msTouchAction="none";var g=$$.j(b);c.style.fontFamily=g.css("fontFamily");c.style.fontSize=g.css("fontSize");c.style.fontStyle=g.css("fontStyle");c.style.fontVariant=g.css("fontVariant");c.style.fontWeight=g.css("fontWeight");c.style.background="yellow";c.style.color="red";if(msgStyle!=null){if(msgStyle.backgroundColor!=null)c.style.backgroundColor=msgStyle.backgroundColor;if(msgStyle.color!=null)c.style.color=msgStyle.color}c.style.marginLeft="2px";c.style.marginTop="2px";c.style.marginRight="0px";c.style.marginBottom="0px";a.style.border="1px solid black";a.style.display="inline";b.style.display="none";var h=$$.browser.webkit?a:a.contentWindow.document;if(!h.onmousedown){h.onmousedown=function(){var b=EndEdit();if(!b)spreadView.NeedSetEditorFocusOnActiveCell()&&editor.focus();else setTimeout(function(){!editing&&(editModePermanent||a==window.document.activeElement&&a.style.display=="none")&&doGetFocus()},0)};if(!$$.browser.webkit){h.onmouseup=function(c){if(!$$.utils.isRightClick(c)){var b=$$.utils.createEvent("mouseup",true,true);b.clientX=c.clientX;b.clientY=c.clientY;b.offsetX=b.offsetY=0;b.button=0;b.which=0;a.dispatchEvent(b)}};h.oncontextmenu=function(a){$$.utils.isTouchEvent(a)&&$$.utils.cancelDefault(a)}}}k.OnAttachErrorMessage()}function hideMsg(){var d=getTopSpread(element),c=element.document;if(!c.getElementById)c=window.document;var a=c.getElementById(d.id+"mholder");if(a!=null){var b=$$.browser.webkit?a:a.contentWindow.document;if(b.onmousedown){b.onmousedown=null;b.onmouseup=null;b.oncontextmenu=null}a.style.display="none";if(a.backDisplayValue!=null)a.backDisplayValue=null}}function setValidatorPos(e,n){if(editor==null)return;var b=getCell(editor.parentElement);if(b==null)return;if(e==null&&spreadView.HasValidators(b)&&typeof Page_ValidationVer!="undefined"){var p=getEditorValue(editor);e=spreadView.GetInvalidValidator(b,p)}if(e==null)e=validationMsg;var d=getTopSpread(element),j=element.document;if(!j.getElementById)j=window.document;var a=j.getElementById(d.id+"mholder");if(e!=null&&e.style.display!="none"||a!=null){var f=d.getScrollvp();if(f==null)f=d.getViewport().parentElement;var i=null;if(a&&a.tagName=="DIV"){if(a.style.top=="")a.style.top="-1000px";if(a.style.left=="")a.style.left="-1000px";if(a.style.display=="none"){i="none";a.style.display="inline"}}var g,k=b.getBoundingClientRect(),c=null;if(a&&a.tagName=="DIV"){c=a.getBoundingClientRect();if(i!=null)a.style.display=i}if(n&&a!=null){a.style.display="inline";g=c?parseInt(a.style.top)+(k.bottom-c.top):getOffsetTop(b,a.offsetParent)+b.offsetHeight}else g=getOffsetTop(b,d)+b.offsetHeight;var m=c?parseInt(a.style.left)+(k.left-c.left):getOffsetLeft(b,d),o=!spreadView._IsCellHidden(b);if(a!=null){a.style.top=g+"px";a.style.left=m+"px";a.style.visibility=o?"visible":"hidden";var h=false;if(a.tagName=="DIV"){var l=f.getBoundingClientRect();h=l.left>c.left+2||l.top>c.top+2}else h=getOffsetLeft(f,d)>$$(a).left()||getOffsetTop(f,d)>$$(a).top();if(h){if(!a.backDisplayValue&&a.style.display!="none")a.backDisplayValue=a.style.display;a.style.display="none"}else if(a.backDisplayValue)a.style.display=a.backDisplayValue}return{top:g,left:m}}}function getMsgStyle(){if(msgStyle!=null)return;for(var f=("."+element.id+"msgStyle").toLowerCase(),h=element.document.styleSheets.length,c=0;c<h;c++){var e=element.document.styleSheets[c],a;try{if($$.browser.ie)a=e.rules;else a=e.cssRules;if(!a)continue}catch(i){continue}for(var d=0,g=a.length;d<g;d++){var b=a[d];if(b&&b.selectorText&&b.selectorText.toLowerCase()==f){msgStyle=b.style;break}}if(msgStyle!=null)break}}var colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};function getColorValue(b){var a=b.match(/^rgb\s*\(\s*([^\)]+),\s*([^\)]+),\s*([^\)]+)\)/i);if(a!=null&&a.length==4)try{return"#"+__hex(a[1])+__hex(a[2])+__hex(a[3])}catch(e){$$.DEBUG.Log(e,"getColorValue");return null}for(var c in colors)if(b!=null&&b.toLowerCase()==c)return"#"+colors[c];return null}function darker(a,e){if(a==null)return null;if(a.substring(0,1)!="#"){var f=getColorValue(a);if(f==null)return a;a=f}if(e.substring(0,1)!="#"){var f=getColorValue(e);if(f==null)f="#bbbbbb";e=f}var i=256-parseInt(e.substring(1,3),16),h=256-parseInt(e.substring(3,5),16),g=256-parseInt(e.substring(5,7),16),d,c,b;d=parseInt(a.substring(1,3),16);c=parseInt(a.substring(3,5),16);b=parseInt(a.substring(5,7),16);d-=i;if(d>255)d=255;if(d<0)d=0;c-=h;if(c>255)c=255;if(c<0)c=0;b-=g;if(b>255)b=255;if(b<0)b=0;return"#"+(__hex(d)+__hex(c)+__hex(b)).toUpperCase()}function __hex(a){return("0"+parseInt(a,10).toString(16)).slice(-2)}function containsNumericCellType(a,b){if(a==null||b!=null&&!$$.utils.contains(a,b))return false;if(a.getAttribute("fpcelltype")=="ExtenderCellType"&&a.getAttribute("celltype2")=="NumericUpDownCellType"&&getEditor(a)!=null)return true;if(a.getAttribute("rowedittemplate")=="true"){var c=a.querySelectorAll("div[extenders='NumericUpDownExtender']");if(c!=null&&c.length>0){if(b==null)return true;for(var d=0;d<c.length;d++)if(b==c[d]||$$.utils.contains(c[d],b))return true}}}function paintSelectedCell(a,h,b){if(a==null)return;if(b&&spreadView.IsInTouchMode()&&(spreadView.RowHeader.Contains(a)||spreadView.ColumnHeader.Contains(a)))b=false;var d=b?anchorBackColor:selectedBackColor,e=spreadView.IsEnablejQueryTheme()&&useDefaultSelectionBackColor&&(spreadView.RowHeader.Contains(a)||spreadView.ColumnHeader.Contains(a)||spreadView.Corner.Contains(a));if(e)d=null;var g=a.getAttribute("hasSparkline")!=null;if(spreadView.IsSpreadActive()&&!element._noNumericCellTypeWorkaround&&a==anchorCell&&window.event!=null&&(!element.initialized||(window.event.type=="mousedown"||window.event.type=="activate")&&!$$.utils.isOverScrollbar(window.event))&&typeof window.event.target.nodeType!="undefined"&&containsNumericCellType(a,window.event.target))return;var f=$$.j(a);if(h){if(activeChartObj!=null&&spreadView.IsInTouchMode())return;if(a.bgColorBak==null&&(!$$.browser.ie||a.currentStyle))a.bgColorBak=f.css("backgroundColor");if(a.paintSelected==null||b&&!a.anchorSelected||!b&&a.anchorSelected){if(d!=null){var c=!$$.browser.ie||a.currentStyle?f.css("backgroundColor"):null;if(element.getAttribute("semiTransparentSelectedBackColor")==null||c==null||c.length==0||c=="transparent"||c=="rgba(0, 0, 0, 0)")a.style.backgroundColor=d;else a.style.backgroundColor=darker(c,d)}a.paintSelected=true;a.anchorSelected=b}if(e){spreadView.UpdateThemeCss();$$(a).appendCssClass("ui-state-highlight")}fpSpreadJS.BackupBackgroundProperties(a,"select")}else{a.paintSelected=null;a.anchorSelected=null;if(!g){$$.j(a).css("backgroundColor","");$$.j(a).css("backgroundImage","")}else if(a.bgColorBak!=null){a.style.backgroundColor=a.bgColorBak;a.bgColorBak=null}else $$.j(a).css("backgroundColor","");if(a.getAttribute("bgColor")!=null&&a.getAttribute("bgColor")!="")a.style.backgroundColor=a.getAttribute("bgColor");e&&$$(a).removeCssClass("ui-state-highlight");fpSpreadJS.RestoreBackgroundProperties(a)}}function paintAnchorCell(b,h,j){if(anchorCell==null||anchorCell.parentElement==null)return;if(b==null)b=true;if(spreadView.IsInTouchMode()&&(spreadView.RowHeader.Contains(anchorCell)&&(spreadView.SelectionBlockOptions&GCWS.SelectionBlockOptions.Rows)!=GCWS.SelectionBlockOptions.Rows||spreadView.ColumnHeader.Contains(anchorCell)&&((spreadView.SelectionBlockOptions&GCWS.SelectionBlockOptions.Columns)!=GCWS.SelectionBlockOptions.Columns||spreadView._IsFullRowSelectable)))return;var a=spreadView.IsInTouchMode()&&!isHeaderCell(anchorCell);if(!a){a=frzRows==0&&frzCols==0&&getTopSpread().getAttribute("hierView")!="true";if(element.getAttribute("showFocusRect")=="false")a=false}var e=spreadView.IsInFilterBar(anchorCell),d=operationMode;if(anchorCell==null||d!="Normal"&&d!="RowMode")return;if(d=="MultiSelect"||d=="ExtendedSelect")return;var c=isHeaderCell(anchorCell);if(h){if(!c){if(!e){paintSelectedCell(anchorCell,b&&!a,true);if(b)anchorCell.paintSelected=true}paintAnchorCellHeader(true);a&&spreadView.ShowFocusRectangle(true)}return}if(b){if(oldAnchorCell&&oldAnchorCell!=anchorCell){var i=oldAnchorCell.paintSelected!=null;if(element.getAttribute("SelectionPolicy")!="MultiRange"){var g=getRowFromCell(oldAnchorCell),f=getColFromCell(oldAnchorCell);getColHeader()!=null&&!isColSelected(f)&&(!spreadView.IsInTouchMode()||!spreadView.SelectionModel.IsIntersectWith(g,f,1,1))&&paintHeaderSelection(g,f,1,1,false,true)}if(!spreadView.IsInFilterBar(oldAnchorCell)){paintSelectedCell(oldAnchorCell,false);i&&paintSelectedCell(oldAnchorCell,true,false)}oldAnchorCell=null}if(a){if(spreadView.ShowHeaderSelection||!c){if(!e){paintSelectedCell(anchorCell,false);if(!c)anchorCell.paintSelected=true}spreadView.ShowFocusRectangle(true);paintAnchorCellHeader(true)}return}if(!isChild(anchorCell,element)){var k=vpList!=null&&isChild(anchorCell,vpList.table)||vp2List!=null&&isChild(anchorCell,vp2List.table);if(!k)return}if(anchorCell.parentElement.cells[0].children.length>0&&anchorCell.parentElement.cells[0].children[0].getAttribute("FpSpread")=="Spread")return;if(j||!initialized||forcePaintAnchorCell||element.document.FpActiveSheetView==element){if(spreadView.ShowHeaderSelection||!c){if(!e){paintSelectedCell(anchorCell,false);paintSelectedCell(anchorCell,true,true)}paintAnchorCellHeader(true)}}else updateSelectedCell(anchorCell,GetSelectedRanges(),false)}else updateSelectedCell(anchorCell,GetSelectedRanges(),false)}function updateSelectedCell(b,l,j){var f=getRowFromCell(b),e=getColFromCell(b),c=false,d=false;if(j)c=d=true;else for(var k=l||GetSelectedRanges(),g=0;g<k.length;g++){var a=k[g];if(a.anchor)continue;if(a.row==-1&&a.rowCount==-1&&a.col==-1&&a.colCount==-1){c=d=true;break}else{d=a.row==-1&&a.rowCount==-1&&a.col==e||a.row<=f&&f<=a.row+a.rowCount;c=a.col==-1&&a.colCount==-1&&a.row==f||a.col<=e&&e<=a.col+a.colCount}if(d&&c)break}var h=b==anchorCell,i=spreadView.IsInTouchMode();!d&&paintHeaderSelection(f,e,!i||!h?1:b.rowSpan,1,false,false);!c&&paintHeaderSelection(f,e,1,!i||!h||b.getAttribute("RowEditTemplate")=="true"?1:b.colSpan,false,true);!spreadView.IsInFilterBar(b)&&paintSelectedCell(b,d&&c,j)}function ClearSelection(l,c,d){var e=getParentSpread();if(l==null&&e!=null&&e.getAttribute("hierView")=="true"){e.ClearSelection(null,c,d);return}var a=getViewport();if(frzRows==0&&frzCols==0&&a!=null&&a.rows.length>rowCount)for(var b=0;b<a.rows.length;b++)if(a.rows[b].cells.length>0&&a.rows[b].cells[0]!=null&&a.rows[b].cells[0].children.length>0){var f=$$.j(a.rows[b].cells[0]).children().first().get(0);f.getAttribute("FpSpread")=="Spread"&&typeof f.ClearSelection!="undefined"&&f.ClearSelection(true,c,d)}if(c==null||element!=c){doClearSelection();if(anchorCell!=null){if(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="ExtendedSelect"||operationMode=="MultiSelect"){var k=fpSpreadJS.getRowRangeFromCell(anchorCell);paintSelection(k.row,-1,k.rowCount,-1,false)}paintSelectedCell(anchorCell,false);paintAnchorCellHeader(false)}else{var j=getCellFromRowCol(1,0);j!=null&&paintSelectedCell(j,false)}var h=spreadView.IsInTouchMode(),g,i=!h||element==document.FpActiveSpread||retainSelectionBlock&&((g=GetActiveChildSheetView(true))==null||g==element);(!h||!i||getTopSpread(element).GetActiveChartObj()==null)&&spreadView.ShowFocusRectangle(i);selectedCols=[];saveData();dirty=true;if(d==null||d){if(spreadView.IsInTouchMode())spreadView.Touch.ResizeLocation=null;spreadView.UpdateUI()}}}function SetSelectedRange(a,c,b,d,l,h){ClearSelection(false,null,h);var p=a,a=GetDisplayIndex(a),f,g;if(frzRows==0&&frzCols==0){var k=0,n=b,j=getViewport();if(j!=null)for(i=a;i<j.rows.length&&k<n;i++)if(IsChildSpreadRow(j,i))b++;else k++}anchorCell==null&&SetActiveCell(p,c);if(element.getAttribute("layoutMode")){if(c>=0&&b<0){if(d!=1)return;var o=getDisplayIndex(l),e=GetCellByRowCol(o,c);if(e!=null&&parseInt(e.getAttribute("col"))!=-1){c=parseInt(e.getAttribute("col"));g=parseInt(e.parentElement.getAttribute("row"));f=getColFromCell(e)}else return;paintMultipleRowSelection(g,f,1,d,true)}else if(a>=0&&d<0){if(b>parseInt(element.getAttribute("layoutRowCount")))return;var m=parseInt(getRowKeyFromRow(a)),a=parseInt(getFirstRowFromKey(m));updateAnchorCell(a,0,true);b=parseInt(element.getAttribute("layoutRowCount"));paintSelection(a,c,b,d,true)}else if(a>=0&&c>=0&&(d>1||b>1))return}else paintSelection(a,c,b,d,true);setSelection(a,c,b,d,false,g,f);(h==null||h)&&spreadView.UpdateUI()}function AddSelection(b,d,a,c,l,h){var b=GetDisplayIndex(b),f,g;if(frzRows==0&&frzCols==0){var k=0,n=a,j=getViewport();if(j!=null)for(i=b;i<j.rows.length&&k<n;i++)if(IsChildSpreadRow(j,i))a++;else k++}if(element.getAttribute("layoutMode")){if(d>=0&&a<0){if(c!=1)return;var o=getDisplayIndex(l),e=GetCellByRowCol(o,d);if(e!=null&&parseInt(e.getAttribute("col"))!=-1){g=parseInt(e.parentElement.getAttribute("row"));f=getColFromCell(e);d=parseInt(e.getAttribute("col"))}else return;inactiveAllChart(element);paintMultipleRowSelection(g,f,1,c,true)}else if(b>=0&&c<0){if(a>parseInt(element.getAttribute("layoutRowCount")))return;inactiveAllChart(element);var m=parseInt(getRowKeyFromRow(b)),b=parseInt(getFirstRowFromKey(m));if(element.getAttribute("allowGroup")){ClearSelection(false,null,h);updateAnchorCell(b,0,true)}a=parseInt(element.getAttribute("layoutRowCount"));paintSelection(b,d,a,c,true)}else if(b>=0&&d>=0&&(c>1||a>1))return}else{inactiveAllChart(element);paintSelection(b,d,a,c,true)}setSelection(b,d,a,c,true,g,f);(h==null||h)&&spreadView.UpdateUI()}function selectRow(a,d,o,y,u,x){if((selectionBlockOptions&SelectionBlockOptions.Rows)==0&&operationMode=="Normal")return false;var B=selectionUnit;if(B=="Column")return selectTable(o);selectStartRow=a;selectStartCol=-1;var k=getViewport();if(k==null)return false;if(!y){if(!spreadView.IsInTouchMode()){var n=k.rows.length;if(getViewport2()!=null&&getViewport2().rows.length>n)n=getViewport2().rows.length;var i=0,e=getColGroup(k);if(e!=null)i=e.children.length;e=getColGroup(getViewport1());if(e!=null&&e.children.length>i)i=e.children.length;var z=k.parentElement.scrollLeft;if(a>=0&&a<n+frzRows)for(var b=0;b<frzCols+i;b++){var j=getCellFromRowCol(a,b);if(j!=null&&(j.getAttribute("group")||j.getAttribute("canFocus")!="false"&&j.offsetLeft>=z)){updateAnchorCell(a,b,false);break}}}else{var f=spreadView._GetRowIndexByViewIndex(a),g=spreadView._FindRowActiveCell(f,!spreadView.IsRowLayoutMode?1:spreadView.LayoutRowCount),c=g!=null?g.HtmlCell:null,t=spreadView.CanExtendSelect();if(c==null&&(t||spreadView.OperationMode==$$.OperationModes.ROW_MODE)){g=spreadView.GetCell(f,0,true);if(g!=null)c=g.HtmlCell}if(c&&c.rowSpan>1&&!spreadView.IsRowLayoutMode&&t){var r=spreadView._FindExpandedSelection(new GCWS.CellRange(f,-1,d,-1));a=spreadView._GetRow(r.Row).ViewIndex;d=r.RowCount}var p=false;if(c==null&&spreadView.RowHeader.ColumnCount>0){for(var b=spreadView.RowHeader.ColumnCount-1;b>=0;b--){var v=spreadView.RowHeader._GetHtmlCell(f,b);if(v!=null){c=v;break}}p=true}if(c!=null&&c!=anchorCell){spreadView.SetAnchorCell(c,false,u!=null?u&&!p:false);var h=spreadView.OperationMode!=$$.OperationModes.ROW_MODE||spreadView.IsRowLayoutMode;if(!h){var s=spreadView.GetActiveSpanCellRange(anchorCell);if(s!=null&&s.Row!=f){var A=getRowFromCell(anchorCell);paintHeaderSelection(A,-1,1,-1,false,false);h=false}else h=true}h&&paintAnchorCell(true,true)}}editModePermanent&&spreadView._GetViewportFromCell(anchorCell)!=null&&spreadView._IsCellHidden(anchorCell)&&scrollToCell(anchorCell)}selectType="r";var m=d;if(element.getAttribute("layoutMode"))m=parseInt(element.getAttribute("layoutRowCount"));var l=spreadView.IsInTouchMode();l&&spreadView.SuspendShowFocusRectangle();paintSelection(a,-1,m,-1,o);if(o)setSelection(a,-1,d,-1,x);else{RemoveSelection(a,-1,d,-1);if(l&&spreadView.OperationMode==$$.OperationModes.EXTENDED_SELECT)for(var q=GetSelectedRanges(),b=0;b<q.length;b++){var w=q[b];if(w.anchor)continue;if(w.IsIntersectWith(a,-1,d,-1)){paintSelection(a,-1,m,-1,true);break}}}spreadView.ShowFocusRectangle(true);if(l){spreadView.ResumeShowFocusRectangle();spreadView.ShowFocusRectangle()}return true}function selectColumn(b,h,j,q,r){if((selectionBlockOptions&SelectionBlockOptions.Columns)==0&&operationMode=="Normal")return false;var v=selectionUnit;if(v=="Row")return selectTable(j);selectStartRow=-1;selectStartCol=b;var g=getViewport();if(g==null)return false;var a=0,c=b;if(!q&&GetRowCountInternal()>0){var d=true,i=element.getAttribute("layoutMode"),p=getColHeader(),o=getFrozColHeader(),s=isChild(anchorCell,p)||isChild(anchorCell,o);if(i&&s)d=anchorCell.getAttribute("col")=="-1"?null:spreadView._GetViewportCellFromHeaderCell(anchorCell);if(d){var n=g.parentElement.scrollTop-element.virtualTop;for(a=0;a<g.rows.length;a++){if(!g.rows[a].getAttribute("FpKey"))continue;if(g.rows[a].offsetTop>=n)break}a+=frzRows;if(i){var e=anchorCell;if(e){if(parseInt(e.getAttribute("col"))==-1)return false;if(isChild(e,p)||isChild(e,o)){d=spreadView._GetViewportCellFromHeaderCell(e,GetRowCountInternal()>frzRows?frzRows:0);if(!d)return;a=getRowFromCell(d)}else a=getRowFromCell(e);c=getColFromCell(e)}}if(!spreadView.IsInTouchMode()){var t=i?parseInt(element.getAttribute("layoutRowCount")):1,k=a;while(k<frzRows+g.rows.length){var f=i?spreadView._GetViewportCellFromHeaderCell(anchorCell,k):getCellFromRowCol(k,c);if(f!=null&&!f.getAttribute("group")&&f.getAttribute("canFocus")!="false"&&f.offsetTop>=n&&f.parentNode.getAttribute("previewRow")==null){a=getRowFromCell(f);updateAnchorCell(a,c,false,true);break}k+=t}}else{var u=d&&d.nodeName!=null?parseInt(d.parentNode.getAttribute("row")):a;if(findColumnActiveCell(c,1,u,r)||anchorCell&&anchorCell.colSpan>1)if(!spreadView.IsRowLayoutMode&&anchorCell.colSpan>1){var l=spreadView._FindExpandedSelection(new GCWS.CellRange(-1,b,-1,h));b=l.Column;h=l.ColumnCount;c=b}}}else c=getColFromCell(anchorCell);editModePermanent&&spreadView._GetViewportFromCell(anchorCell)!=null&&spreadView._IsCellHidden(anchorCell)&&scrollToCell(anchorCell)}selectType="c";var m=spreadView.IsInTouchMode();m&&spreadView.SuspendShowFocusRectangle();if(!element.getAttribute("layoutMode"))paintSelection(-1,b,-1,h,j);else if(anchorCell!=null){a=parseInt(anchorCell.parentNode.getAttribute("row"));b=parseInt(anchorCell.getAttribute("col"));paintMultipleRowSelection(a,c,1,h,j)}if(j){setSelection(-1,b,-1,h,null,a,c);addColSelection(b)}if(m){spreadView.ResumeShowFocusRectangle();spreadView.ShowFocusRectangle()}return true}function findColumnActiveCell(b,i,f,d){var c=spreadView._FindColumnActiveCell(b,i,spreadView.IsRowLayoutMode?f:-1),a=c!=null?c.HtmlCell:null,e=false;if(a==null){if(spreadView.RowCount>0){c=spreadView.GetCell(0,b,true);if(c!=null)a=c.HtmlCell}if(a==null&&spreadView.ColumnHeader.RowCount>0){var h=spreadView.IsRowLayoutMode?f:spreadView.ColumnHeader.RowCount-1;a=spreadView.ColumnHeader._GetHtmlCell(h,b);e=true}}if(a!=null&&a!=anchorCell){if(d)d=(spreadView.__matchingAnchorCell||anchorCell)!=a;r=getRowFromCell(a);var g=spreadView.IsRowLayoutMode?parseInt(a.parentNode.getAttribute("row")):-1;if(d&&!e){var j=fireActiveCellChangingEvent(r,b,element,g,true);if(j)return false}spreadView.SetAnchorCell(a,false,false);paintAnchorCell(true,true);d&&!e&&fireActiveCellChangedEvent(r,b,element,g,true,true);return true}return false}function adjustAnchorCell(g){var b=getViewport();if(b==null)return-1;for(var a=0,f=b.parentElement.scrollTop-element.virtualTop,a=0;a<b.rows.length;a++){if(!b.rows[a].getAttribute("FpKey"))continue;if(b.rows[a].offsetTop>=f)break}a+=frzRows;var c=g;if(element.getAttribute("layoutMode")){if(parseInt(anchorCell.getAttribute("col"))==-1)return;a=getRowFromCell(anchorCell);c=getColFromCell(anchorCell);copymultiCol=true}var e=a;while(e<frzRows+b.rows.length){var d=getCellFromRowCol(e,c);if(d!=null&&!d.getAttribute("group")&&d.getAttribute("canFocus")!="false"&&d.offsetTop>=f){updateAnchorCell(e,c,false,true);break}e+=element.getAttribute("layoutMode")?parseInt(element.getAttribute("layoutRowCount")):1}return c}function addColSelection(b){for(var c=0,a=0;a<selectedCols.length;a++){if(selectedCols[a]==b)return;if(b>selectedCols[a])c=a+1}selectedCols.length++;for(var a=selectedCols.length-1;a>c;a--)selectedCols[a]=selectedCols[a-1];selectedCols[c]=b}function isColSelected(b){for(var a=0;a<selectedCols.length;a++)if(selectedCols[a]==b)return true;return false}function syncColSelection(){selectedCols=[];for(var d=GetSelectedRanges(),b=0;b<d.length;b++){var a=d[b];if(a.type=="Column")for(var c=a.col;c<a.col+a.colCount;c++)addColSelection(c)}}function initMovingCol(i,d,s,n){if(!i)i=window.event;var p=i.target;if(p.tagName=="INPUT"||p.tagName=="TEXTAREA"||$$.utils.isSelectControl(p))return;if(element.getAttribute("layoutMode")&&d==-1)return;if(element.getAttribute("OperationMode")!="Normal"){selectedCols=[];selectedCols.push(d)}if(s){dragCol=d;dragViewCol=getColByKey(d)}else{if(element.getAttribute("layoutMode"))dragCol=getColTemplateRowFromGroupCell(d);else dragCol=parseInt(GetSheetColIndex(d));dragViewCol=d}spreadView.__startDragScrollLeft=spreadView.Viewport.parentNode.scrollLeft;var a=getMovingCol(),j=element.document;if(!j.createElement)j=window.document;if(s){ClearSelection(false,null,false);a.innerHTML="";var g=j.createElement("DIV");g.innerHTML=n.innerHTML;g.style.borderTop="0px solid";g.style.borderLeft="0px solid";g.style.borderRight="#808080 1px solid";g.style.borderBottom="#808080 1px solid";g.style.width=Math.max(getPreferredCellWidth(n),80)+"px";a.appendChild(g);if(element.getAttribute("DragColumnCssClass")==null){a.style.backgroundColor=$$.j(n).css("backgroundColor");a.style.paddingTop=1;a.style.paddingBottom=1}}else{var t=0;a.innerHTML="";for(var w=j.createElement("table"),A=w.insertRow(),c=0;c<selectedCols.length;c++){var b=element.document.createElement("td");A.appendChild(b);var f,m;if(element.getAttribute("layoutMode")){f=getRowTemplateRowFromGroupCell(d,true);m=getColTemplateRowFromGroupCell(d)}else{if(element.columnHeaderAutoTextIndex!=null)f=parseInt(element.columnHeaderAutoTextIndex);else{f=getColHeader().rows.length-1;while(f>0&&getColHeader().rows[f].getAttribute("FpSpread")=="fb")f--}m=selectedCols[c]}var e=getHeaderCellFromRowCol(f,m,true);if(e.getAttribute("FpCellType")=="ExtenderCellType"&&e.getElementsByTagName("DIV").length>0){var x=getEditor(e),y=getFunction("ExtenderCellType_getEditorValue");if(x!=null&&y!=null)b.innerHTML=y(x)}else b.innerHTML=e.innerHTML;b.style.cssText=e.style.cssText;b.style.backgroundPosition=$$.j(e).css("background-position");b.style.textAlign=$$.j(e).css("textAlign");b.style.borderTop="0px solid";b.style.borderLeft="0px solid";b.style.borderRight="#808080 1px solid";b.style.borderBottom="#808080 1px solid";var z=Math.max(getPreferredCellWidth(e)+6,80);b.style.width=z+"px";t+=z}a.appendChild(w);if(element.getAttribute("DragColumnCssClass")==null){a.style.backgroundColor=element.selectedBackColor;a.style.tableLayout="fixed";a.style.width=t+"px"}}var o=-1;if(!xhtml)o+=parseInt(element.style.borderWidth);a.style.top=i.clientY-getOffsetTop(element,element.document.body)+getScrollTop(element)-o+"px";a.style.left=i.clientX-getOffsetLeft(element,element.document.body)+getScrollLeft(element)-o+"px";selectedCols.context=[];var u=selectedCols.context,l=0,q=getFrozColHeader(),h=getColGroup(q);if(h!=null)for(var c=0;c<h.children.length;c++){var k=getRealColWidth(q,c),v=parseInt(h.children[c].getAttribute("FpCol"));u.push({left:l,width:k,colKey:v,frozen:true});l+=k+spreadView.CellSpacing}var r=getColHeader();h=getColGroup(r);if(h!=null)for(var c=0;c<h.children.length;c++){var k=getRealColWidth(r,c),v=parseInt(h.children[c].getAttribute("FpCol"));u.push({left:l,width:k,colKey:v});l+=k+spreadView.CellSpacing}}function selectTable(i){if((selectionBlockOptions&SelectionBlockOptions.Sheet)==0&&operationMode=="Normal")return false;var f=-1,e=-1,b=getViewport(),n=b.parentElement.scrollTop-element.virtualTop,m=b.parentElement.scrollLeft;if(i){ClearSelection(false,null,false);var a=null,j=false;if(!spreadView.IsInTouchMode())for(var c=0;c<b.rows.length;c++){var h=c+frzRows;if(!b.rows[c].getAttribute("FpKey"))continue;for(var l=parseInt(b.getAttribute("cols")),d=0;d<l;d++){a=getCellFromRowCol(h,d);if(a!=null&&!a.getAttribute("group")&&a.offsetTop>=n&&a.offsetLeft>=m)if(!(a.getAttribute("canFocus")=="false")){updateAnchorCell(h,d,false);f=h;e=d;c=b.rows.length;j=true;break}}if(j)break}else{var g=spreadView._FindSheetActiveCell();if(g!=null&&g.HtmlCell!=anchorCell)if(!spreadView.SetAnchorCell(g.HtmlCell,false,true))return false}editModePermanent&&spreadView._GetViewportFromCell(anchorCell)!=null&&spreadView._IsCellHidden(anchorCell)&&scrollToCell(anchorCell)}selectType="t";paintSelection(-1,-1,-1,-1,false);i&&setSelection(-1,-1,-1,-1);var k=null;if(f!=-1&&e!=-1){k=getCellFromRowCol(f,e);k.style.backgroundColor=selectedBackColor}return true}function getSpanCell(e,d,b){if(b==null)return null;for(var g=b.length,c=0;c<g;c++){var a=b[c],f=a.row<=e&&e<a.row+a.rowCount&&a.col<=d&&d<a.col+a.colCount;if(f)return a}return null}function isCovered(c,b,d){var a=getSpanCell(c,b,d);return a==null?false:a.row==c&&a.col==b?false:true}function isSpanCell(f,e){for(var d=spanCells.length,b=0;b<d;b++){var a=spanCells[b],c=a.row==f&&a.col==e;if(c)return a}return null}function selectRange(e,d,c,b,f,l,g){var k=selectionUnit;if(k=="Row"){selectRow(e,c,f,false);return}else if(k=="Column"){selectColumn(d,b,f,false);return}selectType="";if(f){if(spreadView.IsInTouchMode()){var i=new GCWS.CellRange(spreadView._GetRowIndexByViewIndex(e),d,c,b),a=spreadView._FindExpandedSelection(i);if(a!=i){e=spreadView._GetRow(a.Row).ViewIndex;d=a.Column;c=a.RowCount;b=a.ColumnCount}}setSelection(e,d,c,b);paintAnchorCell();if(anchorCell!=null){var j=anchorCell.getElementsByTagName("SELECT");if(j!=null&&j.length>0)return}var m=getTopSpread(element),h=element.document;if(!h.all)h=window.document;textBox=window.document.getElementById(m.id+"_textBox");if(textBox!=null&&!l){if($$.browser.ie)textBox.value="123";try{if(!$$.browser.ie)g=false;setTextBoxFocus(false,null,g?{ResetSelection:true}:null)}catch(n){$$.DEBUG.Log(n,"selectRange")}fpSpreadJS.setImeMode(element,textBox,anchorCell)}}}function getSpanCells(a){return a==getViewport()||a==getViewport0()||a==getViewport1()||a==getViewport2()?spanCells:a==getFrozColHeader()||a==getColHeader()?colSpanCells:a==getFrozRowHeader()||a==getRowHeader()?rowSpanCells:null}function updateRangeSelection(g,f,j,i,h,a){if(typeof a=="undefined")a=getViewport();if(a==null)return;for(var b=g;b<g+j&&b<a.rows.length;b++){var d=a==getViewport()||a==getViewport2()?b+frzRows:b;if(IsChildSpreadRow(a,d))continue;for(var c=getCellIndex(d,f,getSpanCells(a)),e=0;e<i;e++){if(isCovered(d,f+e,getSpanCells(a)))continue;c<a.rows[b].cells.length&&paintSelectedCell(a.rows[b].cells(c),h);c++}}}function getColFromCell(a){if(a==null||a.style.display=="none"||a.parentElement==null)return-1;var b=getRowFromCell(a);return a.parentElement.parentElement==null?-1:a.parentElement.viewport!=null?getColIndex(b,a.cellIndex,getSpanCells(a.parentElement.viewport),a.parentElement.viewport==getViewport2(),a.parentElement.viewport==getFrozRowHeader()||a.parentElement.viewport==getRowHeader()):getColIndex(b,a.cellIndex,getSpanCells(a.parentElement.parentElement.parentElement),inFrozCols(a),isChild(a,getFrozRowHeader())||isChild(a,getRowHeader()))}function getRowFromCell(a){return a==null||a.parentElement==null?-1:getRowIndexFromRow(a.parentElement)}function getRowIndexFromRow(a){if(a==null||a.parentElement==null)return-1;var b=a.rowIndex;if(frzRows>0&&(smartPaint&&(isChild(a,vpList.table)||isChild(a,vp2List.table)||isChild(a,rhList.table))||isChild(a,getViewport2())||isChild(a,getViewport())||isChild(a,getRowHeader())))b+=frzRows;return b}function getColIndex(j,f,i,h,g){var e=0,a=GetColCount(),d=frzCols;if(h){a=frzCols;d=0}else if(g){d=0;var b=null;if(getFrozRowHeader()!=null)b=getColGroup(getFrozRowHeader());else if(getRowHeader()!=null)b=getColGroup(getRowHeader());if(b!=null)a=b.children.length}for(var c=d;c<a;c++){if(isCovered(j,c,i))continue;if(e==f)return c;e++}return a}function getCellIndex(i,a,b){var d="false",h=getViewport();if(h!=null)d=h.parentNode.getAttribute("hiddenCells");if(d=="true"&&b==spanCells)return b!=rowSpanCells&&a>=frzCols?a-frzCols:a;else{var g=0,e=a;if(b!=rowSpanCells&&a>=frzCols){g=frzCols;e=a-frzCols}for(var f=0,c=0;c<e;c++){if(isCovered(i,g+c,b))continue;f++}return f}}function nextCell(h,k,y,s){var b=s&&s.Event?s.Event:window.event;if(b!=null&&b.altKey)return;if(k==null)k=b!=null&&b.shiftKey;var v=getScrollvp();if(v==null)v=getParent(getViewport());if(anchorCell==null){var j=fireActiveCellChangingEvent(0,0,element);if(!j){var l=getTopSpread(element);if(l!=element)j=l.fireActiveCellChangingEvent(0,0,element)}if(!j){ClearSelection(false,null,false);leadingCellCol=0;leadingCellRow=0;updateAnchorCell(0,0);spreadView.GetCommandBar().UpdateCopyCutPaste();fireActiveCellChangedEvent(0,0,element);l!=element&&l.fireActiveCellChangedEvent(0,0,element);b!=null&&preventDefault(b)}return}if(k&&h!=tab){if(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="MultiSelect"||operationMode=="Normal"&&element.getAttribute("SelectionPolicy")=="Single")return;var d=getSpanCell(leadingCellRow,leadingCellCol,getSpanCells(getViewportFromCell(anchorCell))),i=operationMode=="ExtendedSelect"&&element.getAttribute("layoutMode")==null;switch(h){case right:var a=leadingCellRow,c=leadingCellCol+1;if(d!=null)c=d.col+d.colCount;if(c>GetColCount()-1)return;leadingCellCol=c;leadingCell=getCellFromRowCol(a,c);if(i)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell);break;case left:var a=leadingCellRow,c=leadingCellCol-1;if(d!=null)c=d.col-1;d=getSpanCell(a,c,getSpanCells(getViewportFromCell(anchorCell)));if(d!=null)if(isSpanCell(a,d.col))c=d.col;if(c<0)return;leadingCellCol=c;leadingCell=getCellFromRowCol(a,c);if(i)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell);break;case down:var a=leadingCellRow+1,c=leadingCellCol;if(d!=null)a=d.row+d.rowCount;a=getNextRow(a);if(a>GetRowCountInternal()-1)return;leadingCellRow=a;leadingCell=getCellFromRowCol(a,c);if(i)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else{select(anchorCell,leadingCell);paintSelections(true)}cancelKeyDownOfselectControl(b);break;case up:var a=leadingCellRow-1,c=leadingCellCol;if(d!=null)a=d.row-1;a=getPrevRow(a);d=getSpanCell(a,c,getSpanCells(getViewportFromCell(anchorCell)));if(d!=null)if(isSpanCell(d.row,c))a=d.row;if(a<0)return;leadingCellRow=a;leadingCell=getCellFromRowCol(a,c);if(i)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else{select(anchorCell,leadingCell);paintSelections(true)}cancelKeyDownOfselectControl(b);break;case home:if(anchorCell.parentElement.rowIndex>=0){leadingCellCol=0;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);select(anchorCell,leadingCell)}break;case end:if(anchorCell.parentElement.rowIndex>=0){leadingCellCol=GetColCount()-1;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);if(i)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell)}break;case pdn:if(getViewport()!=null&&leadingCellRow>=0){var m=0;for(a=leadingCellRow;a<getViewport().rows.length;a++){var e=getViewport().rows[a].offsetHeight;if(e==0)e=$$(getViewport().rows[a]).height();m+=e;if(m>getViewport().parentElement.offsetHeight)break}a=getNextRow(a);if(a<getViewport().rows.length){var f=getScrollvp();if(f==null)f=getViewport().parentElement;var n=Math.min(spreadView._GetMaxScrollTop(),element.virtualTop+getViewport().rows[a-frzRows].offsetTop);if(f.scrollTop!=n)f.scrollTop=n;leadingCellRow=a}else{a=GetRowCountInternal()-1;leadingCellRow=a}leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);if(i)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell)}break;case pup:if(getViewport()!=null&&leadingCellRow>=0){a=0;for(a=0;a<getViewport().rows.length;a++){var e=getViewport().rows[a].offsetHeight;if(e==0)e=$$(getViewport().rows[a]).height();if(getViewport().rows[a].offsetTop+e>getViewport().parentElement.scrollTop)break}if(a<getViewport().rows.length){var p=0;while(a>=0){var e=getViewport().rows[a].offsetHeight;if(e==0)e=$$(getViewport().rows[a]).height();p+=e;if(p>getViewport().parentElement.offsetHeight)break;a--}var z=frzRows;if(a<0){z=0;a=0}else a=getPrevRow(a);if(a>=0){var f=getScrollvp();if(f==null)f=getViewport().parentElement;f.scrollTop=frzRows>a?element.virtualTop:element.virtualTop+getViewport().rows[a].offsetTop;leadingCellRow=z+a;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);if(i)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell)}}}}syncColSelection()}else{var w=h==tab;if(h==tab){if(k)h=left;else h=right;b!=null&&preventDefault(b)}var F=anchorCell,a,c;if(k){a=leadingCellRow;c=leadingCellCol}else if(getCellFromRowCol(leadingCellRow,leadingCellCol)==anchorCell){a=leadingCellRow;c=leadingCellCol}else{a=getRowFromCell(anchorCell);c=getColFromCell(anchorCell)}switch(h){case right:moveRight(a,c,w);break;case left:moveLeft(a,c,w);break;case down:moveDown(a,c,y,false,true);break;case up:moveUp(a,c,y,false,true);break;case home:anchorCell.parentElement.rowIndex>=0&&moveRight(a,-1,false);break;case end:anchorCell.parentElement.rowIndex>=0&&moveLeft(a,GetColCount(),false);break;case pdn:if(getViewport()!=null&&leadingCellRow>=0){var m=0;for(a=anchorCell.parentElement.rowIndex;a<getViewport().rows.length;a++){var e=getViewport().rows[a].offsetHeight;if(e==0)e=$$(getViewport().rows[a]).height();m+=e;if(m>getViewport().parentElement.offsetHeight)break}a=getNextRow(a);if(a<getViewport().rows.length){var f=getScrollvp();if(f==null)f=getViewport().parentElement;var n=Math.min(spreadView._GetMaxScrollTop(),element.virtualTop+getViewport().rows[a].offsetTop);if(f.scrollTop!=n)f.scrollTop=n;var o=getCellFromRowCol(frzRows+a,leadingCellCol);o.getAttribute("canFocus")!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}else{a=getPrevRow(parseInt(element.RowCount)-1);var o=getCellFromRowCol(frzRows+a,leadingCellCol);o.getAttribute("canFocus")!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}}break;case pup:if(getViewport()!=null&&leadingCellRow>=0){var q=0;if(element.getAttribute("virtualPaging")=="true"){var r=element.document;if(!r.getElementById)r=window.document;var E=r.getElementById(element.id+"_VirtualPaging_Top");q=E.offsetHeight}a=0;for(a=0;a<getViewport().rows.length;a++){var e=getViewport().rows[a].offsetHeight;if(e==0)e=$$(getViewport().rows[a]).height();if(getViewport().rows[a].offsetTop+e>getViewport().parentElement.scrollTop-q)break}if(a<getViewport().rows.length){var p=0;while(a>=0){var e=getViewport().rows[a].offsetHeight;if(e==0)e=$$(getViewport().rows[a]).height();p+=e;if(p>getViewport().parentElement.offsetHeight)break;a--}a=getPrevRow(a);var j=true;if(frzRows>a&&a>=0){var f=getScrollvp();if(f==null)f=getViewport().parentElement;f.scrollTop=element.virtualTop;var o=getCellFromRowCol(frzRows+a,leadingCellCol);o.getAttribute("canFocus")!="false"&&updateLeadingCell(a,leadingCellCol);j=false}if(a>=0&&j){var G=getViewport().rows[a].offsetTop+q,f=getScrollvp();if(f==null)f=getViewport().parentElement;f.scrollTop=G;var o=getCellFromRowCol(frzRows+a,leadingCellCol);o.getAttribute("canFocus")!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}}}}if(F!=anchorCell&&anchorCell!=null){spreadView.GetCommandBar().EnableButton("Update",true);operationMode=="Normal"&&fireSelectionChangedEvent(element);fpSpreadJS.keepGeneratedSelectionFromAnchorCell();scrollToCell(anchorCell,{Event:b});var B=GetSheetIndex(getRowFromCell(anchorCell)),A=getColFromCell(anchorCell),C=parseInt(anchorCell.parentElement.getAttribute("row"));fireActiveCellChangedEvent(B,A,element,C);var l=getTopSpread(element);l!=element&&l.fireActiveCellChangedEvent(B,A,element,C)}operationMode=="ExtendedSelect"&&selectRow(leadingCellRow,1,true,true)}var x=getCellFromRowCol(leadingCellRow,leadingCellCol);x!=anchorCell&&scrollToCell(x,{Event:b});b!=null&&preventDefault(b);spreadView.GetCommandBar().UpdateCopyCutPaste();saveData();var j=true;element.ignoreVirtualPaging=true;if(anchorCell!=null){var g=!editing?getEditor(anchorCell):fpSpreadJS.GetInlineEditor(anchorCell);if(g!=null){scrollView();var t=b!=null&&(b.type=="keydown"||b.type=="keyup"||b.type=="keypress"),D=b==null?true:t&&h!=b.keyCode;if(!D&&k&&t&&b.keyCode!=tab)g.blur();else{var u=getCellType(anchorCell);if(spreadView.NeedSetEditorFocusOnActiveCell())if(!g.disabled&&(u=="MultiColumnComboBoxCellType"||u=="ExtenderCellType"&&g.getElementsByTagName("INPUT").length>0||g.type==null||g.type=="checkbox"||g.type=="radio"||g.type=="text"||g.type=="password"||g.tagName=="TEXTAREA"||g.tagName=="SELECT")){updateEditingInfo(g);setEditorFocus(g)}else setEditorFocus(g);j=false}if(isEditModeReplace(anchorCell)&&(spreadView.NeedSetEditorFocusOnActiveCell()||spreadView.EditModePermanent))try{g.select&&$$.utils.selectAll(g)}catch(H){selectAllText()}}spreadView.RequireUpdateTextBoxLocation()&&spreadView.IsViewportCell(anchorCell)&&spreadView.UpdateTextBoxLocation(anchorCell)}j&&focus(null,element.getAttribute("layoutMode")!=null);setTimeout(function(){element.ignoreVirtualPaging=false},100)}function syncScrollByCell(b,c,h){var k=false;if((k=isChild(b,getViewport()))||isChild(b,getViewport2())){var a=getScrollvp();if(a==null)a=getParent(getViewport());var m=a.scrollTop,l=a.scrollLeft;if(c==up||c==down||c==left||c==right){var d=getViewport().parentElement.clientHeight;if(c==up||c==left)if(b.parentElement.rowIndex>0){cellViewport=spreadView._GetViewportFromCell(b);if(cellViewport)cellViewport=cellViewport.parentNode;else cellViewport=getViewport().parentNode;var f=b.parentElement.offsetTop+element.virtualTop-a.scrollTop,e=f+b.parentElement.offsetHeight;if(e>d)if(h&&h.Event&&h.Event.type=="keydown")a.scrollTop=a.scrollTop+e-d;else a.scrollTop=Math.max(element.virtualTop,a.scrollTop+Math.min(e-d,b.getBoundingClientRect().top-cellViewport.getBoundingClientRect().top));else if(f<0)a.scrollTop=a.scrollTop-(a.scrollTop-element.virtualTop-b.parentElement.offsetTop)}else a.scrollTop=element.virtualTop;var i=getViewport2(),g=getViewport().offsetHeight;if(i!=null&&g<i.offsetHeight)g=i.offsetHeight;if(c==down||c==right)if(b.parentElement.rowIndex<b.parentElement.parentElement.rows.length-1){var f=b.parentElement.offsetTop+element.virtualTop-a.scrollTop,e=f+b.parentElement.offsetHeight;if(e>d)a.scrollTop=a.scrollTop+e-d;else if(f<0)a.scrollTop=a.scrollTop-(a.scrollTop-element.virtualTop-b.parentElement.offsetTop)}else a.scrollTop=element.virtualTop+g-d;if(k){var j=b.offsetParent!=null?Math.floor(b.getBoundingClientRect().left-b.offsetParent.getBoundingClientRect().left):b.offsetLeft;if(j<a.scrollLeft)a.scrollLeft=j}}if(m!=a.scrollTop||l!=a.scrollLeft)return a}return null}function moveUp(a,b,h,e,d){var g=GetRowCountInternal(),k=GetColCount(),f=1,i=false,c=getSpanCell(a,b,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null){a=c.row-1;if(c.col!=b)f=b-c.col+1}else a--;a=getPrevRow2(a,leadingCellCol,e,d);if(a<0&&h){if(b==f-1){a=getPrevCellRowIndex(g-1,k-1,e,d);b=getPrevCellColIndex(g-1,k-1,e,d)}else{a=getPrevCellRowIndex(g-1,b-f,e,d);b=getPrevCellColIndex(g-1,b-f,e,d)}i=true}if(a>=0){if(h&&i){var c=getSpanCell(a,b,spanCells);if(c!=null){a=c.row;b=c.col;var j=getCellFromRowCol(a,b);if(j.getAttribute("TabStop")=="false"||j.getAttribute("canFocus")=="false"){moveUp(a,b,h,e,d);return}}}if(!updateLeadingCell(a,b))spreadView.IsInTouchMode()&&getSelection().childNodes.length==0&&fpSpreadJS.updateSelectionRangeFromCell(anchorCell)}}function moveDown(a,b,h,d,c){var g=GetRowCountInternal(),i=GetColCount(),f=1,e=getSpanCell(a,b,getSpanCells(getViewportFromCell(anchorCell)));if(e!=null){a=e.row+e.rowCount;f=e.colCount}else a++;a=getNextRow2(a,b,d,c);if(a==g)if(h)if(b==i-f){a=getNextCellRowIndex(0,0,d,c);b=getNextCellColIndex(0,0,d,c)}else{a=getNextCellRowIndex(0,b+f,d,c);b=getNextCellColIndex(0,b+f,d,c)}if(a<g)if(!updateLeadingCell(a,b))spreadView.IsInTouchMode()&&getSelection().childNodes.length==0&&fpSpreadJS.updateSelectionRangeFromCell(anchorCell)}function moveLeft(a,b,c){var f=a,h=GetRowCountInternal(),g=GetColCount();if(typeof c=="undefined")c=true;b=getPrevCol(a,b,c,true);if(b<0){b=g-1;a--;if(a<0)a=h-1;a=getPrevRow(a);leadingCellRow=a}var d=getCellFromRowCol(a,b);if(anchorCell!=d&&(c&&d.getAttribute("TabStop")=="false"||d.getAttribute("canFocus")=="false"))moveLeft(a,b,c);else{var e=updateLeadingCell(leadingCellRow,b);if(e)leadingCellRow=f;else spreadView.IsInTouchMode()&&getSelection().childNodes.length==0&&fpSpreadJS.updateSelectionRangeFromCell(anchorCell)}}function getPrevCol(d,g,f,e){var b=null,a=g,i=GetColCount();while(a>=0){var c=getSpanCell(d,a,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null)a=c.col-1;else a--;b=getCellFromRowCol(d,a);if(b==null)break;var h=f&&b.getAttribute("TabStop")=="false"||e&&b.getAttribute("canFocus")=="false";if(!h)break}return a}function moveRight(b,f,d){var e=b,a=moveRightInternal(b,f,d);if(a!=null){var c=updateLeadingCell(a.row,a.col);if(c)leadingCellRow=e;else spreadView.IsInTouchMode()&&getSelection().childNodes.length==0&&fpSpreadJS.updateSelectionRangeFromCell(anchorCell)}}function moveRightInternal(a,b,c){var e=GetRowCountInternal(),h=GetColCount();if(e==0||h==0)return null;var d=a>-1&&a<e?a:-1,g=b>-1&&b<h?b:-1,j=-1,i=false;if(typeof c=="undefined")c=true;do{if(a>=e){b=0;a=0;a=getNextRow(a);leadingCellRow=a}else{b=getNextCol(a,b,c,true);if(b>=h){if(i)break;b=0;a++;if(a>=e)a=0;if(a==d)i=true;a=getNextRow(a);leadingCellRow=a}}if(d<0||g<0){d=a;g=b}var f=getCellFromRowCol(a,b);if(f!=null&&f.getAttribute("canFocus")!="false"&&!(c&&f.getAttribute("TabStop")=="false"))return{row:a,col:b};j++}while(j==0||d!=a||g!=b);return null}function getPrevCellRowIndex(g,c,e,d){for(var h=GetColCount(),f=GetRowCountInternal(),b=g,a=c,a=c;a>=0;a--){if(a==c)b=getPrevRow2(g,a,e,d);else b=getPrevRow2(f-1,a,e,d);if(b>=0)break}if(b<0)for(a=h-1;a>c;a--){b=getPrevRow2(f-1,a,e,d);if(b>=0)break}return b}function getPrevCellColIndex(g,c,e,d){for(var h=GetColCount(),f=GetRowCountInternal(),b=g,a=c,a=c;a>=0;a--){if(a==c)b=getPrevRow2(g,a,e,d);else b=getPrevRow2(f-1,a,e,d);if(b>=0)break}if(b<0)for(a=h-1;a>c;a--){b=getPrevRow2(f-1,a,e,d);if(b>=0)break}return a}function getNextCellRowIndex(g,f,d,c){for(var h=GetColCount(),e=GetRowCountInternal(),b=g,a=0,a=f;a<h;a++){if(a==f)b=getNextRow2(g,a,d,c);else b=getNextRow2(0,a,d,c);if(b<e)break}if(b==e)for(a=0;a<f;a++){b=getNextRow2(0,a,d,c);if(b<e)break}return b}function getNextCellColIndex(g,f,d,c){for(var h=GetColCount(),e=GetRowCountInternal(),b=g,a=0,a=f;a<h;a++){if(a==f)b=getNextRow2(g,a,d,c);else b=getNextRow2(0,a,d,c);if(b<e)break}if(b==e)for(a=0;a<f;a++){b=getNextRow2(0,a,d,c);if(b<e)break}return a}function getNextCol(d,h,f,e){var b=null,a=h,g=GetColCount();while(a<g){var c=getSpanCell(d,a,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null)a=c.col+c.colCount;else a++;b=getCellFromRowCol(d,a);if(b==null)break;var i=f&&b.getAttribute("TabStop")=="false"||e&&b.getAttribute("canFocus")=="false";if(!i)break}return a}function updateLeadingCell(b,a,g){var c=0;if(element.getAttribute("layoutMode")){c=getRowFromViewPort(b,a);var e=getCellFromRowCol(c,a);if(e)c=e.parentElement.getAttribute("row")}var d=fireActiveCellChangingEvent(b,a,element,c);if(!d){var f=getTopSpread(element);if(f!=element)d=f.fireActiveCellChangingEvent(b,a,element,c)}if(!d){var h=operationMode;h!="MultiSelect"&&ClearSelection(false,null,g);leadingCellCol=a;leadingCellRow=b;selectStartCol=a;selectStartRow=b;updateAnchorCell(b,a,null,false,element.getAttribute("layoutMode")!=null)}return d}function getPrevRow2(g,e,d,c){var b=null,a=g;while(a>=0){a=getPrevRow(a);b=getCellFromRowCol(a,e);var f=d&&b.getAttribute("TabStop")=="false"||c&&b.getAttribute("canFocus")=="false";if(!f)break;a=a-1}return a}function getPrevRow(a){if(a<0)a=0;var b=getViewport();if(a<frzRows){b=getViewport0();if(b==null)b=getViewport1()}if(frzCols==0&&frzRows==0&&b!=null)while(a>0&&b.rows[a].cells.length>0)if(IsChildSpreadRow(b,a))a--;else break;var d=0;if(a>=frzRows){a=a-frzRows;d=frzRows}if(frzCols<GetColCount()){var c=getViewport2();while((c==null||a<c.rows.length&&c.rows[a].cells.length==0)&&b!=null&&a>0&&b.rows[a].cells.length==0)a--}if(b!=null&&a<b.rows.length)if(b.rows[a].getAttribute("previewRow")=="true")a--;return a+d}function getNextRow2(h,f,e,d){var b=null,a=h,c=GetRowCountInternal();while(a<c){a=getNextRow(a);if(a>=c)break;b=getCellFromRowCol(a,f);if(b==null)return-1;var g=e&&b.getAttribute("TabStop")=="false"||d&&b.getAttribute("canFocus")=="false";if(!g)break;a=a+1}return a}function getNextRow(a){var b=getViewport();if(a<frzRows){b=getViewport0();if(b==null)b=getViewport1()}var d=0;if(a>=frzRows){a=a-frzRows;d=frzRows}var e=frzCols==0&&frzRows==0;if(b!=null)while(a<b.rows.length)if(b.rows[a].getAttribute("previewRow")=="true"||e&&IsChildSpreadRow(b,a))a++;else break;if(frzCols<GetColCount()){var c=getViewport2();while((c==null||a<c.rows.length&&c.rows[a].cells.length==0)&&b!=null&&a<b.rows.length&&b.rows[a].cells.length==0)a++}return a+d}function fireColWidthChangedEvent(a,b,c){var d={spread:element,sizeHeader:a,col:b,width:c},e=$$.utils.createEvent("ColWidthChanged",false,true,d);element.dispatchEvent(e)}function fireActiveCellChangingEvent(a,f,b,d,h){var c=getTopSpread(element);if(spreadView.IsSuspendedAction(c,GCWS.Actions.ACTIVE_CELL_CHANGING))return false;if(h)if(c!=element){var i=c.fireActiveCellChangingEvent(a,f,b,d);if(i)return true}var e={spread:element,cancel:false,cmdID:element.id,row:b!=null?b.GetSheetIndex(a):GetSheetIndex(a),col:f};if(element.getAttribute("layoutMode"))e.innerRow=d;var g=$$.utils.createEvent("ActiveCellChanging",false,true,e);element.dispatchEvent(g);return g.cancel}function fireActiveCellChangedEvent(c,b,g,f,e,h){var d=getTopSpread(element);if(spreadView.IsSuspendedAction(d,GCWS.Actions.ACTIVE_CELL_CHANGED))return;var i=$$.utils,a={spread:g,cmdID:element.id,row:c,Row:c,col:b,Col:b};if(element.getAttribute("layoutMode"))a.innerRow=a.InnerRow=f;var j=i.createEvent("ActiveCellChanged",false,true,a);element.dispatchEvent(j);editModePermanent&&!e&&doGetFocus();h&&d!=element&&d.fireActiveCellChangedEvent(c,b,g,f,e)}function fireDataChangedEvent(a,f,e,d,c){var b={spread:e,cell:a,cellValue:f,row:d,col:c},g=$$.utils.createEvent("DataChanged",false,true,b);element.dispatchEvent(g)}function fireSelectionChangedEvent(c){if(ignoreFireSelectionChanged)return;if(spreadView!=null&&spreadView.IsInTouchMode()&&spreadView.__matchingSelection!=null){var a=GetSelectedRange();if(a!=null&&a.Equal(spreadView.__matchingSelection))return}var b={spread:c},d=$$.utils.createEvent("SelectionChanged",false,true,b);element.dispatchEvent(d)}function fireEditStartEvent(e,d,b,f){var c={spread:f,cell:b,row:e,col:d,cancel:false},a=$$.utils.createEvent("EditStart",false,true,c);element.dispatchEvent(a);return a.cancel}function fireEditStoppedEvent(a,c){var b={spread:c,cell:a},d=$$.utils.createEvent("EditStopped",false,true,b);element.dispatchEvent(d)}function GetSheetRowIndex(a){a=GetDisplayIndex(parseInt(a));if(a<0)return-1;var b=null;if(frzRows>0){if(a>=frzRows&&getViewport()!=null)b=getViewport().rows[a-frzRows];else if(a<frzRows&&getViewport1()!=null){var c=getViewport1();b=c.rows[a]!=null?c.rows[a]:c.rows[a]}}else b=getViewport().rows[a];return b!=null?b.getAttribute("FpKey"):-1}function GetSheetColIndex(c,d){var a=-1;if(element.getAttribute("layoutMode")){var e=getDisplayIndex(d),b=GetCellByRowCol(e,c);if(b!=null)a=parseInt(b.getAttribute("col"))}else a=element.GetColKeyFromCol(c);return a}function GetCellByRowCol(a,b){a=GetDisplayIndex(a);return getCellFromRowCol(a,b)}function getHeaderCellFromRowCol(a,c,f){if(a<0||c<0)return null;var b=null;if(f)if(c<frzCols)b=getFrozColHeader();else b=getColHeader();else if(a<frzRows)b=getFrozRowHeader();else b=getRowHeader();var d=getSpanCell(a,c,getSpanCells(b));if(d!=null){a=d.row;c=d.col}var e=getCellIndex(a,c,getSpanCells(b));if(!f)if(a>=frzRows){a-=frzRows;if(a<b.rows.length&&b.rows[a].rowHolder)return rhList.getRow(a).cells[e]}return b!=null&&a<b.rows.length?b.rows[a].cells[e]:null}function getCellFromRowCol(a,c,e){if(a<0||c<0)return null;var b=null;if(a<frzRows)if(c<frzCols)b=getViewport0();else b=getViewport1();else if(c<frzCols)b=getViewport2();else b=getViewport();if(b.parentNode==null)return;var f=getSpanCell(a,c,spanCells);if(f!=null){a=f.row;c=f.col}var d=0,g="false";if(b!=null)g=b.parentNode.getAttribute("hiddenCells");if(e!=null&&$$.utils.contains(element,e)&&g!="true"){if(e.cellIndex<e.parentElement.cells.length-1)d=e.cellIndex+1}else d=getCellIndex(a,c,spanCells);if(a>=frzRows){a-=frzRows;if(a>=0&&a<b.rows.length&&b.rows[a].rowHolder)if(b==getViewport())return vpList.getRow(a).cells[d];else if(b==getViewport2())return vp2List.getRow(a).cells[d]}return a>=0&&a<b.rows.length?b.rows[a].cells[d]:null}function getFirstCellFromCol(f){for(var e=GetRowCountInternal(),d=GetColCount(),b=0;b<e;b++)for(var c=0;c<d;c++){var a=getCellFromRowCol(b,c);if(a!=null&&a.getAttribute("col")==f)return a}return null}function GetHiddenCellValue(b,a){return fpSpreadJS.getValueOfHiddenCell(b,a,xmlData)}function SetHiddenCellValue(f,c,b){var a=fpSpreadJS.setValueOfHiddenCell(f,c,b,xmlData);if(a!=null){var d=this.GetRowByKey(a.r);d!=-1&&SetHiddenValue(d,c,b);var e=addTableCell(addTableRow(a.r),a.c);xmlData.textContent(e,b);spreadView.GetCommandBar().EnableButton("Update",true);dirty=true}}function GetHiddenValue(b,a){return fpSpreadJS.getHiddenValue(b,a,hiddenColumns,getViewport(),getViewport0(),getViewport1(),getViewport2(),frzRows)}function SetHiddenValue(a,d,b){var c=fpSpreadJS.setHiddenValue(a,d,hiddenColumns,b,getViewport(),getViewport0(),getViewport1(),getViewport2(),frzRows);if(c!=-1){a=getRowKeyFromRow(a);fpSpreadJS.setValueOfHiddenCell(null,d,b,xmlData,a);var e=addTableCell(addTableRow(a),c);xmlData.textContent(e,b);spreadView.GetCommandBar().EnableButton("Update",true);dirty=true}}function GetValue(a,e){a=GetDisplayIndex(a);var b=getCellFromRowCol(a,e),d=getRender(b),c=getValueFromRender(d);return c==" "&&b.getAttribute("whiteSpace")==null?"":c}function SetValue(c,g,a,e,f){var d=c;c=GetDisplayIndex(c);if(typeof a!="undefined"&&typeof a!="string")a=new String(a);var b=getCellFromRowCol(c,g);if(validateCell(b,a)){setCellValueFromView(b,a);if(a!=null)setCellValue(b,""+a,e,f);else setCellValue(b,"",e,f);if(!shouldIgnoreSizeSpread()){syncRowRangeSafeMode(d,d);sizeSpread(true)}}else alert(spreadView.GetValidationMessage())}function SetActiveCell(a,b,j,e){var g=getEditingSpread();if(g!=null&&!g.EndEdit({ignoreEditorFocus:true}))return;var c=getTopSpread(element);a=GetDisplayIndex(a);var d=0;if(element.getAttribute("layoutMode")){d=getRowFromViewPort(a,b);var i=getCellFromRowCol(d,b);if(i)d=i.parentElement.getAttribute("row")}var f=fireActiveCellChangingEvent(a,b,element,d);if(!f)if(c!=element)f=c.fireActiveCellChangingEvent(a,b,element,d);if(f)return;spreadView.SuspendAction(c,GCWS.Actions.ACTIVE_CELL_CHANGING);spreadView.SuspendAction(c,GCWS.Actions.ACTIVE_CELL_CHANGED);ignoreFireSelectionChanged=true;element.getAttribute("mcctCellType")==null&&(element.document.FpActiveSpread==null||element.document.FpActiveSpread!=element)&&doGetFocus();var h=anchorCell;ClearSelection(true,null,e);updateAnchorCell(a,b);updateLeadingCell(a,b,e);if(anchorCell&&!j)spreadView._IsCellHidden(anchorCell,true)&&scrollToCell(anchorCell);ignoreFireSelectionChanged=false;spreadView.ResumeAction(c,GCWS.Actions.ACTIVE_CELL_CHANGING);spreadView.ResumeAction(c,GCWS.Actions.ACTIVE_CELL_CHANGED);if(anchorCell!=null&&h!=anchorCell){fireSelectionChangedEvent(element);fireActiveCellChangedEvent(a,b,element);if(e==null||e){if(spreadView.IsInTouchMode())spreadView.Touch.ResizeLocation=null;spreadView.UpdateUI()}var k=getEditor(h);$$.utils.contains(k,$$.utils.getDocActiveElement(),true)&&setTextBoxFocus()}}function updateAnchorCell(a,c,b,f,d){if(a<0||c<0)return;if(smartPaint&&vpList.table.rows.length>0&&a>=frzRows)if(a<current+frzRows)showRows(a-frzRows,current+frzRows-a+1);else a-frzRows>=current+currentCount&&showRows(a-frzRows,1);anchorCell=getCellFromRowCol(a,c);if(anchorCell==null)return;var e=getRowKeyFromCell(anchorCell);setActiveRow(e);setActiveCol(element.getAttribute("layoutMode")?getColKeyFromCell2(anchorCell):getColKeyFromCell(anchorCell));if(b==null||b){if(operationMode=="RowMode"||operationMode=="SingleSelect")!isRowSelected(a)&&selectRow(a,1,true,true);paintSelections(true,d);spreadView.ShowFocusRectangle(true);initialized&&fpSpreadJS.setImeMode(element,textBox,anchorCell);if(!(operationMode=="RowMode"||operationMode=="SingleSelect")&&operationMode!="MultiSelect"&&operationMode!="ExtendedSelect")selectType=""}}function resetLeadingCell(){ClearSelection(false,null,false);if(anchorCell==null)return;leadingCellRow=getRowFromCell(anchorCell);leadingCellCol=getColFromCell(anchorCell);selectRange(leadingCellRow,leadingCellCol,1,1,true)}function Edit(a){var d=operationMode;if(d!="RowMode")return;var b=element.getAttribute("name");if(dirty){saveData();dirty=false}var c=element.getAttribute("ajax")!="false";if(c){FarPoint&&FarPoint.System.WebControl.MultiColumnComboBoxCellTypeUtilitis&&FarPoint.System.WebControl.MultiColumnComboBoxCellTypeUtilitis.CloseAll();syncData(b,"Edit,"+a)}else __doPostBack(b,"Edit,"+a)}function Update(){if(editing&&(!enableRowEditTemplate||operationMode!="RowMode"))return;spreadView.GetTopSpreadView().SaveAllXmlData({dirtyCheck:true});var a=element.getAttribute("name"),b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Update");else __doPostBack(a,"Update")}function MoveCol(e,b){if(editing||b==-1)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");if(selectedCols&&selectedCols.length>0){for(var d=[],c=0;c<selectedCols.length;c++)d[c]=GetSheetColIndex(selectedCols[c]);var g=d.join("+");moveMultiCol(g,b);return}var f=element.getAttribute("ajax")!="false";if(f)syncData(a,"MoveCol,"+e+","+b);else __doPostBack(a,"MoveCol,"+e+","+b)}function moveMultiCol(b,c){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");var d=element.getAttribute("ajax")!="false";if(d)syncData(a,"MoveCol,"+b+","+c);else __doPostBack(a,"MoveCol,"+b+","+c)}function Group(d,c){if(editing)return;var e=element.getAttribute("name");if(selectedCols&&selectedCols.length>0){for(var b=[],a=0;a<selectedCols.length;a++)if(element.getAttribute("layoutMode"))b[a]=parseInt(selectedCols[a]);else b[a]=GetSheetColIndex(selectedCols[a]);var g=b.join("+");groupMultiCol(g,c);selectedCols=[];return}var f=element.getAttribute("ajax")!="false";if(f)syncData(e,"Group,"+d+","+c);else __doPostBack(e,"Group,"+d+","+c)}function groupMultiCol(b,a){if(editing)return;var c=element.getAttribute("name"),d=element.getAttribute("ajax")!="false";if(d)syncData(c,"Group,"+b+","+a);else __doPostBack(c,"Group,"+b+","+a)}function Ungroup(b,a){if(editing)return;var c=element.getAttribute("name"),d=element.getAttribute("ajax")!="false";if(d)syncData(c,"Ungroup,"+b+","+a);else __doPostBack(c,"Ungroup,"+b+","+a)}function Regroup(a,b){if(editing)return;var c=element.getAttribute("name"),d=element.getAttribute("ajax")!="false";if(d)syncData(c,"Regroup,"+a+","+b);else __doPostBack(c,"Regroup,"+a+","+b)}function GroupBar(a){if(editing)return;var b=element.getAttribute("name"),c=element.getAttribute("ajax")!="false";if(c)syncData(b,"GroupBar,"+a);else __doPostBack(b,"GroupBar,"+a)}function GotoPage(b,d){if(editing)return;spreadView.GetTopSpreadView().SaveAllXmlData({dirtyCheck:true});var a=element.getAttribute("name"),e=element.getAttribute("ajax")!="false";if(e){var c=document.activeElement;spreadView.IsFilterBarTextBox(c)&&setTextBoxFocus();syncData(a,"Page,"+b,d)}else __doPostBack(a,"Page,"+b)}function ScrollToPage(b,g,e){if(editing)return;spreadView.GetTopSpreadView().SaveAllXmlData({dirtyCheck:true});var c=g?"ScrollUpToPage":"ScrollDownToPage",d=element.getAttribute("name"),a=element.GetCurrentPageIndex(),f=element.getAttribute("ajax")!="false";if(f)syncData(d,c+","+b+","+a,e);else __doPostBack(d,c+","+b+","+a)}function Cancel(){if(editing&&editor!=null){var c=getCell(editor);c&&spreadView._ResetValidatorStates(c)}var a=xmlData.selectSingleNode("data");if(a!=null){var b=xmlData.firstChild(a);while(b!=null){a.removeChild(b);b=xmlData.firstChild(a)}saveData()}var d=element.getAttribute("name"),e=element.getAttribute("ajax")!="false";if(e)syncData(d,"Cancel");else __doPostBack(d,"Cancel")}function Add(){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");var b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Add");else __doPostBack(a,"Add")}function Insert(){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");var b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Insert");else __doPostBack(a,"Insert")}function Delete(){if(editing)return;var a=null;if(element.document.FpActiveSpread!=null)a=element.document.FpActiveSpread.getAttribute("name");else a=element.getAttribute("name");var b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Delete");else __doPostBack(a,"Delete")}function Next(){if(editing)return;var a=element.getAttribute("name"),b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Next");else __doPostBack(a,"Next")}function Prev(){if(editing)return;var a=element.getAttribute("name"),b=element.getAttribute("ajax")!="false";if(b)syncData(a,"Prev");else __doPostBack(a,"Prev")}function getViewportFromCell(a){return spreadView._GetViewportFromCell(a)}function isChild(b,a){return a!=null&&b!=null?$$.j.contains(a,b):false}function select(l,g,f){if(!spreadView.IsInTouchMode()&&!smartPaint&&(getSpreadControl(l)!=element||getSpreadControl(g)!=element))return;if(inRowHeader(l)||inRowHeader(g))if((selectionBlockOptions&SelectionBlockOptions.Rows)==0&&selectType!="r"&&operationMode=="Normal")return;if(inColHeader(l)||inColHeader(g))if((selectionBlockOptions&SelectionBlockOptions.Columns)==0&&selectType!="c"&&operationMode=="Normal")return;if(!isHeaderCell(l)&&!isHeaderCell(g))if((selectionBlockOptions&SelectionBlockOptions.Cells)==0&&selectType==""&&operationMode=="Normal")return;if(f==null)f={};if(f.SelectStartRow!=null)selectStartRow=f.SelectStartRow;if(f.SelectStartColumn!=null)selectStartCol=f.SelectStartColumn;if(selectStartRow==null&&f.SelectStartRow==null)selectStartRow=getRowFromCell(l);if(selectStartCol==null&&f.SelectStartColumn==null)selectStartCol=getColFromCell(l);var b=selectStartRow,e=selectStartCol,c=f.SelectEndRow==null?getRowFromCell(g):f.SelectEndRow,d=0;if(selectType=="r"){d=-1;if(isChild(g,getColHeader())||isChild(g,getFrozColHeader()))c=0}else if(selectType=="c"){if(isChild(g,getRowHeader())||isChild(g,getFrozRowHeader()))d=0;else d=f.SelectEndColumn==null?getColFromCell(g):f.SelectEndColumn;c=-1}else if(isChild(g,getColHeader())||isChild(g,getFrozColHeader())){c=0;d=f.SelectEndColumn==null?getColFromCell(g):f.SelectEndColumn}else if(isChild(g,getRowHeader())||isChild(g,getFrozRowHeader()))d=0;else d=f.SelectEndColumn==null?getColFromCell(g):f.SelectEndColumn;if(selectType=="t")e=d=b=c=-1;var k=Math.max(b,c);b=Math.min(b,c);c=k;k=Math.max(e,d);e=Math.min(e,d);d=k;var a=null,q=getSelection(),m=xmlData.lastChild(q);if(m!=null){var u=parseInt(m.getAttribute("rowIndex")),t=parseInt(m.getAttribute("colIndex")),s=parseInt(m.getAttribute("rowcount")),r=parseInt(m.getAttribute("colcount"));a=new Range;a.Set("Cell",u,t,s,r)}if(a!=null&&a.col==-1&&a.row==-1)return;var h=spreadView.IsInTouchMode();if(h){var i=new GCWS.CellRange(b!=-1?spreadView._GetRowIndexByViewIndex(b):b,e,b!=-1?c-b+1:-1,e!=-1?d-e+1:-1),o=spreadView.CanExtendSelect(),n=null;if(o&&(i.Row<0&&i.Column!=-1||i.Column<0&&i.Row!=-1)){n=spreadView.FindExpandRowColumnRange(i.Column!=-1,i);o=n!=null}if(o){var j=n!=null?i.UnionWith(n):spreadView._FindExpandedSelection(i);if(j!=i){b=j.Row!=-1?spreadView._GetRow(j.Row).ViewIndex:j.Row;e=j.Column;c=b!=-1?b+j.RowCount-1:-1;d=e!=-1?e+j.ColumnCount-1:-1}}}if(h)if(selectType=="r"&&a.col==-1){a.type="Row";if(a.colCount!=-1)a.colCount=-1}else if(selectType=="r"&&a.row==-1){a.type="Column";if(a.rowCount!=-1)a.rowCount=-1}if(a!=null&&a.col==-1&&a.row>=0)if(a.row>c||a.row+a.rowCount-1<b){paintSelection(a.row,a.col,a.rowCount,a.colCount,false);paintSelection(b,e,c-b+1,d-e+1,true)}else if(b>a.row){var k=b-a.row;if(!h&&a.row<frzRows&&frzRows<a.row+k)k--;paintSelection(a.row,a.col,k,a.colCount,false);h&&spreadView.RepaintIntersectRanges(a.row,a.col,k,a.colCount,a);if(c<a.row+a.rowCount-1){if(h&&a.col==-1&&a.row>-1&&c>-1&&e==-1)paintSelection(c+1,a.col,a.row+a.rowCount-c-1,a.colCount,false);else paintSelection(c,a.col,a.row+a.rowCount-c,a.colCount,false);h&&spreadView.RepaintIntersectRanges(c,a.col,a.row+a.rowCount-c,a.colCount,a)}else paintSelection(a.row+a.rowCount,a.col,c-a.row-a.rowCount+1,a.colCount,true)}else{paintSelection(b,a.col,a.row-b,a.colCount,true);if(c<a.row+a.rowCount-1){paintSelection(c+1,a.col,a.row+a.rowCount-c-1,a.colCount,false);h&&spreadView.RepaintIntersectRanges(c+1,a.col,a.row+a.rowCount-c-1,a.colCount,a)}else paintSelection(a.row+a.rowCount,a.col,c-a.row-a.rowCount+1,a.colCount,true)}else if(a!=null&&a.row==-1&&a.col>=0)if(a.col>d||a.col+a.colCount-1<e){paintSelection(a.row,a.col,a.rowCount,a.colCount,false);paintSelection(b,e,c-b+1,d-e+1,true)}else if(e>a.col){paintSelection(a.row,a.col,a.rowCount,e-a.col,false);if(d<a.col+a.colCount-1)if(h&&a.col>-1&&a.row==-1&&d>-1&&b==-1)paintSelection(a.row,d+1,a.rowCount,a.col+a.colCount-d,false);else paintSelection(a.row,d,a.rowCount,a.col+a.colCount-d,false);else paintSelection(a.row,a.col+a.colCount,a.rowCount,d-a.col-a.colCount,true)}else{paintSelection(a.row,e,a.rowCount,a.col-e,true);if(d<a.col+a.colCount-1)paintSelection(a.row,d+1,a.rowCount,a.col+a.colCount-d-1,false);else paintSelection(a.row,a.col+a.colCount,a.rowCount,d-a.col-a.colCount+1,true)}else if(a!=null&&a.row>=0&&a.col>=0)extendSelection(a,b,e,c-b+1,d-e+1);else paintSelection(b,e,c-b+1,d-e+1,true);var p=a==null;if(f.AddSelection!=null)p=f.AddSelection;setSelection(b,e,c-b+1,d-e+1,p);if(h&&spreadView.OperationMode==$$.OperationModes.NORMAL){paintHeaderSelection(b,e,c-b+1,d-e+1,true);paintHeaderSelection(b,e,c-b+1,d-e+1,true,true)}}function extendSelection(a,c,b,h,g){var i=Math.max(a.col,b),e=Math.min(a.col+a.colCount-1,b+g-1),f=Math.max(a.row,c),d=Math.min(a.row+a.rowCount-1,c+h-1);if(a.row<f)if(!spreadView.IsInTouchMode()&&a.row<frzRows&&frzRows<f)paintSelection(a.row,a.col,f-a.row-1,a.colCount,false);else paintSelection(a.row,a.col,f-a.row,a.colCount,false);a.col<i&&paintSelection(a.row,a.col,a.rowCount,i-a.col,false);a.row+a.rowCount-1>d&&paintSelection(d+1,a.col,a.row+a.rowCount-d-1,a.colCount,false);a.col+a.colCount-1>e&&paintSelection(a.row,e+1,a.rowCount,a.col+a.colCount-e-1,false);c<f&&paintSelection(c,b,f-c,g,true);b<i&&paintSelection(c,b,h,i-b,true);c+h-1>d&&paintSelection(d+1,b,c+h-d-1,g,true);b+g-1>e&&paintSelection(c,e+1,h,b+g-e-1,true)}function paintSelection2(b,a,e,d,c){var g=b,f=a;b<0&&a<0&&paintCornerSelection(c);if(b<0){rowIndex=b;b=0;e=GetRowCountInternal()}if(a<0){colIndex=a;a=0;d=GetColCount()}paintViewportSelection(b,a,e,d,c);paintAnchorCell();var h=operationMode=="Normal"||operationMode=="RowMode"&&spreadView.IsInTouchMode();if(getColHeader()!=null&&h)if(g<0&&f<0)paintHeaderSelection(g,f,e,d,c,true);else paintHeaderSelection(b,a,e,d,c,true);getRowHeader()!=null&&paintHeaderSelection(b,a,e,d,c,false)}function paintSelection(a,c,d,b,e,A){var q=a,p=c;a<0&&c<0&&paintCornerSelection(e);var m=false,n=false,v,u,y;if(a<0){v=a;a=0;d=GetRowCountInternal()}if(c<0){u=c;c=0;b=GetColCount()}paintViewportSelection(a,c,d,b,e);var t=!A&&(e||retainSelectionBlock);if(spreadView.IsInTouchMode()&&anchorCell!=null&&t&&!spreadView.IsRowLayoutMode&&spreadView.OperationMode==$$.OperationModes.ROW_MODE&&anchorCell.rowSpan>1){var z=spreadView.GetActiveSpanCellRange(anchorCell);t=z==null||z.Row==spreadView._GetRowIndexByViewIndex(a)}t&&paintAnchorCell();for(var o=getSelection(),i,k,j,h,g,x=0,w=0,l,f,s=operationMode=="Normal"||operationMode=="RowMode"&&(isInTouchAjax()||spreadView.IsInTouchMode()),r=o.childNodes.length-1;r>=0;r--){i=o.childNodes[r];if(i){k=parseInt(i.getAttribute("rowIndex"));j=parseInt(i.getAttribute("colIndex"));h=parseInt(i.getAttribute("rowcount"));g=parseInt(i.getAttribute("colcount"));if(k<0||h<0){k=0;h=GetRowCountInternal()}if(j<0||g<0){j=0;g=GetColCount()}if(x<h)x=h;if(w<g)w=g;if(r>=o.childNodes.length-1){if(a<=k&&d>=h||element.getAttribute("layoutMode")&&b==1&&a<parseInt(element.getAttribute("layoutRowCount")))if(getColHeader()!=null&&s){if(q<0||p<0)paintHeaderSelection(q,p,d,b,e,true);else paintHeaderSelection(a,c,d,b,e,true);m=true}if(c<=j&&b>=g)if(getRowHeader()!=null){paintHeaderSelection(a,c,d,b,e,false);n=true}if(!m&&!n){if(getColHeader()!=null&&s){paintHeaderSelection(a,c,d,b,e,true);m=true}if(getRowHeader()!=null){paintHeaderSelection(a,c,d,b,e,false);n=true}}}else if(!e&&operationMode=="Normal"&&!element.getAttribute("layoutMode")){l=rangeIntersection(a,c,d,b,k,j,h,g);l&&paintViewportSelection(l.row,l.col,l.rowCount,l.colCount,true);if(m){f=lineIntersection(c,b,j,g);f&&paintHeaderSelection(a,f.s,d,f.c,true,true)}if(n){f=lineIntersection(a,d,k,h);f&&paintHeaderSelection(f.s,c,f.c,b,true,false)}}}}if(v!=null||u!=null)if(x<d&&v<0||w<b&&u<0)y=true;if(o.childNodes.length<=0||element.getAttribute("SelectionPolicy")=="MultiRange"&&y){if(getColHeader()!=null&&s)if(q<0||p<0)paintHeaderSelection(q,p,d,b,e,true);else paintHeaderSelection(a,c,d,b,e,true);getRowHeader()!=null&&paintHeaderSelection(a,c,d,b,e,false)}}function paintAnchorCellHeader(d){if(anchorCell==null||anchorCell.parentElement==null||anchorCell.parentElement.parentElement==null)return;if(d&&!spreadView.IsRowLayoutMode&&spreadView.IsInTouchMode()&&spreadView.OperationMode==$$.OperationModes.ROW_MODE&&anchorCell.rowSpan>1){var e=spreadView.GetActiveSpanCellRange(anchorCell);if(e!=null){var h=spreadView.SelectionModel.GetFocusCellRange();if(e.Row!=h.Row)return}}var j=getColHeader(),i=getFrozColHeader();if(!spreadView.IsInFilterBar(anchorCell)&&(isChild(anchorCell,j)||isChild(anchorCell,i))){paintSelectedCell(anchorCell,d);return}var c,b;c=getRowFromCell(anchorCell);b=getColFromCell(anchorCell);if(d&&operationMode=="Normal"&&anchorCell.getAttribute("group")!=null){var g=getSpanCell(c,b,spanCells);if(g!=null&&g.colCount>1){var a=GetSelectedRange();if(c<a.row||c>=a.row+a.rowCount||b<a.col||b>=a.col+a.colCount)return}}var f=spreadView.IsInTouchMode();getColHeader()!=null&&paintHeaderSelection(c,b,1,!f?1:anchorCell.colSpan,d,true);spreadView._GetViewportFromCell(anchorCell,false)!=null&&getRowHeader()!=null&&paintHeaderSelection(c,b,!f||spreadView.OperationMode==$$.OperationModes.ROW_MODE?1:anchorCell.rowSpan,1,d,false)}function rangeIntersection(i,g,e,c,j,h,f,d){var b=lineIntersection(i,e,j,f),a=lineIntersection(g,c,h,d);return b&&a?{row:b.s,col:a.s,rowCount:b.c,colCount:a.c}:null}function lineIntersection(c,e,d,f){var a,b;a=Math.max(c,d);b=Math.min(c+e,d+f);return a<b?{s:a,c:b-a}:null}function isBorderInCellRange(a){var b=null;if(a.type=="Cell"){if(a.rowCount==1)for(var c=a.col;c<a.col+a.colCount;c++){b=getCellFromRowCol(a.row,c);if(b!=null&&getBorderWidth(b,2)>0)return true}if(a.colCount==1)for(var d=a.row;d<a.row+a.rowCount;d++){b=getCellFromRowCol(d,a.col);if(b!=null&&getBorderWidth(b,1)>0)return true}}else if(a.type=="Row"&&a.rowCount==1)for(var e=GetColCount(),c=0;c<e;c++){b=getCellFromRowCol(a.row,c);if(b!=null&&getBorderWidth(b,2)>0)return true}else if(a.type=="Column"&&a.colCount==1)for(var f=GetRowCountInternal(),d=0;d<f;d++){b=getCellFromRowCol(d,a.col);if(b!=null&&getBorderWidth(b,1)>0)return true}return false}function getColGroupColumnWidth(b,a){var c=b.children,d=engine>=9||$$.browser.chrome?getRealColWidth(b.parentElement,a):c[a].offsetWidth;return d}function paintFocusRect(){var k=element.document;if(!k.all)k=window.document;var e=k.getElementById(element.id+"_focusRectT");if(e==null)return;var a=GetSelectedRange();if(anchorCell==null&&(a==null||a.rowCount==0&&a.colCount==0)){hideFocusBorder();return}var r=element.getAttribute("OperationMode");if(r=="RowMode"||r=="SingleSelect"||r=="MultiSelect"||r=="ExtendedSelect"){var i=getActiveRow();if(i<0){var z=findAnchorCell();if(z!=null)i=GetSheetIndex(getRowFromCell(z));else return}if(element.getAttribute("layoutMode"))i=getFirstMultiRowFromViewport(i,false);a=new Range;a.Set("Row",i,-1,1,-1)}else if(a==null||a.rowCount==0&&a.colCount==0){var i=getActiveRow(),h=getActiveCol();a=new Range;a.Set("Cell",i,h,anchorCell.rowSpan,anchorCell.colSpan)}if(a.row<0){a.row=0;a.rowCount=GetRowCountInternal()}if(a.col<0){a.col=0;a.colCount=GetColCount();if(element.getAttribute("layoutMode")&&a.rowCount<parseInt(element.getAttribute("layoutRowCount"))&&a.type=="Row")a.rowCount=parseInt(element.getAttribute("layoutRowCount"))}var j,g,d,c,F=spreadView.GetAttribute("layoutMode")!=null,m=null;if(F&&anchorCell!=null&&a.type=="Column"&&a.rowCount>0&&frzRows==0&&frzCols==0){var L=parseInt(anchorCell.parentNode.getAttribute("row"));m=getSpanCell(L,a.col,spanCells)}if(m!=null&&m.col!=a.col){var q=getViewport(),N=q.parentNode,H=q.rows[0],A=q.rows[q.rows.length-1],C=parseInt(q.cellSpacing);j=H.offsetTop-C-1;g=anchorCell.offsetLeft-1;c=A.offsetTop+A.offsetHeight-C-1;d=anchorCell.offsetWidth-1;var b=getCellFromRowCol(m.row,m.col);if(b!=null&&spreadView._IsColumnHeaderCell(anchorCell)&&b.getAttribute("col")!=anchorCell.getAttribute("col")){hideFocusBorder();return}}else{var f;if(element.getAttribute("layoutMode"))f=a.innerRow!=null?a.innerRow:a.row;else f=a.row;var b=null;if(f>-1)b=getCellFromRowCol(f,a.col);else if(element.getAttribute("layoutMode"))if(anchorCell!=null){f=parseInt(anchorCell.parentElement.getAttribute("row"));b=getCellFromRowCol(f,a.col)}else{var v=xmlData.lastChild(getSelection());if(v!=null&&v.getAttribute("col")!="-1"){b=getFirstCellFromCol(v.getAttribute("col"));if(b)f=parseInt(b.parentElement.getAttribute("row"))}}if(b==null)return;if(a.rowCount==1&&a.colCount==1){a.rowCount=b.rowSpan;a.colCount=b.colSpan;if(b.colSpan>1&&!isNaN(b.getAttribute("col"))&&!element.getAttribute("layoutMode"))a.col=getColByKey(b.getAttribute("col"))}var n=getViewport().parentElement;j=getOffsetTop(b,n,true)-1;if(a.type=="Column"&&!element.getAttribute("layoutMode")&&getColFromCell(b)<a.col){var i=getRowFromCell(b)+1,M=GetRowCountInternal(),m=null;while(i<M){m=getSpanCell(i,a.col,spanCells);if(m==null||m.col>=a.col)break;i++}b=getCellFromRowCol(i,a.col);if(b==null)b=getCellFromRowCol(f+a.rowCount-1,a.col);if(b==null)return}var K=b,u=f;if(f>-1)while(!isChild(b,n)){u++;if(u>=f+a.rowCount)return;b=getCellFromRowCol(u,a.col);if(b==null)return}g=getOffsetLeft(b,n,true)-1;b=K;if(parseInt(getViewport().cellSpacing)==0){if(a.row==0)j=j+1;if(a.col==0)g=g+1}if(b.rowSpan>1){f=b.parentNode.rowIndex;var o=getCellFromRowCol(f,a.col+a.colCount-1);if(o!=null&&o.parentNode.rowIndex>b.parentNode.rowIndex)j=getOffsetTop(o,n)-1;if(element.getAttribute("layoutMode")&&a.rowCount<b.rowSpan&&(a.type=="Column"||a.type=="Row"))a.rowCount=b.rowSpan}if(b.colSpan>1){var o=getCellFromRowCol(f+a.rowCount-1,a.col),D=getOffsetLeft(o,n)-2;if(D>g){g=D;b=o}if(element.getAttribute("layoutMode")&&a.colCount<b.colSpan&&(a.type=="Column"||a.type=="Row"))a.colCount=b.colSpan}if(b!=null&&spreadView._IsColumnHeaderCell(anchorCell)&&element.getAttribute("layoutMode")&&b.getAttribute("col")!=anchorCell.getAttribute("col")){hideFocusBorder();return}c=0;var l=getViewport().rows;if(l.length>0){var s=f+a.rowCount,E=l[s]?getOffsetTop(l[s],n,true):getOffsetTop(l[l.length-1],n,true)+l[l.length-1].offsetHeight;c=E-j;if(s<l.length)c-=parseInt(getViewport().cellSpacing)}var I=$$.browser,t=getViewport(),y=-1;if(I.ieversion>=9){var B=t.getAttribute("LastDisplayedColumn");if(B!=null)y=parseInt(B)}d=0;var p=getColGroup(t);if(p.children==null||p.children.length==0)return;for(var h=a.col,G=p.children.length,J=a.col+a.colCount;h<J&&h<G;h++){d+=getColGroupColumnWidth(p,h);if(h>a.col)d+=parseInt(t.cellSpacing);if($$.browser.quirksMode&&h==y)break}if(a.col>b.cellIndex&&a.type=="Column"){var w=element.getAttribute("layoutMode")?parseInt(b.getAttribute("scol")):parseInt(b.getAttribute("col"));if(b.getAttribute("group")!=null)w=b.cellIndex;for(var h=w;h<a.col;h++){g+=getColGroupColumnWidth(p,h);if(h>w)g+=parseInt(getViewport().cellSpacing)}}if(parseInt(getViewport().cellSpacing)==0){d+=1;c+=1;if(a.col+a.colCount>=GetColCount())d-=1;if(a.row+a.rowCount>=GetRowCountInternal())c-=1}else if(isBorderInCellRange(a))if(a.type=="Cell"){if(a.rowCount==1)c=c+1;if(a.colCount==1)d=d+1}else if(a.type=="Row")c=c+1;else if(a.type=="Column")d=d+1;c=c-1;d=d-1}if(d<0)d=0;if(c<0)c=0;e.style.left=""+g+"px";e.style.top=""+j+"px";e.style.width=""+d+"px";var k=element.document;if(!k.getElementById)k=window.document;var x=element.id;e=k.getElementById(x+"_focusRectB");e.style.left=""+g+"px";e.style.top=""+(j+c)+"px";e.style.width=""+d+"px";e=k.getElementById(x+"_focusRectL");e.style.left=""+g+"px";e.style.top=""+j+"px";e.style.height=""+c+"px";e=k.getElementById(x+"_focusRectR");e.style.left=""+(g+d)+"px";e.style.top=""+j+"px";e.style.height=""+c+"px"}function paintCornerSelection(e){var d=true;if(getTopSpread(element).getAttribute("ShowHeaderSelection")=="false")d=false;if(!d)return;if(spreadView.IsSuspendPaintSelection())return;var a=getCorner();if(a!=null&&a.rows.length>0)for(var b=0;b<a.rows.length;b++){if(a.rows[b].getAttribute("FpSpread")=="fb")continue;for(var c=0;c<a.rows[b].cells.length;c++)a.rows[b].cells[c]!=null&&paintSelectedCell(a.rows[b].cells[c],e)}}function paintHeaderSelection(a,b,f,h,m,e){var j=true;if(getTopSpread(element).getAttribute("ShowHeaderSelection")=="false")j=false;if(!j)return;if(spreadView.IsSuspendPaintSelection())return;var q=e?colSpanCells:rowSpanCells;if(a>=0&&b>=0&&element.getAttribute("layoutMode")&&e){if(f>parseInt(element.getAttribute("layoutRowCount")))f=parseInt(element.getAttribute("layoutRowCount"));var k=getCellFromRowCol(a,b);if(element.getAttribute("allowGroup")&&k&&k.getAttribute("group")!=null)a=getFirstMultiRowFromViewport(a,true);for(var c=a;c<a+f;c++)for(var d=b;d<b+h;d++){var n=getCellFromRowCol(c,d);if(n){var g=spreadView._GetHeaderCellFromViewportCell(n);if(g){if(g.parentNode.getAttribute("FpSpread")=="fb")return;paintSelectedCell(g,m)}}}}else{var i=GetRowCountInternal(),o=GetColCount();if(e){if(getColHeader()==null)return;a=0;f=i=getColHeader().rows.length;if(b<0){b=0;var p=getColGroup(getColHeader());if(p==null)return;h=frzCols+p.childNodes.length}}else{if(getRowHeader()==null)return;b=0;var l=getColGroup(getRowHeader());if(l==null)return;h=o=l.children.length}if(element.getAttribute("layoutMode")&&operationMode!="Normal"&&!e)a=getFirstMultiRowFromViewport(a,false);if(element.getAttribute("layoutMode")&&anchorCell!=null&&anchorCell.getAttribute("group")!=null&&!e&&f!=i)f=1;for(var c=a;c<a+f&&c<i;c++){if(!e&&IsChildSpreadRow(getViewport(),c))continue;for(var d=b;d<b+h&&d<o;d++){if(!element.getAttribute("layoutMode")&&isCovered(c,d,q))continue;var g=getHeaderCellFromRowCol(c,d,e);if(g){if(g.parentNode.getAttribute("FpSpread")=="fb")return;paintSelectedCell(g,m)}}}}}function paintViewportSelection(e,g,d,j,h){if(spreadView.IsSuspendPaintSelection())return;var f=GetRowCountInternal(),i=GetColCount();if(element.getAttribute("layoutMode")&&operationMode!="Normal"&&d==parseInt(element.getAttribute("layoutRowCount")))e=getFirstMultiRowFromViewport(e,false);if(element.getAttribute("layoutMode")&&anchorCell!=null&&anchorCell.getAttribute("group")!=null&&d!=f)d=1;for(var a=e;a<e+d&&a<f;a++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(getViewport(),a))continue;for(var b=null,c=g;c<g+j&&c<i;c++){if(isCovered(a,c,spanCells))continue;b=getCellFromRowCol(a,c,b);b!=null&&b.parentNode.getAttribute("previewRow")==null&&paintSelectedCell(b,h)}}}function Copy(p,i){if(element.document.FpActiveSpread!=null&&element.document.FpActiveSpread!=element){element.document.FpActiveSpread.Copy(p,i);return}if(spreadView.EnableRowEditTemplate)if(!spreadView.IsInTouchMode()||anchorCell.getAttribute("RowEditTemplate")=="true")return;var y=getSelection(),b=xmlData.lastChild(y),c=null;if(b!=null){var j,g,d,k,h;copymultiCol=false;if(element.getAttribute("layoutMode")&&b.getAttribute("col")!="-1"&&b.getAttribute("row")=="-1"&&b.getAttribute("rowcount")=="-1"){var a=anchorCell;if(a){j=parseInt(a.parentElement.getAttribute("row"));var B=spreadView._GetFirstCellFromLayoutCol(b.getAttribute("col"));g=getRowFromCell(B);d=getColFromCell(a);k=GetRowCountInternal();h=parseInt(b.getAttribute("colcount"));copymultiCol=true}}else if(element.getAttribute("layoutMode")&&b.getAttribute("col")=="-1"&&b.getAttribute("colcount")=="-1"&&b.getAttribute("row")!=-1){var m=b.getAttribute("row");if(m!="newRow")m=parseInt(m);g=getFirstRowFromKey(m);d=parseInt(b.getAttribute("colIndex"));k=parseInt(element.getAttribute("layoutRowCount"))}else{g=element.getAttribute("layoutMode")?parseInt(b.getAttribute("rowIndex")):getRowByKey(b.getAttribute("row"));d=element.getAttribute("layoutMode")?parseInt(b.getAttribute("colIndex")):getColByKey(b.getAttribute("col"));k=parseInt(b.getAttribute("rowcount"));h=parseInt(b.getAttribute("colcount"))}var q=false;if(g<0||copymultiCol){if(!copymultiCol){g=0;k=GetRowCountInternal()}var z={spread:element,includeColHeader:false},w=$$.utils.createEvent("CopyData",false,true,z);element.dispatchEvent(w);q=w.includeColHeader}if(d<0){d=0;h=GetColCount()}if(j==null)j=g;c="";if(q){var u=g,t=getColHeader().rows,r=rl=t.length;while(rl>0&&t[rl-1].getAttribute("FpSpread")=="fb")rl--;if(element.getAttribute("layoutMode")&&rl>0){r=parseInt(element.getAttribute("layoutRowCount"));var A=spreadView._GetFirstCellFromLayoutCol(b.getAttribute("col"),true);u=A.parentNode.rowIndex}else r=rl;for(var e=u;e<r;e++){if(e<rl)for(var a=null,f=d;f<d+h;f++){if(isCovered(e,f,colSpanCells))c+="";else{a=getHeaderCellFromRowCol(e,f,true);if(element.getAttribute("layoutMode")&&copymultiCol&&(a==null||parseInt(a.parentElement.getAttribute("row"))!=j))continue;var o=getCellType(a);if(o=="TextCellType"||o=="text")if(a!=null&&a.getAttribute("password")!=null)c+="";else c+=spreadView._PrepairValueToCopy(getCellValueFromView(a),i);else c+=!i?getCellValueFromView(a):spreadView._PrepairValueToCopy(getCellValueFromView(a),true)}if(f+1<d+h)c+="\t"}c+="\r\n"}}var s=g;if(q)s=0;for(var e=s;e<g+k;e++){if(IsChildSpreadRow(getViewport(),e))continue;for(var a=null,f=d;f<d+h;f++){if(isCovered(e,f,spanCells))c+="";else{a=getCellFromRowCol(e,f,a);if(element.getAttribute("layoutMode")&&copymultiCol&&(a==null||parseInt(a.parentElement.getAttribute("row"))!=j))continue;if(a!=null&&a.parentNode.getAttribute("previewRow")=="true")continue;var o=getCellType(a);if(o=="TextCellType"||o=="text")if(a!=null&&a.getAttribute("password")!=null)c+="";else c+=spreadView._PrepairValueToCopy(getCellValueFromView(a),i);else c+=!i?getCellValueFromView(a):spreadView._PrepairValueToCopy(getCellValueFromView(a),true)}if(f+1<d+h)c+="\t"}c+="\r\n"}}else if(anchorCell!=null)c=!i?getCellValueFromView(anchorCell):spreadView._PrepairValueToCopy(getCellValueFromView(anchorCell),true);if(c!=null){if(p){var v=getTopSpread(element),x=v.getAttribute("clipboard")==null;if(x){if(p){var l=$$.j(window.document);l.off("copy",documentOnCopy);l.on("copy",documentOnCopy);l.off("cut",documentOnCopy);l.on("cut",documentOnCopy)}var n=window.document.activeElement;if(!$$.browser.chrome||!$$.utils.isNativeControl(n)||n.tagName=="INPUT"&&n.type=="password")if(textBox==n){textBox.value="123";$$.utils.selectAll(textBox)}else __focusTextBoxTemporary(v,c)}}setClipboardData(c)}}function restoreDocumentScroll(){var a=spreadView.__scrollValues;if(a){window.document.documentElement.scrollTop=a.documentScrollTop;window.document.documentElement.scrollLeft=a.documentScrollLeft;window.document.body.scrollTop=a.documentScrollTop;window.document.body.scrollLeft=a.documentScrollLeft}}function preventDocumentScroll(){window.document.removeEventListener("scroll",preventDocumentScroll,false);var a=spreadView.__scrollValues;if(a)if(a.useTimeout)setTimeout(restoreDocumentScroll,0);else restoreDocumentScroll()}function __focusTextBoxTemporary(ts,data){var buffer=getClipboardBuffer();buffer.value=data;var ae=document.activeElement,mccbObj=null,ctlr=getEditor(anchorCell);if(ctlr!=null&&ctlr.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"&&$$.utils.contains(ctlr,window.document.activeElement)){var mccbId=getMccbID(anchorCell,element);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);mccbObj=eval("window."+mccbId+"_Obj");if(mccbObj!=null&&mccbObj.getIsDrop())mccbObj.SetBlurEventHandler(false);else mccbObj=null}}detachOnActiveEvents();var bkOnblur=ae.onblur;ae.onblur=null;spreadView.RequireUpdateTextBoxLocation()&&$$(buffer).moveToPosition((window.innerWidth||window.clientWidth)/2,(window.innerHeight||window.clientHeight)/2);buffer.focus();element.scrollTop=0;ae.onblur=bkOnblur;mccbObj!=null&&mccbObj.SetBlurEventHandler(true);buffer.selectionStart=0;buffer.selectionEnd=data.length;setTimeout(function(){spreadView.__scrollValues={documentScrollLeft:window.document.body.scrollLeft||window.document.documentElement.scrollLeft,documentScrollTop:window.document.body.scrollTop||window.document.documentElement.scrollTop,useTimeout:$$.browser.mozilla&&$$.utils.isTextControl(ae)};buffer.value="";detachScrollEvents();if(ae==textBox||ae==element||spreadView._IsGrayArea(ae)){$$(textBox).moveToPosition((window.innerWidth||window.clientWidth)/2,(window.innerHeight||window.clientHeight)/2);setTextBoxFocus(null,null,{PreventUpdateLocation:true})}else{window.document.addEventListener("scroll",preventDocumentScroll,false);var c=ae.onfocus;ae.onfocus=null;var a=spreadView._GetViewportFromCell(getCell(ae)),b=a?a.parentNode.scrollTop:-1;ae.focus();ae.onfocus=c;if(a&&a.parentNode.scrollTop!=b){spreadView.Style.BackupAndClear(a.parentNode,"overflow");a.parentNode.style.overflow="hidden";a.parentNode.scrollTop=b;scrollView({target:a.parentNode});spreadView.Style.Restore(a.parentNode,"overflow")}preventDocumentScroll()}attachScrollEvents();attachOnActiveEvents();setTimeout(function(){window.document.removeEventListener("scroll",preventDocumentScroll,false);spreadView.__scrollValues=null},0)},0)}function getClipboardData(){var b=element.getAttribute("clipboard")==null;if(clipboardLock==2)return null;if(b&&window.clipboardData&&window.clipboardData.getData){var a=null;try{if(clipboardLock==-1){clipboardLock=2;a=window.clipboardData.getData("Text");if(a!=""||window.clipboardData.setData("Text","sample")){a==""&&window.clipboardData.setData("Text",a?a:"");clipboardLock=0}else clipboardLock=1}}catch(c){$$.DEBUG.Log(c,"getClipboardData");clipboardLock=-1}if(!clipboardLock)return a!==null?a:window.clipboardData.getData("Text")}return window.ssClipboardData}function setClipboardData(a){var b=element.getAttribute("clipboard")==null;if(clipboardLock==2)return null;if(b&&window.clipboardData&&window.clipboardData.getData)try{if(clipboardLock==-1){clipboardLock=2;if(window.clipboardData.setData("Text",a)){clipboardLock=0;return}else clipboardLock=1}}catch(c){$$.DEBUG.Log(c,"getClipboardData")}if(b&&!clipboardLock)window.clipboardData.setData("Text",a);else window.ssClipboardData=a}function getCellValueFromView(b){var a=null;if(b!=null){var c=getRender(b);a=getValueFromRender(c);if(a==null||a==" ")a=""}return a}function setCellValueFromView(a,f,e){if(a!=null){var b=getRender(a),d=getCellType(a),c=false;if(d=="readonly"&&a.getAttribute("locked")!="true"&&a.getAttribute("canFocus")=="false")c=true;if((d!="readonly"||e||c)&&b!=null&&b.getAttribute("FpEditor")!="Button"){setValueToRender(b,f);return true}}return false}function Paste(s,r){if(element.document.FpActiveSpread!=null&&element.document.FpActiveSpread!=element){element.document.FpActiveSpread.Paste(s,r);return}if(spreadView.EnableRowEditTemplate)if(!spreadView.IsInTouchMode()||anchorCell.getAttribute("RowEditTemplate")=="true")return;if(anchorCell==null)return;var D=element.document;if(!D.getElementById)D=window.document;var t=typeof s!="undefined"?s:getClipboardData();if(t==null)return;var L=getViewportFromCell(anchorCell),e=getRowFromCell(anchorCell),h=getColFromCell(anchorCell),F=GetColCount(),u=GetRowCountInternal(),m=element.getAttribute("layoutMode"),x=anchorCell.getAttribute("col"),y=parseInt(anchorCell.parentElement.getAttribute("row")),z=false,B=getSelection();if(B!=null){var d=xmlData.lastChild(B);if(d!=null){var e=parseInt(d.getAttribute("row")),h=parseInt(d.getAttribute("col"));if(m&&d.getAttribute("col")!="-1"&&d.getAttribute("row")=="-1"&&d.getAttribute("rowcount")=="-1"){var K=spreadView._GetFirstCellFromLayoutCol(d.getAttribute("col"));e=getRowFromCell(K);h=getColFromCell(anchorCell);z=true}else if(m&&d.getAttribute("col")=="-1"&&d.getAttribute("colcount")=="-1"&&d.getAttribute("row")!=-1){var o=d.getAttribute("row");if(o!="newRow")o=parseInt(o);e=getFirstRowFromKey(o);h=parseInt(d.getAttribute("colIndex"))}else{e=m?parseInt(d.getAttribute("rowIndex")):getRowByKey(d.getAttribute("row"));h=m?parseInt(d.getAttribute("colIndex")):getColByKey(d.getAttribute("col"))}if(e<0)e=0;if(h<0)h=0}}if(z&&x!=null&&parseInt(x)>=0)copymultiCol=true;var g=e,f=h,n=0,a=null;if(r){a=spreadView._PrepairPasteData(t);for(var c=0;c<a.length;c++)if(a[c].length>n)n=a[c].length}else{var k=new String(t);if(k.length==0)return;var I=!$$.browser.mozilla||k.lastIndexOf("\r\n")!=-1,q=I?"\r\n":"\n",v=k.lastIndexOf(q);if(v>=0&&v==k.length-q.length)k=k.substring(0,v);a=k.split(q);for(var c=0;c<a.length&&g<u;c++){if(typeof a[c]=="string"){a[c]=a[c].split("\t");if(a[c].length>n)n=a[c].length}g++}}g=GetSheetIndex(e);for(var c=0;c<a.length&&g<u;c++){var l=a[c];if(l!=null){f=h;for(var b=null,p=GetDisplayIndex(g),i=0;i<l.length&&f<F;i++){if(!isCovered(p,f,spanCells)){b=getCellFromRowCol(p,f,b);if(b==null)continue;if(m&&copymultiCol&&parseInt(b.parentElement.getAttribute("row"))!=y)continue;if(b.parentNode.getAttribute("previewRow")=="true")continue;var j=l[i];if(!validateCell(b,j)){alert(spreadView.GetValidationMessage());return}}f++}}g++}if(a.length==0)return;g=GetSheetIndex(e);for(var c=0;c<a.length&&g<u;c++){f=h;for(var l=a[c],b=null,p=GetDisplayIndex(g),i=0;i<n&&f<F;i++){if(!isCovered(p,f,spanCells)){b=getCellFromRowCol(p,f,b);if(b==null)continue;if(m&&copymultiCol&&parseInt(b.parentElement.getAttribute("row"))!=y)continue;if(b.parentNode.getAttribute("previewRow")=="true")continue;var C=getCellType(b),E=getRender(b);if(b.getAttribute("CellType2")=="HyperLinkCellType")continue;if(C!="readonly"&&E.getAttribute("FpEditor")!="Button"||C=="readonly"&&b.getAttribute("locked")!="true"){var j=null;if(l!=null&&i<l.length)j=r?l[i]:trimQuote(l[i]);var J=setCellValueFromView(b,j);if(J){if(j!=null)j=getValueFromRender(E,false,true);if(j!=null)setCellValue(b,""+j);else setCellValue(b,"")}}}f++}g++}var G=spreadView._GetRowIndexByViewIndex(e),A=spreadView._GetRow(G+a.length-1,false,true),w=A?A.ViewIndex:e+a.length-1;if($$.browser.ieversion>=11&&spreadView.IsInTouchMode()&&spreadView.SpanModel.length>0)setTimeout(function(){syncRowRangeSafeMode(e,w,false)},0);else syncRowRangeSafeMode(e,w,false);sizeSpread(true);var H=element.getAttribute("autoCalc");if(H!="false")updateValues();else saveData();getRowHeader()==null&&frzCols==0&&prepairSpreadLayout()}function documentOnPaste(b){var c=getTopSpread(element);if(c.getAttribute("clipboard")==null){var d=b.originalEvent,a=d.clipboardData.getData("Text");if(a!=null&&a!=""){Paste(a,keyActionInfo&&keyActionInfo.CanPaste);keyActionInfo=null}preventDefault(b)}$$.j(document).off("paste",documentOnPaste)}function documentOnCopy(b){var c=getTopSpread(element);if(c.getAttribute("clipboard")==null){var d=b.originalEvent;d.clipboardData.setData("Text",window.ssClipboardData);preventDefault(b)}var a=$$.j(window.document);a.off("copy",documentOnCopy);a.off("cut",documentOnCopy)}function getFrozenRowCount(){if(frzRows==0)return 0;var a=getViewport0();if(a==null)a=getViewport1();for(var c=0,b=0;b<a.rows.length;b++){if(!a.rows[b].getAttribute("FpKey"))continue;c++}return Math.min(frzRows,c)}function trimQuote(a){if(a==null||a.length==0)return null;if(a.indexOf("\n")<=0)return a;if(a.charAt(0)=='"'&&a.charAt(a.length-1)=='"')a=a.substring(1,a.length-1);var b=new RegExp('""',"g");a=a.replace(b,'"');return a}function updateValues(){if(dataBuff==null&&getParentSpread()==null&&element.getAttribute("rowFilter")!="true"&&element.getAttribute("hierView")!="true"&&element.getAttribute("IsNewRow")!="true"){saveData();storePostData();syncData(element.getAttribute("name"),"UpdateValues")}}function validateCell(a,c){if(a==null)return true;if(spreadView.HasValidators(a)&&a.getAttribute("locked")!="true")return spreadView.GetInvalidValidator(a,c)==null;if(c==null||c=="")return true;var b=getEditor(a);if(b==null){var e=getCellEditorID(a);if(e!=null)b=getCellEditor(e,true)}if(b!=null&&typeof b.isValid!="undefined"){var d=b.isValid(c);return d==""}var f=getCellType(a,a.getAttribute("locked")!="true");if(f!=null){var g=getFunction(f+"_isValid");if(g!=null){var d=g(a,c);return d==null||d==""}}return true}function isDouble(e,b){if(e==null||e.length==0)return true;var i=new RegExp("^\\s*([-\\+])?(\\d+)?(\\"+b.getAttribute("decimalchar")+"(\\d+))?([eE]([-\\+])?(\\d+))?\\s*$"),a=e.match(i);if(a==null)return false;var h=a[1]+(a[2].length>0?a[2]:"0")+"."+a[4]+"E"+a[6]+(a[7].length>0?a[7]:"0"),d=parseFloat(h);if(isNaN(d))return false;var c=true;if(b.getAttribute("minimumvalue")!=null){var g=parseFloat(b.getAttribute("minimumvalue"));c=!isNaN(g)&&d>=g}if(c&&b.getAttribute("maximumvalue")!=null){var f=parseFloat(b.getAttribute("maximumvalue"));c=!isNaN(f)&&d<=f}return c}function updateSelectionsBackColor(k,j){for(var i=getSelection(),b=null,g=0;g<i.childNodes.length;g++){b=i.childNodes[g];var h=parseInt(b.getAttribute("rowIndex")),f=parseInt(b.getAttribute("colIndex")),m=parseInt(b.getAttribute("rowcount")),l=parseInt(b.getAttribute("colcount"));if(h!=-1&&f!=-1)for(var d=0;d<m;d++)for(var e=0;e<l;e++){if(k==h+d&&j==f+e)continue;var a=getCellFromRowCol(h+d,f+e);if(a!=null&&a.paintSelected==null){var c=$$.j(a).css("backgroundColor");if(element.getAttribute("semiTransparentSelectedBackColor")==null||c==null||c.length==0||c=="transparent")a.style.backgroundColor=selectedBackColor;else a.style.backgroundColor=darker(c,selectedBackColor);a.paintSelected=true}}}}function doClearSelection(){var g=getSelection(),b=xmlData.lastChild(g),c=[];while(b!=null){var d=parseInt(b.getAttribute("rowIndex")),f=parseInt(b.getAttribute("colIndex")),e=parseInt(b.getAttribute("rowcount")),i=parseInt(b.getAttribute("colcount"));if(element.getAttribute("layoutMode")&&d!=-1&&(i==-1||operationMode!="Normal")){e=parseInt(element.getAttribute("layoutRowCount"));c.push({r:d,c:-1,rc:e,cc:-1})}if(element.getAttribute("layoutMode")&&f!=-1&&(e==-1||operationMode!="Normal")){var h=spreadView._GetFirstCellFromLayoutCol(b.getAttribute("col"));if(h){d=parseInt(h.parentElement.getAttribute("row"));f=getColFromCell(h)}c.push({r:d,c:f,rc:1,cc:i,m:true})}else c.push({r:d,c:f,rc:e,cc:i});g.removeChild(b);b=xmlData.lastChild(g)}for(var j=0;j<c.length;j++){var a=c[j];if(a.m)paintMultipleRowSelection(a.r,a.c,a.rc,a.cc,false);else paintSelection(a.r,a.c,a.rc,a.cc,false)}}function Clear(workArroundClipboard,useExcelBehavior){if(element.document.FpActiveSpread!=null&&element.document.FpActiveSpread!=element){element.document.FpActiveSpread.Clear(workArroundClipboard,useExcelBehavior);return}if(spreadView.EnableRowEditTemplate)if(!spreadView.IsInTouchMode()||anchorCell.getAttribute("RowEditTemplate")=="true")return;else if(operationMode=="RowMode"){var editRow=element.document.getElementById(element.id+"_editRow");if(editRow&&anchorCell.parentNode.rowIndex==editRow.rowIndex&&editRow.cells.length>0&&editRow.cells[0].getAttribute("RowEditTemplate")=="true")return}var cellType=getCellType(anchorCell);if(cellType=="readonly")return;var selection=getSelection(),node=xmlData.lastChild(selection);if(anyReadOnlyCell(node))return;Copy(workArroundClipboard,useExcelBehavior);if(node!=null){var r,c,rc,cc,IsColumn=false;if(element.getAttribute("layoutMode")&&node.getAttribute("col")!="-1"&&node.getAttribute("row")=="-1"&&node.getAttribute("rowcount")=="-1"){var cell=anchorCell;if(cell){r=parseInt(cell.parentElement.getAttribute("row"));c=getColFromCell(cell);rc=GetRowCountInternal();cc=parseInt(node.getAttribute("colcount"));IsColumn=true}}else if(element.getAttribute("layoutMode")&&node.getAttribute("col")=="-1"&&node.getAttribute("row")!=-1){var rowKey=node.getAttribute("row");if(rowKey!="newRow")rowKey=parseInt(rowKey);r=getFirstRowFromKey(rowKey);c=parseInt(node.getAttribute("colIndex"));rc=parseInt(element.getAttribute("layoutRowCount"))}else{r=parseInt(node.getAttribute("rowIndex"));c=parseInt(node.getAttribute("colIndex"));rc=parseInt(node.getAttribute("rowcount"));cc=parseInt(node.getAttribute("colcount"))}if(r<0){r=0;rc=GetRowCountInternal()}if(c<0){c=0;cc=GetColCount()}for(var activeElement=element.document.activeElement,requireKeepFocus=false,i=r;i<r+rc;i++){if(IsChildSpreadRow(getViewport(),i))continue;for(var cell=null,j=c;j<c+cc;j++)if(!isCovered(i,j,spanCells)){cell=getCellFromRowCol(i,j,cell);if(cell==null)continue;if(element.getAttribute("layoutMode")&&IsColumn&&parseInt(cell.parentElement.getAttribute("row"))!=r)continue;if(cell.parentNode.getAttribute("previewRow")=="true")continue;var cellType=getCellType(cell);if(cellType!="readonly"){var edit=getEditor(cell);if(edit!=null&&edit.getAttribute("FpEditor")=="Button")continue;if(edit!=null&&edit.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"){var mccbId=getMccbID(cell,element);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval("window."+mccbId+"_Obj");editorObj!=null&&editorObj.SetText(null)}}else{cell.removeAttribute("FpFormula");setCellValueFromView(cell,null)}setCellValue(cell,"");if(!requireKeepFocus&&cellType=="ExtenderCellType"){var cellEditor=getEditor(cell);if(cellEditor!=null&&cellEditor.getAttribute("Extenders")!=null&&cellEditor.getAttribute("Extenders").indexOf("MaskedEditExtender")!=-1)requireKeepFocus=true}}}}if(requireKeepFocus&&activeElement!=element.document.activeElement&&$$.utils.contains(getTopSpread(element),activeElement)){detachOnActiveEvents();activeElement.focus();attachOnActiveEvents()}if(xhtml){syncRowRangeSafeMode(r,r+rc-1,false,false);sizeSpread(true)}var autoCalc=element.getAttribute("autoCalc");if(autoCalc!="false")if(workArroundClipboard)spreadView.DelayUpdateValues=true;else updateValues();else saveData()}}function anyReadOnlyCell(b){if(b!=null){var f=parseInt(b.getAttribute("rowIndex")),d=parseInt(b.getAttribute("colIndex")),i=parseInt(b.getAttribute("rowcount")),h=parseInt(b.getAttribute("colcount")),g=null;if(element.getAttribute("layoutMode")&&b.getAttribute("col")!="-1"){var a=getFirstCellFromCol(b.getAttribute("col"));if(a)g=a.parentElement.getAttribute("row")}if(f<0){f=0;i=GetRowCountInternal()}if(d<0){d=0;h=GetColCount()}for(var c=f;c<f+i;c++){if(IsChildSpreadRow(getViewport(),c))continue;for(var a=null,e=d;e<d+h;e++)if(!isCovered(c,e,spanCells)){a=getCellFromRowCol(c,e,a);if(g!=null&&a!=null&&parseInt(a.parentElement.getAttribute("row"))!=g)continue;var j=getCellType(a);if(j=="readonly")return true}}}return false}function moveSlideBar(f){var d=getElementById(activePager,element.id+"_slideBar"),b=f.clientX-12,c=getOffsetLeft(activePager,element.document.body);b-=c;var a=spreadView.Pager.GetSlidePosition();if(b<a.Left)b=a.Left;if(b>a.Right)b=a.Right;var e=parseInt(activePager.getAttribute("totalPage"))-1,g=parseInt((b-a.Left)/(a.Right-a.Left)*e)+1;d.style.left=b+"px";return g}function getOffsetParent(c){var a=c;while(a!=null){var b=$$.j(a).css("position");if(b!="absolute"&&b!="relative"&&b!="fixed")a=a.offsetParent;else break}if(a==null)a=element.document.documentElement;return a}var scrollTop=0,scrollLeft=0;function setScrollTop(a){var b=getParent(getViewport());b.scrollTop=a}function setScrollLeft(a){var b=getParent(getViewport());b.scrollLeft=a}function isNeedScroll(o,p){var a=getScrollvp();if(a==null)a=getParent(getViewport());var d=a.getBoundingClientRect(),b=getViewportHolder(),c=spreadView.SelectionModel._GetFocusRange();if(c==null)return false;var n=c.left==-1&&c.top>-1,m=c.top==-1&&c.left>-1,i=c.left>-1&&c.top>-1,h=false;if(n||i){var q=b!=null?b.clientHeight+b.clientTop:a.clientHeight+a.clientTop,l=p,f=d.top+q,j=Math.max(a.scrollHeight,a.clientHeight)-a.clientHeight;if(l>=f&&a.scrollTop<j)h=true;if(b!=null&&getViewport1()!=null)f=d.top+getViewport1().offsetHeight+5;else f=d.top+5;if(l<f&&a.scrollTop>0)h=true}var g=false;if(m||i){var r=b!=null?b.clientWidth+b.clientLeft:a.clientWidth+a.clientLeft,e=d.left+r,k=o,j=Math.max(a.scrollWidth,a.clientWidth)-a.clientWidth;if(k>=e&&a.scrollLeft<j)g=true;if(b!=null&&getViewport2()!=null)e=d.left+getViewport2().offsetWidth+5;else e=d.left+5;if(k<e&&a.scrollLeft>0)g=true}return{Horizontal:g,Vertical:h}}function scrollByMovingForTouch(v,p,q,d,e){if(d==null)d=true;if(e==null)e=true;var a=getScrollvp(),h=getParent(getViewport());if(a==null)a=h;var f=a.getBoundingClientRect(),o={top:0,left:0},k=element.getAttribute("ClientAutoSize")!="True"||element.getSpreadView().IsVerticalRestricClientAutoSize();d=d&&k;e=e&&k;var b=getViewportHolder(),t=b!=null?b.clientHeight+b.clientTop:a.clientHeight+a.clientTop,n=o.top+q,j=f.top+t;if(n>=j){e&&setScrollTop(a.scrollTop+10);element.ignoreVirtualPaging=true;scrollView({target:h},null,function(){element.ignoreVirtualPaging=false})}else{if(b!=null&&getViewport1()!=null)j=f.top+getViewport1().offsetHeight+5;else j=f.top+5;if(n<j){var g=true,l=getSelection(),c=xmlData.lastChild(l);if(c!=null){var s=parseInt(c.getAttribute("rowcount")),r=parseInt(c.getAttribute("colcount"));g=(r>0||element.getAttribute("OperationMode")=="SingleSelect")&&getRowFromCell(anchorCell)>=frzRows;if(parseInt(c.getAttribute("row"))<0)g=false}if(g){if(e)if(a.scrollTop-10>=element.virtualTop)setScrollTop(a.scrollTop-10);else setScrollTop(element.virtualTop);element.ignoreVirtualPaging=true;scrollView({target:h},null,function(){element.ignoreVirtualPaging=false})}}}var m=o.left+p,u=b!=null?b.clientWidth+b.clientLeft:a.clientWidth+a.clientLeft,i=f.left+u;if(m>=i){d&&setScrollLeft(a.scrollLeft+10);element.ignoreVirtualPaging=true;scrollView({target:h},null,function(){element.ignoreVirtualPaging=false})}else{if(b!=null&&getViewport2()!=null)i=f.left+getViewport2().offsetWidth+5;else i=f.left+5;if(m<i){var g=true,l=getSelection(),c=xmlData.lastChild(l);if(c!=null){var s=parseInt(c.getAttribute("rowcount")),r=parseInt(c.getAttribute("colcount"));g=s>0&&(isChild(anchorCell,getViewport())||isChild(anchorCell,getViewport1()));if(parseInt(c.getAttribute("col"))<0)g=false}if(g){d&&setScrollLeft(a.scrollLeft-10);element.ignoreVirtualPaging=true;scrollView({target:h},null,function(){element.ignoreVirtualPaging=false})}}}}function scrollByMoving(o,p){var a=getScrollvp(),f=getParent(getViewport());if(a==null)a=f;var d=a.getBoundingClientRect(),v=element.document.body.getBoundingClientRect(),g=element.getAttribute("ClientAutoSize")!="True"||element.getSpreadView().IsVerticalRestricClientAutoSize(),c=getViewportHolder(),s=c!=null?c.offsetHeight-10:a.offsetHeight-10,n=p,i=d.top+s;if(n>i){g&&setScrollTop(a.scrollTop+10);element.ignoreVirtualPaging=true;scrollView({target:f},null,function(){element.ignoreVirtualPaging=false})}else{if(c!=null&&getViewport1()!=null)i=d.top+getViewport1().offsetHeight+5;else i=d.top+5;if(n<i){var e=true,k=getSelection(),b=xmlData.lastChild(k);if(b!=null){var t=parseInt(b.getAttribute("row")),q=parseInt(b.getAttribute("rowcount")),l=parseInt(b.getAttribute("colcount")),j=spreadView.GetLastMouseDownEvent();if(l==-1&&j&&spreadView.ColumnHeader.Contains(j.target))e=false;if(e)e=t!=-1&&q>0&&getRowFromCell(anchorCell)>=frzRows}if(e){if(g)if(a.scrollTop-10>=element.virtualTop)setScrollTop(a.scrollTop-10);else setScrollTop(element.virtualTop);element.ignoreVirtualPaging=true;scrollView({target:f},null,function(){element.ignoreVirtualPaging=false})}}}var m=o,u=c!=null?c.offsetWidth-10:a.offsetWidth-20,h=d.left+u;if(m>h){g&&setScrollLeft(a.scrollLeft+10);element.ignoreVirtualPaging=true;scrollView({target:f},null,function(){element.ignoreVirtualPaging=false})}else{if(c!=null&&getViewport2()!=null)h=d.left+getViewport2().offsetWidth+5;else h=d.left+5;if(m<h){var e=true,k=getSelection(),b=xmlData.lastChild(k);if(b!=null){var r=parseInt(b.getAttribute("col")),l=parseInt(b.getAttribute("colcount"));e=r!=-1&&l>0&&(isChild(anchorCell,getViewport())||isChild(anchorCell,getViewport1()))}if(e){g&&setScrollLeft(a.scrollLeft-10);element.ignoreVirtualPaging=true;scrollView({target:f},null,function(){element.ignoreVirtualPaging=false})}}}}function setFixBorderTopStyle(a,c){var b=$$.j(c);if(a.style.borderTopStyle=="")a.style.borderTopStyle=b.css("borderBottomStyle");if(a.style.borderTopColor==""||a.style.borderTopColor=="transparent")a.style.borderTopColor=b.css("borderBottomColor");if(a.style.borderTopWidth==""||parseInt(a.style.borderTopWidth)=="0")a.style.borderTopWidth=b.css("borderBottomWidth")}function getgrayAreaCursor(){if(grayareacursor)return grayareacursor;if(tableView!=null&&tableView.style.cursor!=null){if(tableView.style.cursor=="auto")tableView.style.cursor="default";return tableView.style.cursor}else return"default"}function getResizeCursor(a){return a?spreadView.IsMultiBrowserMode()?"n-resize":clientInformation.appVersion.indexOf("MSIE 6.0")!=-1?"row-resize":"n-resize":spreadView.IsMultiBrowserMode()?"w-resize":clientInformation.appVersion.indexOf("MSIE 6.0")!=-1?"col-resize":"w-resize"}function hitCommandBar(d){var c=getCommandBar(),b=window.event||d;if(b==null||c&&!$$.utils.contains(c,b.target||b.srcElement,true))return false;var a=b.target;while(a!=null&&a!=element){if(a==c)return true;a=a.parentElement}return false}function hitView(){var b=getViewport(),a=window.event.target;while(a!=null&&a!=this){if(a==b)return true;a=a.parentElement}return false}function openWaitMsg(){var h=element.document;if(!h.getElementById)h=window.document;var b=h.getElementById(element.id+"_waitmsgcontainer");if(b==null){var e=h.getElementById(element.id+"_waitmsg");e.style.display="block";var j=element.offsetWidth,i=element.offsetHeight,c=Math.max(10,(j-parseInt(e.offsetWidth))/2),d=Math.max(10,(i-parseInt(e.offsetHeight))/2);if($element.css("position")!="absolute"&&$element.css("position")!="relative"){c+=element.offsetLeft;d+=element.offsetTop;if(element.parentElement!=null){var f=0,g=0,a=element;while(a.parentElement!=null){if(a.nodeName=="TD"){f=a.offsetLeft;g=a.offsetTop}a=a.parentElement}c+=f;d+=g}}e.style.top=d+"px";e.style.left=c+"px"}else{b.style.display="block";var d=Math.max(10,(element.offsetHeight-parseInt(b.offsetHeight))/2),c=element.clientLeft+8;if($element.css("position")!="absolute"&&$element.css("position")!="relative"){c+=element.offsetLeft;d+=element.offsetTop;if(element.parentElement!=null){var f=0,g=0,a=element;while(a.parentElement!=null){if(a.nodeName=="TD"){f=a.offsetLeft;g=a.offsetTop}a=a.parentElement}c+=f;d+=g}}b.style.top=d+"px";b.style.left=c+"px";b.style.width=element.offsetWidth-element.clientLeft-8+"px"}}function closeWaitMsg(){var a=element.document;if(!a.getElementById)a=window.document;var b=a.getElementById(element.id+"_waitmsgcontainer");if(b==null){var c=a.getElementById(element.id+"_waitmsg");if(c!=null)c.style.display="none"}else b.style.display="none"}function checkRightButton(g){if(!element.inDesign)return true;if(g.button!=2)return true;var c=getCell(g.srcElement);if(!c){var i=getCorner();return i==null||!i.contains(g.srcElement)}var f=GetSelectedRanges();if(f!=null&&f.length>0){for(var b=false,h=0;h<f.length&&!b;h++){var a=f[h];if(a.row==-1&&a.col==-1)b=false;var d=getColFromCell(c),e=getRowFromCell(c);if(d==null||e==null)b=true;if(c.parentElement.getAttribute("FpSpread")=="ch")b=d>=a.col&&d<a.col+a.colCount&&a.row==-1;else if(c.parentElement.getAttribute("FpSpread")=="rh")b=e>=a.row&&e<a.row+a.rowCount&&a.col==-1;else b=(a.col==-1||d>=a.col&&d<a.col+a.colCount)&&(a.row==-1||e>=a.row&&e<a.row+a.rowCount)}return b}return false}function cmdBtnClickHandler(b){var a=(b||window.event).target;if($$.j(a).attr("disabled")=="disabled")return;a._clickHandler!=null&&endEditSpread()&&a._clickHandler.apply(a,arguments)}function element_onSelectStart(a){a.preventDefault&&a.preventDefault();return false}function onStartColumnMoving(e){var d=false,c=e.target,a=-1,b=getCell(c),f=b&&b.parentElement.getAttribute("FpSpread")=="ch";if(f&&(allowColMove||allowGroup)){a=spreadView.IsRowLayoutMode?parseInt(b.getAttribute("col")):getColFromCell(b);if(selectedCols==null||selectedCols.length==0||isColSelected(a)){initMovingCol(e,a);d=true}}else if(allowGroup&&spreadView.GroupBar.Contains(c)){a=parseInt(c.id.replace(element.id+"_group",""));if(!isNaN(a)){initMovingCol(e,a,true,c);element.dragFromGroupbar=true;d=true}}if(d){working=true;element.working=true;saveData();return true}return false}function onContinueColumnMoving(a){a.buttons=a.which=1;mouseMove(a)}function onStopColumnMoving(a){if(a){a.buttons=a.which=1;mouseUpInternal(a)}working=false;element.working=false;if(spreadView.OperationMode!=FarPoint.Web.Spread.OperationMode.Normal)selectedCols=[]}function onStartResizing(a,b,c){if(!initialized)return false;getTopSpread(element).resizing=true;working=true;element.working=true;if(b){activeX=activeY=c.clientY;sizeColumn=null;sizeRow=a}else{activeX=activeY=c.clientX;sizeColumn=a;sizeRow=null;spreadView.Parent!=null&&backupHeaderStyle()}showSizeBar(b);return true}function onContinueResizing(a){a.buttons=a.which=1;mouseMove(a)}function onStopResizing(a){if(a){var c=getTopSpread();spreadView.SuspendAction(c,GCWS.Actions.SWITCH_KEYBOARD);mouseUpInternal(a);spreadView.ResumeAction(c,GCWS.Actions.SWITCH_KEYBOARD);try{if(!containsNumericCellType(anchorCell,a.target))if((!editModePermanent||getEditor(anchorCell)!=null)&&!fpSpreadJS.isOutOfView(anchorCell)&&spreadView.NeedSetEditorFocusOnActiveCell()){var b=isEditModeReplace(anchorCell);fpSpreadJS.correctFocusOnActiveCell(anchorCell,null,null,b);b&&selectAllText(true)}}catch(d){}}getTopSpread(element).resizing=false;working=false;element.working=false}function onStopSelecting(b){fpSpreadJS.setImeMode(element,textBox,anchorCell);if(editModePermanent)doGetFocus();else if(b&&!containsNumericCellType(anchorCell,b.srcElement)&&!fpSpreadJS.isOutOfView(anchorCell)&&spreadView.NeedSetEditorFocusOnActiveCell()){var a=isEditModeReplace(anchorCell);fpSpreadJS.correctFocusOnActiveCell(anchorCell,null,null,a);a&&selectAllText(true)}spreadView.GetCommandBar().UpdateCopyCutPaste()}function mouseDown(a){isJustClickOnGrayArea=false;needCheckSelectText=false;if(!initialized)return;if(!a)a=window.event;if(!spreadView.IsMultiColumnComboBox){var x=getTopSpread(element),W={spread:element,event:a,cancel:false};FarPoint.Web.Spread.CallBacks.topic(x.id).topic("MouseDown").publish(W);if(W.cancel)return}spreadView.SetLastMouseDownEvent(a);spreadView.EventTracker.Clear();if(spreadView.__justFiltered)spreadView.__justFiltered=null;$element.off("mouseup",mouseUp);$element.on("mouseup",mouseUp);var m=spreadView.GetTopSpreadView(),e=spreadView.IsRightClick(a)&&m.ContextMenus!=null&&!element.inDesign;if(spreadView.IsRightClick(a)&&element.getAttribute("mcctCellType")!=null&&spreadView.GetHostSpread().getSpreadView&&spreadView.GetHostSpread().getSpreadView().ContextMenus!=null)return;e&&editModePermanent&&spreadView.ClearTimeoutTasks("ProcessEditMode");if(a.shiftKey&&!spreadView.IsControl(a.target)){$element.off("selectstart",element_onSelectStart);$element.on("selectstart",element_onSelectStart)}if(element.getAttribute("childViewsLoaded")!=null&&isExtenderPopupControl(a.target)){$$.utils.cancelBubble(a);return}spreadView.IsEnablejQueryTheme()&&spreadView.JQueryThemeSupporter.MouseDown(a);var bb=$$.utils.getDocActiveElement();if(e&&m.ContextMenus!=null&&m.IsFilterBarTextBox(bb)){setTextBoxFocus();if(!$$.utils.contains(element.document.body,a.target))return $$.utils.cancelBubble(a)}if(window.fpPostOn!=null){preventDefault(a);cancelBubble(a);return}element.__lostPoint=null;ignoreBlur=true;element.preventPopUp=false;element.working=false;isMouseMoving=false;mouseX=a.clientX;mouseY=a.clientY;var b=a.target,J=$$.utils.contains(getCommandBar(),b,true),p=element.document.FpActiveSpread;if(!e&&spreadView.Parent==null&&p!=null&&$$.utils.contains(element,p)&&(J||b==getParent(getViewport())))isJustClickOnGrayArea=true;if(J&&!$$.browser.webkit&&spreadView.RequireUpdateTextBoxLocation()){spreadView.UpdateTextBoxLocation($$.utils.getViewArea(getCommandBar()));var kb=spreadView.GetTopSpreadView();kb.Spread.ignoreUpdateTextBoxLocation=true}if(J&&spreadView.GetCommandBar().OnMouseDown(a))return;var Z=checkRightButton(a);if(a.target.parentNode!=null&&a.target.parentNode.getAttribute("name")==element.id+"_slideBar"){if(isChild(a.target,getPager1()))activePager=getPager1();else if(isChild(a.target,getPager2()))activePager=getPager2();if(activePager!=null){var s=true;if(editing)s=EndEdit();else if(m.IsFilterBarTextBox(bb)){var lb=m.IsReadyToFilter();setTextBoxFocus();if(lb)return}if(s){dragSlideBar=true;activePager.setCapture&&activePager.setCapture();window.parent!=window&&startHandlingDocumentMouse("mouseup")}}spreadView.HidePopup();return}dragCol=-1;dragViewCol=-1;if(!e&&Z&&a.button!=0&&!spreadView.IsInTouchMode())return;if(getViewport0()==null&&getViewport()==null)return;if(element.getAttribute("OperationMode")=="ReadOnly")return;if(getSpreadControl(a.target,true)!=element)return;var h=spreadView.GetEditingSpread(),mb=h!=null,v=h?h.getEditingInfo():null,d=v?v.Editor:null;if(mb&&!isHandleEvent(a)){var B=false;if(b!=d&&d!=null&&!isChild(b,d)){var gb=$$.utils.isTextControl(a.target)&&$$.utils.isTextControl(element.document.activeElement)&&$$.utils.contains(d,element.document.activeElement,true)&&IsInRowEditTemplate(a.target);if(typeof d.blur!="undefined"&&d.parentElement!=null&&!gb&&spreadView.NeedSetEditorFocusOnActiveCell())if(!spreadView.IsInTouchMode()&&($$.browser.ieversion==10||b.tagName!="SELECT"))d.blur();else B=true}var fb=getCell(b);if(fb!=anchorCell||fb==b||element!=h){var rb=ignoreEditorFocus;ignoreEditorFocus=true;var s=true;if(!spreadView.IsInTouchMode()||spreadView.Touch.lastPointerDownEvent!=null||spreadView.IsPopupOpened()){var Y=element.document.activeElement,q=(!$$.browser.ie||spreadView.IsInTouchMode()&&$$.utils.isTextControl(Y))&&$$.utils.contains(d,Y,true)?{SafeEditorRemove:true}:null;if(q)q.Event=a;else q={Event:a};if(h)s=h.EndEdit(q);else s=EndEdit(q);!editing&&$$.browser.ieversion>10&&q&&q.SafeEditorRemove&&element.document.activeElement==textBox&&h==element&&spreadView._IsGrayArea(a.target)&&setTextBoxFocusByResetSelection()}if(!s&&d){var F=$$.utils.isOverScrollbar(a);if(spreadView.NeedSetEditorFocusOnActiveCell()){if(!F||!spreadView._IsCellHidden(anchorCell)){var G=h.getSpreadContext(),E=h.getAnchorCell(),H=h.getSpreadView().Parent!=null;if(spreadView.IsInTouchMode()&&document.activeElement!=d&&editModePermanent)spreadView.RegisterTimeoutTask(function(){G.scrollToCell(E,{IgnoreSyncScrollByCell:true,visibleOnTop:H});d.focus()},200,"MouseDownRefocusEditor");else if(B&&spreadView.IsInTouchMode()&&$$.utils.isNativeControl(b)&&!$$.utils.contains(d,b,true))setTimeout(function(){b.focus();G.scrollToCell(E,{IgnoreSyncScrollByCell:true,visibleOnTop:H});d.focus()},0);else{G.scrollToCell(E,{IgnoreSyncScrollByCell:true,visibleOnTop:H});d.focus()}}else F&&!B&&document.activeElement!=d&&setTextBoxFocus();if(e)m._ignoreMenu=true}!F&&$$.utils.cancelDefault(a);return}else if(s&&B){if(element==h)d=editor;else{h=spreadView.GetEditingSpread();v=h?h.getEditingInfo():null;d=v?v.Editor:null}d&&d==document.activeElement&&d.blur()}ignoreEditorFocus=rb}else{if(e)m._ignoreMenu=true;IsInRowEditTemplate(b)&&spreadView.GetCommandBar().EnableDataButtons(true);return}}else if(endEditSpread($$.browser.ie?null:{Event:a})){if(spreadView.IsInTouchMode()&&editModePermanent&&spreadView.Touch.lastPointerDownEvent==null&&!spreadView.IsPopupOpened()){var tb=spreadView.GetActiveSpreadView(false,true)||spreadView;spreadView.ProcessEditModePermanent(200);$$.utils.cancelDefault(a);return}}else{if(e)m._ignoreMenu=true;$$.utils.cancelDefault(a);return}if(!spreadView.OnSpreadMouseDown(a))return;if(!isChild(b,element)){$$.utils.cancelDefault(a);return}if(!e&&!spreadView.IsInTouchMode()){sizeColumn=getSizeColumn(b,a);if(sizeColumn==null)sizeRow=getSizeRow(b,a)}else sizeColumn=sizeRow=null;var n=$$.utils.isTouchEvent(a),T=false;if(p==null||sizeColumn==null&&sizeRow==null||n){setActiveSpread(a);T=element.document.FpActiveSpread==element&&p!=element}var hb=element.document.FpActiveSpread==null||element.document.FpActiveSpread!=element,g=b,ub=FpSpreadJS.getTableRow(g);if(sizeColumn==null&&sizeRow==null&&(g==getDummy()||spreadView._IsGrayArea(g,null,true))){getTopSpread(element.document.FpActiveSpread)!=element&&setActiveSpread(a);var P=getScrollvp()||getViewport().parentNode,L=$$.utils.isOverScrollbar(a,P);!spreadView.IsInTouchMode()&&anchorCell!=null&&element.getAttribute("EditModePermanent")=="true"&&!L&&spreadView.IsSpreadActive()&&scrollToCell(anchorCell);L&&$$.utils.isOverScrollbar(a,P,true)&&$$.utils.cancelDefault(a);return}p!=null&&p!=element.document.FpActiveSpread&&(!spreadView.IsMultiColumnComboBox||p!=spreadView.GetHostSpread())&&p.getSpreadView().GetSpreadContext().hideSelectionBlock();if(element.document.FpActiveSpread!=element&&sizeColumn==null&&sizeRow==null)return;if(!e&&Z&&a.button!=0&&!spreadView.IsInTouchMode())return;if(working)return;if(spreadView.GroupBar!=null&&spreadView.GroupBar.Contains(b))if(!e){var K=parseInt(b.id.replace(element.id+"_group",""));if(!isNaN(K)){if(!n)initMovingCol(a,K,true,b);else dragCol=K;working=true;preventDefault(a);cancelBubble(a);window.parent!=window&&startHandlingDocumentMouse("mouseup");element.dragFromGroupbar=true;return}}else return;if(sizeColumn!=null){m.InvalidateLayout();a.preventDefault();getTopSpread(element).resizing=true;working=true;activeX=activeY=a.clientX;if(sizeColumn.style!=null)sizeColumn.style.cursor=getResizeCursor(false);g=b;if($$.browser.ie&&!$$.utils.isNativeControl(g)){g.setCapture();element.captureElement=g}window.parent!=window&&startHandlingDocumentMouse("mouseup");showSizeBar(false);if(spreadView.Parent!=null&&getColHeader()){getColHeader().parentNode.style.position="absolute";spreadView.Parent!=null&&backupHeaderStyle()}}else if(sizeRow!=null){m.InvalidateLayout();a.preventDefault();getTopSpread(element).resizing=true;working=true;activeX=activeY=a.clientY;g=b;if($$.browser.ie&&!$$.utils.isNativeControl(g)){g.setCapture();element.captureElement=g}window.parent!=window&&startHandlingDocumentMouse("mouseup");element.working=true;spreadView.Parent!=null&&spreadView.StartAutoExpandMode();showSizeBar(true)}else{var c=getCell(b);if(c==null){var X=getCorner();if(X!=null&&X.contains(b)){var t=$$(b).getParent("TR");while(t!=null&&t.getAttribute("FpSpread")==null)t=$$(t).getParent("TR");if(t==null||t.getAttribute("FpSpread")!="fb")if(operationMode=="Normal"){anchorCell==null&&focus(a);if(anchorCell!=null)saveAnchorCell(anchorCell);else{setActiveRow(-1);setActiveCol(-1)}oldAnchorCell=anchorCell;selectTable(true);if(anchorCell){leadingCellRow=getRowFromCell(anchorCell);leadingCellCol=getColFromCell(anchorCell)}}else ClearSelection(null,element,false);doGetFocus()}return}var U=!e||!retainSelectionBlock&&T||!spreadView.InSelection(c),k=getColFromCell(c);if(c.parentElement.getAttribute("FpSpread")=="ch"&&(k>=GetColCount()||c.getAttribute("col")=="-1")){doGetFocus();return}if(c.parentNode.getAttribute("FpSpread")=="rh"&&FpSpreadJS.isChildSpreadRow(getViewport(),c.parentNode.rowIndex)){ClearSelection(null,element,false);return}var nb=c.getAttribute("canFocus")=="false";if(nb)return;if(c.parentElement.getAttribute("FpSpread")=="ch"&&element.getAttribute("OperationMode")!="Normal"){ClearSelection(null,element,false);if(!e&&(allowColMove||allowGroup)){if(element.getAttribute("layoutMode"))k=parseInt(c.getAttribute("col"));!n&&initMovingCol(a,k)}working=true;g=b;return}if(c.parentElement.getAttribute("FpSpread")=="ch"&&(element.getAttribute("OperationMode")=="RowMode"||element.getAttribute("OperationMode")=="SingleSelect"||element.getAttribute("OperationMode")=="ExtendedSelect")){if(!allowColMove&&!allowGroup)return}else if(U){var ob=fireActiveCellChangingEvent(getRowFromCell(c),k,element,c.parentElement.getAttribute("row"));if(ob)return;var x=getTopSpread(element);if(x!=element)if(x.fireActiveCellChangingEvent(getRowFromCell(c),k,element,c.parentElement.getAttribute("row")))return;var i=element.getAttribute("OperationMode"),C=!isChild(c,getFrozRowHeader())&&!isChild(c,getRowHeader())||(selectionBlockOptions&SelectionBlockOptions.Rows)!=0&&operationMode!="ReadOnly";C=C&&(!isChild(c,getFrozColHeader())&&!isChild(c,getColHeader())||(selectionBlockOptions&SelectionBlockOptions.Columns)!=0&&operationMode=="Normal");if((!a.ctrlKey||n)&&!(spreadView.IsInTouchMode()&&element.TapToAddSelection)||element.getAttribute("multiRange")!="true"||e){if(i!="MultiSelect"&&!(a.shiftKey&&i=="ExtendedSelect"&&element.getAttribute("layoutMode")==null)||e)if(!((allowColMove||allowGroup)&&c.parentElement.getAttribute("FpSpread")=="ch"&&i=="Normal"&&(element.getAttribute("SelectionPolicy")=="Range"||element.getAttribute("SelectionPolicy")=="MultiRange")&&selectedCols.length!=0&&isColSelected(k)))if(C){var Q=getSelection();spreadView.__previousSelectionNode=Q?xmlData.lastChild(Q):null;ClearSelection(false,null,false)}else return}else if(C||!spreadView.IsInTouchMode()){if(i!="ExtendedSelect"&&i!="MultiSelect")if(anchorCell!=null&&(!spreadView.IsInTouchMode()||GetActiveChart()==null&&!spreadView.Touch.isOnTheFlyCreatedSelection)){fpSpreadJS.updateSelectionRangeFromCell(anchorCell);fpSpreadJS.keepGeneratedSelectionFromAnchorCell();paintSelectedCell(anchorCell,true);updateSelectionsBackColor(getRowFromCell(c),getColFromCell(c))}}else return}if(n&&element.TapToAddSelection&&spreadView.Touch.isOnTheFlyCreatedSelection){spreadView.SetAnchorCell(null);ClearSelection(true,null,false);spreadView.Touch.isOnTheFlyCreatedSelection=false}var y=getXmlActiveRow(),M=getXmlActiveCol(),w=anchorCell;if(U){if(n){var ab=GetActiveChartObj(element);ab!=null&&!$$.utils.contains(ab.container,a.target)&&inactiveAllChart(element)}setAnchorCell(c);if(w)oldAnchorCell=w;if(spreadView.IsInTouchMode()&&$$.utils.isNativeControl(a.target))if(!spreadView.NeedSetEditorFocusOnActiveCell())scrollToCell(anchorCell);else{var D=spreadView._GetTimeoutTask("ShowHideContainer");D!=null&&spreadView.UnregisterTimeoutTask(D.Type);spreadView.RegisterTimeoutTask(function(){var a=element.getAnchorCell();scrollToCell(a);if(D!=null)if(getCellType(a)=="MultiColumnComboBoxCellType"||element.document.activeElement!=null&&element.document.activeElement.getAttribute("mccbparttype")=="DropDownButton"){var b=getEditor($$.utils.GetCell(element.document.activeElement)||a);(b||a&&a.getAttribute("RowEditTemplate")=="true")&&D.ReRegister()}},200,"DelayScrollToCell")}else scrollToCell(anchorCell);var i=operationMode,l=c.parentElement.getAttribute("FpSpread"),ib=l=="rh",N=l=="ch";if(l=="r"||l=="ch"||l=="rh"){saveAnchorCell(c);if(l=="ch")leadingCellRow=0;else if(l=="rh")leadingCellCol=0}if(anchorCell.parentElement.getAttribute("FpSpread")=="r"){var r=getRowFromCell(anchorCell),u=spreadView.IsInTouchMode(),jb=u?spreadView.GetTopSpreadView().Spread.GetActiveChartObj():null;if(a.shiftKey&&i=="ExtendedSelect"&&element.getAttribute("layoutMode")==null&&!e){var o=getExtendedSelectRows(w,leadingCell,anchorCell);ClearSelection(false,null,false);o!=null&&o.length>0&&selectRow(o[0],o[1],true,true)}else if(i=="ExtendedSelect"||i=="MultiSelect")if(isRowSelected(r))selectRow(r,1,false,true);else selectRow(r,1,true,true);else if(i=="RowMode"||i=="SingleSelect")selectRow(r,1,true,true);else{var f=getEditor(anchorCell),z=f!=null&&f.getAttribute("extenders")=="NumericUpDownExtender";z=z||isEditModeReplace(anchorCell)&&f!=null&&$$.utils.isTextControl(b)&&b==f&&$$.utils.getDocActiveElement()==f&&!spreadView.IsInTouchMode();z|=spreadView.IsInTouchMode()&&!$$.browser.ie&&$$.utils.isNativeControl(b)&&!$$.utils.isDisabledControl(b);selectRange(r,k,1,1,true,z,$$.browser.ieversion==11&&spreadView.IsInTouchMode()&&$$.utils.isTextControl(b))}u&&jb!=null&&spreadView.GetTopSpreadView().Spread.GetActiveChartObj()==null&&paintSelections(true,true);if(spreadView.__previousSelectionNode)spreadView.__previousSelectionNode=null;selectStartRow=r;selectStartCol=k}else if(anchorCell.parentElement.getAttribute("FpSpread")=="ch")if(!e&&(allowColMove||allowGroup)){var j=k;if(i=="Normal"&&(element.getAttribute("SelectionPolicy")=="Range"||element.getAttribute("SelectionPolicy")=="MultiRange"))if(isColSelected(j)){var u=spreadView.IsInTouchMode(),R=null;if(u)R=spreadView.SwapSelectedRange(-1,j,-1,1);if(!u)adjustAnchorCell(j);else{var sb=parseInt(c.parentNode.getAttribute("row")),S=GetSelectedRange();spreadView.__matchingAnchorCell=oldAnchorCell;!findColumnActiveCell(j,S.colCount-(j-S.col),sb,true)&&u&&spreadView.ShowFocusRectangle();spreadView.__matchingAnchorCell=null;if(R==null){var pb=GetSelectedRange();if(y!=-1&&M!=-1&&I!=getXmlActiveCol()){var y=getRowByKey(y),I=getColByKey(M);pb.IsIntersectWith(y,I,1,1)&&paintSelection(y,I,1,1,true)}}}paintAnchorCell();!n&&initMovingCol(a,j)}else selectColumn(j,1,true);else{if(element.getAttribute("layoutMode"))j=parseInt(anchorCell.getAttribute("col"));if(operationMode=="Normal"||operationMode=="ReadOnly")selectColumn(j,1,true);else selectedCols.push(j);!n&&initMovingCol(a,j)}}else if(operationMode=="Normal"){var j=k;if(element.getAttribute("layoutMode"))j=parseInt(anchorCell.getAttribute("col"));selectColumn(j,1,true)}else return;else if(anchorCell.parentElement.getAttribute("FpSpread")=="rh"){var A=getRowFromCell(anchorCell);if(a.shiftKey&&i=="ExtendedSelect"&&element.getAttribute("layoutMode")==null&&!e){var o=getExtendedSelectRows(w,leadingCell,anchorCell);ClearSelection(false,null,false);o!=null&&o.length>0&&selectRow(o[0],o[1],true,true)}else if(i=="ExtendedSelect"||i=="MultiSelect")if(isRowSelected(A))selectRow(A,1,false,true);else selectRow(A,1,true,true);else selectRow(A,1,true)}if((hb||anchorCell!=w)&&anchorCell!=null){var db=GetSheetIndex(getRowFromCell(anchorCell)),cb=k,eb=parseInt(anchorCell.parentElement.getAttribute("row"));if($$.utils.isSelectControl(b,true))ignorePostbackEditmode=true;fireActiveCellChangedEvent(db,cb,element,eb);var x=getTopSpread(element);x!=element&&x.fireActiveCellChangedEvent(db,cb,element,eb);if($$.utils.isSelectControl(b,true))ignorePostbackEditmode=false}if(isChild(anchorCell,element)){leadingCell=anchorCell;if(leadingCell!=null){l=leadingCell.parentElement.getAttribute("FpSpread");if(l=="rh"||l=="r")leadingCellRow=getRowFromCell(leadingCell);if(leadingCell==c)leadingCellCol=k;else if(l=="ch"||l=="r")leadingCellCol=getColFromCell(leadingCell);if(ib&&getCellFromRowCol(selectStartRow,leadingCellCol)==leadingCell)leadingCellRow=selectStartRow;if(N&&getCellFromRowCol(leadingCellRow,selectStartCol)==leadingCell)leadingCellCol=selectStartCol}}spreadView.IsInTouchMode()&&spreadView.Touch.UpdateResizeLocation()}g=b;working=!spreadView.IsInTouchMode()&&!spreadView.IsControl(g)}spreadView.GetCommandBar().UpdateCopyCutPaste();if(engine>=9){element.ignoreVirtualPaging=true;scrollView(null,null,function(){element.ignoreVirtualPaging=false})}if(!editing&&sizeRow==null&&sizeColumn==null){if(anchorCell!=null&&anchorCell.getAttribute("RowEditTemplate")!="true"&&isChild(anchorCell,element)&&!isHeaderCell(getCell(b)))if(!e||spreadView.IsControl(b)){var f=getEditor(anchorCell);if(f!=null){if(b==anchorCell)element.preventPopUp=true;editingValue=getEditorValue(f,q);var O=false,qb=f.getAttribute("extenders");if(spreadView.NeedSetEditorFocusOnActiveCell()||$$.utils.contains(f,b,true)){editing=f.type!="button"&&f.type!="submit";if(qb!="NumericUpDownExtender"||b!=f&&!isChild(b,f)){setEditorFocus(f,null,null,null,{Event:a,useTimeout:$$.browser.chrome});O=true}}editor=f;renderAsEditor=1;if($$.browser.webkit&&$$.utils.isTextControl(element.document.activeElement)){if($$.utils.contains(editor,element.document.activeElement,true)){var V=$$.j(element.document.activeElement);V.off("compositionstart",onTextEditorCompositionStart);V.on("compositionstart",onTextEditorCompositionStart)}editor.type=="text"&&FarPoint.Web.Spread.SafariPatch.FixTextBox(editor)}(!$$.utils.contains(f,b,true)||O&&$$.utils.contains(f,window.document.activeElement,true)&&b!=window.document.activeElement)&&$$.utils.cancelBubble(a)}}!e&&(b.tagName=="IMG"&&(N||getCellType2(anchorCell)=="ImageCellType")||!editing&&a.ctrlKey&&!$$.utils.isNativeControl(b))&&a.preventDefault();if(!editing&&enableRowEditTemplate=="true"&&operationMode=="RowMode"&&element.getAttribute("layoutMode")==null){editing=IsInRowEditTemplate(a.target);editing&&spreadView.GetCommandBar().EnableButton("Update",true)}}else if(editing&&editor!=null&&a!=null&&a.target!=editor&&!isChild(a.target,editor))$$.utils.cancelBubble(a);else(sizeRow||sizeColumn)&&anchorCell&&anchorCell.getAttribute("RowEditTemplate")=="true"&&window.document.activeElement!=textBox&&$$.utils.contains(anchorCell,window.document.activeElement)&&setTextBoxFocus();spreadView.IsInTouchMode()&&spreadView.Touch.UpdateResizeLocation()}function mouseMove(a){if(!a)a=window.event;if(!initialized)return;if(!isMouseMoving&&mouseX==a.clientX&&mouseY==a.clientY){working&&$$.browser.chrome&&preventDefault(a);return}isMouseMoving=true;activeElement=a.target;if(window.fpPostOn!=null)return;if((a.buttons==0||!$$.utils.isTouchEvent(a)&&a.which==0)&&(working||dragCol!=null&&dragCol!=-1)){working=false;dragCol=-1;spreadView.__startDragScrollLeft=-1;$$.utils.detachEvent(element,"selectstart",element_onSelectStart);if(element.captureElement!=null){element.document.releaseCapture();element.captureElement=null}return}if(dragSlideBar){if((a.button==0&&a.buttons==null||a.buttons==1)&&activePager!=null){var gb=moveSlideBar(a),r=getElementById(activePager,element.id+"_posIndicator");r.innerHTML=activePager.getAttribute("pageText")+gb}return}if(!working&&hitCommandBar())return;if(element.getAttribute("OperationMode")=="ReadOnly")return;working&=(!a.buttons||a.buttons==1)&&!$$.utils.isRightClick(a);if(!working&&!editing)if(sizeColumn==null&&sizeRow==null&&element.document.FpActiveSpread==element&&!spreadView.IsFilterBarTextBox(a.target)&&element.captureElement!=null){element.document.releaseCapture();element.captureElement=null}if(working&&window.parent!=window)if(a.target.ownerDocument!=element.ownerDocument)return;else element.__lostPoint={clientX:a.clientX,clientY:a.clientY};if($$.browser.chrome){var H=getScrollvp()||getViewport().parentNode;if($$.utils.isOverScrollbar(a,H))H.style.cursor="default";else H.style.cursor=grayareacursor}if(working){if(sizeRow==null&&sizeColumn==null&&!$$.utils.isTextControl(element.document.activeElement))if(window.getSelection)try{window.getSelection().removeAllRanges()}catch(kb){}else n.selection.empty();preventDefault(a);if(dragCol>=0){var i=getMovingCol();if(i!=null){var r=getPosIndicator();if(i.style.display=="none")i.style.display="";var l=-3;if(!xhtml)l+=parseInt(element.style.borderWidth);var n=element.document;if(!n.getElementById)n=window.document;var k=a.clientX;i.style.top=a.clientY-getOffsetTop(i.offsetParent,n.body,false)+getScrollTop(i.offsetParent)-l+"px";i.style.left=a.clientX-getOffsetLeft(i.offsetParent,n.body,false)+getScrollLeft(i.offsetParent)-l+"px";var jb=getViewport(),ib=element.document.body,B=getGroupBar(),b=-1,N=element.getBoundingClientRect(),f=N.left,C=N.top;k=a.clientX;if(spreadView.GroupBar!=null&&spreadView.GroupBar.IsInside(a.target,a.clientX,a.clientY)){for(var e=0;e<B.children.length;e++){var I=B.children[e].offsetWidth;if(I==null)continue;if(f<=k&&k<f+I){b=e;break}f+=I}if(b==-1&&k>=f)b=-2;element.targetCol=b}else{var G=spreadView.CellSpacing,J=fpSpreadJS.getNumOfHiddenColumn(hiddenColumns);if(getRowHeader()!=null)f+=getRowHeader().parentNode.offsetWidth;if(B!=null)C+=B.offsetHeight;if(k<f)b=0;else{var d=selectedCols.context;if(d){var z=0;if(getColHeader()!=null)z=getColHeader().parentNode.scrollLeft;for(var e=0;e<d.length;e++){var E=!d[e].frozen?d[e].left-z:d[e].left;if(E+f<=k&&k<E+f+d[e].width+G){b=e;break}if(e==d.length-1&&b==-1&&k>=E+f+d[e].width+G)b=d.length+J}if(isColSelected(b))while(isColSelected(b)&&isColSelected(b-1))b--;else if(isColSelected(b-1))b++;if(b<0)b=0;if(b<d.length)f+=!d[b].frozen?d[b].left-z:d[b].left;else{var D=d.length-1;f+=(!d[D].frozen?d[D].left-z:d[D].left)+d[D].width+G}}}var y=parseInt(GetSheetColIndex(b));if(y<0)if(selectedCols.context)if(b<selectedCols.context.length){var R=selectedCols.context[b].colKey;y=R?R:b}else y=d.length+J;element.targetCol=y}var T=n.getElementById(element.id+"_titleBar");if(T)C+=T.parentNode.parentNode.offsetHeight;if(getPager1()!=null)C+=getPager1().offsetHeight;r.offsetParent!=null&&$$(r).moveToPosition(Math.floor(f)-5,Math.floor(C)+1);if(spreadView.GroupBar!=null&&spreadView.GroupBar.IsInside(a.target,a.clientX,a.clientY)&&spreadView.GroupBar.IsEmptyGroupedRow())r.style.display="none";else if(allowColMove||spreadView.GroupBar.IsInside(a.target,a.clientX,a.clientY)&&allowGroup)r.style.display="";else r.style.display="none"}var j=getScrollvp();if(j==null)j=getParent(getViewport());if(j!=null){var o=getOffsetLeft(j.offsetParent,element.document.body)-getScrollLeft(element),s=0;if(getViewportHolder()!=null){o+=getViewportHolder().offsetLeft;s=o+getViewportHolder().offsetWidth-10}else{o+=j.offsetLeft;s=o+j.offsetWidth-20}if(a.clientX>s){var Z=spreadView.Viewport.parentNode.scrollWidth-spreadView.Viewport.parentNode.clientWidth;spreadView.__startDragScrollLeft=!$$.browser.webkit?j.scrollLeft+10:Math.min(Z,spreadView.__startDragScrollLeft+10);setScrollLeft(spreadView.__startDragScrollLeft);UpdatePostbackData()}else{if(getViewportHolder()!=null&&getViewport2()!=null)s=o+getViewport2().offsetWidth+5;else s=o+5;if(a.clientX<s){spreadView.__startDragScrollLeft=!$$.browser.webkit?j.scrollLeft-10:Math.max(0,spreadView.__startDragScrollLeft-10);setScrollLeft(spreadView.__startDragScrollLeft);UpdatePostbackData()}}}a.target.tagName=="IMG"&&$$.utils.cancelDefault(a);return}if(sizeColumn==null&&sizeRow==null){if(anchorCell!=null){scrollByMoving(a.clientX,a.clientY);var c=getCell(a.target);if(c==null&&a.target!=null){c=spreadView.GetCellFromPoint(a.clientX,a.clientY,true);if(spreadView.ColumnFooter.Contains(c)||!$$.utils.contains(element,c))c=null}var fb=getSpreadControl(c);if(fb!=element)return;if(c!=null&&c!=leadingCell){var m=element.getAttribute("OperationMode");if(m!="MultiSelect"){if(!inColHeader(c)&&(m=="SingleSelect"||m=="RowMode")){var w=getRowFromCell(c),g;if(inRowHeader(c)){if(anchorCell!=null)if(inRowHeader(anchorCell))g=-1;else g=getColFromCell(anchorCell);else g=-1;if(g==-1){var eb=fpSpreadJS.getNextColumn(w,0,false,true,true);if(eb==-1)g=getColFromCell(c)}}else g=getColFromCell(c);var bb=fireActiveCellChangingEvent(w,g,element);if(bb)return;oldAnchorCell=anchorCell;ClearSelection(false,null,false);updateAnchorCell(w,g,false);selectRow(w,1,true,true,null,false);if(getCellFromRowCol(selectStartRow,g)==anchorCell)leadingCellRow=selectStartRow;fireActiveCellChangedEvent(w,g,element)}else if(!(inColHeader(c)&&m=="ExtendedSelect")&&m!="SingleSelect"&&m!="RowMode"&&!(m=="Normal"&&element.getAttribute("SelectionPolicy")=="Single")&&!element.getAttribute("layoutMode")){select(anchorCell,c,{AddSelection:false});syncColSelection()}leadingCell=c}}}}else if(sizeColumn!=null){var t=a.clientX-activeX,U=parseInt(sizeColumn.width)+t,W=0,S=U>W;if(S){var P=getSizeHeader();if(P||frzRows>0||frzCols>0){var l=0;if(!xhtml)l+=parseInt(element.style.borderWidth);sizeBar.style.cursor=getResizeCursor(false);var Y=spreadView.ColumnHeader.IsVisible()?(frozColHeader||colHeader).getBoundingClientRect().top:(getViewportHolder()||getViewport().parentNode).getBoundingClientRect().top;$$(sizeBar).moveToPosition(a.clientX-l,Y)}else{if(spreadView.Parent!=null){var v=getColHeader();if(v!=null&&v.style.width!=""&&v.style.width!="100%")v.parentNode.style.width=v.offsetWidth+t+"px"}spreadView.ColumnHeader.SetColumnWidth(parseInt(sizeColumn.getAttribute("index")),U);activeX=a.clientX;var Q=getCorner();if(Q&&Q.getAttribute("allowTableCorner")!=null){var p;if(spreadView.HasFilterBar()){p=[getFrozColHeader(),getColHeader()];getCorner()!=null&&getCorner().getAttribute("allowTableCorner")!=null&&p.push(getCorner());$$.utils.cleanArray(p);cleanElementsStyle(p,["height"])}syncRowRange(-1,-1,true,false);p!=null&&restoreElementsStyle(p,["height"])}}}!$$.browser.ie&&spreadView.ChangeCursor(activeElement,getResizeCursor(false))}else if(sizeRow!=null){ignoreSynRowHeight=true;var t=a.clientY-activeY,c=getFirstNonSpanCell(sizeRow),cb=c?c.offsetHeight+t:sizeRow.offsetHeight+t,W=0,S=W<cb;if(S){var P=getSizeHeader();if(P||frzRows>0||frzCols>0){var l=0;if(!xhtml)l+=parseInt(element.style.borderWidth);$$(sizeBar).moveToPosition(element.getBoundingClientRect().left,a.clientY-l)}else{sizeRow.style.height=Math.max(10,getOffsetHeight(sizeRow)+t)+"px";if(spreadView.Parent!=null){var db=getRowHeader().parentNode;db.style.height=getRowHeader().offsetHeight-spreadView.CellSpacing+"px"}if(c)c.style.height="";activeY=a.clientY}}!$$.browser.ie&&spreadView.ChangeCursor(activeElement,getResizeCursor(true))}}else{if(activeElement==null||getSpreadControl(activeElement)!=element)return;var L=null,h=getCell(activeElement,false),O=false;if(activeElement!=null)L=activeElement.style.cursor;sizeColumn=null;sizeRow=null;var A=getSizeColumn(a.target,a);if(A!=null){sizeColumn=A;spreadView.RestoreCursor();spreadView.ChangeCursor(activeElement,getResizeCursor(false))}else{var A=getSizeRow(a.target,a);if(A!=null){O=true;sizeRow=A;if(activeElement!=null&&activeElement.style!=null){spreadView.RestoreCursor();spreadView.ChangeCursor(activeElement,getResizeCursor(true))}}else if(activeElement!=null&&activeElement.style!=null&&activeElement.tagName!="BR"){var c=getCell(activeElement);if(c!=null&&isHeaderCell(c))if(activeElement.getAttribute("FpSpread")=="rowpadding"||activeElement.getAttribute("ControlType")=="chgrayarea")activeElement.style.cursor=getgrayAreaCursor();else spreadView.RestoreCursor();else if(activeElement!=null&&activeElement.style!=null&&(activeElement.getAttribute("FpSpread")=="rowpadding"||activeElement.getAttribute("ControlType")=="chgrayarea"))activeElement.style.cursor=getgrayAreaCursor();else spreadView.RestoreCursor()}}var M=activeElement.style.cursor!=L;if(activeElement.FpSpread=="rowpadding"){h=activeElement;M=true}if($$.browser.quirksMode&&h!=null&&M){var q=null,V=getFrozRowHeader(),X=getRowHeader();if(isChild(h,V))q=V;else if(isChild(h,X))q=X;if(q!=null&&parseInt(q.cellSpacing)==0)if(!O){for(var hb=false,K=h.parentNode.rowIndex,e=K-1;e>=0;e--)for(var u=q.rows[e],x=0;x<u.cells.length;x++)if(u.cells[x].rowSpan>1&&u.rowIndex+u.cells[x].rowSpan==K)return setFixBorderTopStyle(h,u.cells[x])}else if(h.rowSpan>1&&h.parentNode.cells.length==1){var F=q.rows[sizeRow.rowIndex+1];if(F!=null&&F.cells.length>0){var ab=F.cells[0];setFixBorderTopStyle(ab,h)}}}}}function clearMouseCachedVariables(){spreadView._ignoreMenu=false;spreadView.SetLastMouseDownEvent(null);spreadView.GetTopSpreadView().Spread.ignoreUpdateTextBoxLocation=false;isJustClickOnGrayArea=false;needCheckSelectText=false}function documentMouseUp(){setTimeout(function(){if(!$$.utils.contains(window.document.body,element))return;for(var b=getAllSpreads(),a=0;a<b.length;a++){var c=b[a].getSpreadView?b[a].getSpreadView().GetSpreadContext():null;if(c){c.clearMouseCachedVariables();c.stopHandlingDocumentMouse();b[a].getSpreadView().EventTracker.Clear()}}},0)}function mouseUp(a){if(!initialized||a.target==(getScrollvp()||getViewport().parentNode)&&$$.utils.isOverScrollbar(spreadView.GetLastMouseDownEvent()))return;if(!spreadView.IsMultiColumnComboBox){var m=getTopSpread(element),h={spread:element,event:a,cancel:false};FarPoint.Web.Spread.CallBacks.topic(m.id).topic("MouseUp").publish(h);if(h.cancel)return}spreadView.IsEnablejQueryTheme()&&spreadView.JQueryThemeSupporter.MouseUp(a);var k=requiresHandleDocumentMouse();stopHandlingDocumentMouse();$element.off("mouseup",mouseUp);var b=element.document;if(b.PreviousActiveSpread!=null&&b.PreviousActiveSpread!=b.FpActiveSpread){b.PreviousActiveSpread.getSpreadView().OnSpreadLostActive();b.PreviousActiveSpread=null}if(document.FpActiveSpread==null||element.getAttribute("mcctCellType")==null&&getTopSpread(document.FpActiveSpread)!=getTopSpread(element))return;if(!a)a=window.event;$$.utils.detachEvent(element,"selectstart",element_onSelectStart);var e=spreadView!=null&&spreadView.IsRightClick(a);if(spreadView!=null&&!spreadView.OnSpreadMouseUp(a))return;if(e&&element.getAttribute("mcctCellType")!=null&&spreadView.GetHostSpread().getSpreadView&&spreadView.GetHostSpread().getSpreadView().ContextMenus!=null)return;var g=working&&(sizeColumn!=null||sizeRow!=null)&&spreadView.IsFilterBarTextBox($$.utils.getDocActiveElement());g&&spreadView.SuspendSpreadFocus();var i=needCheckSelectText;mouseUpInternal(a);var l=$$.utils.getDocActiveElement();if(spreadView.NeedSetEditorFocusOnActiveCell()){var j=editing&&editor&&l==window.document.body||spreadView.GetCommandBar().Contains(a.target);try{if(!containsNumericCellType(anchorCell,a.target))if((!editModePermanent&&!fpSpreadJS.isOutOfView(anchorCell)||j&&!spreadView._IsCellHidden(anchorCell,false))&&!e){var f=!spreadView.IsInTouchMode()||!GrapeCity.Web.DatePicker.IsShowing()||!$$.utils.contains(element,GrapeCity.Web.DatePicker.GetInstance().Anchor||GrapeCity.Web.DatePicker.GetInstance().Target);f&=editing||!element.valid||!$$.utils.isNativeControl(a.target)||!$$.utils.isNativeControl(spreadView.GetLastMouseDownEvent())||a.target.disabled;f&&fpSpreadJS.correctFocusOnActiveCell(anchorCell,$$.browser.ie&&spreadView.IsInTouchMode())}}catch(n){}}g&&spreadView.ResumeSpreadFocus();!editing&&document.activeElement==textBox&&($$.browser.ieversion>10||spreadView.IsInTouchMode()&&spreadView._IsGrayArea(a.target))&&setTextBoxFocusByResetSelection();i&&!e&&$$.utils.cancelDefault(a);if(spreadView.Parent!=null&&k){var d=element.getBoundingClientRect();if(a.clientX<d.left||a.clientX>d.right||a.clientY<d.top||a.clientY>d.bottom){var c=getParentSpread();while(c){c.getSpreadView().GetSpreadContext().startHandlingDocumentMouse("mouseup",true);c=c.getParentSpread()}}}!$$.browser.ie&&spreadView.RestoreCursor(true)}function mouseUpInternal(a){var W=spreadView.GetTopSpreadView(),jb=spreadView.IsRightClick(a)&&W.ContextMenus!=null&&!element.inDesign;if(window.fpPostOn!=null||isExtenderPopupControl(a.target)){preventDefault(a);cancelBubble(a);return}anchorCell!=null&&!anchorCell.anchorSelected&&containsNumericCellType(anchorCell,(spreadView.GetLastMouseDownEvent()||a).target)&&setTimeout(function(){paintSelectedCell(anchorCell,true,true)},0);ignoreSynRowHeight=false;if(spreadView.CommandBar&&spreadView.CommandBar.Contains(a.target)&&spreadView.CommandBar.OnMouseUp(a))return;if(editing){var x=getCell(a.target),S=getCellType(x);if(x!=null){var Q=getEditor(x);if(Q!=null&&renderAsEditor==1)if(S==$$.CellTypes.CHECKBOX||S==$$.CellTypes.RADIO_BUTTON_LIST){var mb=getEditorValue(Q);editingValue=mb;spreadView.GetCommandBar().EnableDataButtons(true)}}}if(dragSlideBar){dragSlideBar=false;if(activePager!=null){$$.browser.ie&&activePager.releaseCapture();$$.browser.ie&&element.document.focus();setTextBoxFocus();var yb=moveSlideBar(a)-1;activePager=null;GotoPage(yb)}ignoreBlur=false;return}if(getViewport0()==null&&getViewport()==null)return;if(element.getAttribute("OperationMode")=="ReadOnly")return;var z=true;if(working){var t=element.__lostPoint==null?a.clientX:element.__lostPoint.clientX,u=element.__lostPoint==null?a.clientY:element.__lostPoint.clientY;if(element.__lostPoint!=null)element.__lostPoint=null;if(dragCol>=0){if(element.dragFromGroupbar){var ib=spreadView.GroupBar.ContainsPoint(t,u)&&(a.target==getGroupBar()||spreadView.GroupBar.Contains(a.target));if(ib)if(element.targetCol>0)Regroup(dragCol,parseInt((element.targetCol+1)/2));else Regroup(dragCol,element.targetCol);else Ungroup(dragCol,element.targetCol)}else if(spreadView.GroupBar!=null&&spreadView.GroupBar.IsInside(a.target,t,u)){if(allowGroup)if(element.targetCol>0)Group(dragCol,parseInt((element.targetCol+1)/2));else Group(dragCol,element.targetCol)}else if(allowColMove)if(element.targetCol!=null){var Bb=$$.browser,N={spread:element,cancel:false,col:selectedCols},H=$$.utils.createEvent("ColumnDragMove",false,true,N);element.dispatchEvent(H);if(!H.cancel){var ub=dragViewCol,eb=operationMode!="Normal"?fpSpreadJS.buildTargetColsMoved(selectedCols,ub,element.targetCol):null;MoveCol(dragCol,element.targetCol);var hb=operationMode!="Normal"?eb:selectedCols,N={spread:element,col:hb},H=$$.utils.createEvent("ColumnDragMoveCompleted",false,true,N);element.dispatchEvent(H)}}var bb=getMovingCol();if(bb!=null)bb.style.display="none";var cb=getPosIndicator();if(cb!=null)cb.style.display="none";dragCol=-1;spreadView.__startDragScrollLeft=-1;dragViewCol=-1;element.dragFromGroupbar=false;element.targetCol=null}if(sizeColumn!=null){if(spreadView.Parent!=null){var m=getColHeader();if(m!=null){m=m.parentNode;if(m.__bkHeaderStyle!=null){m.style.overflow=m.__bkHeaderStyle.overflow;delete m.__bkHeaderStyle}}}if(element.captureElement!=null){element.document.releaseCapture();element.captureElement=null}var P=getViewport().parentNode.scrollTop;z=false;var p=t-activeX,Y=t-activeY,nb=sizeColumn.parentElement.parentElement,K=parseInt(sizeColumn.getAttribute("index")),e=isChild(sizeColumn,getRowHeader())||isChild(sizeColumn,getFrozRowHeader()),h=!e?getRealColWidth(nb,K<frzCols?K:K-frzCols):parseInt(sizeColumn.width),U=h-Y+p;h+=p;if(h<1)h=1;if(xhtml&&h<20&&isChild(sizeColumn,getRowHeader()))h=20;var l=null;if(activeY!=t){if(e)setRowHeaderColWidth(sizeColumn.getAttribute("index"),h,false);else{if(spreadView.Parent!=null&&getColHeader())getColHeader().parentNode.style.position="relative";setColWidth(sizeColumn.getAttribute("index"),h,U,false);l=[];l.push(element);if(getTopSpread()!=element){var T=element.document;if(!T.all)T=window.document;var F=window.document.getElementsByTagName("COL");if(F!=null&&F.length>0)for(var b=0;b<F.length;b++){var db=F[b];if(db.getAttribute("NAME")==sizeColumn.getAttribute("NAME")){var E=getSpreadControl(db);if(E!=element){E.setColWidth(sizeColumn.getAttribute("index"),h,U,false);$$.browser.quirksMode&&autoFitTextBoxEditors(E);l.push(E)}}}$$.browser.quirksMode&&autoFitTextBoxEditors(element)}}var xb=parseInt(sizeColumn.getAttribute("index"));synInlineTextEditorWidths(xb);fireColWidthChangedEvent(e,sizeColumn.getAttribute("index"),Math.max(h,sizeColumn.offsetWidth))}if(sizeBar!=null){sizeBar.style.left="-400px";sizeBar.style.cursor="default"}var Z=getViewport().parentElement;saveScrollbarState(Z.scrollTop,Z.scrollLeft);fixBrokenColumns();loadScrollbarState(element,true);if(l==null)l=[element];var f=[getFrozColHeader(),getColHeader(),getFrozColFooter(),getColFooter()];getCorner()!=null&&getCorner().getAttribute("allowTableCorner")!=null&&f.push(getCorner());$$.utils.cleanArray(f);for(var b=0;b<f.length;b++){var w=f[b];w.__bkStyleHeight=w.style.height}for(var Ab=getRowHeader()||getFrozRowHeader(),Cb=getTopSpread(),b=0;b<l.length;b++){var q=l[b];q.syncRowRange(-1,-1,true);q.syncRowRangeSafeMode(-1,-1,false);q.syncRowRange(-1,-1,false,true);if(q==element&&spreadView.AllowVirtualScrollPaging){q.sizeSpread(true);spreadView._MakeSureScrollableTo(P,true,true)}q.sizeSpread(true)}processUpdateRowHeight();for(var b=0;b<f.length;b++){var w=f[b];w.style.height=w.__bkStyleHeight;w.__bkStyleHeight=null}if(smartPaint){startTime=null;stopScroll()}spreadView._MakeSureScrollableTo(P,true);scrollView();if(spreadView.IsMultiColumnComboBox&&element.onAfterResizeColumn!=null)element.onAfterResizeColumn(a);if(element.document.FpActiveSpread==null||element.document.FpActiveSpread==element){if(anchorCell==null)(!spreadView.IsInTouchMode()||!spreadView.IsMultiColumnComboBox)&&focus(null,null,{Event:a});paintSelections(true);paintAnchorCell();spreadView.ShowFocusRectangle(true)}}else if(sizeRow!=null){spreadView.Parent!=null&&spreadView.StopAutoExpandMode();if(element.captureElement!=null){element.document.releaseCapture();element.captureElement=null}var P=getViewport().parentNode.scrollTop;z=false;var p=u-activeY,Y=u-activeX,c=Math.max($$(sizeRow).height(),getOffsetHeight(sizeRow))+p;if(isNaN(c)&&sizeRow.getAttribute("previewRow")=="true")c=sizeRow.offsetHeight;var V=$$(sizeRow).height();if(c<1){c=1;p=1-V}if(xhtml&&c<10){c=10;p=10-V}var r=getFirstNonSpanCell(sizeRow);if(p!=0){var qb=c;sizeRow.style.height=qb+"px"}var e=false;if(activeX!=u){e=isChild(sizeRow,getColHeader())||isChild(sizeRow,getFrozColHeader());if(e){var o=getCorner();if(o!=null&&o.getAttribute("allowTableCorner")&&o.rows[sizeRow.rowIndex].style.height!="")o.rows[sizeRow.rowIndex].style.height=c+"px";setColHeaderRowHeight(sizeRow.rowIndex,$$(sizeRow).height(),false,sizeRow)}else{var d=null;if(isChild(sizeRow,getFrozRowHeader()))d=getViewport1();else{d=getViewport();spreadView._SetVirtualPagingBottomHeights(1e3,true)}if(sizeRow.rowIndex<d.rows.length){if(c<1)c=1;if(xhtml&&c<10)c=10;var O=d.rows[sizeRow.rowIndex],I=getMaxRowSpanInRow(O);if(I>1){for(var ab=[],b=0;b<I;b++)if(sizeRow.rowIndex+b<d.rows.length)ab[b]=getOffsetHeight(d.rows[sizeRow.rowIndex+b]);for(var b=0;b<I;b++)if(sizeRow.rowIndex+b<d.rows.length)d.rows[sizeRow.rowIndex+b].style.height=ab[b]+"px"}O.style.height=c+"px";var i=getFirstNonSpanCell(O);if(i!=null){i.style.height=c+"px";if(i.offsetHeight>c){var vb=$$(i).height()-(i.offsetHeight-c);i.style.height=Math.max(vb,0)+"px"}var R=i.vAlign;i.vAlign="";i.vAlign=R}if(r&&xhtml){var R=$$.j(r).css("verticalAlign")||r.vAlign;r.vAlign="";r.vAlign=R}}var L=getViewport2();if(isChild(sizeRow,getFrozRowHeader()))L=getViewport0();if(L!=null){var M=L.rows[sizeRow.rowIndex];if(M!=null){var x=getFirstNonSpanCell(M);if(x!=null)x.style.height="";M.style.height=c+"px"}}if($$.browser.quirksMode||Number(getViewport().cellSpacing)>0)sizeRow.__updateXmlClientData=true;else saveRowInfo(sizeRow)}var N={spread:element,sizeHeader:e,row:e?sizeRow.rowIndex:getRowFromCell(sizeRow.cells[0]),height:Math.max($$(sizeRow).height(),sizeRow.offsetHeight)},H=$$.utils.createEvent("RowHeightChanged",false,true,N);element.dispatchEvent(H)}var v=sizeRow.rowIndex;if(!e&&!isChild(sizeRow,getFrozRowHeader()))v+=frzRows;var f=null;if(e){f=[getFrozColHeader(),getColHeader(),getFrozColFooter(),getColFooter()];getCorner()!=null&&getCorner().getAttribute("allowTableCorner")!=null&&f.push(getCorner());$$.utils.cleanArray(f);cleanElementsStyle(f,["height"])}if(e)syncRowRange(v,v,true);else syncRowRangeSafeMode(v,v,false);var n=getRowHeader();if(spreadView.AllowVirtualScrollPaging){sizeSpread(true);var tb=spreadView._GetTopRowIndex(),J=spreadView._GetScrollTopFromRow(tb),D=false;if(isChild(sizeRow,n)){var pb=spreadView._IsCellHidden(sizeRow,false,n);if(pb){var wb=getViewport(),zb=element.virtualTop+sizeRow.offsetTop+sizeRow.offsetHeight-wb.parentNode.clientHeight,kb=Math.max(element.virtualTop,zb);D=spreadView._MakeSureScrollableTo(J,kb,true)}else D=spreadView._MakeSureScrollableTo(J,null,true)}else D=spreadView._MakeSureScrollableTo(J,null,true);!D&&spreadView._SetVirtualPagingBottomHeights(0,true)}sizeSpread(true);if(Y<0&&isChild(sizeRow,n)&&sizeRow.getBoundingClientRect().bottom>n.parentNode.getBoundingClientRect().bottom){n.parentNode.scrollTop=Math.max(0,sizeRow.offsetTop+sizeRow.offsetHeight-n.parentNode.clientHeight);scrollView({target:getRowHeader().parentNode})}if(sizeRow.__updateXmlClientData){sizeRow.__updateXmlClientData=null;saveRowInfo(sizeRow)}e&&restoreElementsStyle(f,["height"]);var X=getParentSpread();X!=null&&X.UpdateRowHeight(element);if(smartPaint){var lb=newPageCount;newPageCount=getRowsPerPage(newTop);lb!=newPageCount&&doUpdate()}if(smartPaint){startTime=null;stopScroll()}if(element.document.FpActiveSpread==null||element.document.FpActiveSpread==element){anchorCell==null&&focus(null,null,{Event:a});paintSelections(true);paintAnchorCell();spreadView.ShowFocusRectangle(true)}preventDefault(a);if(sizeBar!=null)sizeBar.style.top="-400px"}activeElement=element.captureElement||a.target;if(activeElement!=null){var j=spreadView.GetLastMouseDownEvent();if(activeElement.tagName!="INPUT"&&activeElement.tagName!="TEXTAREA"&&!$$.utils.isSelectControl(activeElement,true)&&activeElement.tagName!="BUTTON"||j&&j.target!=activeElement&&!$$.utils.isNativeControl(window.document.activeElement)){$$.browser.ie&&a.gestureObject==null&&element.document.releaseCapture();if(editor==null&&(activeElement.id==null||activeElement.id.indexOf("RowEditTemplateContainer")==-1))if(!spreadView.IsMultiColumnComboBox){$$.browser.ie&&element.document.focus();setTextBoxFocus()}!z&&spreadView.GetAttribute("error")=="true"&&spreadView.document.getElementById(element.id+"_RowEditTemplateContainer")!=null&&spreadView._LoadOnDemandTimerId==-1&&!rowEditTemplateContainer_textBoxFocusing&&spreadView._StartLoadOnDemandTimer()}activeElement=null}working=false;getTopSpread(element).resizing=false}var B=spreadView.IsInTouchMode()&&spreadView.GetTopSpreadView().Spread.GetActiveChartObj()!=null;if(z&&hitCommandBar(a)){ignorePaintSelection=true;var A=$$.browser.ieversion>=11&&spreadView.IsInTouchMode();doGetFocus({Event:a,AllowHiddenCell:!$$.browser.webkit,IgnorePaintSelection:B,needSetTextBoxFocusByResetSelection:A,mouseup:true});ignorePaintSelection=false;return}var C=false;if(frzRows==0&&frzCols==0){var ob=getSelection(),y=xmlData.firstChild(ob),g=new Range;if(y!=null){g.row=parseInt(y.getAttribute("rowIndex"));g.col=parseInt(y.getAttribute("colIndex"));g.rowCount=parseInt(y.getAttribute("rowcount"));g.colCount=parseInt(y.getAttribute("colcount"))}switch(selectType){case"":if(g.row>=0)for(var G=getViewport().rows,b=g.row;b<g.row+g.rowCount&&b<G.length;b++)if(G[b].cells.length>0&&G[b].cells[0].children.length>0)if(G[b].cells[0].children[0].getAttribute("FpSpread")=="Spread"){C=true;break}break;case"c":for(var d=getViewport(),b=0;b<d.rows.length;b++)if(IsChildSpreadRow(d,b)){C=true;break}break;case"r":for(var d=getViewport(),sb=g.rowCount,b=g.row;b<g.row+sb&&b<d.rows.length;b++)if(IsChildSpreadRow(d,b)){C=true;break}}}if(C){spreadView.GetCommandBar().EnableButton("Clear",false);spreadView.GetCommandBar().EnableButton("Copy",false);spreadView.GetCommandBar().EnableButton("Paste",false)}if(!IsInRowEditTemplate(a.target)){var j=spreadView.GetLastMouseDownEvent(),gb=j&&$$.utils.isTextControl(j.target)&&$$.utils.contains(element,j.target);if($$.utils.isSelectControl(a.target,true))ignorePostbackEditmode=true;var k=getCell(a.target);if(k==null&&(!gb||j&&a.target==j.target)&&!GrapeCity.Web.Spread.FilterEditor.IsFilterControl(a.target)){if(!spreadView.IsMultiColumnComboBox){var rb=getViewportHolder(),A=$$.browser.ieversion>=11&&spreadView.IsInTouchMode()&&spreadView._IsGrayArea(a.target);if(isChild(a.target,rb)&&getTopSpread(element.document.FpActiveSpread)==element){ignorePaintSelection=true;(anchorCell==null||anchorCell.getAttribute("fpcelltype")!="ExtenderCellType"||anchorCell.getAttribute("celltype2")!="NumericUpDownCellType")&&doGetFocus({Event:a,AllowHiddenCell:spreadView.IsInTouchMode(),IgnorePaintSelection:B,needSetTextBoxFocusByResetSelection:A,mouseup:true});ignorePaintSelection=false;return}if(a.target==getParent(getViewport())&&getTopSpread(element.document.FpActiveSpread)==element){ignorePaintSelection=true;(anchorCell==null||anchorCell.getAttribute("fpcelltype")!="ExtenderCellType"||anchorCell.getAttribute("celltype2")!="NumericUpDownCellType")&&doGetFocus({Event:a,IgnoreEditModePermanent:$$.utils.isOverScrollbar(j),AllowHiddenCell:true,IgnorePaintSelection:B,needSetTextBoxFocusByResetSelection:A,mouseup:true});ignorePaintSelection=false;return}var o=getCorner();if(o==null||!o.contains(a.target)){ignorePaintSelection=true;(anchorCell==null||anchorCell.getAttribute("fpcelltype")!="ExtenderCellType"||anchorCell.getAttribute("celltype2")!="NumericUpDownCellType")&&doGetFocus({Event:a,AllowHiddenCell:spreadView.ColumnHeader.Contains(a.target)||spreadView.RowHeader.Contains(a.target),IgnorePaintSelection:B,needSetTextBoxFocusByResetSelection:A,mouseup:true});ignorePaintSelection=false;return}}}else if(k!=null&&ignorePostbackEditmode&&(isChild(k,getFrozColHeader())||isChild(k,getColHeader()))){ignorePostbackEditmode=false;return}if(editModePermanent&&(W.ContextMenus==null||!editing||editor!=a.target))if(k!=null)k.getAttribute("canFocus")!="false"&&doGetFocus();else doGetFocus();if(z){if(anchorCell==null||anchorCell.getAttribute("fpcelltype")!="ExtenderCellType"||anchorCell.getAttribute("celltype2")!="NumericUpDownCellType")if(!spreadView.IsMultiColumnComboBox)if(!spreadView.IsInTouchMode()||!GrapeCity.Web.DatePicker.IsShowing()||!$$.utils.contains(element,GrapeCity.Web.DatePicker.GetInstance().Anchor||GrapeCity.Web.DatePicker.GetInstance().Target)){var fb=!needCheckSelectText&&a!=null&&(a.target.tagName=="INPUT"&&a.target.type=="text"||a.target.tagName=="TEXTAREA")&&a.type=="mouseup";focus(a,false,jb&&!spreadView.IsControl(a.target)?{FocusEditor:false,SelectText:false}:fb?{SelectText:false}:null)}if(element.document.FpActiveSpread==element&&k!=null&&k.parentElement.getAttribute("FpSpread")=="ch"&&(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="MultiSelect"||operationMode=="ExtendedSelect"))if(anchorCell!=null){paintSelections(true);paintAnchorCell()}}if($$.utils.isSelectControl(a.target,true))ignorePostbackEditmode=false}UpdatePostbackData();var s=getEditor(anchorCell);s!=null&&a.target.type=="radio"&&spreadView.IsSpreadActive()&&$$.utils.contains(anchorCell,a.target)&&setTimeout(setRadioBtnFocus,0);if(spreadView.NeedSetEditorFocusOnActiveCell()&&s!=null&&isChild(a.target,s)&&a.target.type=="button"&&!$$.utils.contains(s,window.document.activeElement,true))s.getAttribute("fpeditor")!="MultiColumnComboBoxCellType"&&a.target.focus();setTimeout(resetBlurFlag,0)}function mouseOver(b){if(!b)b=window.event;var d=b.fromElement==null||b.fromElement==element||$$.utils.contains(element,b.fromElement);!d&&requiresHandleDocumentMouse()&&stopHandlingDocumentMouse();var a=b.target||b.srcElement;if(!isChild(a,getCommandBar())&&!isChild(a,getPager1())&&!isChild(a,getPager2()))return;spreadView&&spreadView.IsEnablejQueryTheme()&&spreadView.JQueryThemeSupporter.MouseOver(b);var c=cb_btn;if(c==null&&a!=null&&a.tagName=="IMG"&&a.getAttribute("disabled")==null&&!$$(a).hasCssClass("aspNetDisabled")){c=cb_btn=a;spreadView&&spreadView.GetCommandBar().UpdateHoverButtonState(c,true)}$$.browser.webkit&&a&&$$.utils.isButtonControl(a)&&a.getAttribute("disabled")==null&&!a.bkBackground&&$$(a).appendCssClass("Button_Hover")}function translateKey(a){var k=spreadView.IsInTouchMode();if(k){var b=spreadView.GetActiveSpreadView(false,true);if(spreadView.NeedSetEditorFocusOnActiveCell()&&b&&b!=spreadView&&b.Spread.fpSpreadJS&&b.IsSpreadHandleKeyboardDirectly()){var h=b.Spread.getAnchorCell();b.Spread.fpSpreadJS.correctFocusOnActiveCell(h);if(!$$.utils.isNativeControl(element.document.activeElement)){var g=b.Spread.fpSpreadJS.getRender(h);g!=null&&g.tagName!="NOBR"&&b.GetSpreadContext().setEditorFocus(g)}return}}if(!initialized||spreadView!=null&&!spreadView.OnSpreadTranslateKey(a))return;var d=getTopSpread(element),i=spreadView.GetComboBoxBehavior();if(i!=null&&!i.getIsDrop())return;if(!a)a=window.event;ignoreElementActive=false;if(a.type=="keydown"&&a.keyCode==9&&d.getSpreadView().TabIndex<0)ignoreElementActive=true;try{element.preventPopUp=false;var l=getCell(a.target,false);if(!GCWS.FilterEditor.IsFilterControl(a.target)&&isHeaderCell(l)&&!a.ctrlKey)return;if(!a.isFromTouchStrip&&a.target!=textBox&&getSpreadControl(a.target,true)!=element){if(!retainSelectionBlock)element.focusedOut=true;if(a.keyCode==tab&&d.getAttribute("ProcessTab")=="True")isPressTABKeyFromOutSide=true;return}if(typeof element.getAttribute("mcctCellType")!="undefined"&&element.getAttribute("mcctCellType")=="true")return;if(element.document.readyState!="complete")return;if((element.document.activeElement==textBox||element.document.activeElement==element)&&(element.document.FpActiveSpread==null||getTopSpread(element.document.FpActiveSpread)!=d)&&(d.getAttribute("ProcessTab")=="True"||a.keyCode!=tab)){spreadView.ActivateSpread(element,true);d.getSpreadView()._HookDocumentFocusInEvent();setTextBoxFocus(true);setActiveSpreadID(d,element.id,element.id)}if(element.document.FpActiveSpread==element){if(element.inDesign&&a.altKey)return;keyDown(a);if(editing&&editor&&editor.getAttribute("FpEditor")=="ExtenderEditor"){var j=editor.getAttribute("Extenders");if(j&&j.indexOf("FpComboBox")!=-1)return}var c=element.document.activeElement;if(a.keyCode==enter&&c){var f=c.tagName.toLowerCase(),e=f=="button";e|=f=="input"&&(c.type=="text"||c.type=="radio"||c.type=="checkbox"||c.type=="button"||c.type=="submit");e|=f=="select"&&c.size>1;e&&preventDefault(a)}}}catch(m){$$.DEBUG.Log(m,"translateKey")}}function keyDown(a){spreadView.EventTracker.Clear();if(!a)a=window.event;spreadView.shouldPreventKeydownBehavior=false;if(working&&(sizeColumn!=null||sizeRow!=null))return;if(!spreadView.OnSpreadKeyDown(a))return;if(window.fpPostOn!=null)return;ignoreBlur=true;var u=processKeyMap(a);if(!u)return;var e=element.document.activeElement;if($$.browser.chrome&&editing&&$$.utils.contains(editor,e,true)&&editor.getAttribute("MccbId")==null&&$$.utils.isNeedPreventScrolling(a,e)){a.preventDefault();return}doIgnoreVirtualPaging();if(a.keyCode==space&&anchorCell!=null){var r=operationMode;if(r=="MultiSelect"){if(isRowSelected(getRowFromCell(anchorCell)))selectRow(getRowFromCell(anchorCell),1,false,true);else selectRow(getRowFromCell(anchorCell),1,true,true);return}}var b=false,c=null;if(editing&&editor!=null){c=getEditor(anchorCell);b=c!=null}if(a.keyCode!=left&&a.keyCode!=right&&a.keyCode!=enter&&a.keyCode!=tab&&editing&&!b&&$$.utils.isSelectControl(editor))return;switch(a.keyCode){case left:case right:if(b&&getCellType(anchorCell)!="TextCellType"&&editor.getAttribute("FpEditor")!="RadioButton"&&editor.getAttribute("FpEditor")!="TextBox"){editor!=null&&$$.utils.isSelectControl(editor)&&editor.blur();EndEdit()}cancelKeyDownOfselectControl(a);if(!editing||editor!=null&&$$.utils.isSelectControl(editor)){editor!=null&&editor.blur();editing&&EndEdit();nextCell(a.keyCode,null,null,{Event:a})}break;case up:case down:case enter:if(editor!=null&&(editor.tagName=="TEXTAREA"||$$.utils.isSelectControl(editor)))return;if(b&&editing&&editor.getAttribute("FpEditor")=="ExtenderEditor"){var i=editor.getAttribute("Extenders");if(i&&(i.indexOf("AutoCompleteExtender")!=-1||i.indexOf("FpComboBox")!=-1))return}if(enter==a.keyCode&&a.target.tagName=="A")return;var p=editing;if(p){enter==a.keyCode&&preventDefault(a);if(editor!=null&&editor.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"&&anchorCell.getAttribute("FpEditorID")==null){var g=getRowFromCell(anchorCell);if(g==0&&a.keyCode==up)return;if(a.keyCode==down){g+=anchorCell.rowSpan-1;var q=GetRowCountInternal(),j=g==q-1;if(!j&&g==q-2){var s=getViewportFromCell(anchorCell);if(s.rows[s.rows.length-1].getAttribute("previewRow")=="true")j=true}if(j)return}}var l=EndEdit();if(!l)return}nextCell(a.keyCode,null,null,{Event:a});if(!p&&enter==a.keyCode){var f=getTopSpread(element);textBox=document.getElementById(f.id+"_textBox");setTextBoxFocus(true)}break;case tab:var f=getTopSpread(element),n=f.getAttribute("ProcessTab")=="true"||f.getAttribute("ProcessTab")=="True";if(editing){if(editor!=null&&($$.utils.isSelectControl(editor)||editor.tagName=="INPUT"&&editor.type=="text")&&!spreadView.IsSuspendFocusSpread()&&spreadView.NeedSetEditorFocusOnActiveCell()){editor.blur();editor.focus()}var m=window.document.activeElement,l=EndEdit({shouldDelayUpdateValues:true});if(!l||editing){if(n&&!l&&m!=window.document.activeElement&&spreadView.NeedSetEditorFocusOnActiveCell()){detachOnActiveEvents();m.focus();attachOnActiveEvents()}preventDefault(a);cancelBubble(a);return}}if(n){nextCell(a.keyCode,null,null,{Event:a});preventDefault(a)}else{hideSelectionBlock();setActiveSpreadID(f,"",null);spreadView.ActivateSpread(null)}break;case shift:break;case home:case end:case pup:case pdn:if(!editing)nextCell(a.keyCode,null,null,{Event:a});else{var e=window.document.activeElement;if($$.browser.chrome&&editor&&$$.utils.isTextControl(e))e.getAttribute("readonly")!=null&&(a.keyCode==home||a.keyCode==end)&&$$.utils.cancelDefault(a)}break;case space:if(anchorCell!=null){var r=operationMode;if(r=="MultiSelect"){if(isRowSelected(getRowFromCell(anchorCell)))selectRow(getRowFromCell(anchorCell),1,false,true);else selectRow(getRowFromCell(anchorCell),1,true,true);return}}if(b&&c!=null&&c.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"){preventDefault(a);break}default:var h=c!=null&&(c.tagName=="INPUT"&&c.type=="text"||c.tagName=="TEXTAREA"),d=spreadView.UseWorkArroundClipboard();if(a.keyCode==67&&a.ctrlKey&&(!editing||b&&!h)){Copy(d);!d&&preventDefault(a)}else if(a.keyCode==86&&a.ctrlKey&&(!editing||b&&!h))if(d){var o=$$.j(window.document);o.off("paste",documentOnPaste);o.on("paste",documentOnPaste);!$$.browser.chrome&&__focusTextBoxTemporary(getTopSpread(element),"")}else{Paste();preventDefault(a);spreadView.shouldPreventKeydownBehavior=true}else if(a.keyCode==88&&a.ctrlKey&&(!editing||b&&!h)){Clear(d);!d&&preventDefault(a);if($$.browser.ieversion>10&&editor!=null&&$$.utils.isSelectControl(editor)&&editor.size==editor.length){var t=editor.style.height;editor.style.height="";editor.style.height=t}}else if(!editing&&anchorCell!=null&&!isHeaderCell(anchorCell)&&!a.ctrlKey&&a.keyCode!=altkey&&anchorCell.getAttribute("canFocus")!="false"){var k=anchorCell.getElementsByTagName("INPUT");if(!(k!=null&&k.length>0&&k[0].getAttribute("FpEditor")=="Button")){$$.browser.chrome&&a.keyCode==229&&getEditor(anchorCell)==null&&$$.utils.cancelDefault(a);StartEdit(anchorCell,{FromKeyDown:true});if(editing)a.keyCode==27&&$$.utils.cancelDefault(a);!editing&&element.document.activeElement==textBox&&preventDefault(window.event)}if(editing){a.keyCode==backspace&&$$.utils.isSelectControl(editor)&&preventDefault(a);space==a.keyCode&&editor.getAttribute("FpEditor")!="Button"&&(editor.tagName!="INPUT"||editor.type!="checkbox")&&preventDefault(a)}}else(editing||(anchorCell==null||isHeaderCell(anchorCell))&&!a.ctrlKey&&a.keyCode!=altkey)&&element.document.activeElement==textBox&&preventDefault(window.event)}}function keyup(a){spreadView.EventTracker.Clear();isPressTABKeyFromOutSide=false;inTextBoxKeyDown=false;var b=a||window.event;if(b.keyCode==enter)if(editing&&editor!=null&&$$.utils.isSelectControl(editor)){enter==b.keyCode&&preventDefault(b);var e=EndEdit();if(!e)return;var f=getTopSpread(element),d=element.document;if(!d.all)d=window.document;textBox=d.getElementById(f.id+"_textBox");enter==b.keyCode&&setTextBoxFocus(true)}if(a.ctrlKey&&(a.keyCode==67||a.keyCode==86||a.keyCode==88)||a.keyCode==17){var c=$$.j(window.document);c.off("paste",documentOnPaste);c.off("copy",documentOnCopy);c.off("cut",documentOnCopy)}if(spreadView.DelayUpdateValues){spreadView.DelayUpdateValues=false;updateValues()}resetBlurFlag()}function keypress(b){var a=b.target;if(a&&$$.utils.contains(element,a,true)){var c=operationMode=="RowMode"&&enableRowEditTemplate=="true"&&IsInRowEditTemplate(a),d=a.tagName=="INPUT"&&a.type=="text";if(b.keyCode==enter&&!c&&d||spreadView.shouldPreventKeydownBehavior){preventDefault(b);spreadView.shouldPreventKeydownBehavior=null}}}function requiresHandleDocumentMouse(b){if(spreadView.IsInTouchMode())return false;var a;return dragCol!=null&&dragCol!=-1||working&&(sizeRow!=null||sizeColumn!=null||b==null||b.which==1)||dragSlideBar||anchorCell&&(a=spreadView.GetLastMouseDownEvent())!=null&&containsNumericCellType(anchorCell,a.target)}function backupHeaderStyle(){var a=getColHeader();if(a!=null){a=a.parentNode;if(a.__bkHeaderStyle==null){a.__bkHeaderStyle={overflow:a.style.overflow};a.style.overflow="hidden"}}}function getMovingCol(){if(movingCol!=null)return movingCol;var b=element.document;if(!b.createElement)b=window.document;var a=b.createElement("div");movingCol=a;a.style.position="absolute";a.style.top="0px";a.style.left="20px";a.id=element.id+"movingCol";a.align="center";$$.j(element).append(a);a.style.display="none";a.style.overflow="hidden";if(element.getAttribute("DragColumnCssClass")!=null)a.className=element.getAttribute("DragColumnCssClass");else a.style.border="1px solid black";a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";return a}function isControl(a){return a!=null&&(a.tagName=="INPUT"||a.tagName=="TEXTAREA"||a.tagName=="SELECT")}function getClipboardState(){var f=getCellType(anchorCell),e=getSelection(),a=xmlData.lastChild(e),d=operationMode=="SingleSelect"||operationMode=="MultiSelect"||operationMode=="ExtendedSelect";if(d)return{Copy:a!=null,Cut:false,Paste:false};else{var c=operationMode=="ReadOnly"||f=="readonly";if(!c)c=anyReadOnlyCell(a);if(spreadView.EnableRowEditTemplate&&anchorCell)if(anchorCell.getAttribute("RowEditTemplate")=="true")return{Copy:false,Cut:false,Paste:false};else if(operationMode=="RowMode"){var b=element.document.getElementById(element.id+"_editRow");if(b&&anchorCell.parentNode.rowIndex==b.rowIndex&&b.cells.length>0&&b.cells[0].getAttribute("RowEditTemplate")=="true")return{Copy:false,Cut:false,Paste:false}}return c?{Copy:a!=null,Cut:false,Paste:a!=null&&getClipboardData()!=null}:{Copy:a!=null,Cut:a!=null,Paste:a!=null&&getClipboardData()!=null}}}function getExtendedSelectRows(h,e,g){var a=[],d=e!=null?getRowFromCell(e):getRowFromCell(h),b=getRowFromCell(g),f=getSelection();if(f==null){a.push(null);a.push(1)}else{var c=getSelectRowNode(f,d);if(c!=null)if(b<c.startRow){a.push(b);if(d==c.startRow)a.push(c.endRow-b+1);else a.push(c.startRow-b+1)}else if(c.startRow<=b&&b<=c.endRow)if(b>=d){a.push(b);a.push(c.endRow-b+1)}else{a.push(c.startRow);a.push(b-c.startRow+1)}else if(d==c.startRow){a.push(c.endRow);a.push(b-c.endRow+1)}else{a.push(c.startRow);a.push(b-c.startRow+1)}else if(d<b){a.push(d+1);a.push(b-d-1)}else{a.push(b);a.push(Math.max(1,d-b))}}return a}function getSelectRowNode(f,d){var b=null,a=xmlData.firstChild(f);while(a!=null){var g=parseInt(a.getAttribute("colIndex"));if(g==-1){var c=parseInt(a.getAttribute("rowIndex")),e=parseInt(a.getAttribute("rowcount"));if(c<=d&&d<c+e){b={};b.startRow=c;b.endRow=c+e-1;break}}a=a.nextSibling}return b}function setTextBoxFocusByResetSelection(){!$$.browser.webkit&&setTimeout(function(){if(element.document.activeElement==textBox){detachOnActiveEvents();textBox.selectionStart=textBox.selectionEnd=0;attachOnActiveEvents()}},0)}function saveRowInfo(c){var d=addRowInfo(c.getAttribute("FpKey"));if(d!=null){height=$$(c).height();if(c.synDelt!=null){var b=c.synDelt;if(frzCols>0){var a=frzRows>0?getViewport0().rows[0]:getViewport2().rows[0];if(a!=null&&a.synDelt!=null)b=Math.max(b,a.synDelt)}else{var a=frzRows>0?getViewport1().rows[0]:getViewport().rows[0];if(a!=null&&a.synDelt!=null)b=Math.max(b,a.synDelt)}height-=b}setRowHeight(d,height)}}function IsInRowEditTemplate(a){while(a&&a.parentNode){a=a.parentNode;if(a.tagName=="DIV"&&a.id==element.id+"_RowEditTemplateContainer")return true}return false}function canProcessEditMode(){if(working||dragSlideBar||GetActiveChart()||spreadView.RowCount==0||spreadView.ColumnCount==0||element.virtualPagingProcessing)return false;if(document.activeElement!=null){var b=GrapeCity.Web.Spread.FilterEditor.GetEditor(document.activeElement);if(b!=null&&b.Behavior.Spread.getSpreadContext().getTopSpread()==getTopSpread())return false}var a=spreadView.GetTopSpreadView().ActiveContextMenu;if(a!=null&&a.IsShowing())return false;try{if(element.document.FpActiveSheetView!=element)return false}catch(c){$$.DEBUG.Log(c,"processEditMode");return false}return true}function processEditMode(e,c){if(canProcessEditMode()){ignoreBlur=true;if(editModePermanent){if(c!=null&&c.FullVisibleRequired){var d=spreadView.GetTopSpreadView(),a=d._GetViewportFromCell(anchorCell),b=d.GetSpreadContext().getScrollvp();if(a!=null)if(b!=null&&a.parentNode.scrollLeft!=b.scrollLeft){spreadView.ProcessEditModePermanent(null,true);return}if(a==null||spreadView._IsElementHidden(anchorCell,b||a.parentNode,true))return}StartEdit(anchorCell)}focus(e);setTimeout(resetBlurFlag,0)}$$.browser.webkit&&!editing&&editor==null&&!textBox.readOnly&&switchHiddenTextBox(true)}function doGetFocus(a){if(!spreadView.OnSetTextBoxFocus())return;var o=getTopSpread(element),f=$$.fn.createXMLDOMWrapper(o),d=f.selectSingleNode("root activechild");if(d!=null&&f.textContent(d)!=""){var c=element.document.getElementById(f.textContent(d));if(c!=null&&c!=element){c.doGetFocus(a);return}}element.document.FpActiveSpread!=element&&setActiveSpreadManually(element);if(activeChartObj!=null)return;var b=spreadView.GetLastMouseDownEvent()||window.event,i=anchorCell&&anchorCell.getAttribute("CellType2")=="AjaxComboBoxCellType"&&anchorCell.getElementsByTagName("INPUT").length>0,j=$$.utils.isRightClick(b),e=j||a&&a.IgnoreEditModePermanent||(a==null||!a.AllowHiddenCell?spreadView._IsCellHidden(anchorCell):false);if(editing&&(spreadView.IsInTouchMode()||j&&anchorCell&&editModePermanent&&isEditModeReplace(anchorCell)&&$$.utils.contains(editor,b.target,true)))i=e=true;if((!editModePermanent||e)&&!i){if(anchorCell==null&&a&&a.mouseup&&!$$.utils.contains(element,element.document.activeElement))setTextBoxFocus(true);else{var g=false;if(a&&a.mouseup&&$$.utils.isTouchEvent(a.Event)&&!$$.browser.ie){var m=getEditor(anchorCell);if($$.utils.contains(m,window.document.activeElement,true)&&$$.utils.isTextControl(window.document.activeElement)&&spreadView._IsGrayArea(a.Event.target))g=true}!g&&setTextBoxFocus()}a&&a.needSetTextBoxFocusByResetSelection&&setTextBoxFocusByResetSelection()}var k=operationMode;!GCWS.FilterEditor.IsFilterControl(element.document.activeElement)&&anchorCell==null&&k!="MultiSelect"&&k!="ExtendedSelect"&&GetRowCount()>0&&GetColCount()>0&&setAnchorCellForFirstTime(b);if(a==null||!a.IgnorePaintSelection){paintAnchorCell();paintSelections(true)}var h=false;if(b!=null)h=$$.utils.isOverScrollbar(b);if(!h&&editModePermanent&&!ignorePostbackEditmode&&!getTopSpread().getSpreadView().GetSpreadContext().isIgnorePostbackEditmode()&&!e){var n=$$.browser.webkit&&b&&(spreadView.ColumnHeader.Contains(b.target)||spreadView.RowHeader.Contains(b.target))?500:200;spreadView.RegisterTimeoutTask(processEditMode,n,"ProcessEditMode");if((!a||!a.PreventSwitchingKeyboard)&&!spreadView.IsSuspendedAction(spreadView.GetTopSpreadView().Spread,GCWS.Actions.SWITCH_KEYBOARD)){var l=b&&(spreadView.IsInViewport(b.target)||getCell(b.target)==null);l&&switchHiddenTextBox()}}else setTimeout(function(){resetBlurFlag();$$.browser.webkit&&spreadView.IsInTouchMode()&&textBox==window.document.activeElement&&!editing&&spreadView.IsSpreadActive()&&switchHiddenTextBox(true)},0)}function switchHiddenTextBox(f,a){if($$.browser.webkit&&getEditingSpread()==null&&$$.utils.isTextControl(textBox)){var b=null;if(anchorCell){b=getEditor(anchorCell);if(b==null){var c=getCellEditorID(anchorCell);b=c!=null&&typeof c!="undefined"?getCellEditor(c,true):null}}var e=b?$$.utils.isTextControl(b):false,g=anchorCell?getCellType(anchorCell):"",d=anchorCell&&anchorCell.getAttribute("locked")!="true"&&anchorCell.getAttribute("canFocus")!="false"&&g!="readonly";if(!f&&e&&d&&canProcessEditMode()&&!spreadView.IsPopupOpened(true))if(textBox.getAttribute("readonly")!=null){!a&&textBox==window.document.activeElement&&textBox.blur();textBox.removeAttribute("readonly");!a&&setTextBoxFocus()}else!a&&window.document.activeElement!=textBox&&setTextBoxFocus();else if(textBox.getAttribute("readonly")==null){!a&&textBox==window.document.activeElement&&textBox.blur();textBox.setAttribute("readonly","readonly");!a&&setTextBoxFocus()}}}function resetBlurFlag(k){var e=getRowHeader(),f=getViewport(),d=getViewport2(),b=e!=null&&e.parentNode!=null?e.parentNode.scrollTop:-1,c=f!=null&&f.parentNode!=null?f.parentNode.scrollTop:-1,a=d!=null&&d.parentNode!=null?d.parentNode.scrollTop:-1,j=null;if(spreadView.IsInTouchMode()&&k&&k.needScrollView){var g=[f,d,e];$$.utils.cleanArray(g);for(var i=0;i<g.length;i++){var h=g[i];if(h.parentNode.scrollTop!=scrollTop||h.parentNode.scrollLeft!=scrollLeft){j=h.parentNode;break}}}if(b!=-1&&c!=-1&&b!=c||b!=-1&&a!=-1&&b!=a||a!=-1&&c!=-1&&a!=c){element.ignoreVirtualPaging=true;scrollView({target:j},null,function(){element.ignoreVirtualPaging=false})}ignoreBlur=false}function setRadioBtnFocus(){var a=getEditor(anchorCell);a!=null&&setEditorFocus(a)}function SynRowHeight(){}function UpdateRowHeight(c,h){var a=c.parentElement;while(a!=null){if(a.tagName=="TR")break;a=a.parentElement}if(a!=null){var b=a.rowIndex;if(getRowHeader()!=null&&b<getRowHeader().rows.length)if(xhtml){var d=getRowHeader(),e=c.offsetHeight;a.cells[0].style.height="";d.rows[b].cells[0].style.height="";a.style.height=e+1+"px";a.synDelt=0;d.rows[b].style.height=e+1+"px";d.rows[b].synDelt=0}else{getRowHeader().rows[b].cells[0].style.height="";a.cells[0].style.height="";var f=c.offsetHeight+1;getRowHeader().rows[b].style.height=f+"px";a.style.height=f+"px"}}var g=getParentSpread();g!=null&&g.UpdateRowHeight(element,h)}function processUpdateRowHeight(){if($$.browser.quirksMode){for(var b=FpSpreadJS.getChildViews(element),a=0,c=b.length;a<c;a++)UpdateRowHeight(b[a]);sizeSpread(true)}}function mouseOut(a){if(!a)a=window.event;var c=a.toElement==element||$$.utils.contains(element,a.toElement);!c&&requiresHandleDocumentMouse(a)&&startHandlingDocumentMouse();var b=a.target||a.srcElement;spreadView&&spreadView.IsEnablejQueryTheme()&&spreadView.JQueryThemeSupporter.MouseOut(a);b&&$$.utils.isButtonControl(b)&&b.getAttribute("disabled")==null&&$$.browser.webkit&&$$(b).removeCssClass("Button_Hover");if(isChild(b,getCommandBar())||isChild(b,getPager1())||isChild(b,getPager2())){CBMouseOut();return}if(!working&&sizeColumn!=null&&sizeColumn.style!=null)sizeColumn.style.cursor="auto"}function CBMouseOut(){var a=cb_btn;if(a!=null){spreadView&&spreadView.GetCommandBar().UpdateHoverButtonState(a,false);cb_btn=null}}function stopHandlingDocumentMouse(e){for(var f=e==null?["mousemove","mouseup"]:[e.toLowerCase()],d=0;d<f.length;d++){var b=f[d],c=null;c=b=="mouseup"?mouseUp:b=="mousemove"?mouseMove:null;try{var a=window,g=0;do{var h=a.document;h.removeEventListener(b,c);h.removeEventListener(b,c,true);if(g<$$.browser.getAccessParentLevel()&&a.parent!=null&&a!=a.parent){a=a.parent;g+=1}else break}while(true)}catch(i){$$.DEBUG.Log(i,"stopHandlingDocumentMouse")}if(spreadView._handledDocumentMouse)spreadView._handledDocumentMouse[b]=false}}function startHandlingDocumentMouse(f,d){for(var g=f==null?["mousemove","mouseup"]:[f.toLowerCase()],e=0;e<g.length;e++){var a=g[e];if(spreadView._handledDocumentMouse&&spreadView._handledDocumentMouse[a])continue;var c=null;c=a=="mouseup"?mouseUp:a=="mousemove"?mouseMove:null;if(c==null)continue;d&&a=="mouseup"&&$element.off(a,c);try{var b=window,h=0;do{var i=b.document;i.removeEventListener(a,c,!d);i.addEventListener(a,c,!d);if(h<$$.browser.getAccessParentLevel()&&b.parent!=null&&b!=b.parent){b=b.parent;h+=1}else break}while(true)}catch(j){$$.DEBUG.Log(j,"startHandlingDocumentMouse")}if(!spreadView._handledDocumentMouse)spreadView._handledDocumentMouse={};spreadView._handledDocumentMouse[a]=true}}function doIgnoreVirtualPaging(){if(!element.ignoreVirtualPaging){element.ignoreVirtualPaging=true;setTimeout(function(){element.ignoreVirtualPaging=false},300)}}var keyActionInfo=null;function processKeyMap(event){if(!event)event=window.event;for(var ret=true,n=keyMap.length,i=0;i<n;i++){var ka=keyMap[i];if(event.keyCode==ka.key&&event.ctrlKey==ka.ctrl&&event.shiftKey==ka.shift&&event.altKey==ka.alt){ret=false;if(!$$.browser.ie&&event.ctrlKey)keyActionInfo={CanCopy:event.keyCode==67,CanPaste:event.keyCode==86,CanCut:event.keyCode==88};if(typeof ka.action=="function")ret=ka.action();else ret=eval(ka.action);break}}return ret}function Print(){if(spreadView._LoadOnDemandTimerId!=null&&spreadView._LoadOnDemandTimerId>-1)spreadView._SetPendingRequest(doPrint,true);else doPrint()}function doPrint(){if(editing)return;if(getParentSpread()!=null)return;spreadView.GetTopSpreadView().SaveAllXmlData();var d=prepareTargetPrintSpread("Print"),c=mvc.inMvcFramework();if(c)mvc.doPrint(element.getAttribute("name"),"Print","printSpread");else{var b=getForm();if(b==null)return;var a=b;a.__EVENTTARGET.value=element.getAttribute("name");a.__EVENTARGUMENT.value="Print";var e=a.target;a.target=d;a.submit();a.target=e}}function printSpread(){var a=element.document.activeElement;if(element.document.printSpread.contentWindow!=null){element.document.printSpread.contentWindow.focus();element.document.printSpread.contentWindow.print()}else{element.document.printSpread.focus();element.document.printSpread.print()}if(a&&!a.disabled){a.blur();a.focus()}}function PrintPDF(){if(spreadView._LoadOnDemandTimerId!=null&&spreadView._LoadOnDemandTimerId>-1)spreadView._SetPendingRequest(doPrintPDF,true);else doPrintPDF()}function doPrintPDF(){if(editing)return;if(getParentSpread()!=null)return;spreadView.GetTopSpreadView().SaveAllXmlData();var e=mvc.inMvcFramework();if(e){var c=element.document;c.printSpreadPDF==null&&c.body.insertAdjacentHTML("beforeEnd","<iframe name=printSpreadPDF width=0 height=0 src='/?scid=dummy.htm'></iframe>");mvc.doPrint(element.getAttribute("name"),"PrintPDF","printSpreadPDF")}else{var b=getForm();if(b==null)return;var a=b;a.__EVENTTARGET.value=element.getAttribute("name");a.__EVENTARGUMENT.value="PrintPDF";var d=a.target;a.target=$$.browser.ie?prepareTargetPrintSpread("PrintPDF"):d;a.submit();a.target=d}}function prepareTargetPrintSpread(c){if(element.document.printSpread==null){var a=document.createElement("DIV");a.style.width=a.style.height="0px";a.style.overflow="hidden";window.document.body.appendChild(a);var b=document.createElement("IFRAME");b.name="printSpread";document.printSpread=b;a.appendChild(b,null);b.addEventListener("load",function(){b.printType=="Print"&&document.getElementById(element.id).printSpread()},false)}element.document.printSpread.printType=c;if(element.document.printSpread.frameElement)element.document.printSpread.frameElement.printType=c;return"printSpread"}function ExpandRow(c){var a=element.document.FpActiveSpread;if(a==null)a=element;if(!a.IsValid())return;spreadView.GetTopSpreadView().SaveAllXmlData();var d=element.getAttribute("ajax")!="false";if(d){var b=getViewport();if(b!=null)fpSpreadJS.cachedValues.scrollbarValues={scrollTop:b.parentNode.scrollTop,scrollLeft:b.parentNode.scrollLeft};syncData(element.getAttribute("name"),"ExpandView, "+c)}else __doPostBack(element.getAttribute("name"),"ExpandView, "+c)}function SortColumn(a,c){saveScrollbarState(0,-1);spreadView.GetTopSpreadView().SaveAllXmlData();var d=element.getAttribute("ajax")!="false";if(element.getAttribute("layoutMode")&&c!=null){var e=getDisplayIndex(c),b=GetCellByRowCol(e,a);if(b!=null&&parseInt(b.getAttribute("col"))!=-1)a=parseInt(b.getAttribute("col"))}if(d)syncData(element.getAttribute("name"),"SortColumn, "+a);else __doPostBack(element.getAttribute("name"),"SortColumn, "+a)}function Filter(d){if(!element.IsValid())return;var f=d[d.selectedIndex],b=text=f.textContent!=null?f.textContent:f.text;if(d.tagName=="SELECT"){var i=new RegExp("\\s*"),h=new RegExp("\\S*"),e="",c=0,g=b.length;while(g>0){var a=b.match(i);if(a!=null){e+=a[0];c=a[0].length;g-=c;b=b.substring(c);a=b.match(h);if(a!=null){c=a[0].length;g-=c;b=b.substring(c)}}else break;a=text.match(h);if(a!=null){e+=a[0];c=a[0].length;text=text.substring(c);a=text.match(i);if(a!=null){c=a[0].length;text=text.substring(c)}}else break}b=e}var k=fireAutoFilteringColumn(selectedCols,b);element.ignoreVirtualPaging=true;if(!k.cancel){saveScrollbarState(0,-1);spreadView.GetTopSpreadView().SaveAllXmlData({notUsedTimeout:true});dirty=false;var j=element.getAttribute("ajax")!="false";if(j){syncData(d.getAttribute("name"),b);element.LoadState=null}else __doPostBack(d.getAttribute("name"),b)}element.ignoreVirtualPaging=false}function CallBack(d,a,b,c){syncData(element.getAttribute("name"),d,a,b,c)}function fireCallBackStartEvent(a){var c={cancel:a.cancel,command:a.command,spread:a.spread,async:a.async},b=$$.utils.createEvent("CallBackStart",false,true,c);element.dispatchEvent(b);a.cancel=b.cancel;a.async=b.async;return a.cancel}function fireCallBackStoppedEvent(b,c){var a={spread:c,command:b},d=$$.utils.createEvent("CallBackStopped",false,false,a);element.dispatchEvent(d)}function getForm(){var a=element.parentNode;while(a!=null&&a.tagName!="FORM")a=a.parentNode;return a}function setFpPostOn(a){window.fpPostOn=a}function syncData(targetId,cmd,asyncCallBack,onStart,onStop){if(!initialized||spreadView==null)return;if(spreadView.IsLoadingOnDemand&&cmd!="UpdateValues"||window.fpPostOn!=null){spreadView.IsLoadingOnDemand&&cmd!="LoadOnDemand"&&spreadView.SetPendingRequest(targetId,cmd,asyncCallBack,onStart,onStop);element.LoadState=null;return}spreadView.OnSpreadCallbackStart(cmd);var ts=getTopSpread(element),e=$$.utils.createEvent();e.cancel=false;e.command=cmd;e.spread=element;if(asyncCallBack==null)asyncCallBack=false;e.async=asyncCallBack;var cancel=ts.fireCallBackStartEvent(e);if(!cancel&&onStart&&!onStart())cancel=true;if(cancel){element.clearCellData();return}cmd!="RetrieveFilterBarMenus"&&spreadView._LoadOnDemandTimerId!=null&&spreadView._LoadOnDemandTimerId>-1&&spreadView._StopLoadOnDemandTimer();if(cmd!=null&&(cmd.indexOf("SelectView,")==0||cmd=="Next"||cmd=="Prev"||cmd.indexOf("Group,")==0||cmd.indexOf("Page,")==0))element.LoadState=null;var async=e.async;async&&cmd!="RetrieveFilterBarMenus"&&!spreadView.IsLoadingOnDemand&&openWaitMsg();$$.browser.webkit&&editor&&editor.tagName=="INPUT"&&editor.type=="text"&&FarPoint.Web.Spread.SafariPatch.RemoveTextBoxFix(editor);if(!spreadView.IsLoadingOnDemand&&cmd!="RetrieveFilterBarMenus")window.fpPostOn=true;if(error&&cmd!="RetrieveFilterBarMenus"){targetId=element.getAttribute("name");cmd="update"}var inMvcFramework=mvc.inMvcFramework(),href;if(inMvcFramework){var ts=getTopSpread(element),appPath=ts.getAttribute("AppRootPath");if(appPath!=null&&appPath.length>0)href="/"+appPath+"/"+mvcSpread.MVC_SPREAD_VIRTUAL_FILENAME;else href="/"+mvcSpread.MVC_SPREAD_VIRTUAL_FILENAME}else{var form=getForm();if(form==null)return;form.__EVENTTARGET.value=targetId;form.__EVENTARGUMENT.value=encodeURIComponent(cmd);href=form.action}var ss=element,target=element.id,data;if(cmd.indexOf("RefreshChart")>=0)data=collectLightData(targetId,cmd);else data=collectData(targetId,cmd);data=fpSpreadJS.removeHiddenCellsInfo(data);var respText="",req=null;try{if(window.external)req=window.external.XMLHttpRequest}catch(ex1){$$.DEBUG.Log(ex1,"syncData")}if(!req)req=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(req==null)return;var task=spreadView._GetTimeoutTask("ProcessEditMode");spreadView.ClearTimeoutTasks();task&&cmd=="UpdateValues"&&task.ReRegister();spreadView.ClearIntervalTasks();req.open("POST",href,async);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded, charset=UTF-8");function processData(){if(req.readyState!=4)return;var processDataCompletedHandlers=[],processDataCompletedManually=false,pt=null,ts=null;try{!spreadView.IsLoadingOnDemand&&cmd!="RetrieveFilterBarMenus"&&closeWaitMsg();var form=getForm(),doc=element.document;if(form==null&&element.isMVCSpread()){form=doc.body;form.__EVENTTARGET=doc.getElementById("__EVENTTARGET");form.__EVENTARGUMENT=doc.getElementById("__EVENTARGUMENT")}var oldActive=element.id;try{if(cmd!="RetrieveFilterBarMenus"&&spreadView.LoadOnDemandMode!="Background"&&doc.selection&&doc.selection.type!="None"&&$$.browser.ieversion<11){var input=doc.activeElement,isTextEditor=input.tagName=="INPUT"&&input.type=="text"||input.tagName=="TEXTAREA",selStart=selEnd=-1;if(isTextEditor){selStart=doc.activeElement.selectionStart;selEnd=doc.activeElement.selectionEnd}doc.selection.empty();if(isTextEditor&&doc.activeElement==input){input.selectionStart=selStart;input.selectionEnd=selEnd}}}catch(ex){$$.DEBUG.Log(ex,"processData")}var buff=doc.createElement("div");if(buff==null)return;if(cmd=="RetrieveFilterBarMenus"){doc.body.appendChild(buff);buff.style.display="none"}var respText=req.responseText;if(/<body[^>]*>/i.test(respText)){window.fpPostOn=null;error=true;var ep=element.getAttribute("errorPage");if(ep!=null&&ep.length>0){var document=element.document;if(!document.createElement)document=window.document;var tmp=document.createElement("a");tmp.style.display="none";$$.j(tmp).on("click",cancelBubble);tmp.href=ep;document.body.appendChild(tmp);tmp.click();$$.j(tmp).off("click",cancelBubble);document.body.removeChild(tmp);function cancelBubble(a){a.cancelBubble=true}}return}if(element.inDesign&&respText=="__only_postdata__"){window.fpPostOn=null;dataBuff=null;onStop&&onStop();ts=getTopSpread(doc.getElementById(target));ts!=null&&ts.fireCallBackStoppedEvent(cmd,element);spreadView.IsLoadOnDemand&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();return}buff.innerHTML=respText;vpholder_setSizeCallback=null;if(cmd.indexOf("RefreshChart")>=0){var data=eval("("+respText+")");updateChartURL(data);if(form!=null&&!element.isMVCSpread()){form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value=""}window.fpPostOn=null;onStop&&onStop();ts=getTopSpread(doc.getElementById(target));ts!=null&&ts.fireCallBackStoppedEvent(cmd,element);spreadView.IsLoadOnDemand&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();spreadView.OnSpreadCallbackStopped(cmd);return}if(cmd=="RetrieveFilterBarMenus"){doc.body.removeChild(buff);spreadView.ReceiveFilterBarPackage(buff,form);fpSpreadJS.loadNewScripts(buff,true);if(form!=null&&!element.isMVCSpread()){form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value=""}window.fpPostOn=null;dataBuff=null;onStop&&onStop();spreadView.OnSpreadCallbackStopped(cmd);return}ts=getTopSpread(doc.getElementById(target));pt=getElementById(buff,target+"_values");if(pt!=null){xmlData.switchNodeContext(pt);var nodes=xmlData.selectSingleNode("data");xmlData.resetNodeContext();var node=xmlData.firstElementChild(nodes);error=false;var ss=doc.getElementById(target);ss.SuspendLayout();while(node!=null){var r,c;if(ss.getAttribute("layoutMode")){var cell=getCellByRowCol2(node.getAttribute("r"),node.getAttribute("c"));r=getRowFromCell(cell);c=getColFromCell(cell)}else{r=ss.getRowByKey(node.getAttribute("r"),-1);c=ss.getColByKey(node.getAttribute("c"),-1)}if(r>-1&&c>-1)if(node.tagName.toLowerCase()=="t"){var old=ss.GetValue(r,c);if(xmlData.textContent(node)!=old){var f=ss.GetFormula(r,c),cl=ss.GetCellByRowCol(r,c);ss.setCellValueFromView(cl,xmlData.textContent(node),true);cl.setAttribute("FpFormula",f)}}else node.tagName.toLowerCase()=="s"&&SPLController.updateSparkline(r,c,xmlData.textContent(node));node=xmlData.nextElementSibling(node)}ss.clearCellData();var view=getViewport().parentNode,scrollTop=view.scrollTop;ss.ResumeLayout(true);if(view.scrollTop!=scrollTop)view.scrollTop=scrollTop;spreadView.IsLoadOnDemand&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();processDataCompletedManually=true}else{ignorePostbackEditmode=true;element.preventPopUp=true;element._processingFilterBarCommand=targetId!=null&&targetId.indexOf(",fb")==targetId.length-3;var _this=this;spreadView._DisableSpreadValidators();updateSpread(doc,buff,target,cmd,function(){if(processDataCompletedHandlers.length>0){for(var a=0;a<processDataCompletedHandlers.length;a++)processDataCompletedHandlers[a].call(_this);processDataCompletedHandlers=[]}else processDataCompletedManually=true});element._processingFilterBarCommand=false;ignorePostbackEditmode=false}if(form!=null&&!element.isMVCSpread()){form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value=""}var inMvcFramework=mvc.inMvcFramework(),old=doc.getElementById("__VIEWSTATE"),t=getElementById(buff,"__VIEWSTATE");if(t!=null){if(old!=null)old.value=t.value;if(inMvcFramework){var viewstate=doc.getElementById(ts.id+"__VIEWSTATE");if(viewstate!=null)viewstate.value=t.value}}old=doc.getElementById("__EVENTVALIDATION");t=getElementById(buff,"__EVENTVALIDATION");if(t!=null){if(old!=null)old.value=t.value;if(inMvcFramework){var validation=doc.getElementById(ts.id+"__EVENTVALIDATION");if(validation!=null)validation.value=t.value}}processDataCompletedHandlers.push(function(){buff.innerHTML="";window.fpPostOn=null;dataBuff=null})}finally{req.onreadystatechange=null;$$.j(req).off("load",processData);req=null}processDataCompletedHandlers.push(function(){onStop&&onStop()});ts!=null&&ts.fireCallBackStoppedEvent(cmd,element);var newElement=window.document.getElementById(element.id);if(newElement!=null){var newSpreadView=newElement.getSpreadView?newElement.getSpreadView():null;if(newSpreadView!=null&&newSpreadView.IsInitialized){newSpreadView.OnSpreadCallbackStopped(targetId);if(cmd!="LoadOnDemand"){var activeSpread=element.document.FpActiveSpread;if(activeSpread==null||activeSpread.offsetParent==null)activeSpread=newElement;(activeSpread.id==element.id||getTopSpread(newElement)==getTopSpread(activeSpread))&&activeSpread.getAnchorCell&&activeSpread.getEditor(activeSpread.getAnchorCell())==null&&activeSpread.fpSpreadJS.setImeMode(activeSpread,newSpreadView.GetFocusTextBox(),activeSpread.getAnchorCell(),true)}}else newElement.__pendingCallbakStoppedTargetId=targetId}cmd!="LoadOnDemand"&&!spreadView.IsMultiColumnComboBox&&processDataCompletedHandlers.push(function(){var a=element.document.getElementById(element.id);if(a!=null)a.getSpreadView().GetTopSpreadView().RetrieveFilterBarMenus();else ts!=null&&ts.getSpreadView().RetrieveFilterBarMenus()});if(processDataCompletedManually)for(var i=0;i<processDataCompletedHandlers.length;i++)processDataCompletedHandlers[i].call(this)}if($$.browser.ie)req.onreadystatechange=processData;else $$.j(req).on("load",processData);req.send(data);if(cmd!=null&&cmd.indexOf("SelectView,")==0){var scrollTop=getViewport().parentNode.scrollTop;element.focus();GetActiveChart()!=null&&scrollTop!=getViewport().parentNode.scrollTop&&scrollView()}}function getStyle(a,b){if(a.rules)for(j=0;j<a.rules.length;j++)if(a.rules[j].selectorText==b)return a.rules[j];return null}function updateStyles(g,k){var b=k.getElementsByTagName("style");if(b!=null){var d=element.document;if(!d.createElement)d=window.document;var a=d.styleSheets[element.id+"_style"];if(a==null){a=d.createElement("style");a.id=element.id+"_style";d.body.appendChild(a)}a=d.styleSheets[element.id+"_style"];if(a!=null){for(var f="",c=0;c<b.length;c++)if(b[c]!=null&&b[c].innerHTML!=null&&b[c].innerHTML!="")for(var i=b[c].sheet||b[c].styleSheet,h=0;h<i.rules.length;h++){var e=i.rules[h],j=getStyle(a,e.selectorText);if(j!=null)j.style.cssText=e.style.cssText;else if((g.getViewport1()==null||e.selectorText.indexOf(g.getViewport1().id)<0)&&(g.getViewport0()==null||e.selectorText.indexOf(g.getViewport0().id)<0))f+=e.selectorText+"{"+e.style.cssText+"}"}if(a.cssText!=null&&a.cssText.length>0)f=a.cssText+f;if(f.length>0)a.cssText=f}}}function updateSpread(C,k,R,q,r){var a=getTopSpread(C.getElementById(R)),m=spreadView.GetTopSpreadView();a.updating=true;a.isSizeSpread=false;a.ignoreSizeSpread=false;if(spreadView.IsLoadOnDemand)_keepCurrentScrollValue=-1;var d=getElementById(k,a.id);if(d!=null){var c=q=="LoadOnDemand",f=d.getAttribute("error")=="true";if(spreadView.IsInTouchMode()&&(!c||spreadView.LoadOnDemandMode!="Background"||f))m.Spread.isInTouchMode=true;if(typeof Sys!="undefined"&&typeof $get!="undefined"){FarPoint.System.ExtenderHelper.saveLoadedExtenderScripts(a,q,f);FarPoint.System.ExtenderHelper.processCss(k)}else spreadView.LoadCss(k);(!c||!smartPaint&&spreadView.LoadOnDemandMode!="Background")&&a.Behavior.dispose();a.isMVCSpread()&&!c&&!f&&spreadView.ClearFilterHiddenValueFields();(!c||f)&&spreadView.RemoveMenus(f);var Q=c&&spreadView.LoadOnDemandMode=="Background"&&!f;!Q&&(!smartPaint||!c||spreadView.LoadOnDemandMode=="Background")&&m.__Dispose(q,true,f);element.LoadState=null;var s=false,F=false,u=0,K,B;if(c&&!f){if(!$$.utils.contains(window.document.body,element)&&spreadView.LoadOnDemandMode=="Background"){spreadView._StopLoadOnDemandTimer();return}var M=C.getElementById(a.id+"_data"),L=getElementById(k,a.id+"_data");M!=null&&L!=null&&M.setAttribute("data",L.getAttribute("data"));var I=C.getElementById(a.id+"_LoadInfo"),H=getElementById(k,a.id+"_LoadInfo");if(I!=null&&H!=null)I.value=H.value;msgStyle=null;m._UpdateCssStyles(d);m._UpdateCssImports(d);var z=a.GetRowCount()-1,i=Number.MAX_VALUE,n=false,j=getElementById(d,a.id+"_rowHeader"),t=[],J=GetColCount();if(j!=null){j=xmlData.firstElementChild(j);i=Math.min(i,j.rows.length);n=j.rows.length>1;var w=a.getRowHeader();if(w!=null)u=w.rows.length;var E=updateLastDisplayedColumnAttribute(j,w);if(E)s=true;loadRows(w,j,true);u==0&&syncBorders()}var b=getElementById(d,a.id+"_viewport2");if(b!=null){i=Math.min(i,b.rows.length);n=b.rows.length>0;var g=a.getViewport2();J>0&&(g.rows.length>0||b.rows.length>0)&&t.push(2);if(g!=null)K=g.rows.length;var E=updateLastDisplayedColumnAttribute(b,g);if(E)s=true;loadRows(g,b,false)}b=getElementById(d,a.id+"_viewport");if(b!=null){i=Math.min(i,b.rows.length);n=b.rows.length>0;var g=a.getViewport();J>0&&(g.rows.length>0||b.rows.length>0)&&t.push(-1);B=g.rows.length;var E=updateLastDisplayedColumnAttribute(b,g);if(E)s=true;loadRows(g,b,false)}spreadView.LoadOnDemandMode=="Background"&&spreadView.CDF_OnLoadRowStop();if(n)for(var y=[viewport,viewport2],e=0;e<y.length;e++)if(y[e])y[e].style.display="";if(smartPaint){rowCount+=b.rows.length;element.RowCount=parseInt(element.RowCount)+b.rows.length;showRows(Math.max(0,current+currentCount),i,true);currentCount=getRowsPerPage(current);syncRowRangeSafeMode(current+currentCount,GetRowCountInternal()-1,false);sizeSpread(true);if(editing&&element.__scrollByEditing){editing=false;element.__scrollByEditing=null;restartEditing(anchorCell)}}else if(n&&z>0){syncRowRangeSafeMode(z,z);sizeSpread(true)}for(var e=0;e<t.length;e++)spreadView._RemoveNoRow(t[e]);if(n)element.LoadState=null;else element.LoadState="complete";F=true}else{var o=element.document||window.document,A=o.getElementById(element.id+"_style");A&&A.parentNode.removeChild(A);var x=element.document.activeElement;$$.browser.ieversion>10&&x!=textBox&&$$.utils.isTextControl(x)&&$$.utils.contains(element,x)&&setTextBoxFocus();if(spreadView.GetLastMouseDownEvent())lastTextBoxPosition={left:textBox.style.left,top:textBox.style.top};a.valid=true;FarPoint.Web.Spread.CallBacks.topic(a.id).topic("Dispose").publish(a);$$(a).copyInnerHTML(d);spreadView._CleanValidators();m._UpdateCssStyles(d);m._UpdateCssImports(d);!$$.browser.ie&&waitAllImageLoaded()}a.removeAttribute("childViewsLoaded");copySpreadAttrs(d,a);$$.browser.quirksMode&&autoFitTextBoxEditors(a);error=f;if($$.browser.chrome&&c&&a.getAttribute("AllRowsLoaded")=="true"){var v=[getViewport().parentNode];getViewport2()&&v.push(getViewport2().parentNode);getScrollvp()&&v.push(getScrollvp());for(var e=0;e<v.length;e++){var P=v[e],S=P.id+"_loadondemand",O=element.document.getElementById(S);O&&P.removeChild(O)}}typeof Sys!="undefined"&&typeof $get!="undefined"&&FarPoint.System.ExtenderHelper.loadExtenderScripts(a,k,function(){if(_delayFocus){anchorCell!=null&&spreadView.NeedSetEditorFocusOnActiveCell()&&element.setEditorFocus(getEditor(anchorCell));_delayFocus=false}});F&&fpSpreadJS.setImeMode(element,textBox,anchorCell);fpSpreadJS.loadNewScripts(k,null,function(){r!=null&&r();a.updating=false});if(c&&spreadView.LoadOnDemandMode=="Background"&&!error){var p=getScrollvp();if(p==null)p=getViewport().parentNode;spreadView._MakeSureTempScrollableTo(p.scrollTop)}var N=null;if(c){N=[getCorner(),getFrozColHeader(),getColHeader(),getFrozRowHeader(),getViewport0(),getViewport1(),getRowHeader(),getViewport2(),getViewport(),getFooterCorner(),getFrozColFooter(),getColFooter()];$$.utils.cleanArray(N)}if(c&&spreadView.LoadOnDemandMode=="Background"&&!error){updateTabIndex();if(!smartPaint){element.RowCount=parseInt(element.RowCount)+b.rows.length;rowCount+=b.rows.length}else{current=spreadView._GetTopDisplayedTableRowIndex(false);currentCount=spreadView._GetBottomDisplayedTableRowIndex(false)-current+1}spanCells=[];rowSpanCells=[];initSpan(getViewport0(),spanCells);initSpan(getViewport1(),spanCells);initSpan(getViewport2(),spanCells);initSpan(getViewport(),spanCells);initSpan(getFrozRowHeader(),rowSpanCells);initSpan(getRowHeader(),rowSpanCells);if(s){fixMissedColumns();sizeSpread(false,true)}else{var h=K;if(h==null||h>B)h=B;if(h==null||h>u)h=u;h!=null&&syncRowRangeSafeMode(frzRows+h,GetRowCountInternal()-1);spreadView.RelayoutViewport()}if(retainSelectionBlock||spreadView.IsSpreadActive()){paintSelections(true,true);paintAnchorCell(true,true)}var p=getScrollvp();if(p==null)p=getViewport().parentNode;spreadView._MakeSureScrollableTo(p.scrollTop)}else if(!smartPaint||!c||spreadView.LoadOnDemandMode=="Background"){a.preventScrollView=true;a.Behavior.init(q,null,c);a.preventScrollView=false;a.fireAutoFilterColumnCompleted(q)}!c&&element.document.FpActiveSpread===element&&a.focus()}else{error=true;var D=element.errorPage;if(D!=null&&D.length>0){var o=element.document;if(!o.createElement)o=window.document;var l=o.createElement("a");l.style.display="none";$$.j(l).on("click",G);l.href=D;o.body.appendChild(l);l.click();$$.j(l).off("click",G);o.body.removeChild(l);function G(a){a.cancelBubble=true}}a.updating=false;fpSpreadJS.setImeMode(element,textBox,anchorCell);r!=null&&r()}}function waitAllImageLoaded(){var c=spreadView.GetTopSpreadView(),a=c?c.Spread:null;if(!a||a!=element)return;a.imgPendingLoad=b(element,d);function b(g,d){for(var b=g.getElementsByTagName("img"),e=imgCount=b?b.length:0,c=0;c<imgCount;c++){var a=b[c],f=getSpreadControl(a)?window.document.getElementById(getSpreadControl(a).id+"_rowHeader"):null;if(a.getAttribute("src")==null||a.getAttribute("src")==""||a.width!=0&&a.height!=0||!$$.utils.contains(f,a,true))e--;else if(d)a.onload=d}return e}function d(){var a=getSpreadControl(this);if(!a)return;while(a!=null){if(a.imgPendingLoad==null)a.imgPendingLoad=b(a)+1;a.imgPendingLoad--;a.imgPendingLoad==0&&a.getSpreadView&&a.getSpreadView().IsLayoutInitialized&&a.getSpreadView().IsLayoutInitialized()&&a.sizeSpread(null,true,{IgnoreLayoutParent:true});a=a.getParentSpread&&a.getParentSpread()}this.onload=null}}function autoFitTextBoxEditors(d){var b=d.getElementsByTagName("INPUT");if(b!=null)for(var c=0;c<b.length;c++){var a=b[c];if(a.type=="text"&&a.parentElement.tagName=="TD"&&a.getAttribute("FpEditor")=="TextBox"&&a.parentElement.parentElement.getAttribute("FpKey")!=null&&a.parentElement.getAttribute("FpCellType")==null)a.style.width=a.parentElement.clientWidth}}function updateLastDisplayedColumnAttribute(b,a){if(b==null||b.rows.length==0)return;var d=b.getAttribute("LastDisplayedColumn"),c=a.getAttribute("LastDisplayedColumn");if(d!=null&&(c==null||parseInt(d)>parseInt(c))){c!=null&&restoreTableWidth(a);a.setAttribute("LastDisplayedColumn",d);return true}return false}function importRows(e,g,i,d,c){if(g<0)return;var h=c.rows.length==0,a=0;if(e!=null){var k=e.rows.length;for(a=0;a<i;a++){var f=g+a;d.setAt(f,fpCloneNode(e.rows[a]));d.getRow(f).viewport=c;if(!h){var b=d.getRow(f).cloneNode();c.tBodies[0].insertBefore(b,null);var j=b.insertCell();j.style.borderColor="transparent";b.style.borderColor="transparent";b.rowHolder=1}}}}function loadRows(b,a,h){if(b==null||a==null)return;var j=b.rows.length==0;if(smartPaint)if(h)importRows(a,rhList.table.rows.length,a.rows.length-1,rhList,b);else if(b==element.getViewport())importRows(a,vpList.table.rows.length,a.rows.length,vpList,b);else importRows(a,vp2List.table.rows.length,a.rows.length,vp2List,b);if(!smartPaint||j){var e=null;if(b.tBodies.length==0){e=document.createElement("tbody");b.appendChild(e)}else e=b.tBodies[0];for(var l=a.rows.length,d=0;d<l;d++){var k=fpCloneNode(a.rows[d]);e.insertBefore(k,null)}}if(!h)for(var i=b.parentNode,d=0;d<a.parentNode.children.length;d++){var c=a.parentNode.children[d];if(c!=a)if(c.id=="")i.insertBefore(fpCloneNode(c),null);else{var f=document.getElementById(c.id);if(f==null)i.insertBefore(fpCloneNode(c),null);else if(f.id.indexOf(element.id+"_ValidatorHold")!=-1)for(var g=0;g<c.children.length;g++)f.insertBefore(fpCloneNode(c.children[g]),null)}}}function copySpreadAttr(c,b,a){if(c.getAttribute(a)!=null)b.setAttribute(a,c.getAttribute(a));else b.removeAttribute(a)}function copySpreadAttrs(b,a){copySpreadAttr(b,a,"selectionBlockOptions");if(b.getAttribute("RetainSelectionBlock")&&b.getAttribute("RetainSelectionBlock")=="false"){a.setAttribute("RetainSelectionBlock","false");retainSelectionBlock=false}else{a.setAttribute("RetainSelectionBlock","true");retainSelectionBlock=true}copySpreadAttr(b,a,"AllRowsLoaded");copySpreadAttr(b,a,"totalRowCount");copySpreadAttr(b,a,"pageCount");copySpreadAttr(b,a,"clipboard");copySpreadAttr(b,a,"allowSort");copySpreadAttr(b,a,"loadOnDemand");copySpreadAttr(b,a,"loadOnDemandInterval");copySpreadAttr(b,a,"loadOnDemandMode");copySpreadAttr(b,a,"loadOffsetFromBottom");copySpreadAttr(b,a,"colMove");copySpreadAttr(b,a,"allowGroup");copySpreadAttr(b,a,"sizeHeader");copySpreadAttr(b,a,"showFocusRect");copySpreadAttr(b,a,"FocusBorderColor");copySpreadAttr(b,a,"FocusBorderStyle");copySpreadAttr(b,a,"FpDefaultEditorID");copySpreadAttr(b,a,"hierView");copySpreadAttr(b,a,"IsNewRow");copySpreadAttr(b,a,"cmdTop");copySpreadAttr(b,a,"ProcessTab");copySpreadAttr(b,a,"AcceptFormula");copySpreadAttr(b,a,"EditMode");copySpreadAttr(b,a,"AllowInsert");copySpreadAttr(b,a,"AllowDelete");copySpreadAttr(b,a,"error");copySpreadAttr(b,a,"ajax");copySpreadAttr(b,a,"autoCalc");copySpreadAttr(b,a,"multiRange");copySpreadAttr(b,a,"rowFilter");copySpreadAttr(b,a,"OperationMode");copySpreadAttr(b,a,"selectedForeColor");copySpreadAttr(b,a,"selectedBackColor");copySpreadAttr(b,a,"anchorBackColor");copySpreadAttr(b,a,"tabIndex");copySpreadAttr(b,a,"EnableRowEditTemplate");copySpreadAttr(b,a,"isFiltering");copySpreadAttr(b,a,"isFilteringCancel");copySpreadAttr(b,a,"FilteringString");copySpreadAttr(b,a,"FilteringCol");copySpreadAttr(b,a,"scrollContent");copySpreadAttr(b,a,"scrollContentColumns");copySpreadAttr(b,a,"scrollContentTime");copySpreadAttr(b,a,"scrollContentMaxHeight");copySpreadAttr(b,a,"SelectionPolicy");copySpreadAttr(b,a,"selectionUnit");copySpreadAttr(b,a,"ShowHeaderSelection");copySpreadAttr(b,a,"currentPageIndex");copySpreadAttr(b,a,"virtualPaging");copySpreadAttr(b,a,"semiTransparentSelectedBackColor");copySpreadAttr(b,a,"layoutMode");copySpreadAttr(b,a,"layoutRowCount");if(a.getAttribute("ClientAutoSize")!="True"&&a.style!=null&&b.style!=null){if(a.style.width!=b.style.width)a.style.width=b.style.width;if(a.style.border!=b.style.border)a.style.border=b.style.border;if(a.style.height!=b.style.height)a.style.height=b.style.height}if(b.getAttribute("expandedRowKeys")!=null&&b.getAttribute("expandedRowKeys")!="")a.setAttribute("expandedRowKeys",b.getAttribute("expandedRowKeys"));else a.removeAttribute("expandedRowKeys");$$(a).copyHiddenColumnAttrs(b);var e=b.getAttribute("chartConerImg");if(e!=null&&e.length>0)a.setAttribute("chartConerImg",e);else a.removeAttribute("chartConerImg");var d=b.getAttribute("chartTouchCornerImg");if(d!=null&&d.length>0)a.setAttribute("chartTouchCornerImg",d);else a.removeAttribute("chartTouchCornerImg");if(b.getAttribute("rowsToBeLoaded")!=null&&b.getAttribute("rowsToBeLoaded")!="")a.setAttribute("rowsToBeLoaded",b.getAttribute("rowsToBeLoaded"));else a.removeAttribute("rowsToBeLoaded");if(b.getAttribute("scrollToTopRow")!=null&&b.getAttribute("scrollToTopRow")!="")a.setAttribute("scrollToTopRow",b.getAttribute("scrollToTopRow"));else a.removeAttribute("scrollToTopRow");if(b.getAttribute("topRow")!=null&&b.getAttribute("topRow")!="")a.setAttribute("topRow",b.getAttribute("topRow"));else a.removeAttribute("topRow");var c=b.getAttribute("spreadcontextmenucss");c!=null&&c!=""&&a.setAttribute("spreadcontextmenucss",c);c=b.getAttribute("touchInfo");c!=null&&c!=""&&a.setAttribute("touchInfo",c);c=b.getAttribute("DisableNonEditModeValidation");if(c!=null&&c!="")a.setAttribute("DisableNonEditModeValidation",c);else a.removeAttribute("DisableNonEditModeValidation");c=b.getAttribute("useDefaultSelectionBackColor");if(c!=null&&c!="")a.setAttribute("useDefaultSelectionBackColor",c);else a.removeAttribute("useDefaultSelectionBackColor")}function canCollectInput(a){if(a.tagName=="input"){var b=a.type;return(b=="hidden"||b=="text"||b=="password"||(b=="checkbox"&&!element.inDesign||b=="radio")&&a.checked)&&!a.isInvalid}else if(a.tagName!="select")return false}function collectData(t,g,s){var n=mvc.inMvcFramework(),e=null,a,d,c="fpcallback=true&";if(n){e=getTopSpread(element);var r=e.getElementsByTagName("input"),q=e.getElementsByTagName("select"),o=e.getElementsByTagName("textarea");d=[];for(var b=0,j=r.length;b<j;b++){var i=r[b];if(s)i.type=="hidden"&&d.push(i);else d.push(i)}for(var b=0,j=q.length;b<j;b++)d.push(q[b]);for(var b=0,j=o.length;b<j;b++)d.push(o[b])}else d=getForm().elements;for(var b=0;b<d.length;b++){a=d[b];if(g=="RetrieveFilterBarMenus"&&$$.utils.contains(element,a)||g=="LoadOnDemand"&&spreadView.IsBackgroundMode&&editing&&(editor==a||$$.utils.contains(editor,a)&&element.document.activeElement==a))continue;var h=a.tagName.toLowerCase();if(h=="input"){var f=a.type;if((f=="hidden"||f=="text"||f=="password"||(f=="checkbox"&&!element.inDesign||f=="radio")&&a.checked)&&!a.isInvalid)c+=a.name+"="+encodeURIComponent(a.value)+"&"}else if(h=="select")for(var l=0;l<a.children.length;l++){var k=a.children[l];if(k.tagName.toLowerCase()=="option"&&k.selected)c+=a.name+"="+encodeURIComponent(k.value)+"&"}else if(h=="textarea")c+=a.name+"="+encodeURIComponent(a.value)+"&"}if(n){var p=element.document.getElementById(e.id+"__VIEWSTATE");if(p!=null)c+="__VIEWSTATE="+encodeURIComponent(p.value)+"&";c+="__EVENTTARGET="+encodeURI(t)+"&";if(g!=null)c+="__EVENTARGUMENT="+encodeURIComponent(encodeURIComponent(g))+"&";var m=element.document.getElementById(e.id+"__EVENTVALIDATION");if(m!=null)c+="__EVENTVALIDATION="+encodeURIComponent(m.value)+"&";c+="__FPSPREAD="+encodeURI(e.id)+"&"}return c}function collectLightData(h,g){if(mvc.inMvcFramework())return collectData(h,g,true);for(var c=getForm(),a,d="fpcallback=true&",b=0;b<c.elements.length;b++){a=c.elements[b];var e=a.tagName.toLowerCase();if(e=="input"){var f=a.type;if(f=="hidden")d+=a.name+"="+encodeURIComponent(a.value)+"&"}}return d}function ShowMessage(e,a,b,d){var c=GetRowCountInternal(),f=GetColCount();if(a==null||b==null||a<0||a>=c||a>=c||b<0||b>=f){a=-1;b=-1}showMessageInner(e,a,b,d)}function HideMessage(b,a){var e=GetRowCountInternal(),d=GetColCount();if(b==null||a==null||b<0||b>=e||a<0||a>=d)msgList&&msgList.centerMsg&&msgList.centerMsg.msgBox.IsVisible&&msgList.centerMsg.msgBox.Hide();var c=getMsgObj(b,a);c&&c.msgBox.IsVisible&&c.msgBox.Hide()}function showMessageInner(f,e,d,b){var a=getMsgObj(e,d);if(a)a.timer&&a.msgBox.Hide();else a=createMsgObj(e,d);var c=a.msgBox;c.Show(f);if(b&&b>0)a.timer=setTimeout(function(){c.Hide();displayingVirtualScrollingContent=null},b);setMsgObj(a)}function getMsgObj(b,c){var a;if(msgList)if(b==-1&&c==-1)a=msgList.centerMsg;else if(b==-2)a=msgList.hScrollMsg;else if(c==-2)a=msgList.vScrollMsg;else if(msgList[b])a=msgList[b][c];return a}function setMsgObj(a){if(!msgList)msgList=[];if(a.row==-1&&a.col==-1)msgList.centerMsg=a;else if(a.row==-2)msgList.hScrollMsg=a;else if(a.col==-2)msgList.vScrollMsg=a;else{if(!msgList[a.row])msgList[a.row]=[];msgList[a.row][a.col]=a}}var scStyle=null;function createMsgObj(f,e){var c=element.document;if(!c.createElement)c=window.document;var a=c.createElement("div"),d={row:f,col:e,msgBox:a},b=null;if(f!=-2&&e!=-2){a.style.border="1px solid black";a.style.background="yellow";a.style.color="red";getMsgStyle();b=msgStyle}else{a.style.border="1px solid #55678e";a.style.fontSize="small";a.style.background="#E6E9ED";a.style.color="#4c5b7f";getScrollingContentStyle();b=scStyle}if(b!=null){if(b.fontFamily!=null)a.style.fontFamily=b.fontFamily;if(b.fontSize!=null)a.style.fontSize=b.fontSize;if(b.fontStyle!=null)a.style.fontStyle=b.fontStyle;if(b.fontVariant!=null)a.style.fontVariant=b.fontVariant;if(b.fontWeight!=null)a.style.fontWeight=b.fontWeight;if(b.backgroundColor!=null)a.style.backgroundColor=b.backgroundColor;if(b.color!=null)a.style.color=b.color}a.style.position="absolute";a.style.display="block";a.style.overflow="hidden";a.style.marginLeft=0;a.style.marginTop=2;a.style.marginRight=0;a.style.marginBottom=0;a.msgObj=d;a.Show=function(o){var f=getTopSpread(element);this.style.visibility="visible";this.style.display="block";if(o){this.style.left=0+"px";this.style.top=0+"px";this.style.width="auto";this.innerHTML=o}var s=!$$.browser.quirksMode,b=getMsgPos(this.msgObj.row,this.msgObj.col);if(this.msgObj.row>=0&&this.msgObj.col>=0){var d=getViewPortByRowCol(this.msgObj.row,this.msgObj.col);!this.parentElement&&d!=null&&d.vh&&d.vh.parentElement.insertBefore(a,null);var i=this.msgObj.row>=0&&this.msgObj.col>=0?GetCellByRowCol(this.msgObj.row,this.msgObj.col):null;if(i){var k=i.getBoundingClientRect();$$(this).moveToPosition(k.left,k.top+i.offsetHeight+1);b.top=parseInt(this.style.top);b.left=parseInt(this.style.left)}var j=this.offsetWidth;this.style.left=b.left+"px";if(d&&d.vh&&b.left+j>d.vh.offsetWidth)this.style.width=b.cellWidth-2+"px";else if(this.style.width!=j)this.style.width=j-(s?2:0)+"px";if(d!=null&&b.top>=parseInt(d.vh.clientHeight-2))b.top=b.top-b.cellHeight-this.clientHeight-3>0?b.top-b.cellHeight-this.clientHeight-3:0;this.style.top=b.top+"px"}else{var g=20,l=$element.css("position"),r=l=="relative"||l=="absolute";f.insertBefore(a,null);var e=b.top,h=b.left,c=element.offsetParent;while((c.tagName=="TD"||c.tagName=="TR"||c.tagName=="TBODY"||c.tagName=="TABLE")&&c.style.position!="relative"&&c.style.position!="absolute")c=c.offsetParent;if(!r&&c){var m=getLocation(element);e+=m.y;h+=m.x;if(c.tagName!="BODY"){var n=getLocation(c);e-=n.y+getBorderWidth(c,0);h-=n.x+getBorderWidth(c,3)}}if(this.offsetWidth+g<f.offsetWidth)h+=(f.offsetWidth-this.offsetWidth-g)/(this.msgObj.row==-2?1:2);else this.style.width=f.offsetWidth-g+"px";if(this.offsetHeight<f.offsetHeight)e+=(f.offsetHeight-this.offsetHeight)/(this.msgObj.col==-2?1:2);if(this.msgObj.col==-2){var q=getColFooter();if(q)e-=q.offsetHeight;var p=getCommandBar();if(p)e-=p.offsetHeight;e-=g}this.style.top=e+"px";this.style.left=h+"px"}this.IsVisible=true};a.Hide=function(){this.style.visibility="hidden";this.style.display="none";this.IsVisible=false;if(this.msgObj.timer){clearTimeout(this.msgObj.timer);this.msgObj.timer=null}this.innerHTML=""};return d}function getLocation(a){if(a.self||a.nodeType===9)return{x:0,y:0};var c=a.getBoundingClientRect();if(!c)return{x:0,y:0};var b=a.ownerDocument,e=b.documentElement,f=c.left-2+(e.scrollLeft||b.body.scrollLeft),g=c.top-2+(e.scrollTop||b.body.scrollTop);try{var d=a.ownerDocument.parentWindow?a.ownerDocument.parentWindow.frameElement:null;if(d){var h=d.frameBorder==="0"||d.frameBorder==="no"?2:0;f+=h;g+=h}}catch(i){$$.DEBUG.Log(i,"getLocation")}return{x:f,y:g}}var _borderWidthNames=["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],_borderStyleNames=["borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle"],_borderThicknesses;function getBorderWidth(b,a){if(!getBorderVisible(b,a))return 0;var c=getCurrentStyle(b,_borderWidthNames[a]);return parseBorderWidth(c)}function getBorderVisible(b,a){return getCurrentStyle(b,_borderStyleNames[a])!="none"}function getCurrentStyle(d,c,b){var a=$$.j(d).css(c);if(!a||a==""||typeof a==="undefined")if(typeof b!="undefined")a=b;else a=null;return a}function parseBorderWidth(e){if(!_borderThicknesses){var d=window.document,c={},a=d.createElement("div");a.style.visibility="hidden";a.style.position="absolute";a.style.fontSize="1px";d.body.appendChild(a);var b=d.createElement("div");b.style.height="0px";b.style.overflow="hidden";a.appendChild(b);var f=a.offsetHeight;b.style.borderTop="solid black";b.style.borderTopWidth="thin";c.thin=a.offsetHeight-f;b.style.borderTopWidth="medium";c.medium=a.offsetHeight-f;b.style.borderTopWidth="thick";c.thick=a.offsetHeight-f;a.removeChild(b);d.body.removeChild(a);_borderThicknesses=c}if(e){switch(e){case"thin":case"medium":case"thick":return _borderThicknesses[e];case"inherit":return 0}var g=parseUnit(e);if(g.type!="px")throw new Error;return g.size}return 0}function parseUnit(a){if(!a)throw new Error;a=trim(a).toLowerCase();for(var g=a.length,c=-1,f=0;f<g;f++){var b=a.substr(f,1);if((b<"0"||b>"9")&&b!="-"&&b!="."&&b!=",")break;c=f}if(c==-1)throw new Error;var e,d;if(c<g-1)e=trim(a.substring(c+1));else e="px";d=parseFloat(a.substr(0,c+1));if(e=="px")d=Math.floor(d);return{size:d,type:e}}function getMsgPos(c,b){var f=getTopSpread(element);if(c<0||b<0)return{left:0,top:0};else{var a=GetCellByRowCol(c,b),e=a.offsetTop+a.clientHeight,d=a.offsetLeft;return{left:d,top:e,cellHeight:a.clientHeight,cellWidth:a.clientWidth}}}function getViewPortByRowCol(e,d){var b=GetCellByRowCol(e,d),a=null,c=false;if(isChild(b,getViewport()))a=getViewport();else if(isChild(b,getViewport2()))a=getViewport2();else if(isChild(b,getViewport1())){a=getViewport1();c=true}else if(isChild(b,getViewport0())){a=getViewport0();c=true}return{vh:a,frozen:c}}function syncMsgs(){if(!msgList)return;for(i in msgList)if(msgList[i].constructor==Array)for(j in msgList[i])msgList[i][j]&&msgList[i][j].msgBox&&msgList[i][j].msgBox.IsVisible&&msgList[i][j].msgBox.Show()}function TableBuff(c,b){this.table=c.document.createElement("table");this.table.insertRow();this.table.deleteRow(0);if(b!=null){var a=getColGroup(b);a!=null&&a.childNodes.length>0&&this.table.appendChild(a.cloneNode(true))}this.setAt=function(a,b){var c=this.table.tBodies[0];if(a==this.table.rows.length){c.insertBefore(b,null);return}var d=this.table.rows[a];c.insertBefore(b,d);this.table.deleteRow(a+1)};this.getRow=function(a){return this.table.rows[a]}}function initSmartPaint(){if(spreadView!=null&&!spreadView.OnSpreadInitSmartPaint())return;element.setAttribute("scrollContentTime",500);var c=element.getViewport(),a=c.rows.length;saveRows(0,a);removeRows(0,a);var b=getRowsPerPage(0);showPage(0,b)}var inshowPage=false;function showPage(a,g,i){if(current==a&&g==currentCount)return;var e=editing&&editModePermanent;if(e&&!i){var j=spreadView.TryStopEditing();if(!j)return}var h=vpList.table.rows.length,b=Math.min(g,h-a);if(b<=0)return;inshowPage=true;var f=spreadView.GetTopSpreadView().Spread.GetActiveChartObj()!=null;if(!f){ignorePaintSelection=true;paintSelections(false);ignorePaintSelection=false}if(current<a&&a<current+currentCount){saveRows(current,a-current);removeRows(current,a-current);if(current+currentCount>a+b){saveRows(a+b,current+currentCount-a-b);removeRows(a+b,current+currentCount-a-b)}else showRows(current+currentCount,a+b-current-currentCount)}else if(a<current&&current<a+b){showRows(a,current-a);if(current+currentCount>a+b){saveRows(a+b,current+currentCount-a-b);removeRows(a+b,current+currentCount-a-b)}else showRows(current+currentCount,a+b-current-currentCount)}else{if(current>=0&&currentCount>0){saveRows(current,currentCount);removeRows(current,currentCount)}showRows(a,b)}current=a;currentCount=b;var c=getViewport();$$.browser.ieversion>=11&&(c.offsetWidth==0||c.offsetHeight==0)&&spreadView.RefreshLayout();(c.offsetWidth!=0&&c.offsetHeight!=0||$$.browser.ieversion==10)&&spreadView._UpdateDummyHeight();if(!checkValidAnchorCell())anchorCell=findAnchorCell();if(!f){ignorePaintSelection=true;var d=!forcePaintAnchorCell&&element.document.FpActiveSpread==null&&retainSelectionBlock;if(d)forcePaintAnchorCell=true;paintSelections(spreadView.IsSpreadActive()||retainSelectionBlock);if(d)forcePaintAnchorCell=false;ignorePaintSelection=false}inshowPage=false;e&&!editing&&anchorCell!=null&&anchorCell.offsetParent!=null&&spreadView.ProcessEditModePermanent()}function isInShowPage(){return inshowPage}function showRows(a,b,c){var d=element.getViewport(),e=element.getViewport2(),f=element.getRowHeader();d!=null&&showRowsImp(d,a,b,vpList,c);e!=null&&showRowsImp(e,a,b,vp2List,c);f!=null&&showRowsImp(f,a,b,rhList,c);spreadView&&b>0&&a+b-1>spreadView.LastCheckedCDFRow&&spreadView._getCDFs(spreadView.LastCheckedCDFRow+1,a+b-1);setResizingFlag(true);for(r=0;r<b;r++){if(a+r>=d.rows.length)break;EnsureRowHeight(a+r)}setResizingFlag(false);if(spreadView){spreadView.RepaintCDFs(a,a+b);spreadView.IsInTouchMode()&&(spreadView.IsRetainSelection()||spreadView.GetActiveSpread()==element)&&spreadView.ShowFocusRectangle()}if(!checkValidAnchorCell())anchorCell=findAnchorCell()}function checkValidAnchorCell(){if(!spreadView.IsInTouchMode())return false;if($$.utils.contains(element,anchorCell))return true;var i=getXmlActiveRow(),h=getXmlActiveCol();if(i!=-1&&h!=-1){var k=getRowByKey(i),j=spreadView._GetRowIndexByViewIndex(k),c=spreadView._GetRow(j);if(c)for(var g=spreadView.IsRowLayoutMode?c.Owner.LayoutRows:[c],e=0;e<g.length;e++)for(var d=g[e],b=0;b<d.Cells.length;b++){var a=d.Cells[b];if(a!=null&&a.DataIndex==h){if($$.utils.contains(a.HtmlCell))spreadView.SetAnchorCell(a.HtmlCell,false,false);else{var f=getCellFromRowCol(GetSheetIndex(d.ViewIndex),b);spreadView.SetAnchorCell(f!=null?f:a,false,false)}return true}}}return false}function restartEditing(b){if(b==null)return;StartEdit(b);if(editor!=null){var a=getTextElement(editor);if(a!=null&&editor.__bkLength!=null){if(a.value.length>editor.__bkLength){var c=a.createTextRange();c.move("character",1);c.select()}editor.__bkLength=null}}}function fpCloneNode(b){for(var c=b.cloneNode(true),g=b.getElementsByTagName("select"),e=c.getElementsByTagName("select"),a=0;a<e.length;a++)e[a].selectedIndex=g[a].selectedIndex;for(var d=b.getElementsByTagName("INPUT"),f=c.getElementsByTagName("INPUT"),a=0;a<d.length;a++)if(d[a].type=="checkbox"){f[a].value=d[a].value;f[a].checked=d[a].checked}if(b.synDelt!=null)c.synDelt=b.synDelt;return c}function showRowsImp(c,a,d,i,h){if(a<0)return;if(a==0&&!h){a=1;d=d-1}for(var b=0,b=0;b<d;b++){if(a>=c.rows.length)break;c.deleteRow(a)}var e=[];for(b=0;b<d;b++){var g=null;if(a+b<c.rows.length)g=c.rows[a+b];var f=fpCloneNode(i.getRow(a+b));c.tBodies[0].insertBefore(f,g);e.push(f)}spreadView.OnSpreadAddRowToView(a,d,c,e)}function saveRows(b,c){if(b<0)return;var a=element.getViewport();saveRowsImp(a,b,c,vpList);a=element.getViewport2();saveRowsImp(a,b,c,vp2List);a=element.getRowHeader();saveRowsImp(a,b,c,rhList)}function saveRowsImp(b,c,f,e){if(c<0)return;var a=0;if(b!=null){var g=b.rows.length;for(a=0;c+a<g&&a<f;a++){var d=c+a;e.setAt(d,fpCloneNode(b.rows[d]));e.getRow(d).viewport=b}}}function removeRows(b,c){if(c==0)return;var a=element.getViewport(),f=0,e=a.rows.length;if(b==0){b=1;c=c-1}var d=Math.min(c,e-b);if(d<=0)return;removeRowsFromViewport(a,b,d,false,vpList);a=element.getViewport2();a!=null&&removeRowsFromViewport(a,b,d,false,vp2List);a=element.getRowHeader();a!=null&&removeRowsFromViewport(a,b,d,true,rhList)}function removeRowsFromViewport(a,c,f,g,h){for(var b=0,b=0;b<f;b++)a.deleteRow(c);var e=null;if(c<a.rows.length)e=a.rows[c];else if(g)e=a.rows[a.rows.length-1];for(b=0;b<f;b++){var d=h.getRow(c+b).cloneNode();a.tBodies[0].insertBefore(d,e);var i=d.insertCell();i.style.borderColor="transparent";d.style.borderColor="transparent";d.rowHolder=1}}function doUpdate(e){var a=newTop;while(a>0){var b=rhList.getRow(a),d=vpList.getRow(a),c=vp2List.getRow(a);if((b==null||b.cells.length==rowHeaders)&&(d==null||d.cells.length==GetColCount()-frzCols)&&(c==null||c.cells.length==frzCols))break;a--}var f=getRowsPerPage(a);showPage(a,f+newTop-a,e)}function getRowsPerPage(a){var f=GetRowCount(),c=0,e=0,d=0;while(e<getViewport().parentNode.clientHeight&&c<f){var b=0;if(vpList.getRow(a)!=null&&a<vpList.table.rows.length)b=getVisibleRowHeight(vpList,a+d);if(vp2List.getRow(a)!=null&&a<vp2List.table.rows.length)b=Math.max(b,getVisibleRowHeight(vp2List,a+d));if(rhList.getRow(a)!=null&&a<rhList.table.rows.length)b=Math.max(b,getVisibleRowHeight(rhList,a+d));e+=b;c++;d++}c=c+5;return Math.min(c,30)}function getVisibleRowHeight(g,f){var c=getScrollvp().scrollTop,a=0,e=g.getRow(f);if(e!=null)a=$$(e).height();var b=0,d=getViewport().rows[f];if(d!=null){b=d.offsetTop;a=$$(d).height()}return c>b&&c<b+a?a-c+b:c>=b+a?0:a}function setXMLNodeAttribute(a,c,b){if(a==null)return null;a.setAttribute(c,b);return b}function getCellInfo(e,d,c){var b=xmlData.selectSingleNode("cellinfo");if(b==null)return null;var a=xmlData.selectSingleNode("cellinfo c[r='"+e+"'][c='"+d+"'][pos='"+c+"']");return a}function addCellInfo(e,d,c){var a=getCellInfo(e,d,parseInt(c));if(a!=null)return a;var b=xmlData.selectSingleNode("cellinfo");if(b==null)return null;a=xmlData.createElement("c");setXMLNodeAttribute(a,"r",e);setXMLNodeAttribute(a,"c",d);setXMLNodeAttribute(a,"pos",c);b.appendChild(a);return a}function setCellAttribute(a,h,d,i,j){if(a==null)return;var c=getRowKeyFromCell(a),e=element.getAttribute("layoutMode")?getColKeyFromCell2(a):getColKeyFromCell(a);if(typeof c=="undefined")return;var b=-1;if(isChild(a,getCorner()))b=0;else if(isChild(a,getRowHeader())||isChild(a,getFrozRowHeader()))b=1;else if(isChild(a,getColHeader())||isChild(a,getFrozColHeader()))b=2;else if(isChild(a,getViewport())||isChild(a,getViewport0())||isChild(a,getViewport1())||isChild(a,getViewport2()))b=3;var g=addCellInfo(c,e,b);setXMLNodeAttribute(g,""+h,d);if(!i){fireDataChangedEvent(a,d,element,c,e);var f=getTopSpread(element);f!=element&&f.fireDataChangedEvent(a,d,element,c,e)}spreadView.GetCommandBar().EnableDataButtons(true);dirty=true;j&&updateValues()}function updateCellLocked(b,c){if(b==null)return;var d=b.getAttribute("FpCellType")=="readonly";if(d==c)return;var a=xmlData.firstElementChild(b);while(a!=null){if(typeof a.disabled!="undefined")a.disabled=c;a=xmlData.nextElementSibling(a)}}function Cells(c,b){var a=GetCellByRowCol(c,b);if(a){a.GetValue=function(){return GetValue(c,b)};a.SetValue=function(a){if(typeof a=="undefined")return;if(this.parentNode.getAttribute("previewRow")!=null)return;SetValue(c,b,a)};a.GetBackColor=function(){return this.bgColorBak!=null?this.bgColorBak:$$.j(this).css("backgroundColor")};a.SetBackColor=function(a,b){if(typeof a=="undefined")return;if(a==null||a=="")a="transparent";this.setAttribute("bgColor",a);this.bgColorBak=a;this.style.backgroundColor=a;setCellAttribute(this,"bc",a,b)};a.GetForeColor=function(){return $$.j(this).css("color")};a.SetForeColor=function(a,b){if(typeof a=="undefined")return;this.style.color=a;setCellAttribute(this,"fc",a,b)};a.GetTabStop=function(){return this.getAttribute("TabStop")!="false"};a.SetTabStop=function(b){if(typeof b=="undefined")return;var a=new String(b);if(a.toLocaleLowerCase()=="false")this.setAttribute("TabStop","false");else this.removeAttribute("TabStop");setCellAttribute(this,"ts",a.toLocaleLowerCase())};a.GetCellType=function(){var a=getCellType2(this);if(a=="text"||a=="readonly")a=this.getAttribute("CellType2");if(a==null)a="GeneralCellType";return a};a.GetHAlign=function(){return $$.j(this).css("textAlign")};a.SetHAlign=function(a){if(typeof a=="undefined")return;this.style.textAlign=typeof a=="string"?a:a.Name;setCellAttribute(this,"ha",typeof a=="string"?a:a.Name)};a.GetVAlign=function(){return $$.j(this).css("verticalAlign")};a.SetVAlign=function(a){if(typeof a=="undefined")return;this.style.verticalAlign=typeof a=="string"?a:a.Name;setCellAttribute(this,"va",typeof a=="string"?a:a.Name)};a.GetLocked=function(){return a.GetCellType()=="ButtonCellType"||a.GetCellType()=="TagCloudCellType"||a.GetCellType()=="HyperLinkCellType"?a.getAttribute("locked")=="1":getCellType(this)=="readonly"};a.SetLocked=function(a){fpSpreadJS.setCellLocked(this,getCellType(this),a)&&setCellAttribute(this,"lk",a)};a.GetFont_Name=function(){return $$.j(this).css("fontFamily")};a.SetFont_Name=function(a){if(typeof a=="undefined")return;this.style.fontFamily=a;setCellAttribute(this,"fn",a)};a.GetFont_Size=function(){return $$.j(this).css("fontSize")};a.SetFont_Size=function(a){if(typeof a=="undefined")return;this.style.fontSize=a;setCellAttribute(this,"fs",a);EnsureRowHeight(parseInt(getRowKeyFromCell(this)))};a.GetFont_Bold=function(){return $$.j(this).css("fontWeight")>=700?true:false};a.SetFont_Bold=function(a){if(typeof a=="undefined")return;this.style.fontWeight=a==true?"bold":"normal";setCellAttribute(this,"fb",new String(a).toLocaleLowerCase())};a.GetFont_Italic=function(){return $$.j(this).css("fontStyle")=="italic"?true:false};a.SetFont_Italic=function(a){if(typeof a=="undefined")return;this.style.fontStyle=a==true?"italic":"normal";setCellAttribute(this,"fi",new String(a).toLocaleLowerCase())};a.GetFont_Overline=function(){return $$.j(this).css("textDecoration").indexOf("overline")>=0?true:false};a.SetFont_Overline=function(b){if(b){var a=new String("overline");if($$.j(this).css("textDecoration").indexOf("line-through")>=0)a+=" line-through";if($$.j(this).css("textDecoration").indexOf("underline")>=0)a+=" underline";this.style.textDecoration=a}else{var a=new String("");if($$.j(this).css("textDecoration").indexOf("line-through")>=0)a+="line-through";if($$.j(this).css("textDecoration").indexOf("underline")>=0)a+=" underline";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fo",new String(b).toLocaleLowerCase())};a.GetFont_Strikeout=function(){return $$.j(this).css("textDecoration").indexOf("line-through")>=0?true:false};a.SetFont_Strikeout=function(b){if(b){var a=new String("line-through");if($$.j(this).css("textDecoration").indexOf("overline")>=0)a+=" overline";if($$.j(this).css("textDecoration").indexOf("underline")>=0)a+=" underline";this.style.textDecoration=a}else{var a=new String("");if($$.j(this).css("textDecoration").indexOf("overline")>=0)a+="overline";if($$.j(this).css("textDecoration").indexOf("underline")>=0)a+=" underline";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fk",new String(b).toLocaleLowerCase())};a.GetFont_Underline=function(){return $$.j(this).css("textDecoration").indexOf("underline")>=0?true:false};a.SetFont_Underline=function(b){if(b){var a=new String("underline");if($$.j(this).css("textDecoration").indexOf("overline")>=0)a+=" overline";if(this.style.textDecoration.indexOf("line-through")>=0)a+=" line-through";this.style.textDecoration=a}else{var a=new String("");if($$.j(this).css("textDecoration").indexOf("overline")>=0)a+="overline";if($$.j(this).css("textDecoration").indexOf("line-through")>=0)a+=" line-through";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fu",new String(b).toLocaleLowerCase())};return a}return null}function getDomRow(d){if(GetRowCount()==0)return null;var a=GetCellByRowCol(d,0);if(a){var c=a.parentElement.rowIndex;if(c>=0){var b=a.parentElement.parentElement.rows[c];if(getSizable(b))return b}return null}}function setRowInfo_RowAttribute(a,b,e,d){a=parseInt(a);if(a<0)return;var c=addRowInfo(a,false,true);setXMLNodeAttribute(c,""+b,e);spreadView.GetCommandBar().EnableDataButtons(true);dirty=true;d&&updateValues()}function Rows(b){var a=getDomRow(parseInt(b));if(a){a.GetHeight=function(){return getRowHeightInternal2(b)};a.SetHeight=function(a){if(typeof a=="undefined")return;setRowHeight2(b,parseInt(a),null,true)};return a}return null}function setColInfo_ColumnAttribute(a,d,e,c){a=parseInt(a);if(a<0)return;var b=addColInfo(a,false);setXMLNodeAttribute(b,""+d,e);spreadView.GetCommandBar().EnableDataButtons(true);dirty=true;c&&updateValues()}function Columns(b){var a={colindex:getColByKey(parseInt(b))};if(a){a.GetWidth=function(){return getColWidthFromCol(b)};a.SetWidth=function(a){if(typeof a=="undefined")return;setColWidth(b,parseInt(a),null,true)};return a}return null}function getTitleBar(){try{return window.document.getElementById(element.id+"_title")==null?null:window.document.getElementById(element.id+"_title")}catch(a){$$.DEBUG.Log(a,"getTitleBar");return null}}function getSubTitleBar(){try{return window.document.getElementById(element.id+"_subtitle")}catch(a){return null}}function checkTitleInfo(){var a=xmlData.selectSingleNode("titleinfo");return a==null?null:a}function addTitleInfo(){var a=checkTitleInfo();if(a!=null)return a;a=xmlData.createElement("titleinfo");xmlData.firstChild(xmlData.getXMLDoc()).appendChild(a);return a}function setTitleInfo_Attribute(a,d,c){var b=addTitleInfo();setXMLNodeAttribute(b,""+a,d);spreadView.GetCommandBar().EnableDataButtons(true);dirty=true;c&&updateValues()}function GetTitleInfo(){var a=getTitleBar();if(a){a.GetHeight=function(){return $$.j(this).css("height")};a.SetHeight=function(a){this.style.height=parseInt(a)+"px";setTitleInfo_Attribute("ht",a);sizeSpread()};a.GetVisible=function(){return this.style.display=="none"?false:true;return this.style.visibility};a.SetVisible=function(a){this.style.display=a?"block":"none";this.style.visibility=a?"visible":"hidden";setTitleInfo_Attribute("vs",new String(a).toLocaleLowerCase());sizeSpread()};a.GetValue=function(){return xmlData.textContent(this)};a.SetValue=function(a){xmlData.textContent(this,a);setTitleInfo_Attribute("tx",a)};return a}return null}var strStyle="";function showScrollingContent(A){if(element.getAttribute("ClientAutoSize")=="True"&&(getParentSpread()!=null||spreadView.ClientAutoSizeMaxWidth()==0&&spreadView.ClientAutoSizeMaxHeight()==0))return;var F=spreadView.GetAttribute("scrollContentTime"),a=displayingVirtualScrollingContent!=null?displayingVirtualScrollingContent:"";if(!element.initialized){a!=""&&showMessageInner(a,-2,-1,F);return}var n="Row",j="Column",C=spreadView.GetTopSpreadView(),m=GcResources[C.GetCulture(C.Spread)];if(m.Common.ScrollingContentRow)n=m.Common.ScrollingContentRow;if(m.Common.ScrollingContentColumn)j=m.Common.ScrollingContentColumn;var g=getTopSpread(),u=g.getAttribute("scrollContentColumns"),D=g.getAttribute("scrollContentMaxHeight"),o=g.getViewport(),G=getColGroup(o),t=getScrollvp();if(t==null)t=getParent(o);var r=0;if(element.getAttribute("lcidRow")!=null)n=element.getAttribute("lcidRow");if(element.getAttribute("lcidColumn")!=null)j=element.getAttribute("lcidColumn");if(A){var U=t.scrollLeft,e=g.getColHeader(),f=0,p=null;if(e!=null)p=e.getElementsByTagName("COL");else if(G!=null)p=G.children;else return;for(;f<p.length;f++){var k=p[f];r+=parseInt(k.width,10);if(r>U)break}var q=g.getViewport2();if(q)f+=getColGroup(q).children.length;if(e&&e.rows.length>0){var c=e.rows.length-1;if(element.getAttribute("layoutMode")==null&&e.ColTextIndex!=null)c=parseInt(e.ColTextIndex);else while(c>=0&&e.rows[c]&&e.rows[c].getAttribute("FpSpread")=="fb")c--;if(c>=0){var d=getHeaderCellFromRowCol(c,f,true);if(d)if(d.getAttribute("FpCellType")=="ExtenderCellType"&&d.getElementsByTagName("DIV").length>0){var J=getEditor(d),K=getFunction("ExtenderCellType_getEditorValue");if(J!=null&&K!=null)a="&nbsp;"+j+":&nbsp;"+K(J)+"&nbsp;"}else if(d.getElementsByTagName("SELECT").length>0){var H=d.getElementsByTagName("SELECT")[0];a="&nbsp;"+j+":&nbsp;"+H[H.selectedIndex].text+"&nbsp;"}else a="&nbsp;"+j+":&nbsp;"+xmlData.textContent(d)+"&nbsp;"}}if(a.length<=0&&f<GetColCount())a="&nbsp;"+j+":&nbsp;"+(f+1)+"&nbsp;"}else{var v=!element.ignoreVirtualPaging?canMoveToPage():null;if(v==null||!v.canMove){displayingVirtualScrollingContent=null;if(spreadView._GetTopDisplayedTableRowIndex(false)==-1)return;for(var V=t.scrollTop-g.virtualTop,l=g.getRowHeader(),c=0,h=0,E=2,Q=spreadView.CellSpacing,z=0;z<o.rows.length;z++){var i=o.rows[z];r+=i.offsetHeight+Q;if(r>V){if(i.getAttribute("FpKey")==null&&i.getAttribute("previewRow")!="true")c--;else h=i.offsetHeight;break}if(i.getAttribute("FpKey")!=null||i.getAttribute("previewRow")=="true"){c++;h=i.offsetHeight}}var q=g.getViewport1();if(q)c+=q.rows.length;if(element.getAttribute("layoutMode")==null&&u!=null&&u.length>0){h=h>D?D:h;for(var I=u.split(","),x=false,B=0;B<I.length;B++){var k=parseInt(I[B]);if(k==null||k>=GetColCount())continue;var b=GetCellByRowCol(c,k);if(!b||b.getAttribute("col")!=null&&parseInt(b.getAttribute("col"))!=k)continue;var s=b.getAttribute("group")==1,M=b.parentNode.getAttribute("previewRow")!=null,L=b.getAttribute("RowEditTemplate")!=null,R=!$$.browser.quirksMode;if(!R&&strStyle==""){getScrollingContentStyle();if(scStyle!=null){if(scStyle.fontFamily!=null&&scStyle.fontFamily!="")strStyle+="fontFamily:"+scStyle.fontFamily+";";if(scStyle.fontSize!=null&&scStyle.fontSize!="")strStyle+="fontSize:"+scStyle.fontSize+";";if(scStyle.fontStyle!=null&&scStyle.fontStyle!="")strStyle+="fontStyle:"+scStyle.fontStyle+";";if(scStyle.fontVariant!=null&&scStyle.fontVariant!="")strStyle+="fontVariant:"+scStyle.fontVariant+";";if(scStyle.fontWeight!=null&&scStyle.fontWeight!="")strStyle+="fontWeight:"+scStyle.fontWeight+";";if(scStyle.backgroundColor!=null&&scStyle.backgroundColor!="")strStyle+="backgroundColor:"+scStyle.backgroundColor+";";if(scStyle.color!=null&&scStyle.color!="")strStyle+="color:"+scStyle.color}}if(!x)a+="<div style='overflow:hidden; height:"+h+"px; ScrollingContentWidth'><table cellPadding='0' cellSpacing='0' style='height:"+h+"px;"+(s?"":"table-layout:auto;")+strStyle+"'><tr>";a+="<td style='width:"+(s?0:b.offsetWidth)+"px;'>";E+=b.offsetWidth;if(s)a+="&nbsp;<i>GroupBar:</i>&nbsp;"+xmlData.textContent(b)+"&nbsp;";else if(M)a+="&nbsp;<i>PreviewRow:</i>&nbsp;"+xmlData.textContent(b)+"&nbsp;";else if(L){var O=parseCell(b);a+="&nbsp;<i>RowEditTemplate:</i>&nbsp;"+O+"&nbsp;"}else if(b.getAttribute("FpCellType")=="MultiColumnComboBoxCellType"&&b.children[0].MccbId)a+=GetValue(c,k);else if(b.getAttribute("FpCellType")=="RadioButtonListCellType"||b.getAttribute("FpCellType")=="ExtenderCellType"||b.getAttribute("FpEditorID")!=null){var w=parseCell(b);if(b.getAttribute("CellType2")!=null&&b.getAttribute("CellType2")=="MutuallyExclusiveCheckBoxCellType")w=w.replace("OVERFLOW: hidden;","");a+=w}else a+=b.innerHTML;a+="</td>";x=true;if(s||M||L)break}if(x){a=a.replace("ScrollingContentWidth"," width:"+E+"px; ");a+="</tr></table></div>"}}if(a.length<=0&&l){var f=getColGroup(l).children.length-1;if(element.getAttribute("layoutMode")==null)f=l.getAttribute("RowTextIndex")?parseInt(l.getAttribute("RowTextIndex")):getColGroup(l).children.length-1;var S=GetDisplayIndex(c),d=getHeaderCellFromRowCol(S,f,false);if(d==null||d.getAttribute("FpSpread")=="rowpadding")return;a="&nbsp;"+n+":&nbsp;"+xmlData.textContent(d)+"&nbsp;"}if(a.length<=0){var T=element.getAttribute("layoutRowCount")!=null?parseInt(element.getAttribute("layoutRowCount")):1;a="&nbsp;"+n+":&nbsp;"+(parseInt(c/T)+1)+"&nbsp;"}}else{var N=parseInt(g.getAttribute("pageCount")),P=virtualScrollPagingFormatString||"Page {page} of {count}",y=P.replace(new RegExp("{page}","gi"),v.ToPage+1);y=y.replace(new RegExp("{count}","gi"),N);a=y;displayingVirtualScrollingContent=a}}a!=null&&a!=""&&showMessageInner(a,A?-1:-2,A?-2:-1,F)}function parseCell(d){var a=d.innerHTML,c=getTopSpread(element),b=c.id;if(a.length>0){a=a.replace(new RegExp("id="+b,"g"),"id="+b+"src");a=a.replace(new RegExp("name="+b,"g"),"name="+b+"src")}return a}function getScrollingContentStyle(){if(scStyle!=null)return;var b=element.document;if(!b.styleSheets)b=window.document;for(var g=b.styleSheets.length,c=0;c<g;c++){var e=b.styleSheets[c],a;try{if($$.browser.ie)a=e.rules;else a=e.cssRules;if(!a)continue}catch(h){continue}for(var d=0;d<a.length;d++){var f=a[d];if(f.selectorText=="."+element.id+"scrollContentStyle"){scStyle=f.style;break}}if(scStyle!=null)break}}function IntegerCellType_getValue(c){var g=getCell(c,true),a=$$(c).textContent();if(a==" "||trim(c.innerHTML)=="&nbsp;")return g.getAttribute("whiteSpace")==null?"":" ";c=_getFpRefProperty(g);var b=c.getAttribute("groupchar");if(b!=null&&b!=" "){var e=document.createElement("SPAN");e.innerHTML=b;b=e.innerHTML}if(b=="&nbsp;")b=" ";if(b==null)b=",";var f=a.length;while(true){a=a.replace(b,"");if(a.length==f)break;f=a.length}if(a.charAt(0)=="("&&a.charAt(a.length-1)==")"){var d=c.getAttribute("negsign");if(d==null)d="-";a=d+a.substring(1,a.length-1)}return a}function IntegerCellType_isValid(k,a,g){if(a==null||a.length==0)return"";a=trim(a);if(a.length==0)return"";var d=_getFpRefProperty(k),h=new RegExp("^\\s*[-\\+]?\\d+\\s*$"),b=true,c=null;if(g!=null&&g.getAttribute("enf")!=null){c=fpSpreadJS.tryGetNumber(g,a);b=c!=null;if(b)b=c.toString().match(h)!=null}else{var i=d.getAttribute("negsign"),j=d.getAttribute("possign");if(i!=null)a=a.replace(i,"-");if(j!=null)a=a.replace(j,"+");if(a.charAt(a.length-1)=="-")a="-"+a.substring(0,a.length-1);b=a.match(h)!=null;if(b)b=!isNaN(a);if(b)c=parseInt(a)}if(b){var f=d.getAttribute("MinimumValue"),e=d.getAttribute("MaximumValue");if(f!=null){f=parseInt(f);b=!isNaN(f)&&c>=f}if(b&&e!=null){e=parseInt(e);b=!isNaN(e)&&c<=e}}return!b?d.getAttribute("error")!=null?d.getAttribute("error"):"Integer":""}function _getFpRefProperty(b){var a=b,c=b.getAttribute("FpRef");if(b.getAttribute("FpRef")!=null)a=document.getElementById(c);if(a==null)a=document.getElementById(c);return a}function DateTimeCellType_getValue(a,e,d){var c=getCell(a),b=a.value;if(d)if(c!=null&&a.tagName!="INPUT")b=typeof c.attributes.evalue=="undefined"?undefined:c.attributes.evalue.value;if(typeof b=="undefined")b=trim(a.innerText||a.textContent);return b}function DateTimeCellType_setValue(b,a,c){var f=true,d=null;if(c!=null&&(c.getAttribute("edf")!=null||c.getAttribute("ef")!=null)){var e=getCell(b);e!=null&&e.setAttribute("evalue",a==null?"":a);if(a==editingValue)f=a==null;else if(c.getAttribute("ignoreValid")!=null)c.setAttribute("editValue",a);else{d=fpSpreadJS.parseDate(c,a,true);if(d!=null){var g=fpSpreadJS.formatDate(c,d,false);g!=a&&e!=null&&e.setAttribute("evalue",g);a=fpSpreadJS.formatDate(c,d,true)}}}if(b.tagName=="NOBR")b=b.parentElement;if(typeof b.value!="undefined"){if(a==null)a="";if(f)b.value=a;b.style.display="block"}else if(f)if(a==null||a=="")if(xmlData.firstElementChild(b)!=null&&xmlData.firstElementChild(b).tagName=="NOBR")xmlData.firstElementChild(b).innerHTML="&nbsp;";else b.innerHTML="&nbsp;";else if(xmlData.firstElementChild(b)!=null&&xmlData.firstElementChild(b).tagName=="NOBR")xmlData.textContent(xmlData.firstElementChild(b),a);else xmlData.textContent(b,a);return d!=null?d:a}function IntegerCellType_setValue(b,a,d){var g=getCell(b,true),f=true,e=false;if(a!=null&&a!=""){if(d!=null&&d.getAttribute("enf")!=null&&!fpSpreadJS.isFormula(a)){var c=fpSpreadJS.tryGetNumber(d,a);if((!editing||a!=editingValue)&&c!=null){spreadView._ProcessNegativeRed(g,c);var h=fpSpreadJS.getNumberFormat(d);a=fpSpreadJS.formatNumber(c,"n",h);xmlData.textContent(b,a);return c}else f=false}else e=true;f&&xmlData.textContent(b,a);e&&spreadView._ProcessNegativeRed(g,IntegerCellType_getValue(b))}else b.innerHTML="&nbsp;";return a}function IntegerCellType_setEditorValueEditMode(b,a,f,d){if(b.getAttribute("enf")!=null&&!(a==null||a=="")&&!fpSpreadJS.isFormula(a)){var c=d?parseInt(a):fpSpreadJS.tryGetNumber(b,a,false,true);if(c!=null&&!isNaN(c))if(!d||c==parseFloat(a)){var e=fpSpreadJS.getNumberFormat(b,true);a=fpSpreadJS.formatNumber(c,"n",e)}}b.value=a}function DoubleCellType_isValid(k,a,g){if(a==null||a.length==0)return"";var c=_getFpRefProperty(k),i=c.getAttribute("MinimumValue"),h=c.getAttribute("MaximumValue"),b=true;if(g!=null&&g.getAttribute("efp")!=null){var j=fpSpreadJS.tryGetNumber(g,a);b=j!=null;if(b)b=_isDoubleInMinMax(j,i,h)}else{var e=c.getAttribute("decimalchar");if(e==null)e=".";var d=c.getAttribute("groupchar");if(d==null)d=",";a=trim(a);b=a.length==0||a.charAt(0)!=d;if(b){var f=a.indexOf(e);if(f>=0){f=a.indexOf(d,f);b=f<0}}if(b)a=fpSpreadJS.replaceStringAll(a,d,"");if(a.length==0)b=false;else if(b){var l=c.getAttribute("negsign"),m=c.getAttribute("possign");b=isDouble(a,e,l,m,i,h)}}return!b?c.getAttribute("error")!=null?c.getAttribute("error"):"Double":""}function DoubleCellType_getValue(b){var e=getCell(b,true),a=$$(b).textContent();if(a==" "||trim(b.innerHTML)=="&nbsp;")return e.getAttribute("whiteSpace")==null?"":" ";b=_getFpRefProperty(e);var d=b.getAttribute("groupchar");if(d==null)d=",";a=fpSpreadJS.replaceStringAll(a,d,"");if(a.charAt(0)=="("&&a.charAt(a.length-1)==")"){var c=b.getAttribute("negsign");if(c==null)c="-";a=c+a.substring(1,a.length-1)}return a}function DoubleCellType_setValue(c,a,b){var g=getCell(c,true),f=true,e=false;if(a!=null&&a!=""){var k=a;if(b!=null&&b.getAttribute("efp")!=null&&!fpSpreadJS.isFormula(a)){var d=fpSpreadJS.tryGetNumber(b,a);if((!editing||a!=editingValue)&&d!=null){spreadView._ProcessNegativeRed(g,d);var j=fpSpreadJS.getNumberFormat(b),i=!(b.getAttribute("fp")!="1"),h=b.getAttribute("dd");a=fpSpreadJS.formatNumber(d,"d",j,i,h);xmlData.textContent(c,a);return d}else f=false}else e=true;f&&xmlData.textContent(c,a);e&&spreadView._ProcessNegativeRed(g,DoubleCellType_getValue(c))}else c.innerHTML="&nbsp;";return a}function DoubleCellType_setEditorValueEditMode(b,a,h,f){if(b.getAttribute("efp")!=null&&!(a==null||a=="")&&!fpSpreadJS.isFormula(a)){var c=f?parseFloat(a):fpSpreadJS.tryGetNumber(b,a,false,true);if(c!=null&&!isNaN(c)){var g=fpSpreadJS.getNumberFormat(b,true),e=!(b.getAttribute("efp")!="1"),d=b.getAttribute("edd");a=fpSpreadJS.formatNumber(c,"d",g,e,d)}}b.value=a}function CurrencyCellType_isValid(l,a,h){if(a!=null&&a.length>0){var c=_getFpRefProperty(l),b=true,j=c.getAttribute("MinimumValue"),i=c.getAttribute("MaximumValue");if(h!=null&&h.getAttribute("efp")!=null){var k=fpSpreadJS.tryGetNumber(h,a,true);b=k!=null;if(b)b=_isDoubleInMinMax(k,j,i)}else{var f=c.getAttribute("currencychar");if(f==null)f="$";a=a.replace(f,"");var d=c.getAttribute("groupchar");if(d==null)d=",";var e=c.getAttribute("decimalchar");if(e==null)e=".";a=trim(a);b=a.length==0||a.charAt(0)!=d;if(b&&d!=""){var g=a.indexOf(e);if(g>=0){g=a.indexOf(d,g);b=g<0}}if(b)a=fpSpreadJS.replaceStringAll(a,d,"");if(a.length==0)b=false;else if(b){var m=c.getAttribute("negsign"),n=c.getAttribute("possign");b=isDouble(a,e,m,n,j,i)}}if(!b)return c.getAttribute("error")!=null?c.getAttribute("error"):"Currency ("+f+"100"+e+"10) "}return""}function isDouble(b,h,d,e,g,f){if(b==null||b.length==0)return true;b=trim(b);if(b.length==0)return true;if(d!=null)b=b.replace(d,"-");if(e!=null)b=b.replace(e,"+");if(b.charAt(b.length-1)=="-")b="-"+b.substring(0,b.length-1);var i=new RegExp("^\\s*([-\\+])?(\\d+)?(\\"+h+"(\\d+))?([eE]([-\\+])?(\\d+))?\\s*$"),a=b.match(i);if(a==null)return false;if((a[2]==null||a[2].length==0)&&(a[4]==null||a[4].length==0))return false;var c="";if(a[1]!=null&&a[1].length>0)c=a[1];if(a[2]!=null&&a[2].length>0)c+=a[2];else c+="0";if(a[4]!=null&&a[4].length>0)c+="."+a[4];if(a[6]!=null&&a[6].length>0){c+="E"+a[6];if(a[7]!=null)c+=a[7];else c+="0"}num=parseFloat(c);return isNaN(num)?false:_isDoubleInMinMax(num,g,f)}function _isDoubleInMinMax(f,c,b){var a=true;if(c!=null){var e=parseFloat(c);a=!isNaN(e)&&f>=e}if(a&&b!=null){var d=parseFloat(b);a=!isNaN(d)&&f<=d}return a}function CurrencyCellType_getValue(b){var g=getCell(b,true),a=$$(b).textContent();if(a==" "||trim(b.innerHTML)=="&nbsp;")return g.getAttribute("whiteSpace")==null?"":" ";b=_getFpRefProperty(g);var c=b.getAttribute("currencychar");if(c!=null){var f=document.createElement("SPAN");f.innerHTML=c;c=f.innerHTML}if(c==null)c="$";var e=b.getAttribute("groupchar");if(e==null)e=",";a=a.replace(c,"");a=fpSpreadJS.replaceStringAll(a,e,"");var d=b.getAttribute("negsign");if(d==null)d="-";if(a.charAt(0)=="("&&a.charAt(a.length-1)==")")a=d+a.substring(1,a.length-1);return a}function CurrencyCellType_setValue(b,a,c){var e=getCell(b,true);if(a!=null&&a!="")if(c!=null&&c.getAttribute("efp")!=null&&!fpSpreadJS.isFormula(a)){if(!editing||a!=editingValue){var d=fpSpreadJS.tryGetNumber(c,a,true);if(d!=null){spreadView._ProcessNegativeRed(e,d);var g=fpSpreadJS.getNumberFormat(c),f=!(c.getAttribute("fp")!="1");b.innerHTML=fpSpreadJS.formatNumber(d,"c",g,f);return d}else return b.innerHTML=a}}else{b.innerHTML=a.replace(" ","");spreadView._ProcessNegativeRed(e,CurrencyCellType_getValue(b))}else b.innerHTML="&nbsp;";return a}function CurrencyCellType_setEditorValueEditMode(b,a,g,e){if(b.getAttribute("efp")!=null&&!(a==null||a=="")&&!fpSpreadJS.isFormula(a)){var c=e?parseFloat(a):fpSpreadJS.tryGetNumber(b,a,true,true);if(c!=null&&!isNaN(c)){var f=fpSpreadJS.getNumberFormat(b,true),d=!(b.getAttribute("efp")!="1");a=fpSpreadJS.formatNumber(c,"c",f,d)}}b.value=a}function DateTimeCellType_setEditorValueEditMode(b,a,h,e){var g=getCell(b)||anchorCell,c=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,g);if(c&&c.SetEditorValue)return c.SetEditorValue(a,e);if((b.getAttribute("edf")!=null||b.getAttribute("ef")!=null)&&!(a==null||a==""))if(b.getAttribute("ignoreValid")!=null)a=b.getAttribute("editValue");else if(e){var d=Sys.CultureInfo.CurrentCulture,f=Date._parseExact(a,"yyyy/M/d",d)||Date._parseExact(a,"yyyy/M/d H:m:s:fff",d);if(f!=null)a=fpSpreadJS.formatDate(b,f,false)}b.value=a}function DateTimeCellType_isValid(b,c,d){var a=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,b);return a.IsValid(c,d)}function TextCellType_getValue(a){var b=getCell(a,false);if(b==null)return"";if(b.getAttribute("password")!=null)return b!=null&&b.getAttribute("value")!=null?b.getAttribute("value"):"";else{if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")a=xmlData.firstElementChild(a);if($$(a).textContent()==" "||trim(a.innerHTML)=="&nbsp;")return b.getAttribute("whiteSpace")==null?"":" ";var c=typeof a.value!="undefined"?a.value:$$.utils.htmlDecode(a.innerHTML);if(c.length>1)c=c.replace(/\n\n$/g,"\n");return c}}function TextCellType_setValue(b,a){var d=getCell(b,true);if(d==null)return;var c=null;if(b.children)c=b.children;else c=b.childNodes;if(c.length>0&&c[0].tagName&&c[0].tagName.toUpperCase()=="NOBR"){var e=b;b=c[0];if(e.style.removeAttribute)e.style.removeAttribute("display");else e.style.removeProperty("display")}if(d.getAttribute("password")!=null)if(a!=null&&a!=""){b.innerHTML="";for(var f=0;f<a.length;f++)b.innerHTML+="*";d.setAttribute("value",a)}else{b.innerHTML="&nbsp;";d.setAttribute("value","")}else if(b.tagName=="INPUT"||b.tagName=="TEXTAREA"){if(a==null)a="";if(typeof b.maxLength!="undefined"&&b.maxLength>0)a=a.substring(0,b.maxLength);b.value=a}else if(a!=null&&a!=""){a=$$.utils.htmlEncode(a);if(a.length>3)a=a.replace(/<br>$/g,"<br><br>");b.innerHTML=a}else b.innerHTML="&nbsp;"}function TextCellType_isValid(c,f){var b=null,e=$$.j(c).find("INPUT,TEXTAREA");if(e.length>0)b=e.get(0);else{var g=getCellEditorID(c);if(g==null)return;b=document.getElementById(g)}var a=-1;if(b!=null&&typeof b.maxLength!="undefined")a=parseInt(b.maxLength);if(a>0&&f!=null&&f.length>a){var d=_getFpRefProperty(c);return d!=null&&d.getAttribute("error")!=null?d.getAttribute("error").replace("{0}",a):"The maximum text lengh is "+a}return""}function GeneralCellType_getValue(a){var c=getCell(a);if(c==null)return"";if(xmlData.firstElementChild(a)!=null&&xmlData.firstElementChild(a).tagName=="NOBR")a=xmlData.firstElementChild(a);if(trim(a.innerHTML)=="&nbsp;")return c.getAttribute("whiteSpace")==null?"":" ";var b=a.value;if(a.tagName=="NOBR")b=c.value;if(typeof b=="undefined")if(isHeaderCell(c))b=trim($$(a).textContent());else b=$$.utils.htmlDecode(a.innerHTML);return b}function GeneralCellType_setValue(a,c){var e=getCell(a,true);spreadView._ProcessNegativeRed(e,c);var b=null;if(a.children)b=a.children;else b=a.childNodes;if(b.length>0&&b[0].tagName&&b[0].tagName.toUpperCase()=="NOBR"){var d=a;a=b[0];if(d.style.removeAttribute)d.style.removeAttribute("display");else d.style.removeProperty("display")}if(c!=null&&c!=""){c=$$.utils.htmlEncode(c);a.innerHTML=c}else a.innerHTML="&nbsp;"}function EmptyCellType_getValue(a){return GeneralCellType_getValue(a)}function EmptyCellType_setValue(b,a){GeneralCellType_setValue(b,a)}function RegExpCellType_isValid(b,c){if(c==null||b==null)return"";if(trim(c).length==0)return"";var a=b,f=b.getAttribute("FpRef");if(b.getAttribute("FpRef")!=null)a=element.document.getElementById(f);if(a==null){var d=element.document;if(!d.getElementById)d=window.document;a=d.getElementById(f)}var e=a.getAttribute("fpexpression");if(e==null||e.length==0)return"";var h=new RegExp(e),g=c.match(h);return g!=null&&c==g[0]?"":a.getAttribute("error")}function ComboBoxCellType_setValue(d,b,j){var g=getCell(d,true);if(g==null)return;var c=g.getElementsByTagName("SELECT");if(c!=null&&c.length>0){if(b==null){c[0].selectedIndex=-1;c[0].value=""}else{var i=c[0].selectedIndex;c[0].value=b;if(b==""&&i==c[0].selectedIndex)c[0].selectedIndex=-1}return}var f=j.getCellEditorID(g),a=null;if(f!=null&&typeof f!="undefined"){a=j.getCellEditor(f,$$.browser.mozilla);if(a!=null){var i=a.selectedIndex;a.value=b;if(a.value!=""&&(b==null||b==""&&i==a.selectedIndex))a.selectedIndex=-1;if(a.selectedIndex>=0&&a.selectedIndex<a.options.length)b=a.options[a.selectedIndex].text;var e=null;if(d.children)e=d.children;else e=d.childNodes;if(e.length>0&&e[0].tagName&&e[0].tagName.toUpperCase()=="NOBR"){var h=d;d=e[0];if(h.style.removeAttribute)h.style.removeAttribute("display");else h.style.removeProperty("display")}if(b!=null&&b!="")xmlData.textContent(d,b);else d.innerHTML="&nbsp;"}}}function ComboBoxCellType_getValue(h,i){var b=$$(h).textContent(),d=getCell(h,false);if(d==null)return null;var e=$$.utils.stringEquals;if(e(b," ")&&d.getAttribute("specialValue")!=null)b="";var g=d.getElementsByTagName("SELECT");if(g!=null&&g.length>0)return g[0].value;var f=i.getCellEditorID(d),a=null;if(f!=null&&typeof f!="undefined"){a=i.getCellEditor(f,false);if(a!=null&&a.options!=null)for(var j=a.options.length,c=0;c<j;c++)if(e(a.options[c].text,b)||e(a.options[c].innerHTML,b))return a.options[c].value;return null}return b}function ComboBoxCellType_isValid(e,c){if(c==null||/^\s*$/g.test(c))return"";var a=e.getElementsByTagName("SELECT");if(a!=null&&a.length>0)a=a[0];else{var b=getCellEditorID(e);if(b!=null&&typeof b!="undefined")a=getCellEditor(b,true)}if(a!=null&&a.options!=null)for(var d=0;d<a.options.length;d++)if(c==a.options[d].value)return"";return"invalid"}function CheckBoxCellType_setFocus(b){var a=b.getElementsByTagName("INPUT");a!=null&&a.length>0&&a[0].type=="checkbox"&&a[0].focus()}function CheckBoxCellType_getCheckBoxEditor(b){if(b==null)return null;var a=b.getElementsByTagName("INPUT");return a!=null&&a.length>0&&a[0].type=="checkbox"?a[0]:null}function CheckBoxCellType_isValid(b,a){if(a==null)return"";a=trim(a);return a==""?"":a.toLowerCase()=="true"||a.toLowerCase()=="false"?"":"invalid value"}function CheckBoxCellType_getValue(a,b){return CheckBoxCellType_getEditorValue(a,b)}function CheckBoxCellType_getEditorValue(c){var b=getCell(c,true),a=CheckBoxCellType_getCheckBoxEditor(b);return a!=null&&a.checked?"true":"false"}function CheckBoxCellType_setValue(d,b){var c=getCell(d,true),a=CheckBoxCellType_getCheckBoxEditor(c);if(a!=null){a.checked=b!=null&&b.toLowerCase()=="true";return}}function ListBoxCellType_setEditorValue(a,c){if(a==null||c==null||c=="")return;for(var b=0;b<a.options.length;b++)if($$.utils.stringEquals(trim(a.options[b].value),trim(c))){a.options[b].selected=true;return}}function ListBoxCellType_setValue(b,c){var a=getCell(b,true);if(a==null)return;if(c!=null)c=trim(c);var e=$$.utils,g=e.firstTaggedChild(b,"TABLE",true);if(g==null)return;for(var f=g.rows,d=0;d<f.length;d++){var a=f[d].cells[0],h=trim($$(a).textContent());if(c!=null&&e.stringEquals(c,h)){a.setAttribute("selected","true");if(typeof b.getAttribute("SelectedBackColor")!="undefined")a.style.background=b.getAttribute("SelectedBackColor");if(typeof b.getAttribute("SelectedForeColor")!="undefined")a.style.color=b.getAttribute("SelectedForeColor")}else{a.style.background="";a.style.color="";a.removeAttribute("selected")}}}function ListBoxCellType_getValue(e){var f=getCell(e,true);if(f==null)return null;var d=$$.utils.firstTaggedChild(e,"TABLE",true);if(d==null)return null;for(var c=d.rows,a=0;a<c.length;a++){var b=c[a].cells[0];if(b.getAttribute("selected")=="true")return trim($$(b).textContent())}return null}function RadioButtonListCellType_getValue(d){for(var c=getCell(d),b=c.getElementsByTagName("INPUT"),a=0;a<b.length;a++)if(b[a].tagName=="INPUT"&&b[a].checked)return b[a].value;return null}function RadioButtonListCellType_getEditorValue(a,b){return RadioButtonListCellType_getValue(a,b)}function RadioButtonListCellType_setValue(e,c){if(c!=null)c=trim(c);for(var d=getCell(e),b=d.getElementsByTagName("INPUT"),a=0;a<b.length;a++)if(b[a].tagName=="INPUT"&&c==trim(b[a].value)){b[a].checked=true;break}else if(b[a].checked)b[a].checked=false}function radiofocus(c){var b=c.target,a=getCell(b);rc=a.getBoundingClientRect();rrd=b.getBoundingClientRect();rprd=b.parentNode.getBoundingClientRect();if(rrd.right>rc.right)a.scrollLeft+=rprd.right-rc.right;else if(rrd.left<rc.left)a.scrollLeft-=rc.left-rprd.left}function RadioButtonListCellType_setFocus(d){var c=getCell(d),b=c.getElementsByTagName("INPUT");if(b==null)return;if($$.browser.chrome){RadioButtonListCellType_detachEvent(c);RadioButtonListCellType_attachEvent(c)}for(var a=0;a<b.length;a++)if(b[a].type=="radio"&&b[a].checked){b[a].focus();return}for(var a=0;a<b.length;a++)if(b[a].type=="radio"){b[a].focus();return}}function RadioButtonListCellType_attachEvent(c){var d=getCellType(c);if(d!="RadioButtonListCellType")return;var a=c.getElementsByTagName("INPUT");if(a==null)return;for(var b=0;b<a.length;b++)if(a[b].type=="radio")$$.j(a[b]).on("focus",radiofocus)}function RadioButtonListCellType_detachEvent(c){var d=getCellType(c);if(d!="RadioButtonListCellType")return;var a=c.getElementsByTagName("INPUT");if(a==null)return;for(var b=0;b<a.length;b++)a[b].type=="radio"&&$$.j(a[b]).off("focus",radiofocus)}function HyperLinkCellType_getValue(b){var a=$$(b).textContent();if(typeof a!="undefined"&&a!=null&&a.length>0){a=$$.utils.replaceAll(a,"\n","");a=trim(a)}else a="";return a}function ButtonCellType_getValue(b){var a=$$(b).textContent();if(typeof a!="undefined"&&a!=null&&a.length>0){a=$$.utils.replaceAll(a,"\n","");a=trim(a)}else a="";return a}function TagCloudCellType_getValue(b){var a=$$(b).textContent();if(typeof a!="undefined"&&a!=null&&a.length>0)a=$$.utils.htmlDecode(trim(a));else a="";return a}function PercentCellType_getValue(m){var c=getCell(m),a=trim($$(c).textContent());if(a==null)return a;var b=c,h=c.getAttribute("FpRef");if(c.getAttribute("FpRef")!=null)b=$$(element).getDocument().getElementById(h);if(b==null){var d=element.document;if(!d.getElementById)d=window.document;b=d.getElementById(h)}var f=b.getAttribute("percentchar");if(f==null)f="%";a=a.replace(f,"");var i=b.getAttribute("negsign"),j=b.getAttribute("possign"),e=b.getAttribute("groupchar");if(e==null)e=",";var g=a.length;while(true){a=a.replace(e,"");if(a.length==g)break;g=a.length}var l=a;if(i!=null)a=a.replace(i,"-");if(j!=null)a=a.replace(j,"+");var k=b.getAttribute("decimalchar");if(k!=null)a=a.replace(k,".");return!isNaN(a)?l:trim($$(c).textContent())}function PercentCellType_setValue(d,a){if(a!=null)a=trim(a);var e=getCell(d,true);spreadView._ProcessNegativeRed(e,a);if(a!=null&&a!=""){var b=getCell(d);if(b.getAttribute("FpRef")!=null)b=$$(element).getDocument().getElementById(b.getAttribute("FpRef"));var c=b.getAttribute("percentchar");if(c==null)c="%";a=a.replace(" ","");a=a.replace(c,"");xmlData.textContent(d,a+c)}else d.innerHTML="&nbsp;"}function PercentCellType_isValid(q,a){if(a!=null){var b=getCell(q),m=b.getAttribute("FpRef");if(b.getAttribute("FpRef")!=null)b=$$(element).getDocument().getElementById(m);if(b==null){var f=element.document;if(!f.getElementById)f=window.document;b=f.getElementById(m)}var e=b.getAttribute("percentchar");if(e==null)e="%";a=a.replace(e,"");var i=b.getAttribute("groupchar");if(i==null)i=",";var l=a.length;while(true){a=a.replace(i,"");if(a.length==l)break;l=a.length}var p=a,g=b.getAttribute("negsign"),h=b.getAttribute("possign");if(g!=null)a=a.replace(g,"-");if(h!=null)a=a.replace(h,"+");var d=b.getAttribute("decimalchar");if(d!=null)a=a.replace(d,".");var c=!isNaN(a);if(c){var k=b.getAttribute("MinimumValue"),j=b.getAttribute("MaximumValue");if(k!=null||j!=null){var o=parseFloat(k),n=parseFloat(j);c=!isNaN(o)&&!isNaN(n);if(c){if(d==null)d=".";c=isDouble(p,d,g,h,o*100,n*100)}}}if(!c)return b.getAttribute("error")!=null?b.getAttribute("error"):"Percent: (ex, 10"+e+")"}return""}function MultiColumnComboBoxCellType_setValue(rd,val,ss){var cell=getCell(rd,true);if(cell==null)return;var mccbId=getMccbID(cell,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval("window."+mccbId+"_Obj");if(editorObj!=null){if(editorObj.GetUseValue()==1)editorObj.SetValueToDataColumn(val);else editorObj.SetValueToTextColumn(val);if((!ss.isEditing()||rd.getAttribute("FpEditor")==null)&&editorObj.GetShowButton()!=1){var text=val;if(val!=null)text=editorObj.GetCurrentText(cell);if(text!=null&&text!="")rd.innerHTML=$$.utils.htmlEncode(text);else rd.innerHTML="&nbsp;"}}}}function MultiColumnComboBoxCellType_blur(a){if(a==null)return;var b=$$(a).firstChild("INPUT");b!=null&&b.blur()}function getMccbID(d,e){var a=e.getCellEditorID(d);if(a!=null&&typeof a!="undefined"){var b=e.getCellEditor(a,true);if(b!=null&&b.getAttribute("MccbId")!=null)return b.getAttribute("MccbId")}var c=$$(d).getChildTag("DIV","MccbId");return c!=null?c.getAttribute("MccbId"):null}function MultiColumnComboBoxCellType_getValue(rd,ss){var cl=getCell(rd,true);if(cl==null)return null;var mccbId=getMccbID(cl,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval("window."+mccbId+"_Obj");if(editorObj!=null){editorObj.Value=null;return editorObj.GetCurrentValue(cl)}}return null}function MultiColumnComboBoxCellType_getEditorValue(d){var c=getCell(d,true);if(c==null)return;var a=c.getElementsByTagName("INPUT");if(a!=null&&a.length>0){var b=a[0];return b.getAttribute("UseValue")==1?b.getAttribute("DataValue"):b.value}return null}function MultiColumnComboBoxCellType_setFocus(c){var b=getCell(c);if(b==null)return;var a=$$(b).getChildTag("DIV","MccbId");if(a!=null)try{FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(a.getAttribute("MccbId"),function(a){detachOnActiveEvents();a.FocusForEdit();setTimeout(function(){attachOnActiveEvents()},0)})}catch(d){$$.DEBUG.Log(d,"MultiColumnComboBoxCellType_setFocus")}}function MultiColumnComboBoxCellType_setEditorValue(rd,editorValue,ss){var cell=getCell(rd,true);if(cell==null)return;var editorID=ss.getCellEditorID(cell),editor=null;if(editorID!=null&&typeof editorID!="undefined"){editor=ss.getCellEditor(editorID,true);if(editor!=null&&editor.getAttribute("MccbId")){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(editor.getAttribute("MccbId"));var editorObj=eval(editor.getAttribute("MccbId")+"_Obj");if(editorObj!=null&&editorObj.SetValueToDataColumn!=null)if(editorObj.GetUseValue()==1)editorObj.SetValueToDataColumn(editorValue);else editorObj.SetValueToTextColumn(editorValue)}}}function MultiColumnComboBoxCellType_isHandleEvent(event,editingCell){var cell=editingCell||anchorCell;if(cell==null)return false;if(event.type!="mousedown"&&event.type!="focusin")return false;var mccDiv=$$(cell).getChildTag("DIV","MccbId");if(mccDiv==null)return false;var editorObj=null;try{var editorObj=eval(mccDiv.getAttribute("MccbId")+"_Obj")}catch(e){}if(editorObj!=null){var externalEditor=editorObj.getContainerDiv();if(isChild(event.target,externalEditor))return true}return false}function inactiveAllChart(a){if(a==null)a=element;activeChartObj=a.GetActiveChartObj();if(activeChartObj!=null){activeChartObj.normalChart();activeChartObj.inactiveChart();activeChartObj=null;spreadView.RowCount==0&&paintSelections(true,true)}}function RefreshChart(){if(editing)return;spreadView.GetTopSpreadView().SaveAllXmlData();var a=element.getAttribute("ajax")!="false";a&&activeChartObj!=null&&syncData(element.getAttribute("name"),"RefreshChart,"+activeChartObj.chartID)}function GetActiveChartObj(){return activeChartObj}function GetActiveChart(){return activeChartObj!=null?activeChartObj.container:null}function SetActiveChartObj(a){activeChartObj=a;fireSelectionChangedEvent(element)}function SetActiveChart(id,updateUI){var chartContainerID=getChartByChartId(id);if(chartContainerID==null)return;var chartObj=null;try{chartObj=eval(chartContainerID+"_Obj")}catch(ex){$$.DEBUG.Log(ex,"SetActiveChartObj")}if(chartObj!=null)if(!chartObj.isActived){if(editing)if(!spreadView.IsInTouchMode()||!renderAsEditor)EndEdit(null,false);else{EndEdit({IgnoreFocus:true},false);!editing&&(document.activeElement==null||!$$.utils.contains(element,document.activeElement))&&setTextBoxFocus()}spreadView.SuspendShowFocusRectangle();ClearSelection(false,null,false);if(spreadView.IsInTouchMode())spreadView.GetActiveSpreadView(false,true).Touch.ResizeLocation=null;spreadView.ResumeShowFocusRectangle();chartObj.inactiveChart();chartObj.activeChart();spreadView.GetActiveSpreadView(false,true).HideFocusRectangle();if(anchorCell!=null&&anchorCell.paintSelected){var _cell=anchorCell;anchorCell=null;paintSelectedCell(_cell,false,false);anchorCell=_cell}spreadView.GetCommandBar().EnableButton("Update",true);spreadView.GetCommandBar().EnableButton("Clear",false);spreadView.GetCommandBar().EnableButton("Copy",false);spreadView.GetCommandBar().EnableButton("Paste",false);dirty=true;RemoveSelection(-1,-1,-1,-1);(updateUI==null||updateUI)&&spreadView.UpdateUI()}}function getChartByChartId(d){for(var c=element.getElementsByTagName("DIV"),b=0;b<c.length;b++){var a=c[b];if(a.id.indexOf("_chartContainer")>0&&a.getAttribute("serverID")==d)return a.id}return null}function updateChartURL(a){if(activeChartObj!=null)activeChartObj.getChart().src=a.src+"#"+Math.random()}function updateChartAllImg(){for(var items=element.getElementsByTagName("DIV"),i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0)if(item.getAttribute("selectChart")!="false"){var chartObj=eval(item.id+"_Obj");chartObj.init();chartObj.updateChartImgitem()}}}function initChartObj(){for(var items=element.getElementsByTagName("DIV"),initScripts=[],i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0){var js=item.id+'_Obj = new FarPoint.Web.Spread.SpreadChart(element.document.getElementById("'+element.id+'"),element.document.getElementById("'+item.id+'"));'+item.id+"_Obj.init();";initScripts.push(js)}}for(var i=0;i<initScripts.length;i++){var spread=getTopSpread(element);spread.resizing=true;eval(initScripts[i]);spread.resizing=false}return initScripts.length>0}function chartDispose(){for(var items=element.getElementsByTagName("DIV"),i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0)if(item.getAttribute("selectChart")!="false"){var chartObj=eval(item.id+"_Obj");chartObj.dispose()}}activeChartObj=null}function getChartObj(b){if(b==null)return null;var a=b;while(a!=null&&a.tagName!="BODY"&&a.tagName!="HTML"){if(a.id&&a.id.indexOf("_chartContainer")>0)return a.getChartObj();a=a.parentNode}return null}function GetCurrentPageIndex(){var a=parseInt(element.getAttribute("currentPageIndex"));return a!=NaN?a:0}function cloneArray(b){for(var c=[],a=0;a<b.length;a++)if($$(b[a]).isClass("Array"))c.push(cloneArray(b[a]));else c.push(b[a]);return c}function findCrossedSpanCells(f,g,e,c,d){var b=[],a=[];c&&colSpanCells&&colSpanCells.length>0&&a.splice(a.length,0,cloneArray(colSpanCells));d&&rowSpanCells&&rowSpanCells.length>0&&a.splice(a.length,0,cloneArray(rowSpanCells));e&&spanCells&&spanCells.length>0&&a.splice(a.length,0,cloneArray(spanCells));$$.utils.cleanArray(a);_findCrossedSpanCellsInternal(a,f,g,b);return b}function _findCrossedSpanCellsInternal(a,d,e,j){for(var g=d,f=e,i=a.length-1;i>=0;i--){for(var c=a[i],h=c.length-1;h>=0;h--){var b=c[h],k=b.row+b.rowCount-1;if(b.row<=e&&k>=d){j.push(b);c.splice(h,1);if(g>b.row)g=b.row;if(f<k)f=k}}c.length==0&&a.splice(i,1)}a.length>0&&g<d&&_findCrossedSpanCellsInternal(a,g,d-1,j);a.length>0&&f>e&&_findCrossedSpanCellsInternal(a,e+1,f,j)}function getRowRange(a){var c=Number.MAX_VALUE,b=0;if(a&&a.length>0){for(var e=0,f=a.length;e<f;e++){var d=a[e];c=Math.min(c,d.row);b=Math.max(b,d.row+d.rowCount-1)}return{startRow:c,endRow:b}}else return null}function getViewportFrozenRowCount(){var a=getFrozRowHeader();if(a!=null)return a.rows.length;if(frzCols>0){var a=getViewport0();if(a!=null)return a.rows.length}var a=getViewport1();return a!=null?a.rows.length:0}function preProcessSyncrhonzing(){for(var d=[getViewport(),getViewport2()],c=0;c<d.length;c++){if(d[c]==null)continue;var b=d[c].parentNode,e=b.offsetHeight+"px",a=window.document.getElementById(b.id+"__preventScrollDiv");if(a==null){a=document.createElement("DIV");a.id=b.id+"__preventScrollDiv";a.style.position="relative";a.style.width="1px";b.insertBefore(a,null)}a.style.height=e;a.style.display="block"}}function afterProcessSyncrhonzing(){for(var b=[getViewport(),getViewport2()],a=0;a<b.length;a++){if(b[a]==null)continue;var d=b[a].parentNode,c=window.document.getElementById(d.id+"__preventScrollDiv");if(c!=null){c.style.height="0px";c.style.display="none"}}}function findChildViewsByLevel(a,c){if(c<=0)return a;if(!$$(a).isClass("Array"))return findChildViewsByLevel([a],c);var b;do{c--;b=[];for(var d=0,g=a.length;d<g;d++)for(var f=FpSpreadJS.getChildViews(a[d]),e=0,h=f.length;e<h;e++)b.push(f[e]);a=b}while(c>0);return b}function syncChildViewColumnRange(o,i,j,q){var f=fpSpreadJS.childViewIndexes.length;if(f>0){var c=FpSpreadJS.getChildViews(o),h=c[0].GetColCount();if(i<0)i=0;if(j<0)j=h-1;if(i>j)return;if(q)for(var a=0;a<f;a++)syncChildViewColumnRange(c[a],-1,-1);var p=0,k=o.getParentSpread();while(k!=null){p++;k=k.getParentSpread()}c=findChildViewsByLevel(getTopSpread(),p+1);f=c.length;for(var g=[],a=0;a<h;a++)g.push(0);for(var d=0;d<f;d++){var b=c[d];if(!b.initialized)continue;b.__columnWidths=[];for(var a=0;a<h;a++){var m=b.getColHeader(),e=0;if(m!=null){var l=getRealColWidth(m,a);e=l}var r=b.getViewport(),l=getRealColWidth(r,a);if(e<l)e=l;if(g[a]<e)g[a]=e;b.__columnWidths.push(e)}}for(var d=0;d<f;d++){var b=c[d];if(!b.initialized)continue;for(var n=b.__columnWidths,a=0;a<h;a++)n[a]<g[a]&&b.setColWidth(a,g[a],n[a]);b.__columnWidths=null}}}function syncRowRangeSafeMode(d,e,b,a){var c=GetRowCountInternal();!b&&!a&&c>0&&preProcessSyncrhonzing();if(arguments.length==1&&typeof arguments[0].startRow!="undefined")syncRowRange(arguments[0]);else syncRowRange(d,e,b,a);!b&&!a&&c>0&&afterProcessSyncrhonzing()}function syncRowRange(a,b,f,i,z){if(arguments.length==1&&typeof arguments[0].startRow!="undefined"){var k=arguments[0];b=k.endRow;f=k.isColumnHeader;i=k.isColumnFooter;z=k.fixZoomPrecision;a=k.startRow}if(a==b&&a==-1){if(f){var C=getFrozColHeader()||getColHeader();b=C!=null?C.rows.length-1:-1}else if(i){var B=getFrozColFooter()||getColFooter();b=B!=null?B.rows.length-1:-1}else{var D=getViewport2()||getViewport();b=D!=null?D.rows.length-1+frzRows:frzRows-1}a=0}else if(a<0||b<0||a>b||!f&&a>=GetRowCountInternal())return;var A=GetRowCountInternal();if(b>=A)b=A-1;if(!f&&!i&&a<frzRows&&b>=frzRows){syncRowRange(a,frzRows-1,false);syncRowRange(frzRows,b,false);return}var p=getCorner()!=null&&getCorner().getAttribute("allowTableCorner");if(f&&p){a=0;b=frzCols>0?getFrozColHeader().rows.length-1:getColHeader()!=null?getColHeader().rows.length-1:-1}else if(i){a=0;b=frzCols>0?getFrozColFooter()!=null?getFrozColFooter().rows.length-1:-1:getColFooter()!=null?getColFooter().rows.length-1:-1}else{var q=findCrossedSpanCells(a,b,!f,f,!f);if(q!=null&&q.length>0){var H=getRowRange(q);a=Math.min(a,H.startRow);b=Math.max(b,H.endRow)}}if(b>=a){var o=getViewportFrozenRowCount(),I=!i&&!f&&a<o;if(!I&&!i&&!f){a-=o;b-=o}var h;if(f){h=[getFrozColHeader(),getColHeader()];p&&h.push(getCorner())}else if(i)h=[getFrozColFooter(),getColFooter()];else h=I?[getFrozRowHeader(),getViewport0(),getViewport1()]:[getRowHeader(),getViewport2(),getViewport()];$$.utils.cleanArray(h);for(var l=h.length,e=0;e<l;e++)h[e].style.height="";if(f&&!p&&getCorner()!=null){var F=getCorner().rows[0];if(F!=null)if(!spreadView.HasFilterBar())F.style.height="";else spreadView.SyncCornerWithFilterBar(getCorner(),getColHeader()||getFrozColHeader())}for(var r=false,e=0;e<l;e++){var J=h[e];r|=Number(J.cellSpacing)>0;var g=J.rows;if(b>=g.length)b=g.length-1;for(var d=a;d<=b;d++){var c=g[d];if(c.unchangedHeight)c.unchangedHeight=null;var G=-1;if(c.synDelt!=null){G=c.offsetHeight;c.style.height=Math.max($$(c).height()-c.synDelt,0)+"px";c.synDelt=null}var w=getFirstNonSpanCell(c);if(w!=null){w.style.height="";if(w!=c.cells[0])c.cells[0].style.height=""}if(z&&c.offsetHeight==G)c.unchangedHeight=1}}for(var j=[],E=[],s=-Number.MAX_VALUE,t=$$.browser.quirksMode,d=a;d<=b;d++)j.push(0);for(var e=0;e<l;e++){var g=h[e].rows;if((t||r||a==0)&&g.length>0){var x=getRowOffsetTop(g[0],h[e]);E.push(x);if(s<x)s=x}for(var d=a;d<=b;d++){var y=g[d],n=y.offsetHeight;if(n==0&&y.style.height!="")n=parseInt(y.style.height);if(j[d-a]<n)j[d-a]=n}}for(var u=getViewport(),K=u!=null&&fpSpreadJS.childViewIndexes.length>0,e=0;e<l;e++){for(var g=h[e].rows,d=a;d<=b;d++){var c=g[d],m=1;if(K&&!t){var L=FpSpreadJS.isChildSpreadRow(u,d);if(L){var M=u.rows[d].cells[0].children[0];m=0}}if(!c.unchangedHeight||j[d-a]!=c.offsetHeight)c.style.height=j[d-a]+m+"px";else if(c.unchangedHeight)c.unchangedHeight=null;c.synDelt=m==0?null:m}if((t||r||a==0)&&a==0){var v=s-E[e];g[0].style.height=$$(g[0]).height()+v+"px";g[0].synDelt=g[0].synDelt==null?v:g[0].synDelt+v}}}}function setSelectType(a){selectType=a}this.getViewport0=getViewport0;this.getViewport1=getViewport1;this.getViewport2=getViewport2;this.getViewport=getViewport;this.getViewportHolder=getViewportHolder;this.getColFooter=getColFooter;this.getFrozColFooter=getFrozColFooter;this.getColHeader=getColHeader;this.getFrozColHeader=getFrozColHeader;this.getRowHeader=getRowHeader;this.getFrozRowHeader=getFrozRowHeader;this.GetRowCountInternal=GetRowCountInternal;this.getRowKeyFromRow=getRowKeyFromRow;this.getColKeyFromCol=getColKeyFromCol;this.getTitleBar=getTitleBar;this.getSubTitleBar=getSubTitleBar;this.IsChildSpreadRow=IsChildSpreadRow;this.frzRowCount=frzRowCount;this.frzColCount=frzColCount;this.getRowKeyFromCell=getRowKeyFromCell;this.getColKeyFromCell2=getColKeyFromCell2;this.getColFromCell=getColFromCell;this.getColGroup=getColGroup;this.GetSelectedRanges=GetSelectedRanges;this.GetSelectedRange=GetSelectedRange;this.getSelection=getSelection;this.updateSelectionViewIndexes=updateSelectionViewIndexes;this.getAttributeInternal=getAttributeInternal;this.getRowFromCell=getRowFromCell;this.getRowIndexFromRow=getRowIndexFromRow;this.getViewportFromCell=getViewportFromCell;this.getCellFromRowCol=getCellFromRowCol;this.getRowByKey=getRowByKey;this.getColByKey=getColByKey;this.getLeadingCellRow=getLeadingCellRow;this.getLeadingCellCol=getLeadingCellCol;this.setLeadingCell=setLeadingCell;this.setStartSelectLocation=setStartSelectLocation;this.getTopSpread=getTopSpread;this.isChild=isChild;this.getScrollvp=getScrollvp;this.getCell=getCell;this.getSafeMaxScrollValues=getSafeMaxScrollValues;this.getCorner=getCorner;this.getFooterCorner=getFooterCorner;this.setActiveSpread=setActiveSpread;this.isWorking=isWorking;this.isInitialized=isInitialized;this.isIgnorePostbackEditmode=isIgnorePostbackEditmode;this.findContentTag=findContentTag;this.moveDown=moveDown;this.saveScrollbarState=saveScrollbarState;this.saveData=saveData;this.fireAutoFilteringColumn=fireAutoFilteringColumn;this.syncData=syncData;this.GetSheetIndex=GetSheetIndex;this.setFpPostOn=setFpPostOn;this.getSpreadControl=getSpreadControl;this.openWaitMsg=openWaitMsg;this.closeWaitMsg=closeWaitMsg;this.GetColCount=GetColCount;this.processResize=processResize;this.getEditor=getEditor;this.setEditorFocus=setEditorFocus;this.clearOldEditorValue=clearOldEditorValue;this.initSelection=initSelection;this.dispose=dispose;this.init=init;this.focus=focus;this.getMccbID=getMccbID;this.syncRowHeaderWidth=syncRowHeaderWidth;this.syncRowRangeSafeMode=syncRowRangeSafeMode;this.sizeSpread=sizeSpread;this.initLayout=initLayout;this.getCommandBar=getCommandBar;this.getPager1=getPager1;this.getPager2=getPager2;this.getHierBar=getHierBar;this.getPreferredCellWidth=getPreferredCellWidth;this.fireSelectionChangedEvent=fireSelectionChangedEvent;this.fireActiveCellChangingEvent=fireActiveCellChangingEvent;this.fireActiveCellChangedEvent=fireActiveCellChangedEvent;this.getActiveRow=getActiveRow;this.getActiveCol=getActiveCol;this.GetPageActiveSpread=GetPageActiveSpread;this.ClearSelection=ClearSelection;this.select=select;this.selectRow=selectRow;this.selectColumn=selectColumn;this.syncColSelection=syncColSelection;this.isColSelected=isColSelected;this.getHeaderCellFromRowCol=getHeaderCellFromRowCol;this.setValidatorPos=setValidatorPos;this.showMsg=showMsg;this.getSpanCell=getSpanCell;this.getSpanCells=getSpanCells;this.inactiveAllChart=inactiveAllChart;this.DoEndEdit=DoEndEdit;this.setTextBoxFocus=setTextBoxFocus;this.getTextBox=getTextBox;this.GetActiveChartObj=GetActiveChartObj;this.isSmartPaint=isSmartPaint;this.isMBSmartPaint=function(){return uiVirtualization};this.getDummy=getDummy;this.getNoRow=getNoRow;this.hideSelectionBlock=hideSelectionBlock;this.attachOnActiveEvents=attachOnActiveEvents;this.detachOnActiveEvents=detachOnActiveEvents;this.setActiveField=setActiveField;this.clearSelectedNumericCellTypeCell=clearSelectedNumericCellTypeCell;this.setAnchorCell=setAnchorCell;this.setActiveRow=setActiveRow;this.setActiveCol=setActiveCol;this.SetActiveSpreadID=setActiveSpreadID;this.paintAnchorCell=paintAnchorCell;this.saveAnchorCell=saveAnchorCell;this.findAnchorCell=findAnchorCell;this.getCellType=getCellType;this.getCellType2=getCellType2;this.paintSelections=paintSelections;this.paintSelection=paintSelection;this.paintMultipleRowSelection=paintMultipleRowSelection;this.paintHeaderSelection=paintHeaderSelection;this.scrollToCell=scrollToCell;this.backupTablePositions=backupTablePositions;this.restoreTablePositions=restoreTablePositions;this.scrollView=scrollView;this.scrollByMoving=scrollByMoving;this.scrollByMovingForTouch=scrollByMovingForTouch;this.paintSelectedCell=paintSelectedCell;this.getParentSpread=getParentSpread;this.rangeIntersection=rangeIntersection;this.GetActiveChartObj=GetActiveChartObj;this.getChartObj=getChartObj;this.mouseDown=mouseDown;this.mouseUp=mouseUp;this.mouseMove=mouseMove;this.startHandlingDocumentMouse=startHandlingDocumentMouse;this.stopHandlingDocumentMouse=stopHandlingDocumentMouse;this.clearMouseCachedVariables=clearMouseCachedVariables;this.getSizeColumn=getSizeColumn;this.getSizeRow=getSizeRow;this.initPlugIns=initPlugIns;this.paintFocusRect=paintFocusRect;this.hideFocusBorder=hideFocusBorder;this.onStartResizing=onStartResizing;this.onContinueResizing=onContinueResizing;this.onStopResizing=onStopResizing;this.onStartColumnMoving=onStartColumnMoving;this.onContinueColumnMoving=onContinueColumnMoving;this.onStopColumnMoving=onStopColumnMoving;this.onStopSelecting=onStopSelecting;this.dblclick=dblclick;this.getGroupBar=getGroupBar;this.spreadActive=spreadActive;this.initAnchorCell=initAnchorCell;this.isNeedScroll=isNeedScroll;this.isInShowPage=isInShowPage;this.getXmlActiveRow=getXmlActiveRow;this.getXmlActiveCol=getXmlActiveCol;this.setSelectType=setSelectType;this.doGetFocus=doGetFocus;this.prepairEditCell=prepairEditCell;this.getClipboardState=getClipboardState;this.processEditMode=processEditMode;this.correctFocusOnActiveCell=function(b,a){fpSpreadJS.correctFocusOnActiveCell(b||anchorCell,a)};this.getUIViewportList=function(){return vpList};this.getUIViewport2List=function(){return vp2List};this.getUIRowHeaderList=function(){return rhList};this.translateKey=translateKey;this.resetBlurFlag=resetBlurFlag;this.setIgnoreBlur=function(a){ignoreBlur=a};this.isInTouchAjax=isInTouchAjax;this.getEditorFocusFunction=function(a){return getFunction(a+"_setFocus")};this.getRangeFromNode=getRangeFromNode;this.isDragSlideBar=function(){return dragSlideBar};this.switchHiddenTextBox=switchHiddenTextBox;this.createTextbox=createTextbox;this.setActiveSpread=setActiveSpread;this.setActiveSpreadManually=setActiveSpreadManually;this.getColKeyFromCell=getColKeyFromCell;this.getColGroupColumnWidth=getColGroupColumnWidth;this.attachScrollEvents=attachScrollEvents;this.detachScrollEvents=detachScrollEvents;this.hasChart=hasChart;this.anyReadOnlyCell=anyReadOnlyCell;this.getClipboardData=getClipboardData;this.getSpreadTables=getSpreadTables;this.getCorner=getCorner;this.getCellEditorID=getCellEditorID;this.getCellEditor=getCellEditor;this.getValueFromRender=getValueFromRender;this.getFormulaFromCell=getFormulaFromCell;this.getRender=getRender;this.setEditorValue=setEditorValue;this.isDirty=function(){return dirty};this.fpCloneNode=fpCloneNode;this.IsInRowEditTemplate=IsInRowEditTemplate;this.getElementById=getElementById;this.fireSpreadEvent=fireSpreadEvent;this._getFpRefProperty=_getFpRefProperty;function isSmartPaint(){return smartPaint}function initPlugIns(h,b){if(spreadView.IsMultiColumnComboBox&&!spreadView.GetHostSpread().getSpreadView)return;var j=new FarPoint.Web.Spread.TouchController;j.Attach(element,b==null?null:b.Touch);if(spreadView.Parent==null&&element.isInTouchMode){var e=(spreadView.GetActiveSpreadView(false,true)||spreadView).Spread,a=e!=null?e.getSpreadView():null;if(a==null)return;if(h!=null&&h.length>0)spreadView.Touch.touchInfo=null;if(a.GetTopSpreadView()==spreadView)a.Touch.IsInTouchMode=true;var c=a._GetActiveCellRange(),d=false;if(c!=null&&a.OperationMode==$$.OperationModes.NORMAL){if(b.ActiveRow!=-1||b.ActiveColumn!=-1)d=!a._IsValidTouchActiveCell(c,b);else d=true;d&&a.CorrectAnchorCell(c,false,true)}var i=a.CorrectSelection(true),g=GetActiveChartObj();if(g!=null)g.buildResizeCorner();else if(i){var f=a.GetSpreadContext();f.paintSelections(true,true);f.paintAnchorCell(true,true)}if(e!=null)delete element.isInTouchMode}}function isInTouchAjax(){return getTopSpread(element).isInTouchMode}this.init()}