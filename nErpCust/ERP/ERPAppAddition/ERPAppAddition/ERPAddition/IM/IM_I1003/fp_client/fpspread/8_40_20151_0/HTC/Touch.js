//
//	  Copyright (C) 2003-2015 GrapeCity Inc.	All rights reserved.
//

var __extends=this.__extends||function(b,a){for(var c in a)if(a.hasOwnProperty(c))b[c]=a[c];function d(){this.constructor=b}d.prototype=a.prototype;b.prototype=new d},FarPoint;(function(a){var b;(function(b){var c;(function(e){"use strict";var n;(function(a){a[a.None=0]="None";a[a.Selection=1]="Selection";a[a.Resize=2]="Resize";a[a.HeaderSelection=3]="HeaderSelection";a[a.ColumnMove=4]="ColumnMove";a[a.Dragging=5]="Dragging"})(n||(n={}));(function(a){a[a.Cell=0]="Cell";a[a.Column=1]="Column";a[a.Row=2]="Row";a[a.Chart=3]="Chart"})(e.TouchStripShowingArea||(e.TouchStripShowingArea={}));var p=e.TouchStripShowingArea;(function(a){a[a.None=0]="None";a[a.HorizontalOnly=1]="HorizontalOnly";a[a.VerticalOnly=2]="VerticalOnly";a[a.Both=3]="Both"})(e.PanningMode||(e.PanningMode={}));var q=e.PanningMode,l=function(){function a(){}a.prototype.Attach=function(a){this.Spread=a};a.prototype.Detach=function(){this.Spread=null};return a}();e.PointerController=l;var f=function(f){__extends(e,f);function e(){f.call(this);this.SELECTION_1_HANDLE=0;this.SELECTION_2_HANDLE=1;this.RESIZE_COLUMN_HANDLE=2;this.RESIZE_ROW_HANDLE=3;this.DOUBLE_TAP_TIME=500;this.DOUBLE_TAP_THRESHOLD=10*10;this.ACTION_THRESHOLD=10;this.TOUCH_STRIP_SHOW_TIME=150;this.HOLD_AND_RELEASE_INACTIVE=0;this.HOLD_AND_RELEASE_ACTIVE=1;this.HOLD_AND_RELEASE_ACTIVE_NOT_FIRE=2;this.holdAndReleaseState=0;this.currentAction=0;this.handleIndex=-1;this.selectStartColumn=-1;this.selectStartRow=-1;this.isOnTheFlyCreatedSelection=false;this.selectionHandleHalfSize=-1;this.cancelMouseEvents=false;this.ignoreProcessDoubleTap=false}Object.defineProperty(e.prototype,"IsInTouchMode",{"get":function(){var a=this.SpreadView;if(a.Parent!=null){var b=a.GetTopSpreadView();return b.Touch?b.Touch.isInTouchMode:false}return this.isInTouchMode},"set":function(i){var h=this.SpreadView,f=h.GetTopSpreadView();if(f.Touch.isInTouchMode!=i){var l=h.GetSpreadContext(),b=h.GetActiveSpreadView(false,true),e=b?b.GetSpreadContext():null,d=f.Spread.GetActiveChartObj();if(d==null)if(i)b.IsShowFocusRectangle()&&e.hideFocusBorder();else{!this.ignoreHidePopup&&b.HidePopup();b.__ClearOldAnchorCell(e.getXmlActiveRow(),e.getXmlActiveCol());b.HideFocusRectangle();b.IsShowFocusRectangle()&&e.paintFocusRect()}else b.HideFocusRectangle();var j=b?b.Touch||this:this,a=b!=null?b:h,c=e||l;if(d==null){a.SuspendShowFocusRectangle();if(a.OperationMode==2)c.paintSelections(false,false);else{c.paintSelections(false,true);a.__ClearOldAnchorCell(null,null,true)}a.ResumeShowFocusRectangle()}f.Touch.isInTouchMode=i;var g=a.IsRetainSelection()||a.ContainsActive();if(g&&d==null)if(a.OperationMode==2)c.paintSelections(true,false);else c.paintSelections(true,true);if(d==null)if(i){var k=a._GetActiveCellRange();if(k!=null&&a.OperationMode==0&&!a._IsValidTouchActiveCell(k)){a.CorrectAnchorCell(k,false,true);a.CorrectSelection(true)&&g&&c.paintSelections(true,true)}if(g){c.paintAnchorCell(true,true);a.CorrectPaintSelection()}j.UpdateResizeLocation();g&&a.ShowFocusRectangle()}else{j.SetResizeLocation(null);j.ShowHandles(false,false);g&&c.paintAnchorCell(true,true)}d=j.Spread.GetActiveChartObj();d!=null&&d.buildResizeCorner();if(!h.IsMultiColumnComboBox)if(i)f.StartTrackingLocation();else f.StopTrackingLocation()}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"HandleIndex",{"get":function(){return this.handleIndex},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"IsMSGestureSupport",{"get":function(){return typeof MSGesture!="undefined"},enumerable:true,configurable:true});e.prototype.GetSharedVariable=function(b){var a=this.SpreadView;if(a.Parent!=null)return a.GetTopSpreadView().Touch[b];else if(a.IsMultiColumnComboBox){var c=a.GetHostSpread();if(c!=null&&c!=this.Spread){var d=c.getSpreadView().GetTopSpreadView().Touch;return d?d[b]:null}}return this[b]};e.prototype.SetSharedVariable=function(b,d){var a=this.SpreadView;if(a.Parent!=null)a.GetTopSpreadView().Touch[b]=d;else if(a.IsMultiColumnComboBox){var c=a.GetHostSpread();if(c!=null&&c!=this.Spread)c.getSpreadView().GetTopSpreadView().Touch[b]=d}else this[b]=d};Object.defineProperty(e.prototype,"IgnoreContextMenuEvent",{"get":function(){return this.GetSharedVariable("ignoreContextMenuEvent")},"set":function(a){this.SetSharedVariable("ignoreContextMenuEvent",a)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"HoldAndReleaseState",{"get":function(){return this.GetSharedVariable("holdAndReleaseState")},"set":function(a){this.SetSharedVariable("holdAndReleaseState",a)},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"TouchInfo",{"get":function(){if(this.touchInfo==null){var a=this.Spread.getAttribute("touchInfo");if(a!=null&&a.length>0)this.touchInfo=this.ConvertTouchInfo(JSON.parse(a));else if(!this.SpreadView.IsMultiColumnComboBox&&this.SpreadView.Parent)this.touchInfo=this.SpreadView.Parent.Touch.TouchInfo}return this.touchInfo},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"IsProcessing",{"get":function(){return this.currentAction!=0},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"ResizeLocation",{"get":function(){return this.resizeLocation},"set":function(a){if(this.resizeLocation!=a&&(this.resizeLocation==null||a==null||this.resizeLocation.Row!=a.Row||this.resizeLocation.Column!=a.Column||this.resizeLocation.Index!=a.Index)){this.SetResizeLocation(a);this.ShowHandles(true,false)}},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"IsClickSimulating",{"get":function(){return this.isClickSimulating},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"SpreadView",{"get":function(){return this.Spread.getSpreadView()},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"SpreadContext",{"get":function(){return this.SpreadView.GetSpreadContext()},enumerable:true,configurable:true});Object.defineProperty(e,"ActiveTouchStrip",{"get":function(){return e.activeTouchStrip},"set":function(a){e.activeTouchStrip=a},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"IsTouchStripOpened",{"get":function(){var a=e.ActiveTouchStrip;return a!=null&&a.Spread==this.Spread},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"IsTouchStripOpening",{"get":function(){return this.showTouchStripTimeoutId!=null||this.IsTouchStripOpened},enumerable:true,configurable:true});e.prototype.IsDeactivateSpread=function(){var b=this.SpreadView,a=b.GetTopSpreadView().Spread.GetActiveChildSheetView();return a!=null&&a!=this.Spread||a==null&&b.GetTopSpreadView()!=b};e.prototype.GetOverlapNativeControlVisibilities=function(f){var g=[true,true,true,true];if(f!=null)for(var k=2,l=4,e=["SELECT","INPUT","BUTTON"],d=0;d<e.length;d++){var b=f.getElementsByTagName(e[d]);if(b!=null)for(var c=0;c<b.length;c++)for(var i=b[c].getBoundingClientRect(),a=k;a<l;a++){var j=this.touchHandles[a],h=j.getBoundingClientRect();if($$.utils.isIntersectRect(i,h))g[a]=false}}return g};e.prototype.HideHandles=function(c){var b=this.touchHandles;if(b!=null)for(var d=c?2:4,a=0;a<d;a++)if(b[a]!=null)b[a].style.display=""};e.prototype.CanShowEditingHandles=function(){if(this.handleIndex==this.SELECTION_1_HANDLE||this.handleIndex==this.SELECTION_2_HANDLE)return true;var a=this.SpreadView,b=this.Spread;if(a.OperationMode!=4&&a.CanSelectMultiRange()&&!b.isEditing())if(!this.IsTouchStripOpening&&(window.event==null||!$$.utils.isNativeControl(window.event.srcElement||window.event.target,true))&&!a.IsPopupOpened()){var c=b.getAnchorCell();return!a._IsCellHidden(c,true)&&a.NeedSetEditorFocusOnActiveCell()?!b.fpSpreadJS.correctFocusOnActiveCell(c,false,true):true}else return true;return false};e.prototype.ShowHandles=function(L,H){if(this.Spread==null)return;var a=this.SpreadView;if(L==null)L=true;if(H==null)H=true;if(!this.IsInTouchMode)return;if(this.IsDeactivateSpread())return;var S=false,d=a._GetActiveCellRange();if(a.OperationMode==5||a.OperationMode==4)S=a.SelectionModel.IsEmpty()||d!=null&&!d.Equals(a.SelectionModel.GetFocusCellRange());if(d==null&&this.Spread.GetActiveChartObj()!=null)return;var G=document.activeElement;if(G!=null&&$$.utils.isNativeControl(G)&&(a.IsInFilterBar(G)||a.IsInViewport(G))){var T;if(this.Spread.isEditing()||(T=a.GetActiveSpread())!=null&&T.getSpreadView().GetTopSpreadView()==a.GetTopSpreadView()){H=false;this.HideHandles(true)}}this.touchHandles==null&&this.CreateHandles();var p,k=this.touchHandles,C=a._GetFocusRectangle(true,true);if(C!=null){var eb=a.TOP,db=a.LEFT,cb=a.RIGHT,bb=a.BOTTOM,y=C[eb],x=C[db],z=C[bb],w=C[cb],c=[],l=[];if(d!=null&&this.CanShowEditingHandles()){var Z=this.SpreadContext,fb=Z.getViewportHolder();if(this.selectionHandleHalfSize==-1){k[0].style.opacity="0.01";k[0].style.display="block";this.selectionHandleHalfSize=k[0].children[0].offsetWidth/2;if(this.selectionHandleHalfSize>8){k[0].children[0].style.marginTop=-this.selectionHandleHalfSize+"px";k[0].children[0].style.marginLeft=-this.selectionHandleHalfSize+"px";k[1].children[0].style.marginTop=-this.selectionHandleHalfSize+"px";k[1].children[0].style.marginLeft=-this.selectionHandleHalfSize+"px"}k[0].style.display="";k[0].style.opacity="1"}if(d.Row==-1){if(d.Column==-1)c[0]=c[1]=false;else if(a.RowCount>0)if(a._GetRowTop()>-1){var A=-1;c[0]=x.style.display!="none";c[1]=w.style.display!="none";if(a.Parent==null)A=c[0]||c[1]?Math.floor(Math.max(x.offsetHeight,w.offsetHeight))/2:-1;else{var V=a.GetSpreadContext().getTopSpread();p=V.getSpreadView().Viewport.parentElement;var e=p.parentElement.getBoundingClientRect(),t=(x.style.display!="none"?x:w).getBoundingClientRect(),h=a.GetSpreadContext().rangeIntersection(e.top,e.left,e.height,e.width,t.top,t.left,t.height,t.width);A=h==null?0:h.rowCount/2}if(c[0])l[0]={x:x.offsetLeft-this.selectionHandleHalfSize,y:x.offsetTop+A};if(c[1])l[1]={x:w.offsetLeft+this.selectionHandleHalfSize,y:w.offsetTop+A}}else{var b=a._GetCellRangePaintInfo(d.Row,d.Column,d.RowCount,d.ColumnCount,d.LayoutRow,false,true);c[0]=b&&b.Visibility.Left&&b.FocusRect.Y2>b.FocusRect.Y1;c[1]=b&&b.Visibility.Right&&b.FocusRect.Y2>b.FocusRect.Y1;var A=c[0]||c[1]?Math.floor(b.FocusRect.Y2-b.FocusRect.Y1)/2:-1;if(c[0])l[0]={x:b.BoundingRect.X1-(this.selectionHandleHalfSize+1),y:b.BoundingRect.Y1+A};if(c[1])l[1]={x:b.BoundingRect.X2+this.selectionHandleHalfSize,y:b.BoundingRect.Y1+A}}}else if(d.Column==-1)if(!S&&a.ColumnCount>0)if(a._GetColumnLeft()>-1){var B=-1;c[0]=y.style.display!="none";c[1]=z.style.display!="none";if(a.Parent==null)B=c[0]||c[1]?Math.floor(Math.max(y.offsetWidth,z.offsetWidth))/2:-1;else{var V=a.GetSpreadContext().getTopSpread();p=V.getSpreadView().Viewport.parentElement;var e=p.parentElement.getBoundingClientRect(),t=a.Viewport.getElementsByTagName("tbody")[0].getBoundingClientRect(),h=a.GetSpreadContext().rangeIntersection(e.top,e.left,e.height,e.width,t.top,t.left,t.height,t.width);B=h==null?0:h.colCount/2}if(c[0])l[0]={x:y.offsetLeft+B,y:y.offsetTop-this.selectionHandleHalfSize};if(c[1])l[1]={x:z.offsetLeft+B,y:z.offsetTop+this.selectionHandleHalfSize}}else{var b=a._GetCellRangePaintInfo(d.Row,d.Column,d.RowCount,d.ColumnCount,d.LayoutRow,false,true);c[0]=b&&b.Visibility.Top&&b.FocusRect.X2>b.FocusRect.X1;c[1]=b&&b.Visibility.Bottom&&b.FocusRect.X2>b.FocusRect.X1;var B=c[0]||c[1]?Math.floor(b.FocusRect.X2-b.FocusRect.X1)/2:-1;if(c[0])l[0]={x:b.BoundingRect.X1+B,y:b.BoundingRect.Y1-(this.selectionHandleHalfSize+1)};if(c[1])l[1]={x:b.BoundingRect.X1+B,y:b.BoundingRect.Y2+this.selectionHandleHalfSize}}else c[0]=c[1]=false;else if(a.IsRowLayoutMode||(a.SelectionBlockOptions&1)!=1)c[0]=c[1]=false;else{c[0]=y.style.display!="none"&&x.style.display!="none";if(c[0])l[0]={x:y.offsetLeft,y:y.offsetTop};c[1]=z.style.display!="none"&&w.style.display!="none";if(c[1])l[1]={x:w.offsetLeft,y:z.offsetTop}}if(H&&this.SpreadView.CanSelectMultiRange()&&!this.Spread.isEditing())for(var i=0;i<2;i++)if(c[i]){var I=k[i];I.style.display="block";I.style.left=l[i].x+"px";I.style.top=l[i].y+"px";I.style.zIndex=(this.SpreadView.GetTopZIndexChart()+1).toString(10)}else k[i].style.display=""}else for(var i=0;i<2;i++)k[i].style.display=""}if(L){if(this.resizeLocation!=null&&this.resizeLocation.Row<a.FlattenRows.length&&this.resizeLocation.Column<a.ColumnCount){var F=false,D=false,n,v,q,m,o=2,r=a.CellSpacing;if(this.resizeLocation.Row==-1){if(a.ColumnHeader.RowCount>0){var b=a._GetCellRangePaintInfo(-1,this.resizeLocation.Column,-1,1,null,false,true);if(b){F=b.Visibility.Right&&a.Columns[this.resizeLocation.Column].Sizable;n=b.BoundingRect.X2;var g=this.touchHandles[this.RESIZE_COLUMN_HANDLE];g.style.opacity="0.001";this.ShowResizeHandle(true,true);var X=g.offsetHeight,O=g.offsetParent;if(O==null)return;var N=Math.floor($$.utils.getBoundingClientRect(O).top);q=Math.floor(b.BoundingClientRect.top)-N-o;g.style.opacity="1";this.ShowResizeHandle(true,false);if(!a.IsRowLayoutMode&&a.AllowHeaderResize()&&a.ColumnHeader.GetSizable(this.resizeLocation.Index)){var s=d==null||this.resizeLocation.Column==d.Column||d.Row>=0||d.Column<0?b:a._GetCellRangePaintInfo(-1,d.Column,-1,1,null,false,true);if(s){D=s.Visibility.Left;v=s.BoundingRect.X1;m=Math.floor(s.BoundingClientRect.top)-N-(o>>1)}}if(r>0){q-=r-o;m-=r-(o>>1);n-=o>>1}q-=a.FilterBarHeight;m-=a.FilterBarHeight;for(var J=a.ColumnHeaders[0],i=this.resizeLocation.Index+1;i<a.ColumnHeader.RowCount;i++){var W=J.rows[i].offsetHeight+r;q-=W;m-=W}q-=X;if(this.currentAction==2){var u=a._GetSizeBar();if(u!=null)if(this.handleIndex==this.RESIZE_COLUMN_HANDLE)n+=Math.floor(u.getBoundingClientRect().left)-Math.floor(b.BoundingClientRect.right);else m+=Math.floor(u.getBoundingClientRect().top)+u.offsetHeight/2-Math.floor(J.rows[this.resizeLocation.Index].getBoundingClientRect().bottom);else{var ab=a.GetSpreadContext().getColGroup(J).childNodes[this.resizeLocation.Column];n+=parseInt(ab.width)-a.Columns[this.resizeLocation.Column].Width}}if(F){g.style.left=n+(o>>1)-parseInt($$(g).style("width"))/2+"px";g.style.top=q+"px";g.style.opacity="0.001";this.ShowResizeHandle(true,true);var E=this.GetOverlapNativeControlVisibilities(a.ColumnHeader._GetHtmlCell(this.resizeLocation.Index,this.resizeLocation.Column));!E[this.RESIZE_COLUMN_HANDLE]&&this.ShowResizeHandle(true,false);if(a.Parent!=null){p=a.GetTopSpreadView().Viewport.parentElement;var e=p.parentElement.getBoundingClientRect(),f=g.getBoundingClientRect(),h=a.GetSpreadContext().rangeIntersection(e.top,e.left,e.height,e.width+f.width,f.top,f.left,f.height,f.width);(h==null||h!=null&&h.colCount<=f.width/2)&&this.ShowResizeHandle(true,false)}g.style.opacity="1"}else this.ShowResizeHandle(true,false);if(D){var j=this.touchHandles[this.RESIZE_ROW_HANDLE];j.style.left=v+"px";j.style.top=m-parseInt($$(j).style("height"))/2+"px";j.style.opacity="0.001";this.ShowResizeHandle(false,true);var M=this.resizeLocation.Column;if(!a.IsRowLayoutMode&&a.AllowHeaderResize())M=d==null||d.Row>=0?M:d.Column;var E=this.GetOverlapNativeControlVisibilities(a.ColumnHeader._GetHtmlCell(this.resizeLocation.Index,M));!E[this.RESIZE_ROW_HANDLE]&&this.ShowResizeHandle(false,false);if(a.Parent!=null){p=a.GetTopSpreadView().Viewport.parentElement;var e=p.parentElement.getBoundingClientRect(),f=j.getBoundingClientRect(),h=a.GetSpreadContext().rangeIntersection(e.top,e.left,e.height,e.width,f.top,f.left,f.height,f.width);(h==null||h!=null&&h.rowCount<=f.height/2)&&this.ShowResizeHandle(false,false)}j.style.opacity="1"}else this.ShowResizeHandle(false,false);return}}}else if(a.RowHeader.ColumnCount>0){var j=this.touchHandles[this.RESIZE_ROW_HANDLE];b=a._GetCellRangePaintInfo(this.resizeLocation.Row,-1,1,-1,null,false,true);if(b){if(a.AllowHeaderResize()&&a.RowHeader.GetSizable(this.resizeLocation.Index)){var s=d==null||this.resizeLocation.Row==d.Row||d.Column>=0||d.Row<0?b:a._GetCellRangePaintInfo(d.Row,-1,1,-1,null,false,true);if(s!=null){F=s.Visibility.Top;n=s.FocusRect.X1;q=s.FocusRect.Y1+1}else return}D=a.FlattenRows[this.resizeLocation.Row].Sizable&&b.Visibility.Bottom;v=b.FocusRect.X1;m=b.FocusRect.Y2+(o>>1);for(var R=a.RowHeaders[0],P=R.getBoundingClientRect().right,i=this.resizeLocation.Index+1;i<a.RowHeader.ColumnCount;i++){var K=a.RowHeader.GetColumnWidth(i)+r;n-=K;P-=K;v-=K}var Y=$$.utils.offsetHeight(j.childNodes[0],j);v-=Y;if(r>0){var Q=a.FrozenColumnCount>0?r:Math.max(0,r-a._GetScrollableView().scrollLeft);q+=o>>1;n-=Q;v-=Q-(o>>1)}if(this.currentAction==2){var u=a._GetSizeBar();if(u!=null)if(this.handleIndex==this.RESIZE_COLUMN_HANDLE)n+=Math.floor(u.getBoundingClientRect().left)+u.offsetWidth/2-Math.floor(P)+r;else m+=Math.floor(u.getBoundingClientRect().bottom)-Math.floor(a._GetRow(this.resizeLocation.Row).HtmlRow.getBoundingClientRect().bottom);else{var U=a._GetRow(this.resizeLocation.Row).HtmlRow;m+=R.rows[U.rowIndex].offsetHeight-U.offsetHeight}}if(F){var g=this.touchHandles[this.RESIZE_COLUMN_HANDLE];g.style.left=n+(o>>1)-parseInt($$(g).style("width"))/2+"px";g.style.top=q+"px";g.style.opacity="0.001";this.ShowResizeHandle(true,true);var E=this.GetOverlapNativeControlVisibilities(a.RowHeader._GetHtmlCell(this.resizeLocation.Row,this.resizeLocation.Index));!E[this.RESIZE_COLUMN_HANDLE]&&this.ShowResizeHandle(true,false);if(a.Parent!=null){var p=a.GetTopSpreadView().Viewport.parentElement,e=p.parentElement.getBoundingClientRect(),f=g.getBoundingClientRect(),h=a.GetSpreadContext().rangeIntersection(e.top,e.left,e.height,e.width+f.width,f.top,f.left,f.height,f.width);(h==null||h!=null&&h.colCount<=f.width/2)&&this.ShowResizeHandle(true,false)}g.style.opacity="1"}else this.ShowResizeHandle(true,false);if(D){j.style.left=v+"px";j.style.top=m-parseInt($$(j).style("height"))/2+"px";j.style.opacity="0.001";this.ShowResizeHandle(false,true);var E=this.GetOverlapNativeControlVisibilities(a.RowHeader._GetHtmlCell(this.resizeLocation.Row,this.resizeLocation.Index));!E[this.RESIZE_ROW_HANDLE]&&this.ShowResizeHandle(false,false);if(a.Parent!=null){var p=a.GetTopSpreadView().Viewport.parentElement,e=p.parentElement.getBoundingClientRect(),f=j.getBoundingClientRect(),h=a.GetSpreadContext().rangeIntersection(e.top,e.left,e.height,e.width,f.top,f.left,f.height,f.width);(h==null||h!=null&&h.rowCount<=f.height/2)&&this.ShowResizeHandle(false,false)}j.style.opacity="1"}else this.ShowResizeHandle(false,false);return}}}this.ShowResizeHandle(true,false);this.ShowResizeHandle(false,false)}};e.prototype.CreateHandles=function(){var m=this.SpreadView,j=m._GetFocusRectangle(false,true);if(j==null)return;var d=Function.CreateDelegate,e=[],s=d(this,this.OnFocusRectanglePointerDown);if($$.browser.mb)e.push({Name:c.POINTER_DOWN,Handler:s});else navigator.msPointerEnabled&&e.push({Name:"MSPointerDown",Handler:s});m.IsMultiBrowserMode()&&e.push({Name:"touchstart",Handler:s});e.push({Name:"contextmenu",Handler:d(this,this.OnFocusRectangleContextMenu)});for(var f=0;f<j.length;f++)for(var n=j[f],b=0;b<e.length;b++)if($$.browser.mb){this.eventMan.Detach(n,e[b].Name,e[b].Handler,false);this.eventMan.Attach(n,e[b].Name,e[b].Handler,false)}else{n.removeEventListener(e[b].Name,e[b].Handler,false);n.addEventListener(e[b].Name,e[b].Handler,false)}this.attachedFocusRectangleHandlers=e;var n=j[m.TOP]||j[m.LEFT]||j[m.BOTTOM]||j[m.RIGHT];if(n){var k=document.getElementById(this.Spread.id+"_touchHandle1"),l,i,h;if(k==null){k=document.createElement("div");l=document.createElement("div");var p=document.createElement("div"),q=document.createElement("div");k.appendChild(p);l.appendChild(q);k.className="touchHandle";l.className="touchHandle";k.id=this.Spread.id+"_touchHandle1";l.id=this.Spread.id+"_touchHandle2";k.setAttribute("FpSpread","SelectionHandle");l.setAttribute("FpSpread","SelectionHandle");var g=this.TouchInfo;if(g){if(g.SelectionGripperBackColor!=null){p.style.backgroundColor=g.SelectionGripperBackColor;q.style.backgroundColor=g.SelectionGripperBackColor}if(g.SelectionGripperLineColor!=null){p.style.borderColor=g.SelectionGripperLineColor;q.style.borderColor=g.SelectionGripperLineColor}else{var t=this.Spread.getAttribute("FocusBorderColor");p.style.borderColor=t;q.style.borderColor=t}if(g.SelectionGripperThickness!=null){var w=g.SelectionGripperThickness+"px";p.style.borderWidth=w;q.style.borderWidth=w}}i=document.createElement("DIV");h=document.createElement("DIV");for(var v=document.createElement("DIV"),u=document.createElement("DIV"),f=0;f<4;f++){v.appendChild(document.createElement("DIV"));u.appendChild(document.createElement("DIV"))}i.appendChild(v);h.appendChild(u);i.className="touchResizeVerHandle";h.className="touchResizeHorHandle";i.id=this.Spread.id+"_touchResizeHandle1";h.id=this.Spread.id+"_touchResizeHandle2";i.setAttribute("FpSpread","ResizeHandle");h.setAttribute("FpSpread","ResizeHandle");var x=document.getElementById(this.Spread.id+"_sizeBar");if(x!=null){var r=parseInt($$(x).style("zIndex"));if(!isNaN(r)){r++;i.style.zIndex=r.toString(10);h.style.zIndex=r.toString(10)}}}else{l=document.getElementById(this.Spread.id+"_touchHandle2");i=document.getElementById(this.Spread.id+"_touchResizeHandle1");h=document.getElementById(this.Spread.id+"_touchResizeHandle2")}this.touchHandles=[k,l,i,h];$$.utils.AttachToSpread(this.Spread,this.touchHandles);var a=[];if($$.browser.mb){a.push({Name:c.POINTER_DOWN,Handler:d(this,this.OnTouchHandlePointerDown)});$$.browser.isTouchEventModel&&a.push({Name:c.POINTER_MOVE,Handler:d(this,this.OnTouchHandlePointerMove)});a.push({Name:c.POINTER_UP,Handler:d(this,this.OnTouchHandlePointerUp)});a.push({Name:c.POINTER_CANCEL,Handler:d(this,this.OnTouchHandlePointerCancel)});a.push({Name:c.GESTURE_START,Handler:d(this,this.OnTouchHandleGestureStart)});a.push({Name:c.GESTURE_CHANGE,Handler:d(this,this.OnTouchHandleGestureChange)});a.push({Name:c.GESTURE_END,Handler:d(this,this.OnTouchHandleGestureEnd)});a.push({Name:c.GESTURE_TAP,Handler:d(this,this.OnTouchHandleGestureTap)});a.push({Name:c.GESTURE_DOUBLE_TAP,Handler:d(this,this.OnTouchHandleGestureDoubleTap)});a.push({Name:c.CONTEXT_MENU,Handler:d(this,this.OnGContextMenu)})}else if(navigator.msPointerEnabled){a.push({Name:"MSPointerDown",Handler:d(this,this.OnTouchHandlePointerDown)});a.push({Name:"MSPointerUp",Handler:d(this,this.OnTouchHandlePointerUp)});a.push({Name:"MSPointerCancel",Handler:d(this,this.OnTouchHandlePointerCancel)});a.push({Name:"MSGestureStart",Handler:d(this,this.OnTouchHandleGestureStart)});a.push({Name:"MSGestureChange",Handler:d(this,this.OnTouchHandleGestureChange)});a.push({Name:"MSGestureEnd",Handler:d(this,this.OnTouchHandleGestureEnd)});a.push({Name:"MSGestureTap",Handler:d(this,this.OnTouchHandleGestureTap)})}if($$.browser.mb)this.handleEventMan=c.Create();for(var f=0;f<this.touchHandles.length;f++)for(var o=this.touchHandles[f],b=0;b<a.length;b++)if($$.browser.mb){this.handleEventMan.Detach(o,a[b].Name,a[b].Handler,false);this.handleEventMan.Attach(o,a[b].Name,a[b].Handler,false)}else{o.removeEventListener(a[b].Name,a[b].Handler,false);o.addEventListener(a[b].Name,a[b].Handler,false)}this.attachedTouchHandlesHandlers=a;for(var y=n.parentNode,f=0;f<this.touchHandles.length;f++){var o=this.touchHandles[f];o.style.touchAction="none";o.style.msTouchAction="none";y.appendChild(this.touchHandles[f])}}};e.prototype.ShowResizeHandle=function(b,a){this.touchHandles[b?this.RESIZE_COLUMN_HANDLE:this.RESIZE_ROW_HANDLE].style.display=a==null||a?"block":""};e.prototype.CancelTouchDefaultBehaviors=function(a,b){a.preventManipulation&&a.preventManipulation();a.preventDefault&&a.preventDefault(b);if(a.stopPropagation)a.stopPropagation();else a.cancelBubble=true};e.prototype.GetHandler=function(a,d){if(a==null)return null;for(var b=0;b<a.length;b++){var c=a[b];if(c.Name==d)return c}};e.prototype.SetTouchEvents=function(h){var g=window.navigator,f=this.Spread,b=Function.CreateDelegate;if(h){var a=[];if(this.SpreadView.IsMultiBrowserMode()){a.push({Name:c.POINTER_DOWN,Handler:b(this,this.OnPointerDown)});a.push({Name:c.POINTER_MOVE,Handler:b(this,this.OnPointerMove)});a.push({Name:c.POINTER_UP,Handler:b(this,this.OnPointerUp)});a.push({Name:c.POINTER_CANCEL,Handler:b(this,this.OnPointerCancel)});a.push({Name:c.GESTURE_HOLD,Handler:b(this,this.OnGestureHold)});a.push({Name:c.GESTURE_HOLD_VISUAL,Handler:b(this,this.OnGestureHoldVisual)});a.push({Name:c.GESTURE_START,Handler:b(this,this.OnGestureStart)});a.push({Name:c.GESTURE_END,Handler:b(this,this.OnGestureEnd)});a.push({Name:c.GESTURE_CHANGE,Handler:b(this,this.OnGestureChange)});a.push({Name:c.GESTURE_TAP,Handler:b(this,this.OnGestureTap)});a.push({Name:c.GESTURE_DOUBLE_TAP,Handler:b(this,this.OnGestureDoubleTap)});a.push({Name:c.CONTEXT_MENU,Handler:b(this,this.OnGContextMenu)})}else if(g.msPointerEnabled){a.push({Name:"MSPointerDown",Handler:b(this,this.OnPointerDown)});a.push({Name:"MSPointerMove",Handler:b(this,this.OnPointerMove)});a.push({Name:"MSPointerUp",Handler:b(this,this.OnPointerUp)});a.push({Name:"MSPointerCancel",Handler:b(this,this.OnPointerCancel)});if(typeof MSGesture!="undefined"){a.push({Name:"MSGestureStart",Handler:b(this,this.OnGestureStart)});a.push({Name:"MSGestureEnd",Handler:b(this,this.OnGestureEnd)});a.push({Name:"MSGestureChange",Handler:b(this,this.OnGestureChange)});a.push({Name:"MSGestureTap",Handler:b(this,this.OnGestureTap)});a.push({Name:"MSGestureHold",Handler:b(this,this.OnGestureHold)});a.push({Name:"MSHoldVisual",Handler:b(this,this.OnGestureHoldVisual)});this.gesture=new MSGesture;this.gesture.target=this.Spread}}else return false;this.attachedHandlers=a;a.push({Name:"contextmenu",Handler:b(this,this.OnContextMenu)});this.gesturePointerType=null;this.pointers=[];for(var e=0;e<a.length;e++){var d=a[e];if($$.browser.mb)this.eventMan.Attach(d.Target||f,d.Name,d.Handler,false,d.SimulateMouseEvents);else f.addEventListener(d.Name,d.Handler,false)}}else{if($$.browser.mb){this.eventMan.StopTrackingGesture();for(var e=0;e<this.attachedHandlers.length;e++){d=this.attachedHandlers[e];if(d.Target)this.eventMan.Detach(d.Target,d.Name,d.Handler,false);else this.eventMan.Detach(f,d.Name,d.Handler,false)}}else{this.gesture!=null&&this.StopTrackingGesture();if(this.attachedHandlers!=null)for(var e=0;e<this.attachedHandlers.length;e++)f.removeEventListener(this.attachedHandlers[e].Name,this.attachedHandlers[e].Handler,false)}this.attachedHandlers=null}return true};e.prototype.GetPointerId=function(a){if(a.pointerId!=undefined)return a.pointerId;var b=a.targetTouches&&a.targetTouches.length>0?a.targetTouches:a.changedTouches;return b&&b.length>0?b[0].identifier:-1};e.prototype.UpdateCssSettings=function(){var c=this.SpreadView,h=c.Viewport!=null?c.Viewport.parentElement:null,d=c.Viewport1,e=c.Viewport2;if(d!=null)d=d.parentElement;if(e!=null)e=e.parentElement;var l=this.Spread.getAttribute("ClientAutoSize")=="True",i=this.SpreadView.GetSpreadContext().getScrollvp()!=null;if(!l&&(i||h.style.overflowX=="hidden"&&h.style.overflowY=="hidden")){var f=[h];if(i){d&&f.push(d);e&&f.push(e)}for(var b=0;b<f.length;b++){var a=f[b];if(a)if($$.browser.mb){c.Style.Clear(a,"overflow","overflowX","overflowY");$$.j(a).removeClass("scrollable-without-scrollbar");$$.j(a).addClass("scrollable-without-scrollbar")}else{a.style.overflowX="";a.style.overflowY="";a.style.overflow="auto";a.style.msOverflowStyle="none"}}}if($$.browser.mb){var k=this.SpreadView.GetTopSpreadView();k==this.SpreadView&&this.EnableWebkitScroll();var m=k.Spread,g=typeof window.FpChartUtil!=="undefined"?window.FpChartUtil.getChartElements(m):null;if(g!=null&&this.GetTouchStrip(3))for(var b=0;b<g.length;b++){var j=g[b];$$.j(j).css("-webkit-user-select","none");$$.j(j).css("-webkit-touch-callout","none")}}};e.prototype.EnableWebkitScroll=function(){var a=this.SpreadView.GetTopSpreadView(),b=a.GetSpreadContext().getViewportHolder()||a.Viewport.parentElement;$$.j(b).addClass("spread-webkit-scroll")};e.prototype.DisableWebkitScroll=function(){var a=this.SpreadView.GetTopSpreadView(),b=a.GetSpreadContext().getViewportHolder()||a.Viewport.parentElement;$$.j(b).removeClass("spread-webkit-scroll")};e.prototype.Initialize=function(){var a=this,d=this.SpreadView,f=d.SelectionModel.GetFocusCellRange();if(f==null&&!d.IsSpreadActive(true))this.closedTouchStripRecently=null;else this.closedTouchStripRecently=false;if(d.Parent==null){e.EnableManipulation(this,true);if($$.browser.isTouchEventModel){this.invalidateLayoutCallback=function(){if(a.IsInTouchMode){if(a.scrollingView!=null){var f=d.GetTopSpreadView();if(f.Spread.GetActiveChartObj()==null){var e=d.GetActiveSpreadView(false,true);!e.InBouncingEffect()&&(e.IsRetainSelection()||e.IsSpreadActive())&&e.ShowFocusRectangle()}}if(a.scrollingView!=null&&a.IsScrollSyncrhonized(a.scrollingView)){var c=a.scrollingView;a.syncScrollTimer=new b.Timers.Timer(500,function(){if(c.offsetParent!=null){var b=c.scrollLeft;c.scrollLeft=b+1;c.scrollLeft=b}a.syncScrollTimer=null;c=null},false);a.scrollingView=null}}};b.Timers.Timer.GetSystemTimer().AddElapsedHandler(this.invalidateLayoutCallback)}}if($$.browser.mb)this.eventMan=c.Create();this.SetTouchEvents(true);this.UpdateCssSettings()};e.SetStyle=function(b,a,d,c){if(c&&a.indexOf("-ms-")!=0)a="-ms-"+a;if(b.style[a]!=undefined)b.style[a]=d};e.GetStyle=function(d,a,c){if(c&&a.indexOf("-ms-")!=0)a="-ms-"+a;var b=d.style[a];return b!=undefined?b:""};e.EnableManipulation=function(o,t){for(var a=o.SpreadView,m=a.GetSpreadContext().getScrollvp(),r=[a.Viewport,a.Viewport1,a.Viewport2],b=0;b<r.length;b++){var n=r[b];if(n){$$.j(n).removeClass("spread-touch-viewport");$$.j(n).addClass("spread-touch-viewport")}}if(a.ColumnHeaders)for(var b=0;b<a.ColumnHeaders.length;b++){$$.j(a.ColumnHeaders[b].parentNode).removeClass("spread-touch-header");$$.j(a.ColumnHeaders[b].parentNode).addClass("spread-touch-header")}if(a.RowHeaders)for(var b=0;b<a.RowHeaders.length;b++){$$.j(a.RowHeaders[b].parentNode).removeClass("spread-touch-header");$$.j(a.RowHeaders[b].parentNode).addClass("spread-touch-header")}var f=a.Viewport!=null?a.Viewport.parentNode:null;if(f!=null)f.style.msScrollChaining="chained";var c=a.Viewport1,d=a.Viewport2;if(c!=null){c=c.parentElement;c.style.msScrollChaining="chained"}if(d!=null){d=d.parentElement;d.style.msScrollChaining="chained"}var h=a.Viewport0;if(h!=null){h=h.parentElement;$$.j(h).removeClass("spread-touch-none");$$.j(h).addClass("spread-touch-none")}var s=o.TouchInfo,y=t?s==null?3:s.PanningMode:0;switch(y){case 2:if(f!=null){$$.j(f).removeClass("spread-touch-pan-y");$$.j(f).addClass("spread-touch-pan-y")}if(c!=null){$$.j(c).removeClass("spread-touch-pinch-zoom");$$.j(c).addClass("spread-touch-pinch-zoom")}if(d!=null){$$.j(d).removeClass("spread-touch-pan-y");$$.j(d).addClass("spread-touch-pan-y")}break;case 1:if(f!=null){$$.j(f).removeClass("spread-touch-pan-x");$$.j(f).addClass("spread-touch-pan-x")}if(c!=null){$$.j(c).removeClass("spread-touch-pan-x");$$.j(c).addClass("spread-touch-pan-x")}if(d!=null){$$.j(d).removeClass("spread-touch-pinch-zoom");$$.j(d).addClass("spread-touch-pinch-zoom")}break;case 0:if(f!=null){$$.j(f).removeClass("spread-touch-pinch-zoom");$$.j(f).addClass("spread-touch-pinch-zoom")}if(c!=null){$$.j(c).removeClass("spread-touch-pinch-zoom");$$.j(c).addClass("spread-touch-pinch-zoom")}if(d!=null){$$.j(d).removeClass("spread-touch-pinch-zoom");$$.j(d).addClass("spread-touch-pinch-zoom")}break;default:if(f!=null){$$.j(f).removeClass("spread-touch-pan-xy");$$.j(f).addClass("spread-touch-pan-xy");if(m){$$.j(m).removeClass("spread-touch-pan-xy");$$.j(m).addClass("spread-touch-pan-xy")}}if(c!=null){$$.j(c).removeClass("spread-touch-pan-x");$$.j(c).addClass("spread-touch-pan-x")}if(d!=null){$$.j(d).removeClass("spread-touch-pan-y");$$.j(d).addClass("spread-touch-pan-y")}}var x=a._GetNoRow(-1),v=a._GetNoRow(1),w=a._GetNoRow(2);if(x)x.className=f.className;if(v)v.className=c.className;if(w)w.className=d.className;var g=a.GetSpreadContext(),p=g.getFrozColFooter(),q=g.getColFooter(),j=g.getParentSpread();if(p){$$.j(p.parentNode).removeClass("spread-touch-pinch-zoom");$$.j(p.parentNode).addClass("spread-touch-pinch-zoom")}if(q){$$.j(q.parentNode).removeClass(j==null?"spread-touch-pinch-zoom":f.className);$$.j(q.parentNode).addClass(j==null?"spread-touch-pinch-zoom":f.className)}if(j==null)for(var i=[g.getTitleBar(),g.getSubTitleBar()],b=0;b<i.length;b++)if(i[b]){$$.j(i[b]).removeClass("spread-touch-pinch-zoom");$$.j(i[b]).addClass("spread-touch-pinch-zoom")}var l=g.getGroupBar();if(l){$$.j(l).removeClass("spread-touch-pinch-zoom");$$.j(l).addClass("spread-touch-pinch-zoom")}var u=o.Spread.GetActiveChartObj();u&&u.updateTouchAction("pinch-zoom");var k=a.ChildSpreadViews;if(k!=null)for(var b=0;b<k.length;b++)e.EnableManipulation(k[b].Touch,t)};e.prototype.GetTappedLocation=function(l){if(this.lastPointerDownEvent!=null){var a=this.SpreadView,d=this.lastPointerDownEvent.target,b,j=l,f=this.lastPointerDownEvent;if(a.IsInViewport(d)){var h=$$.utils.GetCell(d),g=h?h.parentElement.getAttribute("row"):null;b={Column:a._GetColumnIndex(j),Row:a._GetRowIndex(f,false,false,true),Index:g==null||g.length==0?-1:parseInt(g)}}else{var c=a.ColumnHeaders;if(c)for(var e=0;e<c.length;e++)if($$.utils.contains(c[e],d)){if(a.IsRowLayoutMode){var i=$$.utils.GetCell(d);if(i!=null&&i.getAttribute("col")=="-1")return null}if(a.IsInFilterBar(d))return null;var k=a._GetRowIndex(f,true,false,true);b={Column:a._GetColumnIndex(j),Row:-1,Index:k}}if(b==null){var c=a.RowHeaders;if(c)for(var e=0;e<c.length;e++)if($$.utils.contains(c[e],d))b={Column:-1,Row:a._GetRowIndex(f,false,true,true),Index:a._GetColumnIndex(f,true)}}}}return b&&b.Column!=null&&b.Row!=null?b:null};e.prototype.CanPerformTouch=function(a,c,b){if(a)if(a.IsValid())return true;else if(c&&this.lastPointerDownEvent&&a.getSpreadView().GetSpreadContext().getChartObj(this.lastPointerDownEvent.target)!=null)return true;else if(!b||b&&(!this.lastPointerDownEvent||!$$.utils.isNativeControl(this.lastPointerDownEvent.target,true)))return a.getSpreadView().TryStopEditing(false,false,true);return false};e.prototype.ResetInternalFlags=function(a){this.isSimulateMouseClickCalled=false;this.cancelMouseEvents=false;this.requireUpdateResizeLocation=false;this.ignorePointerUp=false;this.closedChartTouchStripRecently=false;this.IgnoreContextMenuEvent=false;this.gestureHoldStarted=false;this.gestureHoldVisualStarted=false;if(a){switch(this.currentAction){case 4:this.StopColumnMoving(this.lastPointerDownEvent);break;case 3:case 1:this.StopSelecting(this.lastPointerDownEvent);break;case 2:this.StopResizing(this.lastPointerDownEvent)}this.currentAction=0}if(this.currentAction!=2&&this.currentAction!=1)this.handleIndex=-1};e.prototype.OnPointerDown=function(b){var c=this.SpreadView;if($$.browser.isTouchEventModel){this.lastCanceledEvent=null;if(b.touches&&b.touches.length>1)return;c.UnregisterTimeoutTask("ProcessEditMode")}this.ResetInternalFlags();if($$.utils.isTouchEvent(b)){if(c.ActiveDialog!=null)return;this.lastPointerMoveEvent=null;var k=c.GetSpreadContext(),H=k.getSpreadControl(b.target,true);if(H!=this.Spread)return;if(this.Spread.onPointerDown)this.Spread.onPointerDown(b);this.lastPointerDownEvent=b;this.lastPointerDownLocation=this.GetTappedLocation(b);var f=b.target,v=false,u=false,C=false;if(f.tagName=="IMG"){var j=k.getCell(f);v=j&&j.getAttribute("group")}if(!v)u=c._IsGrayArea(f);if(!u)C=$$.utils.isOverScrollbar(b,c._GetScrollableView());var D=false;if(u||C||c.Pager.Contains(f)||c.IsInFooter(f))D=true;else if(v||c.IsInFilterBar(f)){this.IsInTouchMode=true;var B;(!f.disabled||!(B=c.GetFilterBarEditor(f))||!B.disabled)&&this.SetResizeLocation(null);$$.utils.cancelBubble(b,false);return}else if(!f.disabled&&GCWS.FilterEditor.IsFilterControl(f)){this.IsInTouchMode=true;$$.utils.cancelBubble(b,false);$$.browser.isTouchEventModel&&this.eventMan.StartTrackingGesture(b,true);return}if(D){$$.browser.webkit&&c.EditModePermanent&&c.IsTextBoxActive()&&window.parent!=window&&b.cancelActivate();var t=c.GetActiveSpread();if(!(c.Parent!=null&&t!=null&&(t==this.Spread||k.getTopSpread(t)==k.getTopSpread(this.Spread)))){this.IsInTouchMode=true;$$.utils.cancelBubble(b,false);$$.browser.mb&&this.eventMan.StartTrackingGesture(b,true);return}}this.IgnoreContextMenuEvent=false;var A=false;if(this.showTouchStripTimeoutId!=null){clearTimeout(this.showTouchStripTimeoutId);this.showTouchStripTimeoutId=null;this.closedTouchStripRecently=true}else if(this.IsTouchStripOpened){A=e.ActiveTouchStrip.Area==3;this.HideTouchStrip();this.closedTouchStripRecently=true}else this.closedTouchStripRecently=false;this.closedPopupRecently=c.HidePopup()||this.closedTouchStripRecently;var n=k.getChartObj(f),i=n&&n.canSelect();if(this.currentAction==0){var j=$$.utils.GetCell(f),K=j&&j.getAttribute("RowEditTemplate")!=null;$$.browser.isTouchEventModel&&i&&f.getAttribute("onclick")!=null&&b.needSimulateMouseClick();var F=a.Web.Spread.CellTypeFactory.GetEditor(b.target);if(i&&n.isActived||f!=null&&!$$.utils.isDisabledControl(f,true)&&$$.utils.isNativeControl(f,true)||K&&this.Spread.GetActiveChartObj()||F&&F.OnPointerDown(b)){this.ignorePointerUp=true;this.StopTrackingGesture();this.IsInTouchMode=true;var s=false;if(!(i&&n.isActived)){var p=true;if(c.OperationMode==2){var y=$$.browser.webkit?this.lastPointerDownLocation:this.GetTappedLocation(b);if(y==null||c.SelectionModel.Contains(y.Row,-1,1,-1,y.Index))p=false}else if(c.OperationMode==0){var q=c.SelectionBlockOptions;if(c.ColumnHeader.Contains(f)&&(q&4)==0||c.RowHeader.Contains(f)&&(q&2)==0||c.Corner.Contains(f)&&(q&8)==0)p=false}var m=c.GetEditingSpread(),h=m?m.getEditingInfo():null,r=$$.utils.isNativeControl(f,true);if(p)if(j==null)this.SetResizeLocation(null);else if(j.getAttribute("canFocus")!="false")!(h&&r&&$$.utils.contains(j,h.Editor)&&(h.Editor==f||$$.utils.contains(h.Editor,f)))&&this.SetResizeLocation(null);if($$.browser.ieversion>=11&&h&&!$$.utils.contains(h.Editor,f,true)){var G=h.Editor,w=m.EndEdit({IgnoreFocus:r});if(!w)s=true;else r&&document.activeElement==G&&!m.isEditing()&&$$.utils.isTextControl(G)&&m.getSpreadView().GetSpreadContext().setTextBoxFocus(false,false,true)}}else this.eventMan&&$$.browser.isTouchEventModel&&this.eventMan.StartTrackingGesture(b);$$.utils.cancelBubble(b,s);return!s}else{if(!i&&A)this.closedChartTouchStripRecently=this.Spread.GetActiveChartObj()!=null;var w=true,L=c.IsMultiColumnComboBox;if(!c.IsSpreadActive(L)){var z=c.GetActiveSpread();if(z!=null&&z.getSpreadView().GetTopSpreadView()==c.GetTopSpreadView())z.getSpreadView().Touch.IsInTouchMode=true}else if(!i){var o=this.Spread.getEditingInfo(),J=o&&f!=o.Editor&&$$.utils.isTextControl(o.Editor)&&!o.RenderAsEditor;w=c.TryStopEditing(true,false,true,$$.browser.ieversion==10,J)}if(!w&&!i){this.ignorePointerUp=true;this.StopTrackingGesture();this.CanPerformTouch(H,false,false)&&this.CancelTouchDefaultBehaviors(b);this.IsInTouchMode=true;$$.utils.cancelBubble(b,false);return}}if(this.currentAction!=0){this.CancelTouchDefaultBehaviors(b);return}if(this.Spread==null)return;if(this.gesturePointerType===null)this.gesturePointerType=b.pointerType;this.initialSpreadTouchTime=new Date;this.initialSpreadTouchPos=d.GetGesturePointFromEvent(b);if($$.browser.mb)this.eventMan.StartTrackingGesture(b);else if(this.gesture){if(this.gesture.target==null)this.gesture.target=this.Spread;this.gesture.addPointer(this.GetPointerId(b))}var E=this.GetPointerId(b);this.pointers.push(E);this.lastPointerId=E;this.ignorePointerUp=false;this.IsInTouchMode=true;this.oldScrollValues=c._GetScrollValues();this.fireDoubleTap=false;var I=new Date;if(!$$.browser.mb&&this.pointers.length==1)if(this.lastPointerDownPosition&&+I-+this.lastPointerDownTime<this.DOUBLE_TAP_TIME&&d.CalculateSquaredDistance(this.lastPointerDownPosition,b)<this.DOUBLE_TAP_THRESHOLD){this.lastPointerDownPosition=null;this.fireDoubleTap=true}this.lastPointerDownTime=I;this.lastPointerDownPosition=b;if(!i||!n.isActived){var g=document.activeElement;if(!this.closedChartTouchStripRecently&&!c.IsMultiColumnComboBox&&this.SpreadView.GetEditingSpread()==null&&(!$$.utils.isNativeControl(f,true)||$$.utils.isDisabledControl(f,true))&&g!=f&&g!=k.getTextBox()){if(g!=null&&g.getAttribute&&g.getAttribute("mccbparttype")=="DropDownButton"&&$$.utils.GetCell(g)==null){var l=g.parentNode;while(l!=null&&l.getAttribute("MccbId")==null)l=l.parentNode;if(l!=null){var M=l.getAttribute("MccbId"),x=window[M+"_Obj"];x&&x.getIsDrop()&&x.ShowHideContainer(false,true)}}c.IsSpreadActive()&&c.EnsureFilteringState()&&(!$$.browser.webkit||!c.EditModePermanent)&&k.setTextBoxFocus()}this.CancelTouchDefaultBehaviors(b)}}else this.CancelTouchDefaultBehaviors(b);this.cancelMouseEvents=true}else this.IsInTouchMode&&this.ProcessMousePointerDown(b)};e.prototype.ProcessMousePointerDown=function(a){var c=a.target,d=this.SpreadView._GetScrollableView();if($$.utils.isOverScrollbar(a,d)){this.lastPointerDownEvent=a;return}this.IsTouchStripOpening&&this.HideTouchStrip();var b=GCWS.FilterEditor.GetEditor(c);if(b!=null&&!b.disabled&&(c==b.Behavior.DropDownButton||c==b.Behavior.DatePickerButton))this.ignoreHidePopup=true;this.ExitFromTouchMode();this.ignoreHidePopup=false;this.SpreadView.IsMultiColumnComboBox&&$$.utils.cancelBubble(a,false)};e.prototype.ExitFromTouchMode=function(){if(this.gesturePointerType!==null){this.StopTrackingGesture();this.gesturePointerType=null}this.handleGesture!=null&&this.handleGesture.stop();$$.browser.mb&&this.handleEventMan&&this.handleEventMan.StopTrackingGesture();this.IsInTouchMode=false};e.prototype.IsTouchHandle=function(a){return this.GetTouchHandle(a)!=null};e.prototype.GetTouchHandle=function(b){if(b==null||this.touchHandles==null)return null;for(var a=0;a<this.touchHandles.length;a++)if(b==this.touchHandles[a]||$$.utils.contains(this.touchHandles[a],b))return this.touchHandles[a];return null};e.prototype.TryActivateSpread=function(b,f,g){var a=f?this.SpreadView:this.SpreadView.GetActiveSpreadView(false,true);if(a==null)a=this.SpreadView.GetTopSpreadView();if(!a.Touch)return false;a.Touch.isOnTheFlyCreatedSelection=false;var c=a.Spread,i=a.GetSpreadContext(),d=a.GetActiveSpread();if(d!=null){if($$.utils.contains(c,d)&&d.getSpreadView().Touch.GetHandleIndex(b.target)!=-1)return false}else if(this.IsTouchHandle(b.target)){var h=document.getElementById(b.target.getAttribute("HostSpreadID")||b.target.parentNode.getAttribute("HostSpreadID"));if($$.utils.contains(c,h))return}i.setActiveSpread(b,true);var e=a.IsSpreadActive(a.IsMultiColumnComboBox)&&this.CanPerformTouch(c,false,false);e&&c.GetActiveChartObj()==null&&this.checkSelectionState(b,a,g);return e};e.prototype.checkSelectionState=function(d,a,c){if(a==null)a=this.SpreadView;var i=a.Spread;if(a.GetTopSpreadView().Spread.GetActiveChartObj()!=null)return;var b=a.GetSpreadContext();if(i.getAnchorCell()==null){if(d!=null)d.ignoreEditMode=true;if(!a.IsMultiColumnComboBox){var g=null;if(c||(g=$$.utils.GetCell((this.lastPointerDownEvent||d).target))==null||g.getAttribute("canFocus")=="false")if(!c)a.Touch.isOnTheFlyCreatedSelection=b.initAnchorCell(d);else b.initAnchorCell(d);b.paintSelections(true,!c);b.paintAnchorCell(true,true)}this.UpdateResizeLocation();a.ShowFocusRectangle(true)}else{var f=b.getXmlActiveRow(),h=b.getXmlActiveCol();if(a.SelectionModel.IsEmpty()&&(f!=-1&&a.OperationMode!=0||f!=-1&&h!=-1)&&a.OperationMode!=1){this.regenerateSelection(a,c);if(!a.SelectionModel.IsEmpty()&&!c)a.Touch.isOnTheFlyCreatedSelection=true}else if(!a.IsRetainSelection()){var e=a.SelectionModel.IsEmpty();b.paintSelections(true,!e);if(e&&!a.SelectionModel.IsEmpty()&&!c)a.Touch.isOnTheFlyCreatedSelection=true}}};e.prototype.regenerateSelection=function(a,f){if(a.IsMultiColumnComboBox)return;var d=a.Spread,b=d.getAnchorCell();if(b!=null){var e=a.GetSpreadContext(),g=a.IsRowLayoutMode?b!=null?parseInt(b.parentElement.getAttribute("row")):0:-1,c=false;if(a.OperationMode==0){e.paintSelections(true);c=true}else if((a.OperationMode==2||a.OperationMode==3)&&e.getXmlActiveRow()!=-1&&d.GetActiveChartObj()==null){d.AddSelection(e.getActiveRow(),-1,1,-1,g,false);c=true}if(c){this.UpdateResizeLocation(true);if(!f)a.Touch.isOnTheFlyCreatedSelection=true}}};e.prototype.OnPointerMove=function(a){if(this.lastPointerDownEvent&&$$.utils.isTouchEvent(a)){var b=this.SpreadView,c=true;if($$.browser.isTouchEventModel)if(!a.touches||a.touches.length==1){var f=this.SpreadContext,d=this.lastPointerDownEvent.target;if(b.IsInsideViewport(d)&&!b._IsDragableSupport(d)||b.Parent!=null&&a.target==b.Viewport.parentNode.parentNode){this.StopTrackingGesture();$$.utils.cancelBubble(a,false);c=false}}else c=false;if(c){this.lastPointerMoveEvent=a;this.ProcessTouchMove(a);var e=this.currentAction!=0||b._IsDragableSupport(this.lastPointerDownEvent.target)||this.handleIndex>-1||b.ColumnHeader.Contains(this.lastPointerDownEvent.target)||b.RowHeader.Contains(this.lastPointerDownEvent.target);$$.utils.cancelBubble(a,e)}else if($$.browser.isTouchEventModel)if(this.lastCanceledEvent==null){this.lastCanceledEvent=this.lastPointerDownEvent;this.ProcessTouchCancel(a);this.OnPointerUp(a)}}};e.prototype.ProcessTouchMove=function(b){var a=this.SpreadView,r=this.initialSpreadTouchPos||d.GetGesturePointFromEvent(this.lastPointerDownEvent);if(r!=null){var v=d.GetGesturePointFromEvent(b),f=d.CalculateSquaredDistance(r,v);if(a.EditModePermanent&&this.lastPointerDownEvent&&f>0){var n=this.lastPointerDownEvent.target,l=!$$.utils.isNativeControl(n);if(l){var g=this.Spread.getAnchorCell();l=g!=null&&a.GetSpreadContext().getEditor(g)==null;l&&a.TryStopEditing(false,false,true)}}}if(this.pointers.length==0){if(this.lastPointerDownEvent&&a.IsInFilterBar(this.lastPointerDownEvent.target)&&a.IsInFilterBar(b.target)){var p=this.lastPointerDownEvent.target;if(!p.disabled){this.UpdateResizeLocation(true);if(a.IsSpreadActive()){var c=GCWS.FilterEditor.GetEditor(p);c!=null&&c.Behavior.TextBox!=null&&!c.Behavior.TextBox.disabled&&setTimeout(function(){if(!a.GetTopSpreadView().IsPopupOpened()){var b=document.activeElement,d=c.Behavior.TextBox!=b&&!$$.utils.contains(a.Spread,b);if(!d&&b!=null&&a.IsInFilterBar(b)&&GCWS.FilterEditor.GetEditor(b)!=c)d=true;d&&c.Behavior.TextBox.focus()}},0)}}}return}else if(this.closedChartTouchStripRecently)if(f==0)return;else this.closedChartTouchStripRecently=false;if(this.lastPointerId==this.GetPointerId(b)){var h=a.GetSpreadContext();if(this.HoldAndReleaseState==this.HOLD_AND_RELEASE_ACTIVE)this.HoldAndReleaseState=this.HOLD_AND_RELEASE_ACTIVE_NOT_FIRE;switch(this.currentAction){case 0:var m=false;if(this.lastPointerDownEvent!=null){var k=f>=this.DOUBLE_TAP_THRESHOLD;if(this.lastPointerDownPosition!=null&&(k||$$.browser.isTouchEventModel)){var u=a.IsRowLayoutMode,e=a.ColumnHeader.Contains(this.lastPointerDownEvent.target);if(!this.gestureHoldStarted&&this.HoldAndReleaseState==this.HOLD_AND_RELEASE_INACTIVE){var o=h.isChild(b.target,h.getGroupBar()),t=a.AllowColumnMove||a.AllowGroup;if(!u&&e&&t||a.AllowGroup&&(e||o)){var q=a.OperationMode==0,i=q&&e?a.SelectionModel.GetFocusCellRange():null;if(!q||o||i!=null&&i.Row==-1&&i.Column>=0){$$.browser.isTouchEventModel&&this.CancelTouchDefaultBehaviors(b);if(k&&(!$$.browser.isTouchEventModel||!this.IsTouchStripOpening||!this.IsTouchStripOpened))if(this.ActivateSpreadByTouch(this.lastPointerDownEvent,true)==a){m=true;if(this.StartColumnMoving(b))break}}}if(a.OperationMode!=4){var n=this.lastPointerDownEvent.target,j=(a.SelectionBlockOptions&4)==4&&e;if(!j&&(a.SelectionBlockOptions&2)==2&&a.RowHeader.Contains(n)){var g=h.getCell(n),w=h.getRowHeader(),s=$$.utils.contains(w,g)&&a._IsChildSpreadRow(g.parentNode.rowIndex);if(!s)j=true}if(j){$$.browser.isTouchEventModel&&this.CancelTouchDefaultBehaviors(b);if(k&&(!$$.browser.isTouchEventModel||!this.IsTouchStripOpening||!this.IsTouchStripOpened))if(this.ActivateSpreadByTouch(this.lastPointerDownEvent,true)==a){m=true;this.StartSelecting(b)}}}}}!m&&f>0&&this.ActivateSpreadByTouch(this.lastPointerDownEvent,!a._IsGrayArea(this.lastPointerDownEvent.target,true))}break;case 3:this.ContinueSelecting(b);break;case 4:this.ContinueColumnMoving(b);break;default:this.ActivateSpreadByTouch(this.lastPointerDownEvent)}(this.currentAction==3||this.currentAction==4)&&this.CancelTouchDefaultBehaviors(b)}else this.CancelTouchDefaultBehaviors(b)};e.prototype.OnPointerUp=function(a){if($$.utils.isTouchEvent(a)){var b=this.SpreadView,g=!$$.browser.isTouchEventModel||!a.touches||a.touches.length<1;if($$.browser.isTouchEventModel){if(a.type==$$.TouchEvents.TouchEnd){var d=this.SpreadContext;if(this.eventMan instanceof h&&this.eventMan.IsTap){d.clearOldEditorValue(true);var e=this.Spread.getEditingInfo(),i=document.activeElement;e&&e.Editor&&i!=e.Editor&&d.getCell(i)!=d.getCell(e.Editor)&&this.Spread.fpSpreadJS.correctFocusOnActiveCell(this.Spread.getAnchorCell(),false)}var k=false,j=d.getChartObj(a.originalEvent.target);if(j&&!j.isActived){k=true;this.SpreadView.SynchronizeScroll(this.SpreadView.Viewport.parentElement)}if(this.lastCanceledEvent!=null){if(!k){var f=this.lastCanceledEvent.target;if(b.Parent==null){var c=b._GetViewportFromCell(f);if(c)c=c.parentElement;else if(c==null&&b.IsInsideViewport(f))c=f;c&&b.SynchronizeScroll(c)}else{var l=b.GetTopSpreadView();l.SynchronizeScroll(l.Viewport.parentNode)}}g=false;if(b.EditModePermanent){var d=b.GetSpreadContext();d.switchHiddenTextBox(true)}}}this.lastCanceledEvent!=null&&a.cancelMouse();if(a.type==$$.TouchEvents.TouchEnd)this.lastCanceledEvent=null}if(g){this.ClearCachedObjects(a,this.ProcessTouchUp(a));this.cancelMouseEvents&&this.CancelTouchDefaultBehaviors(a)}$$.utils.cancelBubble(a,false)}};e.prototype.ProcessTouchUp=function(b){if(this.Spread==null)return;var a=this.SpreadView;if(!this.lastPointerDownEvent){var c=a.GetActiveSpreadView(false,true);if(c!=null&&c!=a){c.Touch.OnPointerUp(b);return true}}if(this.HoldAndReleaseState==this.HOLD_AND_RELEASE_ACTIVE)if(this.handleIndex>=0){this.OnTouchHandleGestureHoldAndRelease(b);this.ignorePointerUp=true}else this.OnGestureHoldAndRelease(b);this.HoldAndReleaseState=this.HOLD_AND_RELEASE_INACTIVE;this.isOnTheFlyCreatedSelection=false;if(this.closedChartTouchStripRecently)return true;var h=this.lastPointerDownEvent?this.lastPointerDownEvent.target:null;if(this.pointers.length==0&&this.handleIndex<0){var j=$$.utils.isNativeControl(h,true);if(a.IsSpreadActive()&&this.CanPerformTouch(a.Spread,false,j)){var s=this.SpreadContext,l=a.IsInFilterBar(h);if(l||j){if(l)if(h.disabled)a.EditModePermanent&&a.ProcessEditModePermanent(0);else{var e=null,m=this.Spread.getAnchorCell();m!=null&&(e=GCWS.FilterEditor.GetEditor(h))!=null&&!e.attributes.disabled&&a._IsCellHidden(m,true)&&s.scrollToCell(m)}else this.closedTouchStripRecently&&setTimeout(Function.CreateDelegate(this,function(){!$$.utils.contains(this.Spread,document.activeElement)&&this.SpreadView.FocusSpread()}),0);var p=$$.utils.GetCell(h);if(!$$.utils.isNativeControl(h,true)||$$.utils.isNativeControl(h,true)&&!(a.IsColumnHeaderCell(p)||a.IsRowHeaderCell(p,false))){this.UpdateResizeLocation();this.ShowHandles(true,!this.closedTouchStripRecently&&!l);return false}}var f=this.GetTappedLocation(this.lastPointerDownEvent);if(f!=null){var r=f.Row,o=f.Column;if(r==-1&&o>=0)this.SetResizeLocation(f);else if(o==-1&&r>=0)this.SetResizeLocation(f);else if(a._IsFullRowSelectable&&f.Row>=0&&f.Column>=0&&a.GetCanFocus(f.Row,f.Column)){var i=a._GetActiveCellRange();if(i!=null&&(this.resizeLocation==null||this.resizeLocation.Column==-1||f!=null&&f.Row>=0&&f.Column>=0))if(this.resizeLocation==null)this.SetResizeLocation({Column:-1,Row:i.Row,Index:a.RowHeader.ColumnCount-1});else this.SetResizeLocation({Column:-1,Row:i.Row,Index:this.resizeLocation.Index})}this.ShowHandles(true,!this.closedTouchStripRecently)}else this.UpdateResizeLocation(true);if(!j&&a.EditModePermanent&&!($$.browser.mb&&a.GetCommandBar().Contains((this.lastPointerDownEvent||b).target))){var n=null;if($$.browser.isTouchEventModel){var t=b.currentTarget.getBoundingClientRect(),u={left:b.clientX,top:b.clientY,right:b.clientX,bottom:b.clientY,width:1,height:1};n=$$.utils.isIntersectRect(t,u)}a.ProcessEditModePermanent(null,n)}}else if(a.EditModePermanent){var k=a.GetEditingSpread();if(k!=null&&k!=a.Spread){var e=k.getEditingInfo().Editor;$$.utils.contains(e,document.activeElement,true)&&setTimeout(function(){if($$.utils.contains(e,document.activeElement,true)){e&&e.blur&&e.blur();e&&e.focus&&e.focus()}},0)}}return true}if(this.ignorePointerUp){this.ignorePointerUp=false;var c=a.GetActiveSpreadView(false,true);if(!c.Touch.closedTouchStripRecently&&!c._IsCellHidden(c.Spread.getAnchorCell(),true))if($$.browser.ie)c.Touch.CorrectFocusOnActiveCellIfPossible(true);else!c.Touch.IsTouchStripOpening&&c.Touch.CorrectFocusOnActiveCellIfPossible(false);this.closedTouchStripRecently=false;c.EditModePermanent&&c.ProcessEditModePermanent()}else{switch(this.currentAction){case 3:this.StopSelecting(b);break;case 4:this.StopColumnMoving(b);break;case 0:if(this.lastPointerDownEvent)if(a.IsInFooter(h)||a.GetPreviewRow(h)){a.GetSpreadContext().doGetFocus();if(!a.EditModePermanent)if($$.browser.ie)this.CorrectFocusOnActiveCellIfPossible(true,true);else!this.IsTouchStripOpening&&this.CorrectFocusOnActiveCellIfPossible(false,true);return true}else{var c=a.GetActiveSpreadView(false,true);if(c&&c.EditModePermanent){var v=this.initialSpreadTouchPos||d.GetGesturePointFromEvent(this.lastPointerDownEvent),w=d.GetGesturePointFromEvent(b);c.ProcessEditModePermanent(null,this.pointers.length==1&&d.CalculateSquaredDistance(v,w)==0?false:null)}}}if(this.Spread==null)return true;var g=document.activeElement;if(g&&this.Spread.GetActiveChartObj()!=null&&$$.utils.isNativeControl(g)&&$$.utils.contains(this.Spread,g))g.blur&&g.blur();this.CancelTouchDefaultBehaviors(b);if(this.Spread==null)return true;var q=a.GetSpreadContext(),g=document.activeElement;if(g!=null&&!$$.utils.isNativeControl(g,true)){var e=q.getEditor();if(e==null&&this.Spread.isEditing())e=this.Spread.getEditingInfo().Editor;if(e==null&&(g.id==null||g.id.indexOf("RowEditTemplateContainer")==-1))!a.IsMultiColumnComboBox&&(!$$.browser.isTouchEventModel||!(a.EditModePermanent&&a.IsPopupOpened(true)))&&q.setTextBoxFocus();else a.GetActiveSpread()==null&&this.TryActivateSpread(b,true,true)}if(this.currentAction==0)if($$.browser.ie)setTimeout(Function.CreateDelegate(this,function(){this.showTouchStripTimeoutId==null&&!this.IsTouchStripOpened&&this.CorrectFocusOnActiveCellIfPossible(true,true)}),0);else!this.IsTouchStripOpening&&this.CorrectFocusOnActiveCellIfPossible(false,true)}if(this.Spread.onPointerUp)this.Spread.onPointerUp(b);return true};e.prototype.CorrectFocusOnActiveCellIfPossible=function(d,b){var a;if(this.Spread!=null&&!(a=this.SpreadView).IsMultiColumnComboBox&&a.IsSpreadActive(true)&&a.NeedSetEditorFocusOnActiveCell()){var c=a.GetTopSpreadView();if(c.ActiveDialog==null&&c.ActiveContextMenu==null&&this.showTouchStripTimeoutId==null&&!this.IsTouchStripOpened)if(d)setTimeout(Function.CreateDelegate(this,function(){this.CorrectFocusOnActiveCell(false,b)}),0);else this.CorrectFocusOnActiveCell(false,b)}};e.prototype.CorrectFocusOnActiveCell=function(b,d){if(this.Spread!=null&&this.Spread.GetActiveChartObj()==null){var a=this.SpreadView,c=a.GetSpreadContext();if(b||document.activeElement==c.getTextBox()){b&&!$$.utils.contains(this.Spread,document.activeElement)&&a.FocusSpread();if(!b&&d&&a._IsCellHidden(this.Spread.getAnchorCell()))return;c.correctFocusOnActiveCell()}}};e.prototype.ClearCachedObjects=function(b,a){this.lastPointerMoveEvent=null;this.lastPointerDownEvent=null;this.initialSpreadTouchPos=null;if(!(a==null||a))this.handleIndex=-1;if(this.Spread!=null&&this.SpreadView.GetSpreadContext().getChartObj(b.target)==null)this.closedTouchStripRecently=false;this.handleGesture&&this.handleGesture.stop();$$.browser.mb&&this.handleEventMan&&this.handleEventMan.StopTrackingGesture();this.StopTrackingGesture()};e.prototype.RepaintSelections=function(){var a=this.SpreadView.GetSpreadContext();a.paintSelections(true,true);a.paintAnchorCell(true,true)};e.prototype.OnPointerCancel=function(a){if($$.utils.isTouchEvent(a)){$$.browser.isTouchEventModel&&this.OnPointerUp(a);this.ProcessTouchCancel(a);$$.utils.cancelBubble(a,false)}};e.prototype.ProcessTouchCancel=function(e){this.HoldAndReleaseState=this.HOLD_AND_RELEASE_INACTIVE;this.isOnTheFlyCreatedSelection=false;var a=this.SpreadView,l=this.SpreadContext;a.GetSpreadContext().resetBlurFlag({needScrollView:true});var b=a.GetActiveSpread();b==this.Spread&&this.lastPointerDownEvent!=null&&this.checkSelectionState(this.lastPointerDownEvent,a,true);if($$.browser.isTouchEventModel&&this.lastPointerDownEvent==null){var h=a._GetActiveCellRange(true);if(h&&this.resizeLocation&&(this.resizeLocation.Column!=h.Column||this.resizeLocation.Row!=h.Row)){this.SetResizeLocation(null);this.requireUpdateResizeLocation=false}}if(this.lastPointerDownEvent!=null&&(b==null||b.getSpreadView().GetTopSpreadView()!=a.GetTopSpreadView()))if(!this.TryActivateSpread(this.lastPointerDownEvent,false,true)){this.ClearCachedObjects(e);return}else this.pointers.length==0&&this.Spread.GetActiveChartObj()==null&&(a.IsRetainSelection()||a.IsSpreadActive())&&this.UpdateResizeLocation(true);else if(b==this.Spread&&document.activeElement!=null&&document.activeElement.tagName=="BODY"){a.NeedSetEditorFocusOnActiveCell()&&this.CorrectFocusOnActiveCell(false,true);!$$.utils.contains(this.Spread,document.activeElement)&&l.setTextBoxFocus()}else if(b!=null&&b.isEditing()){!$$.utils.isNativeControl(e.target,true)&&b.getSpreadView().TryStopEditing(false,false,true);this.UpdateResizeLocation(true)}else this.pointers.length==0&&this.Spread.GetActiveChartObj()==null&&(a.IsRetainSelection()||a.IsSpreadActive())&&this.UpdateResizeLocation(true);a.UnregisterTimeoutTask("ShowHideContainer");b=a.GetActiveSpread();var i=a.GetTopSpreadView();if(b!=null&&b.getSpreadView().GetTopSpreadView()==i){var f=a.GetActiveSpreadView(false,true),d=f.Spread,g=f.GetSpreadContext(),c=a._IsGrayArea(document.activeElement);if(!c&&i.Viewport2)c=document.activeElement==i.Viewport2.parentNode;if(!d.isEditing()&&(c||g.getTextBox()!=document.activeElement&&!$$.utils.contains(d,document.activeElement))&&!f.IsPopupOpened()&&f.GetTopSpreadView().Spread.GetActiveChartObj()==null){!c&&b.getSpreadView().NeedSetEditorFocusOnActiveCell()&&g.correctFocusOnActiveCell(d.getAnchorCell(),true);!d.isEditing()&&(c||!$$.utils.contains(d,document.activeElement))&&g.setTextBoxFocus()}}this.ClearCachedObjects(e);if(this.handleIndex>=0){this.OnTouchHandleGestureEnd(e);this.ShowTouchHandles()}else if(a.EditModePermanent&&!$$.browser.webkit){var j=a.GetTopSpreadView(),m=j.Spread.getScrollvp()||j.Viewport.parentNode;if(!$$.utils.isOverScrollbar(e,m)){var k=a.GetActiveSpreadView(false,true);k.ProcessEditModePermanent(null,true)}}};e.prototype.AddTrackedPointerID=function(a){this.pointers.push(a)};e.prototype.RemoveTrackedPointerID=function(b){var a=this.pointers.indexOf(b);if(a>=0){this.pointers.splice(a,1);return true}else return false};e.prototype.StopTrackingGesture=function(){this.pointers=[];if($$.browser.mb&&this.eventMan&&this.Spread)this.eventMan.StopTrackingGesture();else this.gesture&&this.gesture.stop()};e.prototype.OnGestureStart=function(b){var a=this.SpreadView;if(!this.closedChartTouchStripRecently&&this.lastPointerDownEvent&&!a.IsSpreadActive(a.IsMultiColumnComboBox))if(!this.TryActivateSpread(b))return};e.prototype.OnGestureEnd=function(b){if(this.Spread==null)return;this.isOnTheFlyCreatedSelection=false;var g=d.GetGesturePointFromEvent(b),e=document.elementFromPoint(g.x,g.y)||document.body,a=this.SpreadView,h=a.GetSpreadContext();if(!this.closedChartTouchStripRecently){if(a.IsSpreadActive()){var c=a.GetTopSpreadView().Spread.GetActiveChartObj()!=null;!c&&this.Spread.getAnchorCell()==null&&this.checkSelectionState(b,a,true);if(!this.Spread.isEditing()&&document.activeElement!=h.getTextBox()&&!a.IsPopupOpened()){!c&&this.CorrectFocusOnActiveCellIfPossible(false,true);(!this.Spread.isEditing()||!$$.utils.contains(this.Spread,document.activeElement))&&a.FocusSpread()}}if(!$$.utils.contains(this.Spread,e,true)){var f=this.SimulateMouseEvent(b,{target:e});if(this.currentAction==4)this.StopColumnMoving(f);else(this.currentAction==1||this.currentAction==3)&&this.StopSelecting(f);if(this.lastPointerDownEvent){var i=this.GetPointerId(this.lastPointerDownEvent);if(this.RemoveTrackedPointerID(i)){this.closedTouchStripRecently=false;this.lastPointerDownEvent=null}}}}};e.prototype.OnGestureChange=function(a){if(this.HoldAndReleaseState!=this.HOLD_AND_RELEASE_INACTIVE)return;this.lastPointerMoveEvent=a;if(!this.closedChartTouchStripRecently&&this.currentAction==4){var c=d.GetGesturePointFromEvent(a),b=document.elementFromPoint(c.x,c.y)||document.body;if(!this.SpreadView.GetSpreadContext().isChild(b,this.Spread)){var e=this.SimulateMouseEvent(a,{target:b});this.ContinueColumnMoving(e)}}};e.prototype.OnGestureTap=function(b,f){$$.utils.cancelBubble(b);this.ignoreProcessDoubleTap=false;if(this.pointers.length==0){this.fireDoubleTap=false;this.CancelTouchDefaultBehaviors(b);return}if(this.closedChartTouchStripRecently||this.lastPointerDownEvent==null)return;var a=this.SpreadView,e=a.GetTopSpreadView().Spread;if(!this.CanPerformTouch(e,true,false))return;var h=a.GetSpreadContext(),c;if(this.ActivateSpreadByTouch(this.lastPointerDownEvent)==a||(c=h.getChartObj(this.lastPointerDownEvent.target))&&c.canSelect()){var d=a._IsGrayArea(this.lastPointerDownEvent.target,true),g=!d||a.GetActiveSpread()==null||a.GetTopSpreadView()!=a.GetActiveSpread().getSpreadView().GetTopSpreadView(),i=Date.now();this.ProcessGestureTap(b,f,d,g);if(this.fireDoubleTap){this.fireDoubleTap=false;this.CancelTouchDefaultBehaviors(b);this.OnGestureDoubleTap(b)}}else{if($$.browser.mb)this.ignoreProcessDoubleTap=true;c==null&&e.GetActiveChartObj()!=null&&a.GetTopSpreadView().GetSpreadContext().inactiveAllChart()}$$.browser.mb&&this.ShowTouchHandles()};e.prototype.ProcessGestureTap=function(r,p,C,E){var a=this.SpreadView,q=a.GetSpreadContext(),d=this.lastPointerDownEvent.target,v=q.getChartObj(d);if(v&&v.canSelect()){this.isOnTheFlyCreatedSelection=false;this.SimulateActivate(this.lastPointerDownEvent);v.onGestureTap(r);return}if(C||a.IsInFooter(d)||a.Pager.Contains(d)){this.isOnTheFlyCreatedSelection=false;if(E){this.SimulateMouseClick();if(this.resizeLocation==null&&a._IsFullRowSelectable){this.UpdateResizeLocation(false);this.ShowTouchHandles(true,false)}}this.CancelTouchDefaultBehaviors(r);return}var z=a.GetPreviewRow(d),j=z!=null,t=false,c=a._GetActiveCellRange(),b=$$.browser.webkit?this.lastPointerDownLocation:this.GetTappedLocation(r),k=a.GetTopSpreadView(),s=k.Spread.GetActiveChartObj()!=null,q=a.GetSpreadContext();if(j||q.getTitleBar()==d||$$.utils.contains(d,q.getTitleBar())||q.getSubTitleBar()==d||$$.utils.contains(d,q.getSubTitleBar()))k.GetSpreadContext().inactiveAllChart(k.Spread);else s=false;if(j)b.Row=a._GetRowIndexFromNonSelectableRow(z);else if(a.RowHeader.Contains(d)&&d.tagName=="IMG"&&$$.utils.FindParent(d,"TR").getAttribute("FpSpread")=="rh"){var A=d.getAttribute("onclick");if(A&&A.indexOf(".ExpandRow(")>0)t=true}var e,i,m,u=-1,F=false,o=false;if(b!=null){var l=b.Row,h=b.Column;i=l;m=h;if(l>=0&&h>=0){var f=a.GetCell(l,h,true);i=f.Row;m=f.Column;if(a.IsMultiColumnComboBox)this.resizeLocation=null;else{if(c&&(a.SelectionModel.Contains(i,m,1,1,b.Index)||a.SelectionModel.Contains(-1,h,-1,1,b.Index)||a.SelectionModel.Contains(l,-1,1,-1))){this.ignorePointerUp=true;var w=c.Contains(-1,-1,-1,-1)||a.SelectionModel.Contains(-1,-1);if(w)if(this.IsTouchStripOpened)if(a.IsViewportCell(d)){this.SimulateMouseClick();this.ResizeLocation=null;return}if(this.closedTouchStripRecently){if(this.Spread.GetSelectedRanges().length==1&&(c.Row>=0&&c.Row==f.Row&&c.RowCount<=f.HtmlCell.rowSpan||c.Row<0&&f.HtmlCell.rowSpan>=a.ViewRowCount)&&(c.Column>=0&&c.Column==f.Column&&c.ColumnCount<=f.HtmlCell.colSpan||c.Column<0&&f.HtmlCell.colSpan>=a.ColumnCount))if(a.OperationMode==0&&f.HtmlCell.getAttribute("canFocus")!="false"){if(!this.SimulateMouseClick())return;if(!this.SimulateMouseDoubleClick())return;this.ResizeLocation=null}else{this.SimulateActivate(this.lastPointerDownEvent);this.UpdateResizeLocation()}else if(w){this.SimulateMouseClick();this.ResizeLocation=null}else{this.SimulateActivate(this.lastPointerDownEvent);this.UpdateResizeLocation()}return}else if(!j||a.SelectionModel.Contains(l,h,a.IsRowLayoutMode?a.LayoutRowCount+1:2,1)){var g=this.lastPointerDownEvent;if(this.ShowTouchStrip(g.target,g.offsetX,g.offsetY,null,p)){this.isOnTheFlyCreatedSelection=false;this.SimulateActivate(this.lastPointerDownEvent,true);this.UpdateResizeLocation();return}}}if(j){this.isOnTheFlyCreatedSelection=false;this.SimulateMouseClick();this.CancelTouchDefaultBehaviors(r);if(s||this.resizeLocation==null&&a._IsFullRowSelectable){this.UpdateResizeLocation(false);if(s)a.ShowFocusRectangle();else this.ShowTouchHandles(true,false)}return}if((!p||this.resizeLocation==null)&&a._IsFullRowSelectable&&!this.closedTouchStripRecently)if(c!=null&&(this.resizeLocation==null||this.resizeLocation.Column==-1||b!=null&&b.Row>=0&&b.Column>=0&&a.GetCanFocus(b.Row,b.Column))){if(this.resizeLocation==null){e={Column:-1,Row:c.Row+c.RowCount-1,Index:a.RowHeader.ColumnCount-1};this.SetResizeLocation(e)}else if(b==null||b.Row<0||b.Column<0||a.GetCanFocus(b.Row,b.Column)){e={Column:-1,Row:c.Row+c.RowCount-1,Index:Math.min(this.resizeLocation.Index,a.RowHeader.ColumnCount-1)};this.SetResizeLocation(e)}}else c==null&&this.SetResizeLocation(null)}}else if(h>=0){if(t)this.closedTouchStripRecently=false;else if(this.closedTouchStripRecently){this.SimulateActivate(this.lastPointerDownEvent);this.UpdateResizeLocation();this.closedTouchStripRecently=false;return}else{m=a.ColumnHeader._GetMostLeftColumnIndex(b.Index,h);if(a.IsRowLayoutMode)u=a.ColumnHeader._GetMostTopRowIndex(b.Index,h);if(c&&a.SelectionModel.Contains(-1,m,u)){var g=this.lastPointerDownEvent;if(this.ShowTouchStrip(g.target,g.offsetX,g.offsetY,1,p)){this.isOnTheFlyCreatedSelection=false;this.SimulateActivate(this.lastPointerDownEvent,true);this.resizeLocation==null&&!a.SelectionModel.Contains(-1,-1,-1,-1)&&this.SetResizeLocation(b);this.ShowHandles(true,true);return}}}e=b;this.SetResizeLocation(b);o=!(a.OperationMode==0||a.OperationMode==2)}else if(l>=0){if(t)this.closedTouchStripRecently=false;else if(this.closedTouchStripRecently){this.isOnTheFlyCreatedSelection=false;this.SimulateActivate(this.lastPointerDownEvent);this.UpdateResizeLocation();this.closedTouchStripRecently=false;return}else{i=a.RowHeader._GetMostTopRowIndex(l,b.Index);if(c&&a.SelectionModel.Contains(i,-1)&&(!j||a.SelectionModel.Contains(i,-1,a.IsRowLayoutMode?a.LayoutRowCount+1:2,-1))){var g=this.lastPointerDownEvent;if(this.ShowTouchStrip(g.target,g.offsetX,g.offsetY,2,p)){this.isOnTheFlyCreatedSelection=false;this.SimulateActivate(this.lastPointerDownEvent,true);!j&&this.resizeLocation==null&&!a.SelectionModel.Contains(-1,-1,-1,-1)&&this.SetResizeLocation(b);this.ShowHandles(true,true);return}}}if(!j){e=b;this.SetResizeLocation(b)}}}else if(!this.closedTouchStripRecently&&a.Corner.Contains(this.lastPointerDownEvent.target)){var n=$$(d).getParent("TR");while(n!=null&&n.getAttribute("FpSpread")==null)n=$$(n).getParent("TR");(n==null||n.getAttribute("FpSpread")!="fb")&&this.SetResizeLocation(null);o=a.Parent!=null&&!(a.OperationMode==0||a.OperationMode==2)}this.resizeLocation!=null&&this.resizeLocation.Row<0&&this.resizeLocation.Column<0&&this.SetResizeLocation(null);if(this.closedTouchStripRecently)a.EditModePermanent&&this.SimulateActivate(this.lastPointerDownEvent,true);else{if(!p||!b||!a.SelectionModel.Contains(i,m,u)||a.IsMultiColumnComboBox){var B=a.GetActiveSpreadView(false,true),y=false;if($$.browser.webkit&&d.tagName=="IMG"&&a.RowHeader.Contains(d)){a.SuspendAction(k.Spread,GCWS.Actions.SWITCH_KEYBOARD);y=true}var D=!this.SimulateMouseClick();y&&a.ResumeAction(k.Spread,GCWS.Actions.SWITCH_KEYBOARD);if(D)return;if(e!=null&&((b=this.resizeLocation)==null||b.Column!=e.Column||b.Index!=e.Index||b.Row!=e.Row)){this.SetResizeLocation(e);this.ShowHandles(true,false)}if(!o&&B!=a.GetActiveSpreadView(false,true))o=true}if(k.Spread.GetActiveChartObj()!=null)return;if(this.CanPerformTouch(k.Spread,false,false))!a.ColumnHeader.Contains(d)&&!a.RowHeader.Contains(d)&&!a.IsMultiColumnComboBox&&this.UpdateResizeLocationAfterTap(r,c);else this.SetResizeLocation(null)}var x=a.GetActiveSpreadView(false,true);if(o||s)x.ShowFocusRectangle();else x.Touch.ShowHandles(true,!this.closedTouchStripRecently)};e.prototype.ActivateSpreadByTouch=function(c,l){if(this.lastPointerDownEvent==null){this.lastPointerDownEvent=c;if(this.lastPointerDownEvent==null)return}var b=this.SpreadView,a=b,g=a.GetSpreadContext(),e=g.getChartObj(this.lastPointerDownEvent.target),o=e&&e.canSelect(),p=this.initialSpreadTouchPos||d.GetGesturePointFromEvent(this.lastPointerDownEvent),q=d.GetGesturePointFromEvent(c);if(o&&d.CalculateSquaredDistance(p,q)>0){e.chartSpread.SetActiveChart(e.chartID);return}var i=b._IsGrayArea(this.lastPointerDownEvent.target,true),n=!i||b.GetActiveSpread()==null||b.GetTopSpreadView()!=b.GetActiveSpread().getSpreadView().GetTopSpreadView();if(n){if(!i){var h=b.GetActiveSpreadView(false,true,false);if(h!=null&&h.IsInFocusRectangle(this.lastPointerDownEvent.target))a=h}if(c!=null)if(!a.IsSpreadActive(a.IsMultiColumnComboBox)){var k=a.SelectionModel.IsEmpty()?null:a.Spread.GetSelectedRange(),m=(k==null||k.anchor)&&g.getXmlActiveRow()!=-1&&g.getXmlActiveCol()!=-1&&a.OperationMode==0;if(!a.Touch.TryActivateSpread(c,l,m))return null}else{var j=a.Spread.GetActiveChartObj(),f;if(j!=null&&!$$.utils.contains(j.container,f=c.target))if(!a.IsInViewport(c.target)){if(i||a.ColumnHeader.Contains(f)||a.RowHeader.Contains(f)||a.Corner.Contains(f)){g.inactiveAllChart(a.Spread);a.Touch.UpdateResizeLocation();a.ShowFocusRectangle()}else setTimeout(function(){var b=a.Spread.GetActiveChartObj();b&&b.Focus()},0);a.Spread.GetActiveChartObj()==null&&a.SelectionModel.IsEmpty()&&a.RowCount>0&&a.ColumnCount>0&&this.regenerateSelection(a)}}return a}else return a.IsSpreadActive(a.IsMultiColumnComboBox)?a:null};e.prototype.SetResizeLocation=function(a){if(a==null||a.Index==null||a.Index<0)this.resizeLocation=null;else this.resizeLocation=a};e.prototype.UpdateResizeLocation=function(e,g){if(this.Spread==null)return;if(this.Spread.GetActiveChartObj()!=null)return;var b=this.SpreadView,a=b._GetActiveCellRange(true);if(this.resizeLocation==null&&!this.requireUpdateResizeLocation){if(a!=null)if(a.Row==-1){if(a.Column>=0)if(b.ColumnHeader.RowCount>0){var c,d;if(b.IsRowLayoutMode){c=a.Column;d=a.LayoutRow}else{c=Math.min(a.Column+a.ColumnCount-1,b.ColumnCount-1);d=b.ColumnHeader.RowCount-1}c>=0&&this.SetResizeLocation({Row:-1,Column:c,Index:d})}}else if(a.Column==-1)if(b.RowHeader.ColumnCount>0){var f=Math.min(a.Row+a.RowCount-1,b.RowCount-1);if(f<0){e&&this.ShowHandles(true,false);return}this.SetResizeLocation({Row:f,Column:-1,Index:b.RowHeader.ColumnCount-1})}}else if(g&&this.requireUpdateResizeLocation&&this.resizeLocation!=null){this.requireUpdateResizeLocation=false;if(this.Spread.isEditing())(a==null||a.Row>=0&&a.Column>=0||this.resizeLocation.Column>=0&&!a.Contains(-1,this.resizeLocation.Column,-1,1)||this.resizeLocation.Row>=0&&!a.Contains(this.resizeLocation.Row,-1,1,-1))&&this.SetResizeLocation(null)}e&&this.ShowHandles(true,false)};e.prototype.OnGestureDoubleTap=function(h){if($$.browser.mb&&$$.browser.ie&&h.type!="MSGestureTap"&&h.type!=c.GESTURE_DOUBLE_TAP)return;if(this.ignoreProcessDoubleTap)return;var a=this.SpreadView,n=a._GetActiveCellRange();if(!this.lastPointerDownEvent)return;var d=$$.browser.webkit?h.target:this.lastPointerDownEvent.target;if(a.IsInViewport(d)&&(a.OperationMode==0||a.OperationMode==2)){if(a.GetPreviewRow(d)==null){var b,j=false,e=this.GetTappedLocation(this.lastPointerDownEvent);if(e==null||(b=a.GetCell(e.Row,e.Column,true))==null||(j=b.CanFocus)){var g=a.SelectionModel;if(!j&&!g.IsEmpty()){var f=g.GetFocusCellRange(),l=f.RowCount<0||f.RowCount>1||f.ColumnCount<0||f.ColumnCount>1;if(!l)l=this.Spread.GetSelectedRanges().length>1;if(l){g.ClearSelection();if(!this.SimulateMouseClick())return}}else if(j&&b.Editable&&b.HtmlCell.getAttribute("RowEditTemplate")!="true"){var k=this.SpreadContext,i=true;if(a.OperationMode==2)if(b.HtmlCell.rowSpan>1&&!a.SelectionModel.IsEmpty()){var f=g.GetFocusCellRange();i=f!=null&&b.Row!=f.Row}else i=false;if(i){g.ClearSelection();k.setSelectType("")}$$.browser.mb&&!this.isSimulateMouseClickCalled&&a.IsRowLayoutMode&&a.OperationMode==2&&this.SimulateMouseClick();if(!a.SetAnchorCell(b,true,true,true)){k.setLeadingCell(b.HtmlCell);k.setStartSelectLocation(b.HtmlCell)}if(a.SelectionModel.IsEmpty()){this.regenerateSelection(a,true);this.Spread.fpSpreadJS.keepGeneratedSelectionFromAnchorCell()}}if(!this.SimulateMouseDoubleClick())return;if(this.Spread.isEditing())if(this.showTouchStripTimeoutId!=null){clearTimeout(this.showTouchStripTimeoutId);this.showTouchStripTimeoutId=null}else this.IsTouchStripOpened&&this.HideTouchStrip()}}else if(this.resizeLocation!=null)return}else if(!$$.browser.ie&&(a.AllowGroup||a.AllowSort)&&a.ColumnHeader.Contains(d)){var o=this.SpreadContext,b=o.getCell(d);if(b&&typeof b.ondblclick=="function"){this.showTouchStripTimeoutId&&clearTimeout(this.showTouchStripTimeoutId);var m=b.ondblclick;if(a.EditModePermanent)setTimeout(m,0);else m()}}if(this.Spread==null)return;if(!a.IsInFooter(d)&&!a.ColumnHeader.Contains(d)&&!a.RowHeader.Contains(d)){var e=this.GetTappedLocation(this.lastPointerDownEvent);e!=null&&e.Column!=null&&e.Row!=null&&this.UpdateResizeLocationAfterTap(h,n,e,true)}};e.prototype.UpdateResizeLocationAfterTap=function(g,c,b,e){var a=this.SpreadView,h=c==null?-1:c.Row,f=c==null?-1:c.RowCount;if(b==null)b=this.GetTappedLocation(g);var d=a._GetActiveCellRange();(a._IsFullRowSelectable&&d&&(h!=d.Row||f!=d.RowCount)&&(this.resizeLocation==null||(this.resizeLocation.Column==-1||a.OperationMode!=0)&&this.resizeLocation.Row!=d.Row)||!a._IsFullRowSelectable&&b!=null&&b.Row>=0&&b.Column>=0&&a.GetCanFocus(b.Row,b.Column))&&this.SetResizeLocation(null);this.UpdateResizeLocation(e);this.requireUpdateResizeLocation=a.EditModePermanent&&!a._IsFullRowSelectable&&this.lastPointerDownEvent&&a.IsInViewport(this.lastPointerDownEvent.target)};e.prototype.SimulateActivate=function(a,e){var b=this.SpreadView,d=b.GetSpreadContext(),c={type:"mousedown",simulatedEvent:true,target:a.target,srcElement:a.srcElement};if(b.IsSpreadActive(true)){var f=this.SimulateMouseEvent(a,c);d.setActiveSpread(f)}c.type="activate";d.spreadActive(c);!e&&this.Spread!=document.activeElement&&(document.activeElement!=b.__GetSpreadTextBox()||$$.utils.isNativeControl(a.target))&&!$$.utils.contains(this.Spread,document.activeElement)&&a.target.focus()};e.prototype.SimulateMouseClick=function(){var b=this.SpreadView,h=b.GetSpreadContext();this.isClickSimulating=true;try{var c=this.lastPointerDownEvent,a=c.target;if(this.GetHandleIndex(a)>=0||b.IsInFocusRectangle(a)){var g=d.GetGesturePointFromEvent(c);a=document.elementFromPoint(g.x,g.y);if(a!=this.Spread&&!$$.utils.contains(this.Spread,a))a=this.Spread}var f=d.CreateMouseEvent(c,"mousedown",true);a.dispatchEvent(f);this.isOnTheFlyCreatedSelection=false;!b.IsMultiColumnComboBox&&!b.AllowTapToAddSelection()&&this.SimulateActivate(c);f=d.CreateMouseEvent(c,"mouseup",true);a.dispatchEvent(f);if(this.Spread==null)return false;var e=this.Spread.getAnchorCell();e&&(b.ColumnHeader.Contains(e)||b.RowHeader.Contains(e))&&h.paintAnchorCell(true)}finally{this.isClickSimulating=false}if($$.browser.mb)this.isSimulateMouseClickCalled=true;return this.Spread!=null};e.prototype.SimulateMouseDoubleClick=function(){this.SpreadView.GetSpreadContext().dblclick(this.lastPointerDownEvent);return this.Spread!=null};e.prototype.SimulateMouseEvent=function(b,e){var a={};a.type=b.type;a.target=b.target;a.wheelDelta=b.wheelDelta;a.button=b.button;if(e)for(var f in e)a[f]=e[f];a.srcElement=a.target;a.x=b.x;a.y=b.y;var c=d.GetTouchObjectFromEvent(b);a.clientX=c.clientX;a.clientY=c.clientY;a.offsetX=c.offsetX;a.offsetY=c.offsetY;return a};e.prototype.OnGestureHold=function(c){var b=this.SpreadView;if(!this.CanPerformTouch(b.GetTopSpreadView().Spread,true,false))return;if(this.gestureHoldVisualStarted){this.gestureHoldVisualStarted=false;this.gestureHoldStarted=false;var a;if(!$$.browser.isTouchEventModel)if(!b.IsMultiColumnComboBox&&this.lastPointerDownEvent||(a=b.GetActiveSpreadView(false,true))&&!a.IsMultiColumnComboBox&&a.Touch.lastPointerDownEvent)this.HoldAndReleaseState=this.HOLD_AND_RELEASE_ACTIVE;$$.utils.cancelBubble(c,false)}else{this.gestureHoldStarted=true;this.CancelTouchDefaultBehaviors(c)}};e.prototype.OnGestureHoldVisual=function(c){var a=this.SpreadView;if(this.gestureHoldStarted)this.gestureHoldVisualStarted=true;else if(a.IsMultiColumnComboBox){var b=a.GetHostSpread().getSpreadView();b.Touch.UpdateResizeLocation(true)}if(a!=null)this.closedPopupRecently=a.HidePopup();$$.utils.cancelBubble(c,false)};e.prototype.OnGContextMenu=function(a){if(a.type!=c.CONTEXT_MENU)return;if($$.browser.isTouchEventModel&&this.SpreadView.IsMultiColumnComboBox)return;if(this.handleIndex>=0){this.OnTouchHandleGestureHoldAndRelease(a);this.ignorePointerUp=true}else!GCWS.FilterEditor.IsFilterControl(a.target)&&this.OnGestureHoldAndRelease(a);this.holdAndReleaseState=this.HOLD_AND_RELEASE_INACTIVE;if($$.browser.webkit){var b=document.createEvent("MouseEvent");b.initMouseEvent("contextmenu",true,true,window,1,a.screenX,a.screenY,a.clientX,a.clientY,false,false,false,false,2,null);a.target.dispatchEvent(b);this.IgnoreContextMenuEvent=true}};e.prototype.OnGestureHoldAndRelease=function(k){if(!this.IsInTouchMode)this.IsInTouchMode=true;var a=this.SpreadView,l=this.closedTouchStripRecently,w=this.closedChartTouchStripRecently,m=a._GetActiveCellRange(),o=this.Spread.GetActiveChartObj();if(this.closedChartTouchStripRecently)this.ignorePointerUp=true;this.closedChartTouchStripRecently=false;this.closedTouchStripRecently=false;if($$.utils.isNativeControl(k.target))return;this.OnGestureTap(k,true);var q=a._GetActiveCellRange(),g=this.Spread.GetActiveChartObj();if(m==null||o!=g||q&&!q.Equals(m))l=false;var f,e=false,h=this.lastPointerDownEvent,s=h?h.offsetX:-1,t=h?h.offsetY:-1;if(!w&&o!=g&&g!=null){e=true;f=g.container;var u=g.calculateTouchStripOffset(h);s=u.X;t=u.Y}else if(this.lastPointerDownEvent){var d=$$.browser.webkit?this.lastPointerDownLocation:this.GetTappedLocation(this.lastPointerDownEvent);e=d!=null;f=this.lastPointerDownEvent.target;if(e){var r=a.GetPreviewRow(f),n=r!=null;if(n)d.Row=a._GetRowIndexFromNonSelectableRow(r);var c=d.Row,b=d.Column,j=d.Index;if(c<0&&b>=0){b=a.ColumnHeader._GetMostLeftColumnIndex(d.Index,b);if(a.IsRowLayoutMode)j=a.ColumnHeader._GetMostTopRowIndex(j,b)}else if(c>=0&&b<0)c=a.RowHeader._GetMostTopRowIndex(c,d.Index);else if(c>=0&&b>=0){var v=a.GetCell(c,b,true);c=v.Row;b=v.Column}var p=a.SelectionModel;if(p.Contains(c,b,j)){if(n&&c>=0&&!p.Contains(c,b,a.IsRowLayoutMode?a.LayoutRowCount+1:2,b<0?-1:1))e=false}else e=false}}if(e){if(!l&&this.lastPointerDownEvent)if(!this.IsTouchStripOpening){var i=null;if(a.ColumnHeader.Contains(f))i=1;else if(a.RowHeader.Contains(f))i=2;if(this.ShowTouchStrip(f,s,t,i)){this.IgnoreContextMenuEvent=true;if($$.browser.isTouchEventModel&&a.EditModePermanent){var x=a.GetSpreadContext();x.switchHiddenTextBox(true)}}}this.CancelTouchDefaultBehaviors(k)}if(this.IsTouchStripOpening)this.IgnoreContextMenuEvent=true};e.prototype.OnContextMenu=function(a){if(this.IsInTouchMode&&!this.CanPerformTouch(this.SpreadView.GetTopSpreadView().Spread,false,false))return;if(this.IgnoreContextMenuEvent){this.IgnoreContextMenuEvent=false;$$.utils.cancelBubble(a,true)}};e.prototype.GetHandleIndex=function(c){if(this.touchHandles==null)return-1;var b=this.touchHandles.indexOf(c);if(b<0)for(var a=0;a<this.touchHandles.length;a++)if($$.utils.contains(this.touchHandles[a],c)){b=a;break}return b};e.prototype.OnFocusRectanglePointerDown=function(a){!$$.utils.isTouchEvent(a)&&this.ExitFromTouchMode()};e.prototype.OnFocusRectangleContextMenu=function(a){$$.utils.cancelDefault(a);if(!this.CanPerformTouch(this.SpreadView.GetTopSpreadView().Spread,false,false))return;a.target&&this.SpreadView.IsSpreadActive(true)&&this.ShowTouchStrip(a.target,a.offsetX,a.offsetY)};e.prototype.OnTouchHandleGestureHoldAndRelease=function(a){$$.utils.cancelDefault(a);if(this.CanPerformTouch(this.SpreadView.GetTopSpreadView().Spread,false,false))if(a.target&&(this.handleIndex==this.SELECTION_1_HANDLE||this.handleIndex==this.SELECTION_2_HANDLE)){var b=d.GetTouchObjectFromEvent(a);if(this.ShowTouchStrip(a.target,b.offsetX,b.offsetY))this.IgnoreContextMenuEvent=true}this.handleIndex=-1};e.prototype.OnTouchHandlePointerDown=function(a){var b=this.SpreadView;if($$.utils.isTouchEvent(a)){if($$.browser.isTouchEventModel)if(a.touches&&a.touches.length>1)return;this.gesture&&this.gesture.stop();if(b.ActiveDialog==null){if(this.currentAction==0){this.lastPointerDownEvent=a;var e=a.target;this.handleIndex=this.GetHandleIndex(e);if(this.handleIndex==-1)return;this.initialTouchHandleTime=new Date;this.initialTouchHandlePos=d.GetGesturePointFromEvent(a);if($$.browser.mb)this.handleEventMan.StartTrackingGesture(a);else{if(this.handleGesture==null)this.handleGesture=new MSGesture;else this.handleGesture.stop();this.handleGesture.target=e;this.handleGesture.addPointer(this.GetPointerId(a))}this.closedTouchStripRecently=this.IsTouchStripOpening;if(this.showTouchStripTimeoutId!=null){clearTimeout(this.showTouchStripTimeoutId);this.showTouchStripTimeoutId=null}this.closedPopupRecently=b.HidePopup();b.CloseEditorDropDown();var c=this.SpreadContext;if(!b.IsMultiColumnComboBox&&!b.IsSpreadActive()&&!this.Spread.isEditing()&&!c.isChild(document.activeElement,this.Spread)){c.setActiveSpread(a);c.setTextBoxFocus()}(this.handleIndex==this.SELECTION_2_HANDLE||this.handleIndex==this.SELECTION_1_HANDLE)&&b.IsSpreadActive()&&!this.Spread.isEditing()&&c.setTextBoxFocus();this.fireDoubleTap=false;if(!$$.browser.mb){this.fireDoubleTap=false;var f=new Date;if(this.lastPointerDownPosition&&+f-+this.lastPointerDownTime<this.DOUBLE_TAP_TIME&&d.CalculateSquaredDistance(this.lastPointerDownPosition,a)<this.DOUBLE_TAP_THRESHOLD){this.lastPointerDownPosition=null;this.fireDoubleTap=true}else{this.lastPointerDownTime=f;this.lastPointerDownPosition=a}}this.lastPointerDownEvent=a;if(!this.IsInTouchMode)this.IsInTouchMode=true}else this.OnPointerDown(a);$$.utils.cancelBubble(a,false)}}else{var g=b.IsPopupOpened;this.ExitFromTouchMode();if(g||!b.IsSpreadActive()){this.lastPointerDownEvent=a;this.SimulateMouseClick();this.lastPointerDownEvent=null}}this.CancelTouchDefaultBehaviors(a)};e.prototype.OnTouchHandlePointerMove=function(a){$$.utils.isTouchEvent(a)&&this.CancelTouchDefaultBehaviors(a)};e.prototype.OnTouchHandlePointerUp=function(a){if($$.utils.isTouchEvent(a)){if(this.currentAction!=0&&this.currentAction!=2)this.OnPointerUp(a);else if(this.currentAction!=0){this.HoldAndReleaseState=this.HOLD_AND_RELEASE_INACTIVE;this.ClearCachedObjects(a)}this.isOnTheFlyCreatedSelection=false}};e.prototype.OnTouchHandlePointerCancel=function(a){if($$.utils.isTouchEvent(a)){$$.browser.isTouchEventModel&&this.HandleIndex!=-1&&this.OnTouchHandleGestureEnd(a);if(this.currentAction!=0&&this.currentAction!=2)this.OnPointerCancel(a);else{this.HoldAndReleaseState=this.HOLD_AND_RELEASE_INACTIVE;this.ClearCachedObjects(a)}$$.browser.mb&&this.OnTouchHandlePointerUp(a)}};e.prototype.OnTouchHandleGestureChange=function(a){var c=this.HoldAndReleaseState;if(c!=this.HOLD_AND_RELEASE_INACTIVE){if(c==this.HOLD_AND_RELEASE_ACTIVE)this.HoldAndReleaseState=this.HOLD_AND_RELEASE_ACTIVE_NOT_FIRE;return}var f=d.GetGesturePointFromEvent(a),b=document.elementFromPoint(f.x,f.y)||document.body;if(this.touchHandles[this.handleIndex]==b||$$.utils.contains(this.touchHandles[this.handleIndex],b)){this.CancelTouchDefaultBehaviors(a);return}this.lastPointerMoveEvent=a;var e={target:b,offsetX:a.offsetX,offsetY:a.offsetY,clientX:a.clientX,clientY:a.clientY};switch(this.currentAction){case 1:this.ContinueSelecting(e);break;case 2:this.ContinueResizing(e)}};e.prototype.OnTouchHandleGestureStart=function(c){var e=this.SpreadView;if(this.lastPointerDownEvent&&!e.IsSpreadActive(e.IsMultiColumnComboBox))if(!this.TryActivateSpread(c))return;if(this.HoldAndReleaseState!=this.HOLD_AND_RELEASE_INACTIVE)return;var a=d.GetGesturePointFromEvent(c),b=document.elementFromPoint(a.x,a.y);if(b==null)b=c.target;var f={target:b,clientX:a.x,clientY:a.y};if(this.handleIndex<2)this.StartSelecting(f);else this.StartResizing(f)};e.prototype.OnTouchHandleGestureEnd=function(e){var a=d.GetGesturePointFromEvent(e),c=document.elementFromPoint(a.x,a.y)||document.body,b={target:c,srcElement:c,clientX:a.x,clientY:a.y};if(this.handleIndex<2)(this.currentAction==1||this.currentAction==3)&&this.StopSelecting(b);else this.currentAction==2&&this.StopResizing(b);this.ClearCachedObjects(e,false);this.currentAction=0;this.isOnTheFlyCreatedSelection=false;if($$.browser.ie)setTimeout(Function.CreateDelegate(this,function(){this.CorrectFocusOnActiveCellIfPossible(false,true)}),0);else this.CorrectFocusOnActiveCellIfPossible(false,true)};e.prototype.OnTouchHandleGestureTap=function(c){$$.utils.cancelBubble(c);var a=this.SpreadView,i=this.SpreadContext;if(!this.CanPerformTouch(a.GetTopSpreadView().Spread,false,false))return;var f=!a.SelectionModel.IsEmpty();if(!f){this.SimulateActivate(c);f=!a.SelectionModel.IsEmpty();!f&&i.getXmlActiveRow()!=-1&&this.regenerateSelection(a)}if(this.Spread.onTouchHandleGestureTap)this.Spread.onTouchHandleGestureTap(c);if(this.fireDoubleTap){this.fireDoubleTap=false;this.OnTouchHandleGestureDoubleTap(c)}else{var e;if(c.target&&(this.handleIndex==this.SELECTION_1_HANDLE||this.handleIndex==this.SELECTION_2_HANDLE))if(!this.closedTouchStripRecently&&f)this.ShowTouchStrip(c.target,c.offsetX,c.offsetY,null,true);else{if(this.closedTouchStripRecently){var b=a._GetActiveCellRange(),h=Math.max(b.Row,Math.min(a.RowCount-1,0)),g=Math.max(b.Column,Math.min(a.ColumnCount-1,0)),d=h<0||g<0?null:a.GetCell(h,g,true);if(d!=null&&this.Spread.GetSelectedRanges().length==1&&(b.Row>=0&&b.RowCount<=d.HtmlCell.rowSpan||b.Row<0&&d.HtmlCell.rowSpan>=a.ViewRowCount)&&(b.Column>=0&&b.ColumnCount<=d.HtmlCell.colSpan||b.Column<0&&d.HtmlCell.colSpan>=a.ColumnCount)){this.Spread.StartEdit();if(this.Spread.isEditing())this.ResizeLocation=null}else{a.NeedSetEditorFocusOnActiveCell()&&this.CorrectFocusOnActiveCell();e=true}}else e=true;this.closedTouchStripRecently=false}else{if(this.closedTouchStripRecently||this.closedPopupRecently)a.NeedSetEditorFocusOnActiveCell()&&this.CorrectFocusOnActiveCell(true);e=true}e&&a.EditModePermanent&&a.ProcessEditModePermanent(0)}this.handleIndex=-1};e.prototype.OnTouchHandleGestureDoubleTap=function(b){if(this.resizeLocation!=null&&this.resizeLocation.Row==-1&&(this.handleIndex==this.RESIZE_COLUMN_HANDLE||$$.browser.mb&&$$.utils.contains(this.touchHandles[this.RESIZE_COLUMN_HANDLE],b.target,true))){var a=this.SpreadView;if(a.TryStopEditing(false,false,true)&&a.EnsureFilteringState()){!a.IsMultiColumnComboBox&&this.SpreadContext.setTextBoxFocus();this.Spread.SizeToFit(this.resizeLocation.Column,false);if(!a.IsMultiColumnComboBox)if(a.EditModePermanent)a.GetSpreadContext().doGetFocus();else a.NeedSetEditorFocusOnActiveCell()&&this.CorrectFocusOnActiveCell()}}};e.prototype.StartSelecting=function(E){if(window.fpPostOn==null&&this.SpreadView.TryStopEditing(false,false,true)){var g=this.handleIndex>-1?E.target:$$.utils.GetCell(this.lastPointerDownEvent.target);if(g==null)return;var a=this.SpreadView,p=a.IsColumnHeaderCell(g),w=a.IsRowHeaderCell(g,true);if(a.IsRowLayoutMode){if(p)return;if(w&&(a.OperationMode==0||a.OperationMode==4||a.OperationMode==5))return}else if(p&&(a.OperationMode!=0||(a.SelectionBlockOptions&4)==0))return;var e=a.GetSpreadContext(),b=a.SelectionModel._GetFocusRange();this.selectStartColumn=this.selectStartRow=-1;this.selectArgs={};e.inactiveAllChart(a.Spread);this.HideTouchHandles();var y=!a.IsRowLayoutMode&&a.SelectionModel.SelectionPolicy==2&&this.Spread.TapToAddSelection;if(p){var s=a._GetColumnIndex(g);if(s==-1)return;if(b!=null)if(y)e.paintAnchorCell(false);else this.Spread.ClearSelection(false,null,false);this.selectStartColumn=s;this.selectArgs.SelectStartColumn=this.selectArgs.SelectEndColumn=s;(a.IsRowLayoutMode||a.Rows.length==0)&&a.SetAnchorCell(g);if(e.selectColumn(this.selectStartColumn,1,true,false,true)){this.currentAction=3;if(this.ResizeLocation!=null&&this.ResizeLocation.Column!=this.selectStartColumn)this.ResizeLocation=null}}else if(w){var l=-1,B;if((B=a.GetPreviewRow(g))!=null||a.IsUnSelectableCell(g))l=a._GetRowIndexFromNonSelectableRow(B||g.parentNode);else l=a._GetRowIndex(g);if(l==-1)return;if(b!=null)if(y)e.paintAnchorCell(false);else this.Spread.ClearSelection(false,null,false);this.selectStartRow=l;this.selectArgs.SelectStartRow=this.selectArgs.SelectEndRow=l;a.Columns.length==0&&a.SetAnchorCell(g);if(e.selectRow(a._GetRow(l).ViewIndex,1,true,false,true)){this.currentAction=3;if(this.ResizeLocation!=null&&this.ResizeLocation.Row!=this.selectStartRow)this.ResizeLocation=null}}else{var n=b!=null?b.left==-1&&b.top>-1:false,m=b!=null?b.top==-1&&b.left>-1:false,k=this.handleIndex==0?m?a.RowCount-1:b.bottom:m?0:b.top,j=this.handleIndex==0?n?a.ColumnCount-1:b.right:n?0:b.left,u=true,c=null,h=null;if(m&&(b.left!=b.right||a.RowCount>1)){c=k>-1?a.GetCell(k,j,true):null;if(c!=null&&c.HtmlCell.rowSpan!=a.RowCount)for(var z=a.SelectionModel.GetFocusCellRange(),C=this.handleIndex==0?-1:1,f=k;this.handleIndex==0?f>=0:f<a.RowCount;f+=C){var d=a.GetCell(f,j,true);if(d!=null&&(d.HtmlCell.colSpan==1||z.IsCoverable(new GCWS.CellRange(d.Row,d.Column,d.HtmlCell.rowSpan,d.HtmlCell.colSpan)))){c=d;break}}if(c==null&&a.ColumnHeader.RowCount>0){var D=a.IsRowLayoutMode?b.layoutRow>-1?b.layoutRow:0:a.ColumnHeader.RowCount-1;h=a.ColumnHeader._GetHtmlCell(D,j)}}else if(n&&(b.top!=b.bottom||a.ColumnCount>1)){c=j>-1?a.GetCell(k,j,a.CanExtendSelect()):null;if(c!=null&&c.HtmlCell.colSpan!=a.ColumnCount)for(var z=a.SelectionModel.GetFocusCellRange(),C=this.handleIndex==0?-1:1,f=j;this.handleIndex==0?f>=0:f<a.ColumnCount;f+=C){var d=a.GetCell(k,f,true);if(d!=null&&(d.HtmlCell.rowSpan==1||z.IsCoverable(new GCWS.CellRange(d.Row,d.Column,d.HtmlCell.rowSpan,d.HtmlCell.colSpan)))){c=d;break}}if(c==null&&a.RowHeader.ColumnCount>0)for(var f=a.RowHeader.ColumnCount-1;f>=0;f--){var A=a.RowHeader._GetHtmlCell(k,f);if(A!=null){h=A;break}}}else if(b.right!=b.left||b.top!=b.bottom)c=a.GetCell(k,j,true);else u=false;var v=false;if(u){if(h==null&&c!=null)h=c.HtmlCell;if(h!=null){var o=false,q=true;if((q=$$.utils.contains(this.Spread,h))&&h!=this.Spread.getAnchorCell()){o=!a.SetAnchorCell(h,true);v=!o}else if(!q&&c!=null&&(c.Row!=e.getXmlActiveRow()||c.Column!=e.getXmlActiveCol()))o=!a.SetAnchorCell(c,true);else!q&&c==null&&a.SetAnchorCell(null);if(o)return}else a.SetAnchorCell(null)}if(v&&c!=null&&a.CanExtendSelect()){if(m&&c.HtmlCell.colSpan>1){e.select(null,null,{SelectStartColumn:Math.min(b.left,c.Column),SelectEndColumn:Math.max(b.right,c.Column+c.HtmlCell.colSpan-1)});e.syncColSelection()}else if(n&&c.HtmlCell.rowSpan>1){var t=Math.min(b.top,c.Row);t=a._GetRow(t).ViewIndex;var i=Math.max(b.bottom,c.Row+c.HtmlCell.rowSpan-1),x=i>a.RowCount-1?i-a.RowCount+1:0;if(x>0)i=a._GetRow(Math.min(i,a.RowCount-1)).ViewIndex+x;else i=a._GetRow(i).ViewIndex;e.select(null,null,{SelectStartRow:t,SelectEndRow:i})}if(this.ResizeLocation!=null)this.ResizeLocation=null}var r="";if(m)r="c";else if(n)r="r";e.setSelectType(r);this.selectAbove=this.handleIndex==0?true:false;this.currentAction=1;if(b!=null){this.selectArgs.SelectStartColumn=b.left;this.selectArgs.SelectEndColumn=b.right;this.selectArgs.SelectStartRow=b.top;this.selectArgs.SelectEndRow=b.bottom}}this.currentAction!=0&&!this.Spread.isEditing()&&document.activeElement!=e.getTextBox()&&e.setTextBoxFocus()}};e.prototype.ContinueSelecting=function(o){var b=this.SpreadView;if(this.Spread==null||!this.Spread.initialized||b.IsRowLayoutMode&&b.OperationMode!=2&&b.OperationMode!=3)return;var h=b.GetSpreadContext(),g=o.target,J=h.getViewport().parentNode,u=null;if((u=h.getSpreadControl(g,true))!=null&&u!=this.Spread&&$$.utils.contains(this.Spread,u))g=b._FindParentCell(u,this.Spread);if(b.OperationMode!=2&&b.OperationMode!=3&&!b.CanSelectMultiRange())return;this.HideTouchHandles();var a=b.SelectionModel._GetFocusRange(true),y=a.left==-1&&a.top>-1,t=a.top==-1&&a.left>-1,w=d.GetGesturePointFromEvent(o),r=h.isNeedScroll(w.x,w.y);if(this.handleIndex==0&&a.top>=0&&a.top<b.FrozenRowCount)r.Vertical=false;(r.Horizontal||r.Vertical)&&h.scrollByMovingForTouch(o.target,w.x,w.y,r.Horizontal,r.Vertical);if(b.IsViewportCell(g)||b.IsInsideViewport(g)||this.handleIndex>-1&&(t||y)||this.currentAction==3&&(b.RowHeader.Contains(g)||b.ColumnHeader.Contains(g))||h.getChartObj(g)!=null){var q=null,j=this.Spread.getAnchorCell();if(j!=null&&(t||y))if(j.rowSpan==1&&j.colSpan==1){var E=b._GetRowIndex(j),D=b._GetColumnIndex(j);q=new GCWS.CellRange(E,D,1,1)}else q=b.GetActiveSpanCellRange(j);var i=-1,l=-1,m=-1,k=-1;if(t){var e=b._GetColumnIndex(o,false,true);if(e==null||e==-1||e==a.left&&e==a.right)return;this.SetResizeLocation(null);if(this.handleIndex>-1)if(e<a.left){if(this.handleIndex==1)this.handleIndex=0;i=e;l=a.right}else if(e>a.right){if(this.handleIndex==0)this.handleIndex=1;i=a.left;l=e}else{if(this.handleIndex==0&&e==a.left||this.handleIndex==1&&e==a.right)return;i=this.handleIndex==0?e:a.left;l=this.handleIndex==0?a.right:e}else{if(e<a.left&&this.selectStartColumn!=a.right)this.selectStartColumn=a.right;else if(e>a.right&&this.selectStartColumn!=a.left)this.selectStartColumn=a.left;if(e<a.left&&this.selectStartColumn==-1)this.selectStartColumn=a.right;else if(e>a.right&&this.selectStartColumn==-1)this.selectStartColumn=a.left;else if(this.selectStartColumn==-1)return;i=e>this.selectStartColumn?this.selectStartColumn:e;l=e>this.selectStartColumn?e:this.selectStartColumn}if(this.selectArgs.SelectStartColumn!=i||this.selectArgs.SelectEndColumn!=l){var p=null;if(q!=null&&!q.IsIntersectWith(-1,i,-1,l-i+1)){p=b._FindColumnActiveCell(i,l-i+1,-1);if(p!=null)b.SetAnchorCell(p,true);else return}this.selectArgs.SelectStartColumn=i;this.selectArgs.SelectEndColumn=l}else return}else if(y){var c=-1,v;if((v=b.GetPreviewRow(g))!=null||b.IsUnSelectableCell(g)&&!b.ColumnHeader.Contains(g))c=b._GetRowIndexFromNonSelectableRow(v||g.parentNode);else c=b._GetRowIndex(o,false,false,true);if(b.IsRowLayoutMode)c-=c%b.LayoutRowCount;if(this.handleIndex<0){var x=$$.utils.GetCell(g);if(x!=null&&x.rowSpan>1){var C=parseInt(x.getAttribute("scol"));if(!isNaN(C))c=b.RowHeader._GetMostTopRowIndex(c,C)}}if(c==null||c==-1||c==a.top&&c==a.bottom)return;this.SetResizeLocation(null);var f;if(this.handleIndex>-1)if(c<a.top){if(this.handleIndex==1)this.handleIndex=0;f=this.GetRowRangeIndexs(b,c,a.bottom);m=f.StartRowViewIndex;k=f.EndRowViewIndex;if(k<0)return}else if(c>a.bottom){if(this.handleIndex==0)this.handleIndex=1;f=this.GetRowRangeIndexs(b,a.top,c);m=f.StartRowViewIndex;k=f.EndRowViewIndex}else{f=this.GetRowRangeIndexs(b,this.handleIndex==0?c:a.top,this.handleIndex==0?a.bottom:c);m=f.StartRowViewIndex;k=f.EndRowViewIndex;if(k<0)return}else if(b.OperationMode==2||b.OperationMode==3){this.selectStartRow=c;this.Spread.ClearSelection(false,null,false);h.selectRow(b._GetRow(c).ViewIndex,1,true,false,true);return}else{if(b.CanExtendSelect())if(c<a.top&&this.selectStartRow!=a.bottom)this.selectStartRow=a.bottom;else if(c>a.bottom&&this.selectStartRow!=a.top)this.selectStartRow=a.top;if(c<a.top&&this.selectStartRow==-1)this.selectStartRow=a.top;else if(c>a.bottom&&this.selectStartRow==-1)this.selectStartRow=a.bottom;else if(this.selectStartRow==-1)return;f=this.GetRowRangeIndexs(b,c>this.selectStartRow?this.selectStartRow:c,c>this.selectStartRow?c:this.selectStartRow);m=f.StartRowViewIndex;k=f.EndRowViewIndex;if(k<0)return}if(this.selectArgs.SelectStartRow!=m||this.selectArgs.SelectEndRow!=k){var p=null;if(f.EndRowModelIndex<0)f.EndRowModelIndex=b.RowCount-1;if(q!=null&&!q.IsIntersectWith(f.StartRowModelIndex,-1,f.EndRowModelIndex-f.StartRowModelIndex+1,-1)){p=b._FindRowActiveCell(f.StartRowModelIndex,f.EndRowModelIndex-f.StartRowModelIndex+1);if(p!=null)b.SetAnchorCell(p,true);else return}this.selectArgs.SelectStartRow=m;this.selectArgs.SelectEndRow=k}else return}else{var n=g,v,j=this.Spread.getAnchorCell();if(!$$.utils.contains(document.body,j))j=null;var s=j!=null?b._GetColumnIndex(j):h.getColByKey(h.getXmlActiveCol());if((v=b.GetPreviewRow(g))!=null||b.IsUnSelectableCell(g)){var A=b._GetRowIndexFromNonSelectableRow(v||g.parentNode),F=b._GetColumnIndex(o);n=F<s?b._GetHtmlCell(A,a.left,true):b._GetHtmlCell(A,a.right,true)}else n=$$.utils.GetCell(g);if(n==null){var I=b._GetRowIndex(o,false,false,true),H=b._GetColumnIndex(o,false,true);n=b._GetHtmlCell(I,H,true);if(n==null)return}var c=h.getRowFromCell(n),e=h.getColFromCell(n),z=b._GetRowIndexByViewIndex(c);if(this.handleIndex==0&&(e>a.right||s>=0&&e>s))this.handleIndex=1;if(this.handleIndex==1&&(e<a.left||s>=0&&e<s))this.handleIndex=0;if(this.selectAbove&&z>a.bottom)this.selectAbove=false;if(!this.selectAbove&&z<a.top)this.selectAbove=true;if(this.handleIndex==0)if(this.selectAbove)this.selectPinCell=b.GetCell(a.bottom,a.right,true);else this.selectPinCell=b.GetCell(a.top,a.right,true);else if(this.selectAbove)this.selectPinCell=b.GetCell(a.bottom,a.left,true);else this.selectPinCell=b.GetCell(a.top,a.left,true);if(this.selectPinCell.HtmlCell==n&&a.right==a.left&&a.top==a.bottom)return;var B=b._GetRow(this.selectPinCell.Row).ViewIndex;m=Math.min(c,B);k=Math.max(c,B);i=Math.min(e,this.selectPinCell.Column);l=Math.max(e,this.selectPinCell.Column);if(this.selectArgs.SelectStartRow!=m||this.selectArgs.SelectEndRow!=k||this.selectArgs.SelectStartColumn!=i||this.selectArgs.SelectEndColumn!=l){this.selectArgs.SelectStartRow=m;this.selectArgs.SelectEndRow=k;this.selectArgs.SelectStartColumn=i;this.selectArgs.SelectEndColumn=l}else return}this.SetResizeLocation(null);h.select(null,null,this.selectArgs);h.syncColSelection();if(!b.IsRowLayoutMode&&t&&b.AllowColumnMove){j=this.Spread.getAnchorCell();if(j){var G=h.getColFromCell(j);!h.isColSelected(G)&&this.UpdateAnchorCell(false)}}}};e.prototype.StopProcessing=function(){if(this.lastPointerMoveEvent!=null){this.ContinueSelecting(this.lastPointerMoveEvent);this.StopSelecting(this.lastPointerMoveEvent)}};e.prototype.GetValidBottomRow=function(b,c){var a={},d=b._GetRow(c);if(d!=null){a.ModelIndex=d.FlattenIndex;a.ViewIndex=d.ViewIndex}else{var e=c>b.RowCount-1?c-b.RowCount+1:0;if(e>0){a.ModelIndex=-1;a.ViewIndex=b._GetRow(b.RowCount-1).ViewIndex+e}else a.ModelIndex=a.ViewIndex=-1}return a};e.prototype.GetRowRangeIndexs=function(d,e,f){var a={StartRowModelIndex:-1,EndRowModelIndex:-1,StartRowViewIndex:-1,EndRowViewIndex:-1},b=d._GetRow(e);if(b!=null){a.StartRowModelIndex=b.FlattenIndex;a.StartRowViewIndex=b.ViewIndex}var c=this.GetValidBottomRow(d,f);a.EndRowModelIndex=c.ModelIndex;a.EndRowViewIndex=c.ViewIndex;return a};e.prototype.UpdateAnchorCell=function(c,d){var a=this.SpreadView,e=a.GetSpreadContext(),b=d||a._GetActiveCellRange();b!=null&&a.CorrectAnchorCell(b,c)};e.prototype.StopSelecting=function(c){if(this.Spread==null||!this.Spread.initialized)return;var a=this.SpreadView,b=a._GetActiveCellRange(true);if(b!=null){var e=b.Row==-1&&b.Column>-1,d=b.Column==-1&&b.Row>-1;if(!a.IsRowLayoutMode&&(a.OperationMode!=2&&a.OperationMode!=3||!d)){this.UpdateAnchorCell(false,b);a.CorrectSelection()&&a.GetSpreadContext().paintSelections(true,true)}}this.currentAction=0;this.selectStartColumn=-1;this.selectStartRow=-1;this.selectArgs=null;this.selectPinCell=null;if($$.browser.mb){a.GetSpreadContext().onStopSelecting(c);this.UpdateResizeLocation();this.ShowTouchHandles()}else{this.UpdateResizeLocation();this.ShowTouchHandles();a.GetSpreadContext().onStopSelecting(c)}};e.prototype.StartResizing=function(e){var a=this.SpreadView;if(window.fpPostOn==null&&a.TryStopEditing(false,false,true)){this.currentAction=2;var d=false,c=a.GetSpreadContext();if(this.resizeLocation.Row==-1){var f;if(this.handleIndex==this.RESIZE_COLUMN_HANDLE){if(this.resizeLocation.Column<a.FrozenColumnCount||a.FrozenColumnCount==0)f=c.getColGroup(a.ColumnHeaders[0]).childNodes[this.resizeLocation.Column];else f=c.getColGroup(a.ColumnHeaders[1]).childNodes[this.resizeLocation.Column-a.FrozenColumnCount];d=c.onStartResizing(f,false,e)}else{var b;if(this.resizeLocation.Column<a.FrozenColumnCount||a.FrozenColumnCount==0)b=a.ColumnHeaders[0];else b=a.ColumnHeaders[1];d=c.onStartResizing(b.rows[this.resizeLocation.Index],true,e)}}else{var b;if(this.resizeLocation.Row<a.FrozenRowCount&&this.handleIndex==this.RESIZE_ROW_HANDLE||a.FrozenRowCount==0)b=a.RowHeaders[0];else b=a.RowHeaders[1];if(this.handleIndex==this.RESIZE_COLUMN_HANDLE)d=c.onStartResizing(a.GetSpreadContext().getColGroup(b).childNodes[this.resizeLocation.Index],false,e);else{var g=a.Rows[this.resizeLocation.Row].HtmlRow.rowIndex;d=c.onStartResizing(b.rows[g],true,e)}}if(!d){this.currentAction=0;this.handleIndex=-1;this.handleGesture!=null&&this.handleGesture.stop();$$.browser.mb&&this.handleEventMan&&this.handleEventMan.StopTrackingGesture();return}}};e.prototype.ContinueResizing=function(a){this.SpreadView.GetSpreadContext().onContinueResizing(a);this.ShowHandles(true,false)};e.prototype.StopResizing=function(a){this.currentAction=0;this.SpreadView.GetSpreadContext().onStopResizing(a);this.ShowHandles(true,false)};e.prototype.StartColumnMoving=function(c){if(this.currentAction==0){var b=this.SpreadView,a=this.SpreadView.GetSpreadContext();if(window.fpPostOn==null&&a.onStartColumnMoving(c)&&this.SpreadView.TryStopEditing(false,false,true)){a.inactiveAllChart(b.Spread);this.HideTouchHandles();this.currentAction=4;return true}}return false};e.prototype.ContinueColumnMoving=function(a){if(this.currentAction==4)this.SpreadView.GetSpreadContext().onContinueColumnMoving(a)};e.prototype.StopColumnMoving=function(a){if(this.currentAction==4){this.SpreadView.GetSpreadContext().onStopColumnMoving(a);this.currentAction=0;this.Spread!=null&&this.ShowHandles(true,true)}};e.prototype.OnAfterSpreadScroll=function(e){var a=this.SpreadView,c=$$.utils.isNativeControl(document.activeElement);if(this.IsInTouchMode&&(a.IsRetainSelection()||a.IsSpreadActive(true))){var d=false;if(c){var b=this.SpreadContext.getViewportHolder();d=b!=null&&(b.scrollLeft!=0||b.scrollTop!=0)}if(!d)if(!$$.browser.isTouchEventModel)a.ShowFocusRectangle(true);else if(a.Parent==null&&this.scrollingView==null){this.scrollingView=e;if(this.syncScrollTimer!=null){this.syncScrollTimer.Stop();this.syncScrollTimer=null}}}c&&$$.utils.contains(this.Spread.getAnchorCell(),document.activeElement)&&setTimeout(Function.CreateDelegate(this,function(){if(this.Spread==null)return;var c=this.Spread.getAnchorCell();if(!a._IsCellHidden(c,true)){var b=document.activeElement;if($$.utils.isNativeControl(b)&&$$.utils.contains(c,b)){var d=a.GetSpreadContext().getEditor(c);if((d==b||$$.utils.contains(d,b))&&b.blur&&b.focus&&this.Spread.fpSpreadJS.isOutOfView(c)){b.blur();b.focus()}}}}),0)};e.prototype.IsScrollSyncrhonized=function(b){var c=false;if(b){var f=this.SpreadView,a=this.SpreadView.GetSpreadContext(),e=[a.getRowHeader(),a.getViewport2(),a.getViewport()],d=[a.getColHeader(),a.getViewport1(),a.getViewport()];$$.j.each(e,function(d,a){if(a&&a.parentElement!=b&&a.parentElement.scrollTop!=b.scrollTop){c=true;return false}});!c&&$$.j.each(d,function(d,a){if(a&&a.parentElement!=b&&a.parentElement.scrollLeft!=b.scrollLeft){c=true;return false}})}return!c};e.prototype.OnSpreadDeactivated=function(){this.gesture!=null&&this.StopTrackingGesture();this.handleGesture!=null&&this.handleGesture.stop();$$.browser.mb&&this.handleEventMan&&this.handleEventMan.StopTrackingGesture();this.lastPointerDownEvent=null};e.prototype.Attach=function(b,c){var a;if(this.Spread==null&&(a=b.getSpreadView())!=null){f.prototype.Attach.call(this,b,null);a.Touch=this;this.touchInfo=this.ConvertTouchInfo(c);this.Initialize()}};e.prototype.ConvertTouchInfo=function(a){if(a!=null)switch(a.PanningMode){case"VerticalOnly":a.PanningMode=2;break;case"HorizontalOnly":a.PanningMode=1;break;case"None":a.PanningMode=0;break;case"Both":a.PanningMode=3}return a};e.prototype.DetachTouchHandlesEvents=function(){if($$.browser.mb){if(this.handleEventMan){this.handleEventMan.StopTrackingGesture();this.DetachHandlers(this.attachedTouchHandlesHandlers,this.touchHandles,this.handleEventMan)}}else{this.handleGesture!=null&&this.handleGesture.stop();this.DetachHandlers(this.attachedTouchHandlesHandlers,this.touchHandles)}this.attachedTouchHandlesHandlers=null};e.prototype.DetachFocusRectangleEvents=function(){if(this.Spread!=null){var b=this.SpreadView,a=b._GetFocusRectangle(true,true);if($$.browser.mb)this.DetachHandlers(this.attachedTouchHandlesHandlers,this.touchHandles,this.eventMan);else this.DetachHandlers(this.attachedFocusRectangleHandlers,a);this.attachedFocusRectangleHandlers=null}};e.prototype.OnErrorMessagePointerDown=function(a){if($$.utils.isTouchEvent(a)){this.CancelTouchDefaultBehaviors(a,true);this.IsInTouchMode=true}else this.IsInTouchMode=false};e.prototype.OnErrorMessagePointerUp=function(b){if($$.utils.isTouchEvent(b)){this.CancelTouchDefaultBehaviors(b);var a=this.SpreadView.GetEditingSpread().getSpreadView();if(a.TryStopEditing(false,false,false)){if(a.EditModePermanent)a.ProcessEditModePermanent();else if(!$$.utils.contains(a.GetTopSpreadView().Spread,document.activeElement))a.NeedSetEditorFocusOnActiveCell()&&a.Touch.CorrectFocusOnActiveCell(true)}else a.NeedSetEditorFocusOnActiveCell()&&a.Touch.CorrectFocusOnActiveCell()}};e.prototype.AttachErrorMessage=function(b){var d=b&&b.contentWindow?b.contentWindow.document:b;if(d){var a=[];if($$.browser.mb){a.push({Name:c.POINTER_DOWN,Handler:Function.CreateDelegate(this,this.OnErrorMessagePointerDown)});a.push({Name:c.POINTER_UP,Handler:Function.CreateDelegate(this,this.OnErrorMessagePointerUp)})}else{a.push({Name:"MSPointerDown",Handler:Function.CreateDelegate(this,this.OnErrorMessagePointerDown)});a.push({Name:"MSPointerUp",Handler:Function.CreateDelegate(this,this.OnErrorMessagePointerUp)})}this.attachedErrorMessageHandlers=a;if($$.browser.mb)this.AttachHandlers(a,d,this.eventMan);else this.AttachHandlers(a,d)}};e.prototype.DetachErrorMessage=function(a){var b=a&&a.contentWindow?a.contentWindow.document:a;if(b){if($$.browser.mb)this.DetachHandlers(this.attachedErrorMessageHandlers,b,this.eventMan);else this.DetachHandlers(this.attachedErrorMessageHandlers,b);this.attachedErrorMessageHandlers=null}};e.prototype.DetachHandlers=function(c,b,e){if(c==null||b==null)return;if(b.length==null)b=[b];for(var d=0;d<b.length;d++)for(var f=b[d],a=0;a<c.length;a++)if(e)e.Detach(f,c[a].Name,c[a].Handler,false);else f.removeEventListener(c[a].Name,c[a].Handler,false)};e.prototype.AttachHandlers=function(c,b,e){if(c==null||b==null)return;if(b.length==null)b=[b];for(var d=0;d<b.length;d++)for(var f=b[d],a=0;a<c.length;a++)if(e)e.Attach(f,c[a].Name,c[a].Handler,false);else f.addEventListener(c[a].Name,c[a].Handler,false)};e.prototype.Dispose=function(d){if(this.Spread!=null){var e=this.SpreadView;$$.browser.mb&&this.StopTrackingGesture();this.HideTouchHandles();this.SetTouchEvents(false);this.DetachTouchHandlesEvents();this.DetachFocusRectangleEvents();this.DetachErrorMessage(e._GetErrorMessageHolder());this.touchHandles=null;e.Touch=null;this.touchInfo=null;this.SetResizeLocation(null);if(d||d==null)for(var g=[0,3,1,2],c=0;c<g.length;c++){var a=this.GetTouchStrip(g[c],true);a!=null&&a.HtmlContainer!=null&&a.HtmlContainer.parentNode&&a.HtmlContainer.parentNode.removeChild(a.HtmlContainer)}if($$.browser.mb){this.eventMan.Dispose();this.handleEventMan&&this.handleEventMan.Dispose()}this.invalidateLayoutCallback!=null&&b.Timers.Timer.GetSystemTimer().RemoveElapsedHandler(this.invalidateLayoutCallback);if(this.syncScrollTimer){this.syncScrollTimer.Stop();this.syncScrollTimer=null}f.prototype.Detach.call(this)}};e.prototype.ShowTouchHandles=function(b,a){if(this.currentAction==1||this.currentAction==3)return;this.ShowHandles(b,a)};e.prototype.HideTouchHandles=function(a){this.HideHandles(a)};e.prototype.GetTouchStrip=function(c,d){var e=c,a=document.getElementById(this.Spread.id+"_TouchStrip_"+e.toString(10));if(a==null)return null;var b=a.__obj__;if(!a.__obj__){b=new j(a,d);b.Area=c;b.Spread=this.Spread;a.__obj__=b}return b};e.prototype.ShowTouchStrip=function(c,l,m,j,k){var d=this.SpreadView,h=d.GetSpreadContext().getChartObj(c);if(this.isOnTheFlyCreatedSelection&&!k||h==null&&!d.TryStopEditing(true,false,true))return false;if(this.showTouchStripTimeoutId!=null){clearTimeout(this.showTouchStripTimeoutId);this.showTouchStripTimeoutId=null}var b=e.ActiveTouchStrip;b!=null&&this.IsTouchStripOpened&&b.Hide();if(d.IsMultiColumnComboBox)return false;var a;if(h&&this.Spread.GetActiveChartObj()==h)a=3;else{var i=d.SelectionModel;if(i.ContainsSheetSelectionOnly())if(d.ColumnHeader.Contains(c))a=1;else if(d.RowHeader.Contains(c))a=2;else a=0;else if(i.ContainsColumnSelectionOnly())a=1;else if(i.ContainsRowSelectionOnly())a=2;else a=0;if(j!=null&&j!=a&&a!=3)return false}b=this.GetTouchStrip(a);if(a==3&&(c.tagName=="AREA"||c.tagName=="MAP"))c=h.container;var f=d._TranslateToSpread(c,l,m),n=f.x,o=f.y,g=this.FireTouchStripOpening(a,b,c,n,o);if(b!=null&&!g.Handled){if(b.HTMLElement){f=b.AdjustDisplayPosition(this.Spread,g.X,g.Y,0,0);this.showTouchStripTimeoutId=setTimeout(Function.CreateDelegate(this,function(){this.showTouchStripTimeoutId=null;if(this.Spread==null)return;e.ActiveTouchStrip=b;b.Show(f.X,f.Y,this.Spread,a)}),this.TOUCH_STRIP_SHOW_TIME)}return true}return g.Handled};e.prototype.HideTouchStrip=function(){this.showTouchStripTimeoutId!=null&&clearTimeout(this.showTouchStripTimeoutId);var b=e.ActiveTouchStrip;if(b!=null){b.Hide();e.ActiveTouchStrip=null;if(this.lastPointerDownEvent!=null){var a=this.Spread.GetActiveChartObj();a&&this.SpreadView.GetSpreadContext().getChartObj(this.lastPointerDownEvent.target)==a&&setTimeout(function(){a.Focus()},0)}}};e.Register=function(a,b){if(a.getSpreadView().Touch==null){var c=new e;c.Attach(a,b)}return a.Touch};e.prototype.CreateTouchStripEvent=function(d,c,b){var a=document.createEvent("UIEvent");a.initUIEvent(d,false,true,window,1);a.TOUCHSTRIP_CELL=0;a.TOUCHSTRIP_COLUMN=1;a.TOUCHSTRIP_ROW=2;a.TOUCHSTRIP_CHART=3;a.Spread=this.Spread;a.Area=c;a.TouchStrip=b;return a};e.prototype.FireTouchStripOpening=function(e,b,g,c,d){var a=this.CreateTouchStripEvent("TouchStripOpening",e,b,this.Spread),f=this.SpreadView;a.Handled=false;a.X=c;a.Y=d;this.Spread.dispatchEvent(a);return a};e.prototype.FireTouchStripOpened=function(a){var b=this.CreateTouchStripEvent("TouchStripOpened",a.Area,a,this.Spread);this.Spread.dispatchEvent(b)};e.prototype.FireTouchStripClosed=function(a){var b=this.CreateTouchStripEvent("TouchStripClosed",a.Area,a,this.Spread);this.Spread.dispatchEvent(b)};e.activeTouchStrip=null;return e}(l);e.TouchController=f;var d=function(){function a(){}a.CalculateSquaredDistance=function(b,c){var d,e;try{if(b.target&&c.target){b=a.GetGesturePointFromEvent(b);c=a.GetGesturePointFromEvent(c);d=b.x-c.x;e=b.y-c.y}else{d=b.x-c.x;e=b.y-c.y}}catch(f){}return d*d+e*e};a.GetTouchObjectFromEvent=function(i,d,g){var b=i,c=null;if($$.browser.isTouchEventModel)c=b.targetTouches&&b.targetTouches.length>0?b.targetTouches:b.changedTouches;var a=null;if(c&&c.length>0){a=c[0];if(a.offsetX==undefined){var h=a.target||b.target,f=h.getBoundingClientRect();a.offsetX=a.clientX-f.left;a.offsetY=a.clientY-f.top}}else if(d==undefined||d==true)a=b;if(g){var e={target:b.target,identifier:a.identifier},j=["clientX","clientY","offsetX","offsetY","pageX","pageY","screenX","screenY"];j.forEach(function(b){e[b]=a[b]});a=e}return a};a.FixPositionProperties=function(b,g){if(b.fixedPositionProperties)return;var e=g||a.GetTouchObjectFromEvent(b);if(e){for(var d=["clientX","clientY","offsetX","offsetY","pageX","pageY","screenX","screenY"],c=0;c<d.length;c++){var f=d[c];try{b[f]=e[f]}catch(h){}}b.fixedPositionProperties=true}};a.GetGesturePointFromEvent=function(a){if(a==null)return null;var b={x:0,y:0};if(typeof a.clientX!="undefined"){b.x=a.clientX;b.y=a.clientY}else{var c=a.targetTouches&&a.targetTouches.length>0?a.targetTouches:a.changedTouches;if(c&&c.length>0){b.x=c[0].clientX;b.y=c[0].clientY}}return b};a.CreateMouseEvent=function(a,d,c){var b=document.createEvent("MouseEvents");b.initMouseEvent(d,true,true,window,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget);if($$.browser.ieversion==10){b.MSPOINTER_TYPE_TOUCH=a.MSPOINTER_TYPE_TOUCH;b.pointerType=c?b.MSPOINTER_TYPE_TOUCH:a.pointerType}else if(window.navigator.pointerEnabled)b.pointerType=c?"touch":a.pointerType;else b.originalEvent=a;return b};a.CreateFakeEvent=function(a){var b={};for(var c in a)try{b[c]=a[c]}catch(d){}return b};return a}();e.TouchUtil=d;var c=function(){function a(){this.GESTURE_DISTANCE_THRESHOLD=10*10;this.DOUBLE_TAP_TIME=500;this.DOUBLE_TAP_THRESHOLD=10*10;this.fireDoubleTap=false;this.startedTrackingGesture=false;this.eventHandler=new e.EventHandlers}Object.defineProperty(a.prototype,"IsTrackingGesture",{"get":function(){return this.startedTrackingGesture},"set":function(a){this.startedTrackingGesture=a},enumerable:true,configurable:true});a.Create=function(){return $$.browser.isTouchEventModel?new h:new k};a.prototype.Attach=function(d,a,b,c){if(a==null||a.length==0)return;$$.utils.attachEvent(d,a,b,c)};a.prototype.Detach=function(d,a,b,c){if(a==null||a.length==0)return;$$.utils.detachEvent(d,a,b,c)};a.prototype.GetEventName=function(a){return a.toString()};a.prototype.StartTrackingGesture=function(b,c){this.OnTouchStart(b);this.eventHandler.Attach(new e.EventHandler("targetTouchMove",this.GetEventName(a.POINTER_MOVE),window.document,Function.CreateDelegate(this,this.OnTouchMove),true));this.eventHandler.Attach(new e.EventHandler("targetTouchEnd",this.GetEventName(a.POINTER_UP),window.document,Function.CreateDelegate(this,this.OnTouchEnd),true));if(!this.startedTrackingGesture&&!c){this.eventHandler.Attach(new e.EventHandler("targetGestureTap",this.GetEventName(a.GESTURE_TAP),b.target,Function.CreateDelegate(this,this.OnGestureTap),true));this.startedTrackingGesture=true}};a.prototype.StopTrackingGesture=function(){this.eventHandler.RemoveAll();this.startedTrackingGesture=false};a.prototype.OnTouchStart=function(a){if($$.utils.isTouchEvent(a)){this.initialTouchTime=new Date(a.timeStamp);this.initialTouchPos=d.GetGesturePointFromEvent(a);this.lastTouchStartEvent=a;this.fireDoubleTap=false}};a.prototype.OnTouchMove=function(){};a.prototype.OnTouchEnd=function(){if(this.fireDoubleTap){this.FireGestureEvent(this.lastGestureTap,a.GESTURE_DOUBLE_TAP,true,true);this.fireDoubleTap=false}};a.prototype.OnGestureTap=function(a){var e=a.touchTimeStamp||a.timeStamp;if(this.lastGestureTapTime>0&&e-this.lastGestureTapTime<this.DOUBLE_TAP_TIME&&d.CalculateSquaredDistance(this.lastGestureTapPos,d.GetGesturePointFromEvent(a))<this.DOUBLE_TAP_THRESHOLD){var b=this.lastGestureTap&&a.target==this.lastGestureTap.target;if(!b){var c=this.lastGestureTap.target.getBoundingClientRect();b=c.left==this.lastGestureTapTargetPos.left&&c.top==this.lastGestureTapTargetPos.top}if(b)this.fireDoubleTap=true}else{this.fireDoubleTap=false;this.lastGestureTapTime=e;this.lastGestureTapPos=d.GetGesturePointFromEvent(a);this.lastGestureTap=a;this.lastGestureTapTargetPos=a.target.getBoundingClientRect()}};a.prototype.FireGestureEvent=function(c,e,d,b,f){if(typeof d=="undefined")d=true;if(typeof b=="undefined")b=true;var a=$$.utils.createEvent(e,d,b,f);this.BuildEventArg(c,a);a.touchTimeStamp=c.timeStamp;c.target.dispatchEvent(a);return a};a.prototype.Dispose=function(){};a.IsManipulatedEvent=function(b){return b==a.GESTURE_START||b==a.GESTURE_CHANGE||b==a.GESTURE_END||b==a.GESTURE_TAP||b==a.GESTURE_DOUBLE_TAP||b==a.GESTURE_HOLD||b==a.GESTURE_HOLD_VISUAL};a.prototype.BuildEventArg=function(c,a){var b=d.GetTouchObjectFromEvent(c);a.clientX=b.clientX;a.clientY=b.clientY;a.offsetX=b.offsetX;a.offsetY=b.offsetY;a.pageX=b.pageX;a.pageY=b.pageY;a.screenX=b.screenX;a.screenY=b.screenY;a.touches=c.touches;a.changedTouches=c.changedTouches;a.targetTouches=c.targetTouches};a.POINTER_DOWN="pointerdown";a.POINTER_MOVE="pointermove";a.POINTER_UP="pointerup";a.POINTER_CANCEL="pointercancel";a.GESTURE_HOLD="gcgesturehold";a.GESTURE_HOLD_VISUAL="gcholdvisual";a.GESTURE_START="gcgesturestart";a.GESTURE_CHANGE="gcgesturechange";a.GESTURE_END="gcgestureend";a.GESTURE_TAP="gcgesturetap";a.GESTURE_DOUBLE_TAP="gcgesturedoubletap";a.CONTEXT_MENU="gccontextmenu";return a}();e.EventManipulator=c;var k=function(b){__extends(a,b);function a(){b.call(this);if(typeof"MSGesture"!="undefined")this.msGesture=new MSGesture}a.prototype.Attach=function(e,f,a,d){if(f==null||f.length==0)return;var g=f.toLowerCase();switch(g){case c.GESTURE_HOLD:$$.utils.attachEvent(e,"MSGestureHold",a,d);break;case c.GESTURE_HOLD_VISUAL:$$.utils.attachEvent(e,"MSHoldVisual",a,d);break;case c.GESTURE_START:$$.utils.attachEvent(e,"MSGestureStart",a,d);break;case c.GESTURE_CHANGE:$$.utils.attachEvent(e,"MSGestureChange",a,d);break;case c.GESTURE_END:$$.utils.attachEvent(e,"MSGestureEnd",a,d);break;case c.GESTURE_TAP:$$.utils.attachEvent(e,"MSGestureTap",a,d);break;default:b.prototype.Attach.call(this,e,f,a,d)}};a.prototype.Detach=function(e,f,a,d){if(f==null||f.length==0)return;var g=f.toLowerCase();switch(g){case c.GESTURE_HOLD:$$.utils.detachEvent(e,"MSGestureHold",a,d);break;case c.GESTURE_HOLD_VISUAL:$$.utils.detachEvent(e,"MSHoldVisual",a,d);break;case c.GESTURE_START:$$.utils.detachEvent(e,"MSGestureStart",a,d);break;case c.GESTURE_CHANGE:$$.utils.detachEvent(e,"MSGestureChange",a,d);break;case c.GESTURE_END:$$.utils.detachEvent(e,"MSGestureEnd",a,d);break;case c.GESTURE_TAP:$$.utils.detachEvent(e,"MSGestureTap",a,d);break;default:b.prototype.Detach.call(this,e,f,a,d)}};a.prototype.GetEventName=function(a){switch(a){case c.POINTER_DOWN:return"pointerdown";case c.POINTER_MOVE:return"pointermove";case c.POINTER_UP:return"pointerup";case c.POINTER_CANCEL:return"pointercancel";case c.GESTURE_TAP:return"MSGestureTap"}return b.prototype.GetEventName.call(this,a)};a.prototype.StartTrackingGesture=function(a,c){if(c)return;if(this.msGesture!=null)this.msGesture.stop();else this.msGesture=new MSGesture;this.msGesture.target=a.target;this.msGesture.addPointer(a.pointerId);b.prototype.StartTrackingGesture.call(this,a)};a.prototype.StopTrackingGesture=function(){this.IsTrackingGesture&&this.msGesture&&this.msGesture.stop();b.prototype.StopTrackingGesture.call(this)};a.prototype.OnTouchStart=function(a){b.prototype.OnTouchStart.call(this,a)};a.prototype.OnTouchMove=function(a){b.prototype.OnTouchMove.call(this,a)};a.prototype.OnTouchEnd=function(a){b.prototype.OnTouchEnd.call(this,a)};return a}(c);e.PointerEventManipulator=k;var h=function(b){__extends(a,b);function a(){b.call(this);this.PRESS_AND_HOLD_NEXT_TIME=500;this.PRESS_AND_HOLD_TIME=1e3;this.pressAndHoldTime=this.PRESS_AND_HOLD_TIME;this.PREVENT_MOUSE_EVENTS_PERIOD=2e3;this.gestureStartFired=false;this.mouseHandlerList=[];this.evtList=[];this.handlerWrappers=[];this.touchEvenHandlers=new e.EventHandlers;a.AllMouseHandlerList.push(this.mouseHandlerList);this.touchEvenHandlers.Attach(new e.EventHandler("DocumentTouchStart","touchstart",document,Function.CreateDelegate(this,this.OnDocTouchStart),true))}a.prototype.Attach=function(i,a,f,h,k){if(a==null||a.length==0)return;var j=a.toLowerCase();switch(j){case c.POINTER_DOWN:case c.POINTER_MOVE:case c.POINTER_UP:case c.POINTER_CANCEL:case c.GESTURE_DOUBLE_TAP:var e=null;if(k==null||k==true){var g={eventName:a,target:i,eventHandler:f,useCapture:h,delegate:null},l=Function.CreateCallback(this.ProcessTouchEvent,g);e=Function.CreateDelegate(this,l);g.delegate=e;this.handlerWrappers.push(g)}else e=f;var d=j;switch(j){case c.POINTER_DOWN:d="touchstart";break;case c.POINTER_MOVE:d="touchmove";break;case c.POINTER_UP:d="touchend";break;case c.POINTER_CANCEL:d="touchcancel"}$$.utils.attachEvent(i,d,e,h);break;default:b.prototype.Attach.call(this,i,a,f,h)}};a.prototype.GetFirstFinger=function(a){var b=d.GetTouchObjectFromEvent(a,true,true);return{target:a.target,touchObject:b}};a.prototype.IsFirstFinger=function(b){if(a.firstFinger&&b.changedTouches)for(var d=a.firstFinger,f=d.target,c=0;c<b.changedTouches.length;c++){var e=b.changedTouches[c];if(e.identifier==d.touchObject.identifier)return true}return false};a.prototype.ProcessTouchEvent=function(){for(var i=this,f=[],g=0;g<arguments.length;g++)f[g-0]=arguments[g];var a=f[0],e=f[f.length-1],b=null;if(e.eventName==c.GESTURE_DOUBLE_TAP)b=a;else{d.FixPositionProperties(a);b=this.CreateTouchEventWrapper(a)}if(a.ignoreProcessEvent){e.eventHandler(b);return}if(e.eventName==c.POINTER_DOWN){this.canFireDoubleClick=this.lastPointerDown&&a.timeStamp-this.lastPointerDown.timeStamp<this.DOUBLE_TAP_TIME&&d.CalculateSquaredDistance(this.lastPointerDownPos,d.GetGesturePointFromEvent(a))<this.DOUBLE_TAP_THRESHOLD;this.lastPointerDown=b}else if(this.IsTrackingGesture)this.canFireDoubleClick=false;var h=this.lastPointerDown?this.lastPointerDown.target:null;if(h&&h.tagName=="SELECT")if(e.eventName!=c.POINTER_UP)this.evtList.push({event:a,event2:b,context:e});else{this.evtList.forEach(function(a){i.DoProcessTouchEvent(a.event,a.event2,a.context)});this.evtList=[];this.DoProcessTouchEvent(a,b,e)}else this.DoProcessTouchEvent(a,b,e)};a.prototype.DoProcessTouchEvent=function(e,h,g){var w=this;if(e.touches.length>1||g.eventName==c.POINTER_UP&&e.touches.length==1){if(a.firstFinger!=null){var s=a.firstFinger;a.firstFinger=null;var n=$$.utils.createEvent("touchcancel",true,true);n.ignoreProcessEvent=true;var z=g.eventName==c.POINTER_MOVE||g.eventName==c.POINTER_UP?d.GetTouchObjectFromEvent(e,true,true):s.touchObject;d.FixPositionProperties(n,z);s.target.dispatchEvent(n)}return}var b=e.target;if(g.eventName==c.POINTER_UP){(this.lastPointerDown&&this.lastPointerDown.isCancelDefault()||!$$.utils.isTextControl(b))&&e.preventDefault();var x=new Date(e.timeStamp),t=+x-+this.lastPointerDownTime<this.DOUBLE_TAP_TIME/2,u=d.CalculateSquaredDistance(this.lastPointerDownPos,d.GetGesturePointFromEvent(e));this.IsTap=u<=this.GESTURE_DISTANCE_THRESHOLD&&t}var f;if(g.eventName==c.POINTER_DOWN){f=d.CreateMouseEvent(e,"mousemove",true);b.dispatchEvent(f);f=d.CreateMouseEvent(e,"mouseover",true);b.dispatchEvent(f)}g.eventHandler(h);var k="";switch(g.eventName){case c.POINTER_DOWN:k="mousedown";this.lastPointerDown=h;this.lastPointerDownPos=d.GetGesturePointFromEvent(e);this.lastPointerDownTime=new Date(e.timeStamp);a.firstFinger=this.GetFirstFinger(h);this.IsTap=false;break;case c.POINTER_MOVE:k="mousemove";if(a.firstFinger&&this.IsFirstFinger(h))a.firstFinger.touchObject=d.GetTouchObjectFromEvent(h,true,true);break;case c.POINTER_UP:k="mouseup";if(a.firstFinger&&this.IsFirstFinger(h))a.firstFinger=null}if(this.lastPointerDown){var v=this.lastPointerDown.isCancelDefault(),m=$$.utils.isDisabled(b);if(g.eventName==c.POINTER_DOWN)if(h.isNeedSimulateMouseClick()){b.bkOnClick=b.getAttribute("onclick");b.removeAttribute("onclick")}if(!v&&k!=""&&!h.isCancelMouse()){var j=g.eventName==c.POINTER_DOWN?document.activeElement:null;f=d.CreateMouseEvent(e,k,true);if(g.eventName==c.POINTER_DOWN){var p=false,y=function(b,a){return function(){a.apply(b);p=true}}(f,f.preventDefault);f.preventDefault=y;b.dispatchEvent(f);if(!h.isCancelActivate()){if(document.activeElement==document.body)j=document.activeElement;if(!m&&!p&&document.activeElement==j&&j!=b){var i=b;while(i.focus&&document.activeElement==j){if(typeof i.__gcfocus=="function")i.__gcfocus();else i.focus();if(i.tagName=="BODY"||document.activeElement!=j||i==document.activeElement)break;i=i.parentNode}}}}else b.dispatchEvent(f)}if(g.eventName==c.POINTER_UP){if(b.bkOnClick){b.setAttribute("onclick",b.bkOnClick);b.bkOnClick=null}var x=new Date(e.timeStamp);if(this.IsTap){if(!m)if(b.click&&!this.lastPointerDown.isNeedSimulateMouseClick())b.click();else{f=d.CreateMouseEvent(e,"click",true);e.target.dispatchEvent(f)}if(!m&&this.canFireDoubleClick){var r=typeof b.ondblclick=="function"?b.ondblclick:null;if(r)r();else{f=d.CreateMouseEvent(e,"dblclick",true);e.target.dispatchEvent(f)}}}}if(g.eventName==c.POINTER_CANCEL||g.eventName==c.POINTER_UP){f=d.CreateMouseEvent(e,"mouseout",true);b.dispatchEvent(f)}}if(g.eventName==c.GESTURE_DOUBLE_TAP&&e.target.offsetParent==null||g.eventName==c.POINTER_UP){for(var l=["mouseover","mouseout","mousedown","mousemove","mouseup","click"],q=function(a){!$$.utils.isTouchEvent(a)&&$$.utils.cancelBubble(a,true)},o=0;o<l.length;o++)$$.utils.attachEvent(document,l[o],q,true);this.mouseHandlerList.push(q);setTimeout(function(){for(var b=w.mouseHandlerList.shift(),a=0;a<l.length;a++)$$.utils.detachEvent(document,l[a],b,true)},this.PREVENT_MOUSE_EVENTS_PERIOD)}};a.prototype.CreateTouchEventWrapper=function(b){var c={};for(var d in b)try{c[d]=b[d]}catch(e){}var a=c;if(a.clientX!=null)a.target=document.elementFromPoint(a.clientX,a.clientY)||document.body;a.originalEvent=b;a.preventDefault=function(a){this.__cancelDefault=true;(this.type!="touchstart"||a)&&this.originalEvent.preventDefault()};a.isCancelDefault=function(){return this.__cancelDefault===true};a.stopPropagation=function(){this.originalEvent.stopPropagation()};a.isCancelMouse=function(){return this.__cancelMouse===true};a.cancelMouse=function(){this.__cancelMouse=true};a.isCancelActivate=function(){return this.__cancelActivate===true};a.cancelActivate=function(){this.__cancelActivate=true};a.isNeedSimulateMouseClick=function(){return this.__simulateMouseClick===true};a.needSimulateMouseClick=function(){this.__simulateMouseClick=true};return a};a.prototype.Detach=function(i,a,j,h){if(a==null||a.length==0)return;var k=a.toLowerCase();switch(k){case c.POINTER_DOWN:case c.POINTER_MOVE:case c.POINTER_UP:case c.POINTER_CANCEL:case c.GESTURE_DOUBLE_TAP:for(var g=null,f=0;f<this.handlerWrappers.length;f++){var e=this.handlerWrappers[f];if(e.target==i&&e.eventName==a&&e.eventHandler==j&&e.useCapture==h){g=e;break}}if(g){var d=a;switch(a){case c.POINTER_DOWN:d="touchstart";break;case c.POINTER_MOVE:d="touchmove";break;case c.POINTER_UP:d="touchend";break;case c.POINTER_CANCEL:d="touchcancel"}$$.utils.detachEvent(i,d,g.delegate,h);this.handlerWrappers.splice(f,1)}break;default:b.prototype.Detach.call(this,i,a,j,h)}};a.prototype.GetEventName=function(a){switch(a){case c.POINTER_DOWN:return"touchstart";case c.POINTER_MOVE:return"touchmove";case c.POINTER_UP:return"touchend";case c.POINTER_CANCEL:return"touchcancel";case c.GESTURE_TAP:return"gcgesturetap"}return b.prototype.GetEventName.call(this,a)};a.prototype.OnDocTouchStart=function(k){var h=["mouseover","mouseout","mousedown","mousemove","mouseup","click"];if(a.AllMouseHandlerList.length>0)for(var g=0;g<a.AllMouseHandlerList.length;g++){var b=a.AllMouseHandlerList[g];if(b.length>0)for(var f=0;f<b.length;f++)for(var j=b[f],e=0;e<h.length;e++)$$.utils.detachEvent(document,h[e],j,true)}if(k.touches.length>1)if(a.firstFinger!=null){var i=a.firstFinger;a.firstFinger=null;var c=$$.utils.createEvent("touchcancel",true,true);c.ignoreProcessEvent=true;d.FixPositionProperties(c,i.touchObject);i.target.dispatchEvent(c)}};a.prototype.OnTouchStart=function(a){b.prototype.OnTouchStart.call(this,a);if($$.utils.isTouchEvent(a)&&a.touches.length==1)this.canFireGestureTap=true};a.prototype.OnTouchMove=function(a){b.prototype.OnTouchMove.call(this,a);if($$.utils.isTouchEvent(a)&&a.touches.length==1){d.FixPositionProperties(a);if(this.IsTrackingPressAndHold){var e=d.GetGesturePointFromEvent(a);d.CalculateSquaredDistance(this.initialTouchPos,e)>this.DOUBLE_TAP_THRESHOLD&&this.StopTrackingPressAndHold()}if(!this.IsTrackingPressAndHold&&this.IsTrackingGesture){var e=d.GetGesturePointFromEvent(a);if(!this.canFireGestureTap||!(this.canFireGestureTap=d.CalculateSquaredDistance(this.initialTouchPos,e)<=this.GESTURE_DISTANCE_THRESHOLD))if(!this.gestureStartFired){this.FireGestureEvent(a,c.GESTURE_START,true,true);this.gestureStartFired=true}else this.FireGestureEvent(a,c.GESTURE_CHANGE,true,true);else $$.utils.cancelDefault(a)}}};a.prototype.OnTouchEnd=function(a){if($$.utils.isTouchEvent(a)){d.FixPositionProperties(a);if(a.touches.length==0){var f=new Date(a.timeStamp),e=d.GetGesturePointFromEvent(a);if((this.IsTrackingPressAndHold||+f-+this.initialTouchTime<this.DOUBLE_TAP_TIME/2)&&d.CalculateSquaredDistance(this.initialTouchPos,e)<this.DOUBLE_TAP_THRESHOLD){this.StopTrackingPressAndHold();this.IsTrackingGesture&&this.FireGestureEvent(a,c.GESTURE_TAP,true,true)}}this.IsTrackingGesture&&this.FireGestureEvent(a,c.GESTURE_END,true,true);this.gestureStartFired=false}this.StopTrackingPressAndHold();b.prototype.OnTouchEnd.call(this,a)};a.prototype.StartTrackingGesture=function(c,a){b.prototype.StartTrackingGesture.call(this,c,a);this.StartTrackingPressAndHold(a)};a.prototype.StopTrackingGesture=function(){this.StopTrackingPressAndHold();b.prototype.StopTrackingGesture.call(this)};a.prototype.Dispose=function(){this.lastPointerDown=null;this.lastPointerDownPos=null;this.lastPointerDownTime=null;this.touchEvenHandlers.RemoveAll();b.prototype.Dispose.call(this)};a.prototype.StartTrackingPressAndHold=function(b){var c=this;if($$.browser.isTouchEventModel)if(!this.IsTrackingPressAndHold){var a=function(){c.ProcessPressAndHold(b)};this.pressAndHoldTimerId=setTimeout(a,this.pressAndHoldTime);this.pressAndHoldTime=this.PRESS_AND_HOLD_NEXT_TIME}};a.prototype.StopTrackingPressAndHold=function(){if(this.pressAndHoldTimerId!=null){clearTimeout(this.pressAndHoldTimerId);this.pressAndHoldTimerId=null}};Object.defineProperty(a.prototype,"IsTrackingPressAndHold",{"get":function(){return this.pressAndHoldTimerId!=null},enumerable:true,configurable:true});a.prototype.ProcessPressAndHold=function(a){this.StopTrackingPressAndHold();!a&&this.FireGestureEvent(this.lastTouchStartEvent,c.GESTURE_HOLD,true,true);this.FireGestureEvent(this.lastTouchStartEvent,c.GESTURE_HOLD_VISUAL,true,true);!a&&this.FireGestureEvent(this.lastTouchStartEvent,c.GESTURE_HOLD,true,true);this.FireGestureEvent(this.lastTouchStartEvent,c.CONTEXT_MENU,true,true)};a.clearMouseEventsTimerId=null;a.AllMouseHandlerList=[];return a}(c);e.TouchEventManipulator=h;var g=function(){function a(b,a){this.text=b;this.imageUrl=a}Object.defineProperty(a.prototype,"CommandName",{"get":function(){return this.commandName},"set":function(a){this.commandName=a},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"Text",{"get":function(){return this.text},"set":function(a){this.text=a},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"ToolTip",{"get":function(){return this.toolTip},"set":function(a){this.toolTip=a},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"ImageUrl",{"get":function(){return this.imageUrl},"set":function(a){this.imageUrl=a},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"CssClass",{"get":function(){return this.cssClass},"set":function(a){this.cssClass=a},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"Enabled",{"get":function(){return this.enabled==null||this.enabled},"set":function(c){if(c)this.enabled=null;else this.enabled=c;var b=this.HTMLElement;if(b!=null){var a=b.getElementsByTagName("A")[0];if(c){$$.utils.removeCssClass(b,"aspNetDisabled");$$.utils.removeCssClass(a,"aspNetDisabled");$$.utils.appendCssClass(a,"itemlink");b.setAttribute("onclick","this.Owner.OnItemClick(event)");a!=null&&a.removeAttribute("onclick");b.disabled=false}else{$$.utils.removeCssClass(a,"itemlink");$$.utils.appendCssClass(a,"aspNetDisabled");$$.utils.appendCssClass(b,"aspNetDisabled");b.removeAttribute("onclick");a!=null&&a.setAttribute("onclick","$$.utils.cancelDefault(event)");b.disabled=true}}},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"Items",{"get":function(){if(this.items==null)this.items=[];return this.items},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"OwnerItem",{"get":function(){return this.Owner.OwnerItem},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"Owner",{"get":function(){var a=this.HTMLElement;return a!=null?a.Owner:null},enumerable:true,configurable:true});a.prototype.GetHandlerIndex=function(b,c){for(var a=0;a<this.attachedHandlers.length;a++)if(this.attachedHandlers[a].n==b&&this.attachedHandlers[a].l==c)return a;return-1};a.prototype.AddEventListener=function(a,b){this.li!=null&&this.li.addEventListener(a,b);if(this.attachedHandlers==null)this.attachedHandlers=[];this.attachedHandlers.push({n:a,l:b})};a.prototype.RemoveEventListener=function(a,b){this.li!=null&&this.li.removeEventListener(a,b);if(this.attachedHandlers!=null){var c=this.GetHandlerIndex(a,b);c>=0&&this.attachedHandlers.splice(c,1)}};a.prototype.DetachEvents=function(){if(this.attachedHandlers!=null&&this.li!=null)for(var a=0;a<this.attachedHandlers.length;a++)this.li.removeEventListener(this.attachedHandlers[a].n,this.attachedHandlers[a].l)};a.prototype.AttachEvents=function(){if(this.attachedHandlers!=null&&this.li!=null)for(var a=0;a<this.attachedHandlers.length;a++)this.li.addEventListener(this.attachedHandlers[a].n,this.attachedHandlers[a].l)};Object.defineProperty(a.prototype,"HTMLElement",{"get":function(){return this.li},"set":function(a){if(a==null||a.tagName=="LI")this.li=a},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"IsSeparator",{"get":function(){return this.text=="-"},enumerable:true,configurable:true});a.prototype.GenerateHtmlElement=function(){var a=document.createElement("LI");a.setAttribute("autopostback","0");if(this.IsSeparator){a.className="sep";var d=document.createElement("SPAN");d.className="sep";a.appendChild(d)}else{this.Enabled&&a.setAttribute("item_link","1");var c=document.createElement("DIV");c.className="icon";var e=this.ImageUrl;if(e!=null&&e.length>0){c.style.backgroundImage="url('"+e+"')";c.style.backgroundRepeat="no-repeat";c.style.backgroundPosition="center center"}var b=document.createElement("A");b.className=(this.Owner==null?"TopItem":"ChildItem")+(this.Enabled?" itemlink noicon":" aspNetDisabled");b.href="#";b.title=this.ToolTip||"";var d=document.createElement("SPAN");d.textContent=this.text;b.appendChild(d);a.appendChild(c);a.appendChild(b);a.className="item"+(this.cssClass!=null&&this.cssClass.length>0?" "+this.cssClass:"")+(this.Enabled?"":" aspNetDisabled");if(this.Enabled){a.disabled=false;a.setAttribute("onclick","this.Owner.OnItemClick(event)")}else{a.disabled=true;b.setAttribute("onclick","$$.utils.cancelDefault(event)")}if(this.items!=null&&this.items.length>0){for(var g=new i,f=0;f<this.items.length;f++)g.Items.push(this.items[f]);a.appendChild(g.GenerateHtmlElement())}this.DetachEvents();this.li=a;this.AttachEvents()}return a};return a}();e.MenuItem=g;var m=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);this.DEFAULT_WIDTH=52}Object.defineProperty(a.prototype,"Width",{"get":function(){return this.width==null?this.DEFAULT_WIDTH:this.width},"set":function(a){if(a>0)this.width=a},enumerable:true,configurable:true});a.prototype.GenerateHtmlElement=function(){var c=b.prototype.GenerateHtmlElement.call(this),a=this.Width;if(a!=this.DEFAULT_WIDTH)c.style.width=a.toString(10)+"px";return c};return a}(g);e.TouchStripItem=m;var o=function(){function a(c){var b=c.prototype,e=a.prototype;for(var d in b)e[d]=b[d];this.baseClass=c}a.prototype.BaseConstructor=function(){this.baseClass.apply(this,arguments)};return a}();e.HybridClass=o;var i=function(b){__extends(a,b);function a(a,f,d,e,c){b.call(this,a,f,d,e,c);$$.browser.webkit&&this!=this.GetTopMenu()&&a&&$$(this.Holder).appendCssClass(a.getSpreadView().GenerateBrowserBaseCssClass("TouchStrip"))}Object.defineProperty(a.prototype,"Parent",{"get":function(){return this.Owner},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"OwnerItem",{"get":function(){var a=this.Parent;if(a!=null)for(var b=0,c=a.Items.length;b<c;b++)if(a.Items[b].HTMLElement.ChildMenu==this)return a.Items[b];return null},enumerable:true,configurable:true});Object.defineProperty(a.prototype,"Items",{"get":function(){if(this.items==null)this.items=[];return this.items},enumerable:true,configurable:true});a.prototype.GetMenuItemFromLiElement=function(a){return this.items[a.Index]};a.prototype.OnItemAttachEvents=function(){};a.prototype.OnItemDetachEvents=function(){};Object.defineProperty(a.prototype,"OverrideChildCommand",{"get":function(){return this.overrideChildCommand},"set":function(a){this.overrideChildCommand=a},enumerable:true,configurable:true});a.prototype.GetHandlerIndex=function(b,c){for(var a=0;a<this.attachedHandlers.length;a++)if(this.attachedHandlers[a].n==b&&this.attachedHandlers[a].l==c)return a;return-1};a.prototype.AddEventListener=function(a,b){var c=this.HTMLElement;c!=null&&c.addEventListener(a,b);if(this.attachedHandlers==null)this.attachedHandlers=[];this.attachedHandlers.push({n:a,l:b})};a.prototype.RemoveEventListener=function(a,b){var d=this.HTMLElement;d!=null&&d.removeEventListener(a,b);if(this.attachedHandlers!=null){var c=this.GetHandlerIndex(a,b);c>=0&&this.attachedHandlers.splice(c,1)}};a.prototype.DetachEvents=function(){var b=this.HTMLElement;if(this.attachedHandlers!=null&&b!=null)for(var a=0;a<this.attachedHandlers.length;a++)b.removeEventListener(this.attachedHandlers[a].n,this.attachedHandlers[a].l)};a.prototype.AttachEvents=function(){var b=this.HTMLElement;if(this.attachedHandlers!=null&&b!=null)for(var a=0;a<this.attachedHandlers.length;a++)b.addEventListener(this.attachedHandlers[a].n,this.attachedHandlers[a].l)};Object.defineProperty(a.prototype,"DroppedDownMenu",{"get":function(){return this.ActiveChildMenu},enumerable:true,configurable:true});a.prototype._GetCommand=function(c){var a=this.GetRootToolStripDropDown();return a!=this&&a.OverrideChildCommand?a._GetCommand(c):b.prototype._GetCommand.call(this,c)};a.prototype.__CreateChildMenu=function(f,e){var d=new a(f,null,e,this,true),g=e.parentNode,b=this.FindMenuItem(g,this.items);if(b!=null)for(var c=0;c<b.Items.length;c++)d.Items.push(b.Items[c]);return d};a.prototype.GetPreferredLocation=function(){return this.Parent instanceof j?{X:0,Y:0}:b.prototype.GetPreferredLocation.call(this)};a.prototype.OnKeyDown=function(a){return b.prototype.OnKeyDown.call(this,a)};a.prototype.Show=function(f,g,a){if(a!=null)this.Spread=a;if(f!=null&&g!=null){var c=a.getBoundingClientRect(),d=$$.utils.getBoundingClientRect(document.body),h=Math.floor(c.left)-Math.floor(d.left),i=Math.floor(c.top)-Math.floor(d.top),e={X:f+h,Y:g+i};return b.prototype.Show.call(this,e.X,e.Y)}else return b.prototype.Show.call(this)};a.prototype.GetAutoPositionRelativeToSpread=function(b,c,d){var a=this.Spread.getSpreadView()._TranslateToSpread(b,c,d);a=this.AdjustDisplayPosition(this.Spread,a.x,a.y,0,0);return a};a.prototype.Hide=function(a){b.prototype.Hide.call(this,a)};a.prototype.AdjustDisplayPosition=function(e,c,d,a,b){return{X:c+a,Y:d+b}};a.prototype.GetRootToolStripDropDown=function(){var a=this;while(a.Owner!=null)a=a.Owner;return a};a.prototype.FireClicked=function(d,c){var a=document.createEvent("UIEvent");a.initUIEvent("Clicked",false,true,window,1);a.Item=d;var b=this.GetRootToolStripDropDown();!c&&b.HTMLElement!=null&&b.HTMLElement.dispatchEvent(a);return a};a.prototype.FireItemClicked=function(a,c){if(a!=null&&a.HTMLElement!=null){var b=document.createEvent("UIEvent");b.initUIEvent("Clicked",false,true,window,1);!c&&a.HTMLElement.dispatchEvent(b);return b}return null};a.prototype.ProcessCommandName=function(b){if(b==null||this.items==null||this.items.length==0||b.disabled)return false;var a=this.FindMenuItem(b,this.items);if(a!=null){if(!a.Enabled)return false;if(a.Items==null||a.Items.length==0)switch(a.CommandName){case"Copy":this.Spread.Copy();return true;case"Cut":this.Spread.Clear();return true;case"Paste":this.Spread.Paste();return true}}return false};a.prototype.OnItemClick=function(d){try{var c=$$.utils.FindParent(d.target,"LI");if(c==null||this.items==null||this.items.length==0||c.disabled)return;var a=this.FindMenuItem(c,this.items);if(a!=null){if(!a.Enabled)return;if(a.Items==null||a.Items.length==0){var e=this.GetRootToolStripDropDown();e.FireItemClicked(a);e.FireClicked(a)}}}finally{b.prototype.OnItemClick.call(this,d)}};a.prototype.FindMenuItem=function(d,a){if(a!=null&&a.length>0){for(var b=0;b<a.length;b++)if(a[b].HTMLElement==d)return a[b];for(var b=0;b<a.length;b++)if(a[b].Items.length>0){var c=this.FindMenuItem(d,a[b].Items);if(c!=null)return c}}return null};a.prototype.GetCssClass=function(){return"SpreadContextMenu TouchStrip"};a.prototype.Refresh=function(){return this.GenerateHtmlElement()};Object.defineProperty(a.prototype,"HTMLElement",{"get":function(){return this.Holder},"set":function(a){if(a==null||a.tagName=="UL")this.Holder=a},enumerable:true,configurable:true});a.prototype.GenerateHtmlElement=function(){var a=document.createElement("UL");a.className=this.GetCssClass();a.style.display="none";a.style.listStyleType="none";a.tabIndex=-1;for(var c=this.Items,b=0;b<c.length;b++)a.appendChild(c[b].GenerateHtmlElement());this.DetachEvents();this.HTMLElement=a;this.AttachEvents();return a};return a}(GrapeCity.Web.Spread.ContextMenu);e.ToolStripDropDown=i;var j=function(b){__extends(a,b);function a(a,c){b.call(this);this.TOUCH_STRIP_TRANSLATE_DISTANCE=50;this.OverrideChildCommand=true;this.htmlTouchStrip=a;a!=null&&this.ParseTouchStripItemsFromHtml(a,c)}Object.defineProperty(a.prototype,"Area",{"get":function(){return this.showingArea},"set":function(a){this.showingArea=a},enumerable:true,configurable:true});a.prototype.ReflectClipboardState=function(){for(var b=this.Spread.getSpreadView().GetSpreadContext().getClipboardState(),c=0;c<this.Items.length;c++){var a=this.Items[c],d=a.CommandName;switch(d){case"Copy":a.Enabled=b.Copy;break;case"Cut":a.Enabled=b.Cut;break;case"Paste":a.Enabled=b.Paste}}};a.prototype.OnKeyDown=function(a){b.prototype.OnKeyDown.call(this,a);if(a.keyCode!=GCWS.Keys.ESCAPE&&this.Area!=3)if(this.DroppedDownMenu==null){this.Hide();return true}$$.utils.cancelBubble(a);return false};a.prototype.OnBeforeShow=function(){for(var c=0,b=this.Items,a=0;a<b.length;a++)c+=b[a].HTMLElement.offsetWidth;this.HTMLElement.style.width=c+"px"};Object.defineProperty(a.prototype,"HtmlContainer",{"get":function(){var a=this.HTMLElement;return a?a.parentNode:null},enumerable:true,configurable:true});a.prototype.Show=function(g,h,a,e,d){this.Spread=a;if(this.htmlTouchStrip==null){this.Refresh();this.removeTouchStripAfterHide=true}var c=this.HTMLElement;if(c==null)return false;this.Initialize(a,null,c,null,false);if(this.htmlTouchStrip!=null){this.ReflectClipboardState();if(b.prototype.Show.call(this,g,h,a,d)){this.showingArea=e;f.ActiveTouchStrip!=null&&f.ActiveTouchStrip!=this&&f.ActiveTouchStrip.Hide();f.ActiveTouchStrip=this;a.getSpreadView().Touch.FireTouchStripOpened(this);return true}}return false};a.prototype.Hide=function(){if(this.htmlTouchStrip!=null){b.prototype.Hide.call(this,true);if(f.ActiveTouchStrip==this)f.ActiveTouchStrip=null;if(this.removeTouchStripAfterHide){this.removeTouchStripAfterHide=false;this.htmlTouchStrip.parentNode!=null&&this.htmlTouchStrip.parentNode.removeChild(this.htmlTouchStrip)}this.Spread.getSpreadView().Touch!=null&&this.Spread.getSpreadView().Touch.FireTouchStripClosed(this)}};a.prototype.AdjustDisplayPosition=function(d,h,i,e,f){var c=$$.utils.getBoundingClientRect(d),g=this.HTMLElement.style.width;this.HTMLElement.style.width="999px";if(this.HTMLElement.style.display=="none")this.HTMLElement.style.display="block";var b=$$.utils.offsetHeight(this.HTMLElement,this.htmlTouchStrip);this.HTMLElement.style.width=g;var a={X:h+e,Y:i+f};if(Math.floor(c.top)+a.Y-b-this.TOUCH_STRIP_TRANSLATE_DISTANCE<0)a.Y+=this.TOUCH_STRIP_TRANSLATE_DISTANCE;else a.Y-=b+this.TOUCH_STRIP_TRANSLATE_DISTANCE;if(Math.floor(c.left)+a.X-this.TOUCH_STRIP_TRANSLATE_DISTANCE<0)a.X+=this.TOUCH_STRIP_TRANSLATE_DISTANCE;else a.X-=this.TOUCH_STRIP_TRANSLATE_DISTANCE;return a};a.prototype._GetCommand=function(a){a=a.replace("?",this.showingArea.toString(10));return"TouchStrip$"+a};a.prototype.__SetActiveStyle=function(a,b){if(!b||$$.browser.quirksMode||a.ChildMenu!=null&&a.ChildMenu.IsShowing())if(b)$$.utils.appendCssClass(a,"active");else $$.utils.removeCssClass(a,"active")};a.prototype.OnItemAttachEvents=function(a){b.prototype.OnItemAttachEvents.call(this,a);a.__OnItemPointerDown=Function.CreateDelegate(this,function(a){this.OnItemPointerDown(this.GetMenuItemFromLiElement(a.currentTarget))});if($$.browser.mb)this.GetEventMan().Attach(a,c.POINTER_DOWN,a.__OnItemPointerDown,false);else $$.utils.attachEvent(a,"MSPointerDown",a.__OnItemPointerDown)};a.prototype.OnItemDetachEvents=function(a){b.prototype.OnItemDetachEvents.call(this,a);if($$.browser.mb)this.GetEventMan().Detach(a,c.POINTER_DOWN,a.__OnItemPointerDown,false);else $$.utils.detachEvent(a,"MSPointerDown",a.__OnItemPointerDown);a.__OnItemPointerDown=null};a.prototype.OnItemPointerDown=function(a){a.Enabled&&$$.utils.appendCssClass(a.HTMLElement,"active")};a.prototype.FireClicked=function(e,d){var a=b.prototype.FireClicked.call(this,e,true);if(a!=null){a.Area=this.showingArea;var c=this.GetRootToolStripDropDown();!d&&c.HTMLElement!=null&&c.HTMLElement.dispatchEvent(a)}return a};a.prototype.FireItemClicked=function(c,d){var a=b.prototype.FireItemClicked.call(this,c,true);if(a!=null){a.Area=this.showingArea;!d&&c.HTMLElement.dispatchEvent(a)}return a};a.prototype.Refresh=function(){var d=3112009;while(document.getElementById(this.Spread.id+"_TouchStrip_"+d.toString(10))!=null)d++;var e=this.Spread.id+"_TouchStrip_"+d.toString(10),c=b.prototype.Refresh.call(this);if(c.tagName=="DIV")c=c.firstElementChild;var a=document.createElement("DIV");a.id=e;a.className="SpreadContextMenuHolder";a.tabIndex=-1;a.style.overflow="visible";a.style.display="block";a.style.visibility="visible";a.setAttribute("fpspread","ContextMenu");a.setAttribute("HostSpreadID",this.Spread.id);a.appendChild(c);this.htmlTouchStrip=a;return a};a.prototype.GetCssClass=function(){return"SpreadTouchStrip"};a.prototype.ParseTouchStripItemsFromHtml=function(h,g){var c=h.querySelector("DIV > UL");if(c!=null){this.HTMLElement=c;if(!g){var b=$$(c).getChildsByTagName("LI");if(b!=null)for(var d=0;d<b.length;d++){var f=b[d],a=this.ParseMenuItem(f,true);if(!a.IsSeparator){var e=f.querySelector("LI > UL");e!=null&&this.ParseMenuItemsFromHtml(e,a)}this.Items.push(a)}}return true}return false};a.prototype.ParseMenuItemsFromHtml=function(g,f){var b=$$(g).getChildsByTagName("LI");if(b!=null)for(var c=0;c<b.length;c++){var e=b[c],a=this.ParseMenuItem(e);if(!a.IsSeparator){var d=e.querySelector("LI > UL");d!=null&&this.ParseMenuItemsFromHtml(d,a)}f.Items.push(a)}};a.prototype.ParseMenuItem=function(c,k){var a;if(c.className=="sep")a=new g("-");else{var e=c.querySelector("LI > A"),i=e.querySelector("A > SPAN"),j=i!=null?i.textContent:"";a=k?new m(j):new g(j);if(c.disabled||c.querySelector("A.aspNetDisabled")!=null)a.Enabled=false;a.ToolTip=e.title.length==0?null:e.title;var f=c.getAttribute("cmd");if(f!=null&&f.length>0)a.CommandName=f;var h=c.querySelector("DIV.icon");if(h!=null){var b=h.style.backgroundImage;if(b!=null&&b.length>0){var d=new RegExp("^\\s*URL\\s*\\(['\"]?","gi");b=b.replace(d,"");d=new RegExp("\\s*['\"]?\\)\\s*$","gi");b=b.replace(d,"");a.ImageUrl=b}}}a.HTMLElement=c;return a};return a}(i);e.TouchStrip=j})(c=b.Spread||(b.Spread={}))})(b=a.Web||(a.Web={}))})(FarPoint||(FarPoint={}))