//
//	  Copyright (C) 2003-2015 GrapeCity Inc.	All rights reserved.
//

var __extends=this.__extends||function(b,a){for(var c in a)if(a.hasOwnProperty(c))b[c]=a[c];function d(){this.constructor=b}d.prototype=a.prototype;b.prototype=new d},FarPoint;(function(FarPoint){var Web;(function(Web){var Spread;(function(Spread){"use strict";var Key={Enter:13,Tab:9,Up:38,Down:40,BackSpace:8},BaseCellType=function(){function a(b,c,a){this.spread=b;this.cell=c!=null?c:b.getAnchorCell();if(a==null||a===true)this.editor=this.CreateEditor()}a.prototype.Initialize=function(){};a.prototype.Dispose=function(){this.editor&&typeof this.editor.Dispose!="undefined"&&this.editor.Dispose();$$.j(this.cell).removeData("CellTypeBehavior")};a.prototype.GetRender=function(){var a=this.spread.getSpreadJS();return a.getRender(this.cell)};a.prototype.GetEditorElement=function(){var c=this.spread.getSpreadView().GetSpreadContext(),b=c.getCellEditorID(this.cell),a;if(b)a=c.getCellEditor(b,true);else{a=document.createElement("INPUT");a.type="text"}return a};a.prototype.GetEditor=function(){return this.editor};a.prototype.CreateEditor=function(){return new FpEditor(this.spread,this.GetEditorElement())};a.prototype.GetSpreadView=function(){return this.spread.getSpreadView()};a.prototype.GetSpreadContext=function(){return this.GetSpreadView().GetSpreadContext()};a.prototype.StartEdit=function(){};a.prototype.EndEdit=function(){};a.prototype.SetValue=function(){};a.prototype.GetValue=function(){};a.prototype.SetEditorValue=function(){this.editor&&this.editor.SetValue.apply(this.editor,arguments)};a.prototype.GetEditorValue=function(){return this.editor?this.editor.GetValue.apply(this.editor,arguments):null};a.prototype.SelectAllText=function(){this.editor&&this.editor.SelectAllText()};a.prototype.SetEditorFocus=function(){this.editor&&this.editor.SetFocus()};return a}();Spread.BaseCellType=BaseCellType;var ButtonCellType=function(b){__extends(a,b);function a(){b.apply(this,arguments)}a.prototype.Initialize=function(){var a=this;b.prototype.Initialize.call(this);if(!this.initialized){this.spread.getSpreadView().RegisterManagedObject(this);if($$.browser.ie&&$$.browser.ieversion<10){this.onButtonClickHandler=function(b){a.OnButtonClick(b)};this.button=$$.j(this.cell).find("INPUT").get(0);$$.utils.attachEvent(this.button,"click",this.onButtonClickHandler)}this.initialized=true}};a.prototype.GetEditorElement=function(){return $$.j(this.cell).find("INPUT").get(0)};a.prototype.OnButtonClick=function(){try{this.spread.onclickCell();this.spread.UpdatePostbackData()}catch(b){}};a.prototype.Dispose=function(){if(this.onButtonClickHandler){$$.utils.detachEvent(this.button,"click",this.onButtonClickHandler);this.onButtonClickHandler=null}};a.prototype.CreateEditor=function(){return new ButtonEditor(this.spread,this.GetEditorElement())};return a}(BaseCellType);Spread.ButtonCellType=ButtonCellType;var DateTimeCellType=function(b){__extends(a,b);function a(a,c){b.call(this,a,c,false);this.editor=DateTimeEditor.CheckInit(this.spread.id,this.GetEditorElement().id,false)}a.prototype.StartEdit=function(){this.editor.AttachEvents()};a.prototype.EndEdit=function(){this.editor.DetachEvents();this.editor.HideDropDownControl()};a.prototype.SetValue=function(a,k){var f=true,d=null;if(k!=true){var c=this.GetEditor();if(c.element.getAttribute("edf")!=null||c.element.getAttribute("ef")!=null){var g=this.spread.getEditingInfo(),j=g?g.EditingValue:null;this.cell.setAttribute("evalue",a==null?"":a);if(a==j)f=a==null;else if(c.element.getAttribute("ignoreValid")!=null)c.element.setAttribute("editValue",a);else{d=DateUtils.ParseDate(c.element,a,true);if(d!=null){var i=DateUtils.FormatDate(c.element,d,false);i!=a&&this.cell.setAttribute("evalue",i);a=DateUtils.FormatDate(c.element,d,true)}}}}var b=this.GetRender();if(b.tagName=="NOBR")b=b.parentElement;if(typeof b.value!="undefined"){if(a==null)a="";f&&$$.j(b).val(a);b.style.display="block"}else if(f){var l=$$.j(b),h=$$.j(b).children().first(),e=h.get(0);if(a==null||a=="")if(e.tagName=="NOBR")e.innerHTML="&nbsp;";else b.innerHTML="&nbsp;";else if(e.tagName=="NOBR")h.text(a);else l.text(a)}return d!=null?d:a};a.prototype.GetValue=function(c){var b=this.GetRender(),a=b.value;if(c){var b=this.GetRender();if(b.tagName!="INPUT")a=typeof this.cell.attributes.evalue=="undefined"?undefined:this.cell.attributes.evalue.value}if(typeof a=="undefined")a=$$.utils.trim(b.innerText||b.textContent);return a};a.prototype.IsValid=function(b,a){if(b==null||b.length==0||a&&a.getAttribute("IgnoreClientValidation")!=null)return"";if(!$$.j(this.spread).attr("inDesign")&&a!=null&&(a.getAttribute("edf")!=null||a.getAttribute("ef")!=null)){if(a.getAttribute("ignoreValid")=="1")return"";b=$$.j.trim(b);if(b.length==0)return"";var d=DateUtils.ParseDate(a,b,true)!=null,c=this.spread.getSpreadView().GetSpreadContext()._getFpRefProperty(this.cell);if(!d)return c.getAttribute("error")!=null?c.getAttribute("error"):"DateTime"}return""};return a}(BaseCellType);Spread.DateTimeCellType=DateTimeCellType;var FpEditor=function(){function a(b,a){this.element=a;this.spread=b;$$.j(this.element).attr("FpEditor",$$.j(this.element).attr("FpEditor")||this.GetName())}a.prototype.GetValue=function(){return null};a.prototype.SetValue=function(){};a.prototype.SetFocus=function(){};a.prototype.SelectAllText=function(){};a.prototype.OnPointerDown=function(){return false};a.prototype.GetName=function(){return"FpEditor"};a.prototype.IsScriptEnableSpread=function(){return this.spread&&$$.j(this.spread).attr("FpSpread")=="Spread"};return a}();Spread.FpEditor=FpEditor;var ButtonEditor=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);this.button=$$.utils.isNativeControl(this.element)?this.element:$$.j(this.element).find("INPUT").get(0)}a.prototype.SetFocus=function(){this.button.focus()};a.prototype.GetName=function(){return"Button"};return a}(FpEditor);Spread.ButtonEditor=ButtonEditor;var GeneralEditor=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);var d=$$.utils.isTextControl(this.element)?this.element:$$.j(this.element).find("INPUT[type='text']").get(0);this.input=d}a.prototype.GetValue=function(){return $$.j(this.input).val()};a.prototype.SetValue=function(a){$$.j(this.input).val(a)};a.prototype.SetFocus=function(){this.input.focus();this.input.selectionStart=this.input.selectionEnd=0;if(this.input.scrollLeft)this.input.scrollLeft=0};a.prototype.SelectAllText=function(){$$.utils.selectAll(this.input)};return a}(FpEditor);Spread.GeneralEditor=GeneralEditor;var DropDownEditor=function(b){__extends(a,b);function a(c,a){b.call(this,c,a);this.ShowDropDown=false;this.ddControlId=this.element.getAttribute("dropDownControlId");if(this.ddControlId&&this.ddControlId!="")this.ShowDropDown=true}a.prototype.GetDropDownController=function(){if(this.ddController==null){var b=this.ddControlId+"_ddContainer",a=document.getElementById(b);if(!a){a=document.createElement("div");var c=this.spread.id,d=document.getElementById(c+"_view")||document.getElementById(c+"_viewport");d.appendChild(a);a.id=b;$$.j(a).attr("HostSpreadID",this.spread.id);$$.j(a).css("z-index","999");$$.j(a).on("focusin",function(a){$$.utils.cancelBubble(a,false)})}this.ddController=this.CreateDropDownController(a)}return this.ddController};a.prototype.CreateDropDownController=function(a){return new DropDownController(this,a,$$.j(this.spread).attr("inDesign")!=null)};a.prototype.ShowDropDownControl=function(d){if(this.ddControlId){var a=document.getElementById(this.ddControlId);if(a&&typeof a.Toggle==="function"){var b=this.GetDropDownController();if(d||b.container.style.display=="none"){var c=this.spread.getSpreadView?this.spread.getSpreadView().IsInTouchMode():false;a.Toggle(b,c);if(this.IsDropDownControlShowing()&&this.IsScriptEnableSpread()){var e=this.spread.getTopSpread();CallBacks.topic(e.id).subscribeOn("MouseDown MouseUp Focus",$$.j.proxy(this.OnSpreadCallBack,this))}}}}};a.prototype.HideDropDownControl=function(){if(this.ddControlId&&this.IsDropDownControlShowing()){var a=document.getElementById(this.ddControlId);a&&typeof a.Hide==="function"&&a.Hide();if(this.IsScriptEnableSpread()){var b=this.spread.getTopSpread();CallBacks.topic(b.id).unsubscribeOn("MouseDown MouseUp Focus",this.OnSpreadCallBack)}}};a.prototype.IsDropDownControlShowing=function(){var a=this.GetDropDownController();return a.container.style.display!="none"};a.prototype.AttachEvents=function(){};a.prototype.DetachEvents=function(){if(this.IsScriptEnableSpread()){var a=this.spread.getTopSpread();CallBacks.topic(a.id).unsubscribeOn("MouseDown MouseUp Focus",this.OnSpreadCallBack)}};a.prototype.OnSpreadCallBack=function(c){var b=c.event,a=true;$$.j.each([this.element,this.GetDropDownController().container],function(d,c){if(c==b.target||$$.j.contains(c,b.target)){a=false;return false}});a&&this.HideDropDownControl()};return a}(GeneralEditor);Spread.DropDownEditor=DropDownEditor;var DateTimeEditor=function(b){__extends(a,b);function a(d,a){var c=this;b.call(this,d,a);this.isEventsRegistered=false;this.resetFlagsTimerID=-1;if($$.j(a).data("FpEditor"))throw new Error("Error: Instantiation failed: Use DateTimeEditor.CheckInit() instead of new.");$$.j(a).data("FpEditor",this);this.focusElement=$$.j(this.element).find(".dropdowncontainer").children().first().get(0);$$.spread.ready(this.spread,function(){var a=c.spread.getTopSpread();CallBacks.topic(a.id).topic("Dispose").subscribe($$.j.proxy(c.OnDisposeCallBack,c),true)})}a.prototype.OnDisposeCallBack=function(){this.IsDropDownControlShowing()&&this.HideDropDownControl();this.DetachEvents();$$.j(this.element).removeData("FpEditor")};a.prototype.CreateDropDownController=function(a){return new DateTimeDropDownController(this,a,$$.j(this.spread).attr("inDesign")!=null)};a.prototype.AttachEvents=function(){if(!this.isEventsRegistered){b.prototype.AttachEvents.call(this);this._AttachEvents();this.isEventsRegistered=true}};a.prototype._AttachEvents=function(){var c=this,a=$$.j(this.element),b=$$.j(this.input),d=a.find(".dropdowncontainer").children().first();d.on("mousedown mouseup",function(a){$$.utils.cancelBubble(a,false)}).on("click",$$.j.proxy(this.OnButtonClick,this));a.on("mousedown mouseup",function(a){c.IsDropDownControlShowing()&&$$.utils.cancelBubble(a,false)}).on("focusin",$$.j.proxy(this.OnEditorFocusIn,this)).on("keydown",$$.j.proxy(this.OnEditorKeyDown,this)).on("keyup",$$.j.proxy(this.OnEditorKeyUp,this));$$.j(document).on("focusin",$$.j.proxy(this.OnDocumentFocusIn,this)).on("mouseup",$$.j.proxy(this.OnDocumentMouseUp,this));b.on("mousedown",$$.j.proxy(this.OnInputMouseDown,this))};a.prototype.OnButtonClick=function(){this.ShowDropDownControl(true)};a.prototype.OnDocumentFocusIn=function(b){var a=true;$$.j.each([this.element,this.GetDropDownController().container],function(d,c){if(c==b.target||$$.j.contains(c,b.target)){a=false;return false}});a&&this.HideDropDownControl()};a.prototype.OnEditorKeyDown=function(a){var b=this.IsDropDownControlShowing(),e=b?document.getElementById(this.ddControlId):null;if(a.altKey&&(a.keyCode==Key.Up||a.keyCode==Key.Down)){this.ShowDropDownControl(true);!this.IsDropDownControlShowing()&&this.input.focus();$$.utils.cancelBubble(a,true)}else if(a.keyCode==Key.Tab)this.HideDropDownControl();else if(b&&a.keyCode==Key.BackSpace)$$.utils.cancelBubble(a,true);else if(b)e.OnKeyDown(this.GetDropDownController(),a);else if(!(a.keyCode==Key.Enter||a.keyCode==Key.Up||a.keyCode==Key.Down)){var c=this.spread.getSpreadView?this.spread.getSpreadView():null;if(c==null||c.OnSpreadTranslateKey(a)){var d=this.IsScriptEnableSpread()&&$$.utils.isNeedPreventScrolling(a,this.input);$$.utils.cancelBubble(a,d)}}};a.prototype.OnEditorKeyUp=function(a){a.altKey&&(a.keyCode==Key.Up||a.keyCode==Key.Down)&&$$.utils.cancelBubble(a,true)};a.prototype.OnInputMouseDown=function(){this.IsDropDownControlShowing()&&this.HideDropDownControl()};a.prototype.OnEditorFocusIn=function(){this.spread.getSpreadView&&this.spread.getSpreadView().GetCommandBar().EnableDataButtons(true)};a.prototype.DetachEvents=function(){if(this.isEventsRegistered){b.prototype.DetachEvents.call(this);this._DetachEvents();this.isEventsRegistered=false}};a.prototype._DetachEvents=function(){for(var b=$$.j(this.element),d=$$.j(this.input),e=b.find(".dropdowncontainer").children().first(),c=[b,d,e],a=0;a<c.length;a++){var f=c[a];f.off()}$$.j(document).off("focusin",this.OnDocumentFocusIn).off("mouseup",this.OnDocumentMouseUp)};a.prototype.GetEditingDate=function(){var c=this.GetValue(),b=this.element,a=DateUtils.ParseDate(b,c,true);return a};a.prototype.SetValueAndClose=function(d){this.SetValue(d);var a=this.spread,b=a.getSpreadView?a.getSpreadView().GetSpreadContext():null,c=a.getEditingInfo?a.getEditingInfo():null;if(c&&!b.IsInRowEditTemplate(this.element))if($$.browser.ie&&$$.browser.version<=9)b.setEditorFocus(this.element,false);else b.setEditorFocus(this.element,null,null,true);else this.input.focus()};a.prototype.SetValue=function(a,e){var d=false,f=true,b=null;if(a instanceof Date){b=a;a=DateUtils.FormatDate(this.element,b,false)}else if((this.element.getAttribute("edf")!=null||this.element.getAttribute("ef")!=null)&&!(a==null||a=="")){if(this.element.getAttribute("ignoreValid")!=null)a=this.element.getAttribute("editValue");else if(e){var c=Sys.CultureInfo.CurrentCulture,b=Date._parseExact(a,"yyyy/M/d",c)||Date._parseExact(a,"yyyy/M/d H:m:s:fff",c);if(b!=null)a=DateUtils.FormatDate(this.element,b,false)}d=true}$$.j(this.input).val(a);return d};a.prototype.ClearOldValue=function(){this.input.value=""};a.CheckInit=function(f,e,d){var b=null,c=document.getElementById(e);if(c){b=$$.j(c).data("FpEditor");if(!b){var g=document.getElementById(f);b=new a(g,c);(d==null||d===true)&&b.AttachEvents()}}return b};a.prototype.Dispose=function(){};a.prototype.OnDocumentMouseUp=function(b){var a=$$.spread.getSpreadControl(b.target);a&&a!=this.spread&&this.IsDropDownControlShowing()&&this.HideDropDownControl()};a.prototype.OnPointerDown=function(a){return $$.utils.contains(this.element,a.target||a.srcElement)?true:false};return a}(DropDownEditor);Spread.DateTimeEditor=DateTimeEditor;var DropDownController=function(){function a(c,a,b){this.inDesign=false;this.inDesign=b;this.container=a;this.editor=c;this.parent=a.parentNode;this.container.style.position="absolute";this.container.style.height="1px";this.container.style.width="1px";this.container.style.overflow="visible";this.container.style.display="none"}a.prototype.UpdateLocationAndLayout=function(){var a=this.container.childNodes.length?this.container.childNodes[0]:this.container;this.container.style.height=a.offsetHeight+"px";this.container.style.width=a.offsetWidth+"px";if(this.container.style.top=="")this.container.style.top="0px";if(this.container.style.left=="")this.container.style.left="0px";var b=this.editor.element.getBoundingClientRect(),c=this.container.getBoundingClientRect();this.container.style.left=parseInt(this.container.style.left)+(b.left-c.left)+"px";this.container.style.top=parseInt(this.container.style.top)+(b.bottom-c.top)+"px";if(typeof GCWS!="undefined")this.container.style.zIndex=GCWS.ZIndex.POPUP};a.prototype.Show=function(){!this.inDesign&&this.container.parentNode==this.parent&&document.body.appendChild(this.container);this.container.style.display="";this.UpdateLocationAndLayout();$$.j(this.container).off().on("mousedown mouseup "+$$.TouchEvents.TouchStart+" "+$$.TouchEvents.TouchEnd,function(a){$$.utils.cancelBubble(a,false)});if($$.browser.webkit&&FarPoint.Web.Spread.SafariPatch)this.safariScrollShield=FarPoint.Web.Spread.SafariPatch.FixUnderLayerScroll(this.container,null,"DropDownContainerScrollShield")};a.prototype.Hide=function(){var a=$$.j(this.container);a.off();this.container.parentNode!=this.parent&&this.parent.appendChild(this.container);this.container.style.display="none";if(this.safariScrollShield!=null){this.safariScrollShield.parentNode.removeChild(this.safariScrollShield);this.safariScrollShield=null}};a.prototype.Toggle=function(){if(this.container.style.display=="none")this.Show();else this.Hide()};a.prototype.GetValue=function(){return null};a.prototype.SetValue=function(){};return a}();Spread.DropDownController=DropDownController;var DateTimeDropDownController=function(b){__extends(a,b);function a(d,a,c){b.call(this,d,a,c)}a.prototype.GetValue=function(){var a=this.editor;return a.GetEditingDate()};a.prototype.SetValueAndClose=function(b){var a=this.editor;a.SetValueAndClose(b)};return a}(DropDownController);Spread.DateTimeDropDownController=DateTimeDropDownController;var DateUtils=function(){function DateUtils(){}DateUtils.FormatDate=function(c,e,b){var a=Sys.CultureInfo.CurrentCulture,f=a.dateTimeFormat,d=this.GetDateTimeFormat(c,!b),h=this.GetDateTimeFormatString(c,!b);if(d!=null)a.dateTimeFormat=d;var g=e._toFormattedString(h,a);a.dateTimeFormat=f;return g};DateUtils.ParseDate=function(e,c,d){var a=Sys.CultureInfo.CurrentCulture,h=a.dateTimeFormat,i=a._dateTimeFormats,g=this.GetDateTimeFormat(e,d),k=this.GetDateTimeFormatString(e,d),f=this.GetDateTimeFormat(e,!d),j=this.GetDateTimeFormatString(e,!d);if(g!=null)a.dateTimeFormat=g;var b=Date._parseExact(c,k,a);if(b==null){if(f!=null)a.dateTimeFormat=f;else a.dateTimeFormat=h;b=Date._parseExact(c,j,a)}if(b==null){if(g!=null){a._dateTimeFormats=null;a.dateTimeFormat=g;b=Date._parse(c,a,[])}if(b==null&&f!=null){a._dateTimeFormats=null;a.dateTimeFormat=f;b=Date._parse(c,a,[])}if(b==null){a._dateTimeFormats=null;a.dateTimeFormat=h;b=Date._parse(c,a,[])}}a._dateTimeFormats=i;a.dateTimeFormat=h;return b};DateUtils.GetDateTimeFormat=function(a,b){var c=b?a.getAttribute("edf"):a.getAttribute("df");return this.ParseJSONObject(c)};DateUtils.GetDateTimeFormatString=function(b,c){var a=c?b.getAttribute("ef"):b.getAttribute("f");if(a==null||a=="")a="d";return a};DateUtils.ParseJSONObject=function(str){return str!=null?typeof JSON!="undefined"?JSON.parse(str):eval("("+str+")"):null};return DateUtils}();Spread.DateUtils=DateUtils;var CellTypeFactory=function(){function a(){}a.GetCellType=function(c,a){if(a==null)a=c.getAnchorCell();var e=$$.j(a),b=e.data("CellTypeBehavior");if(b==null){var g=c.getSpreadView().GetSpreadContext(),d=g.getCellType(a);if(d=="text"){var f=g.getCellType2(a);if(f!=null)d=f}switch(d){case"DateTimeCellType":b=new DateTimeCellType(c,a);break;case"ButtonCellType":b=new ButtonCellType(c,a)}b&&e.data("CellTypeBehavior",b)}return b};a.GetEditor=function(d){var a=d;while(a&&a!=document.body&&a!=document){var c=$$.j(a);if(c.attr("FpEditor")!=null){var b=c.data("FpEditor");return b?b:null}a=a.parentNode}};return a}();Spread.CellTypeFactory=CellTypeFactory;var CallBacks=function(){function a(b,a){this.id=b;if(this.id==null)this.id="";this.prev=a}a.prototype.topic=function(c){if(!this.topics)this.topics={};var b=this.topics[c];if(!b)this.topics[c]=b=new a(c,this);return b};a.prototype.publish=function(){for(var c=[],a=0;a<arguments.length;a++)c[a-0]=arguments[a];var b=$$.j.Event(this.id);b.fpCallBackArgs=arguments;$$.j(this).trigger(b);return this};a.prototype.subscribe=function(b,c){var a=this._proxy(b);a.guid=b.guid;if(c)$$.j(this).one(this.id,a);else $$.j(this).on(this.id,a);return this};a.prototype.unsubscribe=function(a){$$.j(this).off(this.id,a);return this};a.prototype.subscribeOn=function(c,e,d){for(var b=c.split(" "),a=0;a<b.length;a++)this.topic(b[a]).subscribe(e,d)};a.prototype.unsubscribeOn=function(c,d){for(var b=c.split(" "),a=0;a<b.length;a++)this.topic(b[a]).unsubscribe(d)};a.prototype._proxy=function(a){return function(c){var d=c.fpCallBackArgs,b=a.apply(this,d);b===false&&$$.utils.cancelBubble(c,false,true);return b}};a.instance=function(){if(!a._root)a._root=new a("");return a._root};a.topic=function(b){return a.instance().topic(b)};return a}();Spread.CallBacks=CallBacks})(Spread=Web.Spread||(Web.Spread={}))})(Web=FarPoint.Web||(FarPoint.Web={}))})(FarPoint||(FarPoint={}))