//
//	  Copyright (C) 2003-2014 GrapeCity Inc.	All rights reserved.
//

if(typeof GrapeCity=="undefined")GrapeCity={};if(!GrapeCity.Web)GrapeCity.Web={};if(!GrapeCity.Web.Spread)GrapeCity.Web.Spread={};if(typeof GrapeCity.Web.Spread.FpSpread=="undefined")GrapeCity.Web.Spread.FpSpread=function(element){element.Behavior=this;var SelectionBlockOptions=new function(){this.None=0;this.Cells=1;this.Rows=2;this.Columns=4;this.Sheet=8},$element=$$.j(element),forcePaintAnchorCell=false,fpSpreadJS=null,mvc,spreadView,virtualScrollPagingFormatString,needScrollToTopRow=false,SPLController,rowHeaders=1,colHeaders=1,working=false,editing=false,editor=null,editingValue=null,editingFormula=null,editorMargin=new Margin(-1,-1,-1,-1),editorSelectedIndex=-1,sizeColumn=null,sizeRow=null,activeX=-1,activeY=-1,activeElement=null,anchorCell=null,oldAnchorCell=null,leadingCell=null,leadingCellRow=null,leadingCellCol=null,selectStartRow=null,selectStartCol=null,selectedBackColor="#aabbff",anchorBackColor="#bbccff",useDefaultSelectionBackColor=false,tableData=null,xmlData=null,spanCells=[],rowSpanCells=[],colSpanCells=[],tableView=null,viewport=null,rowHeader=null,colHeader=null,commandBar=null,viewport0=null,viewport1=null,viewport2=null,scrollvp=null,vpholder_setSizeCallback=null,corner=null,frozColHeader=null,frozColFooter=null,footerCorner=null,colFooter=null,frozRowHeader=null,editorList=[],validatorList=[],validationMsg=null,dirty=false,initialized=false,operationMode="Normal",ie6up=false,textBox=null,sizeBar=null,xhtml=false,frameSet=false,frzRows=0,frzCols=0,rowCount=0,ignoreBlur=false,ignoreChange=false,ignoreVirtualPaging=false,dataBuff=null,selectType="",selectionUnit="Cell",scrollLeft=0,scrollTop=0,retainSelectionBlock=true,editModePermanent=false,enableRowEditTemplate="false",hiddenColumns=[],selectedCols=[],vp2List=null,vpList=null,rhList=null,current=-1,currentCount=-1,newTop=0,newPageCount=0,smartPaint=false,bSuspendLayout=false,left=37,right=39,up=38,down=40,tab=9,enter=13,shift=16,space=32,altkey=18,home=36,end=35,pup=33,pdn=34,backspace=8,hierBar=null,pager1=null,pager2=null,dummy=null,vpholder=null,groupBar=null,movingCol=null,slideLeft=null,slideRight=null,dragCol=null,dragViewCol=null,dragSlideBar=null,allowColMove=null,allowGroup=null,activePager=null,error=false,cb_btn=null,msgStyle=null,ignoreSynRowHeight=false,ignorePostbackEditmode=false,ignoreEditorFocus=false,ignorePaintSelection=false,ignoreElementActive=false,ignoreShowScrollingContent=false,isEndingEdit=false,callEndEditFromMouseWheel=false,engine=null,isPressTABKeyFromOutSide=false,selectionBlockOptions=SelectionBlockOptions.Cells|SelectionBlockOptions.Rows|SelectionBlockOptions.Columns|SelectionBlockOptions.Sheet,msgList=null,isMouseMoving=null,mouseX=null,mouseY=null,copymultiCol,activeChartObj,displayingVirtualScrollingContent=null,ignorePropertyChanged=false,currentPageIndex=null,lastPageIndex=null,needDelayScrollView=false;function isSmartPaint(){return smartPaint}function propertyChanged(){try{!ignorePropertyChanged&&event.propertyName=="style.display"&&element.style.display!="none"&&initLayout()}catch(a){}}function getAttributeInternal(a){return element.getAttribute(a)}function dispose(){var a=FpSpreadJS.getChildViews(element);if(a)for(var b=0;b<a.length;b++)a[b].dispose();window.document.detachEvent("onkeyup",keyup);window.document.detachEvent("onkeydown",translateKey);window.document.detachEvent("onmousedown",setActiveSpread);element.detachEvent("onmousewheel",doMouseWheel);element.detachEvent("onactivate",spreadActive);element.detachEvent("ondocumentready",init);element.detachEvent("onmousedown",mouseDown);element.detachEvent("onmouseup",mouseUp);element.detachEvent("onmouseout",mouseOut);element.detachEvent("onmousemove",mouseMove);element.detachEvent("ondblclick",dblclick);element.detachEvent("onresize",processResize);element.detachEvent("onpropertychange",propertyChanged);var h=getTopSpread(element),f=window.document.getElementById(h.id+"_textBox");f!=null&&f.detachEvent("onactivate",textBoxActive);var d=window.document.getElementById(element.id+"_scrollvp");d!=null&&d.detachEvent("onresize",processResize);var e=getViewportHolder();e!=null&&e.detachEvent("onscroll",noScroll);var c=window.document.getElementById(element.id+"_view");c!=null&&c.detachEvent("onscroll",scrollView);var g=getParent(getViewport2());g!=null&&g.detachEvent("onscroll",vp2Scroll);chartDispose();if(getParentSpread()!=null){element.Behavior=null;$element.removeData();$element.off();$element=null}}function syncBehavior(e){var d=e.style.behavior,a=GetChildSpreads(e.id);if(a!=null&&a.length>0)for(var c=0,f=a.length;c<f;c++){var b=a[c];if(b.style.behavior!=d){b.style.behavior=d;syncBehavior(b)}}}function init(b,u){if(typeof FpSpreadJS=="undefined"){setTimeout(init,20);return}if(typeof mvcSpread=="undefined"||typeof GrapeCity=="undefined"||GrapeCity.Web==null||GrapeCity.Web.Spread==null||GrapeCity.Web.Spread.SpreadView==null){setTimeout(function(){init(b)},10);return}if(!$$.JQueryBootstrap(function(){init(b)}))return;element.initLayoutCompleted=false;element.sizeSpreadCounting=0;this.initElementBehavior();mvc=new mvcSpread(element);if(element.all.length==0||element.parentNode==null||element.mcctCellType!=null&&element.parentElement==null)return;needScrollToTopRow=element.getAttribute("scrollToTopRow")=="true";var B=$$.browser;B.ieversion>=9&&syncBehavior(element);fpSpreadJS=new FpSpreadJS(element,getSpreadContext(),fpSpreadJS);element.fpSpreadJS=fpSpreadJS;var g=getParentSpread();if(g!=null&&!g.initialized){if(g.childViewsInitPending==null)g.childViewsInitPending={};var E=Function.CreateCallback(init,b),D=Function.CreateDelegate(element,E);g.childViewsInitPending[element.id]=D;return}initialized=false;element.initialized=false;ignoreVirtualPaging=true;if(window.document.FpActiveSheetView!=null)window.document.FpActiveSheetView=window.document.getElementById(window.document.FpActiveSheetView.id);isactive=window.document.FpActiveSheetView==element;current=-1;currentCount=-1;newTop=0;newPageCount=0;smartPaint=element.UIVirtualization=="True"&&element.virtualPaging!="true"&&element.ClientAutoSize!="True";selectionBlockOptions=parseInt(element.selectionBlockOptions);if(getTopSpread().hierView=="true")smartPaint=false;tableView=window.document.getElementById(element.id+"_view");if(tableView!=null){tableView.onscroll=scrollView;viewport=window.document.getElementById(element.id+"_viewport")}viewport0=window.document.getElementById(element.id+"_viewport0");viewport1=window.document.getElementById(element.id+"_viewport1");viewport2=window.document.getElementById(element.id+"_viewport2");rowHeader=window.document.getElementById(element.id+"_rowHeader");if(smartPaint){vp2List=new TableBuff(element,getViewport2());vpList=new TableBuff(element,getViewport());rhList=new TableBuff(element,getRowHeader())}anchorCell=null;leadingCell=null;groupBar=null;hierBar=null;pager1=null;pager2=null;dummy=null;vpholder=null;frozRowHeader=null;frozColHeader=null;frozColFooter=null;frzRows=0;frzCols=0;validationMsg=null;editorList=[];validatorList=[];spanCells=[];rowSpanCells=[];colSpanCells=[];slideLeft=slideRight=dragCol=dragViewCol=movingCol=dragSlideBar=allowColMove=allowGroup=activePager=null;cb_btn=null;msgStyle=null;editor=sizeColumn=sizeRow=null;working=editing=false;scrollLeft=0;scrollTop=0;lastPageIndex=currentPageIndex;currentPageIndex=GetCurrentPageIndex();ignoreSynRowHeight=false;bSuspendLayout=false;if(element.EditModePermanent)editModePermanent=true;if(element.RetainSelectionBlock!=null&&element.RetainSelectionBlock=="false")retainSelectionBlock=false;var o=window.navigator.userAgent;msgList=null;copymultiCol=false;var C=o.indexOf("MSIE")>=1;if(C)ie6up=o.indexOf("MSIE 6.")>=1||o.indexOf("MSIE 7.")>=1||o.indexOf("MSIE 8.")>=1;xhtml=isXHTML();getIEMode();tableData=window.document.getElementById(element.id+"_XMLDATA");if(tableData==null){tableData=window.document.createElement("<xml>");tableData.id=element.id+"_XMLDATA";window.document.body&&window.document.body.insertBefore(tableData,null)}if(xmlData==null||!xmlData.belongToElement(element)){element.xmlDoc=tableData;xmlData=$$.fn.createXMLDOMWrapper(element);element.getXmlDataObject=function(){return xmlData}}var j=window.document.getElementById(element.id+"_data");if(j!=null&&j.data!=null){tableData.loadXML(j.data);j.value=""}saveData();if(viewport!=null&&(engine<8||viewport.cellSpacing>0||viewport.rules=="")){viewport.style.removeAttribute("borderWidth");viewport.style.borderWidth="0px"}if(engine<8||viewport.cellSpacing>0){if(viewport!=null){viewport.style.removeAttribute("borderWidth");viewport.style.borderWidth="0px"}if(viewport0!=null){viewport0.style.removeAttribute("borderWidth");viewport0.style.borderWidth="0px"}if(viewport1!=null){viewport1.style.removeAttribute("borderWidth");viewport1.style.borderWidth="0px"}if(viewport2!=null){viewport2.style.removeAttribute("borderWidth");viewport2.style.borderWidth="0px"}}corner=window.document.getElementById(element.id+"_corner");if(corner!=null&&corner.children.length>0)corner=corner.children(0);if(viewport1!=null)frzRows=viewport1.rows.length;if(viewport0!=null){var m=getColGroup(viewport0);if(m!=null)frzCols=m.childNodes.length}else if(viewport2!=null){var m=getColGroup(viewport2);if(m!=null)frzCols=m.childNodes.length}var c=window.document.getElementById(element.id+"_frozColHeader");if(c!=null){frozColHeader=c.children(0);frzCols=getColGroup(frozColHeader).childNodes.length}c=window.document.getElementById(element.id+"_frozColFooter");if(c!=null)frozColFooter=c.children(0);colFooter=window.document.getElementById(element.id+"_colFooter");if(colFooter!=null)colFooter=colFooter.children(0);footerCorner=window.document.getElementById(element.id+"_footerCorner");if(footerCorner!=null&&footerCorner.children.length>0)footerCorner=footerCorner.children(0);c=window.document.getElementById(element.id+"_frozRowHeader");if(c!=null)frozRowHeader=c.children(0);rowHeader!=null&&rowHeader.attachEvent("onscroll",rheaderScroll);if(rowHeader!=null)rowHeader=rowHeader.children(0);colHeader=window.document.getElementById(element.id+"_colHeader");colHeader!=null&&colHeader.attachEvent("onscroll",cheaderScroll);if(colHeader!=null)colHeader=colHeader.children(0);commandBar=window.document.getElementById(element.id+"_commandBar");scrollvp=window.document.getElementById(element.id+"_scrollvp");if(scrollvp!=null)scrollvp.attachEvent("onresize",processResize);else if(smartPaint){scrollvp=window.document.createElement("div");scrollvp.id=element.id+"_scrollvp";scrollvp.style.position="relative";scrollvp.style.display="none";scrollvp.style.overflowX=tableView.style.overflowX;scrollvp.style.overflowY=tableView.style.overflowY;tableView.style.overflowX="hidden";tableView.style.overflowY="hidden";tableView.parentNode.insertBefore(scrollvp,tableView);dummy=window.document.createElement("div");dummy.id=element.id+"_dummy";dummy.style.width="100%";dummy.style.height="100%";scrollvp.insertBefore(dummy,null);vpholder=window.document.createElement("div");vpholder.id=element.id+"_vpholder";vpholder.style.position="absolute";tableView.parentNode.insertBefore(vpholder,tableView);var d=window.document.createElement("table");d.cellspacing="0";d.cellpadding="0";d.border="0";d.style.borderWidth="0px";d.style.borderCollapse="collapse";vpholder.insertBefore(d,null);var H=d.insertRow(),n=H.insertCell();n.align="left";n.valign="top";n.style.padding="0px";n.insertBefore(tableView);FpSpreadJS._applyScrollbarAppearances(tableView,scrollvp)}rowHeaders=parseInt(element.RowHeaders);colHeaders=parseInt(element.ColHeaders);if(colHeader!=null&&engine==8){var e=getColGroup(colHeader);if(e!=null&&e.childNodes.length>1){var x=parseInt(e.childNodes[e.childNodes.length-2].width);if(!isNaN(x))e.childNodes[e.childNodes.length-2].width=Math.max(1,x-1)}}selectedBackColor=element.selectedBackColor;anchorBackColor=element.anchorBackColor;useDefaultSelectionBackColor=element.useDefaultSelectionBackColor;var t=getViewport();if(t!=null){element.RowCount=t.rows.length;element.ColCount=t.cols}operationMode=element.OperationMode;enableRowEditTemplate=element.EnableRowEditTemplate;hiddenColumns=fpSpreadJS.initHiddenColumns(element);if(element.selectionUnit!=null)selectionUnit=element.selectionUnit;virtualScrollPagingFormatString=element.virtualScrollPagingFormatString;element.getCommandBar=getCommandBar;element.getRowHeader=getRowHeader;element.getColHeader=getColHeader;element.getViewport=getViewport;element.getCorner=getCorner;element.getFrozColHeader=getFrozColHeader;element.getFrozRowHeader=getFrozRowHeader;element.getViewport0=getViewport0;element.getViewport1=getViewport1;element.getViewport2=getViewport2;element.getScrollvp=getScrollvp;element.setColWidth=setColWidth;element.waitForAttachBehavior=waitForAttachBehavior;element.printSpread=printSpread;element.sizeSpread=sizeSpread;element.processKeyMap=processKeyMap;element.getRowByKey=getRowByKey;element.getColByKey=getColByKey;element.clearCellData=clearCellData;element.Filter=Filter;element.init=init;element.dispose=dispose;element.loadScrollbarState=loadScrollbarState;element.setCellValueFromView=setCellValueFromView;element.setActiveField=setActiveField;element.getAttributeInternal=getAttributeInternal;element.getCellFromRowCol=getCellFromRowCol;element.isHeaderCell=isHeaderCell;element.getEditor=getEditor;element.setEditorFocus=setEditorFocus;element.getParentSpread=getParentSpread;element.GetActiveRow=getActiveRow;element.GetActiveCol=getActiveCol;element.addEventListener=function(b,a){this.attachEvent("on"+b,a)};element.removeEventListener=function(b,a){this.detachEvent("on"+b,a)};element.setColHeaderRowHeight=setColHeaderRowHeight;element.getColFooter=getColFooter;element.getFrozColFooter=getFrozColFooter;element.getFooterCorner=getFooterCorner;element.setRowHeaderColWidth=setRowHeaderColWidth;element.setRowHeight2=setRowHeight2;element.getPreferredRowHeight=getPreferredRowHeight;element.getPreferredCellWidth=getPreferredCellWidth;element.getCellEditorID=getCellEditorID;element.getCellEditor=getCellEditor;element.getRowHeightInternal=getRowHeightInternal;element.getRowHeightInternal2=getRowHeightInternal2;element.paintFocusRect=paintFocusRect;element.AddSpan=AddSpan;element.RemoveSpan=RemoveSpan;element.GetSheetIndex=GetSheetIndex;element.getTopSpread=getTopSpread;element.OpenWaitMsg=openWaitMsg;element.CloseWaitMsg=closeWaitMsg;element.inactiveAllChart=inactiveAllChart;element.RefreshChart=RefreshChart;element.GetActiveChartObj=GetActiveChartObj;element.SetActiveChartObj=SetActiveChartObj;element.getViewportSize=getViewPortSize;element.rowEditTemplateContainer_keyDown=rowEditTemplateContainer_keyDown;element.rowEditTemplateContainer_textBoxFocus=rowEditTemplateContainer_textBoxFocus;element.doGetFocus=doGetFocus;element.getAnchorCell=function(){return anchorCell};element.isEditing=function(){return editing};element.getEditingInfo=function(){return editing?{Editor:editor,EditingValue:editingValue,RenderAsEditor:renderAsEditor}:null};element.isHandleEvent=isHandleEvent;element.getSpreadJS=function(){return fpSpreadJS};element.isMVCSpread=function(){return mvc!=null&&mvc.inMvcFramework()};var q=b=="LoadOnDemand",v=false;if(spreadView==null||!q||error||spreadView.LoadOnDemandMode!="Background"&&spreadView.GetPendingRequestLength()==0){var A=q?spreadView.FilterEditors:null;spreadView&&spreadView.HideFloatingElements();spreadView=new GrapeCity.Web.Spread.SpreadView(element);v=spreadView.Parent!=null&&spreadView.Parent.ChildSpreadViews==null;spreadView.SyncData=syncData;q&&spreadView.SetFilterEditors(A)}element.getSpreadContext=getSpreadContext;element.getSpreadView=function(){return spreadView};element.findContentTag=findContentTag;element.getSelectionBlockOptions=function(){return selectionBlockOptions};v&&spreadView.Parent.LoadChildSpreadViews(true);if(element.virtualPaging=="true"){var w=window.document.getElementById(element.id+"_VirtualPaging_Top");if(w==null)element.virtualPagingTop=element.virtualTop=0;else element.virtualPagingTop=element.virtualTop=parseInt(w.style.height);if(element.virtualTop>0&&window.document.compatMode=="BackCompat")for(var h=[viewport0,viewport1,viewport2,viewport],f=0;f<h.length;f++)if(h[f]!=null&&(h[f].style.position==""||h[f].style.position=="static"))h[f].style.position="relative"}else element.virtualPagingTop=element.virtualTop=0;element.stopVirtualPaging=function(){ignoreVirtualPaging=true};element.startVirtualPaging=function(){ignoreVirtualPaging=false};if(spreadView.IsClientAutoSize()&&(spreadView.ClientAutoSizeMaxWidth()!=0||spreadView.ClientAutoSizeMaxHeight()!=0)&&getParentSpread()==null){var y=getScrollvp()||getViewport().parentNode;if(spreadView.HorizontalScrollBarPolicy()!="never")y.style.overflowX="hidden";if(spreadView.VerticalScrollBarPolicy()!="never")y.style.overflowY="hidden"}if(element.mcctCellType==null&&b!=null)fpSpreadJS.loadScriptResources(function(){initChartObj()&&element.initLayoutCompleted&&sizeSpread(true)});else initChartObj();if(typeof Sys!="undefined")element.SetCellValue=setCellValue;if(element.inDesign){element.getCellType=getCellType;element.getEditor=getEditor;element.getFunction=getFunction}if(spreadView.GetPendingRequestLength()==0){initSpan(getViewport0(),spanCells);initSpan(getViewport1(),spanCells);initSpan(getViewport2(),spanCells);initSpan(getViewport(),spanCells);initSpan(getColHeader(),colSpanCells);initSpan(getFrozColHeader(),colSpanCells);initSpan(getRowHeader(),rowSpanCells);initSpan(getFrozRowHeader(),rowSpanCells)}if(frzRows!=0||frzCols!=0){rowCount=0;if(getViewport1()!=null)rowCount+=getViewport1().rows.length;if(getViewport()!=null)rowCount+=getViewport().rows.length}window.document.detachEvent("onkeyup",keyup);window.document.attachEvent("onkeyup",keyup);window.document.detachEvent("onkeydown",translateKey);window.document.attachEvent("onkeydown",translateKey);window.document.detachEvent("onmousedown",setActiveSpread);window.document.attachEvent("onmousedown",setActiveSpread);element.attachEvent("onmousedown",mouseDown);element.attachEvent("onmouseup",mouseUp);element.attachEvent("onmouseout",mouseOut);element.attachEvent("onmousemove",mouseMove);element.attachEvent("onmouseover",mouseOver);element.attachEvent("ondblclick",dblclick);element.attachEvent("onpropertychange",propertyChanged);element.attachEvent("onresize",processResize);createFocusBorder();syncBorders();fpSpreadJS.countChildViews();if(tableData!=null&&getViewport()!=null){getViewport().parentElement.style.display="block";if(activeChartObj==null){initSelection();if(b!="LoadOnDemand"){var l=getCmdBtn("Update");updateCmdBtnState(l,true)}}}var p=FpSpreadJS.autoFocus!=null&&!$$.utils.contains(getTopSpread(element),FpSpreadJS.autoFocus);if(spreadView.GetPendingRequestLength()==0){initLayout(function(){u!=null&&u();spreadView._InitScrollbarState()},b,p);if(smartPaint){backUpStyleSetting();initSmartPaint();restoreStyleSetting()}}var i=null;if(tableData!=null&&getParentSpread()==null){var r=tableData.documentElement.selectSingleNode("/root/activespread");i=tableData.documentElement.selectSingleNode("/root/activechild");if(r!=null&&r.text!=""){if(window.document.FpActiveSheetView==null){var k=i!=null&&i.text!=""?i.text:"";if(k=="")k=r.text;if(k!="")window.document.FpActiveSheetView=window.document.getElementById(k)}if(getParentSpread()==null&&window.document.FpActiveSheetView!=null&&$$.utils.contains(element,window.document.FpActiveSheetView,true))window.document.FpActiveSheetView.initialized=false;var a=window.document.FpActiveSpread;if(a!=null&&!$$.utils.contains(window.document.body,a))window.document.FpActiveSpread=window.document.getElementById(a.id);var a=spreadView.GetActiveSpread();if(a!=null&&!$$.utils.contains(window.document.body,a))a=window.document.getElementById(a.id);if(a==null||$$.utils.contains(element,a,true))spreadView.ActivateSpread(window.document.FpActiveSheetView);else window.document.FpActiveSheetView=null;var z=getTopSpread(window.document.FpActiveSpread);z!=null&&z.getSpreadView()._HookDocumentFocusInEvent()}isactive=window.document.FpActiveSpread==element}if(smartPaint)newPageCount=getRowsPerPage(newTop);initialized=true;dirty=true;if(window.document.FpActiveSpread==element&&(element.AllowInsert=="false"||element.IsNewRow=="true")){var l=getCmdBtn("Insert");updateCmdBtnState(l,true);l=getCmdBtn("Add");updateCmdBtnState(l,true)}createTextbox();element.focus=focus;textBox.onactivate=textBoxActive;ignoreEditorFocus=true;!p&&doSetFocus(b);ignoreEditorFocus=false;element.onclickCell=onclickCell;element.UpdateRowHeight=UpdateRowHeight;element.onmousewheel=doMouseWheel;element.onactivate=spreadActive;element.blur=blur;allowColMove=element.colMove;allowGroup=element.allowGroup;createSizebar();syncColSelection();element.ajax=="false"&&fireOperationEndEvent();setTimeout(function(){ignoreVirtualPaging=false},100);element.initialized=true;fpSpreadJS.setImeMode(element,textBox,anchorCell);if(element.childViewsInitPending!=null){for(var G in element.childViewsInitPending){var F=element.childViewsInitPending[G];F()}element.childViewsInitPending=null}if(element.mcctCellType!=null){var s=FarPoint.System.WebControl.MultiColumnComboBoxCellType.GetMcctObject(element.id);if(s!=null){s.DetachEvents();s.AttachEvents()}}spreadView._DisableSpreadValidators();SPLController=new ClientSparklinesController(element);!spreadView.IsInitialized&&element.initLayoutCompleted&&doOnSpreadInitialized(b,p);if(element.__pendingDoGetFocus){element.setActiveField(true);element.doGetFocus();element.__pendingDoGetFocus=null}$$.j(element).trigger("SpreadInitialized")}function doOnSpreadInitialized(a,b){spreadView.OnSpreadInitialized(a);loadScrollbarState(element);if(!b){if(FpSpreadJS.autoFocus!=null&&isAllInitialized())if(window.parent!=window&&window.document.readyState!="complete")window.document.attachEvent("onreadystatechange",documentReadyStateChanged);else{var c=getTopSpread(element);window.document.FpActiveSpread==null&&c.focus(null,null,{FocusEditor:true,UpdateEditingInfo:true});FpSpreadJS.autoFocus=null}isactive&&editing&&editor!=null&&$$.utils.getDocActiveElement()!=editor&&setEditorFocus(editor)}if(a!=null){if(needDelayScrollView){needDelayScrollView=false;setTimeout(function(){scrollView("processData")},0)}setTimeout(function(){element.preventPopUp=false},0)}}function documentReadyStateChanged(){if(window.document.readyState=="complete"){var a=getTopSpread(element);window.document.FpActiveSpread==null&&a.focus();FpSpreadJS.autoFocus=null;window.document.detachEvent("onreadystatechange",documentReadyStateChanged)}}function doSetFocus(b){if(!isactive)return;if(typeof window.__smartNav=="undefined")try{if(b!="LoadOnDemand"){var c=anchorCell;focus(null,null,{EnsureTextBoxFocus:true,FocusSpreadOnly:true});if(b!="Update"&&c!=anchorCell&&anchorCell!=null){var d=getCmdBtn("Update");updateCmdBtnState(d,false)}}}catch(e){}if(b!="LoadOnDemand"&&anchorCell!=null&&anchorCell.getAttribute("RowEditTemplate")!="true"){var a=fpSpreadJS.GetInlineEditor(anchorCell);if(a!=null){editing=true;editor=a;renderAsEditor=1;editingValue=getEditorValue(a)}}}function getSpreadContext(){return element.Behavior}function frzRowCount(){return frzRows}function frzColCount(){return frzCols}function isWorking(){return working}function isInitialized(){return initialized&&element.initialized}function GetPageActiveSpread(){return window.document.FpActiveSpread}function setAnchorCell(a){anchorCell=a}function setActiveField(a){isactive=a}function syncBorders(){var f=[getFrozRowHeader(),getRowHeader()];$$.utils.cleanArray(f);for(var i=0;i<f.length;i++){var a=f[i];if(a!=null&&a.rows.length>0){for(var k=a.getAttribute("__defaultBackColor"),n=k!=null?k:a.currentStyle.borderColor,l=false,b=0;b<a.rows[0].cells.length;b++){var h=a.rows[0].cells[b],d=h.currentStyle,r=d.borderTopWidth,q=d.borderBottomWidth,t=d.borderTopStyle=="none"||parseInt(r)==0,s=d.borderBottomStyle=="none"||parseInt(q)==0;if(!t||!s){l=true;if(h.style.borderTopColor.length>0)n=h.style.borderTopColor;break}}if(l)a.style.borderTop="1px solid "+n}}for(var o=[getFrozColHeader(),getColHeader()],v=[getViewport0(),getViewport2()],w=[getViewport1(),getViewport()],u=[v,w],b=0;b<o.length;b++){var c=o[b],p=u[b];if(c)for(var j=0;j<p.length;j++){var e=p[j];if(e&&c.style.borderLeftWidth!=e.style.borderLeftWidth){if(!c.style.borderLeftStyle)c.style.borderLeftStyle=e.style.borderLeftStyle;c.style.borderLeftWidth=e.style.borderLeftWidth;break}}}if(spreadView.IsEnablejQueryTheme()){var m=spreadView.ColumnFooter.GrayArea;if(m)m.style.borderTopWidth="0px"}var g=getRowHeader();g&&g.rows.length>1&&spreadView.SyncBorderTop([g,getViewport(),getViewport2()]);spreadView.SyncBorderTop([getFrozRowHeader(),getViewport0(),getViewport1()])}function getIEMode(){if(window.document.documentMode)engine=window.document.documentMode;else{engine=5;if(window.document.compatMode)if(window.document.compatMode=="CSS1Compat")engine=7}}var ignoreScroll=false,ignoreMainScroll=false;function cheaderScroll(){if(ignoreScroll)return;var a=getParent(getViewport());if(a==null)return;a.scrollLeft=getParent(getColHeader()).scrollLeft;ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}function rheaderScroll(){if(ignoreScroll)return;var a=getParent(getViewport());if(a==null)return;if(a.fromScrollTo==true){a.fromScrollTo=false;return}a.scrollTop=getParent(getRowHeader()).scrollTop;scrollView()}function blur(){setActiveSpreadID(element,"","",false)}function isXHTML(){return window.document.compatMode&&window.document.compatMode=="CSS1Compat"}function createTextbox(){var b=getTopSpread(element);textBox=window.document.getElementById(b.id+"_textBox");if(textBox==null){var a=window.document.createElement("<div>");a.style.position="absolute";a.style.left=-100;a.style.overflow="hidden";textBox=window.document.createElement('<INPUT type="text">');textBox.style.position="absolute";textBox.style.borderWidth=0;textBox.style.top=10;textBox.style.left=-100;textBox.style.width=0;textBox.style.height=1;textBox.id=element.id+"_textBox";textBox.tabIndex=-1;a.insertBefore(textBox);element.insertBefore(a)}updateTabIndex()}function updateTabIndex(){var a=getTopSpread(element);if(a==element){if(element.tabIndex>=0){textBox.tabIndex=element.tabIndex;element.tabIndex=-1}}else if(element.tabIndex!=null)element.tabIndex=-1}var isactive=true;function textBoxBlur(){if(!ignoreBlur){isactive=false;if(!retainSelectionBlock){paintAnchorCell();paintSelections(false);paintAnchorCellHeader(false);hideFocusBorder()}}}function hideFocusBorder(){var a=window.document.getElementById(element.id+"_focusRectT");if(a==null)return;a.style.left="-1000px";a.style.width="0px";var b=element.id;a=window.document.getElementById(b+"_focusRectB");a.style.left="-1000px";a.style.width="0px";a=window.document.getElementById(b+"_focusRectL");a.style.left="-1000px";a.style.width="0px";a=window.document.getElementById(b+"_focusRectR");a.style.left="-1000px";a.style.width="0px"}function getSizeHeader(){var a=getTopSpread(element);return a.sizeHeader!=null}function createLineBorder(b){var a=window.document.getElementById(b);if(a==null){a=window.document.createElement("img");a.style.position="absolute";a.style.left="-1000px";a.style.top="0px";a.style.overflow="hidden";a.style.border="1px solid black";if(element.FocusBorderColor!=null)a.style.borderColor=element.FocusBorderColor;if(element.FocusBorderStyle!=null)a.style.borderStyle=element.FocusBorderStyle;a.id=b;var c=getViewport().parentNode;c.insertBefore(a,null)}return a}function createFocusBorder(){if(frzRows>0||frzCols>0)return;if(getTopSpread().hierView=="true")return;if(element.showFocusRect=="false")return;if(getViewport()==null)return;var b=element.id,a=createLineBorder(b+"_focusRectT");a.style.height=0;a=createLineBorder(b+"_focusRectB");a.style.height=0;a=createLineBorder(b+"_focusRectL");a.style.width=0;a=createLineBorder(b+"_focusRectR");a.style.width=0}function createSizebar(){sizeBar=window.document.getElementById(element.id+"_sizeBar");var a=getSizeHeader();if(sizeBar==null&&(a||frzRows>0||frzCols>0)){sizeBar=window.document.createElement("<img/>");sizeBar.style.position="absolute";sizeBar.style.borderWidth=1;sizeBar.style.top=0;sizeBar.style.left=-400;sizeBar.style.width=2;sizeBar.style.height=2;sizeBar.style.background="black";sizeBar.style.zIndex=1e3;sizeBar.id=element.id+"_sizeBar";element.insertBefore(sizeBar)}}var posIndicator=null;function getPosIndicator(){if(posIndicator==null)createPosIndicator();else posIndicator.parentNode!=element&&element.insertBefore(posIndicator);return posIndicator}function createPosIndicator(){posIndicator=window.document.getElementById(element.id+"_posIndicator");if(posIndicator==null){posIndicator=window.document.createElement("<img/>");posIndicator.style.position="absolute";posIndicator.style.borderWidth=1;posIndicator.style.top=0;posIndicator.style.left=-400;posIndicator.style.width=10;posIndicator.style.height=10;posIndicator.style.zIndex=1e3;posIndicator.id=element.id+"_posIndicator";if(element.clienturl!=null)posIndicator.src=element.clienturl+"down.gif";else posIndicator.src=element.clienturlres;element.insertBefore(posIndicator)}}function initSpan(b,i,h){var j=h||0;if(b!=null){if(b==getViewport())rowCount=b.rows.length;for(var f=b.rows,k=GetColCount(),c=j;c<f.length;c++)if(IsChildSpreadRow(b,c)){if(b==getViewport())rowCount--}else for(var e=f(c).cells,d=0;d<e.length;d++){var a=e(d);if(a!=null&&a.FpSpread!="rowpadding"&&(a.rowSpan!=null&&a.rowSpan>1||a.colSpan!=null&&a.colSpan>1)){var l=getRowFromCell(a),g=parseInt(a.scol);g<k&&AddSpan(l,g,a.rowSpan,a.colSpan,i)}}}}function getColWithSpan(e,a,d){var f=0,c=0;if(d==0)while(isCovered(e,c,a))c++;for(var b=0;b<a.length;b++)if(a[b].rowCount>1&&(a[b].col<=d||d==0&&a[b].col<c)&&e>=a[b].row&&e<a[b].row+a[b].rowCount)f+=a[b].colCount;return f}function AddSpan(f,e,d,c,a){if(a==null)a=spanCells;var b=new Range;setRange(b,"Cell",f,e,d,c);a.push(b);paintFocusRect()}function RemoveSpan(g,f,a){if(a==null)a=spanCells;for(var b=0;b<a.length;b++){var d=a[b];if(d.row==g&&d.col==f){for(var e=a.length-1,c=b;c<e;c++)a[c]=a[c+1];a.length=a.length-1;break}}paintFocusRect()}function onclickCell(){mouseDown()}function setTextBoxFocus(){if(spreadView!=null&&spreadView.IsSuspendFocusSpread())return;textBox!=null&&textBox.document!=null&&textBox.focus()}function suspendVirtualScrollPaging(){ignoreVirtualPaging=true}function restoreVirtualScrollPaging(){setTimeout(function(){ignoreVirtualPaging=false},0)}function setAnchorCellForFirstTime(a){var k=GetColCount(),l=GetRowCountInternal(),d=a&&a.type=="keydown"&&a.keyCode==tab,b=getNextCellRowIndex(0,0,d,true),h=needScrollToTopRow?spreadView.GetAttribute("topRow"):null;if(b>=frzRows&&h!=null){var g=frzRows+spreadView._GetKeyedTableRowIndex(h,true);if(b<g)b=getNextCellRowIndex(g,0,d,true)}var e=getNextCellColIndex(0,0,d,true);if(b<l&&e<k){var f=fireActiveCellChangingEvent(b,e,element,0),c=getTopSpread(element);if(!f)if(c!=element)f=c.Behavior.fireActiveCellChangingEvent(b,e,element,0);if(!f){!(element.OperationMode=="Normal"&&(element.SelectionPolicy=="MultiRange"&&element.multiRange=="true"||element.SelectionPolicy=="Range"))&&ClearSelection();leadingCellRow=b;leadingCellCol=e;updateAnchorCell(leadingCellRow,leadingCellCol);var i=d&&(c.ProcessTab=="true"||c.ProcessTab=="True")&&getCellFromRowCol(leadingCellRow,leadingCellCol)!=null&&getCellFromRowCol(leadingCellRow,leadingCellCol).TabStop!=null&&getCellFromRowCol(leadingCellRow,leadingCellCol).TabStop=="false";i&&!editing&&nextCell(a.keyCode);enableButtons();var j=getCmdBtn("Update");updateCmdBtnState(j,false);if(a&&a.srcElement!=null&&a.srcElement.tagName=="SELECT")ignorePostbackEditmode=true;fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0);c!=element&&c.Behavior.fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0);if(a&&a.srcElement!=null&&a.srcElement.tagName=="SELECT")ignorePostbackEditmode=false}}}function spreadActive(h){needCheckSelectText=false;textBoxActive(h);var f=window.document,a=spreadView.GetActiveSpreadView(false,true)||spreadView,d=a.Spread,e=d.getAnchorCell(),c=a.GetSpreadContext();if(e!=null&&isPressTABKeyFromOutSide&&!a.IsPopupOpened()&&d.GetActiveChartObj()==null&&a.GetTabIndex()!="-1"){a.GetActiveSpread()==null&&a.ActivateSpread(d);var b=c.getEditor(e);if(b!=null){if(f.activeElement!=b)if(b.tagName=="INPUT"&&b.type=="submit")setTimeout(function(){c.setEditorFocus(b)},0);else c.setEditorFocus(b)}else if(f.activeElement!=textBox){var g=c.getCell(f.activeElement);g!=null&&g!=e&&c.focus2()}}isPressTABKeyFromOutSide=false}function detachActiveEvents(){element.onactivate=null;textBox.onactivate=null}function attachActiveEvents(){element.onactivate=spreadActive;textBox.onactivate=textBoxActive}function textBoxActive(event){if(!event)event=window.event;var _doc=window.document;if(_doc.PreviousActiveSpread!=null&&_doc.PreviousActiveSpread!=_doc.FpActiveSpread){_doc.PreviousActiveSpread.getSpreadView().OnSpreadLostActive();_doc.PreviousActiveSpread=null}if(ignoreChange||ignoreElementActive)return;if(activeChartObj!=null)return;if(window.document.FpActiveSpread==element&&editor!=null&&editor.getAttribute("FpEditor")=="ExtenderEditor"&&window.event&&isChild(window.event.srcElement,editor))return;if(element.__cancelActive){element.__cancelActive=null;return}var ignoreFocus=spreadView!=null&&!spreadView.OnSetTextBoxFocus(event);isactive=true;!ignoreFocus&&!ignoreBlur&&editModePermanent&&doGetFocus();var ts=getTopSpread(element),as=spreadView.GetActiveSpread();as!=null&&window.event!=null&&spreadView.IsFilterBarTextBox(window.event.srcElement)&&getTopSpread(as)!=ts&&as.isEditing()&&as.EndEdit();var spreadData=eval(ts.id+"_XMLDATA"),activeChild=spreadData.documentElement.selectSingleNode("/root/activechild");try{if(activeChild!=null&&activeChild.text!=""){var domChildSpread=window.document.getElementById(activeChild.text);spreadView.ActivateSpread(domChildSpread!=null?domChildSpread:element,true)}else spreadView.ActivateSpread(ts,true)}catch(e){spreadView.ActivateSpread(ts,true)}getTopSpread(window.document.FpActiveSpread).getSpreadView()._HookDocumentFocusInEvent();setActiveSpreadID(ts,element.id,window.document.FpActiveSpread.id);fpSpreadJS.setImeMode(element,textBox,anchorCell);if(window.document.FpActiveSpread!=element)return;if(!editing&&enableRowEditTemplate=="true"&&operationMode=="RowMode")editing=IsInRowEditTemplate(window.event.srcElement);var opm=operationMode;if(!GCWS.FilterEditor.IsFilterControl(window.document.activeElement)&&anchorCell==null&&opm!="MultiSelect"&&opm!="ExtendedSelect"&&GetRowCount()>0&&GetColCount()>0)setAnchorCellForFirstTime(window.event);else if(window.event.srcElement==element)!ignoreFocus&&setTextBoxFocus();if(retainSelectionBlock||window.document.FpActiveSpread==element){paintAnchorCell();if(!ignorePaintSelection){ignorePaintSelection=true;paintSelections(true);ignorePaintSelection=false}else paintSelections(true)}var ot=getOffsetTop(element,window.document.body),ol=getOffsetLeft(element,window.document.body),needVScroll=ot+element.clientHeight<window.document.body.scrollTop||ot>window.document.body.scrollTop+window.document.body.clientHeight;if(xhtml)needVScroll=ot+element.clientHeight<window.document.body.parentNode.scrollTop||ot>window.document.body.parentNode.scrollTop+window.document.body.parentNode.clientHeight;if(needVScroll)if(xhtml)window.document.body.parentNode.scrollTop=ot;else window.document.body.scrollTop=ot;var needHScroll=ol+element.clienWidth<window.document.body.scrollLeft||ol>window.document.body.scrollLeft+window.document.body.clientWidth;if(xhtml)needHScroll=ol+element.clienWidth<window.document.body.parentNode.scrollLeft||ol>window.document.body.parentNode.scrollLeft+window.document.body.parentNode.clientWidth;if(needHScroll)if(xhtml)window.document.body.parentNode.scrollLeft=ol;else window.document.body.scrollLeft=ol;if(engine==8){ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}if(spreadView.IsInFilterBar(event.srcElement)&&!$$.utils.isNativeControl(window.document.activeElement)){var fe=spreadView.GetFilterBarEditor(event.srcElement);fe!=null&&fe.Behavior&&fe.Behavior.TextBox!=null&&event.srcElement!=fe.Behavior.DatePickerButton&&event.srcElement!=fe.Behavior.DropDownButton&&setTimeout(function(){$$(fe.Behavior.TextBox).focus()},0)}}function selectAllText(d,c){if(anchorCell==null)return;var a=d||getEditor(anchorCell);if(a!=null&&a.select){if(!c){var b=a.getValue?a.getValue():a.value;if(a.setValue){a.setValue("");a.setValue(b)}else{a.value="";a.value=b}}try{var e=a.tagName=="INPUT"&&(a.type=="button"||a.type=="submit");!e&&a.select()}catch(f){}}}function focus2(){if(textBox!=null){textBox.onactivate=null;element.onactivate=null;setTextBoxFocus();textBox.onactivate=textBoxActive;element.onactivate=spreadActive}}function isEditModeReplace(b){var a=getCellType(b);return a=="ExtenderCellType"?false:element.EditMode=="replace"}function focus(e,keepCurrentSelection,args){if(spreadView&&!spreadView.OnSetTextBoxFocus(window.event))return;var ts=getTopSpread(element),spreadData=eval(ts.id+"_XMLDATA"),activeChild=spreadData.documentElement.selectSingleNode("/root/activechild");if(activeChild!=null&&activeChild.text!=""){var activeSpread=window.document.getElementById(activeChild.text);if(activeSpread!=null&&activeSpread!=element){activeSpread.focus(null,null,args);return}}var as=window.document.FpActiveSpread;if(as!=null&&!as.IsValid())return;var selectText=event!=null&&element==getSpreadControl(event.srcElement)&&isEditModeReplace(anchorCell)&&(!args||args.SelectText);if(editing&&selectText){selectAllText();selectText=false}if(editing)return;if(event!=null&&(event.type=="mousedown"||event.type=="mouseup")){var hit=getSpreadControl(event.srcElement);if(hit!=element)return;if(event.srcElement.tagName=="INPUT"||event.srcElement.tagName=="SELECT"||event.srcElement.tagName=="TEXTAREA")return}if(activeChartObj!=null){doClearSelection();ignoreVirtualPaging=true;activeChartObj.container.focus();ignoreVirtualPaging=false;return}if(window.document.FpActiveSpread!=element){spreadView.ActivateSpread(element);getTopSpread(element).getSpreadView()._HookDocumentFocusInEvent()}var opm=operationMode;if(anchorCell==null&&opm!="MultiSelect"&&opm!="ExtendedSelect"&&GetRowCount()>0&&GetColCount()>0){var cc=GetColCount(),rc=GetRowCountInternal(),_checktab=event&&event.type=="keydown"&&event.keyCode==tab,nextRow=getNextCellRowIndex(0,0,_checktab,true),topRowKey=needScrollToTopRow?spreadView.GetAttribute("topRow"):null;if(nextRow>=frzRows&&topRowKey!=null){var topRowIndex=frzRows+spreadView._GetKeyedTableRowIndex(topRowKey,true);if(nextRow<topRowIndex)nextRow=getNextCellRowIndex(topRowIndex,0,_checktab,true)}var nextCol=getNextCellColIndex(0,0,_checktab,true);if(nextRow<rc&&nextCol<cc){var f=fireActiveCellChangingEvent(nextRow,nextCol,element,0),ts=getTopSpread(element);if(!f)if(ts!=element)f=ts.Behavior.fireActiveCellChangingEvent(nextRow,nextCol,element,0);if(!f){element.inDesign&&doClearSelection();var canUpdateAnchorCell=!element._processingFilterBarCommand;leadingCellCol=nextCol;leadingCellRow=nextRow;canUpdateAnchorCell&&updateAnchorCell(leadingCellRow,leadingCellCol);enableButtons();if(canUpdateAnchorCell){fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0);ts!=element&&ts.Behavior.fireActiveCellChangedEvent(leadingCellRow,leadingCellCol,element,0)}}}}var checkbox=null,focusSpreadOnly=args==null?false:!args.FocusEditor&&args.FocusSpreadOnly;if((!args||args.FocusEditor)&&anchorCell!=null){checkbox=spreadView._GetViewportFromCell(anchorCell,false)!=null?getEditor(anchorCell):null;if(checkbox!=null&&(e==null||e.type=="mouseup"&&checkbox.getAttribute("Extenders")==null||editing)){if(spreadView.IsShowEditor(anchorCell)&&isChild(window.document.activeElement,anchorCell))checkbox=null}else{checkbox=null;focusSpreadOnly=true}}if(checkbox!=null||focusSpreadOnly){setTextBoxFocus();args!=null&&args.EnsureTextBoxFocus&&window.document.activeElement!=null&&window.document.activeElement.tagName=="BODY"&&setTextBoxFocus();if(!ignoreEditorFocus&&!focusSpreadOnly){if(checkbox!=null&&args&&args.UpdateEditingInfo){editing=true;editor=checkbox;renderAsEditor=1;editingValue=getEditorValue(editor)}setEditorFocus(checkbox)}}selectText&&selectAllText();enableButtons()}function GetTotalRowCount(){return parseInt(element.totalRowCount)}function GetPageCount(){return parseInt(element.pageCount)}function GetColCount(){return frzCols+parseInt(element.ColCount)}function GetRowCount(){return rowCount}function GetRowCountInternal(){return frzRows+parseInt(element.RowCount)}function IsChildSpreadRow(a,b){return FpSpreadJS.isChildSpreadRow(a,b)}function GetChildSpread(e,c){var b=getViewport();if(b!=null){var a=GetDisplayIndex(e)+1;if(typeof c=="number")a+=c;if(a>=0&&a<b.rows.length)if(b.rows(a).cells.length>0&&b.rows(a).cells(0)!=null&&b.rows(a).cells(0).children.length>0){var d=b.rows(a).cells(0).children(0);if(d.FpSpread=="Spread")return d}}return null}function GetChildSpreads(b){var a=window.document;if(!a.getElementById)a=window.document;var c=b==null?element:a.getElementById(b);return c==null?null:FpSpreadJS.getChildViews(c)}function GetDisplayIndex(a){return fpSpreadJS.getDisplayIndex(a)}function GetSheetIndex(b,a){return a!=null&&getViewport()!=a?getSpreadControl(a,true).GetSheetIndex(b):fpSpreadJS.getSheetIndex(b)}function GetParentRowIndex(){var c=getParentSpread();if(c==null)return-1;var b=window.document.getElementById(c.id+"_viewport");if(b==null)return-1;for(var d=element.parentElement.parentElement,a=d.rowIndex-1;a>0;a--)if(IsChildSpreadRow(b,a))continue;else break;return GetSheetIndex(a,b)}function SizeToFit(a,d){if(a==null||a<0)a=0;var g=getViewport();if(g!=null){for(var i=createTestBox(),b=0,j=GetRowCountInternal(),c=0;c<j;c++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(g,c))continue;var f=getCellFromRowCol(c,a);if(d)f=getHeaderCellFromRowCol(c,a,false);if(f.colSpan>1)continue;var h=spreadView._getPreferredCellWidth(f,i);if(h>b)b=h}var e=false;if(d)e=setRowHeaderColWidth(a,b);else e=setColWidth(a,b);e&&fireColWidthChangedEvent(d,a,b)}}function getPreferredCellWidth(c,b){if(b==null)b=createTestBox();var a=getRender(c),e=getCellType(c),o=getEditor(c);if(a!=null){b.style.fontFamily=a.currentStyle.fontFamily;b.style.fontSize=a.currentStyle.fontSize;b.style.fontWeight=a.currentStyle.fontWeight;b.style.fontStyle=a.currentStyle.fontStyle}$$.utils.removeBackgroundImages(c,true);b.style.width=null;if(a!=null&&a.tagName=="SELECT"){for(var h="",g=0;g<a.children.length;g++){var f=a.children[g];if(f.text!=null&&f.text.length>h.length)h=f.text}b.innerHTML=h}else if(a!=null&&a.tagName=="INPUT")if(a.type=="submit")b.innerHTML=a.outerHTML;else b.innerHTML=a.value;else{var n=c.getElementsByTagName("TABLE");if(n!=null&&n.length>0)b.style.width=20;if(c.FpCellType=="ExtenderCellType"&&a!=null&&a.getAttribute("cfContentBound")==null&&c.getElementsByTagName("DIV").length>0){var l=getEditor(c),m=getFunction("ExtenderCellType_getEditorValue");if(l!=null&&m!=null)b.innerHTML=m(l)}else if(a!=null&&a.tagName!="TABLE")b.innerHTML=a.innerHTML;else b.innerHTML=c.innerHTML}$$.utils.restoreBackgroundImages(c,b);if(a!=null&&e=="MultiColumnComboBoxCellType"){var j=b.getElementsByTagName("Table")[0];if(j!=null){j.style.tableLayout="";b.style.width=b.offsetWidth+3+"px"}}if(a!=null&&e=="ListBoxCellType"){var k=b.getElementsByTagName("Table")[0];if(k!=null){k.style.width="";b.style.width=""}}if(a!=null&&e=="RadioButtonListCellType"){var i=b.getElementsByTagName("Table")[0];if(i!=null){i.style.width="";b.style.width=""}}var d=b.offsetWidth+4;if(!xhtml)d+=parseInt(c.currentStyle.paddingLeft)+parseInt(c.currentStyle.paddingRight);d+=3;if(a!=null&&a.tagName=="SELECT")d+=24;return d}function getGroupBar(){if(groupBar==null)groupBar=window.document.getElementById(element.id+"_groupBar");return groupBar}function getHierBar(){if(hierBar==null)hierBar=window.document.getElementById(element.id+"_hierBar");return hierBar}function getPager1(){if(pager1==null)pager1=window.document.getElementById(element.id+"_pager1");return pager1}function getPager2(){if(pager2==null)pager2=window.document.getElementById(element.id+"_pager2");return pager2}function getDummy(){if(dummy==null)dummy=window.document.getElementById(element.id+"_dummy");return dummy}function getViewportHolder(){if(vpholder==null)vpholder=window.document.getElementById(element.id+"_vpholder");return vpholder}function getMaxCellHeight(b){for(var c=0,a=0;a<b.cells.length;a++)if(b.cells[a].rowSpan==1&&b.cells[a].style.display!="none"){var d=b.cells[a].offsetHeight;if(d>c)c=d}return c}function getFirstNonSpanCell(b){var a=null;if(b.cells.length>0){a=b.cells(0);var c=1;while(a.rowSpan>1&&c<b.cells.length){a=b.cells(c);c++}if(a.rowSpan>1)a=null}return a}function skipRowSpan(b){for(var c=false,a=0;a<b.cells.length;a++)if(b.cells[a].rowSpan>1&&b.cells[a].style.display!="none"||c){b.cells[a].savedRowSpan=b.cells[a].rowSpan;b.cells[a].rowSpan=1}}function restoreRowSpan(b){for(var a=0;a<b.cells.length;a++)if(b.cells[a].savedRowSpan!=null){b.cells[a].rowSpan=b.cells[a].savedRowSpan;b.cells[a].savedRowSpan=null}}function sync2Tables(a,c,e,h){if(a==null||c==null)return;var d=current,f=a.rows.length;if(smartPaint&&a==getRowHeader())f=Math.min(currentCount,c.rows.length);else d=0;for(var g=a==getCorner(),b=0;b<f;b++){if(a.rows[d+b]==null||c.rows[d+b]==null)return;if(!g)synRowHeight(a,c,d+b,e,h);else synRowHeight(a,c,b,e)}}function sync3Tables(a,c,b,d){if(ignoreSynRowHeight)return;if(a==null&&c==null&&b==null)return;var e=a==getRowHeader()||a==getFrozRowHeader();if(a==null)sync2Tables(c,b);else if(c==null)sync2Tables(a,b,d,e);else if(b==null)sync2Tables(a,c,d,e);else{var i=[a,c,b],g=current,h=a.rows.length;if(smartPaint&&(a==getRowHeader()||b==getViewport()))h=Math.min(currentCount,b.rows.length);else g=0;for(var f=0;f<h;f++)syncRowsHeight(i,g+f,d,e)}}function syncRowsHeight(b,c,k,l){for(var e=0,g=-1,h=Number.MAX_VALUE,a=0;a<b.length;a++)if(b[a].rows(c)!=null){var f=getOffsetHeight(b[a].rows(c))+b[a].rows(c).offsetTop;if(f>e){e=f;g=a}if(h>f)h=f}if(!smartPaint)for(var a=0;a<b.length;a++)if(c+1<b[a].rows.length&&b[a].rows(c+1).cells.length<b[a].cols)if(getOffsetHeight(b[a].rows(c))>parseInt(b[a].rows(c).style.height))b[a].rows(c).style.height=getOffsetHeight(b[a].rows(c))+"px";if(e!=h)for(var d=null,a=0;a<b.length;a++)if(a!=g&&(d=b[a].rows(c))!=null&&d.getAttribute("FpSpread")!="fb"){var j=0;if(b[g].rows(c).offsetTop>d.offsetTop)j=.01;setTableRowHeight(d,e,l&&a==0,j)}else if(a==g&&(d=b[a].rows(c))!=null&&getFirstNonSpanCell(d)==null){d.style.posHeight=e-d.offsetTop;if(getOffsetHeight(d)+d.offsetTop>e)d.style.posHeight-=getOffsetHeight(d)+d.offsetTop-e}for(var a=0;a<b.length;a++)if(!xhtml&&b[a].rows(c)!=null&&b[a].rows(c).style.posHeight<0)b[a].rows(c).style.posHeight=0;if(k){var i=getParentSpread();i!=null&&i.UpdateRowHeight(element)}}function layoutSpanRows(){if(spanCells.length==0&&rowSpanCells.length==0)return;for(var j=[],k=[],d=[],i=spanCells.concat(rowSpanCells),a=0;a<i.length;a++){if(i[a].rowCount==1)continue;for(var h=false,e=0;e<d.length;e++)if(a==d[e]){h=true;break}if(h)continue;for(var b=null,c=a;c<i.length;c++){var g=i[c],f=new GCWS.CellRange(g.row,g.col,g.rowCount,g.colCount);if(c==a){d.push(c);b=f;continue}if(g.rowCount==1)continue;for(var h=false,e=0;e<d.length;e++)if(d[e]==c){h=true;break}if(h)continue;if(Math.max(b.Row,f.Row)<=Math.min(b.Row+b.RowCount-1,f.Row+f.RowCount-1)){d.push(c);b=b.UnionWith(f)}}j.push(b)}for(var a=0;a<j.length;a++)layoutRange(j[a])}function layoutRange(a){var d=a.Row<frzRows?[getFrozRowHeader(),getViewport0(),getViewport1()]:[getRowHeader(),getViewport2(),getViewport()];$$.utils.cleanArray(d);for(var c=a.Row<frzRows?a.Row:a.Row-frzRows,e=c+a.RowCount-1,b=c;b<=e;b++)syncRowsHeight(d,b)}function checkIntersectWithSpan(e){for(var b=Number.MAX_VALUE,c=0,d=0;d<spanCells.length;d++){var a=spanCells[d];if(new GCWS.CellRange(a.row,a.col,a.rowCount,a.colCount).IsIntersectWith(e,-1,1,-1)){b=Math.min(a.row,b);c=Math.max(a.row+a.rowCount-1,c)}}return b!=Number.MAX_VALUE?new GCWS.CellRange(b,-1,c-b+1,-1):null}function setTableRowHeight(a,c,d,e){var b=getFirstNonSpanCell(a);if(b!=null){b.style.posHeight=c-a.offsetTop-e;if(getOffsetHeight(a)+a.offsetTop>c)b.style.posHeight-=getOffsetHeight(a)+a.offsetTop-c;if(d&&b.style.posHeight<getOffsetHeight(a)){var f=b.innerHTML;b.innerHTML="";b.innerHTML=f}}else{a.style.posHeight=c-a.offsetTop;if(getOffsetHeight(a)+a.offsetTop>c)a.style.posHeight-=getOffsetHeight(a)+a.offsetTop-c}}function synRowHeight(h,i,e,l,m){if(h==null||i==null)return;var a=h.rows(e),b=i.rows(e),c=getRowOffsetHeight(h,e)+a.offsetTop,g=getRowOffsetHeight(i,e)+b.offsetTop;if(g>c){var f=getFirstNonSpanCell(a);if(f!=null){f.style.posHeight=g-a.offsetTop;var d=getRowOffsetHeight(h,e);if(d+a.offsetTop>g)f.style.posHeight-=d+a.offsetTop-g;if(m&&f.style.posHeight<getRowOffsetHeight(h,e)){var n=f.innerHTML;f.innerHTML="";f.innerHTML=n}}else{a.style.posHeight=g-a.offsetTop;var d=getRowOffsetHeight(h,e);if(d+a.offsetTop>g)a.style.posHeight-=d+a.offsetTop-g}}else if(c>g){var j=getFirstNonSpanCell(b);if(j!=null){j.style.posHeight=c-b.offsetTop;if(a.offsetTop>b.offsetTop)j.style.posHeight-=.01;var d=getRowOffsetHeight(i,e);if(d+b.offsetTop>c)j.style.posHeight-=d+b.offsetTop-c}else{b.style.posHeight=c-b.offsetTop;var d=getRowOffsetHeight(i,e);if(d+b.offsetTop>c)b.style.posHeight-=d+b.offsetTop-c}var f=getFirstNonSpanCell(a);if(f==null){a.style.posHeight=c-a.offsetTop;var d=getRowOffsetHeight(h,e);if(d+a.offsetTop>c)a.style.posHeight-=d+a.offsetTop-c}}if(!xhtml&&a.style.posHeight<0)a.style.posHeight=0;if(!xhtml&&b.style.posHeight<0)b.style.posHeight=0;if(l){var k=getParentSpread();k!=null&&k.UpdateRowHeight(element)}}function getMaxRowSpanInRow(a){if(a==null)return 0;for(var c=1,b=0;b<a.cells.length;b++)if(a.cells[b].rowSpan>1&&a.cells[b].rowSpan>c)c=a.cells[b].rowSpan;return c}function getOffsetHeight(a){for(var c=a.offsetHeight,e=false,b=0;b<a.cells.length;b++)if(a.cells[b].rowSpan==1){c=a.cells[b].offsetHeight;e=true;break}if(!e)if(a.cells.length>0){var d=window.document.createElement("<td>");a.insertBefore(d,null);c=d.offsetHeight;a.removeChild(d)}return c}function sizeFrozHeader(b,c){for(var a=0;a<b.childNodes.length&&a<c.childNodes.length;a++){var d=b.childNodes[a].offsetWidth,e=c.childNodes[a].offsetWidth;if(engine==8){d=parseInt(b.childNodes[a].width);e=parseInt(c.childNodes[a].width)}if(d>e){var f=parseInt(c.childNodes[a].width)+(d-e);c.childNodes[a].width=f}else{var f=parseInt(b.childNodes[a].width)+(e-d);b.childNodes[a].width=f}}}function sizeColHeader(f,e,h,g){for(var a=0;a<f.childNodes.length&&a<e.childNodes.length;a++){if(typeof element.getAttribute("mcctCellType")!="undefined"&&element.getAttribute("mcctCellType")=="true")e.childNodes[a].width=1;var c=parseInt(f.childNodes[a].width);if(isNaN(c)){if(g)continue;c=1}var d=parseInt(e.childNodes[a].width);if(isNaN(d)){if(g)continue;d=1}if(c>d){var b=parseInt(e.childNodes[a].width);if(isNaN(b))b=d;b+=c-d;e.childNodes[a].width=b}else{var b=parseInt(f.childNodes[a].width);if(isNaN(b))b=c;b+=d-c;f.childNodes[a].width=b}}}function sizeFrozFooter(b,c){for(var a=0;a<b.childNodes.length&&a<c.childNodes.length;a++){var d=b.childNodes[a].offsetWidth,e=c.childNodes[a].offsetWidth;if(engine==8){d=parseInt(b.childNodes[a].width);e=parseInt(c.childNodes[a].width)}if(d>e){var f=parseInt(c.childNodes[a].width)+(d-e);c.childNodes[a].width=f}else{var f=parseInt(b.childNodes[a].width)+(e-d);b.childNodes[a].width=f}}}function sizeColFooter(d,c,g){for(var a=0;a<d.childNodes.length&&a<c.childNodes.length;a++){var e=d.childNodes[a].offsetWidth,f=c.childNodes[a].offsetWidth;if(engine==8){e=parseInt(d.childNodes[a].width);f=parseInt(c.childNodes[a].width)}if(e>f){var b=parseInt(c.childNodes[a].width);if(isNaN(b))b=f;b+=e-f;if(getViewport().cellSpacing==0&&!g)if(getParentSpread()==null&&a==c.childNodes.length-1)c.childNodes[a].width=b+1;else c.childNodes[a].width=b;else c.childNodes[a].width=b}else{var b=parseInt(d.childNodes[a].width);if(isNaN(b))b=e;b+=f-e;if(getViewport().cellSpacing==0&&!g)if(getParentSpread()==null&&a==c.childNodes.length-1)d.childNodes[a].width=Math.max(b-1,1);else d.childNodes[a].width=b;else d.childNodes[a].width=b}}}function sizeRowHeader(f,c){for(var a=0;a<f.childNodes.length&&a<c.childNodes.length;a++){var e=f.childNodes[a].offsetWidth,d=c.childNodes[a].offsetWidth;if(d>=e){var b=parseInt(c.childNodes[a].width);if(isNaN(b))b=d;b-=d-e;c.childNodes[a].width=b}else{var b=parseInt(c.childNodes[a].width);if(isNaN(b))b=d;b+=e-d;c.childNodes[a].width=b}}}function setRowHeaderColWidth(b,a){var c=getRowHeader(),i=getCorner();if(c==null)return false;var n=false;if(a>element.clientWidth)a=Math.max(element.clientWidth-10,10);var d=getColGroup(c),o=b;if(element.layoutMode&&d&&parseInt(b)>=d.childNodes.length)b=d.childNodes.length-1+"";var e=a-parseInt(d.childNodes[b].width);d.childNodes[b].width=a;var h=getFrozRowHeader();if(h!=null){var d=getColGroup(h);d.childNodes[b].width=a;h.parentElement.style.posWidth+=e}c.parentElement.style.posWidth+=e;if(i!=null){i.parentElement.style.posWidth+=e;var g=getColGroup(i);if(g!=null)if(i.allowTableCorner)g.children[b].width=a;else g.children[0].width=parseInt(g.children[0].width)+e}var m=getFooterCorner();if(m!=null)m.parentElement.style.posWidth+=e;var l=c.parentElement.parentElement.parentElement.parentElement.parentElement;if(h!=null)l=l.parentElement.parentElement.parentElement.parentElement;var q=l.rows(0).cells(0);q.style.width=c.parentElement.style.posWidth-parseInt(c.cellSpacing);var k=getColGroup(element.getElementsByTagName("TABLE")[0]);if(k!=null)k.childNodes[0].width=parseInt(k.childNodes[0].width)+e;sizeSpread();if(element.layoutMode&&o)b=o;var j=addColInfo(b,true);if(j!=null){var f=j.selectSingleNode("./width");if(f==null){f=tableData.createNode("element","width","");j.appendChild(f)}if(xhtml)a+=2;n=f.text!=a;f.text=a}var p=getCmdBtn("Update");p!=null&&updateCmdBtnState(p,false);dirty=true;return n}function setColHeaderRowHeight(h,b){var f=getColHeader();if(f==null)return;var e=f.rows(h);e.style.posHeight=b;var a=getFirstNonSpanCell(e);if(a!=null)a.style.posHeight=b;f.style.height="";var c=getFrozColHeader();if(c!=null){e=c.rows(h);e.style.height=b;var a=getFirstNonSpanCell(e);if(a!=null){var k=parseInt(a.currentStyle.paddingTop.replace("px",""))+parseInt(a.currentStyle.borderTopWidth.replace("px","")),j=parseInt(a.currentStyle.paddingBottom.replace("px",""))+parseInt(a.currentStyle.borderBottomWidth.replace("px","")),l=b-(k+j);a.style.posHeight=Math.max(l,0)}c.style.height=""}sizeSpread();f.style.height="100%";if(c!=null)c.style.height="100%";var g=addRowInfo(h,true);if(g!=null){var d=g.selectSingleNode("./height");if(d!=null)d.text=b;else{d=tableData.createNode("element","height","");g.appendChild(d);d.text=b}}var i=getCmdBtn("Update");i!=null&&updateCmdBtnState(i,false);dirty=true}function EnsureRowHeight(a){var b=a;if(getViewport1()!=null)b=a-frzRows;if(getViewport0()!=null&&getViewport1()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getViewport0(),getViewport1(),a,false,false);synRowHeight(getViewport0(),getViewport1(),a,false,false)}if(getViewport()!=null&&getViewport2()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getViewport2(),getViewport(),b,false,false);synRowHeight(getViewport2(),getViewport(),b,false,false)}if(getFrozRowHeader()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getFrozRowHeader(),getViewport1(),a,false,true);synRowHeight(getFrozRowHeader(),getViewport0(),a,false,true)}if(getRowHeader()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getRowHeader(),getViewport(),b,false,true);synRowHeight(getRowHeader(),getViewport2(),b,false,true)}if(getViewport0()!=null&&getViewport1()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getViewport0(),getViewport1(),a,false,false);synRowHeight(getViewport0(),getViewport1(),a,false,false)}if(getViewport()!=null&&getViewport2()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getViewport2(),getViewport(),b,false,false);synRowHeight(getViewport2(),getViewport(),b,false,false)}if(getFrozRowHeader()!=null)if(0<=a&&a<getViewport1().rows.length){synRowHeight(getFrozRowHeader(),getViewport1(),a,false,true);synRowHeight(getFrozRowHeader(),getViewport0(),a,false,true)}if(getRowHeader()!=null)if(0<=b&&b<getViewport().rows.length){synRowHeight(getRowHeader(),getViewport(),b,false,true);synRowHeight(getRowHeader(),getViewport2(),b,false,true)}}function EnsureAllRowHeights(){sync3Tables(getFrozRowHeader(),getViewport0(),getViewport1());sync3Tables(getRowHeader(),getViewport2(),getViewport());sync2Tables(getFrozColFooter(),getColFooter());var c=getCorner(),a=getColHeader(),b=getFrozColHeader();if(c!=null){var f=a||b;if(c.allowTableCorner!=null){sync3Tables(c,b,a);sync3Tables(c,b,a)}else{spreadView.HasFilterBar()&&spreadView.SyncCornerWithFilterBar(corner,getColHeader()||getFrozColHeader());sync2Tables(b,a,false,false);sync2Tables(b,a,false,false)}}else sync2Tables(b,a,false,false);if(getViewport()!=null){var d=getViewport(),e=d.align;d.align="middle";d.align=e}}function SuspendLayout(){bSuspendLayout=true}function ResumeLayout(a){bSuspendLayout=false;a&&sizeSpread()}function processResize(e,c){if(!c){if(spreadView&&spreadView.IsMultiColumnComboBox){if(element.sizeSpreadCounting>0)return}else{var a=element;do{if(a.sizeSpreadCounting>0||!a.getParentSpread)return;a=a.getParentSpread()}while(a!=null)}for(var d=FpSpreadJS.getAllChildViews(element),b=0;b<d.length;b++)if(d[b].sizeSpreadCounting>0)return}try{!(getTopSpread(element).resizing&&window.document.documentMode)&&!c&&sizeSpread();if(element.oldHeight!=element.offsetHeight||element.oldWidth!=element.offsetWidth){element.oldHeight=element.offsetHeight;element.oldWidth=element.offsetWidth;spreadView.OnSizeChanged()}}catch(f){}}function backUpStyleSetting(){ignorePropertyChanged=true;var a=element;while(a!=null&&a!=window.document&&a!=window.document.body){if(a.style.display=="none"){a.displaySetting=a.style.display;a.style.display=""}else if(a.currentStyle!=null&&a.currentStyle.display=="none"){a.displaySetting="";a.style.display="block"}a=a.parentNode}ignorePropertyChanged=false}function restoreStyleSetting(){ignorePropertyChanged=true;var a=element;while(a!=null&&a!=window.document&&a!=window.document.body){if(a.displaySetting!=null&&a.displaySetting!="null"){a.style.display=a.displaySetting;a.displaySetting=null}a=a.parentNode}ignorePropertyChanged=false}function getChildSpreadOffsetWidth(a){if(typeof a=="undefined"||a==null)return 0;var f=0,g=0,b=window.document.getElementById(a.id+"_corner");if(b!=null)f=parseInt(b.offsetWidth);else{b=window.document.getElementById(a.id+"_rowHeader");if(b!=null)f=parseInt(b.offsetWidth)}var c=window.document.getElementById(a.id+"_colHeader");if(c!=null)g=parseInt(c.offsetWidth);else{c=window.document.getElementById(a.id+"_viewport");if(c!=null)g=parseInt(c.offsetWidth)}var d=0,e=GetChildSpreads(a.id);if(e!=null&&e.length>0)for(var i=0,h=0,i=0;i<e.length;i++){h=getChildSpreadOffsetWidth(e[i]);if(h>d)d=h}return g>d?f+g:f+d}function prepairSpreadLayout(){for(var c=[getViewport(),getViewport0(),getViewport1(),getViewport2()],f=[],d=[],b=null,g=0,i=0,h=0,a=0;a<c.length;a++)if(c[a]!=null)for(var e=0;e<c[a].rows.length;e++){b=getFirstNonSpanCell(c[a].rows[e]);if(b!=null){g=b.clientHeight;if(g==0)continue;i=parseInt(b.currentStyle.paddingTop.replace("px",""));h=parseInt(b.currentStyle.paddingBottom.replace("px",""));g-=i+h;f.push(g);d.push(b)}else{f.push(c[a].rows[e].clientHeight);d.push(c[a].rows[e])}}for(var a=0;a<d.length;a++)d[a].style.height=f[a]+"px";f=null;d=null}function isTotalSpanTable(a){if(a.__isTotalSpanTable!=null)return a.__isTotalSpanTable;a.__isTotalSpanTable=false;if(a.rows.length>0){var b=a.rows[0].cells.length>0?a.rows[0].cells[0]:null;if(b!=null&&b.rowSpan>1&&b.rowSpan>=a.rows.length){var c=getColGroup(a);if(c!=null&&b.colSpan>=c.children.length)a.__isTotalSpanTable=true}}return a.__isTotalSpanTable}function cleanElementsStyle(e,b,c){if(e==null||e.length==0||typeof b=="undefined"||b==null)return;var h=typeof c=="function";if(c==null)c="";for(var d=null,f=0;f<e.length;f++){d=e[f];for(var g=[],a=0;a<b.length;a++){d.setAttribute("__bkStyle"+b[a],d.style[b[a]]);g.push(h?c(d,b[a]):c)}for(var a=0;a<b.length;a++)d.style[b[a]]=g[a]}}function restoreElementsStyle(c,a){if(c==null||c.length==0||typeof a=="undefined"||a==null)return;for(var d=null,f=null,e=0;e<c.length;e++){d=c[e];for(var b=0;b<a.length;b++){f=d.getAttribute("__bkStyle"+a[b]);d.style[a[b]]=f;d.removeAttribute("__bkStyle"+a[b])}}}function sizeSpread(f,a){element.sizeSpreadCounting++;try{var g=getParentSpread(),c=g==null?spreadView.IsClientAutoSize()&&(spreadView.ClientAutoSizeMaxWidth()!=0||spreadView.ClientAutoSizeMaxHeight()!=0):false;if(c){if(!a)a={};a.AutoSizeWidth=a.AutoSizeHeight=-1;a.IgnoreAutoSize=false}__sizeSpread(f,a);if(c){var b=getScrollvp()||getViewport().parentNode,e=parseInt(element.style.width),d=parseInt(element.style.height);if(b.offsetHeight==b.clientHeight&&a.AutoSizeHeight<d&&a.AutoSizeHeight>-1||b.offsetWidth==b.clientWidth&&a.AutoSizeWidth<e&&a.AutoSizeWidth>-1){element.detachEvent("onresize",processResize);if(a.AutoSizeHeight<d)element.style.height=a.AutoSizeHeight+"px";if(a.AutoSizeWidth<e)element.style.width=a.AutoSizeWidth+"px";element.attachEvent("onresize",processResize);a.IgnoreAutoSize=true;__sizeSpread(true,a)}}}catch(h){throw h;}finally{element.sizeSpreadCounting--}}function __sizeSpread(fb,B){if(element.ignoreSizeSpread){element.ignoreSizeSpread=null;return}if(bSuspendLayout)return;if((element.style.pixelHeight==0||element.style.pixelWidth==0)&&element.hostspread!=null)return;backUpStyleSetting();if(element.isSizeSpread==true)return;element.isSizeSpread=true;if(getViewport()==null)return;var A=getCorner(),f=getColHeader();if(f!=null&&f.rows.length>0&&A!=null&&A.allowTableCorner==null&&parseInt(A.cellSpacing)==0){var O=f.rows.length-1,I=null;while(O>=0){if(f.rows[O].getAttribute("FpSpread")=="fb"){I=f.rows[O];break}O--}if(I!=null&&I.rowIndex!=0){var cb=A.rows[0].cells[0];cb.style.height="";cb.style.paddingBottom=I.offsetHeight+"px"}}var o=getFrozColHeader(),C=0;if(o!=null){var jb=element.firstChild;C=o.offsetWidth-parseInt(o.cellSpacing);var R=getColGroup(jb);if(R!=null&&C>0)if(getRowHeader()==null)R.childNodes[0].width=C;else R.childNodes[1].width=C;o.parentNode.style.posWidth=C;var n=o.parentNode.parentNode.offsetWidth-o.parentNode.offsetWidth;if(!xhtml)n+=parseInt(o.cellSpacing);getColHeader().parentNode.style.posLeft=-n}syncMsgs();var o=getFrozColHeader(),c=getColGroup(o);if(c!=null){var b=getColGroup(getViewport0());b!=null&&getViewport0().rows.length>0&&sizeFrozHeader(c,b);var r=getViewport2();b=getColGroup(r);if(b!=null&&r.rows.length>0){sizeFrozHeader(c,b);if(r.rows.length>0&&r.rows[0].cells.length>0&&o.rows.length>0&&o.rows[0].cells.length>0){var J=o.rows[0].cells[0].offsetLeft-r.rows[0].cells[0].offsetLeft;if(J>0)c.childNodes[0].width-=J}}b=getColGroup(getFrozColFooter());b!=null&&getViewport2().rows.length>0&&sizeFrozHeader(c,b)}else{c=getColGroup(getViewport0());var b=getColGroup(getViewport2());c!=null&&b!=null&&sizeFrozHeader(c,b)}var P=getFrozColHeader()?getFrozColHeader():getFrozColFooter();if(P!=null){var kb=window.document.getElementById(element.id+"_hidencol2");kb.style.posWidth=P.offsetWidth-parseInt(P.cellSpacing)}var f=getColHeader();c=getColGroup(f);if(c!=null){var l=getViewport(),b=getColGroup(l);b!=null&&sizeColHeader(c,b,false);if(l!=null&&l.rows.length>0&&l.rows[0].cells.length>0&&f.rows.length>0&&f.rows[0].cells.length>0){var J=f.rows[0].cells[0].offsetLeft-l.rows[0].cells[0].offsetLeft;if(J>0)c.childNodes[0].width-=J}b=getColGroup(getViewport1());b!=null&&sizeColHeader(c,b,false);b=getColGroup(getColFooter());b!=null&&sizeColHeader(c,b,false,spreadView.Parent!=null)}else{c=getColGroup(getViewport());b=getColGroup(getViewport1());c!=null&&b!=null&&sizeColHeader(c,b,true)}var eb=getParentSpread()!=null,T=false;if(eb&&getColHeader()!=null&&getColHeader().style.width==""){cleanElementsStyle([getColHeader()],["width"],"1px");T=true}if(getColHeader()!=null){if(getParentSpread())getColHeader().parentNode.style.position="absolute";if(getColHeader().rows.length>0){var H=getColHeader().offsetHeight;if(xhtml){getColHeader().parentElement.style.posHeight=H-2*parseInt(getColHeader().cellSpacing);getColHeader().parentElement.parentElement.parentElement.style.posHeight=H-2*parseInt(getColHeader().cellSpacing)}else{getColHeader().parentElement.style.posHeight=H-parseInt(getColHeader().cellSpacing);getColHeader().parentElement.parentElement.parentElement.style.posHeight=H-parseInt(getColHeader().cellSpacing)}}}parseInt(getViewport().cellSpacing)>0&&syncRowHeaderWidth();spreadView.LayoutFilterBar(true);fb==null&&EnsureAllRowHeights();T&&restoreElementsStyle([getColHeader()],"width");if(smartPaint||GetRowCountInternal()>0){var e=0;if(getFrozColHeader()!=null)e=getFrozColHeader().offsetWidth-parseInt(getFrozColHeader().cellSpacing);var m=getNoRow(0);if(m!=null)m.style.width=e+"px";if(getViewport0()!=null)e=Math.max(e,getViewport0().offsetWidth-parseInt(getViewport0().cellSpacing));m=getNoRow(2);if(m!=null)m.style.width=e+"px";e=0;if(getColHeader()!=null){var f=getColHeader();e=f.offsetWidth;if(f.rows.length>0&&f.rows[0].cells.length>0)e-=f.rows[0].cells[f.rows[0].cells.length-1].offsetWidth}m=getNoRow(1);if(m!=null)m.style.width=e+"px";if(getViewport1()!=null)e=Math.max(e,getViewport1().offsetWidth);m=getNoRow(-1);if(m!=null)m.style.width=e+"px"}var h=element.getAttribute("ClientAutoSize")=="True",s=null;if(h&&(!B||!B.IgnoreAutoSize)||!xhtml&&element.style.height.indexOf("%")>=0&&element.style.position!="absolute"&&element.style.position!="relative"){s=updateAutoSize();if(B){B.AutoSizeWidth=s.AutoSizeWidth;B.AutoSizeHeight=s.AutoSizeHeight}h=s.restrictAutoSize?false:h;!s.restrictAutoSize&&processResize(null,true)}var hb=getScrollvp()?getScrollvp().scrollTop:null,gb=getViewport().parentNode.scrollTop,d=element.style.pixelHeight;if(element.className.length>0&&element.style.pixelHeight==0)d=element.clientHeight;var p=Math.ceil(element.clientWidth);if(getCommandBar()!=null){d-=getCommandBar().offsetHeight;getCommandBar().style.posWidth=p}if(getColFooter()!=null){if(getParentSpread()!=null)getColFooter().parentNode.style.position="absolute";d-=getColFooter().offsetHeight;if(!xhtml)d+=parseInt(getColFooter().cellSpacing)}if(getColHeader()!=null){if(xhtml||GetColCount()>0||!xhtml&&GetRowCount()==0||!xhtml&&GetRowCount()>0&&getViewport().parentNode.style.position=="absolute")d-=getColHeader().offsetHeight;if(!xhtml&&window.document.compatMode=="BackCompat")d+=parseInt(getColHeader().cellSpacing)}var W=getHierBar();if(W!=null)d-=W.offsetHeight;var V=getGroupBar();if(V!=null)d-=V.offsetHeight;var K=getPager1();if(K!=null){if(spreadView.Parent==null)K.style.position="relative";d-=K.offsetHeight;initSlideBar(K)}var q=getPager2();if(q!=null){if(element.inDesign)q.style.width=""+Math.max(element.offsetWidth-10,0)+"px";else q.style.width=""+Math.max(p-10,0)+"px";d-=q.offsetHeight;initSlideBar(q);if(xhtml&&element.style.position!="absolute"&&element.style.position!="relative")q.style.position=""}var k=null;if(getRowHeader()!=null)k=getRowHeader().parentElement;var j=null;if(getColHeader()!=null)j=getColHeader().parentElement;var u=null;if(getColFooter()!=null)u=getColFooter().parentElement;var a=getScrollvp();if(a!=null){a.style.display="block";if(spreadView.AllowVirtualScrollPaging){var G=window.document.getElementById(element.id+"_dummy_VPTop");if(G)if($$.browser.quirksMode&&G.style.height=="0px")G.style.display="none";else G.style.display="";var F=window.document.getElementById(element.id+"_dummy_VPBottom");if(F)if($$.browser.quirksMode&&F.style.height=="0px")F.style.display="none";else F.style.display=""}}else a=getViewport().parentElement;if(j!=null){j.style.posHeight=getColHeader().offsetHeight;if(getFrozColHeader()!=null){var n=Math.max(getMaxLastRowBorderHeight(getColHeader())-getMaxLastRowBorderHeight(getFrozColHeader()),0)/2;if(n>0)n+=.01;getFrozColHeader().parentNode.style.posHeight=getColHeader().offsetHeight-n-.01;getFrozColHeader().parentNode.style.overflow="visible";getFrozColHeader().parentNode.style.posWidth=""}var A=getCorner(),n=Math.max(getMaxLastRowBorderHeight(getColHeader())-getMaxLastRowBorderHeight(A),0)/2;if(n>0)n+=.01;if(A!=null)A.parentElement.style.posHeight=j.style.posHeight-n;if(getParentSpread()!=null){j.style.posWidth=getColHeader().offsetWidth;getColHeader().style.posWidth=getColHeader().offsetWidth}}if(u!=null){u.style.posHeight=getColFooter().offsetHeight;if(getFrozColFooter()!=null)getFrozColFooter().parentNode.style.posHeight=getColFooter().offsetHeight;var S=getFooterCorner();if(S!=null)S.parentElement.style.posHeight=u.style.posHeight;if(getParentSpread()!=null){u.style.posWidth=getColFooter().offsetWidth;getColFooter().style.posWidth=getColFooter().offsetWidth}}var ab=window.document.getElementById(element.id+"_titleBar");if(ab)d-=ab.parentNode.clientHeight;if(a!=null){if(viewport!=null&&viewport.parentElement!=null&&viewport.parentElement!=a)a.style.position="absolute";if(k!=null){a.style.width=Math.max(p-k.offsetWidth+parseInt(getViewport().cellSpacing),1);a.style.height=Math.max(d,1);a.style.width=Math.max(p-k.offsetWidth+parseInt(getViewport().cellSpacing),1)}else{a.style.width=Math.max(p,1);a.style.height=Math.max(d,1);a.style.width=Math.max(p,1)}spreadView._UpdateDummyHeight(true);if(q!=null&&rowHeader==null&&a.parentNode.parentNode.offsetHeight!=a.offsetHeight)a.parentNode.parentNode.style.height=a.style.height}if(j!=null&&getFrozColHeader()!=null&&getFrozColHeader().offsetWidth>a.clientWidth){getFrozColHeader().parentNode.style.overflow="hidden";getFrozColHeader().parentNode.style.posWidth=a.offsetWidth}var i=getParent(getViewport1()),r=getParent(getViewport2()),v=getViewport0()!=null?isTotalSpanTable(getViewport0())&&parseInt(getViewport().cellSpacing)>0?getViewport0().rows[0].offsetWidth:getViewport0().offsetWidth:0,w=getViewport2()!=null?isTotalSpanTable(getViewport2())&&parseInt(getViewport().cellSpacing)>0?getViewport2().rows[0].offsetWidth:getViewport2().offsetWidth:0;if(i!=null){i.style.height=Math.max(0,getViewport1().offsetHeight-parseInt(getViewport1().cellSpacing));var M=getParent(getViewport0());if(M!=null){M.style.height=Math.max(0,getViewport0().offsetHeight-parseInt(getViewport0().cellSpacing));var X=Math.max(M.style.posHeight,i.style.posHeight);M.style.height=X;i.style.height=X}if(h)if(getViewport0()!=null)i.style.width=Math.max(1,a.offsetWidth-v+parseInt(getViewport0().cellSpacing));else i.style.width=Math.max(1,a.offsetWidth);else if(getViewport0()!=null)i.style.width=Math.max(1,a.clientWidth-v+parseInt(getViewport0().cellSpacing));else i.style.width=Math.max(1,a.clientWidth)}if(i!=null)if(frzCols>0)if(h)i.style.width=Math.max(1,a.offsetWidth-v+parseInt(getViewport0().cellSpacing));else i.style.width=Math.max(1,a.clientWidth-v+parseInt(getViewport0().cellSpacing));else if(h)i.style.width=Math.max(1,a.offsetWidth);else i.style.width=Math.max(1,a.clientWidth);if(r!=null)if(getViewport0()!=null)if(h)r.style.height=Math.max(1,a.offsetHeight-Math.max(getViewport0().parentNode.offsetHeight,getViewport1().parentNode.offsetHeight));else r.style.height=Math.max(1,a.clientHeight-Math.max(getViewport0().parentNode.offsetHeight,getViewport1().parentNode.offsetHeight));else if(h)r.style.height=Math.max(1,a.offsetHeight);else r.style.height=Math.max(1,a.clientHeight);if((frzRows>0||frzCols>0)&&getViewport()!=null){var y=getViewport().parentElement;if(frzCols>0){var e=0;if(getFrozColHeader()!=null)e=getFrozColHeader().offsetWidth-getFrozColHeader().cellSpacing;if(getViewport2()!=null)e=Math.max(e,w-getViewport2().cellSpacing);if(h)y.style.width=Math.max(1,a.offsetWidth-w+parseInt(getViewport2().cellSpacing));else y.style.width=Math.max(1,a.clientWidth-e)}else if(h)y.style.width=Math.max(1,a.offsetWidth);else y.style.width=Math.max(1,a.clientWidth);if(frzRows>0)if(h)y.style.height=Math.max(1,a.offsetHeight-getViewport1().parentNode.offsetHeight);else y.style.height=Math.max(1,a.clientHeight-getViewport1().parentNode.offsetHeight);else if(h)y.style.height=Math.max(1,a.offsetHeight);else y.style.height=Math.max(1,a.clientHeight)}if(k!=null){k.style.position="relative";if(frzRows>0){var E=0;if(getViewport0()!=null)E=getViewport0().offsetHeight-parseInt(getViewport0().cellSpacing);if(getViewport1()!=null&&getViewport1().offsetHeight>E)E=getViewport1().offsetHeight-parseInt(getViewport1().cellSpacing);k.style.height=Math.max(a.offsetHeight-E,1);getFrozRowHeader().parentNode.style.posHeight=Math.max(Math.min(E,a.offsetHeight),1);getFrozRowHeader().parentNode.style.overflow="hidden"}else k.style.height=Math.max(a.offsetHeight,1);var c=getColGroup(getRowHeader());if(c!=null&&c.childNodes.length>0){var n=k.offsetWidth-getRowHeader().offsetWidth;n=parseInt(n/2)*2;var g=parseInt(c.childNodes[0].width)+n;if(g>0){c.childNodes[0].width=g;var b=getColGroup(getCorner());if(b!=null&&b.childNodes!=null&&(c.childNodes.length==1||getCorner().allowTableCorner))b.childNodes[0].width=g;var db=getColGroup(getFrozRowHeader());if(db!=null)db.childNodes[0].width=g}}}if((getParentSpread()==null||getParentSpread().hierView!="true")&&(j!=null||u!=null)){var z=0,U=frzCols>0&&getFrozColHeader()!=null?Math.max(w,getFrozColHeader().offsetWidth):w;if(k!=null)if(frzCols>0)z=Math.max(p-k.offsetWidth-U+parseInt(getRowHeader().cellSpacing)+parseInt(getViewport2().cellSpacing),1);else z=Math.max(p-k.offsetWidth+parseInt(getRowHeader().cellSpacing),1);else if(frzCols>0)z=Math.max(p-U+parseInt(getViewport2().cellSpacing),1);else z=Math.max(p+parseInt(getViewport().cellSpacing),1);if(j!=null){j.style.width=z;if(engine<8)j.parentElement.style.width=z}if(u!=null){u.style.width=z;u.parentElement.style.width=z}}spreadView._UpdateEmptyViewportsHeight();if(xhtml){if(getViewport0()!=null){getViewport0().parentNode.style.position="relative";getViewport0().style.position="relative";getViewport0().style.posTop=-getViewport().cellSpacing}if(getViewport1()!=null){getViewport1().parentElement.style.position="relative";getViewport1().style.position="relative";getViewport1().style.posTop=-getViewport().cellSpacing}if(getViewport2()!=null){getViewport2().parentElement.style.position="relative";getViewport2().style.position="relative";getViewport2().style.posTop=-getViewport().cellSpacing}if(getViewport()!=null){if(getViewport().parentElement!=null)if(getParentSpread()==null)getViewport().parentElement.style.position="relative";else getViewport().parentElement.style.position="absolute";getViewport().style.position="relative";getViewport().style.posTop=-getViewport().cellSpacing}if(getFrozRowHeader()!=null){getFrozRowHeader().style.position="relative";getFrozRowHeader().parentElement.style.position="relative";getFrozRowHeader().style.posTop=-getViewport().cellSpacing}rowHeader=getRowHeader();if(rowHeader!=null&&rowHeader.parentElement!=null){rowHeader.style.position="relative";rowHeader.parentElement.style.position="relative";rowHeader.style.posTop=-getViewport().cellSpacing}var Q=window.document.getElementById(element.id+"_VirtualPaging_Bottom");if(Q){Q.style.position="relative";Q.style.posTop=-spreadView.CellSpacing}}var t=getViewportHolder();if(t!=null){t.style.overflow="hidden";if(h){t.style.height=a.offsetHeight;t.style.width=a.offsetWidth}else{t.style.height=a.clientHeight;t.style.width=a.clientWidth}if(vpholder_setSizeCallback==null){var ib=function(){var b=getViewportHolder(),a=arguments[arguments.length-1],c=element.getAttribute("ClientAutoSize")=="True"&&(getParentSpread()!=null||spreadView.ClientAutoSizeMaxHeight()==0&&spreadView.ClientAutoSizeMaxWidth()==0);if(c){if(a.offsetHeight>0)b.style.height=a.offsetHeight;if(a.offsetWidth>0)b.style.width=a.offsetWidth}else{if(a.clientHeight>0)b.style.height=a.clientHeight;if(a.clientWidth>0)b.style.width=a.clientWidth}};vpholder_setSizeCallback=Function.CreateCallback(ib,a)}setTimeout(vpholder_setSizeCallback,100);t.onmousewheel=doMouseWheel;if(smartPaint&&frzRows==0&&frzCols==0){getViewport().parentNode.style.height=a.clientHeight;getViewport().parentNode.style.width=a.clientWidth}}var Y=element.cmdTop=="true";if(getCommandBar()!=null&&!Y){d=a.offsetTop+a.offsetHeight;if(getColFooter()!=null)d+=getColFooter().offsetHeight;getCommandBar().style.top=d;if(rowHeader==null)getCommandBar().style.position="absolute";if(q!=null&&(rowHeader==null||$$.browser.quirksMode))getCommandBar().parentNode.parentNode.style.height=getCommandBar().offsetHeight+"px"}if(q!=null){q.style.position="relative";if(getCommandBar()!=null&&!Y)d=a.offsetTop+a.offsetHeight+getCommandBar().offsetHeight;else d=a.offsetTop+a.offsetHeight;if(getColFooter()!=null)d+=getColFooter().offsetHeight}if(getViewport0()!=null){var g=0;if(getViewport0().rows.length>0)g=v-parseInt(getViewport0().cellSpacing);else{var Z=getViewport1()!=null?getViewport1().parentNode:null;g=t.style.posWidth-(Z!=null?Z.style.posWidth:0)-parseInt(getViewport0().cellSpacing)}if(j==null&&xhtml)if(getViewport2()!=null&&w>v){g=w-parseInt(getViewport2().cellSpacing);getViewport0().style.posWidth=g+parseInt(getViewport0().cellSpacing)}getViewport0().parentElement.style.posWidth=g}else if(getViewport1()!=null)getViewport1().parentElement.parentElement.parentElement.style.posHeight=getViewport1().offsetHeight-parseInt(getViewport1().cellSpacing);if(getViewport2()!=null){var g=0;if(getViewport2().rows.length>0)g=w-parseInt(getViewport2().cellSpacing);else{var bb=getViewport()!=null?getViewport().parentNode:null;g=t.style.posWidth-(bb!=null?bb.style.posWidth:0)-parseInt(getViewport2().cellSpacing)}if(j==null&&xhtml)if(getViewport0()!=null&&v>w){g=v-parseInt(getViewport0().cellSpacing);getViewport2().style.posWidth=g+parseInt(getViewport0().cellSpacing)}getViewport2().parentElement.style.posWidth=g}(getColHeader()!=null||getFrozColHeader()!=null)&&spreadView.LayoutEditingFilterIndicator();ignoreVirtualPaging=true;var L=getViewport().parentNode;if(a!=null&&hb!=a.scrollTop&&gb==L.scrollTop&&s&&s.restrictAutoSize&&hasChart()){L.onscroll=null;L.scrollTop=a.scrollTop;L.onscroll=scrollView}scrollView();ignoreVirtualPaging=false;(window.document.FpActiveSpread==element||retainSelectionBlock)&&paintFocusRect();var D=getParentSpread();if(D!=null&&typeof D.UpdateRowHeight=="function"){if(xhtml){var l=getViewport();if(l!=null)l.parentElement.style.height="";l=getRowHeader();if(l!=null)l.parentElement.style.height=""}D.UpdateRowHeight(element);FpSpreadJS.checkInitLayoutCompleted(D)&&D.sizeSpread()}if(!xhtml&&getColFooter()!=null)getColFooter().parentElement.parentElement.parentElement.style.height="auto";if(!xhtml&&getViewport()&&!getRowHeader()&&!getViewport0()&&!getViewport1()&&!getViewport2()){var l=getViewport();l.parentNode.parentNode.parentNode.style.height=""+l.parentNode.offsetHeight+"px"}if(getTitleBar()!=null||getPager1()!=null||getHierBar()!=null||getGroupBar()!=null||getColHeader()!=null||getColFooter()!=null){var x=0;if(getTitleBar()!=null)x+=parseInt(getTitleBar().offsetHeight);if(getGroupBar()!=null)x+=parseInt(getGroupBar().offsetHeight);if(getPager1()!=null)x+=parseInt(getPager1().offsetHeight);if(getHierBar()!=null)x+=parseInt(getHierBar().offsetHeight);if(getCommandBar()!=null)x+=parseInt(getCommandBar().offsetHeight);if(getColHeader()!=null)x+=parseInt(getColHeader().offsetHeight);if(getColFooter()!=null)x+=parseInt(getColFooter().offsetHeight);if(x>parseInt(element.style.height)){if(getColHeader()!=null&&getColHeader().parentNode.style.position!=null&&getColHeader().parentNode.style.position!="")getColHeader().parentNode.style.position="";if(getColFooter()!=null&&getColFooter().parentNode.style.position!=null&&getColFooter().parentNode.style.position!="")getColFooter().parentNode.style.position="";if(getCommandBar()!=null&&getCommandBar().style.position!=null&&getCommandBar().style.position!="")getCommandBar().style.position=""}}if((getViewport1()!=null||getViewport2()!=null||element.UIVirtualization=="True")&&getColFooter()!=null&&getRowHeader()==null){var a=window.document.getElementById(element.id+"_scrollvp");if(a!=null){var N=a.parentElement;if(N!=null)if(N.parentElement!=null&&N.parentElement.tagName=="TR")N.parentElement.style.height=a.style.height}}restoreStyleSetting();if((!B||!B.IgnoreAutoSize)&&(!s||!s.restrictAutoSize)){updateAutoSize();processResize(null,true)}spreadView.RepaintCDFs();element.isSizeSpread=false}function syncRowHeaderWidth(){if(element.mcctCellType==null&&getRowHeader()!=null){var l=getRowHeader().parentElement.rhVisible!="false";if(l){var n=element.firstChild,k=getColGroup(n),d=[getCorner(),getFrozRowHeader(),getRowHeader(),getFooterCorner()];$$.utils.cleanArray(d);for(var f=0,h=Number.MAX_VALUE,a=0;a<d.length;a++){f=Math.max(f,d[a].offsetWidth);h=Math.min(h,parseInt(d[a].cellSpacing))}if(k!=null&&k.children.length>0)if(f-h>0)k.children[0].width=f-h+"px";for(var a=0,o=d.length;a<o;a++)d[a].parentElement.style.width=f+"px";var c=getCorner();if(c!=null&&c.allowTableCorner==null){var b=getColGroup(c);if(b==null){b=window.document.createElement("COLGROUP");var m=window.document.createElement("COL");b.appendChild(m);var e=c.getElementsByTagName("TBODY");if(e!=null&&e.length>0){e=e[0];c.insertBefore(b,e)}else c.insertBefore(b)}if(b!=null){var i=null,g=getRowHeader();if(g==null)g=getFrozRowHeader();if(g!=null){i=getColGroup(g);if(i!=null){for(var j=0,a=0;a<i.children.length;a++)j+=parseInt(i.children[a].width);if(j>0)b.children[0].width=j}}}}}}}function getMaxLastRowBorderHeight(a){if(a==null)return 0;for(var d=0,b=0;b<a.rows.length;b++)for(var e=a.rows[b],c=0;c<e.cells.length;c++){if(b+e.cells[c].rowSpan!=a.rows.length)continue;var f=getBorderWidth(e.cells[c],2);if(f>d)d=f}return d}function updateAutoSize(){var x=window.document.documentElement!=null&&window.document.documentElement.currentStyle.height!=null&&window.document.documentElement.currentStyle.height.length>0,k=element.ClientAutoSize=="True",o=spreadView.ClientAutoSizeMaxWidth(),n=spreadView.ClientAutoSizeMaxHeight(),j=k&&o+n>0&&getParentSpread()==null,l={restrictAutoSize:false};if(k||xhtml&&!x&&element.style.position!="absolute"||(!xhtml||!ie6up)&&element.style.position!="absolute"&&element.style.position!="relative")if(k||element.style.height!=null&&element.style.height.indexOf("%")>=0){var a=0,q=spreadView.CellSpacing;if(getTitleBar()!=null)a+=getTitleBar().offsetHeight;if(getSubTitleBar()!=null)a+=getSubTitleBar().offsetHeight;if(getCommandBar()!=null)a+=getCommandBar().offsetHeight;if(getColHeader()!=null)a+=getColHeader().offsetHeight-q;if(getColFooter()!=null)a+=getColFooter().offsetHeight;if(getViewport1()!=null)a+=getViewport1().offsetHeight-q;var d=spreadView._GetViewportSize();a+=element.GetRowCount()>frzRows?d.height:d.height+q;if(getPager1()!=null)a+=getPager1().offsetHeight;if(getPager2()!=null)a+=getPager2().offsetHeight;if(getHierBar()!=null)a+=getHierBar().offsetHeight;if(getGroupBar()!=null)a+=getGroupBar().offsetHeight;if(j){var v=getScrollvp()||getViewport().parentNode;if(d.height<$$.utils.detectScrollbarWidthHeight()&&v.offsetHeight!=v.clientHeight&&GetRowCount()==0&&hasChart())a=a-d.height+$$.utils.detectScrollbarWidthHeight()}if(!j)element.style.height=a;if(k){var c=window.document.getElementById(element.id+"_view");if(c!=null&&(getParentSpread()!=null||o==0&&n==0)){c.style.overflowX="hidden";c.style.overflowY="hidden"}var b=0;if(getRowHeader()!=null)b+=getRowHeader().offsetWidth;var m=getViewport2();if(m!=null)b+=m.rows.length>0?m.offsetWidth:getNoRow(2).offsetWidth+parseInt(m.cellSpacing);var h=GetChildSpreads();if(h!=null&&h.length>0){var g=0,p=2;for(i=0;i<h.length;i++){p=getChildSpreadOffsetWidth(h[i])+2;if(p>g)g=p}if(g>d.width)b+=g;else if(getViewport().rows.length>0)b+=d.width;else{var w=getViewport1();if(w!=null)b+=w.offsetWidth}}else if(getViewport().rows.length>0)b+=d.width;else b+=getMaxWidth([getColHeader(),getViewport1(),getViewport(),getColFooter()]);if(!j)element.style.posWidth=b;l.AutoSizeWidth=b;l.AutoSizeHeight=a;if(j){element.detachEvent("onresize",processResize);var y=c!=null?c.style.overflowX:null,z=c!=null?c.style.overflowY:null,f=spreadView.CheckAutoSizeScrollBar(Math.floor(b),Math.floor(a),o,n,y,z),u=f[0],t=f[1],r=f[2],s=f[3];element.style.width=u+"px";element.style.height=t+"px";var e=getScrollvp()||c;if(e){if(spreadView.HorizontalScrollBarPolicy()!="never"&&e.style.overflowX!=r)e.style.overflowX=r;if(spreadView.VerticalScrollBarPolicy()!="never"&&e.style.overflowY!=s)e.style.overflowY=s}element.attachEvent("onresize",processResize);if(Math.floor(b)!=u||Math.floor(a)!=t)l.restrictAutoSize=true}}}return l}function getNoRow(a){return spreadView._GetNoRow(a)}function getMaxWidth(e){for(var b=0,d=0;d<e.length;d++){var a=e[d];if(a==null)continue;var f=a.offsetWidth;if((a==getColHeader()||a==getColFooter())&&a.rows.length>0){var c=a.rows[0];if(c.cells.length>0)f-=c.cells[c.cells.length-1].offsetWidth+parseInt(a.cellSpacing)}b=Math.max(b,f)}return b}function getMaxHeight(d){for(var b=0,c=0;c<d.length;c++){var a=d[c];if(a==null)continue;var e=a.offsetHeight;if(a==getRowHeader()&&a.rows.length>0)e-=a.rows[a.rows.length-1].offsetHeight+parseInt(a.cellSpacing);b=Math.max(b,e)}return b}function getViewPortSize(){return spreadView._GetViewportSize()}function hasChart(){return typeof FpChartUtil!=="undefined"&&FpChartUtil.getChartsIdCollection(element).length>0}function initSlideBar(a){var c=getElementById(a,element.id+"_slideBar");if(c!=null){var f=a.getElementsByTagName("TABLE");if(f!=null&&f.length>0){var e=f[0].rows[0].cells[1],r=e.offsetLeft;slideLeft=r;slideRight=e.offsetLeft+e.offsetWidth-c.offsetWidth;var p=a.offsetHeight,j=$$(a).offset(),k=$$(c.offsetParent).offset(),n=c.offsetParent.scrollLeft,o=c.offsetParent.scrollTop;e=f[0].rows[0].cells[0];var d=e.getElementsByTagName("IMAGE");if(d==null)d=[];for(var q=e.offsetHeight,g=[],h=[],b=0;b<d.length;b++){h.push(d[b].offsetTop);g.push(d[b].offsetHeight)}var l=a.style.paddingTop!=""?parseInt(a.style.paddingTop):0,u=a.style.paddingBottom!=""?parseInt(a.style.paddingBottom):0;c.style.posHeight=p-(l+u);var i=j.left-k.left+slideLeft+n,s=j.top-k.top+o+l,t=parseInt(a.getAttribute("curPage")),m=parseInt(a.getAttribute("totalPage"))-1;if(m>0)i+=t/m*(slideRight-slideLeft);c.style.left=i+"px";c.style.top=s+"px";for(var b=0;b<d.length;b++)d[b].style.marginTop=(q-h[b]-g[b])/2+"px"}}}function doMouseWheel(){if(spreadView&&spreadView.GetTopSpreadView().ActiveContextMenu!=null||GrapeCity.Web.DatePicker.IsShowing()){FarPoint.System.CancelDefault(window.event);return false}if(window.event.ctrlKey){sizeSpread();return}var e=window.document.activeElement==window.event.srcElement&&window.event.srcElement.tagName=="SELECT";if(e)return;var c=getTopSpread(),b=spreadView.GetActiveSpread(true);if(b)if(getTopSpread(b)==c||b.getSpreadView&&b.getSpreadView().IsMultiColumnComboBox&&$$.utils.contains(c,b.getSpreadView().GetHostSpread(),true)){if(window.document.activeElement==null||!isChild(window.document.activeElement,element)){ignorePostbackEditmode=true;focus2();ignorePostbackEditmode=false}var d=true;callEndEditFromMouseWheel=true;try{var f=spreadView.DetachScrollEvents();d=EndEdit(false,{FromMouseWheel:true});spreadView.AttachScrollEvents(f)}finally{callEndEditFromMouseWheel=false}if(!d)return}if(c.ClientAutoSize!="True"||spreadView.IsVerticalRestricClientAutoSize()){var g=window.event.wheelDelta,a=c.getScrollvp();if(a==null)a=getParent(c.getViewport());if(a!=null){var h=a.scrollTop;a.scrollTop-=g/10;window.event.returnValue=h==a.scrollTop}}window.event.cancelBubbling=true}var waittimeAdj=20,waittime=200,startTime=null,lastScrollvpScrollTop,lastScrollvpScrollLeft;function vpscroll(){if(smartPaint){var a=event.srcElement.scrollLeft,b=event.srcElement.scrollTop,e=getViewport().parentNode.scrollLeft!=a,f=getViewport().parentNode.scrollTop!=b;element.scrollContent&&(e||f)&&showScrollingContent(e);if(lastScrollvpScrollLeft==a&&lastScrollvpScrollTop==b)return;lastScrollvpScrollLeft=a;lastScrollvpScrollTop=b;startTime=new Date;setTimeout(stopScroll,waittime)}else{var c=event.srcElement.scrollLeft,d=event.srcElement.scrollTop;setScrollbarValues(d,c);getParentSpread()==null&&saveScrollbarState(d,c);fireScrollEvent()}}function stopScroll(){var d=1e3;if(startTime!=null){var f=new Date;d=f.getTime()-startTime.getTime()}if(d>=waittime-waittimeAdj){var a=getScrollvp();if(a==null)a=getViewport().parentNode;var c=a.scrollLeft,b=a.scrollTop,g=newTop;newTop=getTopRow(b);var e=newPageCount;newPageCount=getRowsPerPage(newTop);(g!=newTop||e!=newPageCount)&&doUpdate();delayScrollView(b,c,10);getParentSpread()==null&&saveScrollbarState(b,c);fireScrollEvent()}}function delayScrollView(c,b,d){var a=getParent(getViewport());if(a!=null){var e=a.scrollTop!=c||a.scrollLeft!=b;ignoreMainScroll=true;setScrollbarValues(c,b);setTimeout(function(){ignoreMainScroll=false;e&&scrollView()},d||10)}}function getTopRow(e){var b=element.getViewport();if(b.rows.length==0)return-1;var c=e;if(element.virtualPaging=="true"){var g=getParent(b),f=getTopSpread(),d=g.document.getElementById(f.id+"_VirtualPaging_Top").style.height;d=parseInt(d);c=c-d;if(c<0)c=0}var a=current;if(a==-1)a=0;if(c<b.rows[a].offsetTop+getRowOffsetHeight(b,a)){if(c>=b.rows[a].offsetTop)return a;while(a>0){a--;if(c>=b.rows[a].offsetTop+getRowOffsetHeight(b,a))return Math.max(0,a)}}else for(a=current+1;a<b.rows.length;a++)if(c<b.rows[a].offsetTop+getRowOffsetHeight(b,a))break;a=Math.max(0,a);return a}function GetTopRowIndex(){var a=element.getViewport(),b=frzRows+getTopRow(a.parentNode.scrollTop);return b}function GetLeftColIndex(){var d=element.getViewport(),b=d.parentNode.scrollLeft;if(scrollvp!=null)b=scrollvp.scrollLeft;for(var c=0,a=0,a=0;a<GetColCount();a++){c+=getColWidthFromCol(frzCols+a);if(c>b)break}return c>b?frzCols+a:a-1}function setScrollbarValues(e,f){var b=getTopSpread();if(b!=element)return;var i=getParent(b.getRowHeader()),h=getParent(b.getColHeader()),g=getParent(b.getColFooter()),a=getParent(b.getViewport());ignoreScroll=true;var d=b.getScrollvp();if(d!=null){d.onscroll=null;d.scrollLeft=f;if(e!=null)d.scrollTop=e;d.scrollLeft=f;d.onscroll=vpscroll}if(a!=null){a.onscroll=null;a.scrollLeft=f;if(e!=null)a.scrollTop=e;a.onscroll=scrollView}var c=getParent(b.getViewport2());if(c!=null&&c.scrollTop!=a.scrollTop)c.scrollTop=a.scrollTop;c=getParent(b.getViewport1());if(c!=null&&c.scrollLeft!=a.scrollLeft)c.scrollLeft=a.scrollLeft;if(i!=null&&i.scrollTop!=a.scrollTop)i.scrollTop=a.scrollTop;if(h!=null&&h.scrollLeft!=a.scrollLeft)h.scrollLeft=a.scrollLeft;if(g!=null&&g.scrollLeft!=a.scrollLeft)g.scrollLeft=a.scrollLeft;setTimeout(function(){ignoreScroll=false},200)}function initLayout(a,g,e){if(!FpSpreadJS.checkInitLayoutCompleted(element,false)){if(a!=null)element.__initLayoutCompletedHandler=a;return}element.__initLayoutCompletedHandler=null;frzCols>0&&layoutSpanRows();sizeSpread();if(xhtml)try{sizeSpread()}catch(j){if($$(element).getParent("BODY")==null)return}var h=getScrollvp();if(h!=null)h.onscroll=vpscroll;var f=getViewportHolder();if(f!=null)f.onscroll=noScroll;var i=getParent(getViewport2());if(i!=null)i.onscroll=vp2Scroll;getRowHeader()==null&&frzCols==0&&prepairSpreadLayout();element.initLayoutCompleted=true;a!=null&&a();var b=getParentSpread();b!=null&&b.getSpreadView().GetSpreadContext().initLayout(b.__initLayoutCompletedHandler,e);if(element.initialized&&!spreadView.IsInitialized){doOnSpreadInitialized(g,e);if(element.__pendingCallbakStoppedTargetId!=null){spreadView.OnSpreadCallbackStopped(element.__pendingCallbakStoppedTargetId);g!="LoadOnDemand"&&getEditor(anchorCell)==null&&fpSpreadJS.setImeMode(element,textBox,anchorCell,true);element.__pendingCallbakStoppedTargetId=null}}if(spreadView.IsEnablejQueryTheme()){var c=spreadView.Pager.GetSlideBar(getPager1()),d=spreadView.Pager.GetSlideBar(getPager2());c&&c.length>0&&spreadView.JQueryThemeSupporter.RegisterClickableItem($$.j(c[0]).find("img"),false);d&&d.length>0&&spreadView.JQueryThemeSupporter.RegisterClickableItem($$.j(d[0]).find("img"),false);spreadView.JQueryThemeSupporter.RegisterClickableItem($$.j(getCommandBar()).find("input"),function(){return this.getAttribute("disabled")!="true"&&this.getAttribute("disabled")!="disabled"})}}function vp2Scroll(){var a=getParent(getViewport2());if(a!=null){var b=getParent(getViewport());if(b!=null&&b.scrollTop!=a.scrollTop)b.scrollTop=a.scrollTop}}function noScroll(){var a=window.event.srcElement;if(a.scrollTop!=0)a.scrollTop=0;if(a.scrollLeft!=0)a.scrollLeft=0}function getRowByKey2(a){return getRowByKey(a,-1)}function getRowByKey(b,a){return fpSpreadJS.getRowByKey(b,a)}function getColByKey2(a){return getColByKey(a,-1)}function getColByKey(e,g){if(e=="-1")return-1;var b=null,c=getViewport0();if(c==null)c=getViewport2();if(c!=null){b=getColGroup(c);if(b!=null)for(var a=0;a<b.childNodes.length;a++){var h=b.childNodes[a];if(h.FpCol==e)return a}}var d=getViewport();if(d==null)d=getViewport1();if(d!=null){var f=getColGroup(d);if(f!=null)for(var a=0;a<f.childNodes.length;a++){var h=f.childNodes[a];if(h.FpCol==e){if(b!=null)a+=b.childNodes.length;return a}}}return g?g:0}function isRowSelected(e){var d=getSelection();if(d!=null){var a=d.firstChild;while(a!=null){var b,c;if(element.layoutMode&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect")){var f=parseInt(a.getAttribute("row"));b=getFirstRowFromKey(f)}else b=parseInt(a.getAttribute("rowIndex"));if(element.layoutMode&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))c=parseInt(element.layoutRowCount);else c=parseInt(a.getAttribute("rowcount"));if(b<=e&&e<b+c)return true;a=a.nextSibling}}}function initSelection(){oldAnchorCell=null;var selection=getSelection();if(window.document.FpActiveSpread==element)anchorCell=findAnchorCell();var activeRow=tableData.documentElement.selectSingleNode("/root/state/activeRow"),activeCol=tableData.documentElement.selectSingleNode("/root/state/activeColumn"),srow=activeRow?activeRow.text:null,r=srow&&srow!="newRow"?parseInt(srow):srow=="newRow"?"newRow":-1,c=activeCol!=null?parseInt(activeCol.text):-1,lr=srow!="newRow"?Math.max(r,0):"newRow",lc=Math.max(c,0);if(element.layoutMode){var cell=getCellByRowCol2(lr,lc);if(cell){lr=getRowFromCell(cell);lc=getColFromCell(cell)}}else{lr=getRowByKey(lr);lc=getColByKey(lc)}leadingCellRow=lr;leadingCellCol=lc;var keepCurrentSelection=element.hostspread!=null;if((r>-1||r=="newRow")&&c>-1){var spreadData=tableData;if(getParentSpread()!=null){var topSpread=getTopSpread(element);spreadData=eval(topSpread.id+"_XMLDATA")}var activeChild=spreadData.documentElement.selectSingleNode("/root/activechild");if(getParentSpread()==null&&(activeChild==null||activeChild.text=="")||activeChild!=null&&element.id==activeChild.text){var select=retainSelectionBlock||window.document.FpActiveSheetView!=null&&window.document.FpActiveSheetView.id==element.id;updateAnchorCell(lr,lc,select,false,keepCurrentSelection)}}var node=selection.firstChild;while(node!=null){updateSelectionViewIndexes(node);node=node.nextSibling}node=selection.lastChild;if(element.layoutMode&&anchorCell!=null&&node!=null&&node.getAttribute("col")!="-1"&&node.getAttribute("row")=="-1"&&node.getAttribute("rowcount")=="-1")copymultiCol=true;var activeSpread=window.document.FpActiveSheetView;if(activeSpread!=null&&activeSpread!=element&&getTopSpread(activeSpread)==getTopSpread(element))return;if(!retainSelectionBlock)return;paintSelections(true,keepCurrentSelection);paintFocusRect()}function paintSelections(e,k){!k&&fpSpreadJS.updateSelectionRangeFromCell(anchorCell);(e==null||e)&&paintSelections(false);var g=getSelection();if(g!=null){var a=g.firstChild;if(a==null){e&&anchorCell!=null&&paintAnchorCell();return}while(a!=null){var b=a.getAttribute("row"),c=parseInt(a.getAttribute("col"));if(a.getAttribute("rowIndex")==null||a.getAttribute("rowIndex")=="-1"){if(b=="newRow"||parseInt(b)>-1)b=getRowByKey(b,0)}else b=parseInt(a.getAttribute("rowIndex"));if(a.getAttribute("colIndex")==null||a.getAttribute("colIndex")=="-1"){if(c>-1){if(element.layoutMode){var d=null;if(b==-1)d=spreadView._GetFirstCellFromLayoutCol(c);else{var m=getRowKeyFromRow(b);d=getCellByRowCol2(m,c)}if(d){b=getRowFromCell(d);c=getColFromCell(d)}}if(element.layoutMode==null)c=getColByKey(c,0)}}else c=parseInt(a.getAttribute("colIndex"));var h=parseInt(a.getAttribute("rowcount")),j=parseInt(a.getAttribute("colcount")),l=GetRowCountInternal();if(l==0&&ignorePaintSelection)return;var f=tableData.createNode("attribute","rowIndex","");f.text=b;a.attributes.setNamedItem(f);f=tableData.createNode("attribute","colIndex","");f.text=c;a.attributes.setNamedItem(f);if(element.layoutMode&&a.getAttribute("col")>=0&&a.getAttribute("row")>=0&&(a.getAttribute("rowcount")>=1||a.getAttribute("colcount")>=1)){var i=a.nextSibling;if(i!=null){typeof activeRow!="undefined"&&typeof activeCol!="undefined"&&activeRow!=null&&activeCol!=null&&(parseInt(a.getAttribute("row"))!=parseInt(activeRow.text)||parseInt(a.getAttribute("col"))!=parseInt(activeCol.text))&&g.removeChild(a);a=i;continue}}if(element.layoutMode&&a.getAttribute("col")=="-1"&&a.getAttribute("colcount")=="-1"&&a.getAttribute("row")!=-1)h=parseInt(element.layoutRowCount);if(element.layoutMode&&a.getAttribute("col")!="-1"&&a.getAttribute("row")=="-1"&&a.getAttribute("rowcount")=="-1"){var d=spreadView._GetFirstCellFromLayoutCol(a.getAttribute("col"));if(d){b=parseInt(d.parentElement.row);c=getColFromCell(d)}paintMultipleRowSelection(b,c,1,1,e)}else if(element.OperationMode=="Normal"&&element.SelectionPolicy=="MultiRange")paintSelection2(b,c,h,j,e);else paintSelection(b,c,h,j,e);a=a.nextSibling}}}var rowEditTemplateContainer_keyDownEvent=null,rowEditTemplateContainer_textBoxFocusing=false;function rowEditTemplateContainer_keyDown(){if(event.keyCode==tab)if(!rowEditTemplateContainer_textBoxFocusing){var a=window.document.createEventObject();a.keyCode=event.keyCode;a.type=event.type;a.target=event.srcElement;a.altKey=event.altKey;a.altLeft=event.altLeft;a.ctrlKey=event.ctrlKey;a.ctrlLeft=event.ctrlLeft;a.shiftKey=event.shiftKey;a.shiftLeft=event.shiftLeft;rowEditTemplateContainer_keyDownEvent=a}else{rowEditTemplateContainer_textBoxFocusing=false;editing=false;setTextBoxFocus();translateKey()}else rowEditTemplateContainer_keyDownEvent=null;if(!rowEditTemplateContainer_textBoxFocusing&&(event.keyCode==tab||event.keyCode==enter))spreadView.GetAttribute("error")=="true"&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();if(!$$.utils.isFunctionKey(event.keyCode)&&event.preventDefault==null){event.cancelBubble=true;event.returnValue=true}return true}function rowEditTemplateContainer_textBoxFocus(){if(rowEditTemplateContainer_keyDownEvent&&rowEditTemplateContainer_keyDownEvent.keyCode==tab){rowEditTemplateContainer_textBoxFocusing=true;rowEditTemplateContainer_keyDownEvent.target.fireEvent("onkeydown",rowEditTemplateContainer_keyDownEvent)}}function translateKey(){if(!initialized)return;if(spreadView!=null&&!spreadView.OnSpreadTranslateKey(event))return;var a=getTopSpread(element);ignoreElementActive=false;if(event.type=="keydown"&&event.keyCode==9&&textBox.tabIndex==-1)ignoreElementActive=true;if(!event.returnValue)try{element.preventPopUp=false;var b=getCell(event.srcElement,false);if(isHeaderCell(b)&&!event.ctrlKey)return;if(event.srcElement!=textBox&&getSpreadControl(event.srcElement,true)!=element){if(!retainSelectionBlock)element.focusedOut=true;if(event.keyCode==tab&&a.ProcessTab=="True")isPressTABKeyFromOutSide=true;return}if(typeof element.getAttribute("mcctCellType")!="undefined"&&element.getAttribute("mcctCellType")=="true")return;if(window.document.readyState!="complete")return;if((window.document.activeElement==textBox||window.document.activeElement==element)&&(window.document.FpActiveSpread==null||getTopSpread(window.document.FpActiveSpread)!=a)&&(a.ProcessTab=="True"||event.keyCode!=tab)){spreadView.ActivateSpread(element,true);setTextBoxFocus(true);a.getSpreadView()._HookDocumentFocusInEvent();setActiveSpreadID(a,element.id,element.id)}if(window.document.FpActiveSpread==element){if(element.inDesign&&window.event.altKey)return;keyDown()}}catch(c){}}var keyMap=[];function KeyAction(e,c,b,d,a){this.key=e;this.ctrl=c;this.shift=b;this.alt=d;this.action=a}function RemoveKeyMap(e,g,f,h){for(var d=keyMap.length,b=0;b<d;b++){var a=keyMap[b];if(a!=null&&a.key==e&&a.ctrl==g&&a.shift==f&&a.alt==h){for(var c=b+1;c<d;c++)keyMap[c-1]=keyMap[c];keyMap.length=keyMap.length-1;break}}}function AddKeyMap(a,d,c,e,b){var f=getKeyAction(a,d,c,e);if(f!=null)f.action=b;else{var g=keyMap.length;keyMap.length=g+1;keyMap[g]=new KeyAction(a,d,c,e,b)}}function getKeyAction(c,e,d,f){for(var g=keyMap.length,b=0;b<g;b++){var a=keyMap[b];if(a!=null&&a.key==c&&a.ctrl==e&&a.shift==d&&a.alt==f)return a}return null}function IsValid(){return element.valid!=null?element.valid:true}function MoveToPrevCell(a){var b=EndEdit();if(b)if(a)nextCell(tab,true);else nextCell(left,false)}function MoveToNextCell(a){var b=EndEdit();if(b)if(a)nextCell(tab,false);else nextCell(right,false)}function MoveToNextRow(b){var a=EndEdit();a&&nextCell(down,false,b)}function MoveToPrevRow(b){var a=EndEdit();a&&nextCell(up,false,b)}function MoveToFirstColumn(){var a=EndEdit();a&&nextCell(home,false)}function MoveToLastColumn(){var a=EndEdit();a&&nextCell(end,false)}function CopyLikeExcel(){if(spreadView._NeedUseBrowserBehavior())return;Copy(true)}function CutLikeExcel(){if(spreadView._NeedUseBrowserBehavior())return;Clear(true)}function PasteLikeExcel(){if(spreadView._NeedUseBrowserBehavior())return;Paste(true)}function UpdatePostbackData(){saveData()}function addBrowserDocumentMode(){var c=$$.browser,h=tableData.documentElement,a=tableData.documentElement.selectSingleNode("//browser"),d=$$.browser.securityWarning;if(a==null&&(c.ieversion>=9||d)){var b=typeof tableData.createNode!="undefined";a=b?tableData.createNode("element","browser",""):document.createElement("browser");if(c.ieversion>=9){var g=b?tableData.createNode("element","documentmode",""):document.createElement("documentmode");g.text=document.documentMode;a.appendChild(g);var e=b?tableData.createNode("element","ieversion",""):document.createElement("ieversion");e.text=c.ieversion;a.appendChild(e)}if(d){var f=b?tableData.createNode("element","protocol",""):document.createElement("protocol");f.text=$$.browser.protocol;a.appendChild(f)}h.appendChild(a)}}function saveData(){try{addBrowserDocumentMode();for(var a=getSelection(),b=0;b<a.childNodes.length;b++)if(a.childNodes[b].getAttribute("anchor")!=null){a.removeChild(a.childNodes[b]);break}window.document.getElementById(element.id+"_data").value=encodeURIComponent(tableData.xml)}catch(c){}}function setActiveSpread(){var a=window.event;if(a.type=="mousedown"){if(spreadView.ActiveDialog!=null&&spreadView.GetActiveSpread()==element&&($$.utils.contains(spreadView.ActiveDialog.Dialog,a.srcElement)||spreadView.ActiveDialog.Dialog==a.srcElement))return;var b=GrapeCity.Web.DatePicker.GetInstance();if(b!=null&&getTopSpread(b.Target)==getTopSpread()){var c=b._GetDatePickerContainer();if($$.utils.contains(c,a.srcElement)||c==a.srcElement)return}}setActiveSpreadManually(a.srcElement);ignoreEditorFocus=false}var setActiveSpreadManuallyCalling=false;function setActiveSpreadManually(c){if(setActiveSpreadManuallyCalling)return;setActiveSpreadManuallyCalling=true;var a=window.document.FpActiveSheetView||window.document.FpActiveSpread,b=a!=null?getTopSpread(a).getSpreadView():getTopSpread(element).getSpreadView();b._DetachDocumentFocusIn();__setActiveSpread(c);a=window.document.FpActiveSheetView||window.document.FpActiveSpread;a!=null&&getTopSpread(a).getSpreadView()._HookDocumentFocusInEvent();setActiveSpreadManuallyCalling=false}function __setActiveSpread(target){try{var tsv=getTopSpread(element).getSpreadView();if(tsv.ActiveContextMenu!=null&&tsv.ActiveContextMenu.IsMenuElement(target)&&window.document.FpActiveSpread==element)return;ignoreElementActive=false;if(target==null||target.parentElement==null&&target.tagName!="HTML"&&target.tagName!="BODY")return;if(editing&&target!=null&&target.tagName=="HTML"){var _spread=getSpreadControl(target,true);_spread==null&&window.document.FpActiveSpread==element&&anchorCell!=null&&EndEdit();return}if(element==window.document.FpActiveSpread&&editor&&editor.getAttribute("FpEditor")=="ExtenderEditor"&&editor.getAttribute("Extenders")!=null&&event!=null&&event.type=="mousedown"&&(isChild(event.srcElement,editor)||fpSpreadJS.isAjaxPopup(editor,event.srcElement)))return;var spread=getSpreadControl(target);if(spread==null)spread=spreadView.GetHostSpread(target);if(spread==null)ignoreEditorFocus=true;if(window.document.FpActiveSpread!=spread&&!isExtenderPopupControl(target)){if(target!=editor&&editor!=null)typeof editor.blur!="undefined"&&editor.parentElement!=null&&editor.blur();var oldAs=window.document.FpActiveSpread;if(typeof target.focus!="undefined"&&(target.tagName=="INPUT"||target.tagName=="TEXTAREA"||target.tagName=="SELECT")&&!spreadView.IsFilterBarTextBox(target)){var checkTextSelected=false,targetCell=null,_spreadView=spread!=null?spread.getSpreadView():null;if(_spreadView!=null&&event!=null&&event.type=="mousedown"&&$$.utils.isTextControl(target)&&_spreadView.IsViewportCell(targetCell=getCell(target)))checkTextSelected=!$$.utils.contains(target,window.document.activeElement,true)&&_spreadView.IsEditModeReplace(targetCell);target.focus();checkTextSelected&&_spreadView.GetSpreadContext().checkTextEditorSelect(target,targetCell)}var valid=true,as=window.document.FpActiveSpread;if(as==null)as=element;var _cell=event!=null?getCell(event.srcElement):null,calledEndEdit=as==element&&event!=null&&event.type=="mousedown"&&(_cell!=anchorCell||_cell==event.srcElement)&&getSpreadControl(event.srcElement,true)==element;if(calledEndEdit&&!valid)return;if(as!=null&&(spread==null||spread.mcctCellType!="true")){var ei=as.getEditingInfo();if(event==null||(event.type=="mousedown"||event.type=="focusin")&&ei!=null&&!as.isHandleEvent(event)&&!isChild(event.srcElement,ei.Editor)&&!fpSpreadJS.isAjaxPopup(ei.Editor,target)){var isMouseDown=event!=null&&event.type=="mousedown",ignoreEndEdit;if(isMouseDown){var clickedSpread=getSpreadControl(target,true);ignoreEndEdit=clickedSpread!=null&&clickedSpread.mcctCellType!="true"&&getTopSpread(clickedSpread)!=getTopSpread(element)}else ignoreEndEdit=false;var args={IgnoreFireErrorEvent:getTopSpread(as)!=getTopSpread(element)||isMouseDown&&$$.utils.contains(element,event.srcElement)};if(!ignoreEndEdit&&!as.EndEdit(false,args)){if(getTopSpread(as)==getTopSpread(element))valid=false}else valid=true;calledEndEdit=true}}if(oldAs!=null&&(oldAs!=as||!calledEndEdit)&&(spread==null||spread.mcctCellType!="true")){var ei=oldAs.getEditingInfo();(event==null||event&&event.type=="mousedown"&&ei!=null&&!oldAs.isHandleEvent(event)&&!isChild(event.srcElement,ei.Editor)&&!fpSpreadJS.isAjaxPopup(ei.Editor,target))&&oldAs.EndEdit()}if(spread==null)ignoreEditorFocus=false;if(!valid){if(window.document.FpActiveSpread==element){spread=getSpreadControl(event.srcElement,true);spread==null&&spreadView.ActivateSpread(null,true)}else window.document.FpActiveSpread==null&&spread==element&&event!=null&&event.type=="mousedown"&&spreadView.ActivateSpread(spread,true);return}if(editing&&editModePermanent){ignoreBlur=false;textBoxBlur()}}if(spread==null)var targetSpread=getSpreadControl(target,true);var hitCmdBar=hitCommandBar();if(spread==null){spread=getSpreadControl(target,true);if(hitCmdBar&&spread!=window.document.FpActiveSpread){var valid=spread.EndEdit(false,{IgnoreFireErrorEvent:event!=null&&event.type=="mousedown"});if(!valid)return}}if(spread==null&&window.document.FpActiveSpread==null&&event!=null&&event.type=="mousedown")if(getSpreadControl(event.srcElement,true)==null)return;if(spread==null||spread!=element){var notHide=false;if(spread!=null)if(getTopSpread(element)==getTopSpread(spread)&&window.document.FpActiveSheetView==element)notHide=true;!notHide&&hideSelectionBlock()}if(target==getParent(getViewport())&&getTopSpread(window.document.FpActiveSpread)==element)return;var cell=getCell(target,true);if(cell==null&&dirty){saveData();dirty=false}if(dirty&&(window.document.FpActiveSpread!=element||spread==null||hitCmdBar)){saveData();dirty=false}if(dirty&&window.document.FpActiveSpread==element&&target.tagName=="INPUT"&&(target.type=="submit"||target.type=="button"||target.type=="image")){saveData();dirty=false}if(spread!=null&&spread!=element)return;if(spread!=null&&spread.OperationMode=="ReadOnly")return;if(spread!=null&&getParentSpread()!=null&&tsv.ContextMenus!=null&&window.event&&$$.utils.isRightClick(window.event))return;var topSpread=null;if(spread==null){topSpread=getTopSpread(element);setActiveSpreadID(topSpread,"",null);window.document.FpActiveSpread==element&&spreadView.ActivateSpread(null)}else{var editingSpread=FpSpreadJS.getEditingSpread(getTopSpread(element));if(editingSpread!=null&&editingSpread!=element&&!editingSpread.IsValid()){var ei=editingSpread.getEditingInfo();ei!=null&&ei.Editor!=null&&ei.Editor.focus();event!=null&&event.type=="mousedown"&&$$.utils.cancelBubble(window.event);return}if(spread!=window.document.FpActiveSpread){if(window.document.FpActiveSpread!=null){topSpread=getTopSpread(window.document.FpActiveSpread);setActiveSpreadID(topSpread,"",null)}var activeElement=target,tableRow=FpSpreadJS.getTableRow(activeElement);if(hitCmdBar||activeElement==getParent(getViewport())||activeElement==getParent(getViewport1())||activeElement==getParent(getViewport2())||activeElement!=null&&activeElement.getAttribute&&(activeElement.getAttribute("ControlType")=="chgrayarea"||activeElement.getAttribute("FpSpread")=="rowpadding")||sizeRow!=null||sizeColumn!=null||tableRow!=null&&FpSpreadJS.getTable(tableRow)==getRowHeader()&&FpSpreadJS.isChildSpreadRow(getViewport(),tableRow.rowIndex)){topSpread=getTopSpread(spread);var spreadData=eval(topSpread.id+"_XMLDATA"),activeChild=spreadData.documentElement.selectSingleNode("/root/activechild");if(activeChild!=null&&activeChild.text!="")spreadView.ActivateSpread(window.document.getElementById(activeChild.text),true);else{for(var allSpreads=FpSpreadJS.getAllSpreads(topSpread),i=0;i<allSpreads.length;i++){var ss=allSpreads[i];if(ss.getAnchorCell()!=null&&ss.getAnchorCell().paintSelected){spread=ss;break}}spreadView.ActivateSpread(spread,true)}setActiveSpreadID(topSpread,window.document.FpActiveSpread.id,window.document.FpActiveSpread.id)}else{topSpread=getTopSpread(spread);var old=window.document.FpActiveSpread;if(old!=null&&old!=spread){var oldTopSpread=getTopSpread(old);if(oldTopSpread==getTopSpread(spread))old.ClearSelection(spread);else{var editingSpread=FpSpreadJS.getEditingSpread(topSpread);if(editingSpread!=null&&editingSpread!=spread)spread=editingSpread}}setActiveSpreadID(topSpread,spread.id,spread.id);spreadView.ActivateSpread(spread,true)}}}as!=null&&as!=spreadView.GetActiveSpread()&&(window.event==null||!$$.utils.isOverScrollbar(window.event,window.document.documentElement))&&as.getSpreadView().OnSpreadLostActive(target)}catch(e){$$.DEBUG.Log(e,"setActiveSpread")}}function hideSelectionBlock(){if(!retainSelectionBlock){isactive=false;paintAnchorCell();paintSelections(false);paintAnchorCellHeader(false);hideFocusBorder()}}function isExtenderPopupControl(a){return a==null||!a.id||a.id&&a.id.indexOf(element.id)==-1?false:a.id.indexOf("CalendarExtender")!=-1}function getCellOffsetX(b){if(b==null)return 0;var d=getViewport();if(d==null)return 0;var a=b,c=b.offsetLeft;if(b.parentElement.FpSpread!="rh")c-=d.parentElement.scrollLeft;while(a.offsetParent!=null&&a.offsetParent!=element){c+=a.offsetParent.offsetLeft;a=a.offsetParent}return c}function getCellOffsetY(b){if(b==null)return 0;var d=getViewport();if(d==null)return 0;var a=b,c=b.offsetTop;if(b.parentElement.FpSpread!="ch")c-=d.parentElement.scrollTop;while(a.offsetParent!=null&&a.offsetParent!=element){c+=a.offsetParent.offsetTop;a=a.offsetParent}return c}function setActiveSpreadID(spread,id,child,hitCmdBar){var spreadData=eval(spread.id+"_XMLDATA"),activeSpread=spreadData.documentElement.selectSingleNode("/root/activespread"),activeChild=spreadData.documentElement.selectSingleNode("/root/activechild");if(activeSpread==null||activeChild==null)return;if(hitCmdBar&&activeChild!=null&&activeChild.text!="")activeSpread.text=activeChild.text;else{activeSpread.text=id;if(child!=null)activeChild.text=child}saveData();dirty=false}function getSpreadControl(c,d){if(c!=null&&typeof c.tagName=="undefined")return null;var a=c;while(a!=null&&a.tagName!="BODY"){if(a.FpSpread=="Spread"){if(!d){var b=c;while(b!=null&&b!=a){if(b.id==a.id+"_commandBar"||b.id==a.id+"_pager1"||b.id==a.id+"_pager2")return null;b=b.parentElement}}return a}a=a.parentElement}return null}function ScrollTo(d,c){var b=GetCellByRowCol(d,c);if(b==null)return;var a=getScrollvp();if(a==null)a=getViewport().parentElement;a.fromScrollTo=true;a.scrollTop=b.offsetTop;a.scrollLeft=b.offsetLeft}function scrollView(){if(ignoreMainScroll||element.preventScrollView){if(element.preventScrollView)needDelayScrollView=true;return}var b=getTopSpread();if(b!=element)return;if(typeof b.getRowHeader=="undefined")return;var p=getParent(b.getRowHeader()),o=getParent(b.getColHeader()),n=getParent(b.getColFooter()),g=getScrollvp(),a=getParent(b.getViewport());if(a==null)return;var c=b.getViewport1();if(c!=null&&c.parentElement.scrollLeft!=a.scrollLeft)c.parentElement.scrollLeft=a.scrollLeft;var c=b.getViewport2();if(c!=null&&c.parentElement.scrollTop!=a.scrollTop)c.parentElement.scrollTop=a.scrollTop;if(scrollTop==a.scrollTop&&scrollLeft==a.scrollLeft)return;var i=spreadView._GetScrollValuesState(),j=scrollTop!=a.scrollTop||(i&2)==2,e=scrollLeft!=a.scrollLeft||(i&1)==1,k=e||j;if(engine==8&&g!=null){e=scrollLeft!=g.scrollLeft||(i&1)==1;j=scrollTop!=g.scrollTop||(i&2)==2;k=e||j;if(!k){a.scrollTop=scrollTop;a.scrollLeft=scrollLeft;if(getViewport2()!=null)getViewport2().parentNode.scrollTop=scrollTop;if(getViewport1()!=null)getViewport1().parentNode.scrollLeft=scrollLeft}}if(!k&&(engine<8||g==null))return;var r=scrollTop>a.scrollTop;if(!element.isScrollUp)element.isScrollUp=r;scrollLeft=a.scrollLeft;scrollTop=a.scrollTop;ignoreScroll=true;if(p!=null&&p.scrollTop!=a.scrollTop)p.scrollTop=a.scrollTop;if(o!=null&&o.scrollLeft!=a.scrollLeft)o.scrollLeft=a.scrollLeft;if(n!=null&&n.scrollLeft!=a.scrollLeft)n.scrollLeft=a.scrollLeft;var d=b.getScrollvp();if(d!=null){if(d.scrollLeft!=a.scrollLeft)d.scrollLeft=a.scrollLeft;if(d.scrollTop!=a.scrollTop&&element.virtualPaging!="true")d.scrollTop=a.scrollTop}var x=a.scrollTop;setValidatorPos();if(getParentSpread()==null&&FpSpreadJS.checkInitLayoutCompleted(element)){if(element.getAttribute("virtualPaging")=="true"){var u=ignoreVirtualPaging?a.scrollTop:null;if(element.isScrollUp)spreadView._SetSafeScrollingMIN(u);else spreadView._SetSafeScrollingMAX(u)}element.initialized&&saveScrollbarState(a.scrollTop,a.scrollLeft)}k&&fireScrollEvent(j,e);setTimeout(function(){ignoreScroll=false},200);var t=b.getViewport(),l=spreadView.GetAttribute("error")=="true"&&spreadView._LoadOnDemandTimerId==-1;if(!l&&spreadView._GetTopRowIndex()==spreadView._GetTopDisplayedTableRowIndex(false))l=true;if(element.initialized&&!l&&!r&&a.scrollTop>0&&spreadView.IsLoadOnDemand&&!spreadView.AllRowsLoaded&&(!spreadView.IsBackgroundMode&&a.scrollTop+a.offsetHeight+2>=t.offsetHeight||spreadView.IsBackgroundMode&&spreadView.GetHiddenBottomRowCount()<=spreadView.LoadOffsetFromBottom))if(!editing||getEditor(anchorCell)!=null||smartPaint&&typeof element.forceLOD!="undefined"&&element.forceLOD){if(smartPaint&&typeof element.forceLOD!="undefined")element.forceLOD=null;if(!spreadView.IsBackgroundMode){if(element.LoadState!=null){element.isScrollUp=null;return}element.LoadState=true}var f=getScrollvp();if(f==null)f=getViewport().parentNode;var v=f.scrollLeft,w=f.scrollTop;saveScrollbarState(w,v);saveData();if(!spreadView.IsBackgroundMode){var s=function(){CallBack("LoadOnDemand",true)};if(!spreadView._isRetrievingFilterBarMenus)setTimeout(s,0);else spreadView.RegisterDelayedRequest(Function.CreateDelegate(this,s))}else spreadView.LoadOnDemandInAction()}if(element.initialized&&element.virtualPaging=="true"&&!e&&!ignoreVirtualPaging&&!element.virtualPagingProcessing&&isChild(t,a))if(spreadView.IsLoadOnDemand&&spreadView.IsBackgroundMode||spreadView.GetAttribute("loadOnDemand")!="true"){var h=scrollView,q=false;while(h.caller!=null){h=h.caller;var m=h.toString();callerFuncName=m.substring(m.indexOf("function")+9,m.indexOf("("))||"anoynmous";if(callerFuncName=="processData"){q=true;break}}if(!q&&canMoveToPage().canMove){spreadView.ClearTimeoutTasks();element.virtualPagingProcessing=true;setTimeout(doVirtualPaging,0)}}element.isScrollUp=null}function doVirtualPaging(){var e=getTopSpread(),d=e.getViewport(),c=getParent(d);if(d==null||c==null)return;var a=c.scrollTop;if(element.virtualPagingCurrentScroll!=null&&a==element.virtualPagingCurrentScroll){var f=element.GetCurrentPageIndex(),b=canMoveToPage();b.canMove&&GotoPage(b.ToPage,true);element.virtualPagingProcessing=false}else{element.virtualPagingCurrentScroll=a;setTimeout(doVirtualPaging,500)}}function canMoveToPage(){return spreadView._CanMoveToPage()}function LoadData(a){if(!editing&&element.loadOnDemand=="true")smartPaint=false;CallBack("LoadOnDemand",a)}function saveScrollbarState(scrollTop,scrollLeft,forceSave){if(!forceSave&&!initialized)return;if(!spreadView._IsInitScrollbarState||getParentSpread()!=null)return;var spreadData=eval(element.id+"_XMLDATA"),topNode=spreadData.documentElement.selectSingleNode("/root/scrollTop"),leftNode=spreadData.documentElement.selectSingleNode("/root/scrollLeft");if(element.scrollContent)if(topNode!=null&&leftNode!=null&&(topNode.text!=scrollTop||leftNode.text!=scrollLeft))showScrollingContent(topNode.text==scrollTop);else lastPageIndex!=null&&currentPageIndex!=null&&lastPageIndex!=currentPageIndex&&showScrollingContent(false);if(topNode!=null&&scrollTop>=0)topNode.text=scrollTop;if(leftNode!=null&&scrollLeft>=0)leftNode.text=scrollLeft;dirty=true}function loadScrollbarState(c){if(getParentSpread()!=null)return;if(element.ClientAutoSize=="True"&&(getParentSpread()!=null||spreadView.ClientAutoSizeMaxHeight()==0&&spreadView.ClientAutoSizeMaxWidth()==0))return;if(smartPaint)return;var a=tableData.documentElement.selectSingleNode("/root/scrollTop");if(a!=null&&a.text!="")a=parseInt(a.text);else a=0;c.virtualPagingProcessing=false;var d=getViewport();a=a>0&&a>=c.virtualTop?a:a+c.virtualTop;var b=tableData.documentElement.selectSingleNode("/root/scrollLeft");if(b!=null&&b.text!="")b=parseInt(b.text);else b=0;if(isNaN(a))a=0;if(isNaN(b))b=0;ignoreVirtualPaging=true;setScrollbarValues(a,b);ignoreVirtualPaging=false}function getParent(a){return a==null?null:a.parentElement}function getViewport(){return viewport}function getCommandBar(){return commandBar}function getRowHeader(){return rowHeader}function getColHeader(){return colHeader}function getColFooter(){return colFooter}function getCmdBtn(c){var a=getTopSpread(),b=a.getCommandBar();return b!=null?window.document.getElementById(a.id+"_"+c):null}function Range(){reset(this)}function setRange(a,b,e,d,g,f,c){a.type=b;a.row=e;a.col=d;a.rowCount=g;a.colCount=f;a.innerRow=c;if(b=="Row")a.col=a.colCount=-1;else if(b=="Column")a.row=a.rowCount=-1;else if(b=="Table"){a.col=a.colCount=-1;a.row=a.rowCount=-1}}function reset(a){a.type="Cell";a.row=-1;a.col=-1;a.rowCount=0;a.colCount=0;a.innerRow=0}function Margin(){this.left;this.top;this.right;this.bottom}function findContentTag(a){if(a){if(a.attributes&&a.getAttribute("content"))return a;for(var b=0;b<a.childNodes.length;b++){var c=findContentTag(a.childNodes[b]);if(c)return c}}return null}function getRender(a){return fpSpreadJS.getRender(a)}var getCell=typeof $$!="undefined"?$$.utils.GetCell:null;function inFrozCols(a){return isChild(a,getFrozColHeader())||isChild(a,getViewport0())||isChild(a,getViewport2())}function inFrozRows(a){isChild(a,getFrozRowHeader())||isChild(a,getViewport0())||isChild(a,getViewport1())}function inRowHeader(a){return isChild(a,getFrozRowHeader())||isChild(a,getRowHeader())}function inColHeader(a){return isChild(a,getFrozColHeader())||isChild(a,getColHeader())}function isHeaderCell(a){return a!=null&&(a.tagName=="TD"||a.tagName=="TH")&&a.parentElement&&(a.parentElement.FpSpread=="ch"||a.parentElement.FpSpread=="rh")}function getSizeColumn(i){var q=getSizeHeader();if(!q&&getColHeader()==null&&getFrozColHeader()==null)return null;if(i==null||i.tagName=="INPUT"||i.tagName=="TEXTAREA"||i.tagName=="SELECT"||i.tagName=="BR")return null;var g=window.event,a=-1,b=getCell(i);while(b!=null&&b.parentElement!=null){if(b.parentElement.FpSpread=="ch"){var h=b.getBoundingClientRect();if(Math.abs(g.clientX-h.left)<3)a=getColFromCell(b)-1;else if(Math.abs(g.clientX-h.right)<3){a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,colSpanCells);if(d!=null)a=d.col+d.colCount-1}else{a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,colSpanCells);if(d!=null){var k=h.left;a=-1;for(var e=d.col;e<d.col+d.colCount&&e<GetColCount();e++){if(isChild(b,getColHeader()))k+=parseInt(window.document.getElementById(element.id+"col"+e).width);else k+=parseInt(window.document.getElementById(element.id+"col"+e).width);if(Math.abs(g.clientX-k)<3){a=e;break}}}else a=-1}if(isNaN(a)||a<0)return null;var j=0,m=GetColCount(),l=true,s=null,c=a+1;while(c<m){if(c>=frzCols){var n=getColGroup(getColHeader());if(c-frzCols<n.childNodes.length)j=parseInt(n.childNodes[c-frzCols].width)}else{var n=getColGroup(getFrozColHeader());if(c<n.childNodes.length)j=parseInt(n.childNodes[c].width)}if(j>1){l=false;break}c++}if(l){c=a+1;while(c<m){if(getSizable(c)){a=c;break}c++}}return!getSizable(a)?null:isChild(b,getColHeader())?Math.abs(g.clientX-h.left)<3&&a+1==frzCols&&b.cellIndex==0&&getFrozColHeader()!=null?window.document.getElementById(element.id+"col"+(frzCols-1)):window.document.getElementById(element.id+"col"+a):window.document.getElementById(element.id+"col"+a)}else if(b.parentElement.FpSpread=="rh"){if(!getSizeHeader())return;var h=b.getBoundingClientRect(),f=getColGroup(getRowHeader());if(f==null||f.childNodes.length==0)return null;if(Math.abs(g.clientX-h.left)<3)a=getColFromCell(b)-1;else if(Math.abs(g.clientX-h.right)<4){a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,rowSpanCells);if(d!=null)a=d.col+d.colCount-1}else{a=getColFromCell(b);var d=getSpanCell(b.parentElement.rowIndex,a,rowSpanCells);if(d!=null){var k=h.left;a=-1;for(var r=f.children.length,e=d.col;e<d.col+d.colCount&&e<r;e++){k+=parseInt(f.children(e).width);if(Math.abs(g.clientX-k)<3){a=e;break}}}else a=-1}if(isNaN(a)||a<0)return null;var j=0,m=f.children.length,l=true,c=a+1;while(c<m){var p=f.children(c);if(p!=null)j=parseInt(p.width);if(j>1){l=false;break}c++}if(l){c=a+1;while(c<m){if(getSizable(f.children(c))){a=c;break}c++}}var o=f.children(a);return!getSizable(o)?null:o}b=b.parentElement}return null}function getElementById(c,b){if(c==null)return null;var a=c.firstChild;while(a!=null){if(a.id==b||a.name==b)return a;var d=getElementById(a,b);if(d!=null)return d;a=a.nextSibling}return null}function getBoundingClientRectForRow(c,a){var g=a!=null?a:0,d=c.getBoundingClientRect(),f=d.top,b=c.nextSibling,e=b?b.getBoundingClientRect().top-g:d.bottom;return{top:f,bottom:e}}function getSizeRow(e){var k=GetRowCount();if(k==0)return null;if(element.layoutMode)return null;if(e==null||e.tagName=="INPUT"||e.tagName=="TEXTAREA"||e.tagName=="SELECT")return null;var h=window.event,g=getCell(e);if(g==null){var c=e.getBoundingClientRect();if(e.FpSpread=="rowpadding"){if(Math.abs(h.clientY-c.top)<3){var a=e.parentElement.rowIndex;if(a>1){var q=e.parentElement.parentElement.rows(a-1);if(getSizable(q))return q}}if(e!=null&&e.style!=null&&(e.FpSpread=="rowpadding"||e.ControlType=="chgrayarea"))e.style.cursor=getgrayAreaCursor()}var p=getCorner();if(p!=null&&p.contains(e))if(h.clientY-c.bottom>4){var b=getFrozRowHeader(),a=0;if(b!=null){while(a<b.rows.length&&b.rows(a).offsetHeight<2&&!getSizable(b.rows(a)))a++;if(a<b.rows.length&&getSizable(b.rows(a))&&b.rows(a).offsetHeight<2)return b.rows(a)}b=getRowHeader();if(b!=null){while(a<b.rows.length&&b.rows(a).offsetHeight<2&&!getSizable(b.rows(a)))a++;if(a<b.rows.length&&getSizable(b.rows(a))&&b.rows(a).offsetHeight<2)return b.rows(a)}}else e.style.cursor="";return null}var m=isChild(g,getFrozRowHeader()),o=parseInt(getViewport().cellSpacing),d=g;while(d!=null){if(d.FpSpread=="rh"){var c=getBoundingClientRectForRow(d,o),a=-1;if(Math.abs(h.clientY-c.top)<3){if(d.rowIndex>0)a=d.rowIndex-1;else if(d.rowIndex==0&&!m&&getFrozRowHeader()!=null){m=true;a=frzRows-1}}else if(Math.abs(h.clientY-c.bottom)<3)a=d.rowIndex;else if(h.clientY-c.bottom>4){var i=getSpanCell(getRowFromCell(g),getColFromCell(g),rowSpanCells);if(i!=null)for(var f=i.row;f<i.row+i.rowCount;f++){var r=m?getFrozRowHeader().rows(f):getRowHeader().rows(f-frzRows),c=getBoundingClientRectForRow(r,o);if(Math.abs(h.clientY-c.top)<3){if(f>0)a=f-1;break}else if(Math.abs(h.clientY-c.bottom)<3){a=f;break}}else if(d.rowIndex>=0)a=d.rowIndex}else break;var l=0,k=getRowHeader().rows.length;if(m)k=getFrozRowHeader().rows.length;var n=true,b=null;if(m)b=getFrozRowHeader();else b=getRowHeader();var c=a+1;while(c<k){if(b.rows(c).style.posHeight!=null)l=b.rows(c).style.posHeight;else l=getOffsetHeight(b.rows(c));if(l>1){n=false;break}c++}if(n){c=a+1;while(c<k){if(getSizable(getRowHeader().rows(c))){a=c;break}c++}}if(a>=0&&getSizable(b.rows(a)))return b.rows(a);else if(Math.abs(h.clientY-c.top)<3){while(a>1&&getOffsetHeight(b.rows(a))==0&&!getSizable(b.rows(a)))a--;return a>=0&&getSizable(b.rows(a))?b.rows(a):null}}else if(d.FpSpread=="ch"){if(!getSizeHeader())return;var c=getBoundingClientRectForRow(d,o),b=getColHeader();if(b==null)return null;if(getColFromCell(g)==GetColCount())return null;var j=h.clientY,a=-1;if(Math.abs(j-c.top)<3){if(d.rowIndex>0)a=d.rowIndex-1}else if(Math.abs(j-c.bottom)<3)a=d.rowIndex;else if(j-c.bottom>4){var i=getSpanCell(getRowFromCell(g),getColFromCell(g),colSpanCells);if(i!=null)for(var f=i.row;f<i.row+i.rowCount;f++){c=getBoundingClientRectForRow(b.rows(f),o);if(Math.abs(j-c.top)<3){if(f>0)a=f-1;break}else if(Math.abs(j-c.bottom)<3){a=f;break}}else if(d.rowIndex>=0)a=d.rowIndex}else break;var l=0,k=b.rows.length,n=true,c=a+1;while(c<k){if(b.rows(c).style.posHeight!=null)l=b.rows(c).style.posHeight;else l=getOffsetHeight(b.rows(c));if(l>1){n=false;break}c++}if(n){c=a+1;while(c<k){if(getSizable(b.rows(c))){a=c;break}c++}}if(a>=0&&getSizable(b.rows(a)))return b.rows(a);else if(Math.abs(j-c.top)<3){while(a>1&&getOffsetHeight(b.rows(a))==0&&!getSizable(b.rows(a)))a--;return a>=0&&getSizable(b.rows(a))?b.rows(a):null}}d=d.parentElement}g.style.cursor="";return null}function getSizable(a){if(typeof a=="number")if(a<frzCols){var b=window.document.getElementById(element.id+"col"+a);return b!=null&&(typeof b.Sizable=="undefined"||b.Sizable=="True")}else{var b=window.document.getElementById(element.id+"col"+a);return b!=null&&(typeof b.Sizable=="undefined"||b.Sizable=="True")}return a!=null&&(typeof a.Sizable=="undefined"||a.Sizable=="True")}function getSpanWidth(c,f){var e=0,a=getViewport2();if(a==null)a=getViewport0();if(frzCols>0&&c<frzCols&&a!=null){var d=getColGroup(a);if(d!=null)for(var b=c;b<c+f&&b<frzCols;b++)e+=parseInt(d.childNodes[b].width)}a=getViewport();if(a==null)a=getViewport1();var d=getColGroup(a);if(d!=null)for(var b=Math.max(c,frzCols);b<c+f;b++)e+=parseInt(d.childNodes[b-frzCols].width);return e}function getCellType(a){if(a!=null&&a.FpCellType!=null)return a.FpCellType;if(a!=null&&a.FpRef!=null){var b=window.document.getElementById(a.FpRef);return b!=null?b.FpCellType:"text"}return a!=null&&a.FpCellType!=null?a.FpCellType:"text"}function getCellType2(a){if(a!=null&&a.FpRef!=null)a=window.document.getElementById(a.FpRef);var b=null;if(a!=null){b=a.FpCellType;if(typeof b=="undefined"||b=="readonly")b=a.CellType;if(b==null)b=a.CellType2}return b!=null?b:"text"}function getCellEditorID(a){if(a!=null&&a.FpRef!=null){var c=window.document.getElementById(a.FpRef),b=c.FpEditorID;if(b==null)b=element.FpDefaultEditorID;return b}return a!=null&&a.FpEditorID!=null?a.FpEditorID:element.FpDefaultEditorID}function EditorMap(a,b){this.id=a;this.editor=b}function ValidatorMap(a,b){this.id=a;this.validator=b}function getCellEditor(b,e){for(var a=null,c=0;c<editorList.length;c++){var d=editorList[c];if(d.id==b){a=d.editor;break}}if(a==null){a=window.document.getElementById(b);editorList[editorList.length]=new EditorMap(b,a)}return e?a:a.cloneNode(true)}function getCellValidatorID(a){return a==null?null:a.FpValidatorID}function getCellValidator(b){for(var a=null,c=0;c<validatorList.length;c++){var d=validatorList[c];if(d.id==b){a=d.validator;break}}if(a==null){a=window.document.getElementById(b);validatorList[validatorList.length]=new ValidatorMap(b,a)}return a}function getTableRow(c){var a=tableData.documentElement.selectSingleNode("//data");if(a==null)return null;var b=a.selectSingleNode("./row[@key='"+c+"']");return b}function getTableCell(a,c){if(a==null)return null;var b=a.selectSingleNode("./cell[@key='"+c+"']");return b}function addTableRow(b){if(b==null)return null;var a=getTableRow(b);if(a!=null)return a;var d=tableData.documentElement.selectSingleNode("//data");if(d==null)return null;a=tableData.createNode("element","row","");var c=tableData.createNode("attribute","key","");c.text=b;a.attributes.setNamedItem(c);d.appendChild(a);return a}function addTableCell(c,d){if(c==null)return null;var a=getTableCell(c,d);if(a!=null)return a;a=tableData.createNode("element","cell","");var b=tableData.createNode("attribute","key","");if(d==null)b.text="";else b.text=d;a.attributes.setNamedItem(b);c.appendChild(a);return a}function getCellValue(b,c){if(b==null)return null;var e=getRowKeyFromCell(b),d=element.layoutMode?getColKeyFromCell2(b):getColKeyFromCell(b),a=getTableCell(getTableRow(e),d);return a!=null?c&&a.getAttribute("type")!=null?{value:xmlData.textContent(a),isXmlValue:true}:a.text:null}function setCellValue(a,b,p,q){if(a==null)return;if(b==" ")a.whiteSpace="1";else a.whiteSpace=null;if(a.specialValue!=null)a.specialValue=null;if(b==""){var l=getCellEditorID(a);if(l!=null){var k=getCellEditor(l,true);if(k!=null&&k.tagName=="SELECT")a.specialValue="1"}}var o=getCellType(a);if(o=="readonly"&&a.getAttribute("locked")=="true"&&a.CellType2!="MutuallyExclusiveCheckBoxCellType")return;var j=getRowKeyFromCell(a),h=element.layoutMode?getColKeyFromCell2(a):getColKeyFromCell(a);if(j==null||h==null)return;var f=addTableCell(addTableRow(j),h);if(b.getFullYear){b=spreadView.GetDateValueXmlString(b);f.setAttribute("type","Date")}else if(typeof b=="number")f.setAttribute("type","Number");else f.removeAttribute("type");f.text=b;if(!p){fireDataChangedEvent(a,b,element,j,h);var m=getTopSpread(element);m!=element&&m.Behavior.fireDataChangedEvent(a,b,element,j,h)}if(smartPaint){var g=getRowFromCell(a)-frzRows,n=getViewport(),r=getViewport2(),d=null;if(isChild(a,n)){saveRowsImp(n,g,1,vpList);d=vpList.getRow(g)}else if(isChild(a,r)){saveRowsImp(viewport2,g,1,vp2List);d=vp2List.getRow(g)}if(d!=null)for(var i=0;i<d.cells.length;i++){var e=$$.utils.cloneNode(d.cells[i]);if(e.paintSelected=="null")e.paintSelected=null;d.replaceChild(e,d.cells[i]);paintSelectedCell(e,false,false)}}var c=getCmdBtn("Update");c!=null&&c.disabled&&updateCmdBtnState(c,false);c=getCmdBtn("Cancel");c!=null&&c.disabled&&updateCmdBtnState(c,false);dirty=true;q&&updateValues()}function clearCellData(){var f=tableData.documentElement.selectSingleNode("//data");if(f==null)return null;if(dataBuff!=null){var c=dataBuff.firstChild;while(c!=null){var k=c.getAttribute("key"),d=c.firstChild;while(d!=null){var j=d.getAttribute("key"),a=f.firstChild;while(a!=null){var i=a.getAttribute("key");if(k==i){var e=false,b=a.firstChild;while(b!=null){var h=b.getAttribute("key");if(j==h){a.removeChild(b);e=true;break}b=b.nextSibling}if(e)break}a=a.nextSibling}d=d.nextSibling}c=c.nextSibling}}dataBuff=null;var g=getCmdBtn("Cancel");g!=null&&updateCmdBtnState(g,true)}function storePostData(){var a=tableData.documentElement.selectSingleNode("//data");if(a!=null)dataBuff=a.cloneNode(true)}function GetSelectedRanges(){var e=getSelection(),b=[],a=e.firstChild;while(a!=null){var c=new Range;getRangeFromNode(a,c);var d=b.length;b.length=d+1;b[d]=c;a=a.nextSibling}return b}function GetSelectedRange(){var b=new Range,c=getSelection(),a=c.lastChild;a!=null&&getRangeFromNode(a,b);return b}function getRangeFromNode(a,i){if(a==null||i==null)return;i.anchor=a.getAttribute("anchor")!=null;updateSelectionViewIndexes(a);var b=parseInt(a.getAttribute("rowIndex")),f=parseInt(a.getAttribute("colIndex")),c=parseInt(a.getAttribute("rowcount")),h=parseInt(a.getAttribute("colcount")),e;if(frzRows==0&&frzCols==0){var g=getViewport();if(g!=null){for(var m=b,j=m;j<m+c;j++)if(IsChildSpreadRow(g,j))c--;b=GetSheetIndex(b,g)}}if(element.layoutMode){var l=parseInt(a.getAttribute("col"));if(l!=-1&&parseInt(a.getAttribute("row"))==-1&&c==-1){b=parseInt(a.getAttribute("row"));e=parseInt(a.getAttribute("rowIndex"));if(e==-1){var n=getRowKeyFromRow(0),k=getCellByRowCol2(n,l);if(k)e=getRowFromCell(k)}}}var d=null;if(b<0&&f<0&&c!=0&&h!=0)d="Table";else if(b<0&&f>=0&&h>0)d="Column";else if(f<0&&b>=0&&c>0)d="Row";else d="Cell";setRange(i,d,b,f,c,h,e)}function getSelection(){return tableData.documentElement.selectSingleNode("//selection")}function getRowKeyFromRow2(b){var a=getRowKeyFromRow(b);return a==null?-1:a}function getRowKeyFromRow(b){if(b<0)return null;var a=null;if(b<frzRows){a=getViewport0();if(a==null)a=getViewport1()}else{a=getViewport2();if(a==null)a=getViewport()}if(b>=frzRows)b-=frzRows;return a.rows(b)==null&&a.rows[b]==null?-1:a.rows(b)!=null?a.rows(b).FpKey:a.rows[b].FpKey}function getColKeyFromCol(b){if(b<0)return null;var a=null;if(b>=frzCols){a=getViewport1();if(a==null)a=getViewport();if(a==null)a=getColHeader()}else{a=getViewport0();if(a==null)a=getViewport2();if(a==null)a=getFrozColHeader()}if(b>=frzCols)b=b-frzCols;var c=getColGroup(a);return c!=null&&b>=0&&b<c.childNodes.length?c.childNodes[b].FpCol:null}function getColKeyFromCol3(b){var a=getColKeyFromCol(b);return a==null?-1:a}function getColGroup(b){if(b==null)return null;var a=b.getElementsByTagName("COLGROUP");return a!=null&&a.length>0?a[0]:null}function getRowKeyFromCell(a){return a.parentElement.FpKey}function getColKeyFromCol2(c,b){var a=getCellFromRowCol(c,b);return a?getColKeyFromCell2(a):b}function getColKeyFromCell2(a){return!a?-1:a.col?a.col=="-1"?"0":a.col:getColKeyFromCell(a)}function getRowTemplateRowFromCell(a){if(!a)return-1;try{var b;if(a.group!=null)b=getRowTemplateRowFromGroupCell(a);else b=parseInt(a.parentElement.row);return b}catch(c){return-1}}function getRowTemplateRowFromGroupCell(b,k){var l=GetColCount(),h=getColHeader();if((!element.allowGroup||k)&&h!=null)for(var f=0;f<h.rows.length;f++)for(var i=0;i<l;i++){var j=h.rows(f).cells(i),g=isNaN(b)?parseInt(b.col):b;if(j!=null&&b!=null&&parseInt(j.col)==g)return f}var d=getViewport1();if(d!=null)for(var a=0;a<d.rows.length;a++)for(var c=0;c<d.rows(a).cells.length;c++){var g=isNaN(b)?parseInt(b.col):b;if(d.rows(a).cells(c).col==g&&d.rows(a).cells(c).group==null)return parseInt(d.rows(a).FpKey)}var e=getViewport();if(e!=null)for(var a=0;a<e.rows.length;a++)for(var c=0;c<e.rows(a).cells.length;c++){var g=isNaN(b)?parseInt(b.col):b;if(e.rows(a).cells(c).col==g&&e.rows(a).cells(c).group==null)return parseInt(e.rows(a).FpKey)}return-1}function getColTemplateRowFromGroupCell(e){var g=GetColCount(),a=getColHeader(),h=getRowTemplateRowFromGroupCell(e,true),f=null;if(a==null)return-1;for(var c=0;c<a.rows.length;c++)for(var d=0;d<g;d++){var b=a.rows(c).cells(d);if(b!=null&&parseInt(b.col)==e){f=b;break}}return getColFromCell(f)}function getRowTemplateRowFromGroupCell2(c){var d=getViewport1();if(d!=null)for(var a=0;a<d.rows.length;a++)for(var b=0;b<d.rows(a).cells.length;b++){var f=isNaN(c)?parseInt(c.col):c;if(d.rows(a).cells(b).col==f&&d.rows(a).cells(b).group==null)return parseInt(d.rows(a).FpKey)}var e=getViewport();if(e!=null)for(var a=0;a<e.rows.length;a++)for(var b=0;b<e.rows(a).cells.length;b++){var f=isNaN(c)?parseInt(c.col):c;if(e.rows(a).cells(b).col==f&&e.rows(a).cells(b).group==null)return parseInt(e.rows(a).FpKey)}return-1}function getCellByRowCol2(c,b){if(c==null||b==null||c.length<=0||b.length<=0||c=="-1"||b=="-1")return null;var d=getRowByKey(c,-1);if(d==-1)return null;for(var h=parseInt(element.layoutRowCount),f=d;f<d+h;f++)for(var g=getTableRows(f),a=0;a<g.length;a++)for(var e=g[a],a=0;a<e.cells.length;a++)if(e.cells[a].getAttribute("col")==b)return e.cells[a];return null}function getTableRows(c){var d=[],a=[getViewport0(),getViewport1()];if(c>=frzRows){c-=frzRows;a=[getViewport2(),getViewport()]}for(var b=0;b<a.length;b++)a[b]!=null&&a[b].rows[c]!=null&&d.push(a[b].rows[c]);return d}function paintMultipleRowSelection(k,h,f,d,e){for(var j=GetRowCountInternal(),i=GetColCount(),g=true,a=0;a<j;a++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(getViewport(),a))continue;for(var c=null,b=h;b<h+d&&b<i;b++){if(isCovered(a,b,spanCells))continue;c=getCellFromRowCol(a,b,c);if(c!=null&&parseInt(c.parentElement.row)==k){paintViewportSelection(a,b,f,d,e);getColHeader()!=null&&operationMode=="Normal"&&g&&paintHeaderSelection(a,b,f,d,e,true);getRowHeader()!=null&&paintHeaderSelection(a,b,f,d,e,false);g=false}}}paintAnchorCell()}function getRowFromViewPort(c,d){if(c<0||d<0)return null;var a=null;if(c<frzRows)a=getViewport1();else a=getViewport();if(c>=0&&c<a.rows.length)for(var b=0;b<a.rows.length;b++)if(a.rows(b).row!=null&&parseInt(a.rows(b).row)==c)return b;return 0}function getFirstRowFromKey(b){var a=getRowByKey(b,-1);return a>-1?a:null}function getFirstMultiRowFromViewport(f,h){var a=null,c=null;if(f<frzRows)a=getViewport1();else a=getViewport();if(!h){c=getRowKeyFromRow(f);if(c!=null)return getRowByKey(c,-1)}for(var g=parseInt(element.layoutRowCount),e,b=0;b<a.rows.length;b++){e=0;if(c!=null){if(a.rows(b).FpKey==c)return frzRows!=null&&f<frzRows?b:b+frzRows}else for(var d=b+1;d<a.rows.length;d++){if(a.rows(b)!=null&&a.rows(d)!=null&&a.rows(b).FpKey==a.rows(d).FpKey)e++;if(e==g-1)return b}}}function getDisplayIndex(b){if(b==null)return-1;if(!element.allowGroup)return b!=null?GetDisplayIndex(b):0;else{var d=getViewport1();if(d!=null)for(var a=b;a<d.rows.length;a++)if(d.rows(a).getAttribute("row")==b)return a;var c=getViewport();if(c!=null)for(var a=b;a<c.rows.length;a++){if(IsChildSpreadRow(c,a))continue;if(c.rows(a).getAttribute("row")==b)return a}}return-1}function getColKeyFromCell(c){var a=getColFromCell(c);if(a>=frzCols){vp=getViewport();if(vp==null||!isChild(c,vp))vp=getViewport1();var b=getColGroup(vp);if(b!=null&&a-frzCols>=0&&a-frzCols<b.childNodes.length)return b.childNodes[a-frzCols].FpCol}else{vp=getViewport0();if(vp==null||!isChild(c,vp))vp=getViewport2();var b=getColGroup(vp);if(b!=null&&a>=0&&a<b.childNodes.length)return b.childNodes[a].FpCol}return null}function setSelection(c,b,h,g,j,e,f){var l=tableData.documentElement.selectSingleNode("//selection");if(l==null)return;if(h==-1&&e!=null)e=-1;if(g==-1&&f!=null)f=-1;var d=c,k=f==null?b:f;if(typeof c!="undefined"&&parseInt(c)>=0){c=getRowKeyFromRow(c);if(c!="newRow")c=parseInt(c)}if(typeof b!="undefined"&&parseInt(b)>=0)if(element.layoutMode){var m=d>-1?d:e;if(m>-1){var o=getCellFromRowCol(m,k);if(o&&o.col!="-1")b=parseInt(getColKeyFromCol2(d,b));else b=-1}}else b=parseInt(getColKeyFromCol(b));if(element.layoutMode&&e!=null)d=e;if(j==null)j=element.multiRange=="true"&&event!=null&&event.type!="mousemove";var a=l.lastChild;if(a==null||j){a=createSelectionNode(c,b,h,g,d,k);l.appendChild(a)}else{a.attributes.getNamedItem("row").text=c;a.attributes.getNamedItem("col").text=b;a.attributes.getNamedItem("rowcount").text=h;a.attributes.getNamedItem("colcount").text=g;if(a.attributes.getNamedItem("rowIndex")==null){var n=tableData.createNode("attribute","rowIndex","");a.attributes.setNamedItem(n)}a.attributes.getNamedItem("rowIndex").text=d;if(a.attributes.getNamedItem("colIndex")==null){var n=tableData.createNode("attribute","colIndex","");a.attributes.setNamedItem(n)}a.attributes.getNamedItem("colIndex").text=k}(h>1||g>1)&&a.removeAttribute("anchor");dirty=true;var p=getCmdBtn("Update");updateCmdBtnState(p,false);inactiveAllChart(element);fireSelectionChangedEvent(element);var i=getTopSpread(element);if(i!=element)i.inactiveAllChart(i),i.Behavior.fireSelectionChangedEvent(element);paintFocusRect();!(selectType=="c"&&activeElement!=null&&activeElement.tagName.toUpperCase()=="SELECT")&&!($$.utils.isTextControl(activeElement)&&IsInRowEditTemplate(activeElement)&&activeElement.style.imeMode!="")&&fpSpreadJS.setImeMode(element,textBox,anchorCell)}function createSelectionNode(h,g,e,c,f,d){var b=tableData.createNode("element","range",""),a=tableData.createNode("attribute","row","");a.text=h;b.attributes.setNamedItem(a);a=tableData.createNode("attribute","col","");a.text=g;b.attributes.setNamedItem(a);a=tableData.createNode("attribute","rowcount","");a.text=e;b.attributes.setNamedItem(a);a=tableData.createNode("attribute","colcount","");a.text=c;b.attributes.setNamedItem(a);a=tableData.createNode("attribute","rowIndex","");a.text=f;b.attributes.setNamedItem(a);a=tableData.createNode("attribute","colIndex","");a.text=d;b.attributes.setNamedItem(a);return b}function addRowToSelection(d,a){if(element.layoutMode&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))return;var b=a;if(typeof a!="undefined"&&parseInt(a)>=0){a=getRowKeyFromRow(a);if(a!="newRow")a=parseInt(a)}if(!isRowSelected(a)&&!isNaN(a)){var c=createSelectionNode(a,-1,1,-1,b,-1);d.appendChild(c)}}function RemoveSelection(f){var c=tableData.documentElement.selectSingleNode("//selection");if(c==null)return;var a=c.firstChild;while(a!=null){var b,d;if(element.layoutMode&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect")){var i=parseInt(a.getAttribute("row"));b=getFirstRowFromKey(i)}else b=parseInt(a.getAttribute("rowIndex"));if(element.layoutMode&&(operationMode=="ExtendedSelect"||operationMode=="MultiSelect"))d=parseInt(element.layoutRowCount);else d=parseInt(a.attributes.getNamedItem("rowcount").text);if(b<=f&&f<b+d){c.removeChild(a);for(var e=b;e<b+d;e++)e!=f&&addRowToSelection(c,e);break}a=a.nextSibling}dirty=true;var h=getCmdBtn("Update");updateCmdBtnState(h,false);fireSelectionChangedEvent(element);var g=getTopSpread(element);g!=element&&g.Behavior.fireSelectionChangedEvent(element)}function updateSelectionViewIndexes(c){if(c.getAttribute("rowIndex")==null||c.getAttribute("colIndex")==null){var a=c.getAttribute("row"),f=parseInt(c.getAttribute("col")),e=a==-1?-1:null,d=f==-1?-1:null;if(element.layoutMode){var b=null;if(f>-1)if(a=="newRow"||parseInt(a)>-1){b=getCellByRowCol2(a,f);if(b){e=getRowFromCell(b);d=getColFromCell(b)}}else{b=getFirstCellFromCol(c.getAttribute("col"));if(b)d=getColFromCell(b)}else if(a=="newRow"||parseInt(a)>-1)e=getFirstRowFromKey(a)}else{if(a=="newRow"||parseInt(a)>-1)e=getRowByKey(a,-1);if(f>-1)d=getColByKey(f,-1)}e!=null&&c.setAttribute("rowIndex",e);d!=null&&c.setAttribute("colIndex",d)}}function getColInfo(d,f){var b=tableData.documentElement.selectSingleNode("//colinfo");if(b==null)return null;if(f)return b.selectSingleNode("./col[@key='"+d+"'][@header='true']");var a=b.selectNodes("./col[@key='"+d+"']");if(a!=null)for(var c=0;c<a.length;c++){var e=a[c];if(e.getAttribute("header")!="true")return e}return null}function getColWidthFromCol(b){if(b<0)return 0;if(b<frzCols){var a=getColGroup(getViewport0());if(a==null||a.childNodes.length==0)a=getColGroup(getViewport2());if(a==null||a.childNodes.length==0)a=getColGroup(getFrozColHeader());return a!=null&&b<a.childNodes.length?parseInt(a.childNodes[b].width):0}else{var a=getColGroup(getViewport1());if(a==null||a.childNodes.length==0)a=getColGroup(getViewport());if(a==null||a.childNodes.length==0)a=getColGroup(getColHeader());return a!=null&&b-frzCols<a.childNodes.length?parseInt(a.childNodes[b-frzCols].width):0}}function getColWidth(a){if(a==null)return null;var b=a.selectSingleNode("./width");return b!=null?b.text:null}function addColInfo(e,c){var a=getColInfo(e,c);if(a!=null)return a;var d=tableData.documentElement.selectSingleNode("//colinfo");if(d==null)return null;a=tableData.createNode("element","col","");var b=tableData.createNode("attribute","key","");b.text=e;a.attributes.setNamedItem(b);if(c){b=tableData.createNode("attribute","header","");b.text="true";a.attributes.setNamedItem(b)}d.appendChild(a);return a}function setColWidthForViewport(b,e,c,d){if(b!=null){var a=getColGroup(b);if(a.childNodes.length==0)a=getColGroup(getFrozColHeader());setColGroupWidth(a,e,c,d)}}function setColWidthForColFooter(b,e,c,d){if(b!=null){var a=getColGroup(b);if(a.childNodes.length==0)a=getColGroup(getFrozColFooter());setColGroupWidth(a,e,c,d)}}function getFrozColFooterColWidth(a){var c=0,b=getColGroup(getFrozColFooter());if(b!=null&&0<=a&&a<b.childNodes.length)c=parseInt(b.childNodes[a].width);return c}function setColGroupWidth(a,b,d,c){if(a!=null)if(c==null)a.childNodes[b].width=d;else a.childNodes[b].width=Math.max(1,parseInt(a.childNodes[b].width)+c)}function getFrozViewportColWidth(b){var c=0,a=getColGroup(getFrozColHeader());if(a==null||a.childNodes.length==0)a=getColGroup(getViewport0());if(a==null||a.childNodes.length==0)a=getColGroup(getViewport2());if(a!=null&&0<=b&&b<a.childNodes.length)c=parseInt(a.childNodes[b].width);return c}function setColWidth(b,a,f){if(b==null)return false;b=parseInt(b);if(a<10)a=10;var i=0,e=null;if(f!=null)e=a-f;var g=null,r=getColWidthFromCol(b);if(b<frzCols){var k=getViewport0(),h=f;if(h==null)h=getFrozViewportColWidth(b);setColWidthForViewport(k,b,a,e);var o=getViewport2();setColWidthForViewport(o,b,a,e);if(getFrozColFooter()!=null){if(h==null)h=getFrozColFooterColWidth(b);setColWidthForColFooter(getFrozColFooter(),b,a,e)}if(k==null)k=o;if(k!=null){var c=getColGroup(k);if(c.childNodes.length==0)c=getColGroup(getFrozColHeader());g=addColInfo(c.childNodes[b].FpCol);if(xhtml&&b==0)i=1;if(!xhtml&&b==0)i=-2;var q=getViewportHolder();if(q!=null)q.children(0).rows(0).cells(0).style.posWidth+=a-h}if(getFrozColHeader()!=null){getFrozColHeader().parentElement.style.posWidth=a;var s=window.document.getElementById(element.id+"_hidencol2");s.style.posWidth+=a-h;getFrozColHeader().parentElement.parentElement.style.posWidth=getFrozColHeader().parentElement.style.posWidth;if(a<=0)a=1;window.document.getElementById(element.id+"col"+b).width=a}}else{b-=frzCols;if(getViewport()!=null){var c=getColGroup(getViewport());if(c.childNodes.length==0)c=getColGroup(getColHeader());g=addColInfo(c.childNodes[b].FpCol);if(a<=0)a=1;setColGroupWidth(c,b,a,e)}else if(getViewport1()!=null)g=addColInfo(getColGroup(getViewport1()).childNodes[b].FpCol);var j=getViewport1();if(j!=null){var c=getColGroup(j);setColGroupWidth(c,b,a,e);if(!ie6up)if(j.rows.length>1){var d=getSpanCell(0,frzCols+b,spanCells);if(d!=null){var n=getCellIndex(0,d.col,spanCells);j.rows(1).cells(n).style.posWidth=getSpanWidth(d.col,d.colCount)}else{var n=getCellIndex(0,frzCols+b,spanCells);j.rows(1).cells(n).style.posWidth=a}}}if(!ie6up&&getViewport()!=null)if(getViewport().rows.length>1){var l=0;if(frzRows>0)l=frzRows;var d=getSpanCell(l,frzCols+b,spanCells);if(d!=null){var n=getCellIndex(l,d.col,spanCells);getViewport().rows(0).cells(n).style.posWidth=getSpanWidth(d.col,d.colCount)}else{var n=getCellIndex(l,frzCols+b,spanCells);getViewport().rows(0).cells(n).style.posWidth=a}}if(getColHeader()!=null){if(a<=0)a=1;window.document.getElementById(element.id+"col"+(b+frzCols)).width=a}if(getColFooter()!=null){var c=getColGroup(getColFooter());if(c.childNodes.length==0)c=getColGroup(getColHeader());if(a<=0)a=1;setColGroupWidth(c,b,a,e);if(a<=0)a=1;window.document.getElementById(element.id+"col"+(b+frzCols)).width=a}}sizeSpread();sizeSpread();if(g!=null){var m=g.selectSingleNode("./width");if(m==null){m=tableData.createNode("element","width","");g.appendChild(m)}if(f==null)i=0;if(engine>=8){if(f==null&&b==0)i=-2;if(f!=null&&b==0)i=-1}m.text=a}var p=getCmdBtn("Update");p!=null&&updateCmdBtnState(p,false);dirty=true;getRowHeader()==null&&frzCols==0&&prepairSpreadLayout();return r!=a}function createTestBox(){var a=window.document.getElementById(element.id+"_testBox");if(a==null){a=window.document.createElement("<span>");a.style.position="absolute";a.style.borderWidth=0;a.style.top=-500;a.style.left=-100;a.id=element.id+"_testBox";element.insertBefore(a)}return a}function getPreferredRowHeight(d){var b=createTestBox();d=GetDisplayIndex(d);var c=null;if(d<frzRows){c=getViewport1();if(c==null)c=getViewport0()}else{c=getViewport();if(c==null)c=getViewport2();d-=frzRows}var e=0,g=c.rows(d).offsetHeight;n=c.rows(d).cells.length;for(var i=0;i<n;i++){var f=c.rows(d).cells(i),a=getRender(f);if(a!=null){b.style.fontFamily=a.currentStyle.fontFamily;b.style.fontSize=a.currentStyle.fontSize;b.style.fontWeight=a.currentStyle.fontWeight;b.style.fontStyle=a.currentStyle.fontStyle}var l=getColFromCell(f);b.style.posWidth=getColWidthFromCol(l);if(a!=null&&a.tagName=="SELECT"){for(var k="",j=0;j<a.children.length;j++){var h=a.children[j];if(h.text!=null&&h.text.length>k.length)k=h.text}b.innerHTML=k}else if(a!=null&&a.tagName=="INPUT")b.innerHTML=a.value;else b.innerHTML=f.innerHTML;g=b.offsetHeight;if(g>e)e=g}return Math.max(0,e)+3}function getRowHeightInternal(d){var a=null,i,c=d<frzRows?[getFrozRowHeader(),getViewport1(),getViewport0()]:[getRowHeader(),getViewport(),getViewport2()];if(d>=frzRows)d-=frzRows;$$.utils.cleanArray(c);for(var f=0;f<c.length;f++){var i=c[f];a=i.rows[d];if(a==null)continue;for(var e=1,b=0;b<a.cells.length;b++){var h=a.cells[b];if(h.rowSpan>e)e=parseInt(h.rowSpan)}if(e==1)break;for(var g=true,b=f+1;b<c.length;b++)if(d+e>c[b].rows.length){g=false;break}if(g)break}return a!=null?getRowOffsetHeight(i,a.rowIndex):0}function getRowHeightInternal2(d){var a=null,c=null,b=null;if(d<frzRows)b=[getFrozRowHeader(),getViewport1(),getViewport0()];else{d-=frzRows;b=[getRowHeader(),getViewport(),getViewport2()]}for(var e=0;e<b.length;e++){c=b[e];if(c!=null){a=c.rows[d];break}}return a!=null?a.style!=null&&a.style.pixelHeight!=null?a.style.pixelHeight:getRowOffsetHeight(c,d):0}function setRowHeight2(c,f,o,m){if(f<1)f=1;c=GetDisplayIndex(c);var a=null,e=getViewport2(),b=null,d=null;if(c<frzRows){if(getFrozRowHeader()!=null)a=getFrozRowHeader().rows(c);b=getViewport1();if(b==null)b=getViewport0();e=getViewport0()}else{c-=frzRows;if(getRowHeader()!=null)a=getRowHeader().rows(c);b=getViewport();if(b==null)b=getViewport2()}if(a!=null)a.style.posHeight=f;if(a!=null){if(b.rows.length>=2&&b.cellSpacing=="0")if(a.rowIndex==0)b.rows(0).style.posHeight=a.style.posHeight-1;else if(a.rowIndex==b.rows.length-1)b.rows(a.rowIndex).style.posHeight=a.style.posHeight+1;else b.rows(a.rowIndex).style.posHeight=a.style.posHeight;else b.rows(a.rowIndex).style.posHeight=a.style.posHeight;d=getFirstNonSpanCell(b.rows[a.rowIndex]);if(d!=null)d.style.height="";if(e!=null){e.rows(a.rowIndex).style.posHeight=b.rows(a.rowIndex).style.posHeight;d=getFirstNonSpanCell(e.rows[a.rowIndex]);if(d!=null)d.style.height=""}if(isChild(a,getFrozRowHeader()))getFrozRowHeader().parentElement.parentElement.parentElement.style.posHeight=f}else{if(b!=null){b.rows(c).style.posHeight=f;d=getFirstNonSpanCell(b.rows[c]);if(d!=null)d.style.height=""}if(e!=null){e.rows(c).style.posHeight=b.rows(c).style.posHeight;d=getFirstNonSpanCell(e.rows[c]);if(d!=null)d.style.height=""}a=b.rows(c)}for(var q=rowSpanCells.length,k=0;k<q;k++){var g=rowSpanCells[k],j=a.rowIndex;if(isChild(a,getRowHeader()))j+=frzRows;var p=g.row<=j&&j<g.row+g.rowCount;p&&SynRowHeight(g)}if(m==null||m){var h=null;if(o)h=addRowInfo(a.FpKey,false,true);else h=addRowInfo(a.FpKey);h!=null&&setRowHeight(h,a.style.posHeight)}var n=getParentSpread();n!=null&&n.UpdateRowHeight(element);var i=getScrollvp();if(i!=null)i.style.posWidth=i.style.posWidth-1;if(frzCols>0){var l=checkIntersectWithSpan(c);l&&layoutRange(l)}sizeSpread()}function getRowInfo(c,d,e){var b=tableData.documentElement.selectSingleNode("//rowinfo");if(b==null)return null;var a=null;if(e)a=b.selectSingleNode("./row[@key='"+c+"']");else{var f=d?"true":"false";a=b.selectSingleNode("./row[@key='"+c+"'][@header='"+f+"']")}return a}function getRowHeight(a){if(a==null)return null;var b=a.selectSingleNode("./height");return b!=null?b.text:null}function addRowInfo(f,c,g){var e=false;if(c)e=true;var a=getRowInfo(f,e,g);if(a!=null)return a;var d=tableData.documentElement.selectSingleNode("//rowinfo");if(d==null)return null;a=tableData.createNode("element","row","");var b=tableData.createNode("attribute","key","");b.text=f;a.attributes.setNamedItem(b);if(c){b=tableData.createNode("attribute","header","");b.text="true";a.attributes.setNamedItem(b)}d.appendChild(a);return a}function getTopSpread(b){if(b==null)b=element;var c=b,a=b.parentElement;while(a!=null){if(a.FpSpread=="Spread")if(a.hierView=="true")c=a;else break;a=a.parentElement}return c}function getParentSpread(){try{if(element.hostspread!=null)return null;var a=element.parentElement;while(a!=null&&a.FpSpread!="Spread")a=a.parentElement;return a!=null&&a.hierView=="true"?a:null}catch(b){return null}}function setRowHeight(b,c){if(b==null)return;var a=b.selectSingleNode("./height");if(a!=null)a.text=c;else{a=tableData.createNode("element","height","");b.appendChild(a);a.text=c}var d=getCmdBtn("Update");d!=null&&updateCmdBtnState(d,false);dirty=true}function findAnchorCell(){var o=tableData.documentElement,h=o.selectSingleNode("/root/state/activeRow"),g=o.selectSingleNode("/root/state/activeColumn"),a=h!=null?parseInt(h.text):-1,b=g!=null?parseInt(g.text):-1;if(getSelection().childNodes.length==0||a>-1&&b>-1){var c=null;if(a==-1&&b===-1)return null;else if(element.layoutMode){if(b>-1){if(a>-1)c=getCellByRowCol2(h.text,g.text);if(c==null){var e=0;if(needScrollToTopRow){e=spreadView._GetKeyedTableRowIndex(spreadView.GetAttribute("topRow"),true);if(e!=-1)e+=frzRows;else e=0}c=spreadView._GetFirstCellFromLayoutCol(g.text,false,e)}}if(c==null){a=getFirstRowFromKey(a);if(a==null)a=0;for(var u=parseInt(element.layoutRowCount),t=GetColCount(),r=false,d=a;d<a+u;d++){for(var m=0;m<t;m++){c=getCellFromRowCol(d,m);if(c!=null){r=true;break}}if(r)break}}}else{if(h!=null&&a!=-1)a=getRowByKey(h.text,0);else if(!element._processingFilterBarCommand){var e=0;if(needScrollToTopRow){var s=spreadView.GetAttribute("topRow"),p=spreadView._GetKeyedTableRowIndex(s,true);e=p!=-1?frzRows+p:0}a=getNextCellRowIndex(e,0,false,true)}b=g!=null&&b!=-1?getColByKey(g.text,0):0;c=getCellFromRowCol(a,b)}if(c!=null&&c.canFocus=="false"&&!element._processingFilterBarCommand){a=getRowFromCell(c);b=getColFromCell(c);var k=moveRightInternal(a,b,false);if(k!=null)c=getCellFromRowCol(k.row,k.col)}if(c!=null)saveAnchorCell(c);else if(element._processingFilterBarCommand&&operationMode=="Normal"&&b>=0&&a<0){setActiveRow(-1);setActiveCol(b);selectColumn(b,1,true)}return c}else if(a<=-1&&b>-1||a>-1&&b<=-1)if(a<=-1&&b>-1){var j=b>=frzCols?getColHeader():getFrozColHeader();if(j){var n=j.rows.length-spreadView.FilterBarRowCount;a=n+a;if(a>=0&&a<n){for(var f=j.rows[a],d=0;d<f.cells.length;d++)if(f.cells[d].col!=null&&parseInt(f.cells[d].col)==b)return f.cells[d];for(var l=getColGroup(j),d=0;d<l.childNodes.length;d++)if(l.childNodes[d].FpCol!=null&&parseInt(l.childNodes[d].FpCol)==b)return f.cells[d]}}}else{var i=getRowByKey(a,-1),q=i>=frzRows?getRowHeader():getFrozRowHeader();if(q&&i>=0){if(i>=frzRows)i-=frzRows;var f=q.rows[i];b=f.cells.length+b;return f.cells[b]}}return null}function saveAnchorCell(a){SuspendLayout();if(a!=null&&a.offsetParent!=null){spreadView.InitCellType(a);var b=a.parentElement.FpSpread;if(b=="r"||b=="rh"||b=="ch"){var f=null,c=null;if(b=="r"||b=="ch")if(a.col!=null&&a.col!="-1")c=parseInt(a.col);else if(a.col==null){var d=getColFromCell(a);if(d>=frzCols)d=d-frzCols;var g=getColGroup(a.parentElement.parentElement.parentElement);if(g.childNodes.length>d&&g.childNodes[d].FpCol!=null)c=parseInt(g.childNodes[d].FpCol)}else c=0;else{c=-1;for(var e=a.parentElement.cells.length-1;e>=0;e--){if(e==a.cellIndex)break;c--}}if(b=="r"||b=="rh")f=getRowKeyFromCell(a);else{f=-1;for(var h=a.parentElement.parentElement.parentElement,e=h.rows.length-1-spreadView.FilterBarRowCount;e>=0;e--){if(e==a.parentElement.rowIndex)break;f--}}if(f!=null&&c!=null){setActiveRow(f);setActiveCol(c)}}else if(isChild(a,getCorner())){setActiveRow(-1);setActiveCol(-1)}}ResumeLayout(false)}function setActiveRow(b,d){if(GetRowCount()<1&&!d)return;if(b==null)b=-1;var c=tableData.documentElement.selectSingleNode("/root/state/activeRow");if(c==null)return;c.text=""+b;if(typeof b!="undefined"&&element.IsNewRow!="true"&&element.AllowInsert=="true"){var a=getCmdBtn("Insert");updateCmdBtnState(a,false);a=getCmdBtn("Add");updateCmdBtnState(a,false)}else{var a=getCmdBtn("Insert");updateCmdBtnState(a,true);a=getCmdBtn("Add");updateCmdBtnState(a,true)}if(typeof b!="undefined"&&element.IsNewRow!="true"&&element.AllowDelete=="true"){var a=getCmdBtn("Delete");updateCmdBtnState(a,b==-1)}else{var a=getCmdBtn("Delete");updateCmdBtnState(a,true)}dirty=true}function setActiveCol(b){var a=tableData.documentElement.selectSingleNode("/root/state/activeColumn");if(a==null)return;a.text=""+b;dirty=true}function getActiveRow(){if(anchorCell==null)return-1;var a=getRowFromCell(anchorCell);return GetSheetIndex(a)}function getActiveCol(){if(anchorCell==null)return-1;var a=getColFromCell(anchorCell);return a}function getLeadingCellRow(){return leadingCellRow}function getLeadingCellCol(){return leadingCellCol}function GetActiveChildSheetView(){var c=getTopSpread(element),a=null,i=window.document.getElementById(c.id+"_XMLDATA");if(i!=null){var d=i.documentElement.selectSingleNode("/root/activechild");if(d!=null&&d.text!="")a=window.document.getElementById(d.text);else for(var h=FpSpreadJS.getAllSpreads(c),f=0;f<h.length;f++){var e=h[f];if(e.getAnchorCell()!=null&&e.getAnchorCell().paintSelected){a=e;break}}}if(a!=null)return a!=c?a:null;var b=window.document.FpActiveSheetView;if(typeof b=="undefined")return null;var g=getTopSpread(b);return g!=c?null:b==g?null:b}function getTextElement(a){if(a.tagName.toUpperCase()=="INPUT"&&a.type=="text"||a.tagName.toUpperCase()=="TEXTAREA")return a;for(var b=0;b<a.childNodes.length;b++){var c=a.childNodes[b];if(!c.tagName)continue;var d=getTextElement(c);if(d!=null)return d}return null}function isHandleEvent(event,editingCell){var cell=editingCell||anchorCell;if(!editing||event==null||cell==null)return false;var ct=getCellType(cell);if(ct!=null){if(ct=="text")ct="TextCellType";var fn=null;try{fn=eval(ct+"_isHandleEvent")}catch(e){}if(fn)return fn.apply(this,arguments)}return false}function getEditor(c){if(c==null)return null;var e=getCellType(c);if(e=="readonly")return null;var a=c.getElementsByTagName("DIV");if(a!=null&&a.length>0&&!a[0].select){var b=getTextElement(a[0]);if(b!=null&&b.select){a[0].select=Function.CreateDelegate(b,b.select);if(!b.getValue)b.getValue=function(){return this.value};if(!b.setValue)b.setValue=function(a){this.value=a};a[0].getValue=Function.CreateDelegate(b,b.getValue);a[0].setValue=Function.CreateDelegate(b,b.setValue)}}if(e=="MultiColumnComboBoxCellType")return $$(c).getChildTag("DIV","fpeditor","MultiColumnComboBoxCellType");if(e=="ExtenderCellType"){var f=$$(c).getChildTag("DIV","fpeditor","ExtenderEditor");if(f!=null){f.type="div";return f}}a=c.getElementsByTagName("INPUT");if(a!=null&&a.length>0){var d=a[0];while(d!=null&&d.FpEditor==null)d=d.parentElement;return d}a=c.getElementsByTagName("SELECT");if(a!=null&&a.length>0)return a[0];a=c.getElementsByTagName("TEXTAREA");if(a!=null&&a.length>0){var d=a[0];if(e=="text"||e=="TextCellType")return d}return null}var renderAsEditor=-1;function dblclick(){if(window.document.FpActiveSpread==null||window.document.FpActiveSpread!=element)return;var a=getCell(window.event.srcElement,true),d=getSpreadControl(a,false);if(d!=element)return;if(a!=null&&!isHeaderCell(a)&&a==anchorCell&&operationMode=="RowMode"&&enableRowEditTemplate=="true"&&!element.layoutMode){var b=a.getElementsByTagName("DIV");if(b!=null&&b.length>0&&b[0].id==element.id+"_RowEditTemplateContainer")return;Edit(getRowKeyFromCell(a));var c=getCmdBtn("Cancel");c!=null&&updateCmdBtnState(c,false);return}if(a!=null&&!isHeaderCell(a)&&a==anchorCell){if(a.canFocus!="false")$$.browser.ieversion>=10&&document.releaseCapture();StartEdit(a)}}function isAllInitialized(){var c=getTopSpread(element);if(!c.initialized)return false;for(var b=FpSpreadJS.getAllChildViews(c),a=0;a<b.length;a++)if(!b[a].initialized)return false;return true}function prepairEditCell(a){if(smartPaint&&a!=null&&(a.offsetParent==null||getRowFromCell(a)>=frzRows&&a.parentElement.rowIndex==0&&newTop!=0||$$.browser.quirksMode&&window.document!=a.document)){var b=getRowFromCell(a),e=getColFromCell(a);if(window.event!=null&&window.event.type=="keydown")element.__scrollByEditing=true;if(smartPaint&&vpList.table.rows.length>0&&b>=frzRows)if(b<current+frzRows)showRows(b-frzRows,current+frzRows-b+1);else b-frzRows>=current+currentCount&&showRows(b-frzRows,1);anchorCell=findAnchorCell();paintAnchorCell(true);var c=getScrollvp();if(c!=null)c.onscroll=null;var d=getViewport().parentElement;if(getRowFromCell(anchorCell)>=frzRows)d.scrollTop=anchorCell.offsetTop+element.virtualTop;if(getColFromCell(anchorCell)>=frzCols)d.scrollLeft=anchorCell.offsetLeft;scrollView();newTop=getTopRow(c.scrollTop);doUpdate();c!=null&&setTimeout(function(){getScrollvp().onscroll=vpscroll},10);a=anchorCell}return a}function scrollToCell(a,f){var e=ignoreVirtualPaging;ignoreVirtualPaging=true;var b=getParent(getViewport()),c=spreadView._GetViewportFromCell(a,true);if(c==null)return;if(a.offsetWidth<b.clientWidth){var d=parseInt(c.cellSpacing);if((isChild(a,b)||isChild(a,getViewport1()))&&a.offsetLeft+a.offsetWidth+d>b.scrollLeft+b.clientWidth)b.scrollLeft=a.offsetLeft+a.offsetWidth+d-b.clientWidth;if(a.offsetLeft<b.scrollLeft&&(isChild(a,getViewport())||isChild(a,getViewport1())))b.scrollLeft=a.offsetLeft}if((isChild(a,b)||isChild(a,getViewport2()))&&a.offsetTop+a.offsetHeight>b.scrollTop-element.virtualTop+b.clientHeight&&a.offsetHeight<b.clientHeight)b.scrollTop=element.virtualTop+a.offsetTop+a.offsetHeight-b.clientHeight;if(a.offsetTop<b.scrollTop-element.virtualTop&&a.offsetHeight<b.offsetHeight&&(isChild(a,getViewport())||isChild(a,getViewport2())))b.scrollTop=a.offsetTop+element.virtualTop;f&&syncScrollByCell(a,up);ignoreVirtualPaging=e}function syncScrollByCell(b,d){var g=false;if((g=isChild(b,getViewport()))||isChild(b,getViewport2())){var a=getScrollvp();if(a==null)a=getParent(getViewport());if(a.offsetHeight<getViewport().clientHeight||d==up){var c=getViewport().parentElement.clientHeight;if(d==up||d==left){if(b.parentElement.rowIndex>0){var f=b.parentElement.offsetTop+element.virtualTop-a.scrollTop,e=f+b.parentElement.offsetHeight;if(e>c)a.scrollTop=a.scrollTop+e-c;else if(f<0)a.scrollTop=a.scrollTop-(a.scrollTop-element.virtualTop-b.parentElement.offsetTop)}else a.scrollTop=element.virtualTop;if(b.offsetLeft<a.scrollLeft&&g)a.scrollLeft=b.offsetLeft}var i=getViewport2(),h=getViewport().offsetHeight;if(i!=null&&h<i.offsetHeight)h=i.offsetHeight;var c=getViewport().parentElement.clientHeight;if(d==down||d==right){if(b.parentElement.rowIndex<b.parentElement.parentElement.rows.length-1){var f=b.parentElement.offsetTop+element.virtualTop-a.scrollTop,e=f+b.parentElement.offsetHeight;if(e>c)a.scrollTop=a.scrollTop+e-c;else if(f<0)a.scrollTop=a.scrollTop-(a.scrollTop-element.virtualTop-b.parentElement.offsetTop)}else a.scrollTop=element.virtualTop+h-c;if(b.offsetLeft<a.scrollLeft&&g)a.scrollLeft=b.offsetLeft}}}}function StartEdit(editCell,isFake){if(isEndingEdit)return;if(operationMode=="SingleSelect"||operationMode=="ReadOnly"||editing)return;if(operationMode=="RowMode"&&enableRowEditTemplate=="true"&&!element.layoutMode)return;if(editModePermanent&&!isAllInitialized())return;var cell=editCell;if(cell==null)cell=anchorCell;if(cell==null)return;if(cell.getAttribute("canFocus")=="false"||isHeaderCell(cell))return;scrollToCell(cell);cell.__$heightBefore=cell.offsetHeight;cell=prepairEditCell(cell);if(cell.children.length>0&&cell.children(0).FpSpread=="Spread")return;window.document.focus();(window.document.FpActiveSpread!=element||editModePermanent&&!isChild(window.document.activeElement,element))&&focus();renderAsEditor=-1;var checkbox=getEditor(cell);if(checkbox!=null){setEditorFocus(checkbox,false);editing=true;editor=checkbox;renderAsEditor=1;editingValue=getEditorValue(checkbox)}if(cell!=null){var r=getRowFromCell(cell),c=getColFromCell(cell),er=GetSheetIndex(r);if(!isFake&&fireEditStartEvent(er,c,cell,element))return;var ts=getTopSpread(element);if(!isFake&&ts!=element)if(ts.Behavior.fireEditStartEvent(er,c,cell,element))return;var cellType=getCellType(cell);if(cellType=="readonly")return;if(!isFake&&anchorCell!=cell){anchorCell=cell;setActiveRow(getRowKeyFromCell(cell));setActiveCol(element.layoutMode?getColKeyFromCell2(cell):getColKeyFromCell(cell))}if(checkbox==null){var ctController=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,cell);ctController&&ctController.StartEdit&&ctController.StartEdit();var render=ctController&&ctController.GetRender?ctController.GetRender():getRender(cell);editingFormula=getFormulaFromCell(cell);var needEditingValue=editingFormula==null||editingFormula=="",text=getValueFromRender(render,true,needEditingValue),isXmlValue=text!=null&&text.isXmlValue;if(isXmlValue)text=text.value;editingValue=text;if(editingFormula!=null)text=editingFormula;var cellHeight=cell.clientHeight;if(frameSet)cellHeight=parseInt(cell.currentStyle.height)-2;cellHeight-=2;var st=getViewport().parentElement.scrollTop,sl=getViewport().parentElement.scrollLeft,editorID=getCellEditorID(cell);if(editorID!=null&&typeof editorID!="undefined"){editor=getCellEditor(editorID,true);editor.style.display="inline";spreadView._EnableSpreadValidators()}else{editor=document.createElement('<INPUT type="text">');editor.__defaultEditor=1}if(editor.onfocus==null)editor.onfocus=editorOnFocus;if(editor.style.imeMode==""){var imemode=cell.getAttribute("ime-mode");if(imemode!=null){editor.style.imeMode=imemode;cell.setAttribute("cellImeMode","1")}}editor.style.fontFamily=render.style.fontFamily||render.currentStyle.fontFamily;var renderFontSize=render.currentStyle.fontSize;if(renderFontSize==null||renderFontSize.indexOf("%")<0)if(renderFontSize.indexOf("em")<0)editor.style.fontSize=render.style.fontSize||renderFontSize;else editor.style.fontSize="inherit";else editor.style.fontSize="";editor.style.fontWeight=render.style.fontWeight||render.currentStyle.fontWeight;editor.style.fontStyle=render.style.fontStyle||render.currentStyle.fontStyle;editor.style.textDecoration=render.style.textDecoration;editor.style.position="absolute";try{if(render!=cell){render.style.display="none";cell.getAttribute("cdf")!=null&&spreadView.StartEditCDFCell(cell,editor,cellType)}else if(render.firstChild!=null&&render.firstChild.tagName=="NOBR")render.firstChild.innerHTML="&nbsp;";else render.innerHTML="&nbsp;"}catch(e){return}cell.insertBefore(editor);if(frameSet&&getScrollvp()!=null){var top=getOffsetTop(cell)+cell.clientTop,left=getOffsetLeft(cell)+cell.clientLeft;if(isChild(cell,getViewport())||isChild(cell,getViewport2())){var vp1=getViewport1();if(vp1==null)vp1=getViewport0();if(vp1!=null)top+=vp1.offsetHeight;top-=getScrollvp().scrollTop}if(isChild(cell,getViewport())||isChild(cell,getViewport1())){var vp2=getViewport2();if(vp2==null)vp2=getViewport0();if(vp2!=null)left+=vp2.offsetWidth;left-=getScrollvp().scrollLeft}editor.style.top=top;editor.style.left=left}else{var range1=editor.offsetParent.getBoundingClientRect(),range2=cell.getBoundingClientRect(),view=editor.offsetParent,scrollTop=view.scrollTop,scrollLeft=view.scrollLeft;editor.style.top=range2.top+scrollTop-range1.top+cell.clientTop+"px";editor.style.left=range2.left+scrollLeft-range1.left+cell.clientLeft+"px"}var dw1=2;if(frameSet)editor.style.width=parseInt(cell.currentStyle.width)-dw1-2;else if(xhtml)editor.style.width=Math.max(1,cell.clientWidth-dw1-2);else{editor.style.width=Math.max(1,cell.clientWidth-dw1);saveMargin(cell)}if(editor.tagName=="INPUT"&&editor.type=="text"||editor.tagName=="TEXTAREA"){if(editor.style.backgroundColor==""||typeof editor.backColorSet!="undefined")if(cell.hasSparkline==null||cell.hasSparkline!=null&&cell.currentStyle.backgroundColor!="transparent"){editor.style.backgroundColor=cell.currentStyle.backgroundColor;editor.backColorSet=true}if(editor.style.color==""||typeof editor.colorSet!="undefined"){editor.style.color=cell.currentStyle.color;editor.colorSet=true}var editorHeight=xhtml?editor.style.height=Math.max(1,cellHeight-2):editor.style.height=Math.max(1,cellHeight);editor.style.height=editorHeight+"px";if(element.layoutMode){var editorBound=editor.getBoundingClientRect(),cellBound=cell.getBoundingClientRect();if(editorBound.bottom>cellBound.bottom){editorHeight-=editorBound.bottom-cellBound.bottom+1;editor.style.height=editorHeight+"px"}}editor.style.border="";restoreMargin(editor,false)}else if(cellType=="MultiColumnComboBoxCellType"||cellType=="ComboBoxCellType"||editor.tagName=="SELECT"){editor.style.height="";if(cellType=="MultiColumnComboBoxCellType"){var mccbId=getMccbID(cell,element),obj=eval(mccbId+"_Obj"),input=obj.getInputControl();input.style.height="";if(editor.offsetHeight>cellHeight){var h=Math.max(1,cell.clientHeight-4);input.style.height=h-2+"px";editor.style.height=h+"px"}}else if(editor.tagName=="SELECT"&&editor.offsetHeight>cellHeight)editor.style.height=Math.max(1,cellHeight)+"px";else if(editor.offsetHeight>cellHeight){var h=Math.max(1,cell.clientHeight);editor.style.height=h+"px"}}renderAsEditor=0;spreadView._SetTargetInputOldValue(cell,text);setEditorValue(editor,text,isXmlValue);if(text!=null&&text!=""&&text.charAt(0)!="=")editingValue=getEditorValue(editor);if(editor.tagName=="SELECT"){editorSelectedIndex=editor.selectedIndex;if(text==null||text==""&&cell.specialValue==null)editor.selectedIndex=editorSelectedIndex=-1}if(editor.offsetHeight<cell.clientHeight&&editor.tagName!="TEXTAREA")if(cell.vAlign=="middle")editor.style.posTop+=(cellHeight-editor.offsetHeight)/2;else if(cell.vAlign=="bottom")editor.style.posTop+=cellHeight-editor.offsetHeight;if(!isFake){if(element.virtualPaging=="true")ignoreMainScroll=true;waitForAttachBehavior(true);element.virtualPaging=="true"&&setTimeout(function(){ignoreMainScroll=false},200)}if(xhtml){var rc=cell.rowSpan;if(isNaN(rc))rc=1;for(var i=0;i<rc;i++)EnsureRowHeight(r+i);sizeSpread(true)}else for(var count=spanCells.length,i=0;i<count;i++){var spanCell=spanCells[i];SynRowHeight(spanCell)}element.virtualPaging=="true"&&setScrollbarValues(st,sl)}else if(isEditModeReplace(cell))if(editor.select)try{var bButton=editor.tagName=="INPUT"&&(editor.type=="button"||editor.type=="submit");!bButton&&editor.select()}catch(e){}else for(var inputs=editor.getElementsByTagName("INPUT"),i=0;i<inputs.length;i++)if(inputs[i].tagName=="INPUT"&&inputs[i].type=="text"){inputs[i].select();break}editing=true;if(!isFake){var btn=getCmdBtn("Update");btn!=null&&btn.disabled&&updateCmdBtnState(btn,false);btn=getCmdBtn("Copy");btn!=null&&!btn.disabled&&updateCmdBtnState(btn,true);btn=getCmdBtn("Paste");btn!=null&&!btn.disabled&&updateCmdBtnState(btn,true);btn=getCmdBtn("Clear");btn!=null&&!btn.disabled&&updateCmdBtnState(btn,true)}spreadView.AfterSpreadStartEdit(r,c,cell,cellType,editor)}}function editorOnFocus(){element.captureElement!=null&&window.document.releaseCapture()}var needCheckSelectText=false;function setEditorFocus(e,g){if(g==null)g=true;if(ignoreEditorFocus||spreadView!=null&&spreadView.IsSuspendFocusSpread())return;var d=true,b=getCell(e,true),i=getCellType(b),c=false,a=null;if(i!=null){var j=getFunction(i+"_setFocus");if(j!=null){a=e;c=$$.utils.contains(a,$$.utils.getDocActiveElement(),true);j(e);d=false}}if(d){var f=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,b);if(f&&f.SetEditorFocus){c=$$.utils.contains(a,$$.utils.getDocActiveElement(),true);f.SetEditorFocus(e);d=false}}try{if(d){a=getEditor(b);if(a!=null){c=$$.utils.contains(a,$$.utils.getDocActiveElement(),true);b.RowEditTemplate!="true"&&a.focus()}else{var h=getCellEditorID(b);if(h!=null&&typeof h!="undefined"){a=getCellEditor(h,true);if(a!=null){c=$$.utils.contains(a,$$.utils.getDocActiveElement(),true);a.focus()}}else if(editor!=null){a=editor;c=$$.utils.contains(editor,$$.utils.getDocActiveElement(),true);editor.focus()}}}}catch(l){}fpSpreadJS.BackupBackgroundProperties(b,"edit");g&&!c&&isEditModeReplace(b)&&checkTextEditorSelect(a,b)}function checkTextEditorSelect(a,b){if(b==null)b=anchorCell;if(a==null)a=editor;if(b==null||a==null)return;var d=$$.utils.getDocActiveElement();if($$.utils.contains(a,d,true)&&$$.utils.isTextControl(d)){var c=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,b);if(c&&c.SelectAllText)c.SelectAllText();else selectAllText(a,true);needCheckSelectText=true}}function setEditorValue(b,c,g){var d=getCell(b,true),a=getCellType(d);if(a!=null){if(d!=null&&_setEditorValueEditMode(d,b,c,a,g))return;var e=getFunction(a+"_setEditorValue");if(e!=null){e(b,c,element);return}}a=b.getAttribute("FpEditor");if(a!=null){var e=getFunction(a+"_setEditorValue");if(e!=null){e(b,c,element);return}}var f=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,d);if(f&&f.SetEditorValue)return f.SetEditorValue(c,g);b.value=c}function _setEditorValueEditMode(e,a,f,c,d){if(a!=null&&(a.getAttribute("edf")!=null||a.getAttribute("ef")!=null||a.getAttribute("enf")!=null||a.getAttribute("efp")!=null)){var b=null;if(c=="text"&&getCellType2(e)=="DateTimeCellType")b=DateTimeCellType_setEditorValueEditMode;else b=getFunction(c+"_setEditorValueEditMode");if(b!=null){b(a,f,element,d);return true}}return false}function getEditorValue(a){var e=getCell(a,true),b=getCellType(e);if(b!=null){var c=getFunction(b+"_getEditorValue");if(c!=null)return c(a,element)}b=a.getAttribute("FpEditor");if(b!=null){var c=getFunction(b+"_getEditorValue");if(c!=null)return c(a,element)}var d=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,e);return d&&d.GetEditorValue?d.GetEditorValue():typeof a.value=="boolean"?a.value?"True":"False":a.value}function getCurrency(a){var b=a.CurrencySymbol;if(b!=null)return b;var c=window.document.getElementById(a.id+"cs");return c!=null?c.innerText:""}function waitForAttachBehavior(a){if(editor.readyState=="complete"){setEditorFocus(editor);(window.document.activeElement==null||window.document.activeElement!=editor)&&setEditorFocus(editor,null,a);return}setTimeout(function(){var b=document.getElementById(element.id);b.waitForAttachBehavior(a)},20)}function getValueFromRender(a,h,g){var d=getCell(a),b=getCellType2(d);if(b!=null){if(h&&(b=="DateTimeCellType"||b=="IntegerCellType"||b=="DoubleCellType"||b=="CurrencyCellType")){var f=getCellValue(d,true);if(f!=null&&f.isXmlValue!=null)return f}var c=null;if(b=="ExtenderCellType"){c=getFunction(b+"_getEditor");if(c!=null)if(c(a)!=null)c=getFunction(b+"_getEditorValue");else c=null}else c=getFunction(b+"_getValue");if(c!=null)return c(a,element,g)}if(a.firstChild!=null&&a.firstChild.tagName=="NOBR")a=a.firstChild;if(d!=null&&trim(a.innerHTML)=="&nbsp;")return d.whiteSpace==null?"":" ";var e=a.value;if(d!=null&&a.tagName=="NOBR")e=d.value;if(typeof e=="undefined")e=trim(a.innerText);return e}function GetFormula(a,d){a=GetDisplayIndex(a);var c=getCellFromRowCol(a,d),b=getFormulaFromCell(c);return b}function SetFormula(a,f,c,e,d){a=GetDisplayIndex(a);var b=getCellFromRowCol(a,f);b.FpFormula=c;!d&&setCellValue(b,c,null,e)}function getFormulaFromCell(b){var a=null;if(typeof b.FpFormula!="undefined")a=b.FpFormula;if(a!=null)a=trim(new String(a));return a}function setValueToRender(a,b,f){var c=null,e=getCell(a),d=getCellType2(e);if(d!=null)if(d=="ExtenderCellType"){c=getFunction(d+"_getEditor");if(c!=null)if(c(a)!=null)c=getFunction(d+"_setEditorValue");else c=null}else c=getFunction(d+"_setValue");if(c!=null)if(spreadView.IsSupportEditModeFormat(d)){var g=getEditor(e);if(g==null){var i=getCellEditorID(e);if(i!=null)g=getCellEditor(i,true)}b=c(a,b,f?null:g)}else c(a,b,element);else{var h=true;if(a.tagName=="NOBR")a=a.parentElement;if(typeof a.value!="undefined"){if(b==null)b="";if(typeof a.maxLength!="undefined"&&a.maxLength>0)b=b.substring(0,a.maxLength);if(h)a.value=b;a.style.display="block"}else if(h)if(b==null||b=="")if(a.firstChild!=null&&a.firstChild.tagName=="NOBR")a.firstChild.innerHTML="&nbsp;";else a.innerHTML="&nbsp;";else if(a.firstChild!=null&&a.firstChild.tagName=="NOBR")a.firstChild.innerText=b.toString();else a.innerText=b.toString()}if(a.tagName=="NOBR")a=e;if((typeof f=="undefined"||!f)&&typeof a.FpFormula!="undefined")a.FpFormula=b;return b}function trim(b){var a=b.match(new RegExp("^\\s*(\\S+(\\s+\\S+)*)\\s*$"));return a==null?"":a[1]}function getOffsetLeft(d,f,e){var b=f;if(b==null)b=getViewportFromCell(d);var c=0,a=d;while(a!=null&&a!=b&&isChild(a,b)){c+=a.offsetLeft;if(!e)c+=a.clientLeft;a=a.offsetParent}return c}function getElementOffsetLeft(c){var b=0;b+=c.offsetLeft;b+=c.clientLeft;var a=c.offsetParent;while(a&&(a.tagName=="TD"||a.tagName=="TR"||a.tagName=="TBODY"||a.tagName=="TABLE")&&a.style.position!="relative"&&a.style.position!="absolute"){b+=a.offsetLeft;b+=a.clientLeft;a=a.offsetParent}return b}function getOffsetTop(d,f,e){var b=f;if(b==null)b=getViewportFromCell(d);var c=0,a=d;while(a!=null&&a!=b&&isChild(a,b)){c+=a.offsetTop;if(!e)c+=a.clientTop;a=a.offsetParent}return c}function getElementOffsetTop(c){var b=0;b+=c.offsetTop;b+=c.clientTop;var a=c.offsetParent;while(a&&(a.tagName=="TD"||a.tagName=="TR"||a.tagName=="TBODY"||a.tagName=="TABLE")&&a.style.position!="relative"&&a.style.position!="absolute"){b+=a.offsetTop;b+=a.clientTop;a=a.offsetParent}return b}function getScrollTop(c){var b=0,a=c;while(a!=null&&a!=window.document.body.parentElement){b+=a.scrollTop;a=a.offsetParent}if(window.document.body.parentElement!=null)b+=window.document.body.parentElement.scrollTop;return b}function getScrollLeft(c){var b=0,a=c;while(a!=null&&a!=window.document.body.parentElement){b+=a.scrollLeft;a=a.offsetParent}if(window.document.body.parentElement!=null)b+=window.document.body.parentElement.scrollLeft;return b}function getFunction(fn){if(fn==null||fn=="")return null;try{return eval(fn)}catch(e){return null}}function getMaskedEditValidtor(b){if(typeof Page_Validators!="undefined"){var a=null;for(i=0;i<Page_Validators.length;i++){a=Page_Validators[i];if(typeof a.enabled=="undefined"||a.enabled!=false)if(a.id==b+"")return a}}}function DoEndEdit(a){if(!a)a={};editing&&EndEdit(false,a);var b=a.byElement;if(b!=null&&enableRowEditTemplate=="true"&&operationMode=="RowMode"&&element.getAttribute("layoutMode")==null)editing=IsInRowEditTemplate(b)}function EndEdit(c,b){var a=false;try{isEndingEdit=true;a=__EndEdit(c,b)}finally{isEndingEdit=false}b!=null&&b.RemainFocusOnSpread&&!$$.utils.contains(element,window.document.activeElement)&&spreadView.FocusSpread(false,true);a&&spreadView.GetAttribute("error")=="true"&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();return a}function __EndEdit(isFake,args){if(args==null)args={};if(editor==null||editor.parentElement==null){editing=false;return true}element.valid=true;var cell=getCell(editor.parentElement);if(cell==null)return;var val=getEditorValue(editor),tval=val;if(typeof val=="string")tval=trim(val);var ignoreValidation=element.AcceptFormula=="true"&&tval!=null&&tval.charAt(0)=="=",checkbox=renderAsEditor!=0;checkbox&&spreadView._EnableSpreadValidators();var canExtenderValidation=false;if(!isFake){var maskedEditExtenderDiv=cell.getElementsByTagName("div")[0],maskedEditValidtorItem;if(typeof maskedEditExtenderDiv!="undefined"&&maskedEditExtenderDiv!=null)if(maskedEditExtenderDiv.getAttribute("Extenders")!=null&&maskedEditExtenderDiv.getAttribute("Extenders").indexOf("MaskedEditExtender")!=-1){canExtenderValidation=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"))!=null;maskedEditValidtorItem=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"))}var isValidValue=false;if(canValidate()&&!ignoreValidation||canExtenderValidation){if(spreadView.HasValidators(cell)&&typeof Page_ValidationVer!="undefined"){var validator=spreadView.GetInvalidValidator(cell,val,args.Event||window.event),msg="";hideMsg();if(validator==null)isValidValue=true;else{if(validator.errormessage!=null&&validator.errormessage!=""){msg=validator.errormessage;validator.style.position="absolute";validator.style.visibility="visible";validator.style.display="block";setValidatorPos(validator);showMsg(validator)}window.event.returnValue=false;element.valid=false;if(maskedEditValidtorItem!=null&&maskedEditValidtorItem.focusOnError==null)return true}(args.IgnoreFireErrorEvent==null||!args.IgnoreFireErrorEvent)&&fireOnErrorMessage(cell,isValidValue,msg,getRowFromCell(cell),getColFromCell(cell));if(!isValidValue)return false;val=getEditorValue(editor)}else if(!checkbox||canExtenderValidation){var msg=null;if(!checkbox)if(typeof editor.isValid!="undefined")msg=editor.isValid(val);else{var ct=getCellType(cell);if(ct!=null){var f=getFunction(ct+"_isValid");if(ct=="text"&&getCellType2(cell)=="DateTimeCellType")f=DateTimeCellType_isValid;if(f!=null){msg=f(cell,val,editor);(args.IgnoreFireErrorEvent==null||!args.IgnoreFireErrorEvent)&&fireOnErrorMessage(cell,msg=="",msg,getRowFromCell(cell),getColFromCell(cell))}}}if(canExtenderValidation){var exvalidator=getMaskedEditValidtor((maskedEditExtenderDiv.id+"validator").replace(new RegExp(",","g"),"_"));if(exvalidator)try{ExtenderCellType_validateValue&&ExtenderCellType_validateValue(editor);var crtret=true;if(typeof exvalidator.evaluationfunction=="function"){crtret=exvalidator.evaluationfunction(exvalidator);if(!crtret)if(typeof exvalidator.errormessage=="string"){if(msg!="")msg+=", ";msg=exvalidator.errormessage}}else if(typeof exvalidator.evaluationfunction=="string"){eval("crtret = "+exvalidator.evaluationfunction+"("+exvalidator.id+")");if(!crtret)if(typeof exvalidator.errormessage=="string"){if(msg!="")msg+=", ";msg=exvalidator.errormessage}}if(ExtenderCellType_setValidateEditor)if(!crtret){var inputs=editor.getElementsByTagName("INPUT");for(i=0;i<inputs.length;i++){var textInput=inputs[i];if(textInput.type=="text")textInput.isInvalid=true}ExtenderCellType_setValidateEditor(element,editor)}else{var inputs=editor.getElementsByTagName("INPUT");for(i=0;i<inputs.length;i++){var textInput=inputs[i];if(textInput.type=="text"&&textInput.isInvalid)textInput.isInvalid=null}ExtenderCellType_setValidateEditor(element,null)}if(!crtret&&typeof exvalidator.focusOnError=="string"&&exvalidator.focusOnError=="t"){var ctrl=editor.getElementsByTagName("input")[0];ctrl!=null&&ctrl.focus!="undefined"&&ctrl.focus!=null&&setTimeout(function(){try{ctrl.focus()}catch(a){}},0)}}catch(e){}}if(msg!=null&&msg!=""){if(validationMsg==null){validationMsg=window.document.createElement("div");validationMsg.style.position="absolute";var vh=getViewportHolder();if(vh==null)vh=getViewport().parentElement;vh.insertBefore(validationMsg)}validationMsg.innerHTML=msg;validationMsg.style.position="absolute";validationMsg.style.visibility="visible";validationMsg.style.display="block";if($$.browser.quirksMode)validationMsg.style.whiteSpace="nowrap";setValidatorPos();if(window.event)window.event.returnValue=false;showMsg(validationMsg);element.valid=false}else hideMsg();if(msg!=null&&msg!=""||crtret!=null&&!crtret)return false}}else{hideMsg();isValidValue=true}}var ct=getCellType(cell),selectedIndex=-1;if(!checkbox){var ctController=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,cell);ctController&&ctController.EndEdit&&ctController.EndEdit();isValidValue&&spreadView._DisableSpreadValidators();if(editor.onfocus==editorOnFocus)editor.onfocus=null;if(editor.tagName=="SELECT")selectedIndex=editor.selectedIndex;!xhtml&&textBox!=null&&textBox.blur();if(editor.getAttribute("FpEditor")=="ExtenderEditor"&&typeof ExtenderCellType_blur=="function")ExtenderCellType_blur(editor);else{var func=getFunction(ct+"_blur");func!=null&&func(editor)}$$.utils.removeBackgroundImages(editor);cell.removeChild(editor);if(cell.getAttribute("cellImeMode")=="1")editor.style.imeMode="";editor.style.display="none";!editor.__defaultEditor&&getViewport().appendChild(editor);$$.utils.restoreBackgroundImages(editor);setEditorValue(editor,"");if(editor.tagName=="SELECT")editor.selectedIndex=-1;var rd=getRender(cell);if(cell.getAttribute("cdf")!=null)spreadView.EndEditCDFCell(cell,rd);else if(rd.style.display=="none")rd.style.display="";if(editingFormula!=null&&editingFormula==val)setValueToRender(rd,editingValue,true);else val=setValueToRender(rd,val);restoreMargin(cell)}var _editor=editor;editor=null;var valueChanged=false;if(editingFormula!=null&&editingFormula!==val||editingFormula==null&&editingValue!==val||_editor.tagName=="SELECT"&&editorSelectedIndex!=selectedIndex){if(ct=="RadioButtonListCellType"&&val==null)val="";setCellValue(cell,val,true);if(val!=null&&val.length>0&&trim(val).indexOf("=")==0)cell.FpFormula=val;else cell.removeAttribute("FpFormula");valueChanged=true}editing=false;editorSelectedIndex=-1;if(valueChanged){var r=getRowKeyFromCell(cell),c=element.layoutMode?getColKeyFromCell2(cell):getColKeyFromCell(cell);if(r!=null&&c!=null){fireDataChangedEvent(cell,val,element,r,c);var ts=getTopSpread(element);ts!=element&&ts.Behavior.fireDataChangedEvent(cell,val,element,r,c)}}var cellHeight=cell.offsetHeight,isIncreasedHeight=false;if(!isFake&&cell.__$heightBefore!=null&&cell.rowSpan>1){isIncreasedHeight=cellHeight>cell.__$heightBefore;cell.__$heightBefore=null}if(!checkbox)if(!xhtml)for(var count=spanCells.length,i=0;i<count;i++){var spanCell=spanCells[i];SynRowHeight(spanCell)}else{var rc=cell.rowSpan;if(isNaN(rc))rc=1;var r1=getRowFromCell(cell),needSynchronizeHeightFirst=false;if(frzCols>0){var impactedSpanRange=checkIntersectWithSpan(r1);if(impactedSpanRange){layoutRange(impactedSpanRange);if(r1<frzRows)needSynchronizeHeightFirst=true}}for(var i=0;i<rc;i++)EnsureRowHeight(r1+i);if(needSynchronizeHeightFirst){getRowHeader()!=null&&EnsureAllRowHeights();sizeSpread(true)}else{sizeSpread(true);getRowHeader()!=null&&EnsureAllRowHeights()}}if(!isFake){fireEditStoppedEvent(cell,element);var ts=getTopSpread(element);ts!=element&&ts.Behavior.fireEditStoppedEvent(cell,element)}var ae=$$.utils.getDocActiveElement();if(!args.IgnoreFocus&&(ae==null||!isChild(ae,window.document.body)||editModePermanent||ae==element||isChild(ae,element)))if(args.ignoreEditorFocus)setTextBoxFocus();else if((callEndEditFromMouseWheel||element.virtualPaging=="true")&&element.EditModePermanent){ignorePostbackEditmode=true;!ignoreEditorFocus&&focus2();ignorePostbackEditmode=false}else if(!checkbox||!isEditModeReplace(cell)||!$$.utils.isTextControl(_editor)||args.FromMouseWheel){focus();focus()}else{focus(null,null,{SelectText:false,FocusSpreadOnly:true});focus(null,null,{SelectText:false,FocusSpreadOnly:true})}if(!isFake){btn=getCmdBtn("Copy");btn!=null&&btn.disabled&&updateCmdBtnState(btn,false);btn=getCmdBtn("Clear");btn!=null&&btn.disabled&&updateCmdBtnState(btn,false);var data=getClipboardData();btn=getCmdBtn("Paste");btn!=null&&btn.disabled&&updateCmdBtnState(btn,data==null)}if(!isFake){var autoCalc=element.autoCalc;if(autoCalc!="false")(editingFormula!=null&&editingFormula!=val||editingFormula==null&&editingValue!=val)&&updateValues();getRowHeader()==null&&frzCols==0&&prepairSpreadLayout()}if(isIncreasedHeight&&!isFake&&xhtml){StartEdit(cell,true);EndEdit(true)}if(!editing){renderAsEditor=-1;editingValue=null}fpSpreadJS.RestoreBackgroundProperties(cell,true);return true}function showMsg(b){if(b&&b.parentNode&&b.parentNode.nodeType!=1)return;var f=getTopSpread(element),a=window.document.getElementById(f.id+"mholder");if(a==null){a=window.document.createElement("<iframe frameBorder='no' scrolling='no' src='javascript:false;'>");f.appendChild(a);a.style.position="absolute";a.id=f.id+"mholder"}a.style.display="inline";b.parentNode==null&&f.insertBefore(b,null);getMsgStyle();if(msgStyle!=null){if(msgStyle.fontFamily!=null)b.style.fontFamily=msgStyle.fontFamily;if(msgStyle.fontSize!=null)b.style.fontSize=msgStyle.fontSize;if(msgStyle.fontStyle!=null)b.style.fontStyle=msgStyle.fontStyle;if(msgStyle.fontVariant!=null)b.style.fontVariant=msgStyle.fontVariant;if(msgStyle.fontWeight!=null)b.style.fontWeight=msgStyle.fontWeight}a.style.top=b.style.top;a.style.left=b.style.left;a.contentWindow.document.write("");a.contentWindow.document.close();var g=a.contentWindow.document.body;g.innerHTML="";var c=b.cloneNode(true);c.id="";c.style.fontFamily=b.currentStyle.fontFamily;c.style.fontSize=b.currentStyle.fontSize;c.style.fontStyle=b.currentStyle.fontStyle;c.style.fontVariant=b.currentStyle.fontVariant;c.style.fontWeight=b.currentStyle.fontWeight;c.style.left=0;c.style.top=0;var d=window.document.createElement("div");d.style.width="1000px";d.style.height="1000px";d.appendChild(c);g.appendChild(d);a.width=c.offsetWidth+6;a.height=c.offsetHeight+6;d.style.width="";d.style.height="";if(a.style.posLeft+parseInt(a.width)>a.parentElement.offsetWidth+a.parentElement.scrollLeft)a.style.posLeft=a.parentElement.offsetWidth-parseInt(a.width)+a.parentElement.scrollLeft;if((element.currentStyle.position=="absolute"||element.currentStyle.position=="relative")&&a.style.posTop+parseInt(a.height)>a.parentElement.offsetHeight)a.style.posTop=a.style.posTop-parseInt(a.height)-anchorCell.offsetHeight;a.contentWindow.document.body.style.background="yellow";a.contentWindow.document.body.style.color="red";if(msgStyle!=null){if(msgStyle.backgroundColor!=null)a.contentWindow.document.body.style.backgroundColor=msgStyle.backgroundColor;if(msgStyle.color!=null)a.contentWindow.document.body.style.color=msgStyle.color}a.contentWindow.document.body.style.marginLeft=2;a.contentWindow.document.body.style.marginTop=2;a.contentWindow.document.body.style.marginRight=0;a.contentWindow.document.body.style.marginBottom=0;a.contentWindow.document.body.style.border="1 solid black";a.style.display="inline";b.style.display="none";a.contentWindow.document.attachEvent("onmousedown",function(){var a=EndEdit();!a&&editor.focus()});var e=b.parentNode,h=e.id.indexOf("_ValidatorHold")!=-1;if(h){e.style.display="none";e.style.width="";e.style.height=""}}function hideMsg(){var b=getTopSpread(element),a=window.document.getElementById(b.id+"mholder");if(a!=null)a.style.display="none"}function setValidatorPos(c){if(editor==null)return;var b=getCell(editor.parentElement);if(b==null)return;if(c==null&&spreadView.HasValidators(b)&&typeof Page_ValidationVer!="undefined"){var i=getEditorValue(editor);c=spreadView.GetInvalidValidator(b,i)}if(c==null)c=validationMsg;var d=getTopSpread(element),a=window.document.getElementById(d.id+"mholder");if(c!=null&&c.style.display!="none"||a!=null){var e=d.getScrollvp();if(e==null)e=d.getViewport().parentElement;var g=getOffsetTop(b,d)+b.offsetHeight;if(isChild(b,getViewport())||isChild(b,getViewport2()))g-=e.scrollTop;var f=getOffsetLeft(b,d);if(isChild(b,getViewport())||isChild(b,getViewport1()))f-=e.scrollLeft;var h=!spreadView._IsCellHidden(b);if(c!=null){c.style.posTop=g;c.style.posLeft=f}if(a!=null){a.style.posTop=g;a.style.posLeft=f;a.style.visibility=h?"visible":"hidden";if(getOffsetLeft(e,d)>parseInt(a.style.posLeft)||getOffsetTop(e,d)>parseInt(a.style.posTop)){if(!a.backDisplayValue)a.backDisplayValue=a.style.display;a.style.display="none"}else if(a.backDisplayValue)a.style.display=a.backDisplayValue}}}function canValidate(){return typeof clientInformation!="undefined"&&clientInformation.appName.indexOf("Explorer")!=-1}function saveMargin(a){if(typeof a.currentStyle.paddingLeft!="undefined"&&a.currentStyle.paddingLeft!=""){editorMargin.left=a.currentStyle.paddingLeft;a.style.paddingLeft=0}if(typeof a.currentStyle.paddingRight!="undefined"&&a.currentStyle.paddingRight!=""){editorMargin.right=a.currentStyle.paddingRight;a.style.paddingRight=0}if(typeof a.currentStyle.paddingTop!="undefined"&&a.currentStyle.paddingTop!=""){editorMargin.top=a.currentStyle.paddingTop;a.style.paddingTop=0}if(typeof a.currentStyle.paddingBottom!="undefined"&&a.currentStyle.paddingBottom!=""){editorMargin.bottom=a.currentStyle.paddingBottom;a.style.paddingBottom=0}}function restoreMargin(b,a){if(typeof editorMargin.left!="undefined"&&editorMargin.left!=-1){b.style.paddingLeft=editorMargin.left;if(a==null||a)editorMargin.left=-1}if(typeof editorMargin.right!="undefined"&&editorMargin.right!=-1){b.style.paddingRight=editorMargin.right;if(a==null||a)editorMargin.right=-1}if(typeof editorMargin.top!="undefined"&&editorMargin.top!=-1){b.style.paddingTop=editorMargin.top;if(a==null||a)editorMargin.top=-1}if(typeof editorMargin.bottom!="undefined"&&editorMargin.bottom!=-1){b.style.paddingBottom=editorMargin.bottom;if(a==null||a)editorMargin.bottom=-1}}function getMsgStyle(){if(msgStyle!=null)return;for(var g=window.document.styleSheets.length,b=0;b<g;b++){var e=window.document.styleSheets(b),a;try{a=e.rules}catch(h){continue}for(var c=0,f=a.length;c<f;c++){var d=a(c);if(d.selectorText=="."+element.id+"msgStyle"){msgStyle=d.style;break}}if(msgStyle!=null)break}}var colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};function getColorValue(a){for(var b in colors)if(a!=null&&a.toLowerCase()==b)return"#"+colors[b];return null}function darker(b,f){if(b==null)return null;if(b.substring(0,1)!="#"){var g=getColorValue(b);if(g==null)return b;b=g}if(f.substring(0,1)!="#"){var g=getColorValue(f);if(g==null)g="#bbbbbb";f=g}var j=256-parseInt(f.substring(1,3),16),i=256-parseInt(f.substring(3,5),16),h=256-parseInt(f.substring(5,7),16),e,d,c,a;e=parseInt(b.substring(1,3),16);d=parseInt(b.substring(3,5),16);c=parseInt(b.substring(5,7),16);e-=j;if(e>255)e=255;if(e<0)e=0;d-=i;if(d>255)d=255;if(d<0)d=0;c-=h;if(c>255)c=255;if(c<0)c=0;a=c.toString(16);if(a.length<2)a="0"+a;a=d.toString(16)+a;if(a.length<4)a="0"+a;a=e.toString(16)+a;if(a.length<6)a="0"+a;return"#"+a.toUpperCase()}function paintSelectedCell(a,e,d){if(a==null)return;var b=d?anchorBackColor:selectedBackColor,c=spreadView.IsEnablejQueryTheme()&&useDefaultSelectionBackColor&&(spreadView.RowHeader.Contains(a)||spreadView.ColumnHeader.Contains(a)||spreadView.Corner.Contains(a));if(c)b=null;if(e){if(a.bgColorBak==null&&a.currentStyle!=null)a.bgColorBak=a.currentStyle.backgroundColor;if(a.paintSelected==null||d){if(b!=null)if(element.semiTransparentSelectedBackColor==null||a.all&&(a.currentStyle.backgroundColor==null||a.currentStyle.backgroundColor.length==0||a.currentStyle.backgroundColor=="transparent"))a.style.backgroundColor=b;else a.style.backgroundColor=darker(a.currentStyle.backgroundColor,b);a.paintSelected=true}if(c){spreadView.UpdateThemeCss();$$(a).appendCssClass("ui-state-highlight")}fpSpreadJS.BackupBackgroundProperties(a,"select")}else{a.paintSelected=null;if(!a.hasSparkline){a.style.removeAttribute("backgroundColor");a.style.removeAttribute("backgroundImage")}else if(a.bgColorBak!=null&&a.bgColorBak!="null"){a.style.backgroundColor=a.bgColorBak;a.bgColorBak=null}if(a.bgColor!=null&&a.bgColor!="")a.style.backgroundColor=a.bgColor;c&&$$(a).removeCssClass("ui-state-highlight");fpSpreadJS.RestoreBackgroundProperties(a)}}function paintAnchorCell(c,e){if(anchorCell==null||anchorCell.parentElement==null)return;if(c==null)c=true;var a=frzRows==0&&frzCols==0&&getTopSpread().hierView!="true";if(element.showFocusRect=="false")a=false;var b=operationMode;if(anchorCell==null||b!="Normal"&&b!="RowMode")return;if(b=="MultiSelect"||b=="ExtendedSelect")return;if(e){if(!isHeaderCell(anchorCell)){paintSelectedCell(anchorCell,c&&!a,true);paintAnchorCellHeader(true);a&&paintFocusRect()}return}if(oldAnchorCell&&oldAnchorCell!=anchorCell){var f=oldAnchorCell.paintSelected!=null;if(element.SelectionPolicy!="MultiRange"){var h=getRowFromCell(oldAnchorCell),d=getColFromCell(oldAnchorCell);getColHeader()!=null&&!isColSelected(d)&&paintHeaderSelection(h,d,1,1,false,true)}paintSelectedCell(oldAnchorCell,false);f&&paintSelectedCell(oldAnchorCell,true,false);oldAnchorCell=null}if(a){if(spreadView.ShowHeaderSelection||!isHeaderCell(anchorCell)){paintSelectedCell(anchorCell,false);paintFocusRect();paintAnchorCellHeader(true)}return}if(!isChild(anchorCell,element)){var g=vpList!=null&&isChild(anchorCell,vpList.table)||vp2List!=null&&isChild(anchorCell,vp2List.table);if(!g)return}if(anchorCell.parentElement.cells(0).children.length>0&&anchorCell.parentElement.cells(0).children(0).FpSpread=="Spread")return;if(!initialized||forcePaintAnchorCell||isactive&&window.document.FpActiveSheetView==element){if(spreadView.ShowHeaderSelection||!isHeaderCell(anchorCell)){paintSelectedCell(anchorCell,false);paintSelectedCell(anchorCell,true,true);paintAnchorCellHeader(true)}}else{paintSelectedCell(anchorCell,false,true);paintAnchorCellHeader(false)}}function ClearSelection(h,e){var d=getParentSpread();if(typeof h=="undefined"&&d!=null&&d.hierView=="true"){d.ClearSelection();return}var a=getViewport();if(frzRows==0&&frzCols==0&&a!=null&&a.rows.length>rowCount)for(var b=0;b<a.rows.length;b++)if(a.rows(b).cells.length>0&&a.rows(b).cells(0)!=null&&a.rows(b).cells(0).children.length>0){var c=a.rows(b).cells(0).children(0);c.FpSpread=="Spread"&&typeof c.ClearSelection!="undefined"&&c.initialized&&c.ClearSelection(true,e)}if(e!=null&&element==e)return;doClearSelection();if(anchorCell!=null){if(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="ExtendedSelect"||operationMode=="MultiSelect"){var g=fpSpreadJS.getRowRangeFromCell(anchorCell);paintSelection(g.row,-1,g.rowCount,-1,false)}paintSelectedCell(anchorCell,false);paintAnchorCellHeader(false)}else{var f=getCellFromRowCol(1,0);f!=null&&paintSelectedCell(f,false)}paintFocusRect();selectedCols=[];dirty=true}function SetSelectedRange(a,c,b,d,k){ClearSelection();var o=a,a=GetDisplayIndex(a),f,g;if(frzRows==0&&frzCols==0){var j=0,m=b,h=getViewport();if(h!=null)for(i=a;i<h.rows.length&&j<m;i++)if(IsChildSpreadRow(h,i))b++;else j++}anchorCell==null&&SetActiveCell(o,c);if(element.layoutMode){if(c>=0&&b<0){if(d!=1)return;var n=getDisplayIndex(k),e=GetCellByRowCol(n,c);if(e!=null&&parseInt(e.col)!=-1){c=parseInt(e.col);g=parseInt(e.parentElement.row);f=getColFromCell(e)}else return;paintMultipleRowSelection(g,f,1,d,true)}else if(a>=0&&d<0){if(b>parseInt(element.layoutRowCount))return;var l=parseInt(getRowKeyFromRow(a)),a=parseInt(getFirstRowFromKey(l));updateAnchorCell(a,0,true);b=parseInt(element.layoutRowCount);paintSelection(a,c,b,d,true)}else if(a>=0&&c>=0&&(d>1||b>1))return}else paintSelection(a,c,b,d,true);setSelection(a,c,b,d,null,g,f)}function AddSelection(b,d,a,c,k){var b=GetDisplayIndex(b),f,g;if(frzRows==0&&frzCols==0){var j=0,m=a,h=getViewport();if(h!=null)for(i=b;i<h.rows.length&&j<m;i++)if(IsChildSpreadRow(h,i))a++;else j++}if(element.layoutMode){if(d>=0&&a<0){if(c!=1)return;var n=getDisplayIndex(k),e=GetCellByRowCol(n,d);if(e!=null&&parseInt(e.col)!=-1){g=parseInt(e.parentElement.row);f=getColFromCell(e);d=parseInt(e.col)}else return;paintMultipleRowSelection(g,f,1,c,true)}else if(b>=0&&c<0){if(a>parseInt(element.layoutRowCount))return;var l=parseInt(getRowKeyFromRow(b)),b=parseInt(getFirstRowFromKey(l));if(element.allowGroup){ClearSelection();updateAnchorCell(b,0,true)}a=parseInt(element.layoutRowCount);paintSelection(b,d,a,c,true)}else if(b>=0&&d>=0&&(c>1||a>1))return}else paintSelection(b,d,a,c,true);setSelection(b,d,a,c,true,g,f)}function selectRow(a,h,g,k){if((selectionBlockOptions&SelectionBlockOptions.Rows)==0&&operationMode=="Normal")return;var m=selectionUnit;if(m=="Column"){selectTable(g);return}selectStartRow=a;selectStartCol=-1;var d=getViewport();if(d==null)return;if(!k){var f=d.rows.length;if(getViewport2()!=null&&getViewport2().rows.length>f)f=getViewport2().rows.length;var c=0,b=getColGroup(d);if(b!=null)c=b.childNodes.length;b=getColGroup(getViewport1());if(b!=null&&b.childNodes.length>c)c=b.childNodes.length;var l=d.parentElement.scrollLeft;if(a>=0&&a<f+frzRows)for(var e=0;e<frzCols+c;e++){var i=getCellFromRowCol(a,e);if(i!=null&&i.canFocus!="false"&&i.offsetLeft>=l){updateAnchorCell(a,e,false);break}}editModePermanent&&spreadView._GetViewportFromCell(anchorCell)!=null&&spreadView._IsCellHidden(anchorCell)&&scrollToCell(anchorCell)}selectType="r";var j=h;if(element.layoutMode)j=parseInt(element.layoutRowCount);paintSelection(a,-1,j,-1,g);if(g){setSelection(a,-1,h,-1);paintFocusRect()}else{RemoveSelection(a,-1,h,-1);paintFocusRect()}}function selectColumn(d,k,i,o){if((selectionBlockOptions&SelectionBlockOptions.Columns)==0&&operationMode=="Normal")return;var r=selectionUnit;if(r=="Row"){selectTable(i);return}selectStartRow=-1;selectStartCol=d;var f=getViewport();if(f==null)return;var a=0,c=d;if(!o&&GetRowCountInternal()>0){var g=true,h=element.layoutMode,n=getColHeader(),m=getFrozColHeader(),p=isChild(anchorCell,n)||isChild(anchorCell,m);if(h&&p)g=anchorCell.getAttribute("col")=="-1"?null:spreadView._GetViewportCellFromHeaderCell(anchorCell);if(g){var l=f.parentElement.scrollTop-element.virtualTop;for(a=0;a<f.rows.length;a++){if(!f.rows(a).FpKey)continue;if(f.rows(a).offsetTop>=l)break}a+=frzRows;if(h){var b=anchorCell;if(b){if(parseInt(b.getAttribute("col"))==-1)return;if(isChild(b,n)||isChild(b,m)){g=spreadView._GetViewportCellFromHeaderCell(b,GetRowCountInternal()>frzRows?frzRows:0);if(!g)return;a=getRowFromCell(g)}else a=getRowFromCell(b);c=getColFromCell(b)}}var q=h?parseInt(element.layoutRowCount):1,j=a;while(j<frzRows+f.rows.length){var e=h?spreadView._GetViewportCellFromHeaderCell(anchorCell,j):getCellFromRowCol(j,c);if(e!=null&&!e.getAttribute("group")&&e.getAttribute("canFocus")!="false"&&e.offsetTop>=l&&e.parentNode.getAttribute("previewRow")==null){a=getRowFromCell(e);updateAnchorCell(a,c,false,true);break}j+=q}}else c=getColFromCell(anchorCell);editModePermanent&&spreadView._GetViewportFromCell(anchorCell)!=null&&spreadView._IsCellHidden(anchorCell)&&scrollToCell(anchorCell)}selectType="c";if(!element.getAttribute("layoutMode"))paintSelection(-1,d,-1,k,i);else if(anchorCell!=null){a=parseInt(anchorCell.parentNode.getAttribute("row"));d=parseInt(anchorCell.getAttribute("col"));paintMultipleRowSelection(a,c,1,k,i)}if(i){setSelection(-1,d,-1,k,null,a,c);addColSelection(d)}}function adjustAnchorCell(h){var b=getViewport();if(b==null)return-1;for(var a=0,g=b.parentElement.scrollTop-element.virtualTop,a=0;a<b.rows.length;a++){if(!b.rows(a).FpKey)continue;if(b.rows(a).offsetTop>=g)break}a+=frzRows;var c=h;if(element.layoutMode){var f=anchorCell;if(parseInt(anchorCell.col)==-1)return;if(f){a=getRowFromCell(f);c=getColFromCell(f)}copymultiCol=true}var e=a;while(e<frzRows+b.rows.length){var d=getCellFromRowCol(e,c);if(d!=null&&!d.group&&d.canFocus!="false"&&d.offsetTop>=g){updateAnchorCell(e,c,false,true);break}e+=element.layoutMode?parseInt(element.layoutRowCount):1}return c}function addColSelection(b){for(var c=0,a=0;a<selectedCols.length;a++){if(selectedCols[a]==b)return;if(b>selectedCols[a])c=a+1}selectedCols.length++;for(var a=selectedCols.length-1;a>c;a--)selectedCols[a]=selectedCols[a-1];selectedCols[c]=b}function isColSelected(b){for(var a=0;a<selectedCols.length;a++)if(selectedCols[a]==b)return true;return false}function syncColSelection(){selectedCols=[];for(var d=GetSelectedRanges(),b=0;b<d.length;b++){var a=d[b];if(a.type=="Column")for(var c=a.col;c<a.col+a.colCount;c++)addColSelection(c)}}function initMovingCol(e,p,i){var o=window.event.srcElement;if(o.tagName=="INPUT"||o.tagName=="TEXTAREA"||o.tagName=="SELECT")return;if(element.layoutMode&&e==-1)return;if(element.OperationMode!="Normal"){selectedCols=[];selectedCols.push(e)}if(p){dragCol=e;dragViewCol=getColByKey(e)}else{if(element.layoutMode)dragCol=getColTemplateRowFromGroupCell(e);else dragCol=parseInt(GetSheetColIndex(e));dragViewCol=e}var a=getMovingCol();if(p){ClearSelection();a.innerHTML="";var g=window.document.createElement("<DIV>");$$.utils.removeBackgroundImages(i,true);g.innerHTML=i.innerHTML;$$.utils.restoreBackgroundImages(i);g.style.borderTop="0px solid";g.style.borderLeft="0px solid";g.style.borderRight="#808080 1px solid";g.style.borderBottom="#808080 1px solid";g.style.width=Math.max(getPreferredCellWidth(i),80);a.appendChild(g);$$.utils.restoreBackgroundImages(g);if(element.DragColumnCssClass==null){a.style.backgroundColor=i.currentStyle.backgroundColor;a.style.paddingTop=1;a.style.paddingBottom=1}}else{var q=0;a.innerHTML="";for(var m=window.document.createElement("<table>"),w=m.insertRow(),d=0;d<selectedCols.length;d++){var c=w.insertCell(),h,l;if(element.layoutMode){h=getRowTemplateRowFromGroupCell(e,true);l=getColTemplateRowFromGroupCell(e)}else{if(element.columnHeaderAutoTextIndex!=null)h=parseInt(element.columnHeaderAutoTextIndex);else{h=getColHeader().rows.length-1;while(h>0&&getColHeader().rows[h].getAttribute("FpSpread")=="fb")h--}l=selectedCols[d]}var b=getHeaderCellFromRowCol(h,l,true);$$.utils.removeBackgroundImages(b,true);if(b.FpCellType=="ExtenderCellType"&&b.getElementsByTagName("DIV").length>0){var t=getEditor(b),u=getFunction("ExtenderCellType_getEditorValue");if(t!=null&&u!=null)c.innerHTML=u(t)}else c.innerHTML=b.innerHTML;c.style.cssText=b.style.cssText;c.style.backgroundPositionX=b.currentStyle.backgroundPositionX;c.style.backgroundPositionY=b.currentStyle.backgroundPositionY;c.style.textAlign=b.currentStyle.textAlign;c.style.borderTop="0px solid";c.style.borderLeft="0px solid";c.style.borderRight="#808080 1px solid";c.style.borderBottom="#808080 1px solid";$$.utils.restoreBackgroundImages(b);var v=Math.max(getPreferredCellWidth(b)+6,80);c.style.width=v;q+=v}a.appendChild(m);$$.utils.restoreBackgroundImages(m);if(element.DragColumnCssClass==null){a.style.backgroundColor=element.selectedBackColor;a.style.tableLayout="fixed";a.style.width=q}}var n=-1;if(!xhtml)n+=parseInt(element.style.borderWidth);a.style.posTop=window.event.clientY-getOffsetTop(element,window.document.body)+getScrollTop(element)-n;a.style.posLeft=window.event.clientX-getOffsetLeft(element,window.document.body)+getScrollLeft(element)-n;selectedCols.context=[];var r=selectedCols.context,k=0,f=getColGroup(getFrozColHeader());if(f!=null)for(var d=0;d<f.childNodes.length;d++){var j=parseInt(f.childNodes[d].width),s=parseInt(f.childNodes[d].FpCol);r.push({left:k,width:j,colKey:s});k+=j+spreadView.CellSpacing}f=getColGroup(getColHeader());if(f!=null)for(var d=0;d<f.childNodes.length;d++){var j=parseInt(f.childNodes[d].width),s=parseInt(f.childNodes[d].FpCol);r.push({left:k,width:j,colKey:s});k+=j+spreadView.CellSpacing}}function selectTable(h){if((selectionBlockOptions&SelectionBlockOptions.Sheet)==0&&operationMode=="Normal")return;var f=-1,e=-1,b=getViewport(),l=b.parentElement.scrollTop-element.virtualTop,k=b.parentElement.scrollLeft;if(h){ClearSelection();for(var a=null,i=false,c=0;c<b.rows.length;c++){var g=c+frzRows;if(!b.rows[c].FpKey)continue;for(var d=0;d<b.cols;d++){a=getCellFromRowCol(g,d);if(a!=null&&!a.group&&a.offsetTop>=l&&a.offsetLeft>=k)if(!(a.canFocus=="false")){updateAnchorCell(g,d,false);f=g;e=d;c=b.rows.length;i=true;break}}if(i)break}editModePermanent&&spreadView._GetViewportFromCell(anchorCell)!=null&&spreadView._IsCellHidden(anchorCell)&&scrollToCell(anchorCell)}selectType="t";paintSelection(-1,-1,-1,-1,false);h&&setSelection(-1,-1,-1,-1);var j=null;if(f!=-1&&e!=-1){j=getCellFromRowCol(f,e);j.style.backgroundColor=selectedBackColor}}function getSpanCell(e,d,b){if(b==null)return null;for(var g=b.length,c=0;c<g;c++){var a=b[c],f=a.row<=e&&e<a.row+a.rowCount&&a.col<=d&&d<a.col+a.colCount;if(f)return a}return null}function isCovered(c,b,d){var a=getSpanCell(c,b,d);return a==null?false:a.row==c&&a.col==b?false:true}function isSpanCell(f,e){for(var d=spanCells.length,b=0;b<d;b++){var a=spanCells[b],c=a.row==f&&a.col==e;if(c)return a}return null}function selectRange(e,d,c,b,a,h){var g=selectionUnit;if(g=="Row"){selectRow(e,c,a,false);return}else if(g=="Column"){selectColumn(d,b,a,false);return}selectType="";updateRangeSelection(e,d,c,b,a);if(a){setSelection(e,d,c,b);paintAnchorCell();if(anchorCell!=null){var f=anchorCell.getElementsByTagName("SELECT");if(f!=null&&f.length>0)return}var i=getTopSpread(element);textBox=window.document.getElementById(i.id+"_textBox");if(textBox!=null&&!h){textBox.value="123";try{setTextBoxFocus(true)}catch(j){}}}}function updateRangeSelection(f,e,d,c,a){var b=getViewport();updateRangeSelection(f,e,d,c,a,b)}function getSpanCells(a){return a==getViewport()||a==getViewport0()||a==getViewport1()||a==getViewport2()?spanCells:a==getFrozColHeader()||a==getColHeader()?colSpanCells:a==getFrozRowHeader()||a==getRowHeader()?rowSpanCells:null}function updateRangeSelection(g,f,j,i,h,a){if(a==null)return;for(var b=g;b<g+j&&b<a.rows.length;b++){var d=a==getViewport()||a==getViewport2()?b+frzRows:b;if(IsChildSpreadRow(a,d))continue;for(var c=getCellIndex(d,f,getSpanCells(a)),e=0;e<i;e++){if(isCovered(d,f+e,getSpanCells(a)))continue;c<a.rows(b).cells.length&&paintSelectedCell(a.rows(b).cells(c),h);c++}}}function getColFromCell(a){if(a==null||a.style.display=="none"||a.parentElement==null)return-1;var b=getRowFromCell(a);return a.parentElement.parentElement==null?-1:a.parentElement.viewport!=null?getColIndex(b,a.cellIndex,getSpanCells(a.parentElement.viewport),a.parentElement.viewport==getViewport2(),a.parentElement.viewport==getFrozRowHeader()||a.parentElement.viewport==getRowHeader()):getColIndex(b,a.cellIndex,getSpanCells(a.parentElement.parentElement.parentElement),inFrozCols(a),isChild(a,getFrozRowHeader())||isChild(a,getRowHeader()))}function getRowFromCell(a){if(a==null||a.parentElement==null)return-1;var b=a.parentElement.rowIndex;if(frzRows>0&&(smartPaint&&(isChild(a,vpList.table)||isChild(a,vp2List.table)||isChild(a,rhList.table))||isChild(a,getViewport2())||isChild(a,getViewport())||isChild(a,getRowHeader())))b+=frzRows;return b}function getColIndex(j,f,i,h,g){var e=0,a=GetColCount(),d=frzCols;if(h){a=frzCols;d=0}else if(g){d=0;var b=null;if(getFrozRowHeader()!=null)b=getColGroup(getFrozRowHeader());else if(getRowHeader()!=null)b=getColGroup(getRowHeader());if(b!=null)a=b.childNodes.length}for(var c=d;c<a;c++){if(isCovered(j,c,i))continue;if(e==f)return c;e++}return a}function getCellIndex(i,a,b){var d=false,h=getViewport();if(h!=null)d=h.parentNode.hiddenCells;if(d&&b==spanCells)return b!=rowSpanCells&&a>=frzCols?a-frzCols:a;else{var g=0,e=a;if(b!=rowSpanCells&&a>=frzCols){g=frzCols;e=a-frzCols}for(var f=0,c=0;c<e;c++){if(isCovered(i,g+c,b))continue;f++}return f}}function nextCell(f,d,e){ignoreShowScrollingContent=true;var a=getScrollvp();if(a==null)a=getViewport().parentNode;var b=a.scrollTop,c=a.scrollLeft;__nextCell(f,d,e);ignoreShowScrollingContent=false;element.scrollContent&&(b!=a.scrollTop||c!=a.scrollLeft)&&showScrollingContent(b==a.scrollTop)}function __nextCell(k,m,w){if(window.event.altKey)return;if(m==null)m=window.event.shiftKey;var e=getScrollvp();if(e==null)e=getParent(getViewport());if(anchorCell==null){var l=fireActiveCellChangingEvent(0,0,element);if(!l){var n=getTopSpread(element);if(n!=element)l=n.Behavior.fireActiveCellChangingEvent(0,0,element)}if(!l){ClearSelection();leadingCellCol=0;leadingCellRow=0;updateAnchorCell(0,0);enableButtons();fireActiveCellChangedEvent(0,0,element);n!=element&&n.Behavior.fireActiveCellChangedEvent(0,0,element);window.event.returnValue=false}return}if(m&&k!=tab){if(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="MultiSelect"||operationMode=="Normal"&&element.SelectionPolicy=="Single")return;var d=getSpanCell(leadingCellRow,leadingCellCol,getSpanCells(getViewportFromCell(anchorCell))),j=operationMode=="ExtendedSelect"&&element.layoutMode==null;switch(k){case right:var a=leadingCellRow,c=leadingCellCol+1;if(d!=null)c=d.col+d.colCount;if(c>GetColCount()-1)return;leadingCellCol=c;leadingCell=getCellFromRowCol(a,c);if(j)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell);break;case left:var a=leadingCellRow,c=leadingCellCol-1;if(d!=null)c=d.col-1;d=getSpanCell(a,c,getSpanCells(getViewportFromCell(anchorCell)));if(d!=null)if(isSpanCell(a,d.col))c=d.col;if(c<0)return;leadingCellCol=c;leadingCell=getCellFromRowCol(a,c);if(j)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell);break;case down:var a=leadingCellRow+1,c=leadingCellCol;if(d!=null)a=d.row+d.rowCount;a=getNextRow(a);if(a>GetRowCountInternal()-1)return;leadingCellRow=a;leadingCell=getCellFromRowCol(a,c);if(j)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else{select(anchorCell,leadingCell);paintSelections(true)}break;case up:var a=leadingCellRow-1,c=leadingCellCol;if(d!=null)a=d.row-1;a=getPrevRow(a);d=getSpanCell(a,c,getSpanCells(getViewportFromCell(anchorCell)));if(d!=null)if(isSpanCell(d.row,c))a=d.row;if(a<0)return;leadingCellRow=a;leadingCell=getCellFromRowCol(a,c);if(j)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else{select(anchorCell,leadingCell);paintSelections(true)}break;case home:if(anchorCell.parentElement.rowIndex>=0){leadingCellCol=0;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);if(j)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell)}break;case end:if(anchorCell.parentElement.rowIndex>=0){leadingCellCol=GetColCount()-1;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);if(j)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell)}break;case pdn:if(getViewport()!=null&&leadingCellRow>=0){var o=0;for(a=leadingCellRow;a<getViewport().rows.length;a++){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;o+=f;if(o>getViewport().parentElement.offsetHeight)break}a=getNextRow(a);if(a<getViewport().rows.length){var g=getScrollvp();if(g==null)g=getViewport().parentElement;var p=Math.min(spreadView._GetMaxScrollTop(),element.virtualTop+getViewport().rows(a-frzRows).offsetTop);if(g.scrollTop!=p)g.scrollTop=p;leadingCellRow=a}else{a=GetRowCountInternal()-1;leadingCellRow=a}leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);if(j)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell)}break;case pup:if(getViewport()!=null&&leadingCellRow>=0){a=0;for(a=0;a<getViewport().rows.length;a++){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;if(getViewport().rows(a).offsetTop+f>getViewport().parentElement.scrollTop)break}if(a<getViewport().rows.length){var r=0;while(a>=0){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;r+=f;if(r>getViewport().parentElement.offsetHeight)break;a--}var x=frzRows;if(a<0){x=0;a=0}else a=getPrevRow(a);if(a>=0){var g=getScrollvp();if(g==null)g=getViewport().parentElement;g.scrollTop=frzRows>a?element.virtualTop:element.virtualTop+getViewport().rows(a).offsetTop;leadingCellRow=x+a;leadingCell=getCellFromRowCol(leadingCellRow,leadingCellCol);if(j)spreadView._DoExtendedSelect(getRowFromCell(anchorCell),leadingCellRow);else select(anchorCell,leadingCell)}}}}syncColSelection()}else{var v=k==tab;if(k==tab){if(m)k=left;else k=right;window.event.returnValue=false}var D=anchorCell,a,c;if(m){a=leadingCellRow;c=leadingCellCol}else if(getCellFromRowCol(leadingCellRow,leadingCellCol)==anchorCell){a=leadingCellRow;c=leadingCellCol}else{a=getRowFromCell(anchorCell);c=getColFromCell(anchorCell)}switch(k){case right:moveRight(a,c,v);break;case left:moveLeft(a,c,v);break;case down:moveDown(a,c,w,false,true);break;case up:moveUp(a,c,w,false,true);break;case home:anchorCell.parentElement.rowIndex>=0&&moveRight(a,-1,false);break;case end:anchorCell.parentElement.rowIndex>=0&&moveLeft(a,GetColCount(),false);break;case pdn:if(getViewport()!=null&&leadingCellRow>=0){var o=0;for(a=anchorCell.parentElement.rowIndex;a<getViewport().rows.length;a++){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;o+=f;if(o>getViewport().parentElement.offsetHeight)break}a=getNextRow(a);if(a<getViewport().rows.length){var g=getScrollvp();if(g==null)g=getViewport().parentElement;var p=Math.min(spreadView._GetMaxScrollTop(),element.virtualTop+getViewport().rows(a).offsetTop);if(g.scrollTop!=p)g.scrollTop=p;var q=getCellFromRowCol(frzRows+a,leadingCellCol);q.canFocus!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}else{a=getPrevRow(parseInt(element.RowCount)-1);var q=getCellFromRowCol(frzRows+a,leadingCellCol);q.canFocus!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}}break;case pup:if(getViewport()!=null&&leadingCellRow>=0){var s=0;if(element.virtualPaging=="true"){var C=window.document.getElementById(element.id+"_VirtualPaging_Top");s=C.offsetHeight}a=0;for(a=0;a<getViewport().rows.length;a++){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;if(getViewport().rows(a).offsetTop+f>getViewport().parentElement.scrollTop-s)break}if(a<getViewport().rows.length){var r=0;while(a>=0){var f=getViewport().rows(a).offsetHeight;if(f==0)f=getViewport().rows(a).style.posHeight;r+=f;if(r>getViewport().parentElement.offsetHeight)break;a--}a=getPrevRow(a);var l=true;if(frzRows>a&&a>=0){var g=getScrollvp();if(g==null)g=getViewport().parentElement;g.scrollTop=element.virtualTop;var q=getCellFromRowCol(frzRows+a,leadingCellCol);q.canFocus!="false"&&updateLeadingCell(a,leadingCellCol);l=false}if(a>=0&&l){var E=getViewport().rows(a).offsetTop+s,g=getScrollvp();if(g==null)g=getViewport().parentElement;g.scrollTop=E;var q=getCellFromRowCol(frzRows+a,leadingCellCol);q.canFocus!="false"&&updateLeadingCell(frzRows+a,leadingCellCol)}}}}if(D!=anchorCell&&anchorCell!=null){updateCmdBtnState("Update",false);operationMode=="Normal"&&fireSelectionChangedEvent(element);fpSpreadJS.keepGeneratedSelectionFromAnchorCell();ignoreVirtualPaging=true;scrollToCell(anchorCell,true);var z=GetSheetIndex(getRowFromCell(anchorCell)),y=getColFromCell(anchorCell),A=parseInt(anchorCell.parentElement.row);fireActiveCellChangedEvent(z,y,element,A);var n=getTopSpread(element);n!=element&&n.Behavior.fireActiveCellChangedEvent(z,y,element,A)}operationMode=="ExtendedSelect"&&selectRow(leadingCellRow,1,true,true)}var b=getCellFromRowCol(leadingCellRow,leadingCellCol);if(b!=anchorCell){ignoreVirtualPaging=true;scrollToCell(b)}e=getParent(getViewport());var i=getScrollvp();if(i==null)i=e;else{if(i.scrollTop!=e.scrollTop)i.scrollTop=e.scrollTop;if(i.scrollLeft!=e.scrollLeft)i.scrollLeft=e.scrollLeft}if(b!=null&&b.offsetWidth<e.clientWidth){if((isChild(b,e)||isChild(b,getViewport1()))&&b.offsetLeft+b.offsetWidth>e.scrollLeft+e.clientWidth)i.scrollLeft=b.offsetLeft+b.offsetWidth-e.clientWidth;if(getViewport1()!=null&&isChild(b,getViewport1())&&b.offsetLeft+b.offsetWidth>getViewport1().parentElement.scrollLeft+getViewport1().parentElement.clientWidth)i.scrollLeft=b.offsetLeft+b.offsetWidth-getViewport1().parentElement.clientWidth}if((isChild(b,e)||isChild(b,getViewport2()))&&b.offsetTop+b.offsetHeight>i.scrollTop+e.clientHeight&&b.offsetHeight<e.clientHeight)i.scrollTop=b.offsetTop+b.offsetHeight-e.clientHeight;if(getViewport2()!=null&&isChild(b,getViewport2())&&b.offsetTop+b.offsetHeight>getViewport2().parentElement.scrollTop+getViewport2().parentElement.clientHeight&&b.offsetHeight<getViewport2().parentElement.clientHeight)i.scrollTop=b.offsetTop+b.offsetHeight-getViewport2().parentElement.clientHeight;if(isChild(b,getViewport())||isChild(b,getViewport2())){if(b.offsetTop<e.scrollTop-element.virtualTop)i.scrollTop=b.offsetTop+element.virtualTop;if(getViewport2()!=null&&b.offsetTop<getViewport2().parentElement.scrollTop-element.virtualTop)i.scrollTop=b.offsetTop+element.virtualTop}window.event.returnValue=false;enableButtons();saveData();var l=true;if(anchorCell!=null){var h=!editing?getEditor(anchorCell):fpSpreadJS.GetInlineEditor(anchorCell);if(h!=null){var t=window.event.type=="keydown"||window.event.type=="keyup"||window.event.type=="keypress",B=t&&k!=window.event.keyCode;if(!B&&m&&t&&window.event.keyCode!=tab)h.blur();else{var u=getCellType(anchorCell);if(!h.disabled&&(u=="MultiColumnComboBoxCellType"||u=="ExtenderCellType"&&h.getElementsByTagName("INPUT").length>0||h.type==null||h.type=="checkbox"||h.type=="radio"||h.type=="text"||h.type=="password"||h.tagName=="TEXTAREA"||h.tagName=="SELECT")){if(smartPaint)element.forceLOD=true;editing=true;setEditorFocus(h);editor=h;editingValue=getEditorValue(h);renderAsEditor=1;setTimeout(function(){if(smartPaint&&typeof element.forceLOD!="undefined")element.forceLOD=null},100)}else setEditorFocus(h);l=false}isEditModeReplace(anchorCell)&&selectAllText()}}l&&focus(null,element.layoutMode);setTimeout(function(){ignoreVirtualPaging=false},100)}function moveUp(a,b,h,e,d){var g=GetRowCountInternal(),k=GetColCount(),f=1,i=false,c=getSpanCell(a,b,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null){a=c.row-1;if(c.col!=b)f=b-c.col+1}else a--;a=getPrevRow2(a,leadingCellCol,e,d);if(a<0&&h){if(b==f-1){a=getPrevCellRowIndex(g-1,k-1,e,d);b=getPrevCellColIndex(g-1,k-1,e,d)}else{a=getPrevCellRowIndex(g-1,b-f,e,d);b=getPrevCellColIndex(g-1,b-f,e,d)}i=true}if(a>=0){if(h&&i){var c=getSpanCell(a,b,spanCells);if(c!=null){a=c.row;b=c.col;var j=getCellFromRowCol(a,b);if(j.TabStop=="false"||j.canFocus=="false"){moveUp(a,b,h,e,d);return}}}updateLeadingCell(a,b)}}function moveDown(a,b,h,d,c){var g=GetRowCountInternal(),i=GetColCount(),f=1,e=getSpanCell(a,b,getSpanCells(getViewportFromCell(anchorCell)));if(e!=null){a=e.row+e.rowCount;f=e.colCount}else a++;a=getNextRow2(a,b,d,c);if(a==g)if(h)if(b==i-f){a=getNextCellRowIndex(0,0,d,c);b=getNextCellColIndex(0,0,d,c)}else{a=getNextCellRowIndex(0,b+f,d,c);b=getNextCellColIndex(0,b+f,d,c)}a<g&&updateLeadingCell(a,b)}function moveLeft(a,b,c){var f=a,h=GetRowCountInternal(),g=GetColCount();if(typeof c=="undefined")c=true;b=getPrevCol(a,b,c,true);if(b<0){b=g-1;a--;if(a<0)a=h-1;a=getPrevRow(a);leadingCellRow=a}var d=getCellFromRowCol(a,b);if(anchorCell!=d&&(c&&d.TabStop=="false"||d.canFocus=="false"))moveLeft(a,b,c);else{var e=updateLeadingCell(leadingCellRow,b);if(e)leadingCellRow=f}}function getPrevCol(d,g,f,e){var b=null,a=g,i=GetColCount();while(a>=0){var c=getSpanCell(d,a,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null)a=c.col-1;else a--;b=getCellFromRowCol(d,a);if(b==null)break;var h=f&&b.TabStop=="false"||e&&b.canFocus=="false";if(!h)break}return a}function moveRight(b,f,d){var e=b,a=moveRightInternal(b,f,d);if(a!=null){var c=updateLeadingCell(a.row,a.col);if(c)leadingCellRow=e}}function moveRightInternal(a,b,c){var e=GetRowCountInternal(),h=GetColCount();if(e==0||h==0)return null;var d=a>-1&&a<e?a:-1,g=b>-1&&b<h?b:-1,j=-1,i=false;if(typeof c=="undefined")c=true;do{if(a>=e){b=0;a=0;a=getNextRow(a);leadingCellRow=a}else{b=getNextCol(a,b,c,true);if(b>=h){if(i)break;b=0;a++;if(a>=e)a=0;if(a==d)i=true;a=getNextRow(a);leadingCellRow=a}}if(d<0||g<0){d=a;g=b}var f=getCellFromRowCol(a,b);if(f!=null&&f.canFocus!="false"&&!(c&&f.TabStop=="false"))return{row:a,col:b};j++}while(j==0||d!=a||g!=b);return null}function getPrevCellRowIndex(g,c,e,d){for(var h=GetColCount(),f=GetRowCountInternal(),b=g,a=c,a=c;a>=0;a--){if(a==c)b=getPrevRow2(g,a,e,d);else b=getPrevRow2(f-1,a,e,d);if(b>=0)break}if(b<0)for(a=h-1;a>c;a--){b=getPrevRow2(f-1,a,e,d);if(b>=0)break}return b}function getPrevCellColIndex(g,c,e,d){for(var h=GetColCount(),f=GetRowCountInternal(),b=g,a=c,a=c;a>=0;a--){if(a==c)b=getPrevRow2(g,a,e,d);else b=getPrevRow2(f-1,a,e,d);if(b>=0)break}if(b<0)for(a=h-1;a>c;a--){b=getPrevRow2(f-1,a,e,d);if(b>=0)break}return a}function getNextCellRowIndex(g,f,d,c){for(var h=GetColCount(),e=GetRowCountInternal(),b=g,a=0,a=f;a<h;a++){if(a==f)b=getNextRow2(g,a,d,c);else b=getNextRow2(0,a,d,c);if(b<e)break}if(b==e)for(a=0;a<f;a++){b=getNextRow2(0,a,d,c);if(b<e)break}return b}function getNextCellColIndex(g,f,d,c){for(var h=GetColCount(),e=GetRowCountInternal(),b=g,a=0,a=f;a<h;a++){if(a==f)b=getNextRow2(g,a,d,c);else b=getNextRow2(0,a,d,c);if(b<e)break}if(b==e)for(a=0;a<f;a++){b=getNextRow2(0,a,d,c);if(b<e)break}return a}function getNextCol(d,h,f,e){var b=null,a=h,g=GetColCount();while(a<g){var c=getSpanCell(d,a,getSpanCells(getViewportFromCell(anchorCell)));if(c!=null)a=c.col+c.colCount;else a++;b=getCellFromRowCol(d,a);if(b==null)break;var i=f&&b.TabStop=="false"||e&&b.canFocus=="false";if(!i)break}return a}function updateLeadingCell(b,a){var c=0;if(element.layoutMode){c=getRowFromViewPort(b,a);var e=getCellFromRowCol(c,a);if(e)c=e.parentElement.row}var d=fireActiveCellChangingEvent(b,a,element,c);if(!d){var f=getTopSpread(element);if(f!=element)d=f.Behavior.fireActiveCellChangingEvent(b,a,element,c)}if(!d){var g=operationMode;g!="MultiSelect"&&ClearSelection();leadingCellCol=a;leadingCellRow=b;selectStartCol=a;selectStartRow=b;updateAnchorCell(b,a,null,false,element.layoutMode)}return d}function getPrevRow2(g,e,d,c){var b=null,a=g;while(a>=0){a=getPrevRow(a);b=getCellFromRowCol(a,e);var f=d&&b.TabStop=="false"||c&&b.canFocus=="false";if(!f)break;a=a-1}return a}function getPrevRow(a){if(a<0)a=0;var b=getViewport();if(a<frzRows){b=getViewport0();if(b==null)b=getViewport1()}if(frzCols==0&&frzRows==0&&b!=null)while(a>0&&b.rows(a).cells.length>0)if(IsChildSpreadRow(b,a))a--;else break;var d=0;if(a>=frzRows){a=a-frzRows;d=frzRows}if(frzCols<GetColCount()){var c=getViewport2();while((c==null||a<c.rows.length&&c.rows(a).cells.length==0)&&b!=null&&a>0&&b.rows(a).cells.length==0)a--}if(b!=null&&a<b.rows.length)if(b.rows(a).previewRow)a--;return a+d}function getNextRow2(h,f,e,d){var b=null,a=h,c=GetRowCountInternal();while(a<c){a=getNextRow(a);if(a>=c)break;b=getCellFromRowCol(a,f);var g=e&&b.TabStop=="false"||d&&b.canFocus=="false";if(!g)break;a=a+1}return a}function getNextRow(a){var b=getViewport();if(a<frzRows){b=getViewport0();if(b==null)b=getViewport1()}var d=0;if(a>=frzRows){a=a-frzRows;d=frzRows}var e=frzCols==0&&frzRows==0;if(b!=null)while(a<b.rows.length)if(e&&IsChildSpreadRow(b,a)||b.rows(a).previewRow)a++;else break;if(frzCols<GetColCount()){var c=getViewport2();while((c==null||a<c.rows.length&&c.rows(a).cells.length==0)&&b!=null&&a<b.rows.length&&b.rows(a).cells.length==0)a++}return a+d}function GetSheetRowIndex(a){a=GetDisplayIndex(a);if(a<0)return-1;var b=null;if(frzRows>0){if(a>=frzRows&&getViewport()!=null)b=getViewport().rows(a-frzRows);else if(a<frzRows&&getViewport1()!=null){var c=getViewport1();b=c.rows(a)!=null?c.rows(a):c.rows[a]}}else b=getViewport().rows(a);return b!=null?b.FpKey:-1}function GetSheetColIndex(c,d){var a=-1;if(element.layoutMode){var e=getDisplayIndex(d),b=GetCellByRowCol(e,c);if(b!=null)a=parseInt(b.col)}else a=element.GetColKeyFromCol(c);return a}function GetCellByRowCol(a,b){a=GetDisplayIndex(a);return getCellFromRowCol(a,b)}function getHeaderCellFromRowCol(a,c,f){if(a<0||c<0)return null;var b=null;if(f)if(c<frzCols)b=getFrozColHeader();else b=getColHeader();else if(a<frzRows)b=getFrozRowHeader();else b=getRowHeader();var d=getSpanCell(a,c,getSpanCells(b));if(d!=null){a=d.row;c=d.col}var e=getCellIndex(a,c,getSpanCells(b));if(!f)if(a>=frzRows){a-=frzRows;if(b.rows(a).rowHolder)return rhList.getRow(a).cells(e)}return a<b.rows.length?b.rows(a).cells(e):null}function getCellFromRowCol(a,d,c){if(a<0||d<0)return null;var b=null;if(a<frzRows)if(d<frzCols)b=getViewport0();else b=getViewport1();else if(d<frzCols)b=getViewport2();else b=getViewport();if(b.parentNode==null)return;var f=getSpanCell(a,d,spanCells);if(f!=null){a=f.row;d=f.col}var e=0,g=false;if(b!=null&&b.parentNode!=null)g=b.parentNode.hiddenCells;if(c!=null&&c.parentNode!=null&&c.offsetParent!=null&&g!=null){if(c.cellIndex<c.parentElement.cells.length-1)e=c.cellIndex+1}else e=getCellIndex(a,d,spanCells);if(a>=frzRows){a-=frzRows;if(a>=0&&a<b.rows.length&&b.rows(a).rowHolder)if(b==getViewport())return vpList.getRow(a).cells(e);else if(b==getViewport2())return vp2List.getRow(a).cells(e)}return a>=0&&a<b.rows.length?b.rows(a).cells(e):null}function getFirstCellFromCol(f){for(var e=GetRowCountInternal(),d=GetColCount(),b=0;b<e;b++)for(var c=0;c<d;c++){var a=getCellFromRowCol(b,c);if(a!=null&&a.col==f)return a}return null}function GetHiddenCellValue(b,a){return fpSpreadJS.getValueOfHiddenCell(b,a,xmlData)}function SetHiddenCellValue(g,d,b){var a=fpSpreadJS.setValueOfHiddenCell(g,d,b,xmlData);if(a!=null){var e=this.GetRowByKey(a.r);e!=-1&&SetHiddenValue(e,d,b);var f=addTableCell(addTableRow(a.r),a.c);xmlData.textContent(f,b);var c=getCmdBtn("Update");c!=null&&c.disabled&&updateCmdBtnState(c,false);dirty=true}}function GetHiddenValue(b,a){return fpSpreadJS.getHiddenValue(b,a,hiddenColumns,getViewport(),getViewport0(),getViewport1(),getViewport2(),frzRows)}function SetHiddenValue(a,e,b){var d=fpSpreadJS.setHiddenValue(a,e,hiddenColumns,b,getViewport(),getViewport0(),getViewport1(),getViewport2(),frzRows);if(d!=-1){a=getRowKeyFromRow(a);fpSpreadJS.setValueOfHiddenCell(null,e,b,xmlData,a);var f=addTableCell(addTableRow(a),d);xmlData.textContent(f,b);var c=getCmdBtn("Update");c!=null&&c.disabled&&updateCmdBtnState(c,false);dirty=true}}function GetValue(a,e){a=GetDisplayIndex(a);var b=getCellFromRowCol(a,e),d=getRender(b),c=getValueFromRender(d);return c==" "&&b.whiteSpace==null?"":c}function SetValue(c,f,a,d,e){c=GetDisplayIndex(c);if(typeof a!="undefined"&&typeof a!="string")a=new String(a);var b=getCellFromRowCol(c,f);if(validateCell(b,a)){setCellValueFromView(b,a);if(a!=null)setCellValue(b,""+a,d,e);else setCellValue(b,"",d,e);sizeSpread()}else alert(spreadView.GetValidationMessage())}function SetActiveCell(a,b){var h=FpSpreadJS.getEditingSpread(getTopSpread(element));if(h!=null&&!h.EndEdit(null,{ignoreEditorFocus:true}))return;var c=getTopSpread(element);a=GetDisplayIndex(a);var d=0;if(element.getAttribute("layoutMode")){d=getRowFromViewPort(a,b);var k=getCellFromRowCol(d,b);if(k)d=k.parentElement.getAttribute("row")}var g=fireActiveCellChangingEvent(a,b,element,d);if(!g)if(c!=element)g=c.Behavior.fireActiveCellChangingEvent(a,b,element,d);if(g)return;spreadView.SuspendAction(c,GCWS.Actions.ACTIVE_CELL_CHANGING);spreadView.SuspendAction(c,GCWS.Actions.ACTIVE_CELL_CHANGED);$element.data("ignoreFireSelectionChanged",1);var j=$$.utils.getDocActiveElement(),f=window.document.FpActiveSpread;element.mcctCellType==null&&(f==null||f!=element||f==element&&j&&j.tagName=="BODY")&&doGetFocus({IgnoreFindActiveCell:true});var i=anchorCell;ClearSelection(true);a=GetDisplayIndex(a);updateAnchorCell(a,b);updateLeadingCell(a,b);var e=getScrollvp();if(e==null)e=getParent(getViewport());var m=getCellFromRowCol(a,b);if(m!=null&&e!=null)spreadView._IsCellHidden(anchorCell,true)&&scrollToCell(anchorCell,true);$element.removeData("ignoreFireSelectionChanged");spreadView.ResumeAction(c,GCWS.Actions.ACTIVE_CELL_CHANGING);spreadView.ResumeAction(c,GCWS.Actions.ACTIVE_CELL_CHANGED);if(anchorCell!=null&&i!=anchorCell){fireSelectionChangedEvent(element);fireActiveCellChangedEvent(a,b,element);var l=getEditor(i);$$.utils.contains(l,$$.utils.getDocActiveElement(),true)&&setTextBoxFocus()}}function updateAnchorCell(a,c,b,f,d){if(a<0||c<0)return;if(smartPaint&&vpList.table.rows.length>0&&a>=frzRows)if(a<current+frzRows)showRows(a-frzRows,current+frzRows-a+1);else a>=current+currentCount&&showRows(a-frzRows,1);anchorCell=getCellFromRowCol(a,c);if(anchorCell==null)return;spreadView.InitCellType(anchorCell);var e=getRowKeyFromCell(anchorCell);setActiveRow(e);setActiveCol(element.layoutMode?getColKeyFromCell2(anchorCell):getColKeyFromCell(anchorCell));if(b==null||b){if(operationMode=="RowMode"||operationMode=="SingleSelect")!isRowSelected(a)&&selectRow(a,1,true,true);paintSelections(true,d);paintFocusRect();fpSpreadJS.setImeMode(element,textBox,anchorCell);if(!(operationMode=="RowMode"||operationMode=="SingleSelect")&&operationMode!="MultiSelect"&&operationMode!="ExtendedSelect")selectType=""}}function resetLeadingCell(){ClearSelection();if(anchorCell==null)return;leadingCellRow=getRowFromCell(anchorCell);leadingCellCol=getColFromCell(anchorCell);selectRange(leadingCellRow,leadingCellCol,1,1,true)}function Edit(a){var d=operationMode;if(d!="RowMode")return;var b=element.name;if(dirty){saveData();dirty=false}var c=element.ajax!="false";if(c){FarPoint&&FarPoint.System.WebControl.MultiColumnComboBoxCellTypeUtilitis&&FarPoint.System.WebControl.MultiColumnComboBoxCellTypeUtilitis.CloseAll();syncData(b,"Edit,"+a)}else __doPostBack(b,"Edit,"+a)}function Update(){if(editing&&(!enableRowEditTemplate||operationMode!="RowMode"))return;saveData();var a=element.name,b=element.ajax!="false";if(b)syncData(a,"Update");else __doPostBack(a,"Update")}function MoveCol(e,c){if(editing)return;var a=null;if(window.document.FpActiveSpread!=null)a=window.document.FpActiveSpread.name;else a=element.name;if(selectedCols&&selectedCols.length>0){for(var d=[],b=0;b<selectedCols.length;b++)d[b]=GetSheetColIndex(selectedCols[b]);var g=d.join("+");moveMultiCol(g,c);return}var f=element.ajax!="false";if(f)syncData(a,"MoveCol,"+e+","+c);else __doPostBack(a,"MoveCol,"+e+","+c)}function moveMultiCol(b,c){if(editing)return;var a=null;if(window.document.FpActiveSpread!=null)a=window.document.FpActiveSpread.name;else a=element.name;var d=element.ajax!="false";if(d)syncData(a,"MoveCol,"+b+","+c);else __doPostBack(a,"MoveCol,"+b+","+c)}function Group(d,c){if(editing)return;var e=element.name;if(selectedCols&&selectedCols.length>0){for(var b=[],a=0;a<selectedCols.length;a++)if(element.layoutMode)b[a]=parseInt(selectedCols[a]);else b[a]=GetSheetColIndex(selectedCols[a]);var g=b.join("+");groupMultiCol(g,c);selectedCols=[];return}var f=element.ajax!="false";if(f)syncData(e,"Group,"+d+","+c);else __doPostBack(e,"Group,"+d+","+c)}function groupMultiCol(b,a){if(editing)return;var c=element.name,d=element.ajax!="false";if(d)syncData(c,"Group,"+b+","+a);else __doPostBack(c,"Group,"+b+","+a)}function Ungroup(b,a){if(editing)return;var c=element.name,d=element.ajax!="false";if(d)syncData(c,"Ungroup,"+b+","+a);else __doPostBack(c,"Ungroup,"+b+","+a)}function Regroup(a,b){if(editing)return;var c=element.name,d=element.ajax!="false";if(d)syncData(c,"Regroup,"+a+","+b);else __doPostBack(c,"Regroup,"+a+","+b)}function GroupBar(a){if(editing)return;var b=element.name,c=element.ajax!="false";if(c)syncData(b,"GroupBar,"+a);else __doPostBack(b,"GroupBar,"+a)}function GotoPage(b,c){if(editing)return;if(dirty){saveData();dirty=false}var a=element.name,d=element.ajax!="false";if(d)syncData(a,"Page,"+b,c);else __doPostBack(a,"Page,"+b)}function ScrollToPage(b,g,e){if(editing)return;if(dirty){saveData();dirty=false}var c=g?"ScrollUpToPage":"ScrollDownToPage",d=element.name,a=element.GetCurrentPageIndex(),f=element.ajax!="false";if(f)syncData(d,c+","+b+","+a,e);else __doPostBack(d,c+","+b+","+a)}function Cancel(){if(editing&&editor!=null){var c=getCell(editor);c&&spreadView._ResetValidatorStates(c)}var a=tableData.documentElement.selectSingleNode("//data");if(a!=null){var b=a.firstChild;while(b!=null){a.removeChild(b);b=a.firstChild}saveData()}var d=element.name,e=element.ajax!="false";if(e)syncData(d,"Cancel");else __doPostBack(d,"Cancel")}function Add(){if(editing)return;var a=null;if(window.document.FpActiveSpread!=null)a=window.document.FpActiveSpread.name;else a=element.name;var b=element.ajax!="false";if(b)syncData(a,"Add");else __doPostBack(a,"Add")}function Insert(){if(editing)return;var a=null;if(window.document.FpActiveSpread!=null)a=window.document.FpActiveSpread.name;else a=element.name;var b=element.ajax!="false";if(b)syncData(a,"Insert");else __doPostBack(a,"Insert")}function Delete(){if(editing)return;var a=null;if(window.document.FpActiveSpread!=null)a=window.document.FpActiveSpread.name;else a=element.name;var b=element.ajax!="false";if(b)syncData(a,"Delete");else __doPostBack(a,"Delete")}function Next(){if(editing)return;var a=element.name,b=element.ajax!="false";if(b)syncData(a,"Next");else __doPostBack(a,"Next")}function Prev(){if(editing)return;var a=element.name,b=element.ajax!="false";if(b)syncData(a,"Prev");else __doPostBack(a,"Prev")}function getViewportFromCell(b){if(b!=null){var a=b;while(a!=null){if(a.tagName=="TABLE")break;a=a.parentElement}if(a==getViewport0()||a==getViewport1()||a==getViewport2()||a==getViewport())return a}return null}function isChild(c,b){if(c==null||b==null)return false;var a=c.parentElement;while(a!=null){if(a==b)return true;a=a.parentElement}return false}function getCorner(){return corner}function getFrozColHeader(){return frozColHeader}function getFrozColFooter(){return frozColFooter}function getFooterCorner(){return footerCorner}function getFrozRowHeader(){return frozRowHeader}function getViewport0(){return viewport0}function getViewport1(){return viewport1}function getViewport2(){return viewport2}function getScrollvp(){return scrollvp}function select(g,f){if(!smartPaint&&(getSpreadControl(g)!=element||getSpreadControl(f)!=element))return;if(inRowHeader(g)||inRowHeader(f))if((selectionBlockOptions&SelectionBlockOptions.Rows)==0&&selectType!="r"&&operationMode=="Normal")return;if(inColHeader(g)||inColHeader(f))if((selectionBlockOptions&SelectionBlockOptions.Columns)==0&&selectType!="c"&&operationMode=="Normal")return;if(!isHeaderCell(g)&&!isHeaderCell(f))if((selectionBlockOptions&SelectionBlockOptions.Cells)==0&&selectType==""&&operationMode=="Normal")return;if(selectStartRow==null)selectStartRow=getRowFromCell(g);if(selectStartCol==null)selectStartCol=getColFromCell(g);var e=selectStartRow,d=selectStartCol,c=getRowFromCell(f),b=0;if(selectType=="r"){b=-1;if(isChild(f,getColHeader())||isChild(f,getFrozColHeader()))c=0}else if(selectType=="c"){if(isChild(f,getRowHeader())||isChild(f,getFrozRowHeader()))b=0;else b=getColFromCell(f);c=-1}else if(isChild(f,getColHeader())||isChild(f,getFrozColHeader())){c=0;b=getColFromCell(f)}else if(isChild(f,getRowHeader())||isChild(f,getFrozRowHeader()))b=0;else b=getColFromCell(f);if(selectType=="t")d=b=e=c=-1;var h=Math.max(e,c);e=Math.min(e,c);c=h;h=Math.max(d,b);d=Math.min(d,b);b=h;var a=null,j=getSelection(),i=j.lastChild;if(i!=null){var n=parseInt(i.getAttribute("rowIndex")),m=parseInt(i.getAttribute("colIndex")),l=parseInt(i.getAttribute("rowcount")),k=parseInt(i.getAttribute("colcount"));a=new Range;setRange(a,"Cell",n,m,l,k)}if(a!=null&&a.col==-1&&a.row==-1)return;if(a!=null&&a.col==-1&&a.row>=0)if(a.row>c||a.row+a.rowCount-1<e){paintSelection(a.row,a.col,a.rowCount,a.colCount,false);paintSelection(e,d,c-e+1,b-d+1,true)}else if(e>a.row){var h=e-a.row;if(a.row<frzRows&&frzRows<a.row+h)h--;paintSelection(a.row,a.col,h,a.colCount,false);if(c<a.row+a.rowCount-1)paintSelection(c,a.col,a.row+a.rowCount-c,a.colCount,false);else paintSelection(a.row+a.rowCount,a.col,c-a.row-a.rowCount+1,a.colCount,true)}else{paintSelection(e,a.col,a.row-e,a.colCount,true);if(c<a.row+a.rowCount-1)paintSelection(c+1,a.col,a.row+a.rowCount-c-1,a.colCount,false);else paintSelection(a.row+a.rowCount,a.col,c-a.row-a.rowCount+1,a.colCount,true)}else if(a!=null&&a.row==-1&&a.col>=0)if(a.col>b||a.col+a.colCount-1<d){paintSelection(a.row,a.col,a.rowCount,a.colCount,false);paintSelection(e,d,c-e+1,b-d+1,true)}else if(d>a.col){paintSelection(a.row,a.col,a.rowCount,d-a.col,false);if(b<a.col+a.colCount-1)paintSelection(a.row,b,a.rowCount,a.col+a.colCount-b,false);else paintSelection(a.row,a.col+a.colCount,a.rowCount,b-a.col-a.colCount,true)}else{paintSelection(a.row,d,a.rowCount,a.col-d,true);if(b<a.col+a.colCount-1)paintSelection(a.row,b+1,a.rowCount,a.col+a.colCount-b-1,false);else paintSelection(a.row,a.col+a.colCount,a.rowCount,b-a.col-a.colCount+1,true)}else if(a!=null&&a.row>=0&&a.col>=0)extendSelection(a,e,d,c-e+1,b-d+1);else paintSelection(e,d,c-e+1,b-d+1,true);setSelection(e,d,c-e+1,b-d+1,a==null)}function extendSelection(a,c,b,h,g){var i=Math.max(a.col,b),e=Math.min(a.col+a.colCount-1,b+g-1),f=Math.max(a.row,c),d=Math.min(a.row+a.rowCount-1,c+h-1);if(a.row<f)if(a.row<frzRows&&frzRows<f)paintSelection(a.row,a.col,f-a.row-1,a.colCount,false);else paintSelection(a.row,a.col,f-a.row,a.colCount,false);a.col<i&&paintSelection(a.row,a.col,a.rowCount,i-a.col,false);a.row+a.rowCount-1>d&&paintSelection(d+1,a.col,a.row+a.rowCount-d-1,a.colCount,false);a.col+a.colCount-1>e&&paintSelection(a.row,e+1,a.rowCount,a.col+a.colCount-e-1,false);c<f&&paintSelection(c,b,f-c,g,true);b<i&&paintSelection(c,b,h,i-b,true);c+h-1>d&&paintSelection(d+1,b,c+h-d-1,g,true);b+g-1>e&&paintSelection(c,e+1,h,b+g-e-1,true)}function paintSelection2(b,a,e,d,c){b<0&&a<0&&paintCornerSelection(c);if(b<0){rowIndex=b;b=0;e=GetRowCountInternal()}if(a<0){colIndex=a;a=0;d=GetColCount()}paintViewportSelection(b,a,e,d,c);paintAnchorCell();getColHeader()!=null&&operationMode=="Normal"&&paintHeaderSelection(b,a,e,d,c,true);getRowHeader()!=null&&paintHeaderSelection(b,a,e,d,c,false)}function paintSelection(a,c,d,b,e){var q=a,p=c;a<0&&c<0&&paintCornerSelection(e);var m=false,n=false,t,s,w;if(a<0){t=a;a=0;d=GetRowCountInternal()}if(c<0){s=c;c=0;b=GetColCount()}paintViewportSelection(a,c,d,b,e);(e||retainSelectionBlock)&&paintAnchorCell();for(var o=getSelection(),i,k,j,h,g,v=0,u=0,l,f,r=o.childNodes.length-1;r>=0;r--){i=o.childNodes[r];if(i){k=parseInt(i.getAttribute("rowIndex"));j=parseInt(i.getAttribute("colIndex"));h=parseInt(i.getAttribute("rowcount"));g=parseInt(i.getAttribute("colcount"));if(k<0||h<0){k=0;h=GetRowCountInternal()}if(j<0||g<0){j=0;g=GetColCount()}if(v<h)v=h;if(u<g)u=g;if(r>=o.childNodes.length-1){if(a<=k&&d>=h||element.layoutMode&&b==1&&a<parseInt(element.layoutRowCount))if(getColHeader()!=null&&operationMode=="Normal"){if(q<0||p<0)paintHeaderSelection(q,p,d,b,e,true);else paintHeaderSelection(a,c,d,b,e,true);m=true}if(c<=j&&b>=g)if(getRowHeader()!=null){paintHeaderSelection(a,c,d,b,e,false);n=true}if(!m&&!n){if(getColHeader()!=null&&operationMode=="Normal"){paintHeaderSelection(a,c,d,b,e,true);m=true}if(getRowHeader()!=null){paintHeaderSelection(a,c,d,b,e,false);n=true}}}else if(!e&&operationMode=="Normal"&&!element.layoutMode){l=rangeIntersection(a,c,d,b,k,j,h,g);l&&paintViewportSelection(l.row,l.col,l.rowCount,l.colCount,true);if(m){f=lineIntersection(c,b,j,g);f&&paintHeaderSelection(a,f.s,d,f.c,true,true)}if(n){f=lineIntersection(a,d,k,h);f&&paintHeaderSelection(f.s,c,f.c,b,true,false)}}}}if(t!=null||s!=null)if(v<d&&t<0||u<b&&s<0)w=true;if(o.childNodes.length<=0||element.SelectionPolicy=="MultiRange"&&w){if(getColHeader()!=null&&operationMode=="Normal")if(q<0||p<0)paintHeaderSelection(q,p,d,b,e,true);else paintHeaderSelection(a,c,d,b,e,true);getRowHeader()!=null&&paintHeaderSelection(a,c,d,b,e,false)}}function paintAnchorCellHeader(d){if(anchorCell==null||anchorCell.parentElement==null)return;var g=getColHeader(),f=getFrozColHeader();if(isChild(anchorCell,g)||isChild(anchorCell,f)){paintSelectedCell(anchorCell,d);return}var c,b;c=getRowFromCell(anchorCell);b=getColFromCell(anchorCell);if(d&&operationMode=="Normal"&&anchorCell.group!=null){var e=getSpanCell(c,b,spanCells);if(e!=null&&e.colCount>1){var a=GetSelectedRange();if(c<a.row||c>=a.row+a.rowCount||b<a.col||b>=a.col+a.colCount)return}}getColHeader()!=null&&paintHeaderSelection(c,b,1,1,d,true);spreadView._GetViewportFromCell(anchorCell,false)!=null&&getRowHeader()!=null&&paintHeaderSelection(c,b,1,1,d,false)}function rangeIntersection(i,g,e,c,j,h,f,d){var b=lineIntersection(i,e,j,f),a=lineIntersection(g,c,h,d);return b&&a?{row:b.s,col:a.s,rowCount:b.c,colCount:a.c}:null}function lineIntersection(c,e,d,f){var a,b;a=Math.max(c,d);b=Math.min(c+e,d+f);return a<b?{s:a,c:b-a}:null}function isBorderInCellRange(a){var b=null;if(a.type=="Cell"){if(a.rowCount==1)for(var c=a.col;c<a.col+a.colCount;c++){b=getCellFromRowCol(a.row,c);if(b!=null&&getBorderWidth(b,2)>0)return true}if(a.colCount==1)for(var d=a.row;d<a.row+a.rowCount;d++){b=getCellFromRowCol(d,a.col);if(b!=null&&getBorderWidth(b,1)>0)return true}}else if(a.type=="Row"&&a.rowCount==1)for(var e=GetColCount(),c=0;c<e;c++){b=getCellFromRowCol(a.row,c);if(b!=null&&getBorderWidth(b,2)>0)return true}else if(a.type=="Column"&&a.colCount==1)for(var f=GetRowCountInternal(),d=0;d<f;d++){b=getCellFromRowCol(d,a.col);if(b!=null&&getBorderWidth(b,1)>0)return true}return false}function paintFocusRect(){var e=window.document.getElementById(element.id+"_focusRectT");if(e==null)return;var a=GetSelectedRange();if(anchorCell==null&&(a==null||a.rowCount==0&&a.colCount==0)){hideFocusBorder();return}var q=element.OperationMode;if(q=="RowMode"||q=="SingleSelect"||q=="MultiSelect"||q=="ExtendedSelect"){var i=getActiveRow();if(i<0){var w=findAnchorCell();if(w!=null)i=GetSheetIndex(getRowFromCell(w));else return}if(element.layoutMode)i=getFirstMultiRowFromViewport(i,false);a=new Range;setRange(a,"Row",i,-1,1,-1)}else if(a==null||a.rowCount==0&&a.colCount==0){var i=getActiveRow(),g=getActiveCol();a=new Range;setRange(a,"Cell",i,g,anchorCell.rowSpan,anchorCell.colSpan)}if(a.row<0){a.row=0;a.rowCount=GetRowCountInternal()}if(a.col<0){a.col=0;a.colCount=GetColCount();if(element.layoutMode&&a.rowCount<parseInt(element.layoutRowCount)&&a.type=="Row")a.rowCount=parseInt(element.layoutRowCount)}var j,h,d,c,B=spreadView.GetAttribute("layoutMode")!=null,l=null;if(B&&anchorCell!=null&&a.type=="Column"&&a.rowCount>0&&frzRows==0&&frzCols==0){var E=parseInt(anchorCell.parentNode.getAttribute("row"));l=getSpanCell(E,a.col,spanCells)}if(l!=null&&l.col!=a.col){var p=getViewport(),G=p.parentNode,C=p.rows[0],x=p.rows[p.rows.length-1],y=parseInt(p.cellSpacing);j=C.offsetTop-y-1;h=anchorCell.offsetLeft-1;c=x.offsetTop+x.offsetHeight-y-1;d=anchorCell.offsetWidth-1;var b=getCellFromRowCol(l.row,l.col);if(b!=null&&spreadView._IsColumnHeaderCell(anchorCell)&&b.getAttribute("col")!=anchorCell.getAttribute("col")){hideFocusBorder();return}}else{var f;if(element.layoutMode)f=a.innerRow!=null?a.innerRow:a.row;else f=a.row;var b=null;if(f>-1)b=getCellFromRowCol(f,a.col);else if(element.layoutMode)if(anchorCell!=null){f=parseInt(anchorCell.parentElement.row);b=getCellFromRowCol(f,a.col)}else{var t=getSelection().lastChild;if(t!=null&&t.getAttribute("col")!="-1"){b=getFirstCellFromCol(t.getAttribute("col"));if(b)f=parseInt(b.parentElement.row)}}if(b==null)return;if(a.rowCount==1&&a.colCount==1){a.rowCount=b.rowSpan;a.colCount=b.colSpan;if(b.colSpan>1&&!isNaN(b.col)&&!element.layoutMode)a.col=getColByKey(b.col)}var n=getViewport().parentElement;j=getOffsetTop(b,n,true)-1;if(a.type=="Column"&&!element.layoutMode&&getColFromCell(b)<a.col){var i=getRowFromCell(b)+1,F=GetRowCountInternal(),l=null;while(i<F){l=getSpanCell(i,a.col,spanCells);if(l==null||l.col>=a.col)break;i++}b=getCellFromRowCol(i,a.col);if(b==null)b=getCellFromRowCol(f+a.rowCount-1,a.col);if(b==null)return}var D=b,s=f;if(f>-1)while(!isChild(b,n)){s++;if(s>=f+a.rowCount)return;b=getCellFromRowCol(s,a.col);if(b==null)return}h=getOffsetLeft(b,n,true)-1;b=D;if(parseInt(getViewport().cellSpacing)==0){if(a.row==0)j=j+1;if(a.col==0)h=h+1}if(b.rowSpan>1){f=b.parentNode.rowIndex;var o=getCellFromRowCol(f,a.col+a.colCount-1);if(o!=null&&o.parentNode.rowIndex>b.parentNode.rowIndex)j=getOffsetTop(o,n)-1;if(element.layoutMode&&a.rowCount<b.rowSpan&&(a.type=="Column"||a.type=="Row"))a.rowCount=b.rowSpan}if(b.colSpan>1){var o=getCellFromRowCol(f+a.rowCount-1,a.col),z=getOffsetLeft(o,n)-1;if(z>h){h=z;b=o}if(element.layoutMode&&a.colCount<b.colSpan&&(a.type=="Column"||a.type=="Row"))a.colCount=b.colSpan}if(b!=null&&spreadView._IsColumnHeaderCell(anchorCell)&&element.layoutMode&&b.getAttribute("col")!=anchorCell.getAttribute("col")){hideFocusBorder();return}c=0;var k=getViewport().rows;if(k.length>0){var r=f+a.rowCount,A=k[r]?getOffsetTop(k[r],n,true):getOffsetTop(k[k.length-1],n,true)+k[k.length-1].offsetHeight;c=A-j;if(r<k.length)c-=parseInt(getViewport().cellSpacing)}d=0;var m=getColGroup(getViewport());if(m.childNodes==null||m.childNodes.length==0)return;for(var g=a.col;g<a.col+a.colCount&&g<m.childNodes.length;g++){d+=engine==8?parseInt(m.childNodes[g].width):m.childNodes[g].offsetWidth;if(g>a.col)d+=parseInt(getViewport().cellSpacing)}if(a.col>b.cellIndex&&a.type=="Column"){var u=element.layoutMode?parseInt(b.scol):parseInt(b.col);if(b.group)u=b.cellIndex;for(var g=u;g<a.col;g++){h+=engine==8?parseInt(m.childNodes[g].width):m.childNodes[g].offsetWidth;if(g>u)h+=parseInt(getViewport().cellSpacing)}}if(parseInt(getViewport().cellSpacing)==0){d+=1;c+=1;if(a.col+a.colCount>=GetColCount())d-=1;if(a.row+a.rowCount>=GetRowCountInternal())c-=1}else if(isBorderInCellRange(a))if(a.type=="Cell"){if(a.rowCount==1)c=c+1;if(a.colCount==1)d=d+1}else if(a.type=="Row")c=c+1;else if(a.type=="Column")d=d+1;c=c-1;d=d-1}if(d<0)d=0;if(c<0)c=0;e.style.left=""+h+"px";e.style.top=""+j+"px";e.style.width=""+d+"px";var v=element.id;e=window.document.getElementById(v+"_focusRectB");e.style.left=""+h+"px";e.style.top=""+(j+c)+"px";e.style.width=""+d+"px";e=window.document.getElementById(v+"_focusRectL");e.style.left=""+h+"px";e.style.top=""+j+"px";e.style.height=""+c+"px";e=window.document.getElementById(v+"_focusRectR");e.style.left=""+(h+d)+"px";e.style.top=""+j+"px";e.style.height=""+c+"px"}function paintCornerSelection(e){var d=true;if(getTopSpread(element).getAttribute("ShowHeaderSelection")=="false")d=false;if(!d)return;var a=getCorner();if(a!=null&&a.rows.length>0)for(var b=0;b<a.rows.length;b++){if(a.rows[b].getAttribute("FpSpread")=="fb")continue;for(var c=0;c<a.rows(b).cells.length;c++)a.rows(b).cells(c)!=null&&paintSelectedCell(a.rows(b).cells(c),e)}}function paintHeaderSelection(a,b,f,h,m,e){var j=true;if(getTopSpread(element).getAttribute("ShowHeaderSelection")=="false")j=false;if(!j)return;var p=e?colSpanCells:rowSpanCells;if(a>=0&&b>=0&&element.layoutMode&&e){if(f>parseInt(element.layoutRowCount))f=parseInt(element.layoutRowCount);var k=getCellFromRowCol(a,b);if(element.allowGroup&&k&&k.group!=null)a=getFirstMultiRowFromViewport(a,true);for(var c=a;c<a+f;c++)for(var d=b;d<b+h;d++){var n=getCellFromRowCol(c,d);if(n){var g=spreadView._GetHeaderCellFromViewportCell(n);if(g){if(g.parentNode.getAttribute("FpSpread")=="fb")return;paintSelectedCell(g,m)}}}}else{var i=GetRowCountInternal(),o=GetColCount();if(e){if(getColHeader()==null)return;a=0;f=i=getColHeader().rows.length;if(b<0){b=0;h=frzCols+getColGroup(getColHeader()).childNodes.length}}else{if(getRowHeader()==null)return;b=0;var l=getColGroup(getRowHeader());if(l==null)return;h=o=l.childNodes.length}if(element.layoutMode&&operationMode!="Normal"&&!e)a=getFirstMultiRowFromViewport(a,false);if(element.layoutMode&&anchorCell!=null&&anchorCell.group!=null&&!e&&f!=i)f=1;for(var c=a;c<a+f&&c<i;c++){if(!e&&IsChildSpreadRow(getViewport(),c))continue;for(var d=b;d<b+h&&d<o;d++){if(!element.layoutMode&&isCovered(c,d,p))continue;var g=getHeaderCellFromRowCol(c,d,e);if(g){if(g.parentNode.getAttribute("FpSpread")=="fb")return;paintSelectedCell(g,m)}}}}}function paintViewportSelection(e,g,d,j,h){var f=GetRowCountInternal(),i=GetColCount();if(element.layoutMode&&operationMode!="Normal"&&d==parseInt(element.layoutRowCount))e=getFirstMultiRowFromViewport(e,false);if(element.layoutMode&&anchorCell!=null&&anchorCell.group!=null&&d!=f)d=1;for(var a=e;a<e+d&&a<f;a++){if(frzCols==0&&frzRows==0&&IsChildSpreadRow(getViewport(),a))continue;for(var b=null,c=g;c<g+j&&c<i;c++){if(isCovered(a,c,spanCells))continue;b=getCellFromRowCol(a,c,b);b!=null&&b.parentNode.getAttribute("previewRow")==null&&paintSelectedCell(b,h)}}}function Copy(i){if(window.document.FpActiveSpread!=null&&window.document.FpActiveSpread!=element){window.document.FpActiveSpread.Copy(i);return}var p=getCmdBtn("Copy");if(p!=null&&p.ignoreClick){p.ignoreClick=null;return}if(enableRowEditTemplate=="true"&&operationMode=="RowMode")return;var t=getSelection(),b=t.lastChild;if(b!=null){var j,g,d,k,h;copymultiCol=false;if(element.layoutMode&&b.getAttribute("col")!="-1"&&b.getAttribute("row")=="-1"&&b.getAttribute("rowcount")=="-1"){var a=anchorCell;if(a){j=parseInt(a.parentElement.row);var v=spreadView._GetFirstCellFromLayoutCol(b.getAttribute("col"));g=getRowFromCell(v);d=getColFromCell(a);k=GetRowCountInternal();h=parseInt(b.getAttribute("colcount"));copymultiCol=true}}else if(element.layoutMode&&b.getAttribute("col")=="-1"&&b.getAttribute("colcount")=="-1"&&b.getAttribute("row")!=-1){var l=b.getAttribute("row");if(l!="newRow")l=parseInt(l);g=getFirstRowFromKey(l);d=parseInt(b.getAttribute("colIndex"));k=parseInt(element.layoutRowCount)}else{g=element.layoutMode?parseInt(b.getAttribute("rowIndex")):getRowByKey(b.getAttribute("row"));d=element.layoutMode?parseInt(b.getAttribute("colIndex")):getColByKey(b.getAttribute("col"));k=parseInt(b.getAttribute("rowcount"));h=parseInt(b.getAttribute("colcount"))}var n=false;if(g<0||copymultiCol){if(!copymultiCol){g=0;k=GetRowCountInternal()}var w=fireCopyData(false);n=w.includeColHeader}if(d<0){d=0;h=GetColCount()}if(j==null)j=g;var c="";if(n){var s=g,r=getColHeader().rows,o=rl=r.length;while(rl>0&&r[rl-1].getAttribute("FpSpread")=="fb")rl--;if(element.layoutMode&&rl>0){o=parseInt(element.layoutRowCount);var u=spreadView._GetFirstCellFromLayoutCol(b.getAttribute("col"),true);s=u.parentNode.rowIndex}else o=rl;for(var e=s;e<o;e++){if(e<rl)for(var a=null,f=d;f<d+h;f++){if(isCovered(e,f,colSpanCells))c+="";else{a=getHeaderCellFromRowCol(e,f,true);if(element.layoutMode&&copymultiCol&&(a==null||parseInt(a.parentElement.row)!=j))continue;var m=getCellType(a);if(m=="TextCellType"||m=="text")if(a!=null&&a.getAttribute("password")!=null)c+="";else c+=spreadView._PrepairValueToCopy(getCellValueFromView(a),i);else c+=i?spreadView._PrepairValueToCopy(getCellValueFromView(a),true):getCellValueFromView(a)}if(f+1<d+h)c+="\t"}c+="\r\n"}}var q=g;if(n)q=0;for(var e=q;e<g+k;e++){if(IsChildSpreadRow(getViewport(),e))continue;for(var a=null,f=d;f<d+h;f++){if(isCovered(e,f,spanCells))c+="";else{a=getCellFromRowCol(e,f,a);if(element.layoutMode&&copymultiCol&&(a==null||parseInt(a.parentElement.row)!=j))continue;if(a!=null&&a.parentNode.previewRow!=null)continue;var m=getCellType(a);if(m=="TextCellType"||m=="text")if(a!=null&&a.getAttribute("password")!=null)c+="";else c+=spreadView._PrepairValueToCopy(getCellValueFromView(a),i);else c+=i?spreadView._PrepairValueToCopy(getCellValueFromView(a),true):getCellValueFromView(a)}if(f+1<d+h)c+="\t"}c+="\r\n"}setClipboardData(c)}else if(anchorCell!=null){var c=i?spreadView._PrepairValueToCopy(getCellValueFromView(anchorCell),true):getCellValueFromView(anchorCell);setClipboardData(c)}}function getClipboardData(){var a=element.clipboard==null;try{if(a){a=false;window.clipboardData.getData("Text");a=true}}catch(b){}return a?window.clipboardData.getData("Text"):window.ssClipboardData}function setClipboardData(b){var a=element.clipboard==null;try{if(a){a=false;window.clipboardData.getData("Text");a=true}}catch(c){}if(a)window.clipboardData.setData("Text",b);else window.ssClipboardData=b}function getCellValueFromView(b){var a=null;if(b!=null){var c=getRender(b);a=getValueFromRender(c);if(a==null||a==" ")a=""}return a}function setCellValueFromView(a,f,e){if(a!=null){var b=getRender(a),d=getCellType(a),c=false;if(d=="readonly"&&a.getAttribute("locked")!="true"&&a.canFocus=="false")c=true;if((d!="readonly"||e||c)&&b!=null&&b.FpEditor!="Button"){setValueToRender(b,f);return true}}return false}function Paste(q){if(window.document.FpActiveSpread!=null&&window.document.FpActiveSpread!=element){window.document.FpActiveSpread.Paste(q);return}if(enableRowEditTemplate=="true"&&operationMode=="RowMode")return;if(anchorCell==null)return;var s=getCmdBtn("Paste");if(s!=null&&s.ignoreClick){s.ignoreClick=null;return}var r=getClipboardData();if(r==null)return;var H=getViewportFromCell(anchorCell),g=getRowFromCell(anchorCell),h=getColFromCell(anchorCell),D=GetColCount(),t=GetRowCountInternal(),l=element.layoutMode,x=anchorCell.getAttribute("col"),y=parseInt(anchorCell.parentElement.row),z=false,A=getSelection();if(A!=null){var d=A.lastChild;if(d!=null){var g=parseInt(d.getAttribute("row")),h=parseInt(d.getAttribute("col"));if(l&&d.getAttribute("col")!="-1"&&d.getAttribute("row")=="-1"&&d.getAttribute("rowcount")=="-1"){var G=spreadView._GetFirstCellFromLayoutCol(d.getAttribute("col"));g=getRowFromCell(G);h=getColFromCell(anchorCell);z=true}else if(l&&d.getAttribute("col")=="-1"&&d.getAttribute("colcount")=="-1"&&d.getAttribute("row")!=-1){var o=d.getAttribute("row");if(o!="newRow")o=parseInt(o);g=getFirstRowFromKey(o);h=parseInt(d.getAttribute("colIndex"))}else{g=l?parseInt(d.getAttribute("rowIndex")):getRowByKey(d.getAttribute("row"));h=l?parseInt(d.getAttribute("colIndex")):getColByKey(d.getAttribute("col"))}if(g<0)g=0;if(h<0)h=0}}if(z&&x!=null&&parseInt(x)>=0)copymultiCol=true;var f=g,e=h,n=0,c=null;if(q){c=spreadView._PrepairPasteData(r);for(var b=0;b<c.length;b++)if(c[b].length>n)n=c[b].length}else{var m=new String(r);if(m.length==0)return;var u=m.lastIndexOf("\r\n");if(u>=0&&u==m.length-2)m=m.substring(0,u);c=m.split("\r\n");for(var b=0;b<c.length&&f<t;b++){if(typeof c[b]=="string"){c[b]=c[b].split("\t");if(c[b].length>n)n=c[b].length}f++}}if(canValidate()){f=GetSheetIndex(g);for(var b=0;b<c.length&&f<t;b++){var k=c[b];if(k!=null){e=h;for(var a=null,p=GetDisplayIndex(f),i=0;i<k.length&&e<D;i++){if(!isCovered(p,e,spanCells)){a=getCellFromRowCol(p,e,a);if(a==null)continue;if(l&&copymultiCol&&parseInt(a.parentElement.row)!=y)continue;if(a.parentNode.previewRow!=null)continue;var j=k[i];if(!validateCell(a,j)){alert(spreadView.GetValidationMessage());return}}e++}}f++}}if(c.length==0)return;f=GetSheetIndex(g);for(var b=0;b<c.length&&f<t;b++){e=h;for(var k=c[b],a=null,p=GetDisplayIndex(f),i=0;i<n&&e<D;i++){if(!isCovered(p,e,spanCells)){a=getCellFromRowCol(p,e,a);if(a==null)continue;if(l&&copymultiCol&&parseInt(a.parentElement.row)!=y)continue;if(a.parentNode.previewRow!=null)continue;var B=getCellType(a),C=getRender(a);if(a.CellType2=="HyperLinkCellType")continue;if(B!="readonly"&&C.FpEditor!="Button"||B=="readonly"&&a.getAttribute("locked")!="true"){var j=null;if(k!=null&&i<k.length)j=q?k[i]:trimQuote(k[i]);var F=setCellValueFromView(a,j);if(F){if(j!=null)j=getValueFromRender(C,false,true);if(j!=null)setCellValue(a,""+j);else setCellValue(a,"");$$.browser.quirksMode&&spreadView.RepaintCellCDF(a)}}}e++}f++}if(xhtml){var v=false;if(frzCols>0){var w=checkIntersectWithSpan(g);if(w){layoutRange(w);if(g<frzRows)v=true}}if(v){getRowHeader()!=null&&EnsureAllRowHeights();sizeSpread()}else{sizeSpread();getRowHeader()!=null&&EnsureAllRowHeights()}}var E=element.autoCalc;if(E!="false")updateValues();else saveData();getRowHeader()==null&&frzCols==0&&prepairSpreadLayout()}function getFrozenRowCount(){if(frzRows==0)return 0;var a=getViewport0();if(a==null)a=getViewport1();for(var c=0,b=0;b<a.rows.length;b++){if(!a.rows[b].FpKey)continue;c++}return Math.min(frzRows,c)}function trimQuote(a){if(a==null||a.length==0)return null;if(a.indexOf("\n")<=0)return a;if(a.charAt(0)=='"'&&a.charAt(a.length-1)=='"')a=a.substring(1,a.length-1);var b=new RegExp('""',"g");a=a.replace(b,'"');return a}function updateValues(){if(dataBuff==null&&getParentSpread()==null&&element.rowFilter!="true"&&element.hierView!="true"&&element.IsNewRow!="true"){saveData();storePostData();syncData(element.name,"UpdateValues")}}function validateCell(a,c){if(a==null)return true;if(spreadView.HasValidators(a)&&a.getAttribute("locked")!="true")return spreadView.GetInvalidValidator(a,c)==null;if(c==null||c=="")return true;var b=getEditor(a);if(b==null){var e=getCellEditorID(a);if(e!=null)b=getCellEditor(e,true)}if(b!=null&&typeof b.isValid!="undefined"){var d=b.isValid(c);return d==""}var f=getCellType(a);if(f!=null){var g=getFunction(f+"_isValid");if(g!=null){var d=g(a,c);return d==null||d==""}}return true}function isDouble(e,b){if(e==null||e.length==0)return true;var i=new RegExp("^\\s*([-\\+])?(\\d+)?(\\"+b.decimalchar+"(\\d+))?([eE]([-\\+])?(\\d+))?\\s*$"),a=e.match(i);if(a==null)return false;var h=a[1]+(a[2].length>0?a[2]:"0")+"."+a[4]+"E"+a[6]+(a[7].length>0?a[7]:"0"),d=parseFloat(h);if(isNaN(d))return false;var c=true;if(b.minimumvalue!=null){var g=parseFloat(b.minimumvalue);c=!isNaN(g)&&d>=g}if(c&&b.maximumvalue!=null){var f=parseFloat(b.maximumvalue);c=!isNaN(f)&&d<=f}return c}function updateSelectionsBackColor(j,i){for(var h=getSelection(),b=null,f=0;f<h.childNodes.length;f++){b=h.childNodes[f];var g=parseInt(b.getAttribute("rowIndex")),e=parseInt(b.getAttribute("colIndex")),l=parseInt(b.getAttribute("rowcount")),k=parseInt(b.getAttribute("colcount"));if(g!=-1&&e!=-1)for(var c=0;c<l;c++)for(var d=0;d<k;d++){if(j==g+c&&i==e+d)continue;var a=getCellFromRowCol(g+c,e+d);if(a!=null&&a.paintSelected==null){if(element.semiTransparentSelectedBackColor==null||a.currentStyle.backgroundColor==null||a.currentStyle.backgroundColor.length==0||a.currentStyle.backgroundColor=="transparent")a.style.backgroundColor=selectedBackColor;else a.style.backgroundColor=darker(a.currentStyle.backgroundColor,selectedBackColor);a.paintSelected=true}}}}function doClearSelection(){var e=getSelection(),a=e.lastChild;while(a!=null){var b=parseInt(a.getAttribute("rowIndex")),d=parseInt(a.getAttribute("colIndex")),c=parseInt(a.getAttribute("rowcount")),g=parseInt(a.getAttribute("colcount"));if(element.layoutMode&&b!=-1&&(g==-1||operationMode!="Normal")){c=parseInt(element.layoutRowCount);paintSelection(b,-1,c,-1,false)}if(element.layoutMode&&d!=-1&&(c==-1||operationMode!="Normal")){var f=spreadView._GetFirstCellFromLayoutCol(a.getAttribute("col"));if(f){b=parseInt(f.parentElement.row);d=getColFromCell(f)}paintMultipleRowSelection(b,d,1,g,false)}else paintSelection(b,d,c,g,false);e.removeChild(a);a=e.lastChild}}function Clear(useExcelBehavior){var btn=getCmdBtn("Clear");if(btn!=null&&btn.ignoreClick){btn.ignoreClick=null;return}if(window.document.FpActiveSpread!=null&&window.document.FpActiveSpread!=element){window.document.FpActiveSpread.Clear(useExcelBehavior);return}if(enableRowEditTemplate=="true"&&operationMode=="RowMode")return;var cellType=getCellType(anchorCell);if(cellType=="readonly")return;var selection=getSelection(),node=selection.lastChild;if(anyReadOnlyCell(node))return;Copy(useExcelBehavior);if(node!=null){var r,c,rc,cc,IsColumn=false;if(element.layoutMode&&node.getAttribute("col")!="-1"&&node.getAttribute("row")=="-1"&&node.getAttribute("rowcount")=="-1"){var cell=anchorCell;if(cell){r=parseInt(cell.parentElement.row);c=getColFromCell(cell);rc=GetRowCountInternal();cc=parseInt(node.getAttribute("colcount"));IsColumn=true}}else if(element.layoutMode&&node.getAttribute("col")=="-1"&&node.getAttribute("row")!=-1){var rowKey=node.getAttribute("row");if(rowKey!="newRow")rowKey=parseInt(rowKey);r=getFirstRowFromKey(rowKey);c=parseInt(node.getAttribute("colIndex"));rc=parseInt(element.layoutRowCount)}else{r=parseInt(node.getAttribute("rowIndex"));c=parseInt(node.getAttribute("colIndex"));rc=parseInt(node.getAttribute("rowcount"));cc=parseInt(node.getAttribute("colcount"))}if(r<0){r=0;rc=GetRowCountInternal()}if(c<0){c=0;cc=GetColCount()}for(var activeElement=window.document.activeElement,requireKeepFocus=false,i=r;i<r+rc;i++){if(IsChildSpreadRow(getViewport(),i))continue;for(var cell=null,j=c;j<c+cc;j++)if(!isCovered(i,j,spanCells)){cell=getCellFromRowCol(i,j,cell);if(cell==null)continue;if(element.layoutMode&&IsColumn&&parseInt(cell.parentElement.row)!=r)continue;if(cell.parentNode.previewRow!=null)continue;var cellType=getCellType(cell);if(cellType!="readonly"){var edit=getEditor(cell);if(edit!=null&&edit.FpEditor=="Button")continue;if(edit!=null&&edit.FpEditor=="MultiColumnComboBoxCellType"){var mccbId=getMccbID(cell,element);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");editorObj!=null&&editorObj.SetText(null)}}else{cell.removeAttribute("FpFormula");setCellValueFromView(cell,null)}setCellValue(cell,"");if(!requireKeepFocus&&cellType=="ExtenderCellType"){var cellEditor=getEditor(cell);if(cellEditor!=null&&cellEditor.getAttribute("Extenders")!=null&&cellEditor.getAttribute("Extenders").indexOf("MaskedEditExtender")!=-1)requireKeepFocus=true}}}}if(requireKeepFocus&&activeElement!=window.document.activeElement&&$$.utils.contains(getTopSpread(element),activeElement)){detachActiveEvents();activeElement.focus();attachActiveEvents()}xhtml&&sizeSpread();var autoCalc=element.autoCalc;if(autoCalc!="false")updateValues();else saveData()}}function anyReadOnlyCell(b){if(b!=null){var f=parseInt(b.getAttribute("rowIndex")),d=parseInt(b.getAttribute("colIndex")),i=parseInt(b.getAttribute("rowcount")),h=parseInt(b.getAttribute("colcount")),g=null;if(element.layoutMode&&b.getAttribute("col")!="-1"){var a=getFirstCellFromCol(b.getAttribute("col"));if(a)g=a.parentElement.row}if(f<0){f=0;i=GetRowCountInternal()}if(d<0){d=0;h=GetColCount()}for(var c=f;c<f+i;c++){if(IsChildSpreadRow(getViewport(),c))continue;for(var a=null,e=d;e<d+h;e++)if(!isCovered(c,e,spanCells)){a=getCellFromRowCol(c,e,a);if(g!=null&&a!=null&&a.parentElement.row!=g)continue;var j=getCellType(a);if(j=="readonly")return true}}}return false}function moveSlideBar(e){var c=getElementById(activePager,element.id+"_slideBar"),a=e.clientX-12,b=getOffsetLeft(activePager,window.document.body);a-=b;if(element.style.position!="absolute"&&element.style.position!="relative"&&!xhtml)a-=window.document.body.leftMargin;if(a<slideLeft)a=slideLeft;if(a>slideRight)a=slideRight;var d=parseInt(activePager.totalPage)-1,f=parseInt((a-slideLeft)/(slideRight-slideLeft)*d)+1;c.style.posLeft=a;return f}function getOffsetParent(b){var a=b;while(a!=null&&a.currentStyle.position!="absolute"&&a.currentStyle.position!="relative"&&a.currentStyle.position!="fixed")a=a.offsetParent;if(a==null)a=window.document.documentElement;return a}function mouseMove(){if(!initialized)return;if(!isMouseMoving&&mouseX==window.event.clientX&&mouseY==window.event.clientY)return;isMouseMoving=true;if(window.fpPostOn!=null)return;if(dragSlideBar){if(window.event.button==1&&activePager!=null){var U=moveSlideBar(window.event),s=getElementById(activePager,element.id+"_posIndicator");s.innerHTML=activePager.getAttribute("pageText")+U}return}if(!working&&hitCommandBar())return;if(element.OperationMode=="ReadOnly")return;working&=window.event.button==1;if(!working&&!editing)if(sizeColumn==null&&sizeRow==null&&window.document.FpActiveSpread==element&&!spreadView.IsFilterBarTextBox(window.event.srcElement)&&element.captureElement!=null){window.document.releaseCapture();element.captureElement=null}if(working){if(dragCol>=0){var o=getMovingCol();if(o!=null){if(o.style.display=="none")o.style.display="";var f=-3;if(!xhtml)f+=parseInt(element.style.borderWidth);var l=window.event.clientX;if(xhtml&&element.currentStyle.position!="absolute"&&element.currentStyle.position!="relative"){var y=getOffsetParent(element);o.style.posTop=window.event.clientY-getOffsetTop(y,window.document.body)+getScrollTop(element)-f;o.style.posLeft=window.event.clientX-getOffsetLeft(y,window.document.body)+getScrollLeft(element)-f;l-=getOffsetLeft(y,window.document.body)}else{o.style.posTop=window.event.clientY-getOffsetTop(element,window.document.body)+getScrollTop(element)-f;o.style.posLeft=window.event.clientX-getOffsetLeft(element,window.document.body)+getScrollLeft(element)-f}var T=getViewport(),V=window.document.body,d=getGroupBar(),a=-1,x=0,e=-T.parentElement.scrollLeft,J=getDummy();if(J!=null&&GetRowCount()==0)e=e-J.parentElement.scrollLeft;if(xhtml&&element.currentStyle.position!="absolute"&&element.currentStyle.position!="relative"){var y=getOffsetParent(element);x=getOffsetTop(element,y);e+=getOffsetLeft(element,y);l+=Math.max(window.document.body.scrollLeft,window.document.documentElement.scrollLeft)}else l-=getOffsetLeft(element,window.document.body)-Math.max(window.document.body.scrollLeft,window.document.documentElement.scrollLeft);if(d!=null&&(isChild(event.srcElement,d)||event.srcElement==d)){for(var k=0;k<d.childNodes.length;k++){var C=d.childNodes[k].offsetWidth;if(C==null)continue;if(e<=l&&l<e+C){a=k;break}e+=C}if(a==-1&&l>=e)a=-2;element.targetCol=a}else{var G=spreadView.CellSpacing;if(getRowHeader()!=null)e+=getRowHeader().offsetWidth-G;if(d!=null)x+=d.offsetHeight;if(l<e)a=0;else{var m=selectedCols.context;if(m){for(var k=0;k<m.length;k++)if(m[k].left+e<=l&&l<m[k].left+e+m[k].width+G){a=k;break}if(isColSelected(a))while(isColSelected(a)&&isColSelected(a-1))a--;else if(isColSelected(a-1))a++;if(a<0)a=0;if(a>=m.length)a=m.length-1;e+=m[a].left}}var z=parseInt(GetSheetColIndex(a));if(z<0)if(selectedCols.context){var H=selectedCols.context[a].colKey;z=H?H:a}else z=a;element.targetCol=z}var K=window.document.getElementById(element.id+"_titleBar");if(K)x+=K.parentNode.parentNode.offsetHeight;if(getPager1()!=null)x+=getPager1().offsetHeight;var s=getPosIndicator();s.style.posLeft=e-6;s.style.posTop=x;if(d!=null&&(isChild(event.srcElement,d)||event.srcElement==d)&&(d.childNodes.length<1||d.childNodes[0].tagName==null))s.style.display="none";else if(allowColMove||(isChild(event.srcElement,d)||event.srcElement==d)&&allowGroup)s.style.display="";else s.style.display="none"}var b=getScrollvp();if(b==null)b=getParent(getViewport());if(b!=null){var g=getOffsetLeft(b.offsetParent,window.document.body)-getScrollLeft(element),h=0;if(getViewportHolder()!=null){g+=getViewportHolder().offsetLeft;h=g+getViewportHolder().offsetWidth-10}else{g+=b.offsetLeft;h=g+b.offsetWidth-20}if(event.clientX>h){b.scrollLeft=b.scrollLeft+10;scrollView();UpdatePostbackData()}else{if(getViewportHolder()!=null&&getViewport2()!=null)h=g+getViewport2().offsetWidth+5;else h=g+5;if(event.clientX<h){b.scrollLeft=b.scrollLeft-10;scrollView();UpdatePostbackData()}}}return}if(sizeColumn==null&&sizeRow==null){if(anchorCell!=null){var b=getScrollvp();if(b==null)b=getParent(getViewport());if(b!=null){var r=getOffsetTop(b.offsetParent,window.document.body)-getScrollTop(element),u=0;if(getViewportHolder()!=null){r+=getViewportHolder().offsetTop;u=r+getViewportHolder().offsetHeight-10}else{r+=b.offsetTop;u=r+b.offsetHeight-10}if(event.clientY>u){b.scrollTop=b.scrollTop+10;ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}else{if(getViewportHolder()!=null&&getViewport1()!=null)u=r+getViewport1().offsetHeight+5;else u=r+5;if(event.clientY<u){var v=true,F=getSelection(),n=F.lastChild;if(n!=null){var R=parseInt(n.getAttribute("rowcount")),Q=parseInt(n.getAttribute("colcount"));v=(Q>0||element.OperationMode=="SingleSelect")&&getRowFromCell(anchorCell)>=frzRows;if(parseInt(n.getAttribute("row"))<0)v=false}if(v){if(b.scrollTop-10>=element.virtualTop)b.scrollTop=b.scrollTop-10;else b.scrollTop=element.virtualTop;ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}}}var g=getOffsetLeft(b.offsetParent,window.document.body)-getScrollLeft(element),h=0;if(getViewportHolder()!=null){g+=getViewportHolder().offsetLeft;h=g+getViewportHolder().offsetWidth-10}else{g+=b.offsetLeft;h=g+b.offsetWidth-20}if(event.clientX>h){b.scrollLeft=b.scrollLeft+10;ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}else{if(getViewportHolder()!=null&&getViewport2()!=null)h=g+getViewport2().offsetWidth+5;else h=g+5;if(event.clientX<h){var v=true,F=getSelection(),n=F.lastChild;if(n!=null){var R=parseInt(n.getAttribute("rowcount")),Q=parseInt(n.getAttribute("colcount"));v=R>0&&(isChild(anchorCell,getViewport())||isChild(anchorCell,getViewport1()));if(parseInt(n.getAttribute("col"))<0)v=false}if(v){b.scrollLeft=b.scrollLeft-10;ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}}}}var c=getCell(window.event.srcElement),S=getSpreadControl(c);if(S!=element)return;if(c!=null&&c!=leadingCell){var p=element.OperationMode;if(p!="MultiSelect"){if(!inColHeader(c)&&(p=="SingleSelect"||p=="RowMode")){var t=getRowFromCell(c);if(leadingCell==null||!((isHeaderCell(c)||isHeaderCell(leadingCell))&&t==getRowFromCell(leadingCell))){var j;if(inRowHeader(c)){if(anchorCell!=null)if(inRowHeader(anchorCell))j=-1;else j=getColFromCell(anchorCell);else j=-1;if(j==-1){var P=fpSpreadJS.getNextColumn(t,0,false,true,true);if(P==-1)j=getColFromCell(c)}}else j=getColFromCell(c);var N=fireActiveCellChangingEvent(t,j,element);if(N)return;oldAnchorCell=anchorCell;ClearSelection();updateAnchorCell(t,j,false);selectRow(t,1,true,true);if(getCellFromRowCol(selectStartRow,j)==anchorCell)leadingCellRow=selectStartRow;fireActiveCellChangedEvent(t,j,element)}}else if(!(inColHeader(c)&&p=="ExtendedSelect")&&p!="SingleSelect"&&p!="RowMode"&&!(p=="Normal"&&element.SelectionPolicy=="Single")&&!element.layoutMode){select(anchorCell,c);syncColSelection()}leadingCell=c}}}}else if(sizeColumn!=null){var w=window.event.clientX-activeX,L=parseInt(sizeColumn.width)+w,M=0,I=L>M;if(I){var D=getSizeHeader();if(D||frzRows>0||frzCols>0){var f=0;if(!xhtml)f+=parseInt(element.style.borderWidth);var i=getScrollvp();if(i==null)i=getViewport().parentElement;var A=false,a=element;while(a!=element.offsetParent.parentNode){if(a.style.position=="absolute"||a.style.position=="relative"){A=true;break}a=a.parentNode}if(a==element.offsetParent||a==element)sizeBar.style.posLeft=window.event.clientX-getOffsetLeft(i.offsetParent,window.document.body)+getScrollLeft(element)-f;else if(A)sizeBar.style.posLeft=window.event.clientX-a.offsetLeft-getOffsetLeft(i.offsetParent,window.document.body)+getScrollLeft(element)-f;else sizeBar.style.posLeft=window.event.clientX-getOffsetLeft(i.offsetParent,window.document.body)+getScrollLeft(element)-f}else{if(spreadView.Parent!=null){var q=getColHeader();if(q!=null&&q.style.width!=""&&q.style.width!="100%"){q.style.width=parseInt(q.style.width)+w+"px";q.parentNode.style.width=q.style.width}}sizeColumn.width=L;activeX=window.event.clientX;var E=getCorner();E&&E.allowTableCorner!=null&&sync3Tables(getCorner(),getFrozColHeader(),getColHeader(),false)}}}else if(sizeRow!=null){ignoreSynRowHeight=true;var w=window.event.clientY-activeY,c=getFirstNonSpanCell(sizeRow),O=c?c.offsetHeight+w:sizeRow.offsetHeight+w,M=0,I=M<O;if(I){var D=getSizeHeader();if(D||frzRows>0||frzCols>0){var f=0;if(!xhtml)f+=parseInt(element.style.borderWidth);var i=getScrollvp();if(i==null)i=getViewport().parentElement;var A=false,a=element;while(a!=element.offsetParent.parentNode){if(a.style.position=="absolute"||a.style.position=="relative"){A=true;break}a=a.parentNode}if(a==element.offsetParent||a==element)sizeBar.style.posTop=window.event.clientY-getOffsetTop(i.offsetParent,window.document.body)+getScrollTop(element)-f;else if(A)sizeBar.style.posTop=window.event.clientY-a.offsetTop-getOffsetTop(i.offsetParent,window.document.body)+getScrollTop(element)-f;else sizeBar.style.posTop=window.event.clientY-getOffsetTop(i.offsetParent,window.document.body)+getScrollTop(element)-f}else{sizeRow.style.posHeight=Math.max(10,getOffsetHeight(sizeRow)+w);if(c)c.style.height="";activeY=window.event.clientY}}}}else{activeElement=window.event.srcElement;if(activeElement==null||getSpreadControl(activeElement)!=element||spreadView==null)return;sizeColumn=null;sizeRow=null;var B=getSizeColumn(window.event.srcElement);if(B!=null){sizeColumn=B;spreadView.ChangeCursor(activeElement,getResizeCursor(false))}else{var B=getSizeRow(window.event.srcElement);if(B!=null){sizeRow=B;activeElement!=null&&activeElement.style!=null&&spreadView.ChangeCursor(activeElement,getResizeCursor(true))}else if(activeElement!=null&&activeElement.style!=null&&activeElement.tagName!="BR"){var c=getCell(activeElement);if(c!=null&&isHeaderCell(c))if(activeElement.FpSpread=="rowpadding"||activeElement.ControlType=="chgrayarea")activeElement.style.cursor=getgrayAreaCursor();else spreadView.RestoreCursor();else if(activeElement!=null&&activeElement.style!=null&&(activeElement.FpSpread=="rowpadding"||activeElement.ControlType=="chgrayarea"))activeElement.style.cursor=getgrayAreaCursor()}}}}function getgrayAreaCursor(){if(tableView!=null&&tableView.style.cursor!=null){if(tableView.style.cursor=="auto")tableView.style.cursor="default";return tableView.style.cursor}else return"default"}function getResizeCursor(a){return a?clientInformation.appVersion.indexOf("MSIE 6.0")!=-1?"row-resize":"n-resize":clientInformation.appVersion.indexOf("MSIE 6.0")!=-1?"col-resize":"w-resize"}function hitCommandBar(){var b=getCommandBar();if(window.event==null)return false;var a=window.event.srcElement;while(a!=null&&a!=this){if(a==b)return true;a=a.parentElement}return false}function hitView(){var b=getViewport(),a=window.event.srcElement;while(a!=null&&a!=this){if(a==b)return true;a=a.parentElement}return false}function openWaitMsg(){var b=window.document.getElementById(element.id+"_waitmsgcontainer");if(b==null){var e=window.document.getElementById(element.id+"_waitmsg");e.style.display="block";var i=element.offsetWidth,h=element.offsetHeight,c=Math.max(10,(i-parseInt(e.offsetWidth))/2),d=Math.max(10,(h-parseInt(e.offsetHeight))/2);if(element.currentStyle.position!="absolute"&&element.currentStyle.position!="relative"){c+=element.offsetLeft;d+=element.offsetTop;if(element.parentElement!=null){var f=0,g=0,a=element;while(a.parentElement!=null){if(a.nodeName=="TD"){f=a.offsetLeft;g=a.offsetTop}a=a.parentElement}c+=f;d+=g}}e.style.top=d;e.style.left=c}else{b.style.display="block";var d=Math.max(10,(element.offsetHeight-parseInt(b.offsetHeight))/2),c=element.clientLeft+8;if(element.currentStyle.position!="absolute"&&element.currentStyle.position!="relative"){c+=element.offsetLeft;d+=element.offsetTop;if(element.parentElement!=null){var f=0,g=0,a=element;while(a.parentElement!=null){if(a.nodeName=="TD"){f=a.offsetLeft;g=a.offsetTop}a=a.parentElement}c+=f;d+=g}}b.style.top=d;b.style.left=c;b.style.width=element.offsetWidth-element.clientLeft-8}}function closeWaitMsg(){var a=window.document.getElementById(element.id+"_waitmsgcontainer");if(a==null){var b=window.document.getElementById(element.id+"_waitmsg");if(b!=null)b.style.display="none"}else a.style.display="none"}function checkRightButton(g){if(!element.inDesign)return true;if(g.button!=2)return true;var c=getCell(g.srcElement);if(!c){var i=getCorner();return i==null||!i.contains(g.srcElement)}var f=GetSelectedRanges();if(f!=null&&f.length>0){for(var b=false,h=0;h<f.length&&!b;h++){var a=f[h];if(a.row==-1&&a.col==-1)b=false;var d=getColFromCell(c),e=getRowFromCell(c);if(d==null||e==null)b=true;if(c.parentElement.FpSpread=="ch")b=d>=a.col&&d<a.col+a.colCount&&a.row==-1;else if(c.parentElement.FpSpread=="rh")b=e>=a.row&&e<a.row+a.rowCount&&a.col==-1;else b=(a.col==-1||d>=a.col&&d<a.col+a.colCount)&&(a.row==-1||e>=a.row&&e<a.row+a.rowCount)}return b}return false}function documentMouseMove(a){if(sizeRow==null&&sizeColumn==null)return;var b=getSpreadControl(a.srcElement);b!=element&&mouseMove(a);element.captureElement!=null&&element.captureElement.setCapture()}function documentMouseUp(a){stopHandlingDocumentMouse();var b=getTopSpread(element);a.srcElement!=b&&!isChild(a.srcElement,b)&&mouseUp(a)}function endEditSpread(){var a=FpSpreadJS.getEditingSpread(getTopSpread(element));return a!=null?a.EndEdit():true}function cmdBtnClickHandler(){var a=window.event.srcElement;a._clickHandler!=null&&endEditSpread()&&a._clickHandler.apply(a,arguments)}function mouseDown(h){if(!initialized)return;if(!h)h=window.event;if(!spreadView)return;if(spreadView.__justFiltered)spreadView.__justFiltered=null;var o=spreadView.GetTopSpreadView(),f=spreadView.IsRightClick(h)&&o.ContextMenus!=null&&!element.inDesign;needCheckSelectText=false;f&&editModePermanent&&spreadView.ClearTimeoutTasks("ProcessEditMode");var E=$$.utils.getDocActiveElement();if(f&&o.ContextMenus!=null&&o.IsFilterBarTextBox(E)){setTextBoxFocus();if(!$$.utils.contains(window.document.body,h.srcElement))return $$.utils.cancelBubble(h)}if(element.__cancelActive)element.__cancelActive=null;if(spreadView.IsRightClick(h)&&element.getAttribute("mcctCellType")!=null&&spreadView.GetHostSpread().getSpreadView&&spreadView.GetHostSpread().getSpreadView().ContextMenus!=null){element.__cancelActive=true;return}if(window.fpPostOn!=null){window.event.returnValue=false;window.event.cancelBubbling=true;return}ignoreBlur=true;isactive=true;element.preventPopUp=false;element.working=false;isMouseMoving=false;mouseX=window.event.clientX;mouseY=window.event.clientY;spreadView.IsEnablejQueryTheme()&&spreadView.JQueryThemeSupporter.MouseDown(h);var a=window.event.srcElement;if(isChild(a,getCommandBar())){CBMouseDown();var s=window.event.srcElement;if(s.onclick!=null&&s.onclick!=cmdBtnClickHandler){s._clickHandler=s.onclick;s.onclick=cmdBtnClickHandler}if(endEditSpread())editing=false;else window.event.returnValue=false;spreadView!=null&&spreadView.HidePopup();return}var D=checkRightButton(window.event);if(window.event.srcElement.parentElement!=null&&window.event.srcElement.parentElement.name==element.id+"_slideBar"){if(isChild(window.event.srcElement,getPager1()))activePager=getPager1();else if(isChild(window.event.srcElement,getPager2()))activePager=getPager2();if(activePager!=null){var y=true;if(editing)y=EndEdit();else if(o.IsFilterBarTextBox(E)){var P=o.IsReadyToFilter();setTextBoxFocus();if(P)return}if(y){dragSlideBar=true;activePager.setCapture()}}spreadView!=null&&spreadView.HidePopup();return}dragCol=-1;dragViewCol=-1;if(!f&&D&&window.event.button!=1)return;if(getViewport0()==null&&getViewport()==null)return;if(element.getAttribute("OperationMode")=="ReadOnly")return;if(getSpreadControl(h.srcElement,true)!=element)return;if($$.utils.isOverScrollbar(h,getScrollvp()||getViewport().parentNode)&&isEditModeReplace(anchorCell)){var u=getEditor(anchorCell);if(u&&(u.selectionStart||u.selectionEnd))u.selectionStart=u.selectionEnd=0}var a=window.event.srcElement;if(editing&&!isHandleEvent(window.event)){if(a!=editor&&editor!=null&&!isChild(a,editor)){var J=$$.utils.isTextControl(a)&&$$.utils.isTextControl(window.document.activeElement)&&$$.utils.contains(editor,window.document.activeElement,true)&&IsInRowEditTemplate(a);typeof editor.blur!="undefined"&&editor.parentElement!=null&&!J&&editor.blur()}var d=getCell(a);if(d!=anchorCell||d==a){var U=ignoreEditorFocus;ignoreEditorFocus=true;var y=EndEdit();if(!y){(!$$.utils.isOverScrollbar(window.event)||!spreadView._IsCellHidden(anchorCell))&&editor.focus();if(f)o._ignoreMenu=true;return}ignoreEditorFocus=U}else{if(f)o._ignoreMenu=true;IsInRowEditTemplate(a)&&changeButtonsState(true);return}}if(!isChild(a,element))return false;var K=window.document.FpActiveSpread==null||window.document.FpActiveSpread!=element;if(!f){sizeColumn=getSizeColumn(a);if(sizeColumn==null)sizeRow=getSizeRow(a)}else sizeColumn=sizeRow=null;if(spreadView!=null&&!spreadView.OnSpreadMouseDown(window.event,sizeColumn!=null||sizeRow!=null))return;var b=a,x=FpSpreadJS.getTableRow(b);if(sizeColumn==null&&sizeRow==null&&(hitCommandBar()||b==getParent(getViewport())||b==getParent(getViewport1())||b==getParent(getViewport2())||b.getAttribute&&(b.getAttribute("ControlType")=="chgrayarea"||b.getAttribute("FpSpread")=="rowpadding")||x!=null&&FpSpreadJS.getTable(x)==getRowHeader()&&FpSpreadJS.isChildSpreadRow(getViewport(),x.rowIndex))){getTopSpread(window.document.FpActiveSpread)!=element&&setActiveSpread();anchorCell!=null&&element.getAttribute("EditModePermanent")=="true"&&!$$.utils.isOverScrollbar(h)&&scrollToCell(anchorCell);return}var T=window.document.FpActiveSpread,z=false;if(window.document.FpActiveSpread==null||sizeColumn==null&&sizeRow==null){setActiveSpread();z=window.document.FpActiveSpread==element&&T!=element}if(window.document.FpActiveSpread!=element&&sizeColumn==null&&sizeRow==null)return;if(!f&&D&&window.event.button!=1)return;if(working)return;if(isChild(a,getGroupBar()))if(!f){var F=parseInt(a.id.replace(element.id+"_group",""));if(!isNaN(F)){initMovingCol(F,true,a);working=true;h.returnValue=false;window.event.cancelBubbling=true;element.setCapture();element.dragFromGroupbar=true;return}}else return;if(sizeColumn!=null){getTopSpread(element).resizing=true;working=true;activeX=activeY=window.event.clientX;if(sizeColumn.style!=null)sizeColumn.style.cursor=getResizeCursor(false);b=a;b.setCapture();element.captureElement=b;var B=getSizeHeader();if(B||frzRows>0||frzCols>0){var e=getScrollvp();if(e==null)e=getViewport().parentElement;var q=false,d=element;while(d!=element.offsetParent.parentNode){if(d.style.position=="absolute"||d.style.position=="relative"||d.style.position=="fixed"){q=true;break}d=d.parentNode}if(q||engine<8)sizeBar.style.posTop=element.offsetTop;else{var L=getColHeader()!=null?getColHeader().offsetHeight:0;sizeBar.style.posTop=element.offsetParent.offsetTop+getOffsetTop(e.parentNode,element.offsetParent)-L}var n=0;if(!xhtml)n+=parseInt(element.style.borderWidth);if(d==element.offsetParent||d==element)sizeBar.style.posLeft=activeX-getOffsetLeft(e.offsetParent,window.document.body)+getScrollLeft(element)-n;else if(q)sizeBar.style.posLeft=activeX-d.offsetLeft-getOffsetLeft(e.offsetParent,window.document.body)+getScrollLeft(element)-n;else sizeBar.style.posLeft=activeX-getOffsetLeft(e.offsetParent,window.document.body)+getScrollLeft(element)-n;if(getColHeader()!=null)sizeBar.style.height=getColHeader().offsetHeight+e.clientHeight;else sizeBar.style.height=e.offsetHeight;sizeBar.style.width=2}if(spreadView.Parent!=null&&!$$.browser.quirksMode){var p=getColHeader();if(p!=null){p=p.parentNode;if(p.__bkHeaderStyle==null){p.__bkHeaderStyle={overflow:p.style.overflow};p.style.overflow="hidden"}}}}else if(sizeRow!=null){getTopSpread(element).resizing=true;working=true;activeX=activeY=window.event.clientY;b=a;b.setCapture();element.captureElement=b;startHandlingDocumentMouse(true);element.working=true;var B=getSizeHeader();if(B||frzRows>0||frzCols>0){var e=getScrollvp();if(e==null)e=getViewport().parentElement;if(getRowHeader()!=null)sizeBar.style.width=getRowHeader().offsetWidth+e.clientWidth+parseInt(getViewport().cellSpacing);else sizeBar.style.width=e.clientWidth+parseInt(getViewport().cellSpacing);var q=false,d=element;while(d!=element.offsetParent.parentNode){if(d.style.position=="absolute"||d.style.position=="relative"||d.style.position=="fixed"){q=true;break}d=d.parentNode}if(q||engine<8)sizeBar.style.posLeft=element.offsetLeft;else{var O=getRowHeader()!=null?parseInt(getRowHeader().cellSpacing)-getRowHeader().offsetWidth:0;sizeBar.style.posLeft=element.offsetParent.offsetLeft+getOffsetLeft(e.parentNode,element.offsetParent)+O}sizeBar.style.height=2;var n=0;if(!xhtml)n+=parseInt(element.style.borderWidth);if(d==element.offsetParent||d==element)sizeBar.style.posTop=activeY-getOffsetTop(e.offsetParent,window.document.body)+getScrollTop(element)-n;else if(q)sizeBar.style.posTop=activeY-d.offsetTop-getOffsetTop(e.offsetParent,window.document.body)+getScrollTop(element)-n;else sizeBar.style.posTop=activeY-getOffsetTop(e.offsetParent,window.document.body)+getScrollTop(element)-n}}else{var c=getCell(a);if(c==null){var C=getCorner();if(C!=null&&C.contains(a)){var r=$$(a).getParent("TR");while(r!=null&&r.getAttribute("FpSpread")==null)r=$$(r).getParent("TR");if(r==null||r.getAttribute("FpSpread")!="fb")if(operationMode=="Normal"){anchorCell==null&&focus();if(anchorCell!=null)saveAnchorCell(anchorCell);else{setActiveRow(-1);setActiveCol(-1)}oldAnchorCell=anchorCell;selectTable(true);if(anchorCell){leadingCellRow=getRowFromCell(anchorCell);leadingCellCol=getColFromCell(anchorCell)}}else ClearSelection(null,element);doGetFocus()}return}var A=!f||!retainSelectionBlock&&z||!spreadView.InSelection(c),i=getColFromCell(c);if(c.parentElement.FpSpread=="ch"&&(i>=GetColCount()||c.getAttribute("col")=="-1")){doGetFocus();return}if(c.parentNode.getAttribute("FpSpread")=="rh"&&FpSpreadJS.isChildSpreadRow(getViewport(),c.parentNode.rowIndex)){ClearSelection(null,element);return}var R=c.canFocus=="false";if(R)return;if(c.parentElement.FpSpread=="ch"&&element.OperationMode!="Normal"){if(allowColMove||allowGroup){if(element.layoutMode)i=parseInt(c.col);initMovingCol(i)}working=true;b=a;b.tagName!="INPUT"&&b.tagName!="TEXTAREA"&&b.tagName!="SELECT"&&b.tagName!="BUTTON"&&b.setCapture();h.returnValue=false;return}if(c.parentElement.FpSpread=="ch"&&(element.OperationMode=="RowMode"||element.OperationMode=="SingleSelect"||element.OperationMode=="ExtendedSelect")){if(!allowColMove&&!allowGroup)return}else if(A){var S=fireActiveCellChangingEvent(getRowFromCell(c),i,element,c.parentElement.row);if(S)return;var v=getTopSpread(element);if(v!=element)if(v.Behavior.fireActiveCellChangingEvent(getRowFromCell(c),i,element,c.parentElement.row))return;var g=element.OperationMode;if(!window.event.ctrlKey||element.multiRange!="true"||f){if(g!="MultiSelect"&&!(window.event.shiftKey&&g=="ExtendedSelect"&&element.layoutMode==null)||f)if(!((allowColMove||allowGroup)&&c.parentElement.FpSpread=="ch"&&g=="Normal"&&(element.SelectionPolicy=="Range"||element.SelectionPolicy=="MultiRange")&&selectedCols.length!=0&&isColSelected(i))){var w=!isChild(c,getFrozRowHeader())&&!isChild(c,getRowHeader())||(selectionBlockOptions&SelectionBlockOptions.Rows)!=0&&operationMode!="ReadOnly";w=w&&(!isChild(c,getFrozColHeader())&&!isChild(c,getColHeader())||(selectionBlockOptions&SelectionBlockOptions.Columns)!=0&&operationMode=="Normal");if(w)ClearSelection();else return}}else if(g!="ExtendedSelect"&&g!="MultiSelect")if(anchorCell!=null){fpSpreadJS.updateSelectionRangeFromCell(anchorCell);fpSpreadJS.keepGeneratedSelectionFromAnchorCell();paintSelectedCell(anchorCell,true);updateSelectionsBackColor(getRowFromCell(c),getColFromCell(c))}}if(A){var t=anchorCell;anchorCell=c;if(t)oldAnchorCell=t;scrollToCell(anchorCell);var g=operationMode,j=c.parentElement.FpSpread,N=j=="rh",M=j=="ch";if(j=="r"||j=="ch"||j=="rh"){saveAnchorCell(c);if(j=="ch")leadingCellRow=0;else if(j=="rh")leadingCellCol=0}if(anchorCell.parentElement.FpSpread=="r"){if(window.event.shiftKey&&g=="ExtendedSelect"&&element.layoutMode==null&&!f){var m=getExtendedSelectRows(t,leadingCell,anchorCell);ClearSelection();m!=null&&m.length>0&&selectRow(m[0],m[1],true,true)}else if(g=="ExtendedSelect"||g=="MultiSelect")if(isRowSelected(getRowFromCell(anchorCell)))selectRow(getRowFromCell(anchorCell),1,false,true);else selectRow(getRowFromCell(anchorCell),1,true,true);else if(g=="RowMode"||g=="SingleSelect")selectRow(getRowFromCell(anchorCell),1,true,true);else{var l=getEditor(anchorCell),Q=isEditModeReplace(anchorCell)&&l!=null&&$$.utils.isTextControl(a)&&a==l&&$$.utils.getDocActiveElement()==l;selectRange(getRowFromCell(anchorCell),i,1,1,true,Q)}selectStartRow=getRowFromCell(anchorCell);selectStartCol=i}else if(anchorCell.parentElement.FpSpread=="ch")if(allowColMove||allowGroup){var k=i;if(g=="Normal"&&(element.SelectionPolicy=="Range"||element.SelectionPolicy=="MultiRange"))if(isColSelected(k)){adjustAnchorCell(k);paintAnchorCell();initMovingCol(k)}else selectColumn(k,1,true);else{if(element.layoutMode)k=parseInt(anchorCell.col);if(operationMode=="Normal"||operationMode=="ReadOnly")selectColumn(k,1,true);else selectedCols.push(k);initMovingCol(k)}}else if(operationMode=="Normal"){var k=i;if(element.layoutMode)k=parseInt(anchorCell.col);selectColumn(k,1,true)}else return;else if(anchorCell.parentElement.FpSpread=="rh")if(window.event.shiftKey&&g=="ExtendedSelect"&&element.layoutMode==null){var m=getExtendedSelectRows(t,leadingCell,anchorCell);ClearSelection();m!=null&&m.length>0&&selectRow(m[0],m[1],true,true)}else if(g=="ExtendedSelect"||g=="MultiSelect")if(isRowSelected(getRowFromCell(anchorCell)))selectRow(getRowFromCell(anchorCell),1,false,true);else selectRow(getRowFromCell(anchorCell),1,true,true);else selectRow(getRowFromCell(anchorCell),1,true);if((K||anchorCell!=t)&&anchorCell!=null){var H=GetSheetIndex(getRowFromCell(anchorCell)),G=i,I=parseInt(anchorCell.parentElement.row);if(a.tagName=="SELECT")ignorePostbackEditmode=true;fireActiveCellChangedEvent(H,G,element,I);var v=getTopSpread(element);v!=element&&v.Behavior.fireActiveCellChangedEvent(H,G,element,I);if(a.tagName=="SELECT")ignorePostbackEditmode=false}if(isChild(anchorCell,element)){leadingCell=anchorCell;if(anchorCell!=null){j=anchorCell.parentElement.FpSpread;if(j=="rh"||j=="r")leadingCellRow=getRowFromCell(anchorCell);if(anchorCell==c)leadingCellCol=i;else if(j=="ch"||j=="r")leadingCellCol=getColFromCell(anchorCell);if(N&&getCellFromRowCol(selectStartRow,leadingCellCol)==anchorCell)leadingCellRow=selectStartRow;if(M&&getCellFromRowCol(leadingCellRow,selectStartCol)==anchorCell)leadingCellCol=selectStartCol}}}b=a;if(b.tagName!="INPUT"&&b.tagName!="TEXTAREA"&&b.tagName!="SELECT"&&b.tagName!="BUTTON"){b.setCapture();element.captureElement=b}working=!spreadView.IsControl(b)}enableButtons();if(working)h.returnValue=false;if(engine==8){ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=false}if(!editing&&sizeRow==null&&sizeColumn==null){if(anchorCell!=null&&anchorCell.getAttribute("RowEditTemplate")!="true"&&isChild(anchorCell,element)&&!isHeaderCell(getCell(a))&&!f)if(!f||spreadView.IsControl(a)){var l=getEditor(anchorCell);if(l!=null){if(a==anchorCell)element.preventPopUp=true;setEditorFocus(l);editing=l.type!="button"&&l.type!="submit";editor=l;renderAsEditor=1;editingValue=getEditorValue(l)}}if(!editing&&enableRowEditTemplate=="true"&&operationMode=="RowMode"&&element.getAttribute("layoutMode")==null)editing=IsInRowEditTemplate(window.event.srcElement)}}function getMovingCol(){if(movingCol!=null)return movingCol;var a=window.document.createElement("<div>");movingCol=a;a.style.position="absolute";a.style.top=0;a.style.left=20;a.id=element.id+"movingCol";a.align="center";element.insertBefore(a);a.style.display="none";if(element.DragColumnCssClass!=null)a.className=element.DragColumnCssClass;else a.style.border="1px solid black";a.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=50)";return a}function isControl(a){return a!=null&&(a.tagName=="INPUT"||a.tagName=="TEXTAREA"||a.tagName=="SELECT")}function changeButtonsState(b){var a=getCmdBtn("Update");a!=null&&a.disabled&&updateCmdBtnState(a,!b);a=getCmdBtn("Cancel");a!=null&&a.disabled&&updateCmdBtnState(a,!b)}function enableButtons(){var f=getCellType(anchorCell),e=getSelection(),b=e.lastChild,c=operationMode=="ReadOnly"||operationMode=="SingleSelect"||f=="readonly";if(!c)c=anyReadOnlyCell(b);if(c){var a=getCmdBtn("Copy");updateCmdBtnState(a,b==null);var d=getClipboardData();a=getCmdBtn("Paste");updateCmdBtnState(a,b==null||d==null);a=getCmdBtn("Clear");updateCmdBtnState(a,true)}else{var a=getCmdBtn("Copy");updateCmdBtnState(a,b==null);var d=getClipboardData();a=getCmdBtn("Paste");updateCmdBtnState(a,b==null||d==null);a=getCmdBtn("Clear");updateCmdBtnState(a,b==null)}}function getCmdButtonState(a){return a==null||a.disabled||/true/i.test(a.getAttribute("disabled"))||a.tagName=="IMG"&&new RegExp(a.getAttribute("disabledImg")+"$","i").test(a.src)?false:true}function updateCmdBtnState(a,b){if(typeof a=="string")a=getCmdBtn(a);if(a==null)return;var c=a.disabled;if(c==b)return;a.disabled=b;if(a.tagName=="IMG")if(b&&typeof a.disabledImg!="undefined"){if(a.src.indexOf(a.disabledImg)<0)a.src=a.disabledImg}else if(a.src.indexOf(a.enabledImg)<0)a.src=a.enabledImg}function getExtendedSelectRows(h,e,g){var a=[],d=e!=null?getRowFromCell(e):getRowFromCell(h),b=getRowFromCell(g),f=getSelection();if(f==null){a.push(null);a.push(1)}else{var c=getSelectRowNode(f,d);if(c!=null)if(b<c.startRow){a.push(b);if(d==c.startRow)a.push(c.endRow-b+1);else a.push(c.startRow-b+1)}else if(c.startRow<=b&&b<=c.endRow)if(b>=d){a.push(b);a.push(c.endRow-b+1)}else{a.push(c.startRow);a.push(b-c.startRow+1)}else if(d==c.startRow){a.push(c.endRow);a.push(b-c.endRow+1)}else{a.push(c.startRow);a.push(b-c.startRow+1)}else if(d<b){a.push(d+1);a.push(b-d-1)}else{a.push(b);a.push(Math.max(1,d-b))}}return a}function getSelectRowNode(f,d){var b=null,a=f.firstChild;while(a!=null){var g=parseInt(a.getAttribute("colIndex"));if(g==-1){var c=parseInt(a.getAttribute("rowIndex")),e=parseInt(a.getAttribute("rowcount"));if(c<=d&&d<c+e){b={};b.startRow=c;b.endRow=c+e-1;break}}a=a.nextSibling}return b}function mouseUp(){if(!initialized)return;if(!spreadView)return;var a=window.document;if(a.PreviousActiveSpread!=null&&a.PreviousActiveSpread!=a.FpActiveSpread){a.PreviousActiveSpread.getSpreadView().OnSpreadLostActive();a.PreviousActiveSpread=null}if(a.FpActiveSpread==null||element.getAttribute("mcctCellType")==null&&getTopSpread(a.FpActiveSpread)!=getTopSpread(element))return;stopHandlingDocumentMouse();spreadView.IsEnablejQueryTheme()&&spreadView.JQueryThemeSupporter.MouseUp(event);if(spreadView!=null&&!spreadView.OnSpreadMouseUp(window.event))return;if(spreadView.IsRightClick(event)&&element.getAttribute("mcctCellType")!=null&&spreadView.GetHostSpread().getSpreadView&&spreadView.GetHostSpread().getSpreadView().ContextMenus!=null)return;var b=working&&(sizeColumn!=null||sizeRow!=null)&&spreadView.IsFilterBarTextBox($$.utils.getDocActiveElement());b&&spreadView.SuspendSpreadFocus();mouseUpInternal();element.captureElement=null;try{!editModePermanent&&!fpSpreadJS.isOutOfView(anchorCell)&&!spreadView.IsRightClick(event||window.event)&&fpSpreadJS.correctFocusOnActiveCell(anchorCell)}catch(c){}b&&spreadView.ResumeSpreadFocus();if(needCheckSelectText&&isEditModeReplace(anchorCell)){selectAllText(editor,true);needCheckSelectText=false}}function mouseUpInternal(){var K=spreadView.GetTopSpreadView(),W=spreadView.IsRightClick(window.event)&&K.ContextMenus!=null&&!element.inDesign;if(window.fpPostOn!=null||isExtenderPopupControl(window.event.srcElement)){window.event.returnValue=false;window.event.cancelBubbling=true;return}ignoreSynRowHeight=false;if(isChild(window.event.srcElement,getCommandBar())){CBMouseUp();focus();if(!working){ignoreBlur=false;return}}if(editing){var n=getCell(window.event.srcElement),w=getCellType(n);if(n!=null)if(w!="ExtenderCellType"){var E=getEditor(n);if(E!=null&&renderAsEditor==1)if(w==$$.CellTypes.CHECKBOX||w==$$.CellTypes.RADIO_BUTTON_LIST){var Z=getEditorValue(E);editingValue=Z;changeButtonsState(true)}}else if(editor!=null&&editor.Extenders=="SliderExtender"){window.document.releaseCapture();return}}if(dragSlideBar){dragSlideBar=false;if(activePager!=null){activePager.releaseCapture();window.document.focus();textBox!=null&&setTextBoxFocus();var nb=moveSlideBar(window.event)-1;activePager=null;GotoPage(nb)}ignoreBlur=false;return}if(getViewport0()==null&&getViewport()==null)return;if(element.OperationMode=="ReadOnly")return;var q=true;if(working){if(dragCol>=0){if(element.dragFromGroupbar)if(event.srcElement==getGroupBar()||isChild(event.srcElement,getGroupBar()))if(element.targetCol>0)Regroup(dragCol,parseInt((element.targetCol+1)/2));else Regroup(dragCol,element.targetCol);else Ungroup(dragCol,element.targetCol);else if(event.srcElement==getGroupBar()||isChild(event.srcElement,getGroupBar())){if(allowGroup)if(element.targetCol>0)Group(dragCol,parseInt((element.targetCol+1)/2));else Group(dragCol,element.targetCol)}else if(allowColMove)if(element.targetCol!=null){var lb=fireColumnDragMove(selectedCols);if(!lb.cancel){var gb=dragViewCol,S=operationMode!="Normal"?fpSpreadJS.buildTargetColsMoved(selectedCols,gb,element.targetCol):null;MoveCol(dragCol,element.targetCol);var V=operationMode!="Normal"?S:selectedCols;fireColumnDragMoveCompleted(V)}}var N=getMovingCol();if(N!=null)N.style.display="none";var O=getPosIndicator();if(O!=null)O.style.display="none";dragCol=-1;dragViewCol=-1;element.dragFromGroupbar=false;element.targetCol=null}if(sizeColumn!=null){if(spreadView.Parent!=null){var j=getColHeader();if(j!=null){j=j.parentNode;if(j.__bkHeaderStyle!=null){j.style.overflow=j.__bkHeaderStyle.overflow;try{delete j.__bkHeaderStyle}catch(lb){j.__bkHeaderStyle=null}}}}var T=getViewport().parentNode.scrollTop;window.document.releaseCapture();q=false;var k=window.event.clientX-activeX,eb=window.event.clientX-activeY,f=parseInt(sizeColumn.width),H=f-eb+k;f+=k;if(f<1)f=1;if(xhtml&&f<20&&isChild(sizeColumn,getRowHeader()))f=20;if(activeY!=window.event.clientX){var m=isChild(sizeColumn,getRowHeader())||isChild(sizeColumn,getFrozRowHeader());if(m)setRowHeaderColWidth(sizeColumn.index,f);else{if(spreadView.Parent!=null&&getColFooter()!=null&&getColHeader().style.width!=""){getColFooter().style.width=getColHeader().style.width;getColFooter().parentNode.style.width=getColHeader().style.width}setColWidth(sizeColumn.index,f,H);var R=getTopSpread();if(R!=element)for(var D=R.getElementsByTagName("COL"),a=0;a<D.length;a++){var Q=D[a];if(Q.NAME==sizeColumn.NAME){var A=getSpreadControl(Q);if(A!=element){A.setColWidth(sizeColumn.index,f,H);$$.browser.quirksMode&&autoFitTextBoxEditors(A)}}}$$.browser.quirksMode&&autoFitTextBoxEditors(element);$$.browser.quirksMode&&!m&&spreadView.RelayoutFilterBarWithResize(sizeColumn)}fireColWidthChangedEvent(m,sizeColumn.index,Math.max(f,sizeColumn.offsetWidth))}if(sizeBar!=null)sizeBar.style.left=-400;EnsureAllRowHeights();if(smartPaint){startTime=null;stopScroll()}if(spreadView.AllowVirtualScrollPaging){sizeSpread(true);spreadView._MakeSureScrollableTo(T,true,true)&&sizeSpread(true)}scrollView();if(window.document.FpActiveSpread==null||window.document.FpActiveSpread==element){anchorCell==null&&focus();paintSelections(true);paintAnchorCell();paintFocusRect()}}else if(sizeRow!=null){window.document.releaseCapture();var T=getViewport().parentNode.scrollTop;q=false;var k=window.event.clientY-activeY,eb=window.event.clientY-activeX,b=Math.max(sizeRow.style.posHeight,getOffsetHeight(sizeRow))+k;if(isNaN(b)&&sizeRow.previewRow=="true")b=sizeRow.offsetHeight;if(b<1){b=1;k=1-sizeRow.style.posHeight}if(xhtml&&b<10){b=10;k=10-sizeRow.style.posHeight}var l=getFirstNonSpanCell(sizeRow);if(k!=0){var I=b;if(sizeRow.cells.length>0){var h=getFirstNonSpanCell(sizeRow);if(h){h.style.posHeight=b;if(h.offsetHeight>h.style.posHeight){var jb=parseInt(h.currentStyle.paddingTop.replace("px","")),ib=parseInt(h.currentStyle.paddingBottom.replace("px","")),mb=b-(jb+ib);h.style.posHeight=Math.max(mb,0);I=h.style.posHeight}}}sizeRow.style.posHeight=I}sizeRow.style.cursor="auto";if(activeX!=window.event.clientY){var m=isChild(sizeRow,getColHeader())||isChild(sizeRow,getFrozColHeader());if(m){var e=getCorner();if(e!=null&&e.allowTableCorner&&e.rows(sizeRow.rowIndex).style.height!=""){e.parentNode.style.posHeight+=b-getOffsetHeight(e.rows(sizeRow.rowIndex));e.rows(sizeRow.rowIndex).style.posHeight=b;if(e.rows(sizeRow.rowIndex).cells.length>0)e.rows(sizeRow.rowIndex).cells[0].style.height=""}setColHeaderRowHeight(sizeRow.rowIndex,sizeRow.style.posHeight)}else{var c=null;if(isChild(sizeRow,getFrozRowHeader()))c=getViewport1();else{c=getViewport();spreadView._SetVirtualPagingBottomHeights(1e3,true)}if(sizeRow.rowIndex<c.rows.length){if(b<1)b=1;if(xhtml&&b<10)b=10;var B=c.rows[sizeRow.rowIndex],u=getMaxRowSpanInRow(B);if(u>1){for(var M=[],a=0;a<u;a++)if(sizeRow.rowIndex+a<c.rows.length)M[a]=getOffsetHeight(c.rows(sizeRow.rowIndex+a));for(var a=0;a<u;a++)if(sizeRow.rowIndex+a<c.rows.length)c.rows(sizeRow.rowIndex+a).style.posHeight=M[a]}B.style.posHeight=b;var g=getFirstNonSpanCell(B);if(g!=null){g.style.posHeight=b;if(g.offsetHeight>b){var hb=g.style.posHeight-(g.offsetHeight-b);g.style.posHeight=Math.max(hb,0)}var F=g.vAlign;g.vAlign="";g.vAlign=F}if(l&&xhtml){var F=l.currentStyle!=null?l.currentStyle.verticalAlign:l.vAlign;l.vAlign="";l.vAlign=F}}var G=isChild(sizeRow,getFrozRowHeader()),y=getViewport2();if(G)y=getViewport0();if(y!=null){var z=y.rows(sizeRow.rowIndex);if(z!=null){var n=getFirstNonSpanCell(z);if(n!=null)n.style.height="";z.style.posHeight=b}}if(isChild(sizeRow,getFrozRowHeader())&&engine<8)getFrozRowHeader().parentElement.parentElement.parentElement.style.posHeight+=k;var J=addRowInfo(sizeRow.FpKey);if(J!=null){b=sizeRow.style.posHeight;if(engine<8&&xhtml&&sizeRow.rowIndex==0)b-=1;setRowHeight(J,b)}}fireRowHeightChanged(m,m?sizeRow.rowIndex:getRowFromCell(sizeRow.cells[0]),Math.max(sizeRow.style.posHeight,sizeRow.offsetHeight))}var L=getParentSpread();L!=null&&L.UpdateRowHeight(element);if(smartPaint){var Y=newPageCount;newPageCount=getRowsPerPage(newTop);Y!=newPageCount&&doUpdate()}EnsureAllRowHeights();if(frzCols>0){var C=checkIntersectWithSpan(G?sizeRow.rowIndex:sizeRow.rowIndex+frzRows);C&&layoutRange(C)}if(spreadView.AllowVirtualScrollPaging){var P=getRowHeader();sizeSpread(true);var fb=spreadView._GetTopRowIndex(),v=spreadView._GetScrollTopFromRow(fb),s=false;if(isChild(sizeRow,P)){var bb=spreadView._IsCellHidden(sizeRow,false,P);if(bb){var kb=getViewport(),ob=element.virtualTop+sizeRow.offsetTop+sizeRow.offsetHeight-kb.parentNode.clientHeight,X=Math.max(element.virtualTop,ob);s=spreadView._MakeSureScrollableTo(v,X,true)}else s=spreadView._MakeSureScrollableTo(v,null,true)}else s=spreadView._MakeSureScrollableTo(v,null,true);!s&&spreadView._SetVirtualPagingBottomHeights(0,true)}sizeSpread();EnsureAllRowHeights();if(smartPaint){startTime=null;stopScroll()}if(window.document.FpActiveSpread==null||window.document.FpActiveSpread==element){anchorCell==null&&focus();paintSelections(true);paintAnchorCell();paintFocusRect()}window.event.returnValue=false;if(sizeBar!=null)sizeBar.style.top=-400}activeElement=element.captureElement||window.event.srcElement;if(activeElement!=null){if(activeElement.tagName!="INPUT"&&activeElement.tagName!="TEXTAREA"&&activeElement.tagName!="SELECT"&&activeElement.tagName!="BUTTON"){window.document.releaseCapture();if(editor==null)if(!spreadView.IsMultiColumnComboBox){window.document.activeElement!=null&&window.document.activeElement.tagName!="HTML"&&window.document.focus();if(textBox!=null){textBox.onactivate=null;element.onactivate=null;setTextBoxFocus();textBox.onactivate=textBoxActive;element.onactivate=spreadActive}}!q&&spreadView.GetAttribute("error")=="true"&&spreadView.document.getElementById(element.id+"_RowEditTemplateContainer")!=null&&spreadView._LoadOnDemandTimerId==-1&&!rowEditTemplateContainer_textBoxFocusing&&spreadView._StartLoadOnDemandTimer()}else spreadView.IsInFilterBar(activeElement,true)&&window.document.releaseCapture();activeElement=null}working=false;getTopSpread(element).resizing=false}if(q&&hitCommandBar()){ignorePaintSelection=true;doGetFocus({AllowHiddenCell:true});ignorePaintSelection=false;return}var r=false;if(frzRows==0&&frzCols==0){var ab=getSelection(),o=ab.firstChild,d=new Range;if(o!=null){d.row=parseInt(o.getAttribute("rowIndex"));d.col=parseInt(o.getAttribute("colIndex"));d.rowCount=parseInt(o.getAttribute("rowcount"));d.colCount=parseInt(o.getAttribute("colcount"))}switch(selectType){case"":if(d.row>=0)for(var t=getViewport().rows,a=d.row;a<d.row+d.rowCount&&a<t.length;a++)if(t(a).cells.length>0&&t(a).cells(0).children.length>0)if(t(a).cells(0).children(0).FpSpread=="Spread"){r=true;break}break;case"c":for(var c=getViewport(),a=0;a<c.rows.length;a++)if(IsChildSpreadRow(c,a)){r=true;break}break;case"r":for(var c=getViewport(),db=d.rowCount,a=d.row;a<d.row+db&&a<c.rows.length;a++)if(IsChildSpreadRow(c,a)){r=true;break}}}if(r){var p=getCmdBtn("Copy");updateCmdBtnState(p,true);p=getCmdBtn("Paste");updateCmdBtnState(p,true);p=getCmdBtn("Clear");updateCmdBtnState(p,true)}if(!IsInRowEditTemplate(window.event.srcElement)){if(window.event.srcElement.tagName=="SELECT")ignorePostbackEditmode=true;var i=getCell(window.event.srcElement);if(i==null&&!GrapeCity.Web.Spread.FilterEditor.IsFilterControl(window.event.srcElement)){if(!spreadView.IsMultiColumnComboBox){var cb=getViewportHolder();if(isChild(window.event.srcElement,cb)&&getTopSpread(window.document.FpActiveSpread)==element){ignorePaintSelection=true;doGetFocus();ignorePaintSelection=false;return}if(window.event.srcElement==getParent(getViewport())&&getTopSpread(window.document.FpActiveSpread)==element){ignorePaintSelection=true;doGetFocus({AllowHiddenCell:true});ignorePaintSelection=false;return}var e=getCorner();if(e==null||!e.contains(window.event.srcElement)){ignorePaintSelection=true;doGetFocus({AllowHiddenCell:getColHeader()!=null&&$$.utils.contains(getColHeader(),window.event.srcElement)||getRowHeader()!=null&&$$.utils.contains(getRowHeader(),window.event.srcElement)});ignorePaintSelection=false;return}}}else if(i!=null&&ignorePostbackEditmode&&(isChild(i,getFrozColHeader())||isChild(i,getColHeader()))){ignorePostbackEditmode=false;return}if(editModePermanent&&(K.ContextMenus==null||!editing||editor!=window.event.srcElement))if(i!=null)i.canFocus!="false"&&doGetFocus();else doGetFocus();if(q){if(!spreadView.IsMultiColumnComboBox){var U=window.event!=null&&(window.event.srcElement.tagName=="INPUT"&&window.event.srcElement.type=="text"||window.event.srcElement.tagName=="TEXTAREA")&&window.event.type=="mouseup";focus(window.event,false,W&&!spreadView.IsControl(window.event.srcElement)?{FocusEditor:false,SelectText:false}:U?{SelectText:false}:null)}if(window.document.FpActiveSpread==element&&i!=null&&i.parentElement.getAttribute("FpSpread")=="ch"&&(operationMode=="RowMode"||operationMode=="SingleSelect"||operationMode=="MultiSelect"||operationMode=="ExtendedSelect"))if(anchorCell!=null){paintSelections(true);paintAnchorCell()}}if(window.event.srcElement.tagName=="SELECT")ignorePostbackEditmode=false}UpdatePostbackData();var x=getEditor(anchorCell);x!=null&&window.event.srcElement.type=="radio"&&setTimeout(setRadioBtnFocus,0);x!=null&&isChild(window.event.srcElement,x)&&window.event.srcElement.type=="button"&&window.event.srcElement.focus();setTimeout(resetBlurFlag,0)}function IsInRowEditTemplate(a){while(a&&a.parentNode){a=a.parentNode;if(a.tagName=="DIV"&&a.id==element.id+"_RowEditTemplateContainer")return true}return false}function processEditMode(){if(window.document!=null&&window.document.documentElement!=null&&window.document.activeElement!=null){var b=GrapeCity.Web.Spread.FilterEditor.GetEditor(window.document.activeElement);if(b!=null&&b.Behavior.Spread.getSpreadView().GetSpreadContext().getTopSpread()==getTopSpread())return}var a=spreadView.GetTopSpreadView().ActiveContextMenu;if(a!=null&&a.IsShowing())return;try{if(window.document.FpActiveSheetView!=element)return}catch(c){return}ignoreBlur=true;editModePermanent&&StartEdit(anchorCell);focus();setTimeout(resetBlurFlag,0)}function doGetFocus(args){if(!spreadView.OnSetTextBoxFocus())return;var ts=getTopSpread(element),spreadData=eval(ts.id+"_XMLDATA"),activeChild=spreadData.documentElement.selectSingleNode("/root/activechild");if(activeChild!=null&&activeChild.text!=""){var activeSpread=window.document.getElementById(activeChild.text);if(activeSpread!=null&&activeSpread!=element){if(activeSpread.initialized){activeSpread.setActiveField(true);activeSpread.doGetFocus(args)}else activeSpread.__pendingDoGetFocus=true;return}}window.document.FpActiveSpread!=element&&setActiveSpreadManually(element);if(activeChartObj!=null)return;var ignoreFoucus=anchorCell&&anchorCell.CellType2=="AjaxComboBoxCellType"&&anchorCell.getElementsByTagName("INPUT").length>0,ignoreEdit=args==null||!args.AllowHiddenCell?spreadView._IsCellHidden(anchorCell):false;if((!editModePermanent||ignoreEdit)&&textBox!=null&&!ignoreFoucus){focus2();window.document.activeElement!=textBox&&focus2()}if(!args||!args.IgnoreFindActiveCell){var opm=operationMode;!GCWS.FilterEditor.IsFilterControl(window.document.activeElement)&&anchorCell==null&&opm!="MultiSelect"&&opm!="ExtendedSelect"&&GetRowCount()>0&&GetColCount()>0&&setAnchorCellForFirstTime(window.event)}paintAnchorCell();paintSelections(true);isactive=true;if(editModePermanent&&!ignorePostbackEditmode&&!ignoreEdit)spreadView.RegisterTimeoutTask(processEditMode,200,"ProcessEditMode");else setTimeout(resetBlurFlag,0)}function resetBlurFlag(){var e=getRowHeader(),f=getViewport(),d=getViewport2(),b=e!=null&&e.parentNode!=null?e.parentNode.scrollTop:-1,c=f!=null&&f.parentNode!=null?f.parentNode.scrollTop:-1,a=d!=null&&d.parentNode!=null?d.parentNode.scrollTop:-1;if(b!=-1&&c!=-1&&b!=c||b!=-1&&a!=-1&&b!=a||a!=-1&&c!=-1&&a!=c){var g=ignoreVirtualPaging;ignoreVirtualPaging=true;scrollView();ignoreVirtualPaging=g}ignoreBlur=false}function setRadioBtnFocus(){var a=getEditor(anchorCell);a!=null&&setEditorFocus(a)}function SynRowHeight(){}function UpdateRowHeight(a){var b=a.parentElement;while(b!=null){if(b.tagName=="TR")break;b=b.parentElement}if(b!=null){var c=b.rowIndex;if(getRowHeader()!=null&&c<getRowHeader().rows.length)if(xhtml){b.style.height=a.offsetHeight;getRowHeader().rows(c).style.posHeight=a.offsetHeight-1;getRowHeader().rows(c).cells(0).style.posHeight=a.offsetHeight-1;a.parentNode.style.posHeight=a.offsetHeight-1}else{getRowHeader().rows(c).style.posHeight=a.offsetHeight+1;getRowHeader().rows(c).cells(0).style.posHeight=a.offsetHeight+1}}var d=getParentSpread();d!=null&&d.UpdateRowHeight(element)}function stopHandlingDocumentMouse(){var a=window,b=0;do{var c=a.document;window.document.detachEvent("onmousemove",documentMouseMove,false);window.document.detachEvent("onmouseup",documentMouseUp,false);if(b<$$.browser.getAccessParentLevel()&&a.parent!=null&&a!=a.parent){a=a.parent;b+=1}else break}while(true)}function startHandlingDocumentMouse(b){var a=window,c=0;do{var d=a.document;window.document.detachEvent("onmousemove",documentMouseMove,b);window.document.attachEvent("onmousemove",documentMouseMove,b);window.document.detachEvent("onmouseup",documentMouseUp,b);window.document.attachEvent("onmouseup",documentMouseUp,b);if(c<$$.browser.getAccessParentLevel()&&a.parent!=null&&a!=a.parent){a=a.parent;c+=1}else break}while(true)}function mouseOut(){spreadView&&spreadView.IsEnablejQueryTheme()&&spreadView.JQueryThemeSupporter.MouseOut(event);var a=window.event.srcElement;if(isChild(a,getCommandBar())||isChild(a,getPager1())||isChild(a,getPager2())){CBMouseOut();return}if(!working&&sizeColumn!=null&&sizeColumn.style!=null)sizeColumn.style.cursor="auto";getParentSpread()!=null&&working&&sizeColumn!=null&&startHandlingDocumentMouse()}function CBMouseDown(){if(event.srcElement!=null&&event.srcElement.tagName=="IMG"&&!event.srcElement.disabled)var a=cb_btn=event.srcElement;if(event.srcElement!=null&&event.srcElement.tagName=="IMG"&&event.srcElement.disabled)event.srcElement.ignoreClick=true}function CBMouseUp(){var a=cb_btn;a!=null;editing&&window.document.releaseCapture()}function CBMouseOut(){var a=cb_btn;if(a!=null){spreadView&&spreadView.GetCommandBar().UpdateHoverButtonState(a,false);cb_btn=null}}function mouseOver(){var a=window.event.srcElement;if(!isChild(a,getCommandBar())&&!isChild(a,getPager1())&&!isChild(a,getPager2()))return;spreadView&&spreadView.IsEnablejQueryTheme()&&spreadView.JQueryThemeSupporter.MouseOver(event);var b=cb_btn;if(b==null&&event.srcElement!=null&&event.srcElement.tagName=="IMG"&&!event.srcElement.disabled&&!$$(a).hasCssClass("aspNetDisabled")){b=cb_btn=event.srcElement;spreadView&&spreadView.GetCommandBar().UpdateHoverButtonState(b,true)}stopHandlingDocumentMouse()}function keyup(){isPressTABKeyFromOutSide=false;if(window.event.keyCode==enter)if(editing&&editor!=null&&editor.tagName=="SELECT"){if(enter==window.event.keyCode)window.event.returnValue=false;var a=EndEdit();if(!a)return;var b=getTopSpread(element);textBox=window.document.getElementById(b.id+"_textBox");enter==window.event.keyCode&&setTextBoxFocus(true)}resetBlurFlag()}function doIgnoreVirtualPaging(){if(!ignoreVirtualPaging){ignoreVirtualPaging=true;setTimeout(function(){ignoreVirtualPaging=false},300)}}function processKeyMap(){for(var ret=true,n=keyMap.length,i=0;i<n;i++){var ka=keyMap[i];if(window.event.keyCode==ka.key&&window.event.ctrlKey==ka.ctrl&&window.event.shiftKey==ka.shift&&window.event.altKey==ka.alt){ret=false;if(typeof ka.action=="function")ret=ka.action();else ret=eval(ka.action);break}}return ret}function keyDown(){needCheckSelectText=false;if(!spreadView.OnSpreadKeyDown(window.event))return;if(window.fpPostOn!=null)return;ignoreBlur=true;var m=processKeyMap();if(!m)return;doIgnoreVirtualPaging();if(window.event.keyCode==space&&anchorCell!=null){var n=operationMode;if(n=="MultiSelect"){if(isRowSelected(getRowFromCell(anchorCell)))selectRow(getRowFromCell(anchorCell),1,false,true);else selectRow(getRowFromCell(anchorCell),1,true,true);return}}var a=false,b=null;if(editing&&editor!=null){b=getEditor(anchorCell);a=b!=null}if(window.event.keyCode!=left&&window.event.keyCode!=right&&window.event.keyCode!=enter&&window.event.keyCode!=tab&&editing&&!a&&editor.tagName=="SELECT")return;switch(window.event.keyCode){case left:case right:if(a&&getCellType(anchorCell)!="TextCellType"&&editor.FpEditor!="RadioButton"&&editor.FpEditor!="TextBox"){editor!=null&&editor.tagName=="SELECT"&&editor.blur();EndEdit()}if(!editing||editor!=null&&editor.tagName=="SELECT"){editor!=null&&editor.blur();editing&&EndEdit();nextCell(window.event.keyCode)}break;case up:case down:case enter:if(editor!=null&&(editor.tagName=="TEXTAREA"||editor.tagName=="SELECT"))return;if(a&&editing&&editor.FpEditor=="ExtenderEditor"){var f=editor.Extenders;if(f&&(f.indexOf("AutoCompleteExtender")!=-1||f.indexOf("FpComboBox")!=-1))return}if(enter==window.event.keyCode&&window.event.srcElement.tagName=="A")return;if(editing){if(enter==window.event.keyCode)window.event.returnValue=false;if(editor!=null&&editor.FpEditor=="MultiColumnComboBoxCellType"&&typeof anchorCell.FpEditorID=="undefined"){var d=getRowFromCell(anchorCell);if(d==0&&window.event.keyCode==up)return;if(window.event.keyCode==down){d+=anchorCell.rowSpan-1;var j=GetRowCountInternal(),g=d==j-1;if(!g&&d==j-2){var l=getViewportFromCell(anchorCell);if(l.rows[l.rows.length-1].previewRow=="true")g=true}if(g)return}}var k=EndEdit();if(!k)return}nextCell(window.event.keyCode);var c=getTopSpread(element);textBox=window.document.getElementById(c.id+"_textBox");enter==window.event.keyCode&&setTextBoxFocus(true);break;case tab:var c=getTopSpread(element),i=c.ProcessTab=="true"||c.ProcessTab=="True";if(editing){var k=EndEdit(false,{IgnoreFocus:editModePermanent&&!i});if(!k||editing){window.event.returnValue=false;window.event.cancelBubble=true;return}}if(i)nextCell(window.event.keyCode);else{hideSelectionBlock();setActiveSpreadID(c,"",null);spreadView.ActivateSpread(null);editModePermanent&&textBox!=window.document.activeElement&&spreadView.FocusSpread(false,true)}break;case shift:break;case home:case end:case pup:case pdn:!editing&&nextCell(window.event.keyCode);break;case space:if(a&&b!=null&&b.getAttribute("FpEditor")=="MultiColumnComboBoxCellType"){window.event.returnValue=false;break}default:var e=b!=null&&(b.tagName=="INPUT"&&b.type=="text"||b.tagName=="TEXTAREA");if(window.event.keyCode==67&&event.ctrlKey&&(!editing||a&&!e)){Copy();$$.utils.cancelDefault(window.event)}else if(window.event.keyCode==86&&event.ctrlKey&&(!editing||a&&!e)){Paste();$$.utils.cancelDefault(window.event)}else if(window.event.keyCode==88&&event.ctrlKey&&(!editing||a&&!e)){Clear();$$.utils.cancelDefault(window.event)}else if(!editing&&anchorCell!=null&&!isHeaderCell(anchorCell)&&!window.event.ctrlKey&&window.event.keyCode!=altkey&&anchorCell.canFocus!="false"){var h=anchorCell.getElementsByTagName("INPUT");if(!(h!=null&&h.length>0&&h[0].FpEditor=="Button")){StartEdit(anchorCell);if(editing&&window.event.keyCode==27)window.event.returnValue=false;if(!editing&&window.document.activeElement==textBox)window.event.returnValue=false}if(window.event.keyCode==backspace&&editor.tagName=="SELECT")window.event.returnValue=false;if(space==window.event.keyCode&&editor.FpEditor!="Button"&&(editor.tagName!="INPUT"||editor.type!="checkbox"))window.event.returnValue=false}else if((editing||(anchorCell==null||isHeaderCell(anchorCell))&&!event.ctrlKey&&event.keyCode!=altkey)&&window.document.activeElement==textBox)window.event.returnValue=false}}function Print(){if(spreadView._LoadOnDemandTimerId!=null&&spreadView._LoadOnDemandTimerId>-1)spreadView._SetPendingRequest(doPrint,true);else doPrint()}function doPrint(){if(editing)return;if(getParentSpread()!=null)return;saveData();window.document.printSpread==null&&window.document.body.insertAdjacentHTML("beforeEnd","<iframe onload=\"javascript:document.getElementById('"+element.id+"').printSpread()\" name=printSpread width=0 height=0 src='scid=dummy.htm'></iframe>");var c=mvc.inMvcFramework();if(c)mvc.doPrint(element.getAttribute("name"),"Print","printSpread");else{var b=getForm();if(b==null)return;var a=b;a.__EVENTTARGET.value=element.name;a.__EVENTARGUMENT.value="Print";var d=a.target;a.target="printSpread";a.submit();a.target=d}}function printSpread(){var a=window.document.activeElement;window.document.printSpread.focus();window.document.printSpread.print();a&&!a.disabled&&a.focus()}function PrintPDF(){if(spreadView._LoadOnDemandTimerId!=null&&spreadView._LoadOnDemandTimerId>-1)spreadView._SetPendingRequest(doPrintPDF,true);else doPrintPDF()}function doPrintPDF(){if(editing)return;if(getParentSpread()!=null)return;saveData();var d=mvc.inMvcFramework();if(d){var c=window.document;c.printSpreadPDF==null&&c.body.insertAdjacentHTML("beforeEnd","<iframe name=printSpreadPDF width=0 height=0 src='scid=dummy.htm'></iframe>");mvc.doPrint(element.getAttribute("name"),"PrintPDF","printSpreadPDF")}else{var b=getForm();if(b==null)return;var a=b;a.__EVENTTARGET.value=element.name;a.__EVENTARGUMENT.value="PrintPDF";a.submit()}}function ExpandRow(b){var a=window.document.FpActiveSpread;if(a==null)a=element;if(a.initialized&&!a.IsValid())return;saveData();var c=element.ajax!="false";if(c)syncData(element.name,"ExpandView, "+b);else __doPostBack(element.name,"ExpandView, "+b)}function SortColumn(a,c){saveScrollbarState(0,-1);saveData();var d=element.ajax!="false";if(element.layoutMode&&c!=null){var e=getDisplayIndex(c),b=GetCellByRowCol(e,a);if(b!=null&&parseInt(b.col)!=-1)a=parseInt(b.col)}if(d)syncData(element.name,"SortColumn, "+a);else __doPostBack(element.name,"SortColumn, "+a)}function Filter(){if(!element.IsValid())return;var b=window.event.srcElement.value;if(window.event.srcElement.tagName=="SELECT"){var h=new RegExp("\\s*"),g=new RegExp("\\S*"),d=window.event.srcElement[window.event.srcElement.selectedIndex].text,e="",c=0,f=b.length;while(f>0){var a=b.match(h);if(a!=null){e+=a[0];c=a[0].length;f-=c;b=b.substring(c);a=b.match(g);if(a!=null){c=a[0].length;f-=c;b=b.substring(c)}}else break;a=d.match(g);if(a!=null){e+=a[0];c=a[0].length;d=d.substring(c);a=d.match(h);if(a!=null){c=a[0].length;d=d.substring(c)}}else break}b=e}var j=fireAutoFilteringColumn(selectedCols,b);ignoreVirtualPaging=true;if(!j.cancel){saveScrollbarState(0,0);saveData();dirty=false;var i=element.ajax!="false";if(i){syncData(window.event.srcElement.name,b);element.LoadState=null}else __doPostBack(window.event.srcElement.name,b)}ignoreVirtualPaging=false}function CallBack(b,a){syncData(element.getAttribute("name"),b,a)}function getForm(){var a=element.parentNode;while(a!=null&&a.tagName!="FORM")a=a.parentNode;return a}function setFpPostOn(a){window.fpPostOn=a}function syncData(targetId,cmd,asyncCallBack,onStart,onStop){if(!initialized||spreadView==null)return;if(spreadView.IsLoadingOnDemand&&cmd!="UpdateValues"||window.fpPostOn!=null){spreadView.IsLoadingOnDemand&&cmd!="LoadOnDemand"&&spreadView.SetPendingRequest(targetId,cmd,asyncCallBack,onStart,onStop);element.LoadState=null;return}spreadView.OnSpreadCallbackStart(cmd);var ts=getTopSpread(element),e=window.document.createEventObject();e.cancel=false;e.command=cmd;e.spread=element;if(asyncCallBack==null)asyncCallBack=false;e.async=asyncCallBack;var cancel=ts.Behavior.fireCallBackStartEvent(e);if(!cancel&&onStart&&!onStart())cancel=true;if(cancel){element.clearCellData();return}cmd!="RetrieveFilterBarMenus"&&spreadView._LoadOnDemandTimerId!=null&&spreadView._LoadOnDemandTimerId>-1&&spreadView._StopLoadOnDemandTimer();if(cmd!=null&&(cmd.indexOf("SelectView,")==0||cmd=="Next"||cmd=="Prev"||cmd.indexOf("Group,")==0||cmd.indexOf("Page,")==0))element.LoadState=null;var async=e.async;async&&cmd!="RetrieveFilterBarMenus"&&!spreadView.IsLoadingOnDemand&&openWaitMsg();if(!spreadView.IsLoadingOnDemand&&cmd!="RetrieveFilterBarMenus")window.fpPostOn=true;if(error&&cmd!="RetrieveFilterBarMenus"){targetId=element.name;cmd="update"}try{var href,inMvcFramework=mvc.inMvcFramework();if(inMvcFramework){var ts=getTopSpread(element),appPath=ts.getAttribute("AppRootPath");if(appPath!=null&&appPath.length>0)href="/"+appPath+"/"+mvcSpread.MVC_SPREAD_VIRTUAL_FILENAME;else href="/"+mvcSpread.MVC_SPREAD_VIRTUAL_FILENAME}else{var form=getForm();if(form==null)return;var doc=window.document,viewstate=inMvcFramework?doc.getElementById(ts.id+"__VIEWSTATE"):doc.getElementById("__VIEWSTATE");if(viewstate._newValue)viewstate.value=viewstate._newValue;var eventValidation=inMvcFramework?doc.getElementById(ts.id+"__EVENTVALIDATION"):doc.getElementById("__EVENTVALIDATION");if(eventValidation!=null&&eventValidation._newValue)eventValidation.value=eventValidation._newValue;form.__EVENTTARGET.value=targetId;form.__EVENTARGUMENT.value=encodeURIComponent(cmd);href=$$.utils.fixIssueEncodeURL(form.action);if(href==null||href.length==0)href=window.location.href}var target=element.id,data;if(cmd.indexOf("RefreshChart")>=0)data=collectLightData(targetId,cmd);else data=collectData(targetId,cmd);data=fpSpreadJS.removeHiddenCellsInfo(data);var respText="",req=null;try{if(window.external)req=window.external.XMLHttpRequest}catch(ex1){}if(!req)req=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");if(req==null)return;spreadView.ClearTimeoutTasks();var securityWarningBug=$$.browser.securityWarning;securityWarningBug&&cmd!="RetrieveFilterBarMenus"&&cmd!="UpdateValues"&&cmd!="LoadOnDemand"&&ClearSelection();req.open("POST",href,async);req.setRequestHeader("Content-Type","application/x-www-form-urlencoded, charset=UTF-8");req.onreadystatechange=processData;req.send(data);cmd!=null&&cmd.indexOf("SelectView,")==0&&element.focus();function processData(){if(req.readyState!=4)return;var processDataCompletedHandlers=[],processDataCompletedManually=false,pt=null,ts=null;try{!spreadView.IsLoadingOnDemand&&cmd!="RetrieveFilterBarMenus"&&closeWaitMsg();var form=getForm(),doc=window.document;if(form==null&&element.isMVCSpread()){form=doc.body;form.__EVENTTARGET=doc.getElementById("__EVENTTARGET");form.__EVENTARGUMENT=doc.getElementById("__EVENTARGUMENT")}var oldActive=element.id;try{if(cmd!="RetrieveFilterBarMenus"&&(cmd.indexOf("Page,")!=0||$$.utils.contains(element,doc.activeElement))&&spreadView.LoadOnDemandMode!="Background"&&doc.selection&&doc.selection.type!="None"){var input=doc.activeElement,isTextEditor=input.tagName=="INPUT"&&input.type=="text"||input.tagName=="TEXTAREA",selStart=selEnd=-1;if(isTextEditor){selStart=doc.activeElement.selectionStart;selEnd=doc.activeElement.selectionEnd}doc.selection.empty();if(isTextEditor&&doc.activeElement==input){input.selectionStart=selStart;input.selectionEnd=selEnd}}}catch(e){}var buff=doc.createElement("div");if(buff==null)return;if(cmd=="RetrieveFilterBarMenus"){doc.body.appendChild(buff);buff.style.display="none"}var respText=req.responseText;if(/<body[^>]*>/i.test(respText)){window.fpPostOn=null;error=true;var ep=element.errorPage;if(ep!=null&&ep.length>0){var tmp=window.document.createElement("a");tmp.style.display="none";tmp.attachEvent("onclick",cancelBubble);tmp.href=ep;window.document.body.appendChild(tmp);tmp.click();tmp.detachEvent("onclick",cancelBubble);window.document.body.removeChild(tmp);function cancelBubble(a){a.cancelBubble=true}}return}if(element.inDesign&&respText=="__only_postdata__"){window.fpPostOn=null;dataBuff=null;onStop&&onStop();ts=getTopSpread(doc.getElementById(target));ts!=null&&ts.Behavior.fireCallBackStoppedEvent(cmd,element);spreadView.IsLoadOnDemand&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();return}buff.innerHTML=respText;vpholder_setSizeCallback=null;if(cmd.indexOf("RefreshChart")>=0){var data=eval("("+respText+")");updateChartURL(data);if(form!=null&&!element.isMVCSpread()){form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value=""}window.fpPostOn=null;onStop&&onStop();ts=getTopSpread(doc.getElementById(target));ts!=null&&ts.Behavior.fireCallBackStoppedEvent(cmd,element);spreadView.IsLoadOnDemand&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();return}if(cmd=="RetrieveFilterBarMenus"){doc.body.removeChild(buff);spreadView.ReceiveFilterBarPackage(buff,form);fpSpreadJS.loadNewScripts(buff,true);if(form!=null&&!element.isMVCSpread()){form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value=""}window.fpPostOn=null;onStop&&onStop();return}ts=getTopSpread(doc.getElementById(target));pt=getElementById(buff,target+"_values");if(pt!=null){var nodes=pt.documentElement.selectSingleNode("//data"),node=nodes.firstChild;error=false;var ss=doc.getElementById(target);ss.SuspendLayout();while(node!=null){var r,c;if(ss.layoutMode){var cell=getCellByRowCol2(node.getAttribute("r"),node.getAttribute("c"));r=getRowFromCell(cell);c=getColFromCell(cell)}else{r=ss.getRowByKey(node.getAttribute("r"),-1);c=ss.getColByKey(node.getAttribute("c"),-1)}if(r>-1&&c>-1)if(node.tagName.toLowerCase()=="t"){var old=ss.GetValue(r,c);if(node.text!=old){var f=ss.GetFormula(r,c),cl=ss.GetCellByRowCol(r,c);ss.setCellValueFromView(cl,node.text,true);cl.FpFormula=f}}else node.tagName.toLowerCase()=="s"&&SPLController.updateSparkline(r,c,node.text);node=node.nextSibling}ss.clearCellData();ss.ResumeLayout(true);spreadView.IsLoadOnDemand&&spreadView._LoadOnDemandTimerId==-1&&spreadView._StartLoadOnDemandTimer();processDataCompletedManually=true}else{ignorePostbackEditmode=true;element.preventPopUp=true;element._processingFilterBarCommand=targetId!=null&&targetId.indexOf(",fb")==targetId.length-3;var _this=this;spreadView._DisableSpreadValidators();updateSpread(doc,buff,target,cmd,function(){if(processDataCompletedHandlers.length>0){for(var a=0;a<processDataCompletedHandlers.length;a++)processDataCompletedHandlers[a].call(_this);processDataCompletedHandlers=[]}else processDataCompletedManually=true});element._processingFilterBarCommand=false;ignorePostbackEditmode=false}if(form!=null&&!element.isMVCSpread()){form.__EVENTTARGET.value="";form.__EVENTARGUMENT.value=""}var inMvcFramework=mvc.inMvcFramework(),old=doc.getElementById("__VIEWSTATE"),t=getElementById(buff,"__VIEWSTATE");if(t!=null){if(old!=null){old.value=t.value;old._newValue=t.value}if(inMvcFramework){var viewstate=doc.getElementById(ts.id+"__VIEWSTATE");if(viewstate!=null){viewstate.value=t.value;viewstate._newValue=t.value}}}old=doc.getElementById("__EVENTVALIDATION");t=getElementById(buff,"__EVENTVALIDATION");if(t!=null){if(old!=null){old.value=t.value;old._newValue=t.value}if(inMvcFramework){var validation=doc.getElementById(ts.id+"__EVENTVALIDATION");if(validation!=null){validation.value=t.value;validation._newValue=t.value}}}processDataCompletedHandlers.push(function(){buff.innerHTML="";window.fpPostOn=null;dataBuff=null;if(needDelayScrollView){needDelayScrollView=false;setTimeout(function(){scrollView("processData")},0)}})}catch(e){window.fpPostOn=null;dataBuff=null}finally{req.onreadystatechange=null;req=null}processDataCompletedHandlers.push(function(){onStop&&onStop()});ts!=null&&ts.Behavior.fireCallBackStoppedEvent(cmd,element);var newElement=window.document.getElementById(element.id);if(newElement!=null){var newSpreadView=newElement.getSpreadView?newElement.getSpreadView():null;if(newSpreadView!=null&&newSpreadView.IsInitialized){newSpreadView.OnSpreadCallbackStopped(targetId);cmd!="LoadOnDemand"&&newElement.getAnchorCell&&getEditor(newElement.getAnchorCell())==null&&newElement.fpSpreadJS.setImeMode(newElement,newSpreadView.GetFocusTextBox(),newElement.getAnchorCell(),true)}else newElement.__pendingCallbakStoppedTargetId=targetId}cmd!="LoadOnDemand"&&!spreadView.IsMultiColumnComboBox&&processDataCompletedHandlers.push(function(){ts.getSpreadView().RetrieveFilterBarMenus()});if(processDataCompletedManually){for(var i=0;i<processDataCompletedHandlers.length;i++)processDataCompletedHandlers[i].call(this);processDataCompletedHandlers=[]}}}catch(e){window.fpPostOn=null;dataBuff=null}}function getStyle(a,b){for(j=0;j<a.rules.length;j++)if(a.rules[j].selectorText==b)return a.rules[j];return null}function updateStyles(f,i){var b=i.getElementsByTagName("style");if(b!=null){var a=window.document.styleSheets[element.id+"_style"];if(a==null){a=window.document.createElement("style");a.id=element.id+"_style";window.document.appendChild(a)}a=window.document.styleSheets[element.id+"_style"];if(a!=null){for(var e="",c=0;c<b.length;c++)if(b[c]!=null&&b[c].innerHTML!=null&&b[c].innerHTML!="")for(var g=0;g<b[c].styleSheet.rules.length;g++){var d=b[c].styleSheet.rules[g],h=getStyle(a,d.selectorText);if(h!=null)h.style.cssText=d.style.cssText;else if((f.getViewport1()==null||d.selectorText.indexOf(f.getViewport1().id)<0)&&(f.getViewport0()==null||d.selectorText.indexOf(f.getViewport0().id)<0))e+=d.selectorText+"{"+d.style.cssText+"}"}if(a.cssText!=null&&a.cssText.length>0)e=a.cssText+e;if(e.length>0)a.cssText=e}}}function updateSpread(E,k,D,d,l){var a=getTopSpread(E.getElementById(D)),r=spreadView.GetTopSpreadView();a.updating=true;a.isSizeSpread=false;a.ignoreSizeSpread=false;var b=getElementById(k,a.id);if(b!=null){if(typeof Sys!="undefined"&&typeof $get!="undefined"){FarPoint.System.ExtenderHelper.saveLoadedExtenderScripts(a,d,b.getAttribute("error")=="true");FarPoint.System.ExtenderHelper.processCss(k)}else spreadView.LoadCss(k);(d!="LoadOnDemand"||!smartPaint&&spreadView.LoadOnDemandMode!="Background")&&a.dispose();a.isMVCSpread()&&d!="LoadOnDemand"&&b.getAttribute("error")!="true"&&spreadView.ClearFilterHiddenValueFields();(d!="LoadOnDemand"||b.getAttribute("error")=="true")&&spreadView.RemoveMenus(b.getAttribute("error")=="true");var A=d=="LoadOnDemand"&&spreadView.LoadOnDemandMode=="Background"&&b.getAttribute("error")!="true";!A&&(!smartPaint||d!="LoadOnDemand"||spreadView.LoadOnDemandMode=="Background")&&spreadView.__Dispose(d);element.LoadState=null;var x,B,C;if(d=="LoadOnDemand"&&b.error!="true"){var z=a.all[a.id+"_data"],w=b.all[a.id+"_data"];if(z!=null&&w!=null)z.data=w.data;var u=a.all[a.id+"_LoadInfo"],t=b.all[a.id+"_LoadInfo"];if(u!=null&&t!=null)u.value=t.value;msgStyle=null;updateStyles(a,b);r._UpdateCssImports(b);var e=Number.MAX_VALUE,n=a.GetRowCount()-1,j=false,i=getElementById(b,a.id+"_rowHeader"),m=[],v=GetColCount();if(i!=null){i=i.firstChild;e=Math.min(e,i.rows.length);j=i.rows.length>1;var p=a.getRowHeader();if(p!=null)x=p.rows.length-1;loadRows(p,i,true);x==0&&syncBorders()}var c=getElementById(b,a.id+"_viewport2");if(c!=null){e=Math.min(e,c.rows.length);j=c.rows.length>0;var g=a.getViewport2();v>0&&(g.rows.length>0||c.rows.length>0)&&m.push(2);if(g!=null)B=g.rows.length;loadRows(g,c,false)}c=getElementById(b,a.id+"_viewport");if(c!=null){e=Math.min(e,c.rows.length);j=c.rows.length>0;var g=a.getViewport();v>0&&(g.rows.length>0||c.rows.length>0)&&m.push(-1);C=g.rows.length;loadRows(g,c,false)}spreadView.LoadOnDemandMode=="Background"&&spreadView.CDF_OnLoadRowStop();if(smartPaint){rowCount+=c.rows.length;element.RowCount=parseInt(element.RowCount)+c.rows.length;if(spreadView.LoadOnDemandMode=="Background")showRows(Math.max(0,current+currentCount),e,true);else showPage(current+1,currentCount,true);spreadView._UpdateDummyHeight()}else if(n>=0)if(j&&(n>0||spreadView.IsBackgroundMode)){var F=a.getRowHeightInternal(n);a.setRowHeight2(n,F,null,false)}for(var q=0;q<m.length;q++)spreadView._RemoveNoRow(m[q]);if(j)element.LoadState=null;else element.LoadState="complete"}else{var y=window.document.styleSheets[element.id+"_style"];if(y!=null)y.cssText="";r._UpdateCssImports(b);a.valid=true;FarPoint.Web.Spread.CallBacks.topic(a.id).topic("Dispose").publish(a);$$(a).copyInnerHTML(b);spreadView._CleanValidators()}copySpreadAttrs(b,a);$$.browser.quirksMode&&autoFitTextBoxEditors(a);error=b.error=="true";if(typeof Sys!="undefined"&&typeof $get!="undefined"){if(element.ClientAutoSize=="True")element.ignoreSizeSpread=true;FarPoint.System.ExtenderHelper.loadExtenderScripts(a,k)}a.updating=false;fpSpreadJS.setImeMode(element,textBox,anchorCell);fpSpreadJS.loadNewScripts(k,null,function(){l!=null&&l()});if(d=="LoadOnDemand"&&spreadView.LoadOnDemandMode=="Background"&&!error){var h=getScrollvp();if(h==null)h=getViewport().parentNode;spreadView._MakeSureTempScrollableTo(h.scrollTop)}if(b.error!="true"&&d=="LoadOnDemand"&&spreadView.LoadOnDemandMode=="Background"){updateTabIndex();if(!smartPaint){element.RowCount=parseInt(element.RowCount)+c.rows.length;rowCount+=c.rows.length}else{current=spreadView._GetTopDisplayedTableRowIndex(false);currentCount=spreadView._GetBottomDisplayedTableRowIndex(false)-current+1}spanCells=[];rowSpanCells=[];initSpan(getViewport0(),spanCells);initSpan(getViewport1(),spanCells);initSpan(getViewport2(),spanCells);initSpan(getViewport(),spanCells);initSpan(getFrozRowHeader(),rowSpanCells);initSpan(getRowHeader(),rowSpanCells);if(isactive||retainSelectionBlock){paintSelections(true,true);paintAnchorCell(true,true)}if(element.ignoreSizeSpread)element.ignoreSizeSpread=null;element.ClientAutoSize=="True"&&sizeSpread(true);var h=getScrollvp();if(h==null)h=getViewport().parentNode;spreadView._MakeSureScrollableTo(h.scrollTop)}else if(!smartPaint||d!="LoadOnDemand"||spreadView.LoadOnDemandMode=="Background"){a.preventScrollView=true;a.Behavior.init(d);a.preventScrollView=false;a.Behavior.fireAutoFilterColumnCompleted(d)}else if(element.ignoreSizeSpread)element.ignoreSizeSpread=null;d!="LoadOnDemand"&&window.document.FpActiveSpread===element&&a.focus()}else{error=true;var o=element.errorPage;if(o!=null&&o.length>0){var f=window.document.createElement("a");f.style.display="none";f.attachEvent("onclick",s);f.href=o;window.document.body.appendChild(f);f.click();f.detachEvent("onclick",s);window.document.body.removeChild(f);function s(a){a.cancelBubble=true}}a.updating=false;fpSpreadJS.setImeMode(element,textBox,anchorCell);l!=null&&l()}}function autoFitTextBoxEditors(d){var b=d.getElementsByTagName("INPUT");if(b!=null)for(var c=0;c<b.length;c++){var a=b[c];if(a.type=="text"&&a.parentElement.tagName=="TD"&&a.getAttribute("FpEditor")=="TextBox"&&a.parentElement.parentElement.getAttribute("FpKey")!=null&&a.parentElement.getAttribute("FpCellType")==null)a.style.width=a.parentElement.clientWidth}}function importRows(f,h,k,d,a,c){if(h<0)return;var j=c&&a.rows.length<2||!c&&a.rows.length==0,b=0;if(f!=null){var i=null;if(c)i=a.rows[a.rows.length-1];var l=f.rows.length;for(b=0;b<k;b++){var g=h+b;d.setAt(g,f.rows[b].cloneNode(true));d.getRow(g).viewport=a;if(!j){var e=d.getRow(g).cloneNode();a.tBodies[0].insertBefore(e,i);e.insertCell();e.rowHolder=1}}}}function loadRows(b,a,c){if(b==null||a==null)return;var p=c&&b.rows.length<2||!c&&b.rows.length==0;if(smartPaint)if(c)importRows(a,rhList.table.rows.length,a.rows.length-1,rhList,b,c);else if(b==element.getViewport())importRows(a,vpList.table.rows.length,a.rows.length,vpList,b,c);else importRows(a,vp2List.table.rows.length,a.rows.length,vp2List,b,c);if(!smartPaint||p){var e=null;if(b.tBodies.length==0){e=window.document.createElement("tbody");b.appendChild(e)}else e=b.tBodies[0];var m=a.rows.length,k=null;if(c){m--;if(e.rows.length>0)k=e.rows(e.rows.length-1)}for(var f=0;f<m;f++){var l=a.rows(f).cloneNode(true);e.insertBefore(l,k);var h=a.rows[f].getElementsByTagName("SELECT");if(h!=null&&h.length>0)for(var g=0;g<h.length;g++){var j=h[g];if(j!=null){var o=getElementById(l,j.id);if(o!=null)o.value=j.value}}}}if(!c)for(var n=b.parentNode,f=0;f<a.parentNode.children.length;f++){var d=a.parentNode.children[f];if(d!=a)if(d.id=="")n.insertBefore(d.cloneNode(true));else{var i=window.document.getElementById(d.id);if(i==null)n.insertBefore(d.cloneNode(true));else if(i.id.indexOf(element.id+"_ValidatorHold")!=-1)for(var g=0;g<d.children.length;g++)i.insertBefore(d.children[g].cloneNode(true))}}}function copySpreadAttrs(a,b){b.selectionBlockOptions=a.selectionBlockOptions;if(a.RetainSelectionBlock&&a.RetainSelectionBlock=="false"){b.RetainSelectionBlock="false";retainSelectionBlock=false}else{b.RetainSelectionBlock="true";retainSelectionBlock=true}b.AllRowsLoaded=a.AllRowsLoaded;b.totalRowCount=a.totalRowCount;b.pageCount=a.pageCount;b.clipboard=a.clipboard;b.loadOnDemand=a.loadOnDemand;b.loadOnDemandInterval=a.loadOnDemandInterval;b.loadOnDemandMode=a.loadOnDemandMode;b.loadOffsetFromBottom=a.loadOffsetFromBottom;b.colMove=a.colMove;b.allowGroup=a.allowGroup;b.sizeHeader=a.sizeHeader;b.showFocusRect=a.showFocusRect;b.FocusBorderColor=a.FocusBorderColor;b.FocusBorderStyle=a.FocusBorderStyle;b.FpDefaultEditorID=a.FpDefaultEditorID;b.hierView=a.hierView;b.IsNewRow=a.IsNewRow;b.cmdTop=a.cmdTop;b.ProcessTab=a.ProcessTab;b.AcceptFormula=a.AcceptFormula;b.EditMode=a.EditMode;b.AllowInsert=a.AllowInsert;b.AllowDelete=a.AllowDelete;b.error=a.error;b.ajax=a.ajax;b.autoCalc=a.autoCalc;b.multiRange=a.multiRange;b.rowFilter=a.rowFilter;b.OperationMode=a.OperationMode;b.selectedForeColor=a.selectedForeColor;b.selectedBackColor=a.selectedBackColor;b.anchorBackColor=a.anchorBackColor;b.tabIndex=a.tabIndex;b.EnableRowEditTemplate=a.EnableRowEditTemplate;b.isFiltering=a.isFiltering;b.isFilteringCancel=a.isFilteringCancel;b.FilteringString=a.FilteringString;b.FilteringCol=a.FilteringCol;b.scrollContent=a.scrollContent;b.scrollContentColumns=a.scrollContentColumns;b.scrollContentTime=a.scrollContentTime;b.scrollContentMaxHeight=a.scrollContentMaxHeight;b.SelectionPolicy=a.SelectionPolicy;b.selectionUnit=a.selectionUnit;b.ShowHeaderSelection=a.ShowHeaderSelection;b.currentPageIndex=a.currentPageIndex!=null?a.currentPageIndex:a.currentpageindex;b.virtualPaging=a.virtualPaging;b.semiTransparentSelectedBackColor=a.semiTransparentSelectedBackColor;b.layoutMode=a.layoutMode;b.layoutRowCount=a.layoutRowCount;if(b.ClientAutoSize!="True"&&b.style!=null&&a.style!=null){if(b.style.width!=a.style.width)b.style.width=a.style.width;if(b.style.border!=a.style.border)b.style.border=a.style.border;if(b.style.height!=a.style.height)b.style.height=a.style.height}if(a.expandedRowKeys!=null&&a.expandedRowKeys!="")b.expandedRowKeys=a.expandedRowKeys;else b.expandedRowKeys=null;$$(b).copyHiddenColumnAttrs(a);if(a.chartConerImg!=null&&a.chartConerImg.length>0)b.chartConerImg=a.chartConerImg;else b.chartConerImg=null;if(a.rowsToBeLoaded!=null&&a.rowsToBeLoaded!="")b.rowsToBeLoaded=a.rowsToBeLoaded;else b.rowsToBeLoaded=null;if(a.scrollToTopRow!=null&&a.scrollToTopRow!="")b.scrollToTopRow=a.scrollToTopRow;else b.scrollToTopRow=null;if(a.topRow!=null&&a.topRow!="")b.topRow=a.topRow;else b.topRow=null;var c=a.spreadcontextmenucss;if(c!=null&&c!="")b.spreadcontextmenucss=c;c=a.DisableNonEditModeValidation;if(c!=null&&c!="")b.DisableNonEditModeValidation=c;else b.DisableNonEditModeValidation=null;c=a.useDefaultSelectionBackColor;if(c!=null&&c!="")b.useDefaultSelectionBackColor=c;else b.useDefaultSelectionBackColor=null}function canCollectInput(a){if(a.tagName=="input"){var b=a.type;return(b=="hidden"||b=="text"||b=="password"||(b=="checkbox"&&!element.inDesign||b=="radio")&&a.checked)&&!a.isInvalid}else if(a.tagName!="select")return false}function collectData(t,g,s){var n=mvc.inMvcFramework(),e=null,a,d,c="fpcallback=true&";if(n){e=getTopSpread(element);var r=e.getElementsByTagName("input"),q=e.getElementsByTagName("select"),o=e.getElementsByTagName("textarea");d=[];for(var b=0,j=r.length;b<j;b++){var i=r[b];if(s)i.type=="hidden"&&d.push(i);else d.push(i)}for(var b=0,j=q.length;b<j;b++)d.push(q[b]);for(var b=0,j=o.length;b<j;b++)d.push(o[b])}else d=getForm().elements;for(var b=0;b<d.length;b++){a=d[b];if(g=="RetrieveFilterBarMenus"&&$$.utils.contains(element,a)||g=="LoadOnDemand"&&spreadView.IsBackgroundMode&&editing&&editor==a)continue;var h=a.tagName.toLowerCase();if(h=="input"){var f=a.type;if((f=="hidden"||f=="text"||f=="password"||(f=="checkbox"&&!element.inDesign||f=="radio")&&a.checked)&&!a.isInvalid)c+=a.name+"="+encodeURIComponent(a.value)+"&"}else if(h=="select")for(var l=0;l<a.children.length;l++){var k=a.children[l];if(k.tagName.toLowerCase()=="option"&&k.selected)c+=a.name+"="+encodeURIComponent(k.value)+"&"}else if(h=="textarea")c+=a.name+"="+encodeURIComponent(a.value)+"&"}if(n){var p=window.document.getElementById(e.id+"__VIEWSTATE");if(p!=null)c+="__VIEWSTATE="+encodeURIComponent(p.value)+"&";c+="__EVENTTARGET="+encodeURI(t)+"&";if(g!=null)c+="__EVENTARGUMENT="+encodeURIComponent(encodeURIComponent(g))+"&";var m=window.document.getElementById(e.id+"__EVENTVALIDATION");if(m!=null)c+="__EVENTVALIDATION="+encodeURIComponent(m.value)+"&";c+="__FPSPREAD="+encodeURI(e.id)+"&"}return c}function collectLightData(h,g){if(mvc.inMvcFramework())return collectData(h,g,true);for(var c=getForm(),a,d="fpcallback=true&",b=0;b<c.elements.length;b++){a=c.elements[b];var e=a.tagName.toLowerCase();if(e=="input"){var f=a.type;if(f=="hidden")d+=a.name+"="+encodeURIComponent(a.value)+"&"}}return d}function ShowMessage(e,a,b,d){var c=GetRowCountInternal(),f=GetColCount();if(a==null||b==null||a<0||a>=c||a>=c||b<0||b>=f){a=-1;b=-1}showMessageInner(e,a,b,d)}function HideMessage(b,a){var e=GetRowCountInternal(),d=GetColCount();if(b==null||a==null||b<0||b>=e||a<0||a>=d)msgList&&msgList.centerMsg&&msgList.centerMsg.msgBox.IsVisible&&msgList.centerMsg.msgBox.Hide();var c=getMsgObj(b,a);c&&c.msgBox.IsVisible&&c.msgBox.Hide()}function showMessageInner(f,e,d,b){var a=getMsgObj(e,d);if(a)a.timer&&a.msgBox.Hide();else a=createMsgObj(e,d);var c=a.msgBox;c.Show(f);if(b&&b>0)a.timer=setTimeout(function(){c.Hide();displayingVirtualScrollingContent=null},b);setMsgObj(a)}function getMsgObj(b,c){var a;if(msgList)if(b==-1&&c==-1)a=msgList.centerMsg;else if(b==-2)a=msgList.hScrollMsg;else if(c==-2)a=msgList.vScrollMsg;else if(msgList[b])a=msgList[b][c];return a}function setMsgObj(a){if(!msgList)msgList=[];if(a.row==-1&&a.col==-1)msgList.centerMsg=a;else if(a.row==-2)msgList.hScrollMsg=a;else if(a.col==-2)msgList.vScrollMsg=a;else{if(!msgList[a.row])msgList[a.row]=[];msgList[a.row][a.col]=a}}var scStyle=null;function createMsgObj(e,d){var a=window.document.createElement("div"),c={row:e,col:d,msgBox:a},b=null;if(e!=-2&&d!=-2){a.style.border="1px solid black";a.style.background="yellow";a.style.color="red";getMsgStyle();b=msgStyle}else{a.style.border="1px solid #55678e";a.style.fontSize="small";a.style.background="#E6E9ED";a.style.color="#4c5b7f";getScrollingContentStyle();b=scStyle}if(b!=null){if(b.fontFamily!=null)a.style.fontFamily=b.fontFamily;if(b.fontSize!=null)a.style.fontSize=b.fontSize;if(b.fontStyle!=null)a.style.fontStyle=b.fontStyle;if(b.fontVariant!=null)a.style.fontVariant=b.fontVariant;if(b.fontWeight!=null)a.style.fontWeight=b.fontWeight;if(b.backgroundColor!=null)a.style.backgroundColor=b.backgroundColor;if(b.color!=null)a.style.color=b.color}a.style.position="absolute";a.style.display="block";a.style.overflow="hidden";a.style.marginLeft=0;a.style.marginTop=2;a.style.marginRight=0;a.style.marginBottom=0;a.msgObj=c;a.Show=function(n){var f=getTopSpread(element);this.style.visibility="visible";this.style.display="block";if(n){this.style.posLeft=0;this.style.posTop=0;this.style.width="auto";this.innerHTML=n}var k=isXHTML(),c=getMsgPos(this.msgObj.row,this.msgObj.col);if(this.msgObj.row>=0&&this.msgObj.col>=0){var d=getViewPortByRowCol(this.msgObj.row,this.msgObj.col);!this.parentElement&&d!=null&&d.vh&&d.vh.parentElement.insertBefore(a,null);var i=this.offsetWidth;this.style.posLeft=c.left;if(d&&d.vh&&c.left+i>d.vh.offsetWidth)this.style.width=c.cellWidth-2;else if(this.style.width!=i)this.style.width=i-(k?2:0);if(d!=null&&c.top>=parseInt(d.vh.clientHeight-2))c.top=c.top-c.cellHeight-this.clientHeight-3>0?c.top-c.cellHeight-this.clientHeight-3:0;this.style.posTop=c.top}else{var g=20,j=element.currentStyle||element.style,q=j.position=="relative"||j.position=="absolute";f.insertBefore(a,null);var e=c.top,h=c.left,b=element.offsetParent;while((b.tagName=="TD"||b.tagName=="TR"||b.tagName=="TBODY"||b.tagName=="TABLE")&&b.style.position!="relative"&&b.style.position!="absolute")b=b.offsetParent;if(!q&&k&&b){var l=getLocation(element);e+=l.y;h+=l.x;if(b.tagName!="BODY"){var m=getLocation(b);e-=m.y+getBorderWidth(b,0);h-=m.x+getBorderWidth(b,3)}}if(this.offsetWidth+g<f.offsetWidth)h+=(f.offsetWidth-this.offsetWidth-g)/(this.msgObj.row==-2?1:2);else this.style.width=f.offsetWidth-g;if(this.offsetHeight<f.offsetHeight)e+=(f.offsetHeight-this.offsetHeight)/(this.msgObj.col==-2?1:2);if(this.msgObj.col==-2){var p=getColFooter();if(p)e-=p.offsetHeight;var o=getCommandBar();if(o)e-=o.offsetHeight;e-=g}this.style.posTop=e;this.style.posLeft=h}this.IsVisible=true};a.Hide=function(){this.style.visibility="hidden";this.style.display="none";this.IsVisible=false;if(this.msgObj.timer){clearTimeout(this.msgObj.timer);this.msgObj.timer=null}this.innerHTML=""};return c}function getLocation(a){if(a.self||a.nodeType===9)return{x:0,y:0};var b=a.getBoundingClientRect();if(!b)return{x:0,y:0};var d=a.ownerDocument.documentElement,e=b.left-2+d.scrollLeft,f=b.top-2+d.scrollTop;try{var c=a.ownerDocument.parentWindow.frameElement||null;if(c){var g=c.frameBorder==="0"||c.frameBorder==="no"?2:0;e+=g;f+=g}}catch(h){}return{x:e,y:f}}var _borderWidthNames=["borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth"],_borderStyleNames=["borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle"],_borderThicknesses;function getBorderWidth(b,a){if(!getBorderVisible(b,a))return 0;var c=getCurrentStyle(b,_borderWidthNames[a]);return parseBorderWidth(c)}function getBorderVisible(b,a){return getCurrentStyle(b,_borderStyleNames[a])!="none"}function getCurrentStyle(b,c,d){var a=null;if(b){if(b.currentStyle)a=b.currentStyle[c];else if(document.defaultView&&document.defaultView.getComputedStyle){var e=document.defaultView.getComputedStyle(b,null);if(e)a=e[c]}if(!a&&b.style.getPropertyValue)a=b.style.getPropertyValue(c);else if(!a&&b.style.getAttribute)a=b.style.getAttribute(c)}if(!a||a==""||typeof a==="undefined")if(typeof d!="undefined")a=d;else a=null;return a}function parseBorderWidth(d){if(!_borderThicknesses){var c={},a=document.createElement("div");a.style.visibility="hidden";a.style.position="absolute";a.style.fontSize="1px";document.body.appendChild(a);var b=document.createElement("div");b.style.height="0px";b.style.overflow="hidden";a.appendChild(b);var e=a.offsetHeight;b.style.borderTop="solid black";b.style.borderTopWidth="thin";c.thin=a.offsetHeight-e;b.style.borderTopWidth="medium";c.medium=a.offsetHeight-e;b.style.borderTopWidth="thick";c.thick=a.offsetHeight-e;a.removeChild(b);document.body.removeChild(a);_borderThicknesses=c}if(d){switch(d){case"thin":case"medium":case"thick":return $$.browser.quirksMode?0:_borderThicknesses[d];case"inherit":return 0}var f=parseUnit(d);if(f.type!="px")throw new Error;return f.size}return 0}function parseUnit(a){if(!a)throw new Error;a=trim(a).toLowerCase();for(var g=a.length,c=-1,f=0;f<g;f++){var b=a.substr(f,1);if((b<"0"||b>"9")&&b!="-"&&b!="."&&b!=",")break;c=f}if(c==-1)throw new Error;var e,d;if(c<g-1)e=trim(a.substring(c+1));else e="px";d=parseFloat(a.substr(0,c+1));if(e=="px")d=Math.floor(d);return{size:d,type:e}}function getMsgPos(c,b){var f=getTopSpread(element);if(c<0||b<0)return{left:0,top:0};else{var a=GetCellByRowCol(c,b),e=a.offsetTop+a.clientHeight,d=a.offsetLeft;return{left:d,top:e,cellHeight:a.clientHeight,cellWidth:a.clientWidth}}}function getViewPortByRowCol(e,d){var b=GetCellByRowCol(e,d),a=null,c=false;if(isChild(b,getViewport()))a=getViewport();else if(isChild(b,getViewport2()))a=getViewport2();else if(isChild(b,getViewport1())){a=getViewport1();c=true}else if(isChild(b,getViewport0())){a=getViewport0();c=true}return{vh:a,frozen:c}}function syncMsgs(){if(!msgList)return;for(i in msgList)if(msgList[i].constructor==Array)for(j in msgList[i])msgList[i][j]&&msgList[i][j].msgBox&&msgList[i][j].msgBox.IsVisible&&msgList[i][j].msgBox.Show()}function TableBuff(c,b){this.table=c.document.createElement("table");this.table.insertRow();this.table.deleteRow(0);if(b!=null){var a=getColGroup(b);a!=null&&a.childNodes.length>0&&this.table.appendChild(a.cloneNode(true))}this.setAt=function(a,b){var c=this.table.tBodies[0];if(a==this.table.rows.length){c.insertBefore(b,null);return}var d=this.table.rows[a];c.insertBefore(b,d);this.table.deleteRow(a+1)};this.getRow=function(a){return this.table.rows[a]}}function initSmartPaint(){if(spreadView!=null&&!spreadView.OnSpreadInitSmartPaint())return;element.scrollContentTime=500;var c=element.getViewport(),a=c.rows.length;saveRows(0,a);removeRows(0,a);var b=getRowsPerPage(0);showPage(0,b)}var inshowPage=false;function showPage(a,d){if(current==a&&d==currentCount)return;if(inshowPage)return;inshowPage=true;if(editModePermanent){var f=EndEdit();if(!f)return}var e=vpList.table.rows.length,b=Math.min(d,e-a);if(b<=0){inshowPage=false;return}ignorePaintSelection=true;paintSelections(false,true);ignorePaintSelection=false;if(current<a&&a<current+currentCount){saveRows(current,a-current);removeRows(current,a-current);if(current+currentCount>a+b){saveRows(a+b,current+currentCount-a-b);removeRows(a+b,current+currentCount-a-b)}else showRows(current+currentCount,a+b-current-currentCount)}else if(a<current&&current<a+b){showRows(a,current-a);if(current+currentCount>a+b){saveRows(a+b,current+currentCount-a-b);removeRows(a+b,current+currentCount-a-b)}else showRows(current+currentCount,a+b-current-currentCount)}else{if(current>=0&&currentCount>0){saveRows(current,currentCount);removeRows(current,currentCount)}showRows(a,b)}current=a;currentCount=b;spreadView._UpdateDummyHeight();anchorCell=findAnchorCell();ignorePaintSelection=true;var c=!forcePaintAnchorCell&&window.document.FpActiveSpread==null&&retainSelectionBlock;if(c)forcePaintAnchorCell=true;paintSelections(isactive||retainSelectionBlock,window.document.FpActiveSpread?true:null);if(c)forcePaintAnchorCell=false;ignorePaintSelection=false;inshowPage=false}function showRows(a,b,c){var d=element.getViewport(),e=element.getViewport2(),f=element.getRowHeader();d!=null&&showRowsImp(d,a,b,vpList,c);e!=null&&showRowsImp(e,a,b,vp2List,c);f!=null&&showRowsImp(f,a,b,rhList,c);spreadView&&b>0&&a+b-1>spreadView.LastCheckedCDFRow&&spreadView._getCDFs(spreadView.LastCheckedCDFRow+1,a+b-1);for(r=0;r<b;r++){if(a+r>=d.rows.length)break;EnsureRowHeight(a+r)}spreadView&&spreadView.RepaintCDFs(a,a+b)}function fpCloneNode(d){for(var b=d.cloneNode(true),f=d.getElementsByTagName("select"),e=b.getElementsByTagName("select"),a=0;a<e.length;a++)e[a].selectedIndex=f[a].selectedIndex;for(var c=d.getElementsByTagName("INPUT"),g=b.getElementsByTagName("INPUT"),a=0;a<c.length;a++)if(c[a].type=="checkbox")g[a].checked=c[a].checked;return b}function showRowsImp(c,a,d,g,f){if(a<0)return;if(a==0&&!f){a=1;d=d-1}for(var b=0,b=0;b<d;b++){if(a>=c.rows.length)break;c.deleteRow(a)}for(b=0;b<d;b++){var e=null;if(a+b<c.rows.length)e=c.rows[a+b];c.tBodies[0].insertBefore(fpCloneNode(g.getRow(a+b)),e)}}function saveRows(b,c){if(b<0)return;var a=element.getViewport();saveRowsImp(a,b,c,vpList);a=element.getViewport2();saveRowsImp(a,b,c,vp2List);a=element.getRowHeader();saveRowsImp(a,b,c,rhList)}function saveRowsImp(b,c,f,e){if(c<0)return;var a=0;if(b!=null){var g=b.rows.length;for(a=0;c+a<g&&a<f;a++){var d=c+a;e.setAt(d,fpCloneNode(b.rows[d]));e.getRow(d).viewport=b}}}function removeRows(b,c){if(c==0)return;var a=element.getViewport(),f=0,e=a.rows.length;if(b==0){b=1;c=c-1}var d=Math.min(c,e-b);if(d<=0)return;removeRowsFromViewport(a,b,d,false,vpList);a=element.getViewport2();a!=null&&removeRowsFromViewport(a,b,d,false,vp2List);a=element.getRowHeader();a!=null&&removeRowsFromViewport(a,b,d,true,rhList)}function removeRowsFromViewport(a,c,f,g,h){for(var b=0,b=0;b<f;b++)a.deleteRow(c);var d=null;if(c<a.rows.length)d=a.rows[c];else if(g)d=a.rows[a.rows.length-1];for(b=0;b<f;b++){var e=h.getRow(c+b).cloneNode();a.tBodies[0].insertBefore(e,d);e.insertCell();e.rowHolder=1}}function doUpdate(){var a=newTop;while(a>0){var b=rhList.getRow(a),d=vpList.getRow(a),c=vp2List.getRow(a);if((b==null||b.cells.length==rowHeaders)&&(d==null||d.cells.length==GetColCount()-frzCols)&&(c==null||c.cells.length==frzCols))break;a--}var e=getRowsPerPage(a);showPage(a,e+newTop-a)}function getRowsPerPage(a){var e=GetRowCount(),c=0,f=0,d=0;while(f<getViewport().parentNode.clientHeight&&c<e){var b=0;if(vpList.getRow(a)!=null&&a<vpList.table.rows.length)b=getVisibleRowHeight(vpList,a+d);if(vp2List.getRow(a)!=null&&a<vp2List.table.rows.length)b=Math.max(b,getVisibleRowHeight(vp2List,a+d));if(rhList.getRow(a)!=null&&a<rhList.table.rows.length)b=Math.max(b,getVisibleRowHeight(rhList,a+d));f+=b;c++;d++}c=c+5;return Math.min(c,e)}function getVisibleRowHeight(g,f){var c=getScrollvp().scrollTop,a=0,e=g.getRow(f);if(e!=null)a=e.style.posHeight;var b=0,d=getViewport().rows[f];if(d!=null){b=d.offsetTop;a=d.style.posHeight}return c>b&&c<b+a?a-c+b:c>=b+a?0:a}function setXMLNodeAttribute(b,d,c){if(b==null)return null;var a=b.attributes.getNamedItem(""+d);if(a!=null)a.text=c;else{a=tableData.createNode("attribute",""+d,"");a.text=c;b.attributes.setNamedItem(a)}return c}function getCellInfo(e,d,c){var a=tableData.documentElement.selectSingleNode("//cellinfo");if(a==null)return null;var b=a.selectSingleNode("./c[@r='"+e+"'][@c='"+d+"'][@pos='"+c+"']");return b}function addCellInfo(e,d,c){var a=getCellInfo(e,d,parseInt(c));if(a!=null)return a;var b=tableData.documentElement.selectSingleNode("//cellinfo");if(b==null)return null;a=tableData.createNode("element","c","");setXMLNodeAttribute(a,"r",e);setXMLNodeAttribute(a,"c",d);setXMLNodeAttribute(a,"pos",c);b.appendChild(a);return a}function setCellAttribute(a,i,e,j,k){if(a==null)return;var d=getRowKeyFromCell(a),f=element.layoutMode?getColKeyFromCell2(a):getColKeyFromCell(a);if(typeof d=="undefined")return;var c=-1;if(isChild(a,getCorner()))c=0;else if(isChild(a,getRowHeader())||isChild(a,getFrozRowHeader()))c=1;else if(isChild(a,getColHeader())||isChild(a,getFrozColHeader()))c=2;else if(isChild(a,getViewport())||isChild(a,getViewport0())||isChild(a,getViewport1())||isChild(a,getViewport2()))c=3;var h=addCellInfo(d,f,c);setXMLNodeAttribute(h,""+i,e);if(!j){fireDataChangedEvent(a,e,element,d,f);var g=getTopSpread(element);g!=element&&g.Behavior.fireDataChangedEvent(a,e,element,d,f)}var b=getCmdBtn("Update");b!=null&&b.disabled&&updateCmdBtnState(b,false);b=getCmdBtn("Cancel");b!=null&&b.disabled&&updateCmdBtnState(b,false);dirty=true;k&&updateValues()}function updateCellLocked(b,c){if(b==null)return;var d=b.getAttribute("FpCellType")=="readonly";if(d==c)return;var a=b.firstChild;while(a!=null){if(typeof a.disabled!="undefined")a.disabled=c;a=a.nextSibling}}function Cells(c,b){var a=GetCellByRowCol(c,b);if(a){a.GetValue=function(){return GetValue(c,b)};a.SetValue=function(a){if(typeof a=="undefined")return;if(this.parentNode.getAttribute("previewRow")!=null)return;SetValue(c,b,a)};a.GetBackColor=function(){return this.bgColorBak!=null?this.bgColorBak:this.currentStyle.backgroundColor};a.SetBackColor=function(a,b){if(typeof a=="undefined")return;this.bgColor=a;this.bgColorBak=a;this.style.backgroundColor=a;setCellAttribute(this,"bc",a,b)};a.GetForeColor=function(){return this.currentStyle.color};a.SetForeColor=function(a,b){if(typeof a=="undefined")return;this.style.color=a;setCellAttribute(this,"fc",a,b)};a.GetTabStop=function(){return this.getAttribute("TabStop")!="false"};a.SetTabStop=function(b){if(typeof b=="undefined")return;var a=new String(b);if(a.toLocaleLowerCase()=="false")this.setAttribute("TabStop","false");else this.removeAttribute("TabStop");setCellAttribute(this,"ts",a.toLocaleLowerCase())};a.GetCellType=function(){var a=getCellType2(this);if(a=="text"||a=="readonly")a=this.getAttribute("CellType2");if(a==null)a="GeneralCellType";return a};a.GetHAlign=function(){return this.currentStyle.textAlign};a.SetHAlign=function(a){if(typeof a=="undefined")return;this.style.textAlign=typeof a=="string"?a:a.Name;setCellAttribute(this,"ha",typeof a=="string"?a:a.Name);var b=window.document.createElement("span");b.style.width="0px";b.style.height="0px";this.appendChild(b);this.removeChild(b)};a.GetVAlign=function(){return this.currentStyle.verticalAlign};a.SetVAlign=function(a){if(typeof a=="undefined")return;this.style.verticalAlign=typeof a=="string"?a:a.Name;setCellAttribute(this,"va",typeof a=="string"?a:a.Name);var b=window.document.createElement("span");b.style.width="0px";b.style.height="0px";this.appendChild(b);this.removeChild(b);setCellAttribute(this,"va",a)};a.GetLocked=function(){return a.GetCellType()=="ButtonCellType"||a.GetCellType()=="TagCloudCellType"||a.GetCellType()=="HyperLinkCellType"?a.getAttribute("locked")=="1":getCellType(this)=="readonly"};a.SetLocked=function(a){fpSpreadJS.setCellLocked(this,getCellType(this),a)&&setCellAttribute(this,"lk",new String(a).toLocaleLowerCase())};a.GetFont_Name=function(){return this.currentStyle.fontFamily};a.SetFont_Name=function(a){if(typeof a=="undefined")return;this.style.fontFamily=a;setCellAttribute(this,"fn",a)};a.GetFont_Size=function(){return this.currentStyle.fontSize};a.SetFont_Size=function(a){if(typeof a=="undefined")return;this.style.fontSize=a;setCellAttribute(this,"fs",a);EnsureRowHeight(parseInt(getRowKeyFromCell(this)))};a.GetFont_Bold=function(){return this.currentStyle.fontWeight>=700?true:false};a.SetFont_Bold=function(a){if(typeof a=="undefined")return;this.style.fontWeight=a==true?"bold":"normal";setCellAttribute(this,"fb",new String(a).toLocaleLowerCase())};a.GetFont_Italic=function(){return this.currentStyle.fontStyle=="italic"?true:false};a.SetFont_Italic=function(a){if(typeof a=="undefined")return;this.style.fontStyle=a==true?"italic":"normal";setCellAttribute(this,"fi",new String(a).toLocaleLowerCase())};a.GetFont_Overline=function(){return this.currentStyle.textDecoration.indexOf("overline")>=0?true:false};a.SetFont_Overline=function(b){if(b){var a=new String("overline");if(this.currentStyle.textDecoration.indexOf("line-through")>=0)a+=" line-through";if(this.currentStyle.textDecoration.indexOf("underline")>=0)a+=" underline";this.style.textDecoration=a}else{var a=new String("");if(this.currentStyle.textDecoration.indexOf("line-through")>=0)a+="line-through";if(this.currentStyle.textDecoration.indexOf("underline")>=0)a+=" underline";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fo",new String(b).toLocaleLowerCase())};a.GetFont_Strikeout=function(){return this.currentStyle.textDecoration.indexOf("line-through")>=0?true:false};a.SetFont_Strikeout=function(b){if(b){var a=new String("line-through");if(this.currentStyle.textDecoration.indexOf("overline")>=0)a+=" overline";if(this.currentStyle.textDecoration.indexOf("underline")>=0)a+=" underline";this.style.textDecoration=a}else{var a=new String("");if(this.currentStyle.textDecoration.indexOf("overline")>=0)a+="overline";if(this.currentStyle.textDecoration.indexOf("underline")>=0)a+=" underline";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fk",new String(b).toLocaleLowerCase())};a.GetFont_Underline=function(){return this.currentStyle.textDecoration.indexOf("underline")>=0?true:false};a.SetFont_Underline=function(b){if(b){var a=new String("underline");if(this.currentStyle.textDecoration.indexOf("overline")>=0)a+=" overline";if(this.style.textDecoration.indexOf("line-through")>=0)a+=" line-through";this.style.textDecoration=a}else{var a=new String("");if(this.currentStyle.textDecoration.indexOf("overline")>=0)a+="overline";if(this.currentStyle.textDecoration.indexOf("line-through")>=0)a+=" line-through";if(a=="")a="none";this.style.textDecoration=a}setCellAttribute(this,"fu",new String(b).toLocaleLowerCase())};return a}return null}function getDomRow(d){if(GetRowCount()==0)return null;var a=GetCellByRowCol(d,0);if(a){var c=a.parentElement.rowIndex;if(c>=0){var b=a.parentElement.parentElement.rows(c);if(getSizable(b))return b}return null}}function setRowInfo_RowAttribute(b,c,f,e){b=parseInt(b);if(b<0)return;var d=addRowInfo(b,false,true);setXMLNodeAttribute(d,""+c,f);var a=getCmdBtn("Update");a!=null&&a.disabled&&updateCmdBtnState(a,false);a=getCmdBtn("Cancel");a!=null&&a.disabled&&updateCmdBtnState(a,false);dirty=true;e&&updateValues()}function Rows(b){var a=getDomRow(parseInt(b));if(a){a.GetHeight=function(){return getRowHeightInternal2(b)};a.SetHeight=function(a){if(typeof a=="undefined")return;setRowHeight2(b,parseInt(a),true)};return a}return null}function setColInfo_ColumnAttribute(b,e,f,d){b=parseInt(b);if(b<0)return;var c=addColInfo(b,false);setXMLNodeAttribute(c,""+e,f);var a=getCmdBtn("Update");a!=null&&a.disabled&&updateCmdBtnState(a,false);a=getCmdBtn("Cancel");a!=null&&a.disabled&&updateCmdBtnState(a,false);dirty=true;d&&updateValues()}function Columns(b){var a={colindex:getColByKey(parseInt(b))};if(a){a.GetWidth=function(){return getColWidthFromCol(b)};a.SetWidth=function(a){if(typeof a=="undefined")return;setColWidth(b,parseInt(a))};return a}return null}function getTitleBar(){try{return window.document.getElementById(element.id+"_title")==null?null:window.document.getElementById(element.id+"_title")}catch(a){return null}}function getSubTitleBar(){try{return window.document.getElementById(element.id+"_subtitle")==null?null:window.document.getElementById(element.id+"_subtitle")}catch(a){return null}}function checkTitleInfo(){var a=tableData.documentElement.selectSingleNode("//titleinfo");return a==null?null:a}function addTitleInfo(){var a=checkTitleInfo();if(a!=null)return a;a=tableData.createNode("element","titleinfo","");tableData.documentElement.appendChild(a);return a}function setTitleInfo_Attribute(b,e,d){var c=addTitleInfo();setXMLNodeAttribute(c,""+b,e);var a=getCmdBtn("Update");a!=null&&a.disabled&&updateCmdBtnState(a,false);a=getCmdBtn("Cancel");a!=null&&a.disabled&&updateCmdBtnState(a,false);dirty=true;d&&updateValues()}function GetTitleInfo(){var a=getTitleBar();if(a){a.GetHeight=function(){return this.currentStyle.height};a.SetHeight=function(a){this.style.height=parseInt(a)+"px";this.style.posHeight=parseInt(a);setTitleInfo_Attribute("ht",a);sizeSpread()};a.GetVisible=function(){return this.style.display=="none"?false:true;return this.style.visibility};a.SetVisible=function(a){this.style.display=a?"block":"none";this.style.visibility=a?"visible":"hidden";setTitleInfo_Attribute("vs",new String(a).toLocaleLowerCase());sizeSpread()};a.GetValue=function(){return this.innerText};a.SetValue=function(a){this.innerText=""+a;setTitleInfo_Attribute("tx",a)};return a}return null}function getRowOffsetHeight(a,g){var b=parseInt(a.cellSpacing),i=a.rows[g],d=i.offsetHeight;if(g<a.rows.length-1)d=a.rows[g+1].offsetTop-i.offsetTop-b;var c=i.offsetTop+d,e=g+1;if(e==a.rows.length||a.rows[e].offsetTop-b>=c)return d;var j=a.rows[e].offsetTop,f=e+1,h=0;while(f<a.rows.length&&a.rows[f].offsetTop-b<=c){h=a.rows[f].offsetTop-j;f++}if(a.rows[a.rows.length-1].offsetTop-b<c){var m=a.rows.length;while(a.rows[a.rows.length-1].offsetTop-b<c){var l=a.insertRow(),k=l.insertCell();k.innerHTML="&nbsp;"}h=a.rows[a.rows.length-1].offsetTop-j;while(a.rows.length>m)a.deleteRow()}return d-h}var strStyle="";function showScrollingContent(A){if(ignoreShowScrollingContent||element.ClientAutoSize=="True"&&(getParentSpread()!=null||spreadView.ClientAutoSizeMaxWidth()==0&&spreadView.ClientAutoSizeMaxHeight()==0))return;var F=spreadView.GetAttribute("scrollContentTime"),a=displayingVirtualScrollingContent!=null?displayingVirtualScrollingContent:"";if(!element.initialized){a!=""&&showMessageInner(a,-2,-1,F);return}var o="Row",i="Column",C=spreadView.GetTopSpreadView(),n=GcResources[C.GetCulture(C.Spread)];if(n.Common.ScrollingContentRow)o=n.Common.ScrollingContentRow;if(n.Common.ScrollingContentColumn)i=n.Common.ScrollingContentColumn;var f=getTopSpread(),v=f.scrollContentColumns,D=f.scrollContentMaxHeight,m=f.getViewport(),G=getColGroup(m),u=getScrollvp();if(u==null)u=getParent(m);var s=0;if(typeof element.lcidRow!="undefined")o=element.lcidRow;if(typeof element.lcidColumn!="undefined")i=element.lcidColumn;if(A){var T=u.scrollLeft,e=f.getColHeader(),g=0,q=null;if(e!=null)q=e.childNodes[0].all;else if(G!=null)q=G.children;else return;for(;g<q.length;g++){var j=q[g];s+=parseInt(j.width,10);if(s>T)break}var r=f.getViewport2();if(r)g+=getColGroup(r).childNodes.length;if(e&&e.rows.length>0){var c=e.rows.length-1;if(element.layoutMode==null&&e.ColTextIndex!=null)c=parseInt(e.ColTextIndex);else while(c>=0&&e.rows[c]&&e.rows[c].getAttribute("FpSpread")=="fb")c--;if(c>=0){var d=getHeaderCellFromRowCol(c,g,true);if(d)if(d.FpCellType=="ExtenderCellType"&&d.getElementsByTagName("DIV").length>0){var J=getEditor(d),K=getFunction("ExtenderCellType_getEditorValue");if(J!=null&&K!=null)a="&nbsp;"+i+":&nbsp;"+K(J)+"&nbsp;"}else if(d.getElementsByTagName("SELECT").length>0){var H=d.getElementsByTagName("SELECT")[0];a="&nbsp;"+i+":&nbsp;"+H[H.selectedIndex].text+"&nbsp;"}else a="&nbsp;"+i+":&nbsp;"+d.innerText+"&nbsp;"}}if(a.length<=0)a="&nbsp;"+i+":&nbsp;"+(g+1)+"&nbsp;"}else{var w=!ignoreVirtualPaging?canMoveToPage():null;if(w==null||!w.canMove){displayingVirtualScrollingContent=null;if(spreadView._GetTopDisplayedTableRowIndex(false)==-1)return;for(var U=u.scrollTop-f.virtualTop,l=f.getRowHeader(),c=0,h=0,E=2,p=0;p<m.rows.length;p++){var k=m.rows[p];s+=getRowOffsetHeight(m,p);if(s>U){if(k.FpKey==null&&!k.previewRow)c--;else h=k.offsetHeight;break}if(k.FpKey!=null||k.previewRow){c++;h=k.offsetHeight}}var r=f.getViewport1();if(r)c+=r.rows.length;if(element.layoutMode==null&&v!=null&&v.length>0){h=h>D?D:h;for(var I=v.split(","),y=false,B=0;B<I.length;B++){var j=parseInt(I[B]);if(j==null||j>=GetColCount())continue;var b=GetCellByRowCol(c,j);if(!b||b.col!=null&&b.col!=j)continue;var t=b.group==1,M=b.parentNode.getAttribute("previewRow")!=null,L=b.getAttribute("RowEditTemplate")!=null,Q=isXHTML();if(!Q&&strStyle==""){getScrollingContentStyle();if(scStyle!=null){if(scStyle.fontFamily!=null&&scStyle.fontFamily!="")strStyle+="fontFamily:"+scStyle.fontFamily+";";if(scStyle.fontSize!=null&&scStyle.fontSize!="")strStyle+="fontSize:"+scStyle.fontSize+";";if(scStyle.fontStyle!=null&&scStyle.fontStyle!="")strStyle+="fontStyle:"+scStyle.fontStyle+";";if(scStyle.fontVariant!=null&&scStyle.fontVariant!="")strStyle+="fontVariant:"+scStyle.fontVariant+";";if(scStyle.fontWeight!=null&&scStyle.fontWeight!="")strStyle+="fontWeight:"+scStyle.fontWeight+";";if(scStyle.backgroundColor!=null&&scStyle.backgroundColor!="")strStyle+="backgroundColor:"+scStyle.backgroundColor+";";if(scStyle.color!=null&&scStyle.color!="")strStyle+="color:"+scStyle.color}}if(!y)a+="<div style='overflow:hidden; height:"+h+"px; ScrollingContentWidth'><table cellPadding='0' cellSpacing='0' style='height:"+h+"px;"+(t?"":"table-layout:auto;")+strStyle+"'><tr>";a+="<td style='width:"+(t?0:b.offsetWidth)+"px;'>";E+=b.offsetWidth;if(t)a+="&nbsp;<i>GroupBar:</i>&nbsp;"+b.innerText+"&nbsp;";else if(M)a+="&nbsp;<i>PreviewRow:</i>&nbsp;"+b.innerText+"&nbsp;";else if(L){var O=parseCell(b);a+="&nbsp;<i>RowEditTemplate:</i>&nbsp;"+O+"&nbsp;"}else if(b.FpCellType=="MultiColumnComboBoxCellType"&&b.childNodes[0].MccbId)a+=GetValue(c,j);else if(b.FpCellType=="RadioButtonListCellType"||b.FpCellType=="ExtenderCellType"||b.FpEditorID!=null){var x=parseCell(b);if(b.CellType2!=null&&b.CellType2=="MutuallyExclusiveCheckBoxCellType")x=x.replace("OVERFLOW: hidden;","");a+=x}else a+=b.innerHTML;a+="</td>";y=true;if(t||M||L)break}if(y){a=a.replace("ScrollingContentWidth"," width:"+E+"px; ");a+="</tr></table></div>"}}if(a.length<=0&&l){var g=getColGroup(l).childNodes.length-1;if(element.layoutMode==null)g=l.RowTextIndex?parseInt(l.RowTextIndex):getColGroup(l).childNodes.length-1;var R=GetDisplayIndex(c),d=getHeaderCellFromRowCol(R,g,false);if(d==null||d.getAttribute("FpSpread")=="rowpadding")return;a="&nbsp;"+o+":&nbsp;"+d.innerText+"&nbsp;"}if(a.length<=0){var S=element.layoutRowCount!=null?parseInt(element.layoutRowCount):1;a="&nbsp;"+o+":&nbsp;"+(parseInt(c/S)+1)+"&nbsp;"}}else{var N=parseInt(f.pageCount),P=virtualScrollPagingFormatString||"Page {page} of {count}",z=P.replace(new RegExp("{page}","gi"),w.ToPage+1);z=z.replace(new RegExp("{count}","gi"),N);a=z;displayingVirtualScrollingContent=a}}a!=null&&a!=""&&showMessageInner(a,A?-1:-2,A?-2:-1,F)}function parseCell(d){var a=d.innerHTML,c=getTopSpread(element),b=c.id;if(a.length>0){a=a.replace(new RegExp("id="+b,"g"),"id="+b+"src");a=a.replace(new RegExp("name="+b,"g"),"name="+b+"src")}return a}function getScrollingContentStyle(){if(scStyle!=null)return;for(var e=window.document.styleSheets.length,a=0;a<e;a++){for(var c=window.document.styleSheets(a),b=0;b<c.rules.length;b++){var d=c.rules(b);if(d.selectorText=="."+element.id+"scrollContentStyle"){scStyle=d.style;break}}if(scStyle!=null)break}}function IntegerCellType_getValue(c){var g=getCell(c,true),a=c.innerText;if(a==" "||trim(c.innerHTML)=="&nbsp;")return g.whiteSpace==null?"":" ";c=_getFpRefProperty(g);var b=c.groupchar;if(b!=null&&b!=" "){var e=c.document.createElement("SPAN");e.innerHTML=b;b=e.innerHTML}if(b=="&nbsp;")b=" ";if(b==null)b=",";var f=a.length;while(true){a=a.replace(b,"");if(a.length==f)break;f=a.length}if(a.charAt(0)=="("&&a.charAt(a.length-1)==")"){var d=c.getAttribute("negsign");if(d==null)d="-";a=d+a.substring(1,a.length-1)}return a}function IntegerCellType_isValid(k,a,g){if(a==null||a.length==0)return"";a=trim(a);if(a.length==0)return"";var d=_getFpRefProperty(k),h=new RegExp("^\\s*[-\\+]?\\d+\\s*$"),b=true,c=null;if(g!=null&&g.getAttribute("enf")!=null){c=fpSpreadJS.tryGetNumber(g,a);b=c!=null;if(b)b=c.toString().match(h)!=null}else{var i=d.getAttribute("negsign"),j=d.getAttribute("possign");if(i!=null)a=a.replace(i,"-");if(j!=null)a=a.replace(j,"+");if(a.charAt(a.length-1)=="-")a="-"+a.substring(0,a.length-1);b=a.match(h)!=null;if(b)b=!isNaN(a);if(b)c=parseInt(a,10)}if(b){var f=d.getAttribute("MinimumValue"),e=d.getAttribute("MaximumValue");if(f!=null){f=parseInt(f,10);b=!isNaN(f)&&c>=f}if(b&&e!=null){e=parseInt(e,10);b=!isNaN(e)&&c<=e}}return!b?d.error!=null?d.error:"Integer":""}function _getFpRefProperty(a){var b=a,c=a.FpRef;if(a.FpRef!=null)b=a.document.getElementById(c);if(b==null)b=window.document.getElementById(c);return b}function DateTimeCellType_getValue(b,e,d){var c=getCell(b),a=b.value;if(d)if(c!=null&&b.tagName!="INPUT")a=typeof c.evalue=="undefined"?undefined:c.evalue;if(typeof a=="undefined")a=trim(b.innerText);return a}function DateTimeCellType_setValue(b,a,c){var e=true,d=null;if(c!=null&&(c.getAttribute("edf")!=null||c.getAttribute("ef")!=null)){var f=getCell(b);f.setAttribute("evalue",a==null?"":a);if(a==editingValue)e=a==null;else if(c.getAttribute("ignoreValid")!=null)c.setAttribute("editValue",a);else{d=fpSpreadJS.parseDate(c,a,true);if(d!=null){var g=fpSpreadJS.formatDate(c,d,false);g!=a&&f!=null&&f.setAttribute("evalue",g);a=fpSpreadJS.formatDate(c,d,true)}}}if(b.tagName=="NOBR")b=b.parentElement;if(typeof b.value!="undefined"){if(a==null)a="";if(e)b.value=a;b.style.display="block"}else if(e)if(a==null||a=="")if(b.firstChild!=null&&b.firstChild.tagName=="NOBR")b.firstChild.innerHTML="&nbsp;";else b.innerHTML="&nbsp;";else if(b.firstChild!=null&&b.firstChild.tagName=="NOBR")b.firstChild.innerText=a.toString();else b.innerText=a.toString();return d!=null?d:a}function IntegerCellType_setValue(b,a,d){var g=getCell(b,true),f=true,e=false;if(a!=null&&a!=""){if(d!=null&&d.getAttribute("enf")!=null&&!fpSpreadJS.isFormula(a)){var c=fpSpreadJS.tryGetNumber(d,a);if((!editing||a!=editingValue)&&c!=null){spreadView._ProcessNegativeRed(g,c);var h=fpSpreadJS.getNumberFormat(d);b.innerText=fpSpreadJS.formatNumber(c,"n",h);return c}else f=false}else e=true;if(f)b.innerText=a;e&&spreadView._ProcessNegativeRed(g,IntegerCellType_getValue(b))}else b.innerHTML="&nbsp;";return a}function IntegerCellType_setEditorValueEditMode(b,a,f,d){if(b.getAttribute("enf")!=null&&!(a==null||a=="")&&!fpSpreadJS.isFormula(a)){var c=d?parseInt(a):fpSpreadJS.tryGetNumber(b,a,false,true);if(c!=null&&!isNaN(c))if(!d||c==parseFloat(a)){var e=fpSpreadJS.getNumberFormat(b,true);a=fpSpreadJS.formatNumber(c,"n",e)}}b.value=a}function DoubleCellType_isValid(k,a,g){if(a==null||a.length==0)return"";var c=_getFpRefProperty(k),i=c.getAttribute("MinimumValue"),h=c.getAttribute("MaximumValue"),b=true;if(g!=null&&g.getAttribute("efp")!=null){var j=fpSpreadJS.tryGetNumber(g,a);b=j!=null;if(b)b=_isDoubleInMinMax(j,i,h)}else{var e=c.getAttribute("decimalchar");if(e==null)e=".";var d=c.getAttribute("groupchar");if(d==null)d=",";a=trim(a);b=a.length==0||a.charAt(0)!=d;if(b){var f=a.indexOf(e);if(f>=0){f=a.indexOf(d,f);b=f<0}}if(b)a=fpSpreadJS.replaceStringAll(a,d,"");if(a.length==0)b=false;else if(b){var l=c.getAttribute("negsign"),m=c.getAttribute("possign");b=isDouble(a,e,l,m,i,h)}}return!b?c.error!=null?c.error:"Double":""}function DoubleCellType_getValue(b){var e=getCell(b,true),a=b.innerText;if(a==" "||trim(b.innerHTML)=="&nbsp;")return e.whiteSpace==null?"":" ";b=_getFpRefProperty(e);var d=b.groupchar;if(d==null)d=",";a=fpSpreadJS.replaceStringAll(a,d,"");if(a.charAt(0)=="("&&a.charAt(a.length-1)==")"){var c=b.getAttribute("negsign");if(c==null)c="-";a=c+a.substring(1,a.length-1)}return a}function DoubleCellType_setValue(c,a,b){var g=getCell(c,true),f=true,e=false;if(a!=null&&a!=""){if(b!=null&&b.getAttribute("efp")!=null&&!fpSpreadJS.isFormula(a)){var d=fpSpreadJS.tryGetNumber(b,a);if((!editing||a!=editingValue)&&d!=null){spreadView._ProcessNegativeRed(g,d);var j=fpSpreadJS.getNumberFormat(b),i=!(b.getAttribute("fp")!="1"),h=b.getAttribute("dd");c.innerText=fpSpreadJS.formatNumber(d,"d",j,i,h);return d}else f=false}else e=true;if(f)c.innerText=a;e&&spreadView._ProcessNegativeRed(g,DoubleCellType_getValue(c))}else c.innerHTML="&nbsp;";return a}function DoubleCellType_setEditorValueEditMode(b,a,h,f){if(b.getAttribute("efp")!=null&&!(a==null||a=="")&&!fpSpreadJS.isFormula(a)){var c=f?parseFloat(a):fpSpreadJS.tryGetNumber(b,a,false,true);if(c!=null&&!isNaN(c)){var g=fpSpreadJS.getNumberFormat(b,true),e=!(b.getAttribute("efp")!="1"),d=b.getAttribute("edd");a=fpSpreadJS.formatNumber(c,"d",g,e,d)}}b.value=a}function CurrencyCellType_isValid(l,a,h){if(a!=null&&a.length>0){var c=_getFpRefProperty(l),b=true,j=c.getAttribute("MinimumValue"),i=c.getAttribute("MaximumValue");if(h!=null&&h.getAttribute("efp")!=null){var k=fpSpreadJS.tryGetNumber(h,a,true);b=k!=null;if(b)b=_isDoubleInMinMax(k,j,i)}else{var f=c.getAttribute("currencychar");if(f==null)f="$";a=a.replace(f,"");var d=c.getAttribute("groupchar");if(d==null)d=",";var e=c.getAttribute("decimalchar");if(e==null)e=".";a=trim(a);b=a.length==0||a.charAt(0)!=d;if(b&&d!=""){var g=a.indexOf(e);if(g>=0){g=a.indexOf(d,g);b=g<0}}if(b)a=fpSpreadJS.replaceStringAll(a,d,"");if(a.length==0)b=false;else if(b){var m=c.getAttribute("negsign"),n=c.getAttribute("possign");b=isDouble(a,e,m,n,j,i)}}if(!b)return c.error!=null?c.error:"Currency ("+f+"100"+e+"10) "}return""}function isDouble(b,h,d,e,g,f){if(b==null||b.length==0)return true;b=trim(b);if(b.length==0)return true;if(d!=null)b=b.replace(d,"-");if(e!=null)b=b.replace(e,"+");if(b.charAt(b.length-1)=="-")b="-"+b.substring(0,b.length-1);var i=new RegExp("^\\s*([-\\+])?(\\d+)?(\\"+h+"(\\d+))?([eE]([-\\+])?(\\d+))?\\s*$"),a=b.match(i);if(a==null)return false;if((a[2]==null||a[2].length==0)&&(a[4]==null||a[4].length==0))return false;var c="";if(a[1]!=null&&a[1].length>0)c=a[1];if(a[2]!=null&&a[2].length>0)c+=a[2];else c+="0";if(a[4]!=null&&a[4].length>0)c+="."+a[4];if(a[6]!=null&&a[6].length>0){c+="E"+a[6];if(a[7]!=null)c+=a[7];else c+="0"}num=parseFloat(c);return isNaN(num)?false:_isDoubleInMinMax(num,g,f)}function _isDoubleInMinMax(f,c,b){var a=true;if(c!=null){var e=parseFloat(c);a=!isNaN(e)&&f>=e}if(a&&b!=null){var d=parseFloat(b);a=!isNaN(d)&&f<=d}return a}function CurrencyCellType_getValue(b){var g=getCell(b,true),a=b.innerText;if(a==" "||trim(b.innerHTML)=="&nbsp;")return g.whiteSpace==null?"":" ";b=_getFpRefProperty(g);var c=b.currencychar;if(c!=null){var f=b.document.createElement("SPAN");f.innerHTML=c;c=f.innerHTML}if(c==null)c="$";var e=b.groupchar;if(e==null)e=",";a=a.replace(c,"");a=fpSpreadJS.replaceStringAll(a,e,"");var d=b.getAttribute("negsign");if(d==null)d="-";if(a.charAt(0)=="("&&a.charAt(a.length-1)==")")a=d+a.substring(1,a.length-1);return a}function CurrencyCellType_setValue(b,a,c){var e=getCell(b,true);if(a!=null&&a!="")if(c!=null&&c.getAttribute("efp")!=null&&!fpSpreadJS.isFormula(a)){if(!editing||a!=editingValue){var d=fpSpreadJS.tryGetNumber(c,a,true);if(d!=null){spreadView._ProcessNegativeRed(e,d);var g=fpSpreadJS.getNumberFormat(c),f=!(c.getAttribute("fp")!="1");b.innerHTML=fpSpreadJS.formatNumber(d,"c",g,f);return d}else return b.innerHTML=a}}else{b.innerHTML=a.replace(" ","");spreadView._ProcessNegativeRed(e,CurrencyCellType_getValue(b))}else b.innerHTML="&nbsp;";return a}function CurrencyCellType_setEditorValueEditMode(b,a,g,e){if(b.getAttribute("efp")!=null&&!(a==null||a=="")&&!fpSpreadJS.isFormula(a)){var c=e?parseFloat(a):fpSpreadJS.tryGetNumber(b,a,true,true);if(c!=null&&!isNaN(c)){var f=fpSpreadJS.getNumberFormat(b,true),d=!(b.getAttribute("efp")!="1");a=fpSpreadJS.formatNumber(c,"c",f,d)}}b.value=a}function DateTimeCellType_setEditorValueEditMode(b,a,h,e){var g=getCell(b)||anchorCell,c=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,g);if(c&&c.SetEditorValue)return c.SetEditorValue(a,e);if((b.getAttribute("edf")!=null||b.getAttribute("ef")!=null)&&!(a==null||a==""))if(b.getAttribute("ignoreValid")!=null)a=b.getAttribute("editValue");else if(e){var d=Sys.CultureInfo.CurrentCulture,f=fpSpreadJS._parseDateExact(a,"yyyy/M/d",d)||fpSpreadJS._parseDateExact(a,"yyyy/M/d H:m:s:fff",d);if(f!=null)a=fpSpreadJS.formatDate(b,f,false)}b.value=a}function DateTimeCellType_isValid(b,c,d){var a=FarPoint.Web.Spread.CellTypeFactory.GetCellType(element,b);return a.IsValid(c,d)}function TextCellType_getValue(a){var b=getCell(a,false);if(b==null)return"";if(b.password!=null)return b!=null&&b.value!=null?b.value:"";else{if(a.firstChild!=null&&a.firstChild.tagName=="NOBR")a=a.firstChild;if(a.innerText==" "||trim(a.innerHTML)=="&nbsp;")return b.whiteSpace==null?"":" ";var c=typeof a.value!="undefined"?a.value:$$.utils.htmlDecode(a.innerHTML);if(c.length>1)c=c.replace(/\n\n$/g,"\n");return c}}function TextCellType_setValue(b,a){var d=getCell(b,true);if(d==null)return;var c=null;if(b.children)c=b.children;else c=b.childNodes;if(c.length>0&&c[0].tagName&&c[0].tagName.toUpperCase()=="NOBR"){var e=b;b=c[0];if(e.style.removeAttribute)e.style.removeAttribute("display");else e.style.removeProperty("display")}if(d.password!=null)if(a!=null&&a!=""){b.innerHTML="";for(var f=0;f<a.length;f++)b.innerHTML+="*";d.value=a}else{b.innerHTML="&nbsp;";d.value=""}else if(b.tagName=="INPUT"||b.tagName=="TEXTAREA"){if(a==null)a="";if(typeof b.maxLength!="undefined"&&b.maxLength>0)a=a.substring(0,b.maxLength);b.value=a}else if(a!=null&&a!=""){a=$$.utils.htmlEncode(a);if(a.length>3)a=a.replace(/<br>$/g,"<br><br>");b.innerHTML=a}else b.innerHTML="&nbsp;"}function TextCellType_isValid(c,f){var b=null,e=$$.j(c).find("INPUT,TEXTAREA");if(e.length>0)b=e.get(0);else{var g=getCellEditorID(c);if(g==null)return;b=c.document.getElementById(g)}var a=-1;if(b!=null&&typeof b.maxLength!="undefined")a=parseInt(b.maxLength);if(a>0&&f!=null&&f.length>a){var d=_getFpRefProperty(c);return d!=null&&d.getAttribute("error")!=null?d.getAttribute("error").replace("{0}",a):"The maximum text lengh is "+a}return""}function GeneralCellType_getValue(a){var c=getCell(a);if(c==null)return"";if(a.firstChild!=null&&a.firstChild.tagName=="NOBR")a=a.firstChild;if(trim(a.innerHTML)=="&nbsp;")return c.whiteSpace==null?"":" ";var b=a.value;if(a.tagName=="NOBR")b=c.value;if(typeof b=="undefined")if(isHeaderCell(c))b=trim(a.innerText);else b=$$.utils.htmlDecode(a.innerHTML);return b}function GeneralCellType_setValue(a,c){var e=getCell(a,true);spreadView._ProcessNegativeRed(e,c);var b=null;if(a.children)b=a.children;else b=a.childNodes;if(b.length>0&&b[0].tagName&&b[0].tagName.toUpperCase()=="NOBR"){var d=a;a=b[0];if(d.style.removeAttribute)d.style.removeAttribute("display");else d.style.removeProperty("display")}if(c!=null&&c!=""){c=$$.utils.htmlEncode(c);a.innerHTML=c}else a.innerHTML="&nbsp;"}function EmptyCellType_getValue(a){return GeneralCellType_getValue(a)}function RegExpCellType_isValid(a,c){if(c==null||a==null)return"";if(trim(c).length==0)return"";var b=a,e=a.FpRef;if(a.FpRef!=null)b=a.document.getElementById(e);if(b==null)b=window.document.getElementById(e);var d=b.getAttribute("fpexpression");if(d==null||d.length==0)return"";var g=new RegExp(d),f=c.match(g);return f!=null&&c==f[0]?"":b.getAttribute("error")}function ComboBoxCellType_setValue(b,d,i){var g=getCell(b,true);if(g==null)return;var f=g.getElementsByTagName("SELECT");if(f!=null&&f.length>0){f(0).value=d;return}var e=i.getCellEditorID(g),a=null;if(e!=null&&typeof e!="undefined"){a=i.getCellEditor(e,false);if(a!=null){a.value=d;if(a.selectedIndex>=0&&a.selectedIndex<a.options.length)d=a.options(a.selectedIndex).text;var c=null;if(b.children)c=b.children;else c=b.childNodes;if(c.length>0&&c[0].tagName&&c[0].tagName.toUpperCase()=="NOBR"){var h=b;b=c[0];if(h.style.removeAttribute)h.style.removeAttribute("display");else h.style.removeProperty("display")}if(d!=null&&d!="")b.innerText=d;else b.innerHTML="&nbsp;"}}}function ComboBoxCellType_getValue(g,h){var b=g.innerText,c=getCell(g,false);if(c==null)return null;if(b==" "&&c.specialValue!=null)b="";var f=c.getElementsByTagName("SELECT");if(f!=null&&f.length>0)return f(0).value;var e=h.getCellEditorID(c),a=null;if(e!=null&&typeof e!="undefined"){a=h.getCellEditor(e,false);if(a!=null&&a.options!=null)for(var i=a.options.length,d=0;d<i;d++)if(a.options(d).text==b)return a.options(d).value;return null}return b}function ComboBoxCellType_isValid(e,c){if(c==null||/^\s*$/g.test(c))return"";var a=e.getElementsByTagName("SELECT");if(a!=null&&a.length>0)a=a[0];else{var b=getCellEditorID(e);if(b!=null&&typeof b!="undefined")a=getCellEditor(b,true)}if(a!=null&&a.options!=null)for(var d=0;d<a.options.length;d++)if(c==a.options[d].value)return"";return"invalid"}function CheckBoxCellType_setFocus(b){var a=b.getElementsByTagName("INPUT");a!=null&&a.length>0&&a[0].type=="checkbox"&&a[0].focus()}function CheckBoxCellType_getCheckBoxEditor(b){if(b==null)return null;var a=b.getElementsByTagName("INPUT");return a!=null&&a.length>0&&a[0].type=="checkbox"?a[0]:null}function CheckBoxCellType_isValid(b,a){if(a==null)return"";a=trim(a);return a==""?"":a.toLowerCase()=="true"||a.toLowerCase()=="false"?"":"invalid value"}function CheckBoxCellType_getValue(a,b){return CheckBoxCellType_getEditorValue(a,b)}function CheckBoxCellType_getEditorValue(c){var b=getCell(c,true),a=CheckBoxCellType_getCheckBoxEditor(b);return a!=null&&a.checked?"true":"false"}function CheckBoxCellType_setValue(d,b){var c=getCell(d,true),a=CheckBoxCellType_getCheckBoxEditor(c);if(a!=null){a.checked=b!=null&&b.toLowerCase()=="true";return}}function ListBoxCellType_setEditorValue(a,c){if(a==null||c==null||c=="")return;for(var b=0;b<a.options.length;b++)if(trim(a.options[b].value)==trim(c)){a.options[b].selected=true;return}}function ListBoxCellType_setValue(b,f){var a=getCell(b,true);if(a==null)return;var g=$$.utils,e=g.firstTaggedChild(b,"TABLE",true);if(e==null)return;for(var d=e.rows,c=0;c<d.length;c++){var a=d(c).cells(0),h=trim(a.innerText);if(f!=null&&h==trim(f)){a.selected="true";if(typeof b.SelectedBackColor!="undefined")a.style.background=b.SelectedBackColor;if(typeof b.SelectedForeColor!="undefined")a.style.color=b.SelectedForeColor}else{a.style.background="";a.style.color="";a.selected=null}}}function ListBoxCellType_getValue(e){var f=getCell(e,true);if(f==null)return null;var d=$$.utils.firstTaggedChild(e,"TABLE",true);if(d==null)return null;for(var c=d.rows,a=0;a<c.length;a++){var b=c(a).cells(0);if(b.selected=="true")return trim(b.innerText)}return null}function RadioButtonListCellType_getValue(d){for(var c=getCell(d),b=c.getElementsByTagName("INPUT"),a=0;a<b.length;a++)if(b(a).tagName=="INPUT"&&b(a).checked)return b(a).value;return null}function RadioButtonListCellType_getEditorValue(a,b){return RadioButtonListCellType_getValue(a,b)}function RadioButtonListCellType_setValue(e,c){if(c!=null)c=trim(c);for(var d=getCell(e),b=d.getElementsByTagName("INPUT"),a=0;a<b.length;a++)if(b(a).tagName=="INPUT"&&c==trim(b(a).value)){b(a).checked=true;break}else if(b(a).checked)b(a).checked=false}function RadioButtonListCellType_setFocus(d){var c=getCell(d),b=c.getElementsByTagName("INPUT");if(b==null)return;for(var a=0;a<b.length;a++)if(b[a].type=="radio"&&b[a].checked){b[a].focus();return}for(var a=0;a<b.length;a++)if(b[a].type=="radio"){b[a].focus();return}}function HyperLinkCellType_getValue(b){var a=b.innerText;if(typeof a!="undefined"&&a!=null&&a.length>0){a=$$.utils.replaceAll(a,"\n","");a=trim(a)}else a="";return a}function ButtonCellType_getValue(b){var a=b.innerText;if(typeof a!="undefined"&&a!=null&&a.length>0){a=$$.utils.replaceAll(a,"\n","");a=trim(a)}else a="";return a}function TagCloudCellType_getValue(b){var a=b.innerText;if(typeof a!="undefined"&&a!=null&&a.length>0)a=$$.utils.htmlDecode(a);else a="";return a}function PercentCellType_getValue(l){var c=getCell(l),a=trim(c.innerText);if(a==null)return a;var b=c,g=c.FpRef;if(c.FpRef!=null)b=c.document.getElementById(g);if(b==null)b=window.document.getElementById(g);var e=b.percentchar;if(e==null)e="%";a=a.replace(e,"");var h=b.getAttribute("negsign"),i=b.getAttribute("possign"),d=b.groupchar;if(d==null)d=",";var f=a.length;while(true){a=a.replace(d,"");if(a.length==f)break;f=a.length}var k=a;if(h!=null)a=a.replace(h,"-");if(i!=null)a=a.replace(i,"+");var j=b.decimalchar;if(j!=null)a=a.replace(j,".");return!isNaN(a)?k:trim(c.innerText)}function PercentCellType_setValue(d,a){if(a!=null)a=trim(a);var e=getCell(d,true);spreadView._ProcessNegativeRed(e,a);if(a!=null&&a!=""){var b=getCell(d);if(b.FpRef!=null)b=b.document.getElementById(b.FpRef);var c=b.percentchar;if(c==null)c="%";a=a.replace(" ","");a=a.replace(c,"");d.innerText=a+c}else d.innerHTML="&nbsp;"}function PercentCellType_isValid(p,a){if(a!=null){var b=getCell(p),l=b.FpRef;if(b.FpRef!=null)b=b.document.getElementById(l);if(b==null)b=window.document.getElementById(l);var e=b.percentchar;if(e==null)e="%";a=a.replace(e,"");var h=b.groupchar;if(h==null)h=",";var k=a.length;while(true){a=a.replace(h,"");if(a.length==k)break;k=a.length}var o=a,f=b.getAttribute("negsign"),g=b.getAttribute("possign");if(f!=null)a=a.replace(f,"-");if(g!=null)a=a.replace(g,"+");var d=b.decimalchar;if(d!=null)a=a.replace(d,".");var c=!isNaN(a);if(c){var j=b.getAttribute("MinimumValue"),i=b.getAttribute("MaximumValue");if(j!=null||i!=null){var n=parseFloat(j),m=parseFloat(i);c=!isNaN(n)&&!isNaN(m);if(c){if(d==null)d=".";c=isDouble(o,d,f,g,n*100,m*100)}}}if(!c)return b.error!=null?b.error:"Percent: (ex, 10"+e+")"}return""}function MultiColumnComboBoxCellType_setValue(rd,val,ss){var cell=getCell(rd,true);if(cell==null)return;var mccbId=getMccbID(cell,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");if(editorObj!=null){if(editorObj.GetUseValue()==1)editorObj.SetValueToDataColumn(val);else editorObj.SetValueToTextColumn(val);if((!editing||rd.getAttribute("FpEditor")==null)&&editorObj.GetShowButton()!=1){var text=val;if(val!=null)text=editorObj.GetCurrentText(cell);if(text!=null&&text!="")rd.innerText=text;else rd.innerHTML="&nbsp;"}}}}function MultiColumnComboBoxCellType_blur(a){if(a==null)return;var b=$$(a).firstChild("INPUT");b!=null&&b.blur()}function getMccbID(d,e){var a=e.getCellEditorID(d);if(a!=null&&typeof a!="undefined"){var b=e.getCellEditor(a,true);if(b!=null&&b.MccbId)return b.MccbId}var c=$$(d).getChildTag("DIV","MccbId");return c!=null?c.MccbId:null}function MultiColumnComboBoxCellType_getValue(rd,ss){var cl=getCell(rd,true);if(cl==null)return null;var mccbId=getMccbID(cl,ss);if(mccbId!=null){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(mccbId);var editorObj=eval(mccbId+"_Obj");if(editorObj!=null){editorObj.Value=null;return editorObj.GetCurrentValue(cl)}}return null}function MultiColumnComboBoxCellType_getEditorValue(d){var c=getCell(d,true);if(c==null)return;var a=c.getElementsByTagName("INPUT");if(a!=null&&a.length>0){var b=a[0];return b.getAttribute("UseValue")==1?b.DataValue:b.value}return null}function MultiColumnComboBoxCellType_setFocus(rd){var cell=getCell(rd);if(cell==null)return;var mccDiv=$$(cell).getChildTag("DIV","MccbId");if(mccDiv!=null)try{var editorObj=eval(mccDiv.MccbId+"_Obj");editorObj!=null&&editorObj.FocusForEdit!=null&&editorObj.FocusForEdit()}catch(e){}}function MultiColumnComboBoxCellType_setEditorValue(rd,editorValue,ss){var cell=getCell(rd,true);if(cell==null)return;var editorID=ss.getCellEditorID(cell),editor=null;if(editorID!=null&&typeof editorID!="undefined"){editor=ss.getCellEditor(editorID,true);if(editor!=null&&editor.MccbId){FarPoint.System.WebControl.MultiColumnComboBoxCellType.CheckInit(editor.MccbId);var editorObj=eval(editor.MccbId+"_Obj");if(editorObj!=null&&editorObj.SetValueToDataColumn!=null)if(editorObj.GetUseValue()==1)editorObj.SetValueToDataColumn(editorValue);else editorObj.SetValueToTextColumn(editorValue)}}}function MultiColumnComboBoxCellType_isHandleEvent(event,editingCell){var cell=editingCell||anchorCell;if(cell==null)return false;if(event.type!="mousedown"&&event.type!="focusin")return false;var mccDiv=$$(cell).getChildTag("DIV","MccbId");if(mccDiv==null)return false;var editorObj=null;try{var editorObj=eval(mccDiv.MccbId+"_Obj")}catch(e){}if(editorObj!=null){var externalEditor=editorObj.getContainerDiv();if(isChild(event.srcElement,externalEditor))return true}return false}function inactiveAllChart(a){activeChartObj=a.GetActiveChartObj();if(activeChartObj!=null){activeChartObj.normalChart();activeChartObj.inactiveChart();activeChartObj=null}}function RefreshChart(){if(editing)return;saveData();var a=element.ajax!="false";a&&syncData(element.name,"RefreshChart,"+activeChartObj.chartID)}function GetActiveChartObj(){return activeChartObj}function GetActiveChart(){return activeChartObj!=null?activeChartObj.container:null}function SetActiveChartObj(a){activeChartObj=a;fireSelectionChangedEvent(element)}function SetActiveChart(id){var chartContainerID=getChartByChartId(id);if(chartContainerID==null)return;var chartObj=null;try{chartObj=eval(chartContainerID+"_Obj")}catch(e){}if(chartObj!=null)if(!chartObj.isActived){editing&&EndEdit();ClearSelection();chartObj.inactiveChart();chartObj.activeChart();var btn=getCmdBtn("Update");btn!=null&&updateCmdBtnState(btn,false);btn=getCmdBtn("Copy");btn!=null&&updateCmdBtnState(btn,true);btn=getCmdBtn("Paste");btn!=null&&updateCmdBtnState(btn,true);btn=getCmdBtn("Clear");btn!=null&&updateCmdBtnState(btn,true);dirty=true;RemoveSelection(-1,-1,-1,-1)}}function getChartByChartId(d){for(var c=element.getElementsByTagName("DIV"),b=0;b<c.length;b++){var a=c[b];if(a.id.indexOf("_chartContainer")>0&&a.getAttribute("serverID")==d)return a.id}return null}function updateChartURL(a){if(activeChartObj!=null)activeChartObj.getChart().src=a.src+"#"+Math.random()}function updateChartAllImg(){for(var items=element.getElementsByTagName("DIV"),i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0)if(item.getAttribute("selectChart")!="false"){var chartObj=eval(item.id+"_Obj");chartObj.init();chartObj.updateChartImgitem()}}}function initChartObj(){for(var items=element.getElementsByTagName("DIV"),initScripts=[],i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0){var js=item.id+'_Obj = new FarPoint.Web.Spread.SpreadChart(window.document.getElementById("'+element.id+'"),window.document.getElementById("'+item.id+'"));'+item.id+"_Obj.init();";initScripts.push(js)}}for(var i=0;i<initScripts.length;i++){var spread=getTopSpread(element);spread.resizing=true;eval(initScripts[i]);spread.resizing=false}return initScripts.length>0}function getChartObj(b){if(b==null)return null;var a=b;while(a!=null&&a.tagName!="BODY"&&a.tagName!="HTML"){if(a.id&&a.id.indexOf("_chartContainer")>0)return a.getChartObj();a=a.parentNode}return null}function chartDispose(){for(var items=element.getElementsByTagName("DIV"),i=0;i<items.length;i++){var item=items[i];if(item.id.indexOf("_chartContainer")>0)if(item.getAttribute("selectChart")!="false"){var chartObj=eval(item.id+"_Obj");chartObj.dispose()}}activeChartObj=null}function GetCurrentPageIndex(){var a=parseInt(element.getAttribute("currentPageIndex"));return a!=NaN?a:0}function fireColWidthChangedEvent(b,c,d){var a=window.document.createEventObject();a.sizeHeader=b;a.col=c;a.width=d;a.spread=element;element.fireSpreadEvent("ColWidthChanged",a)}function fireActiveCellChangingEvent(c,f,b,e){var g=getTopSpread(element),d=element.getSpreadView();if(d.IsSuspendedAction(g,GCWS.Actions.ACTIVE_CELL_CHANGING))return false;var a=window.document.createEventObject();a.spread=b;a.cancel=false;a.cmdID=element.id;if(b!=null)a.row=b.GetSheetIndex(c);else a.row=element.GetSheetIndex(c);a.col=f;if(element.layoutMode)a.innerRow=e;element.fireSpreadEvent("ActiveCellChanging",a);return a.cancel}function fireActiveCellChangedEvent(f,e,g,d,c){var h=getTopSpread(element),b=element.getSpreadView();if(b.IsSuspendedAction(h,GCWS.Actions.ACTIVE_CELL_CHANGED))return;var a=window.document.createEventObject();a.spread=g;a.cmdID=element.id;a.row=a.Row=f;a.col=a.Col=e;if(element.layoutMode)a.innerRow=a.InnerRow=d;element.fireSpreadEvent("ActiveCellChanged",a);b.EditModePermanent&&!c&&element.doGetFocus()}function fireDataChangedEvent(b,f,e,d,c){var a=window.document.createEventObject();a.spread=e;a.cell=b;a.cellValue=f;a.row=d;a.col=c;element.fireSpreadEvent("DataChanged",a)}function fireSelectionChangedEvent(b){if($$.j(element).data("ignoreFireSelectionChanged"))return;var a=window.document.createEventObject();a.spread=b;element.fireSpreadEvent("SelectionChanged",a)}function fireEditStartEvent(d,c,b,e){var a=window.document.createEventObject();a.spread=e;a.cell=b;a.row=d;a.col=c;a.cancel=false;element.fireSpreadEvent("EditStart",a);return a.cancel}function fireEditStoppedEvent(b,c){var a=window.document.createEventObject();a.spread=c;a.cell=b;element.fireSpreadEvent("EditStopped",a)}function fireCallBackStartEvent(a){element.fireSpreadEvent("CallBackStart",a);return a.cancel}function fireCallBackStoppedEvent(b,c){var a=window.document.createEventObject();a.command=b;a.spread=c;element.fireSpreadEvent("CallBackStopped",a)}function fireOperationEndEvent(){fireAutoFilterColumnCompleted()}function fireAutoFilteringColumn(c,b){var a=window.document.createEventObject();a.cancel=false;a.col=c;a.spread=element;a.filterString=b;element.fireSpreadEvent("AutoFilteringColumn",a);return a}function fireAutoFilterColumnCompleted(b){if(element.isFiltering=="true"&&(b==null||b==element.FilteringString||GrapeCity.Web.Spread.FilterEditor.IsFilterCommand(b)))if(element.isFilteringCancel!="true"){var a=window.document.createEventObject();a.spread=element;a.col=element.FilteringCol;a.filterString=element.FilteringString;element.fireSpreadEvent("AutoFilteredColumn",a)}}function fireOnErrorMessage(f,b,d,e,c){var a=window.document.createEventObject();a.spread=element;a.row=e;a.col=c;a.errorMessage=d;a.isValid=b;element.fireSpreadEvent("ErrorMessageShown",a)}function fireScrollEvent(c,b){var a=window.document.createEventObject();a.spread=element;a.vertical=c;a.horizontal=b;element.fireSpreadEvent("Scroll",a)}function fireCopyData(){var a=window.document.createEventObject();a.spread=element;a.includeColHeader=false;element.fireSpreadEvent("CopyData",a);return a}function fireColumnDragMove(b){var a=window.document.createEventObject();a.cancel=false;a.col=b;a.spread=element;element.fireSpreadEvent("ColumnDragMove",a);return a}function fireColumnDragMoveCompleted(b){var a=window.document.createEventObject();a.col=b;a.spread=element;element.fireSpreadEvent("ColumnDragMoveCompleted",a)}function fireRowHeightChanged(b,c,d){var a=window.document.createEventObject();a.spread=element;a.sizeHeader=b;a.row=c;a.height=d;element.fireSpreadEvent("RowHeightChanged",a)}function fireSpreadEvent(a,b){element.fireSpreadEvent(a,b)}this.initElementBehavior=function(){element.Copy=Copy;element.Paste=Paste;element.Clear=Clear;element.Update=Update;element.Cancel=Cancel;element.Add=Add;element.Insert=Insert;element.Delete=Delete;element.Prev=Prev;element.Next=Next;element.StartEdit=StartEdit;element.EndEdit=EndEdit;element.Print=Print;element.PrintPDF=PrintPDF;element.GetSelectedRange=GetSelectedRange;element.SetSelectedRange=SetSelectedRange;element.ClearSelection=ClearSelection;element.GetSelectedRanges=GetSelectedRanges;element.AddSelection=AddSelection;element.SuspendLayout=SuspendLayout;element.ResumeLayout=ResumeLayout;element.Cells=Cells;element.Rows=Rows;element.Columns=Columns;element.GetTitleInfo=GetTitleInfo;element.ShowMessage=ShowMessage;element.HideMessage=HideMessage;element.SetActiveSpreadID=setActiveSpreadID;element.SetActiveChart=SetActiveChart;element.GetActiveChart=GetActiveChart;element.SetActiveCell=SetActiveCell;element.GetCellByRowCol=GetCellByRowCol;element.GetValue=GetValue;element.SetValue=SetValue;element.GetFormula=GetFormula;element.SetFormula=SetFormula;element.GetHiddenCellValue=GetHiddenCellValue;element.SetHiddenCellValue=SetHiddenCellValue;element.GetHiddenValue=GetHiddenValue;element.SetHiddenValue=SetHiddenValue;element.GetSheetRowIndex=GetSheetRowIndex;element.GetSheetColIndex=GetSheetColIndex;element.GetTopRowIndex=GetTopRowIndex;element.GetLeftColIndex=GetLeftColIndex;element.GetRowByKey=getRowByKey2;element.GetColByKey=getColByKey2;element.GetRowKeyFromRow=getRowKeyFromRow2;element.GetColKeyFromCol=getColKeyFromCol3;element.GetRowCount=GetRowCount;element.GetColCount=GetColCount;element.GetParentSpread=getParentSpread;element.GetChildSpread=GetChildSpread;element.GetChildSpreads=GetChildSpreads;element.GetSpread=getSpreadControl;element.GetParentRowIndex=GetParentRowIndex;element.GetActiveChildSheetView=GetActiveChildSheetView;element.UpdatePostbackData=UpdatePostbackData;element.SizeToFit=SizeToFit;element.SetColWidth=setColWidth;element.ExpandRow=ExpandRow;element.SortColumn=SortColumn;element.CallBack=CallBack;element.AddKeyMap=AddKeyMap;element.RemoveKeyMap=RemoveKeyMap;element.MoveToPrevCell=MoveToPrevCell;element.MoveToNextCell=MoveToNextCell;element.MoveToNextRow=MoveToNextRow;element.MoveToPrevRow=MoveToPrevRow;element.MoveToFirstColumn=MoveToFirstColumn;element.MoveToLastColumn=MoveToLastColumn;element.CopyLikeExcel=CopyLikeExcel;element.CutLikeExcel=CutLikeExcel;element.PasteLikeExcel=PasteLikeExcel;element.ScrollTo=ScrollTo;element.GetTotalRowCount=GetTotalRowCount;element.GetPageCount=GetPageCount;element.Edit=Edit;element.IsValid=IsValid;element.LoadData=LoadData;element.GetCurrentPageIndex=GetCurrentPageIndex;this.getViewport0=getViewport0;this.getViewport1=getViewport1;this.getViewport2=getViewport2;this.getViewport=getViewport;this.getViewportHolder=getViewportHolder;this.getColFooter=getColFooter;this.getFrozColFooter=getFrozColFooter;this.getColHeader=getColHeader;this.getFrozColHeader=getFrozColHeader;this.getRowHeader=getRowHeader;this.getFrozRowHeader=getFrozRowHeader;this.GetRowCountInternal=GetRowCountInternal;this.getRowKeyFromRow=getRowKeyFromRow;this.getColKeyFromCol=getColKeyFromCol;this.getTitleBar=getTitleBar;this.getSubTitleBar=getSubTitleBar;this.IsChildSpreadRow=IsChildSpreadRow;this.frzRowCount=frzRowCount;this.frzColCount=frzColCount;this.getRowKeyFromCell=getRowKeyFromCell;this.getColKeyFromCell2=getColKeyFromCell2;this.getColFromCell=getColFromCell;this.getColGroup=getColGroup;this.GetSelectedRanges=GetSelectedRanges;this.GetSelectedRange=GetSelectedRange;this.getSelection=getSelection;this.updateSelectionViewIndexes=updateSelectionViewIndexes;this.getAttributeInternal=getAttributeInternal;this.getRowFromCell=getRowFromCell;this.getViewportFromCell=getViewportFromCell;this.getCellFromRowCol=getCellFromRowCol;this.getRowByKey=getRowByKey;this.getColByKey=getColByKey;this.getLeadingCellRow=getLeadingCellRow;this.getLeadingCellCol=getLeadingCellCol;this.getTopSpread=getTopSpread;this.isChild=isChild;this.getScrollvp=getScrollvp;this.getCell=getCell;this.getCorner=getCorner;this.getFooterCorner=getFooterCorner;this.setActiveSpread=setActiveSpread;this.isWorking=isWorking;this.isInitialized=isInitialized;this.findContentTag=findContentTag;this.moveDown=moveDown;this.saveScrollbarState=saveScrollbarState;this.saveData=saveData;this.syncData=syncData;this.GetSheetIndex=GetSheetIndex;this.setFpPostOn=setFpPostOn;this.getSpreadControl=getSpreadControl;this.openWaitMsg=openWaitMsg;this.closeWaitMsg=closeWaitMsg;this.GetColCount=GetColCount;this.processResize=processResize;this.getEditor=getEditor;this.setEditorFocus=setEditorFocus;this.initSelection=initSelection;this.dispose=dispose;this.init=init;this.focus=focus;this.focus2=focus2;this.getMccbID=getMccbID;this.syncRowHeaderWidth=syncRowHeaderWidth;this.sizeSpread=sizeSpread;this.initLayout=initLayout;this.getCommandBar=getCommandBar;this.getPager1=getPager1;this.getPager2=getPager2;this.getHierBar=getHierBar;this.getPreferredCellWidth=getPreferredCellWidth;this.getActiveRow=getActiveRow;this.getActiveCol=getActiveCol;this.GetPageActiveSpread=GetPageActiveSpread;this.ClearSelection=ClearSelection;this.select=select;this.selectRow=selectRow;this.selectColumn=selectColumn;this.syncColSelection=syncColSelection;this.isColSelected=isColSelected;this.getHeaderCellFromRowCol=getHeaderCellFromRowCol;this.setValidatorPos=setValidatorPos;this.showMsg=showMsg;this.getSpanCell=getSpanCell;this.getSpanCells=getSpanCells;this.inactiveAllChart=inactiveAllChart;this.DoEndEdit=DoEndEdit;this.setTextBoxFocus=setTextBoxFocus;this.GetActiveChartObj=GetActiveChartObj;this.isSmartPaint=isSmartPaint;this.getDummy=getDummy;this.getNoRow=getNoRow;this.hideSelectionBlock=hideSelectionBlock;this.setActiveField=setActiveField;this.setAnchorCell=setAnchorCell;this.setActiveRow=setActiveRow;this.setActiveCol=setActiveCol;this.SetActiveSpreadID=setActiveSpreadID;this.paintAnchorCell=paintAnchorCell;this.saveAnchorCell=saveAnchorCell;this.findAnchorCell=findAnchorCell;this.getCellType=getCellType;this.getCellType2=getCellType2;this.paintSelections=paintSelections;this.paintSelection=paintSelection;this.paintMultipleRowSelection=paintMultipleRowSelection;this.paintHeaderSelection=paintHeaderSelection;this.scrollToCell=scrollToCell;this.scrollView=scrollView;this.paintSelectedCell=paintSelectedCell;this.getParentSpread=getParentSpread;this.rangeIntersection=rangeIntersection;this.GetActiveChartObj=GetActiveChartObj;this.mouseDown=mouseDown;this.mouseUp=mouseUp;this.mouseMove=mouseMove;this.startHandlingDocumentMouse=startHandlingDocumentMouse;this.stopHandlingDocumentMouse=stopHandlingDocumentMouse;this.getSizeColumn=getSizeColumn;this.getSizeRow=getSizeRow;this.paintFocusRect=paintFocusRect;this.hideFocusBorder=hideFocusBorder;this.dblclick=dblclick;this.getGroupBar=getGroupBar;this.spreadActive=spreadActive;this.doGetFocus=doGetFocus;this.prepairEditCell=prepairEditCell;this.processEditMode=processEditMode;this.correctFocusOnActiveCell=function(b,a){fpSpreadJS.correctFocusOnActiveCell(b||anchorCell,a)};this.getUIViewportList=function(){return vpList};this.getUIViewport2List=function(){return vp2List};this.getUIRowHeaderList=function(){return rhList};this.translateKey=translateKey;this.resetBlurFlag=resetBlurFlag;this.setIgnoreBlur=function(a){ignoreBlur=a};this.getEditorFocusFunction=function(a){return getFunction(a+"_setFocus")};this.getRangeFromNode=getRangeFromNode;this.isDragSlideBar=function(){return dragSlideBar};this.createTextbox=createTextbox;this.IsInRowEditTemplate=IsInRowEditTemplate;this.GetChildSpreads=GetChildSpreads;this.getChartObj=getChartObj;this.setActiveSpread=setActiveSpread;this.setActiveSpreadManually=setActiveSpreadManually;this.getColKeyFromCell=getColKeyFromCell;this.hasChart=hasChart;this.anyReadOnlyCell=anyReadOnlyCell;this.getClipboardData=getClipboardData;this.getCorner=getCorner;this.getCellEditorID=getCellEditorID;this.getCellEditor=getCellEditor;this.getValueFromRender=getValueFromRender;this.getFormulaFromCell=getFormulaFromCell;this.getRender=getRender;this.setEditorValue=setEditorValue;this.isDirty=function(){return dirty};this.fpCloneNode=fpCloneNode;this.createSelectionNode=createSelectionNode;this.getElementById=getElementById;this.checkTextEditorSelect=checkTextEditorSelect;this.getAttribute=function(a){return element.getAttribute(a)};this._getFpRefProperty=_getFpRefProperty;this.fireColWidthChangedEvent=fireColWidthChangedEvent;this.fireActiveCellChangingEvent=fireActiveCellChangingEvent;this.fireActiveCellChangedEvent=fireActiveCellChangedEvent;this.fireDataChangedEvent=fireDataChangedEvent;this.fireSelectionChangedEvent=fireSelectionChangedEvent;this.fireEditStartEvent=fireEditStartEvent;this.fireEditStoppedEvent=fireEditStoppedEvent;this.fireCallBackStartEvent=fireCallBackStartEvent;this.fireCallBackStoppedEvent=fireCallBackStoppedEvent;this.fireOperationEndEvent=fireOperationEndEvent;this.fireAutoFilteringColumn=fireAutoFilteringColumn;this.fireAutoFilterColumnCompleted=fireAutoFilterColumnCompleted;this.fireOnErrorMessage=fireOnErrorMessage;this.fireScrollEvent=fireScrollEvent;this.fireCopyData=fireCopyData;this.fireColumnDragMove=fireColumnDragMove;this.fireColumnDragMoveCompleted=fireColumnDragMoveCompleted;this.fireRowHeightChanged=fireRowHeightChanged;this.fireSpreadEvent=fireSpreadEvent};init.apply(this);return this};GrapeCity.Web.Spread.FpSpread.CreateBehavior=function(a){return a&&$$.j.contains(window.document.body,a)?new GrapeCity.Web.Spread.FpSpread(a):null}