//
//	  Copyright (C) 2003-2014 GrapeCity Inc.	All rights reserved.
//

if(typeof GrapeCity=="undefined")GrapeCity={};if(!GrapeCity.Web)GrapeCity.Web={};if(!GrapeCity.Web.Spread)GrapeCity.Web.Spread={};var GCWS=GrapeCity.Web.Spread;GCWS.SpreadView=function(b){this.IsInitialized=false;this._isDataModelLoaded=false;this.Spread=b;this.document=$$.browser.ie&&$$.browser.version<10?this.Spread.document:document;this.AllRowsLoaded=this.GetAttribute("AllRowsLoaded")=="true";this.IsLoadOnDemand=this.GetAttribute("loadOnDemand")=="true";this.Options={ReplaceFocusBehavior:false,ReplacePaintSelection:false,UseQuadTree:false};this.ActiveSpread=null;var c=b.getParentSpread?b.getParentSpread():b.GetParentSpread(),d=b.fpSpreadJS.context;this.Parent=c==null?null:c.getSpreadView==null?null:c.getSpreadView();this.IsRoot=c==null;this.ActiveColumn=-1;this.ActiveRow=-1;this.ActiveLayoutRow=-1;this.TopRow=-1;this.LeftColumn=-1;this.Height=0;this.Width=0;this.ScrollTop=0;this.ScrollLeft=0;this.AutoSize=false;this.EditModePermanent=this.Spread.getAttribute("EditModePermanent")=="true";this.Focused=false;this.IsRowLayoutMode=this.Spread.getAttribute("layoutMode")=="RowTemplateLayoutMode";this.LayoutRowCount=this.IsRowLayoutMode?parseInt(this.Spread.getAttribute("layoutRowCount"),10):-1;this.LayoutColumnCount=this.IsRowLayoutMode?d.GetColCount():-1;this.HasPreviewRow=false;var a;switch(this.Spread.getAttribute("OperationMode")){case"ReadOnly":a=$$.OperationModes.READ_ONLY;break;case"RowMode":a=$$.OperationModes.ROW_MODE;break;case"SingleSelect":a=$$.OperationModes.SINGLE_SELECT;break;case"MultiSelect":a=$$.OperationModes.MULTI_SELECT;break;case"ExtendedSelect":a=$$.OperationModes.EXTENDED_SELECT;break;default:a=$$.OperationModes.NORMAL}this.OperationMode=a;var j=this.Spread.getAttribute("selectionBlockOptions");this.SelectionBlockOptions=j!=null?parseInt(this.Spread.getAttribute("selectionBlockOptions")):GCWS.SelectionBlockOptions.Cells|GCWS.SelectionBlockOptions.Rows|GCWS.SelectionBlockOptions.Columns|GCWS.SelectionBlockOptions.Sheet;this.ShowHeaderSelection=b.getTopSpread(b).getAttribute("ShowHeaderSelection")!="false";this.AllowColumnMove=this.Spread.getAttribute("colMove")?true:false;this.AllowGroup=this.Spread.getAttribute("allowGroup")?true:false;this.AllowSort=this.Spread.getAttribute("allowSort")?true:false;this.EnableRowEditTemplate=a==$$.OperationModes.ROW_MODE&&this.Spread.getAttribute("EnableRowEditTemplate")=="true";this.Viewport0=b.getViewport0();this.Viewport1=b.getViewport1();this.Viewport2=b.getViewport2();this.Viewport=b.getViewport();this.IsMultiColumnComboBox=this.Spread.getAttribute("mcctCellType")=="true";this._IsInitScrollbarState=this.IsMultiColumnComboBox?true:false;this.Viewports=[this.Viewport0,this.Viewport1,this.Viewport2,this.Viewport];this.RowHeaders=[this.Spread.getFrozRowHeader(),this.Spread.getRowHeader()];this.ColumnHeaders=[this.Spread.getFrozColHeader(),this.Spread.getColHeader()];this.ColumnFooters=[this.Spread.getFrozColFooter(),this.Spread.getColFooter()];$$.utils.cleanArray(this.Viewports,this.RowHeaders,this.ColumnHeaders,this.ColumnFooters);if(this.Viewports.length==0)this.Viewports=null;if(this.RowHeaders.length==0)this.RowHeaders=null;if(this.ColumnHeaders.length==0)this.ColumnHeaders=null;if(this.ColumnFooters.length==0)this.ColumnFooters=null;var g=this.Viewports[0]||this.RowHeaders[0]||this.ColumnHeaders[0]||this.ColumnFooters[0];this.CellSpacing=g!=null?parseInt(g.cellSpacing):0;this.ViewRowCount=this._GetViewRowCount();this.FilterBarRowCount=0;if(this.ColumnHeaders!=null)for(var h=this.ColumnHeaders[0],f=h.rows.length-1;f>=0;f--)if(h.rows[f].getAttribute("FpSpread")=="fb")this.FilterBarRowCount++;else break;this.RowHeader=new GCWS.RowHeader(this);this.ColumnHeader=new GCWS.ColumnHeader(this);this.Corner=new GCWS.SheetCorner(this);this.ColumnFooter=new GCWS.ColumnFooter(this);this.CommandBar=c==null?new GrapeCity.Web.Spread.CommandBar(this,d.getCommandBar()):null;this.Pager=new GCWS.Pager(this);this.TitleBar=new GCWS.TitleBar(this);this.SelectionModel=new GCWS.SelectionModel(this);this.SpanModel=new GCWS.SpanModel(this);this.FrozenTableColumnCount=d.frzColCount();this.FrozenTableRowCount=d.frzRowCount();this.FrozenRowCount=0;this.FrozenColumnCount=this.FrozenTableColumnCount;this.AllowVirtualScrollPaging=this.Spread.getAttribute("virtualPaging")=="true";var e=$$.OperationModes;this._IsOnlySelectRow=a==e.SINGLE_SELECT||a==e.MULTI_SELECT||a==e.EXTENDED_SELECT;this._IsFullRowSelectable=this._IsOnlySelectRow||a==e.ROW_MODE;this._focusRects=null;this.CDF=null;this.ContextMenus=null;this.ActiveContextMenu=null;this.Dialogs=[];this.IsAjaxEnabled=this.Spread.getAttribute("ajax")!="false";this.ClientAutoSize=this.GetAttribute("ClientAutoSize")=="True";this.ActiveDialog=null;var i=this.__GetSpreadTextBox();this.TabIndex=c==null?i!=null?i.tabIndex:this.Spread.tabIndex:-1;this.Style=new GCWS.StyleManipulator;this.ManagedObjects=[];if(this.IsEnablejQueryTheme())this.JQueryThemeSupporter=new GCWS.JQueryThemeSupporter;this.__InDesign=this.Spread.getAttribute("inDesign")!=null;this._ignoreMenu=false;this._enableNewModel=!$$.browser.ie||$$.browser.ieversion>=10&&($$.browser.version==5||$$.browser.version>=10);if(this.IsMultiBrowserMode()){this.GroupBar=c==null&&FarPoint.Web.Spread.GroupBar?new FarPoint.Web.Spread.GroupBar(this,d.getGroupBar()):null;this.EventTracker=FarPoint.Web.Spread.EventTracker?new FarPoint.Web.Spread.EventTracker(this):null;this.EventHandlers=FarPoint.Web.Spread.EventHandlers?new FarPoint.Web.Spread.EventHandlers:null;this.CallBacks=FarPoint.Web.Spread.CallBacks?new FarPoint.Web.Spread.CallBacks:null}this.CommandBar&&this.RegisterManagedObject(this.CommandBar);if(Object.defineProperty)try{!GCWS.SpreadView.prototype.hasOwnProperty("FilterBarHeight")&&Object.defineProperty(GCWS.SpreadView.prototype,"FilterBarHeight",{"get":function(){for(var b=0,c=this.ColumnHeaders[0],a=c.rows.length-1,d=a-this.FilterBarRowCount;a>d;a--){b+=c.rows[a].offsetHeight;b+=this.CellSpacing}return b},enumerable:true,configurable:true})}catch(k){}!this.IsMultiBrowserMode()&&this.LoadChildSpreadViews();this.restricAutoSize=false;this.ApplyDefaultCssStyles()};GrapeCity.Web.Spread.SpreadView.prototype={TOP:0,RIGHT:1,BOTTOM:2,LEFT:3,CSS_STYLE_RULE:1,CSS_IMPORT_RULE:3,LOCATION_TRACK_INTERVAL:250,LOCATION_TRACK_INTERVAL_TYPE:"TrackingLocation",GetAttribute:function(b){var a=this.Spread[b];if(a==null)a=this.Spread.getAttributeInternal?this.Spread.getAttributeInternal(b):this.Spread.getAttribute(b);return a},ActivateSpread:function(a){var d=this.GetActiveSpread(true);if(d!=a){var j,l,b;if(d!=null){b=d.getSpreadView();var h=b.GetSpreadContext();if(b.IsRetainSelection()&&b.IsInTouchMode()&&(b.GetEditingSpread()!=null||b.GetSpreadContext().getEditor(d.getAnchorCell())!=null))j=a==null||a.getSpreadView().GetHostSpread()!=d?b.TryStopEditing():false;b.UnregisterTimeoutTask("ShowHideContainer","EditorSelectAllText","CorrectFocusOnActiveCell");h.setActiveField(false);h.SetActiveSpreadID(d,"","",false);if(h.isInitialized()&&(!this.IsMultiColumnComboBox||d!=this.GetHostSpread())){$$.utils.contains(window.document.body,d)&&h.hideSelectionBlock();!$$.browser.ie&&b.ShowEditingFilterIndicator(false)}var k=null;if(b.IsMultiColumnComboBox&&(a==null||(k=b.GetHostSpread())!=null&&k.getAttribute("FpSpread")=="Spread"&&a.getSpreadView().GetTopSpreadView()!=k.getSpreadView().GetTopSpreadView()))if(b.Spread.getAttribute("EnableClientScript")!="0"){var o=b.GetHostSpread().getSpreadView();o.GetSpreadContext().hideSelectionBlock();!$$.browser.ie&&o.ShowEditingFilterIndicator(false)}if(this.IsInTouchMode()){var q=a!=null&&b.GetTopSpreadView()==a.getSpreadView().GetTopSpreadView();if(q){if(b.IsInTouchMode()){b.Touch.OnSpreadDeactivated();b.Touch.ResizeLocation=null;l=true}b.HideFocusRectangle();j=false}$$.browser.webkit&&(!q||a==null)&&h.switchHiddenTextBox(true,true)}if(!b.IsMultiColumnComboBox&&b.Parent!=null){var m=b.GetTopSpreadView();if(m.Spread!=a){var s=m.GetSpreadContext();s.SetActiveSpreadID(m.Spread,"",d.id)}}}var g=$$.browser.mb;if(a!=null){var c=a.getSpreadView?a.getSpreadView():null;$$.browser.webkit&&this.EditModePermanent&&c.GetSpreadContext().createTextbox();if(c!=null){var i=c.GetSpreadContext().getTopSpread(a),e=i.GetActiveChildSheetView()||i;if(e&&(e.getSpreadView().IsInTouchMode()||g||$$.browser.ieversion>=10)&&e.id!=a.id){e.ClearSelection(false,null,false);if(e.getSpreadView().IsInTouchMode()){var n=e.getSpreadView().Touch;n.HideTouchHandles();n.ResizeLocation=null}}i.getSpreadView().GetSpreadContext().SetActiveSpreadID(i,a.id,a.id,false);c.GetSpreadContext().setActiveField(true);g&&!a.isEditing()&&c.GetCommandBar().UpdateCopyCutPaste();if(a.isInTouchMode&&c.Touch){c.Touch.IsInTouchMode=true;delete a.isInTouchMode}l|=!c.IsRetainSelection()&&(g||c.IsInTouchMode());if(c.Touch&&c.Touch.ResizeLocation!=null&&c._GetActiveCellRange()==null){var r=c.OperationMode;if(r==$$.OperationModes.NORMAL||c.Touch.ResizeLocation.Row>=0)c.Touch.ResizeLocation=null}}}this.document.PreviousActiveSpread=d;this.document.FpActiveSpread=a;this.document.FpActiveSheetView=a;if(d!=null){b.GetTopSpreadView().HidePopup();j&&b.Touch.ShowTouchHandles()}var f=a!=null&&a.getSpreadView!=null?a.getSpreadView():null;if(f!=null&&(g||f.IsInTouchMode())&&f.GetTopSpreadView().Spread.GetActiveChart()==null){if(g&&!f.IsInTouchMode()){a.fpSpreadJS.updateSelectionRangeFromCell(a.getAnchorCell());a.fpSpreadJS.keepGeneratedSelectionFromAnchorCell()}if(l){var p=f.GetSpreadContext();p.paintSelections(true,true);p.paintAnchorCell(true,true)}f.ShowFocusRectangle()}}else if(!this.document.FpActiveSheetView)this.document.FpActiveSheetView=this.document.FpActiveSpread},_GetViewRowCount:function(){var d=0,a=this.RowHeaders,c=false;if(a==null){a=[this.Viewport1,this.Viewport];$$.utils.cleanArray(a);if(a.length==0){a=[this.Viewport0,this.Viewport2];$$.utils.cleanArray(a)}}else c=true;if(a!=null)for(var e=0;e<a.length;e++){var b=a[e];d+=b.rows.length;if(c&&b.rows.length>0){var f=b.rows[b.rows.length-1];if(f.cells.length>0&&f.cells[0].getAttribute("FpSpread")=="rowpadding"){d--;c=false}}}return d},_GetSizeBar:function(){return document.getElementById(this.Spread.id+"_sizeBar")},_GetHeaderTable:function(a,b){return b?this.RowHeaders[this.FrozenRowCount==0||a<this.FrozenRowCount?0:1]:this.ColumnHeaders[this.FrozenColumnCount==0||a<this.FrozenColumnCount?0:1]},_GetScrollValues:function(){for(var b=this.GetSpreadContext(),f=b.getScrollvp(),c=[$$.utils.getParentElement(b.getColHeader()),$$.utils.getParentElement(b.getViewport1()),$$.utils.getParentElement(b.getViewport()),$$.utils.getParentElement(b.getColFooter()),f],d=[$$.utils.getParentElement(b.getRowHeader()),$$.utils.getParentElement(b.getViewport2()),$$.utils.getParentElement(b.getViewport()),f],e=[[],[]],a=0;a<c.length;a++)e[0][a]=c[a]!=null?c[a].scrollLeft:0;for(var a=0;a<d.length;a++)e[1][a]=d[a]!=null?d[a].scrollTop:0;return e},_IsScrollChanged:function(d,e){if(d==null)return false;for(var c=this._GetScrollValues(),a=0;a<2;a++)for(var b=0;b<c[a].length;b++)if(d[a][b]!=c[a][b]){if(e)for(var a=0;a<2;a++)for(var b=0;b<c[a].length;b++)d[a][b]=c[a][b];return true}return false},IsInTouchMode:function(){return this.Touch!=null&&this.Touch.IsInTouchMode},IsMultiBrowserMode:function(){return $$.browser.mb},SynchronizeScroll:function(a,h,d){if(this.Parent!=null)return;var b=this.GetSpreadContext();if(a==null)a=$$.utils.getParentElement(b.getViewport());if(a==null)return;b.detachScrollEvents(a);var f=a.scrollLeft,g=a.scrollTop,e=this._SynchronizeScroll(a,h),c=this;this.lastScrollTimeoutId=setTimeout(function(){if(a==b.getScrollvp()||a==b.getViewport().parentNode){if(f!=a.scrollLeft||g!=a.scrollTop)e=c._SynchronizeScroll(a);d!=null&&d(e);c.Touch!=null&&c.Touch.OnAfterSpreadScroll(a);setTimeout(function(){b.attachScrollEvents(a)},0)}else{d!=null&&d(e);c.Touch!=null&&c.Touch.OnAfterSpreadScroll(a);b.attachScrollEvents(a)}this.lastScrollTimeoutId=null},0);return e},_SynchronizeScroll:function(c,k){var f=this.GetSpreadContext(),i=c.scrollTop,h=c.scrollLeft,a=f.getScrollvp(),m=$$.utils.getParentElement(f.getViewport()),j=k==null||k=="HorizontalOnly",l=k==null||k=="VerticalOnly",d=null;if(j){d=[$$.utils.getParentElement(f.getColHeader()),$$.utils.getParentElement(f.getViewport1()),m,$$.utils.getParentElement(f.getColFooter())];var g=c==a;if(!g)for(var b=0;b<d.length;b++)if(d[b]==c){d[b]=null;g=true;break}if(!g)j=false;else $$.utils.cleanArray(d)}var e=null;if(l){e=[$$.utils.getParentElement(f.getRowHeader()),$$.utils.getParentElement(f.getViewport2()),m];var g=c==a;if(!g)for(var b=0;b<e.length;b++)if(e[b]==c){g=true;e[b]=null;break}if(!g)l=false;else $$.utils.cleanArray(e)}if(a!=null&&c!=a){if(j&&a.scrollLeft!=h){var n=a.scrollLeft;a.scrollLeft=h;if(a.scrollLeft!=h)if(a.scrollLeft==n)return"HorizontalFail";else c.scrollLeft=a.scrollLeft}if(l&&a.scrollTop!=i){var o=a.scrollTop;a.scrollTop=i;if(a.scrollTop!=i)if(a.scrollTop==o)return"VerticalFail";else c.scrollTop=a.scrollTop}}if(j)for(var b=0;b<d.length;b++)if(d[b].scrollLeft!=h)d[b].scrollLeft=h;if(l)for(var b=0;b<e.length;b++)if(e[b].scrollTop!=i)e[b].scrollTop=i;return null},IsLayoutInitialized:function(){return this.IsMultiBrowserMode()?this.layoutInitialized:this.Spread.initLayoutCompleted},SyncRowRange:function(a,b){this.GetSpreadContext().syncRowRangeSafeMode(a,b)},IsShowFocusRectangle:function(){if(this.Parent!=null)return this.GetTopSpreadView().IsShowFocusRectangle();if(this._isShowFocusRectangle==null)this._isShowFocusRectangle=this.Spread.getAttribute("showFocusRect")!="false";return this._isShowFocusRectangle},IsRetainSelection:function(){return this.Parent!=null?this.GetTopSpreadView().IsRetainSelection():this.Spread.getAttribute("RetainSelectionBlock")!="false"},IsClientAutoSize:function(){if(this.Parent!=null)return this.GetTopSpreadView().IsClientAutoSize();var a=this.Spread.getAttribute("ClientAutoSize");return a&&a.toLowerCase()=="true"},ClientAutoSizeMaxHeight:function(){return this.Parent!=null?this.GetTopSpreadView().ClientAutoSizeMaxHeight():this.Spread.getAttribute("ClientAutoSizeMaxHeight")==null?0:parseInt(this.Spread.getAttribute("ClientAutoSizeMaxHeight"))},ClientAutoSizeMaxWidth:function(){return this.Parent!=null?this.GetTopSpreadView().ClientAutoSizeMaxWidth():this.Spread.getAttribute("ClientAutoSizeMaxWidth")==null?0:parseInt(this.Spread.getAttribute("ClientAutoSizeMaxWidth"))},IsEnablejQueryTheme:function(){var b=this.Spread.getTopSpread?this.Spread.getTopSpread():null,a;if(this.IsMultiColumnComboBox&&(a=this.GetHostSpread())!=null&&a.getTopSpread)b=a.getTopSpread();var c=b?b.getAttribute("EnablejQueryTheme"):null;return c&&c.toLowerCase()=="true"},CheckAutoSizeScrollBar:function(f,e,b,a){var j=$$.utils.detectScrollbarWidthHeight(),h,g=false,d=f,c=e,l,m,n=this.HorizontalScrollBarPolicy(),o=this.VerticalScrollBarPolicy(),k=b<f&&b>0,i=a<e&&a>0;if(i&&!k&&o!="never")h=true;if(!i&&k&&n!="never")g=true;if(g&&($$.browser.ie?this.Spread.GetRowCount()!=0:true))c=e+j;if(h)d=f+j;this.autoSizeWidthOverflow=b>0&&d>b;this.autoSizeHeightOverflow=a>0&&c>a;m=this.autoSizeHeightOverflow?"auto":"hidden";l=this.autoSizeWidthOverflow?"auto":"hidden";d=b==0?d:Math.min(d,b);c=a==0?c:Math.min(c,a);return[d,c,l,m]},UIVirtualization:function(){if(this.Parent!=null)return this.GetTopSpreadView().UIVirtualization();var a=$$.browser.mb||$$.browser.ieversion>7&&($$.browser.quirksMode||$$.browser.version>7);return a?this.Spread.getAttribute("UIVirtualization")=="True":false},IsVerticalRestricClientAutoSize:function(){return this.IsClientAutoSize()&&this.autoSizeHeightOverflow},IsHorizontalRestricClientAutoSize:function(){return this.IsClientAutoSize()&&this.autoSizeWidthOverflow},HorizontalScrollBarPolicy:function(){return this.Parent!=null?this.GetTopSpreadView().HorizontalScrollBarPolicy():this.Spread.getAttribute("HorizontalScrollBarPolicy")},VerticalScrollBarPolicy:function(){return this.Parent!=null?this.GetTopSpreadView().VerticalScrollBarPolicy():this.Spread.getAttribute("VerticalScrollBarPolicy")},AllowHeaderResize:function(){if(this.Parent==null){if(this.__allowHeaderResize==null)this.__allowHeaderResize=this.Spread.getAttribute("sizeheader")=="true";return this.__allowHeaderResize}else return this.GetTopSpreadView().AllowHeaderResize()},_RefreshFocusRectangleCssSetting:function(a){if(a==null)a=this._focusRects;if(a==null)return;if(a[0]._lastCalledSpreadView==this)return;a[0]._lastCalledSpreadView=this;for(var c=this.Spread.getAttribute("FocusBorderColor")||"black",d=this.Spread.getAttribute("FocusBorderStyle")||"solid",b=0;b<4;b++){if(c!=null)a[b].style.borderColor=c;if(d!=null)a[b].style.borderStyle=d}},_GetFocusRectangle:function(e,f){if(this.Parent!=null){var g=this.GetTopSpreadView()._GetFocusRectangle(e,true);!f&&this._RefreshFocusRectangleCssSetting(g);return g}if(this._focusRects==null&&(!$$.browser.mb||!e)){var b=document.getElementById(this.Spread.id+"_misc_holder");if(b==null){b=document.createElement("DIV");b.style.position="relative";b.style.overflow="visible";b.style.borderStyle="none";b.style.width="0px";b.style.height="0px";b.style.margin="0px";b.style.padding="0px";b.id=this.Spread.id+"_misc_holder";b.tabIndex=-1;$$.j(b).addClass("Unselectable");this.Spread.appendChild(b)}for(var d=[],c=0;c<4;c++){var h=this.Spread.id+"_focusBorder_"+c,a=document.getElementById(h);if(a!=null){d[c]=a;continue}else if(e)return null;a=document.createElement("img");a.style.position="absolute";a.style.left="-1000px";a.style.top="0px";a.style.overflow="hidden";a.style.border="1px solid black";a.style.pointerEvents="none";if(c%2==0)a.style.height="0px";else a.style.width="0px";a.style.zIndex=0;a.id=h;b.appendChild(a);d[c]=a}this._focusRects=d}!f&&this.Parent==null&&this._RefreshFocusRectangleCssSetting();return this._focusRects},_IsFocusRectangle:function(c){var a=this._GetFocusRectangle(true,true);if(a!=null)for(var b=0;b<a.length;b++)if(a[b]==c)return true;return false},_IsChildSpreadRow:function(d){if(this.ChildSpreadViews==null||this.ChildSpreadViews.length==0)return false;var a=this.Viewport.rows[d];if(a!=null&&a.getAttribute("FpKey")==null&&a.getAttribute("previewRow")==null&&a.cells.length>0)if(a.cells[0].childNodes.length>0)for(var b=0;b<a.cells[0].childNodes.length;b++){var c=a.cells[0].childNodes[b];if(c.nodeType==1)return c.getAttribute("FpSpread")=="Spread"}return false},_IsPreviewRow:function(b){if(!this.HasPreviewRow)return false;var c=this.GetSpreadContext(),a=c.getCellFromRowCol(b,0);return a&&a.parentNode.getAttribute("previewRow")=="true"?true:false},_GetColumnLocation:function(c){var a,e;if(c<this.FrozenColumnCount){a=(this.Viewport0||this.Viewport2).parentNode.getBoundingClientRect().left;for(var b=0;b<c;b++)a+=this.Columns[b].Width+this.CellSpacing}else{var d=(this.Viewport1||this.Viewport).parentNode;a=d.parentNode.getBoundingClientRect().left-d.scrollLeft;for(var b=this.FrozenColumnCount;b<c;b++)a+=this.Columns[b].Width+this.CellSpacing}a+=this.CellSpacing;e=a+this.Columns[c].Width;return{left:a,right:e}},_GetRowLocation:function(d){var b,e,f=this._GetRow(d).HtmlRow,a=null;if(this.FrozenRowCount==0||this.FrozenRowCount>0&&d>=this.FrozenRowCount)a=this.Viewport2||this.Viewport;else a=this.Viewport0||this.Viewport1;b=a.parentNode.getBoundingClientRect().top-a.parentNode.scrollTop;for(var c=0;c<f.rowIndex;c++)b+=a.rows[c].offsetHeight+this.CellSpacing;e=b+f.offsetHeight;return{top:b,bottom:e}},_GetColumnLeft:function(){if(this.ColumnCount>0){var d=(this.GetSpreadContext().getViewportHolder()||this.Viewport.parentNode).getBoundingClientRect(),a=this._FindCellFromPoint(Math.max(0,d.left),Math.max(0,d.top));if(a!=null){var e=$$(a).getParent("TABLE");return e==this.Viewport||e==this.Viewport1?a.cellIndex+this.FrozenTableColumnCount:a.cellIndex}else{if(this.FrozenColumnCount>0)return 0;for(var c=(this.Viewport1||this.Viewport).parentNode.scrollLeft,b=0;b<this.ColumnCount;b++){c-=this.Columns[b].Width+this.CellSpacing;if(c<0)return b}}}return-1},_GetColumnRight:function(){var c=this._GetColumnLeft();if(c>-1)for(var e=this.GetTopSpreadView(),d=(e.GetSpreadContext().getViewportHolder()||e.Viewport.parentNode).getBoundingClientRect(),b=this.Parent!=null?this.Viewport.parentNode.getBoundingClientRect().left:d.left,a=c;a<this.ColumnCount;a++){if(a==this.FrozenColumnCount)b-=(this.Viewport1||this.Viewport||this.Spread.getColHeader()).parentNode.scrollLeft;b+=this.Columns[a].Width;if(b>=d.right)return a}return this.ColumnCount-1},_GetRowTop:function(c){if(this.RowCount>0){if(c==null)c=false;var k=c||this.FrozenRowCount==0&&this.FrozenColumnCount==0?this.Viewport.parentNode:this.GetSpreadContext().getViewportHolder(),e=k.getBoundingClientRect(),d=this._FindCellFromPoint(Math.max(0,e.left),Math.max(0,e.top));if(d!=null){var h=this._GetRowViewIndex(d),l=d.getBoundingClientRect(),a=this._GetRowIndexByViewIndex(h);if(a!=null&&a!=-1)return a;else for(var g=$$(d).getParent("TABLE"),j=g==this.Viewport0||g==this.Viewport1?0:this.FrozenTableRowCount,b=d.parentNode.rowIndex+1;b<g.rows.length;b++){a=this._GetRowIndexByViewIndex(b+j);if(a!=null&&a!=-1)return a}}else{if(!c&&this.FrozenRowCount>0)return 0;for(var b=!c?0:this.FrozenRowCount;b<this.RowCount;b++){var f=this._GetRow(b).HtmlRow;if(f!=null&&f.offsetParent!=null){var i=f.getBoundingClientRect();if(i.bottom>e.top)return b}}}}return-1},_GetRowBottom:function(g){var e=g||this._GetRowTop();if(e>=0){for(var b=(this.GetSpreadContext().getViewportHolder()||this.Viewport.parentNode).getBoundingClientRect(),a=e;a<this.RowCount;a++){var f=this._GetRow(a),d=f.HtmlRow;if(d!=null&&d.parentNode!=null){var c=d.getBoundingClientRect();if(c.top<=b.bottom&&c.bottom>=b.bottom)return a;else if(c.top>b.bottom)return a>0?a-1:0}}return this.RowCount-1}return-1},_FindColumnActiveCell:function(h,n,j,r){if(this.RowCount>0&&this.ColumnCount>0&&h<this.ColumnCount)for(var a=(this.GetSpreadContext().getViewportHolder()||this.Viewport.parentNode).getBoundingClientRect(),c=-1,i=h;i<h+n;i++){var g=null,m=false;if(j==null)j=-1;if(c!=-1){var s=a;a=c;c=s}for(var d=0;d<this.RowCount;d++){if(d==this.FrozenRowCount&&this.FrozenRowCount>0){if(c==-1){var o=(this.Viewport2||this.Viewport).parentNode.getBoundingClientRect(),l={};l.top=Math.max(a.top,o.top);l.bottom=Math.min(a.bottom,o.bottom);c=l}var t=a;a=c;c=t}var k=this.FlattenRows[d];if(j!=-1&&k.LayoutIndex!=j)continue;if(!k||!k.Cells)continue;var b=k.Cells[i],f=b?b.HtmlCell:null;if(f==null&&d==0){b=this.GetCell(d,i,true);if(b!=null&&b.HtmlCell.rowSpan==this.RowCount)f=b.HtmlCell}if(f!=null&&b.Column>=h&&(b.Column+f.colSpan<=h+n||b.Column==i&&this.OperationMode==$$.OperationModes.ROW_MODE||r&&d==0&&f.rowSpan==this.RowCount)){var e=f.getBoundingClientRect(),p=e.top-a.top,q=e.bottom-a.bottom;if((p>0||Math.abs(p)<1)&&(q<0||Math.abs(q)<1))return b;else if(!m&&(g==null||e.top>=a.top&&e.top<=a.bottom||e.bottom>=a.top&&e.bottom<=a.bottom)){if(g!=null)m=true;g=b}}}if(g!=null)return g}return null},_FindRowActiveCell:function(g,m,n){if(this.ColumnCount>0&&this.RowCount>0&&g<this.RowCount)for(var b=(this.GetSpreadContext().getViewportHolder()||this.Viewport.parentNode).getBoundingClientRect(),f=null,k=false,d=-1,h=g;h<g+m;h++){if(d!=-1){var o=b;b=d;d=o}var i=this._GetRow(h);if(!i||!i.Cells)continue;for(var c=0;c<this.ColumnCount;c++){if(c==this.FrozenColumnCount&&this.FrozenColumnCount>0){if(d==-1){var l=(this.Viewport1||this.Viewport).parentNode.getBoundingClientRect(),j={};j.left=Math.max(b.left,l.left);j.right=Math.min(b.right,l.right);d=j}var p=b;b=d;d=p}var a=i.Cells[c];if(a==null&&c==0){a=this.GetCell(h,c,true);if(a!=null&&(a.Row!=h||a.Column!=c||a.HtmlCell.colSpan!=this.ColumnCount))a=null}if(a!=null&&a.Row>=g&&(a.Row+a.HtmlCell.rowSpan<=g+m||n&&c==0&&a.HtmlCell.colSpan==this.ColumnCount)){var e=a.HtmlCell.getBoundingClientRect();if(e.left>=b.left&&e.right<=b.right)return a;else if(!k&&(f==null||e.left>=b.left&&e.left<=b.right||e.right>=b.left&&e.right<=b.right)){if(f!=null)k=true;f=a}}}if(f!=null)return f}return null},_FindSheetActiveCell:function(){if(this.RowCount>0&&this.ColumnCount>0){var c=this._GetRowTop();if(c<0)c=0;for(var e=(this.GetSpreadContext().getViewportHolder()||this.Viewport.parentNode).getBoundingClientRect(),d=c,a=c;a<this.RowCount;a++){var f=this._GetRow(a),b=f.HtmlRow.getBoundingClientRect();if(b.top>=e.top&&b.top<=e.bottom){d=a;break}else if(b.top>b.bottom||f.HtmlRow.parentNode==null)break}for(var a=d;a<this.RowCount;a++){var g=this._FindRowActiveCell(a,this.RowCount);if(g!=null)return g}}return null},_IsValidTouchActiveCell:function(a,d){var c=this.GetSpreadContext(),f=c.getXmlActiveRow(),h=c.getXmlActiveCol(),e=f!=-1?c.getRowByKey(f):-1,g=-1;if(this.IsRowLayoutMode)g=this._GetColumnIndexFromLayoutIndex(h);else g=c.getColByKey(h);if(e!=-1)e=this._GetRowIndexByViewIndex(e);var i=this.Spread.getAnchorCell(),b=false;if(a.Row>=0)if(a.Column>=0)b=!a.Contains(e,g);else{b=h==-1||a.Row!=e&&(d==null&&!c.isInTouchAjax()||d!=null&&d.ActiveRow!=f);if(!b)b=i!=null&&c.getActiveRow()+i.rowSpan>a.Row+a.RowCount}else if(a.Column>=0){b=f==-1||a.Column!=g&&(d==null&&!c.isInTouchAjax()||d!=null&&d.ActiveColumn!=h);if(!b)b=i!=null&&(c.getActiveCol()+i.colSpan>a.Column+a.ColumnCount||f==-1&&this.Spread.ActiveRow!=-1&&this.RowCount>0)}return!b},_GetColumnIndexFromLayoutIndex:function(b){if(b!=-1){var a=this._GetFirstCellFromLayoutCol(b);if(a==null)a=this._GetFirstCellFromLayoutCol(b,true);if(a!=null)return this.GetSpreadContext().getColFromCell(a)}return-1},_FindCellFromPoint:function(b,c){var a=$$.utils.GetCell(document.elementFromPoint(b,c));return a!=null&&this.IsInViewport(a)?a:null},_IsCell:function(a){if((a.tagName=="TD"||a.tagName=="TH")&&a.parentNode!=null&&a.parentNode.getAttribute("FpSpread")=="r")return true;if((a.tagName=="TD"||a.tagName=="TH")&&a.parentNode!=null){var b=a.parentNode.getAttribute("FpSpread");if(b=="r"||b=="ch"&&a.getAttribute("controltype")!="chgrayarea"||b=="rh")return true}return false},_FindParentCell:function(a,d){if(a==null||d==null||!$$.utils.contains(d,a))return null;var e=this.GetSpreadContext(),b=null,c=null;do{c=a.parentNode;b=e.getSpreadControl(c);a=b}while(b!=null&&b!=d);return c},_GetCellRangePaintInfo:function(V,S,db,rb,bb,hb,Eb,Db){if(!this.GetTopSpreadView().Spread.initialized&&(!this.IsMultiBrowserMode()||!this.GetTopSpreadView().Spread.initLayoutCompleted))return null;if(V>=this.RowCount||S>=this.ColumnCount||V>=0&&V+db>this.RowCount||S>=0&&S+rb>this.ColumnCount)return null;if(hb==null)hb=true;var c=V,g=S,h=c!=-1?c+db-1:-1,f=g!=-1?g+rb-1:-1,A=c==-1&&g>-1,Q=g==-1&&c>-1,lb=c==-1&&g==-1;if(bb==null||this.IsRowLayoutMode&&bb==-1)bb=0;var xb=this.GetSpreadContext();if(A){c=!this.IsRowLayoutMode?0:bb;h=this.RowCount-1}else if(Q){g=0;f=this.ColumnCount-1;if(hb&&this.IsRowLayoutMode){var t=this._GetRow(c);if(!t.IsGroup)h=c+this.LayoutRowCount-1}}else if(lb){c=0;g=0;db=this.RowCount;f=this.ColumnCount-1;h=db-1}for(var F=this.TOP,Gb=this.RIGHT,Fb=this.BOTTOM,Hb=this.LEFT,j=this._GetFocusRectangle(false,Eb),i,e,d,b,E=hideLeft=hideBottom=hideRight=false,K=0,R=[],a=0;a<4;a++){R[a]=j[a].style.display;if(j[a].style.display!=""){j[a].style.opacity=.001;j[a].style.display=""}}var jb=j[F].offsetParent;if($$.browser.ieversion>10){var n=j[F].parentNode;if(jb==null){n.__originalPosition=n.style.position;n.style.position="absolute";jb=j[F].offsetParent}else if(n.__originalPosition!=null){n.style.position=n.__originalPosition;if(j[F].parentNode!=null)try{delete n.__originalPosition}catch(Ib){n.__originalPosition=null}else n.style.position="absolute"}}var k=$$.utils.getBoundingClientRect(jb),eb;if(this.RowCount!=0&&this.ColumnCount!=0){var m=this._GetHtmlCell(c,g,true);if(m==null){if(Db)for(var a=g+1;a<=f&&a<this.ColumnCount;a++){m=this._GetHtmlCell(c,a,true);if(m!=null)break}if(m==null){for(var a=0;a<4;a++)if(j[a].style.display!=R[a]){j[a].style.opacity=1;j[a].style.display=R[a]}return null}}var G=m.getBoundingClientRect(),X=xb.isSmartPaint(),l,O,L,I;if(X){var Ab=this.FrozenRowCount==0||c>=this.FrozenRowCount?this.Viewport.parentNode:xb.getViewportHolder()||this.Viewport.parentNode,yb=Ab.getBoundingClientRect();l=this._GetRowTop(c>=this.FrozenRowCount);if(l>-1){L=Math.min(this._GetRow(l).HtmlRow.getBoundingClientRect().top,yb.top-1);var O=this._GetRowBottom(l),t=this._GetRow(O);I=t.HtmlRow.getBoundingClientRect().bottom;var T=$$(t.HtmlRow).getParent("TABLE"),pb=t.FlattenIndex!=this.RowCount-1?this._GetRow(t.FlattenIndex+1).ViewIndex-t.ViewIndex-1:T.rows.length-t.HtmlRow.rowIndex-1,Cb=t.HtmlRow.rowIndex+1;while(pb>0){I+=T.rows[Cb].offsetHeight;pb--}}else{O=-1;L=this._GetRowLocation(c).top;I=this._GetRowLocation(h).bottom}}if(X&&(c<l||c>O||!$$.utils.contains(this.Spread,m))){if(c<l)e=L;else e=I;i=this._GetColumnLocation(g).left}else{i=G.left;e=G.top;if(A&&m.colSpan>1){for(var u=false,a=c+1;a<=h;a++){var y=this._GetHtmlCell(a,g);if(y==null)continue;u=true;i=y.getBoundingClientRect().left;break}if(!u)i=this._GetColumnLocation(g).left}else if(Q&&m.rowSpan>1){for(var u=false,a=g+1;a<=f;a++){var y=this._GetHtmlCell(c,a);if(y==null)continue;u=true;e=y.getBoundingClientRect().top;break}if(!u)e=this._GetRowLocation(c).top}}var p=m;if(c!=h||g!=f){p=this._GetHtmlCell(h,f,true);while(f>0&&p==null){f--;p=this._GetHtmlCell(h,f,true)}}if(X&&this.FrozenRowCount>0&&h>this.FrozenRowCount){l=this._GetRowTop(true);if(l>-1)L=Math.min(this._GetRow(l).HtmlRow.getBoundingClientRect().top,this.Viewport.parentNode.getBoundingClientRect().top-1);else O=-1}if(X&&(h<l||h>O||!$$.utils.contains(this.Spread,p))){if(h<l)b=L;else b=I;d=this._GetColumnLocation(f).right}else{G=p.getBoundingClientRect();d=G.right;b=G.bottom;if((A||lb)&&p.colSpan>1){for(var u=false,a=h-1;a>=c;a--){var M=this.GetCell(a,f,true);if(M==null||M.HtmlCell.colSpan>1&&M.Column+M.HtmlCell.colSpan-1>f)continue;u=true;var ub=M.HtmlCell.getBoundingClientRect();d=ub.right;break}if(!u){d=i;for(var a=g;a<=f;a++){d+=this.Columns[a].Width;if(a!=f)d+=this.CellSpacing}if(g<this.FrozenColumnCount&&f>=this.FrozenColumnCount){var U=this.Viewport||this.Viewport1;if(U==null)U=this.GetSpreadContext().getColHeader();if(U!=null)d-=U.parentNode.scrollLeft}}}if((A||lb)&&this.HasPreviewRow){var qb=$$(p).getParent("TABLE"),zb=qb.rows[qb.rows.length-1];b+=zb.getBoundingClientRect().bottom-G.bottom}if(Q&&p.rowSpan>1){for(var u=false,a=f-1;a>=g;a--){var y=this._GetHtmlCell(h,a);if(y==null||y.rowSpan>1)continue;u=true;var ub=y.getBoundingClientRect();b=ub.bottom;break}if(!u)b=this._GetRowLocation(h).bottom}}var o=this.Parent==null?this.Viewport.parentNode:this.GetTopSpreadView().Viewport.parentNode,cb=o.getBoundingClientRect(),v=this.FrozenRowCount>0||this.FrozenColumnCount>0?this.GetSpreadContext().getViewportHolder().getBoundingClientRect():null,x=cb.top,B=cb.left,r=o.clientWidth>0?cb.right-(o.offsetWidth-o.clientWidth):o.offsetWidth,w=o.clientHeight>0?cb.bottom-(o.offsetHeight-o.clientHeight):o.offsetHeight;if(v!=null){r=Math.min(r,v.right);w=Math.min(w,v.bottom)}if(c<this.FrozenRowCount&&h>=this.FrozenRowCount){hideBottom=b>w;if(hideBottom)b=w;else{hideBottom=b<x;if(hideBottom)b=x}}else if(c>=this.FrozenRowCount||h<this.FrozenRowCount){if(h<this.FrozenRowCount)x=v.top;E=e<x;if(E)e=x;else E=e>w;hideBottom=b>w;if(hideBottom)b=w;else hideBottom=b<x}if(g<this.FrozenColumnCount&&f>=this.FrozenColumnCount){hideRight=d<B;if(hideRight)d=B;else{hideRight=d>r;if(hideRight)d=r}}else if(g>=this.FrozenColumnCount||f<this.FrozenColumnCount){if(f<this.FrozenColumnCount)B=v.left;hideLeft=i<B;if(hideLeft)i=B;else hideLeft=i>r;hideRight=d>r;if(hideRight)d=r;else hideRight=d<B}eb={left:i,top:e,right:d,bottom:b};var gb=this.GetTopSpreadView().Spread.getBoundingClientRect();if((v!=null?v.top>gb.bottom:x>gb.bottom)||r>gb.right){hideLeft=true;E=true;hideBottom=true;hideRight=true}i=Math.floor(i-k.left);e=Math.floor(e-k.top);d=Math.floor(d-k.left);b=Math.floor(b-k.top);K=Math.floor(j[F].offsetHeight/2)}else{var fb=this.GetSpreadContext().getScrollvp()||this.Viewport.parentNode,z=fb.getBoundingClientRect();if(this.RowCount==0&&this.ColumnCount!=0){e=b=z.top-k.top;var N=!Q?g:0,Z=!Q?f:this.ColumnCount-1;i=d=z.left;var kb=0;if(N>=this.FrozenColumnCount||Z>=this.FrozenColumnCount)for(var a=0;a<this.FrozenColumnCount;a++)kb+=this.Columns[a].Width+this.CellSpacing;for(var P=0,ab=0,a=0;a<=Z;a++){var wb=this.Columns[a].Width;if(a<N)P+=wb+this.CellSpacing;ab+=wb+this.CellSpacing}P+=this.CellSpacing;var s=fb.scrollLeft;i-=k.left+(N<this.FrozenColumnCount?0:s)-P;d-=k.left+(Z<this.FrozenColumnCount?0:s)-ab;var W=z.right-z.left;if(this.Parent!=null&&this.ColumnHeader.RowCount>0)W=Math.max(W,this.ColumnHeaders[0].offsetWidth);if(N>=this.FrozenColumnCount){s+=kb;hideLeft=P<s||P>=s+W}if(Z>=this.FrozenColumnCount){if(N<this.FrozenColumnCount)s+=kb;hideRight=ab<s||ab>=s+W}}else if(this.ColumnCount==0&&this.RowCount!=0&&this.RowHeaders!=null){var vb=Math.floor(j[F].offsetHeight/2);i=d=z.left-k.left+(this.CellSpacing>0?this.CellSpacing-vb:0);var J=this._GetRow(!A?c:0).ViewIndex,H=this._GetRow(!A?h:this.RowCount-1).ViewIndex;e=b=z.top;for(var T=this.Viewports[0],tb=this.FrozenRowCount>0,D=0,q=0,ib=0,C=fb.scrollTop,a=0,nb=0;a<=H;a++){if(tb&&a>=this.FrozenTableRowCount){T=this.Viewports[1];tb=false;nb=0}var mb=T.rows[nb].offsetHeight;if(a<J)D+=mb+this.CellSpacing;q+=mb;if(a<H)q+=this.CellSpacing;nb++;if(a<this.FrozenTableRowCount)ib+=mb+this.CellSpacing}if(this.CellSpacing>0)q-=vb;if(this.AllowVirtualScrollPaging){D+=J>=this.FrozenTableRowCount?this.Spread.virtualTop:0;q+=H>=this.FrozenTableRowCount?this.Spread.virtualTop:0}e-=(J>=this.FrozenTableRowCount?C:0)-D;b-=(H>=this.FrozenTableRowCount?C:0)-q;var sb=(this.Viewport2||this.Viewport).parentNode.getBoundingClientRect(),ob=sb.bottom-sb.top,Y=this.FrozenRowCount>0?(this.Viewport0||this.Viewport1).parentNode.getBoundingClientRect():0;if(J>=this.FrozenTableRowCount)D-=ib;if(H>=this.FrozenTableRowCount)q-=ib;E=J>=this.FrozenTableRowCount?D<C||D>=C+ob:e<Y.top||e>Y.bottom;hideBottom=H>=this.FrozenTableRowCount?q<C||q>=C+ob:b<Y.top||b>Y.bottom;e-=k.top;b-=k.top}else i=d=e=b=0;eb={left:i+k.left,top:e+k.top,right:d+k.left,bottom:b+k.bottom}}for(var a=0;a<4;a++)if(j[a].style.display!=R[a]){j[a].style.opacity=1;j[a].style.display=R[a]}var Bb={BoundingRect:{X1:i,Y1:e,X2:d,Y2:b},FocusRect:{X1:i-K,Y1:e-K,X2:hideRight?d-2*K:d,Y2:hideBottom?b-2*K:b},Visibility:{Top:!E,Left:!hideLeft,Bottom:!hideBottom,Right:!hideRight},BoundingClientRect:eb};return Bb},_GetActiveCellRange:function(c){var a=null;if(this.OperationMode==$$.OperationModes.NORMAL||this.OperationMode==$$.OperationModes.ROW_MODE||this.OperationMode==$$.OperationModes.EXTENDED_SELECT){a=this.SelectionModel.GetFocusCellRange(c);if(this.OperationMode==$$.OperationModes.EXTENDED_SELECT){var b=this._GetActiveRowCellRange();if(a==null||b&&!a.Contains(b.Row,b.Column,b.RowCount,b.ColumnCount))a=b}}else{a=this._GetActiveRowCellRange();if(a==null&&!this.SelectionModel.IsEmpty())a=this.SelectionModel.GetFocusCellRange(c)}return a},_GetActiveRowCellRange:function(){var a=this.Spread.ActiveRow,c=1;if(a!=-1&&this.GetSpreadContext().getXmlActiveRow()!=-1){a=this._GetRowIndexByViewIndex(this._GetTableRowIndex(a));if(this.IsRowLayoutMode){var b=this._GetRow(a);if(!b.IsGroup){a=b.Owner[0].FlattenIndex;c=this.LayoutRowCount}else a=b.FlattenIndex}return focusCellRange=new GCWS.CellRange(a,-1,c,-1,this.IsRowLayoutMode?0:-1)}return null},OnAfterSpreadScroll:function(){var d=this.GetActiveSpread(),e=d==this.Spread,b=this.Spread.GetActiveChildSheetView(true);if(e||this.IsRetainSelection()&&(b==null||b==this.Spread)){var c=false;if($$.utils.isNativeControl(document.activeElement)){var a=this.GetSpreadContext().getViewportHolder();c=a!=null&&(a.scrollLeft!=0||a.scrollTop!=0)}!c&&this.ShowFocusRectangle(true)}if(this.Touch)this.Touch.OnAfterSpreadScroll},IsInFocusRectangle:function(c){var a=this._GetFocusRectangle(true,true);if(a==null)return false;for(var b=0;b<a.length;b++)if(a[b]==c||$$.utils.contains(a[b],c))return true;return false},ShowFocusRectangle:function(f){if(this.IsSuspendShowFocusRectangle()||!this.IsShowFocusRectangle()&&!this.IsInTouchMode())return false;if(f==null)f=true;if(this.IsMultiColumnComboBox){f&&this.Touch!=null&&this.Touch.ShowTouchHandles();return false}var h=document.activeElement;if($$.utils.contains(this.Spread,h)&&$$.utils.isNativeControl(h)){var s=$$.utils.contains(this.Viewport,h),e=!s&&$$.utils.contains(this.Viewport0,h),q=!s&&!e&&$$.utils.contains(this.Viewport1,h),u=!s&&!e&&!q&&$$.utils.contains(this.Viewport2,h);if(e||q||u){if(e||q){var w=this._TranslateToViewport(e?this.Viewport0:this.Viewport1,0,0,true,false);if(w.y<0)return}if(e||u){var w=this._TranslateToViewport(e?this.Viewport0:this.Viewport2,0,0,false,true);if(w.x<0)return}}}if(this.Spread.GetActiveChart()!=null)f=false;var n=this.GetSpreadContext();if(f)if(!this.IsInTouchMode()){this.HideFocusRectangle();n.paintFocusRect();return true}else{if(n.isInShowPage())return false;var r=this.GetActiveSpread(true);if(r!=null&&!this.IsSpreadActive(true)&&this.Spread!=r&&this.GetTopSpreadView()==r.getSpreadView().GetTopSpreadView())return false;n.hideFocusBorder()}else{this.HideFocusRectangle();return false}var b=this._GetActiveCellRange();if(b==null){this.HideFocusRectangle(true);f&&this.Touch&&this.Touch.ShowTouchHandles();return}var c=this.Spread.getAnchorCell();if(c!=null&&b.Row!=-1&&b.Column!=-1&&(c.rowSpan>1||c.colSpan>1)){var v=this._GetHtmlCell(b.Row,b.Column);if(v!=null&&v==c){b.RowCount=Math.max(b.RowCount,c.rowSpan);b.ColumnCount=Math.max(b.ColumnCount,c.colSpan)}}b.RowCount=Math.min(b.RowCount,this.RowCount-b.Row);b.ColumnCount=Math.min(b.ColumnCount,this.ColumnCount-b.Column);var d=this._GetCellRangePaintInfo(b.Row,b.Column,b.RowCount,b.ColumnCount,b.LayoutRow,!this.IsMultiBrowserMode(),false,this.EnableRowEditTemplate);if(d==null){this.HideFocusRectangle();this.Touch&&this.Touch.ShowTouchHandles();return}var i=d.FocusRect.X1,j=d.FocusRect.Y1,o=d.FocusRect.X2,p=d.FocusRect.Y2,m=this.TOP,g=this.RIGHT,k=this.BOTTOM,l=this.LEFT,a=this._GetFocusRectangle();if(o-i<=0||p-j<=0){this.HideFocusRectangle(true);f&&this.Touch&&this.Touch.ShowTouchHandles();return true}if(d.Visibility.Top){a[m].style.left=i+"px";a[m].style.top=j+"px";a[m].style.width=o-i+"px";a[m].style.display=""}else a[m].style.display="none";if(d.Visibility.Bottom){a[k].style.left=i+"px";a[k].style.top=p+"px";a[k].style.width=o-i+"px";a[k].style.display=""}else a[k].style.display="none";if(d.Visibility.Left){a[l].style.left=i+"px";a[l].style.top=j+"px";a[l].style.height=p-j+"px";a[l].style.display=""}else a[l].style.display="none";if(d.Visibility.Right){a[g].style.left=o+"px";a[g].style.top=j+"px";a[g].style.height=p-j+"px";a[g].style.visibility="visible";a[g].style.display=""}else{a[g].style.display="none";a[g].style.visibility="hidden"}if(this.OperationMode==$$.OperationModes.NORMAL||this.OperationMode==$$.OperationModes.ROW_MODE){var c=this.Spread.getAnchorCell();c!=null&&this.IsViewportCell(c)&&n.paintSelectedCell(c,false,true)}this.IsInTouchMode()&&this.Touch.ShowTouchHandles();if(this.CellSpacing==0&&$$.browser.ieversion>=10)for(var t=0;t<a.length;t++)if(a[t].style.display!="none"){this.RefreshLayout(true);break}return true},HideFocusRectangle:function(e){var b;if(this.IsInTouchMode()&&!this.IsSpreadActive()&&(b=this.Spread.GetActiveChildSheetView(true))!=null&&b!=this.Spread)return;this.IsShowFocusRectangle()&&this.GetSpreadContext().hideFocusBorder();var c=this._GetFocusRectangle(true,true);if(c==null)return;for(var a=0;a<4;a++)c[a].style.display="none";var d=this.Touch;d!=null&&d.HideTouchHandles(e)},InBouncingEffect:function(){var b=[this.Viewport,this.Viewport1,this.Viewport2],a=false;$$.j.each(b,function(d,c){if(c){var b=c.parentNode;if(b.scrollLeft<0||b.scrollTop<0||b.scrollLeft>b.scrollWidth-b.clientWidth||b.scrollTop>b.scrollHeight-b.clientHeight){a=true;return false}}});return a},_GetErrorMessageHolder:function(){return document.getElementById(this.GetTopSpreadView().Spread.id+"mholder")},OnAttachErrorMessage:function(){if(this.Touch){var a=this._GetErrorMessageHolder();a!=null&&this.Touch.AttachErrorMessage(a)}},OnDetachErrorMessage:function(){if(this.Touch){var a=this._GetErrorMessageHolder();a!=null&&this.Touch.DetachErrorMessage(a)}},_GetTableRowIndex:function(a){return this.Spread.getSpreadJS().getDisplayIndex(a)},AllowTapToAddSelection:function(){return this.Spread.TapToAddSelection&&!(this.OperationMode==$$.OperationModes.SINGLE_SELECT||this.OperationMode==$$.OperationModes.READ_ONLY)&&(this.OperationMode==$$.OperationModes.EXTENDED_SELECT||this.OperationMode!=$$.OperationModes.ROW_MODE&&this.SelectionModel.SelectionPolicy==GCWS.SelectionPolicy.MultiRange)},CanExtendSelect:function(){return this.OperationMode==$$.OperationModes.EXTENDED_SELECT||this.OperationMode==$$.OperationModes.NORMAL},_RequireAddSelection:function(){return this.SelectionModel.SelectionPolicy==GCWS.SelectionPolicy.MultiRange&&this.IsInTouchMode()&&(this.Spread.TapToAddSelection||this.Touch.IsClickSimulating)},IsInViewport:function(c){if(c!=null)for(var b=this.Viewports,a=0;a<4;a++)if(b[a]!=null&&$$.utils.contains(b[a],c))return true;return false},IsViewportCell:function(a){return a!=null&&a.tagName=="TD"&&this.IsInViewport(a)},IsInsideViewport:function(a){if(a!=null){var b=this.GetSpreadContext().getViewportHolder()||this.Viewport.parentNode;return a==b||$$.utils.contains(b,a)}return false},IsInFooter:function(c){var a=this.ColumnFooters;if(a!=null)for(var b=0;b<a.length;b++)if(a[b]!=null&&$$.utils.contains(a[b],c))return true;var d=this.Corner;return d.Contains(c,true)},IsEditModeReplace:function(b){var a=this.GetSpreadContext().getCellType(b);return a=="ExtenderCellType"?false:this.Spread.getAttribute("EditMode")=="replace"},GetFocusTextBox:function(){return this.Parent!=null?this.GetTopSpreadView().GetFocusTextBox():document.getElementById(this.Spread.id+"_textBox")},GetEditingSpread:function(){return a(this.GetTopSpreadView().Spread);function a(b){if(b.isEditing())return b;var c=b.getSpreadView().ChildSpreadViews;if(c!=null)for(var d=0;d<c.length;d++){b=a(c[d].Spread);if(b!=null)return b}return null}},TryStopEditing:function(i,d,f,g,h){this.ClearTimeoutTasks("ProcessEditMode");var c=this.GetTopSpreadView().Spread.GetActiveChartObj()!=null,e=false,b=true;do{var a=this.GetEditingSpread();if(a!=null){var j=a.id;c&&a.getSpreadView().SuspendShowFocusRectangle();var k=a.EndEdit({ignoreEditorFocus:true,IgnoreFireErrorEvent:f,InvokeEditorBlur:g,SafeEditorRemove:h});c&&a.getSpreadView().ResumeShowFocusRectangle();if(!k){b=false;break}else e=true;a=this.GetEditingSpread();if(a!=null&&(!i||a.id==j)){b=false;break}}}while(a!=null);e&&(d==null||d)&&this.UpdateUI();return b},ProcessEditModePermanent:function(b,a){if(!this.Spread.isEditing()&&(!this.IsInTouchMode()||!this.Touch.IsTouchStripOpening)&&!this.EnableRowEditTemplate){this.UnregisterTimeoutTask("ProcessEditMode");this.RegisterTimeoutTask(Function.CreateDelegate(this,function(){var b=this.GetActiveSpreadView(false,true)||this,d=document.activeElement;if(d!=b.__GetSpreadTextBox()&&$$.utils.isNativeControl(d)&&!$$.utils.contains(b.Spread.getAnchorCell(),d))return;if(!b._IsCellHidden(b.Spread.getAnchorCell(),a!=null?a:true)){var f=b.GetEditingSpread();if(f==b.Spread){var c=b.Spread.getEditingInfo();if(c.Editor&&c.Editor.blur&&c.Editor.focus)if($$.utils.isNativeControl(c.Editor)){c.Editor.blur();c.Editor.focus()}else{var g=f.getAnchorCell();if(g!=null){var e=b.GetSpreadContext(),j=e.getCellType(g),h=e.getEditorFocusFunction(j);if(h!=null)try{h(c.Editor)}catch(k){}}}}else{var i=a!=null?{FullVisibleRequired:a}:null;b.GetSpreadContext().processEditMode(null,i)}}else $$.browser.webkit&&this.EditModePermanent&&b.GetSpreadContext().switchHiddenTextBox(true)}),b==null?200:b,"ProcessEditMode")}},IsValid:function(a){if(a==null)a=this;if(!a.Spread.IsValid())return false;var b=a.ChildSpreadViews;if(b!=null)for(var c=0;c<b.length;c++)if(!this.IsValid(b[c]))return false;return true},GetCommandBar:function(){return this.Parent==null?this.CommandBar:this.GetTopSpreadView().CommandBar},GetGroupBar:function(){return this.Parent==null?this.GroupBar:this.GetTopSpreadView().GroupBar},StartAutoExpandMode:function(){if(this.Parent==null)return;var a={};a.element={height:this.Spread.style.height,overflow:this.Spread.style.overflow};this.Spread.style.height="";this.__autoExpandBackup=a;this.Parent!=null&&this.Parent.StartAutoExpandMode()},StopAutoExpandMode:function(){if(this.Parent==null||this.__autoExpandBackup==null)return;var a=this.__autoExpandBackup;this.Spread.style.height=a.element.height;this.Spread.style.overflow=a.element.overflow;this.Parent!=null&&this.Parent.StopAutoExpandMode()},LoadChildSpreadViews:function(f){var a=null;try{a=this.Spread.GetChildSpreads()}catch(g){if(f&&this.Spread.getSpreadView){var e=this.Spread.getSpreadView();if(e.GetSpreadContext){var d=e.GetSpreadContext();if(d.GetChildSpreads)a=d.GetChildSpreads()}}}if(a){for(var b=0;b<a.length;b++)if(a[b].getSpreadView==null)return;this.ChildSpreadViews=[];for(var b=0;b<a.length;b++){var c=a[b].getSpreadView();c.Parent=this;c.IsRoot=false;this.ChildSpreadViews.push(c)}}},IsSupportEditModeFormat:function(a){return a=="IntegerCellType"||a=="DoubleCellType"||a=="CurrencyCellType"||a=="DateTimeCellType"},GetDateValueXmlString:function(b){var e=b.getHours(),c=b.getMinutes(),d=b.getSeconds(),f=b.getMilliseconds();if(e!=0||c!=0||d!=0||f!=0)return a(b.getFullYear(),4)+"/"+a(b.getMonth()+1,2)+"/"+a(b.getDate(),2)+" "+a(e,2)+":"+a(c,2)+":"+a(d,2)+":"+a(f,3);else return a(b.getFullYear(),4)+"/"+a(b.getMonth()+1,2)+"/"+a(b.getDate(),2);function a(c,b){var a=c.toString();while(a.length<b)a="0"+a;return a}},_GetWorkingSpread:function(){return a(this.GetTopSpreadView());function a(c){var f=c.GetSpreadContext();if(f.isWorking()||c.IsMultiBrowserMode()&&f.isDragSlideBar())return c.Spread;var b=c.Spread.GetChildSpreads();if(b!=null)for(var d=0;d<b.length;d++){var e=b[d].getSpreadView!=null?a(b[d].getSpreadView()):null;if(e!=null)return e}return null}},OnSizeChanged:function(){this.ActiveDialog!=null&&this.ActiveDialog.ShowMask()},IsShowEditor:function(b){var c=b.getAttribute("fpcelltype");if(c=="ExtenderCellType"){var a=b.getAttribute("fpeditorid");return a==null||a.length==0}return false},_LoadOnDemandInitialization:function(){var c=this.Spread;if(this.IsLoadOnDemand){if(this.PendingRequests==null)this.PendingRequests=[];this.LoadOnDemandMode=this.GetAttribute("loadOnDemandMode");this.IsBackgroundMode=this.LoadOnDemandMode=="Background";this._LoadOnDemandTimerId=null;this.LoadOnDemandInterval=-1;this.LoadOffsetFromBottom=0;var a=this.GetAttribute("loadOnDemandInterval");if(a!=null&&a!="")this.LoadOnDemandInterval=parseInt(a);var b=this.GetAttribute("loadOffsetFromBottom");if(b!=null&&b!="")this.LoadOffsetFromBottom=parseInt(b);this.IsOffsetBasedMode=this.IsBackgroundMode&&this.LoadOnDemandInterval==-1;this.IsLoadingOnDemand=false;if(this.IsBackgroundMode&&this.LoadOnDemandInterval>=0&&this.PendingRequests.length==0){this._LoadOnDemandTimerId=-1;if(this.GetAttribute("error")!="true")if(!this._isRetrievingFilterBarMenus)this._StartLoadOnDemandTimer();else this.RegisterDelayedRequest(Function.CreateDelegate(this,this._StartLoadOnDemandTimer))}}},GetPendingRequestLength:function(){return this.PendingRequests==null?0:this.PendingRequests.length},_StartLoadOnDemandTimer:function(){if(this._LoadOnDemandTimerId==-1){var a=this;this._LoadOnDemandTimerId=setTimeout(function(){a._LoadOnDemandTimerId!=-1&&a._DoLoadOnDemand(arguments)},this.LoadOnDemandInterval)}},_StopLoadOnDemandTimer:function(){if(this._LoadOnDemandTimerId!=null&&this._LoadOnDemandTimerId!=-1){clearTimeout(this._LoadOnDemandTimerId);this._LoadOnDemandTimerId=-1}},_HasLoadOnDemandTask:function(){return this._LoadOnDemandTimerId!=null&&this._LoadOnDemandTimerId!=-1},HideProcessingStatus:function(){this.GetSpreadContext().closeWaitMsg()},ShowProcessingStatus:function(){this.GetSpreadContext().openWaitMsg()},LoadOnDemandInAction:function(){if(!this.Spread.initialized||window.fpPostOn)return;if(this.AllRowsLoaded||this.GetPendingRequestLength()>0)return;!this.IsBackgroundMode&&this.ShowProcessingStatus();this._DoLoadOnDemand()},_DoLoadOnDemand:function(){if(!this.Spread.initialized)return;if(this.AllRowsLoaded){this.IsLoadingOnDemand=false;this._StopLoadOnDemandTimer();this._LoadOnDemandTimerId=null;this.HideProcessingStatus();this._ProcessPendingRequests();return}if(this.IsLoadingOnDemand)return;var b=this._LoadOnDemandTimerId!=-1;this._StopLoadOnDemandTimer();var a=this.Spread;this.GetSpreadContext().setFpPostOn(null);this.SyncData(this.Spread.getAttribute("name"),"LoadOnDemand",true,function(){var b=a.getSpreadView();if(b.OnLoadRowsStart().cancel){b.HideProcessingStatus();b._RemoveLoadOndemandDiv();return false}b.IsLoadingOnDemand=true;return true},function(e){var c=a.getSpreadView();if(a.parentNode==null||!$$.utils.contains(window.document.body,a)){c._StopLoadOnDemandTimer();c=null;a=null}else{c.AllRowsLoaded=c.GetAttribute("AllRowsLoaded")=="true";c.IsLoadingOnDemand=false;var d=e||c.GetAttribute("error")=="true";c.OnLoadRowsStopped(d);if(!d)c._ProcessPendingRequests(function(d){if(d!=false){var e=c.GetHiddenBottomRowCount();if(e<c.LoadOffsetFromBottom)c._DoLoadOnDemand();else{c.HideProcessingStatus();b&&c._StartLoadOnDemandTimer()}}a=null});else a=null}})},_RemoveLoadOndemandDiv:function(){var a=this.GetSpreadContext(),b=[a.getViewport().parentNode];a.getViewport2()&&b.push(a.getViewport2().parentNode);a.getScrollvp()&&b.push(a.getScrollvp());for(var c=0;c<b.length;c++){var e=b[c],f=e.id+"_loadondemand",d=document.getElementById(f);d&&e.removeChild(d)}},GetHiddenBottomRowCount:function(){var c=this.GetSpreadContext().getViewport(),g=c.parentNode,j=g.clientTop+g.clientHeight;if($$.browser.ie&&$$.browser.version<8)j+=1;var m=[],l,e=0,a=c.rows.length-1;while(a>=0){var i=c.rows[a],h=i.getAttribute("FpKey");if(h!=null){if(i.offsetTop+i.offsetHeight-g.scrollTop>j)e++;else return e;for(var d=a,b=a-1;b>=0;b--){var k=c.rows[b],f=k.getAttribute("FpKey");if(f!=null&&f!=h){d=b;break}else if(f==h)d=b}if(a!=d){a=d;continue}}a--}return e},GetRowsToBeLoaded:function(){return parseInt(this.GetAttribute("rowsToBeLoaded"))},OnLoadRowsStart:function(){var b=this.Viewport2||this.Viewport;this.__oldRowCount=b!=null?b.rows.length:0;var a=this.CreateEvent("LoadRowsStart");if(a!=null){a.spread=this.Spread;a.cancel=false}this.FireEvent("LoadRowsStart",a);return a},OnLoadRowsStopped:function(e){var d;if(this.Rows!=null){d=this.FlattenRows.length;this.Rows._LoadRows(this.__oldRowCount,this.GetSpreadContext().getRowHeader(),this.Viewport2||this.Viewport)}this.ViewRowCount=this._GetViewRowCount();if(this.IsInTouchMode()){var b=this.SelectionModel.GetFocusCellRange();if(b!=null){var c=b.Row!=-1&&b.Column==-1,f=b.Column!=-1&&b.Row==-1;c&&this.RowHeader.ColumnCount>0&&this.Touch.UpdateResizeLocation(false);(this.IsRetainSelection()||this.GetActiveSpread()==this.Spread)&&this.ShowFocusRectangle()}}var a=this.CreateEvent("LoadRowsStopped");if(a!=null){a.spread=this.Spread;a.rowsToBeLoaded=this.GetRowsToBeLoaded();a.error=e?true:false}this.FireEvent("LoadRowsStopped",a);return a},_SetPendingRequest:function(a,b){(this.IsLoadingOnDemand||b)&&this.PendingRequests.push(a)},SetPendingRequest:function(){this._SetPendingRequest(arguments)},_ProcessPendingRequests:function(b){var a=null;if(this.PendingRequests.length>0)this._ProcessPendingRequest(function(b){if(typeof b=="function"&&a==null)a=true;else a=false;return true},function(){b&&b(a)});else b&&b(a)},_ProcessPendingRequest:function(c,b){var a=this.PendingRequests[0];this.PendingRequests.splice(0,1);if(typeof a=="function"){a();var d=true;if(c!=null)d=c(a);if(d&&this.PendingRequests.length>0)this._ProcessPendingRequest();else b&&b()}else{var j=a[0],i=a[1],h=a[2],e=a[3],f=a[4],g=this;this.SyncData(j,i,h,function(){return e!=null?e():true},function(e){f!=null&&f(e);var d=true;if(c!=null)d=c(a,e);if(d&&g.PendingRequests.length>0)g._ProcessPendingRequest();else b&&b()})}},ForEachPendingRequest:function(b){if(b==null)return;for(var a=0;a<this.PendingRequests.length;a++)if(b(this.PendingRequests[a]))break},CreateEvent:function(d,c,b){if(c==null)c=false;if(b==null)b=true;var a=null;if(this.document.createEvent){a=this.document.createEvent("Events");a.initEvent(d,c,b)}else if(this.document.createEventObject)a=this.document.createEventObject();return a},FireEvent:function(c,a){if(this.Spread.dispatchEvent)this.Spread.dispatchEvent(a);else{var b=this.GetSpreadContext(),d=b[c];if(d)d.fire(a);else if(b.fireSpreadEvent)b.fireSpreadEvent(c,a);else this.Spread.fireEvent("on"+c,a)}},_ProcessNegativeRed:function(a,c){if(a.getAttribute("negativeRed")&&a.getAttribute("invalid")==null)if(c<0){var b=a.style.color!=null?a.style.color.toLowerCase():"";if(b!="red"){a.setAttribute("savedColor",b);a.style.color="red"}}else if(a.getAttribute("savedColor")!=a.style.color)a.style.color=a.getAttribute("savedColor")==null?"":a.getAttribute("savedColor")},_GetHorizontalScrollingViewport:function(){var a=this.Spread.getViewport2(),b=this.Spread.getViewport();return a==null||a.rows.length==0?b:b.rows.length==0||a.rows.length<b.rows.length?a:b},_GetKeyedTableRowIndex:function(d,e){var a=this._GetHorizontalScrollingViewport();if(a.rows.length==0)a=this.Spread.getViewport2();if(a==null||a.rows.length==0)return-1;for(var c=0;c<a.rows.length;c++){var b=a.rows[c].getAttribute("FpKey");if(b==d||e&&b!=null&&b!="newRow"&&parseInt(b)>parseInt(d))return c}return-1},_GetTopKeyedTableRowIndex:function(b){var c=this._GetHorizontalScrollingViewport();if(c.rows.length==0)return-1;if(b==null)b=0;for(var a=Math.max(b,0);a<c.rows.length;a++)if(c.rows[a].getAttribute("Fpkey")!=null)return a;return-1},_GetBottomKeyedTableRowIndex:function(d){var b=this._GetHorizontalScrollingViewport();if(b.rows.length==0)return-1;if(d==null)d=b.rows.length-1;var c=Math.min(d,b.rows.length-1),a=null,f=-1;while(c>=0){var g=b.rows[c],e=g.getAttribute("FpKey");if(e!=null&&a==null){a=e;f=c}else if(a!=null&&e!=a)return f;c--}return b.rows[0].getAttribute("FpKey")==a?0:-1},_GetTopDisplayedTableRowIndex:function(f){var g=f==null||f,c=this._GetHorizontalScrollingViewport();if(c.rows.length==0)return-1;var i=c.parentNode,d=i.getBoundingClientRect().top,e=c.getBoundingClientRect().top,a=c.rows.length==1?c.rows[0]:null,b=1;while(b<c.rows.length){a=c.rows[b];if(e+a.offsetTop>d){if(!g){b=b-1;var h=this.Spread.virtualTop;if(h==0)return b;a=c.rows[b];return e+a.offsetTop>d?-1:b}return this._GetBottomKeyedTableRowIndex(b-1)}b++}return a!=null&&e+a.offsetTop+a.offsetHeight>d?!g?a.rowIndex:this._GetBottomKeyedTableRowIndex(a.rowIndex):-1},_GetBottomDisplayedTableRowIndex:function(e){var f=e==null||e,a=this._GetHorizontalScrollingViewport();if(a.rows.length==0)return-1;var h=a.parentNode,d=h.getBoundingClientRect().top+h.clientHeight,g=a.getBoundingClientRect().top,c=null,b=a.rows.length-1;while(b>=0){c=a.rows[b];if(g+c.offsetTop<d)return!f?b:this._GetBottomKeyedTableRowIndex(b);b--}return c!=null&&g+c.offsetTop>d?!f?0:this._GetBottomKeyedTableRowIndex(0):-1},_ViewRowByKey:function(o){var b=this._GetHorizontalScrollingViewport();if(b.rows.length==0)return;var d=parseInt(o),j=this._GetTopDisplayedTableRowIndex(),g=this._GetBottomDisplayedTableRowIndex(),h=j!=-1?parseInt(b.rows[j].getAttribute("FpKey")):-1,n=g!=-1?parseInt(b.rows[g].getAttribute("FpKey")):-1;if(h<=d&&d<=n)return;var f=b.parentNode,a=null;if(d<h)for(var c=j-1;c>=0;c--){a=b.rows[c];var e=a.getAttribute("FpKey");if(e!=null&&parseInt(e)<=d)break}else for(var c=g+1;c<b.rows.length;c++){a=b.rows[c];var e=a.getAttribute("FpKey");if(e!=null&&parseInt(e)>=d)break}if(a!=null){var m=this._GetBottomKeyedTableRowIndex(a.rowIndex);if(m!=-1)a=b.rows[m];if(d<h)f.scrollTop=this.Spread.virtualTop+a.offsetTop;else{var e=a.getAttribute("FpKey"),c=a.rowIndex+1;while(c<b.rows.length){var i=b.rows[c].getAttribute("FpKey");if(i!=null&&i!=e)break;else if(i==null)a=b.rows[c];c++}var k=f.getBoundingClientRect().top+f.clientHeight,l=a.getBoundingClientRect().top+a.offsetHeight;if(l>k)f.scrollTop+=l-k}}},_InitScrollbarState:function(a){if(a==null||a==true)this._IsInitScrollbarState=true;this._SaveVirtualPagingBottomOriginalHeights();var b=this._GetTopRowIndex();if(b!=-1){var c=this._GetScrollTopFromRow(b),f=this.GetSpreadContext().getViewport(),e=f.parentNode,d=this._MakeSureScrollableTo(c);d&&this.IsMultiBrowserMode()&&this.AllowVirtualScrollPaging&&this.Spread.sizeSpread(true);this.GetAttribute("scrollToTopRow")=="true"&&(a==null||a==true)&&this.GetSpreadContext().saveScrollbarState(c,e.scrollLeft,true)}},_GetTopRowIndex:function(){var a=this.GetAttribute("topRow");return this._GetKeyedTableRowIndex(a,true)},_GetScrollTopFromRow:function(a){if(a<0)return-1;var b=this._GetHorizontalScrollingViewport();return a==0?this.Spread.virtualTop:this.Spread.virtualTop+b.rows[a].offsetTop-parseInt(b.cellSpacing)},_MakeSureScrollableTo:function(g,e,o){var n=this.IsMultiBrowserMode();if(n&&!this.AllowVirtualScrollPaging)return false;var b=this.GetSpreadContext(),l=this.Spread,f,d=b.getScrollvp?b.getScrollvp():null;if(d!=null){!o&&this._UpdateDummyHeight();var q=b.getDummy(),j=Math.max(0,l.virtualTop+q.offsetHeight-g);f=Math.max(0,d.clientHeight-j)}else{var c=b.getViewport(),r=c.parentNode,k=c.offsetHeight-(n?this.CellSpacing:0),m=b.getNoRow(-1);if(m!=null)k+=m.offsetHeight;var j=Math.max(0,l.virtualTop+k-g);f=Math.max(0,r.clientHeight-j)}var p=this._SetVirtualPagingBottomHeights(f,true);if(e===true){var a=typeof e=="boolean"?g:e;if(d!=null&&d.scrollTop!=a)d.scrollTop=a;var c=b.getViewport();if(c!=null&&c.parentNode.scrollTop!=a){c.parentNode.scrollTop=a;a=c.parentNode.scrollTop}var h=b.getViewport2();if(h!=null&&h.parentNode.scrollTop!=a)h.parentNode.scrollTop=a;var i=b.getRowHeader();if(i!=null&&i.parentNode.scrollTop!=a)i.parentNode.scrollTop=a}return p},_MakeSureTempScrollableTo:function(f){var i=this.IsMultiBrowserMode();if(i&&!this.AllowVirtualScrollPaging)return false;var h=this.Spread,a=this.GetSpreadContext(),m=$$.utils.getParentElement(a.getViewport()),l=$$.utils.getParentElement(a.getViewport2()),j=a.getScrollvp(),c=0;if(j!=null){this._UpdateDummyHeight();var k=a.getDummy(),e=Math.max(0,h.virtualTop+k.offsetHeight-f);c=Math.max(0,j.clientHeight-e)}var b=a.getViewport(),d=a.getNoRow(-1),g=d!=null?b.offsetHeight+d.offsetHeight:b.offsetHeight-(i?this.CellSpacing:0),e=Math.max(0,h.virtualTop+g-f);c=Math.max(c,m.clientHeight-e);b=a.getViewport2();d=a.getNoRow(2);if(b!=null){g=d!=null?b.offsetHeight+d.offsetHeight:b.offsetHeight-(i?this.CellSpacing:0);e=Math.max(0,h.virtualTop+g-f);c=Math.max(c,l.clientHeight-e)}this._SetVirtualPagingBottomHeights(c,true)},_GetMaxScrollTop:function(){var b=this.GetSpreadContext(),f=this.Spread,c,d=b.getScrollvp?b.getScrollvp():null,a=f.virtualTop;if(d!=null){this._UpdateDummyHeight();var g=b.getDummy();c=Math.max(a,a+g.offsetHeight-d.clientHeight)}else{var i=b.getViewport(),h=i.parentNode,e=this._GetViewportSize();c=Math.max(a,a+e.height-h.clientHeight)}return c},_SaveVirtualPagingBottomOriginalHeights:function(){for(var c=this._GetVirtualPagingBottomElements(),b=0;b<c.length;b++){var a=c[b];if(a._originalHeight==null)a._originalHeight=a.style.height!=""?parseInt(a.style.height):0}},_SetVirtualPagingBottomHeights:function(c,m){var l=this.IsMultiBrowserMode();if(l&&!this.AllowVirtualScrollPaging)return false;var n=this.document.getElementById(this.Spread.id+"_dummy_VPBottom"),k=0;if(c!=null){var d=this.GetSpreadContext(),b=d.getRowHeader(),g=b!=null&&b.rows.length>0?b.offsetHeight-(l?0:b.rows[b.rows.length-1].offsetHeight):-1,j=d.getNoRow(-1),h=j!=null?d.getViewport().offsetHeight+j.offsetHeight:d.getViewport().offsetHeight;if(g>h)k=g-h}for(var i=this._GetVirtualPagingBottomElements(),f=0;f<i.length;f++){var a=i[f],e=(m&&a._originalHeight!=null?a._originalHeight:0)+(c!=null?c:0);if(a!=n)e+=k;if(parseInt(a.style.height)!=e){a.style.height=e+"px";a.style.display=e>0?"":"none"}}return c>0},_GetVirtualPagingBottomElements:function(c){if(!this.document.getElementById)return[];var a=this.Spread,b=[this.document.getElementById(a.id+"_VirtualPaging_Bottom"),this.document.getElementById(a.id+"_VirtualPaging_Bottom2"),this.document.getElementById(a.id+"_dummy_VPBottom")];!c&&$$.utils.cleanArray(b);return b},_IsCellHidden:function(b,d,c){if(b==null)return true;var a=c;if(a==null)a=this.Parent==null?this._GetViewportFromCell(b):this.GetTopSpreadView().Viewport;return a==null?true:this._IsElementHidden(b,a.parentNode,d)},_IsElementHidden:function(n,a,j){var b=n.getBoundingClientRect(),d=a.getBoundingClientRect(),l={top:d.top,left:d.left,bottom:d.top+a.clientHeight,right:d.left+a.clientWidth},i=function(a,b,c){return c?a.top<b.top||a.left<b.left||a.bottom>b.bottom||a.right>b.right:a.bottom<=b.top||a.right<=b.left||a.top>=b.bottom||a.left>=b.right},e=i(b,l,j);if(e&&(!$$.browser.ie||$$.browser.version>=10)){var g=0,f=0,c=this.GetTopSpreadView(),k=c.GetSpreadContext();if(k.getSpreadControl(a)==this.Spread){var h=k.getSafeMaxScrollValues(),m=c.Viewport.parentNode,o=c.Viewport1?c.Viewport1.parentNode:null,p=c.Viewport2?c.Viewport2.parentNode:null;if(a==m||a==o)f=a.scrollWidth-a.clientWidth-h.MaxScrollLeft;if(a==m||a==p)g=a.scrollHeight-a.clientHeight-h.MaxScrollTop;b={top:b.top-g,left:b.left-f,right:b.right-f,bottom:b.bottom-g};e=i(b,l,j)}}return e},_GetScrollValuesState:function(){for(var a=this.GetSpreadContext(),d=0,e=a.getScrollvp(),c=[a.getColHeader(),a.getColFooter(),a.getViewport1(),a.getViewport()],g=e!=null?e.scrollLeft:null,h=e!=null?e.scrollTop:null,b=0;b<c.length;b++){var f=c[b];if(f!=null){var i=f.parentElement.scrollLeft;if(g==null)g=i;else if(g!=i){d=d|1;break}}}c=[a.getRowHeader(),a.getViewport2(),a.getViewport()];for(var b=0;b<c.length;b++){var f=c[b];if(f!=null){var j=f.parentElement.scrollTop;if(h==null)h=j;else if(h!=j){d=d|2;break}}}return d},_CanMoveToPage:function(){var c=this._GetHorizontalScrollingViewport(),j=c.parentNode,a={canMove:false,ToPage:-1};if(c==null||j==null||this.GetAttribute("virtualPaging")!="true")return a;var l=this.Spread.virtualTop,h=0,i=this.GetAttribute("topRow");if(i!=null){var f=this._GetKeyedTableRowIndex(i,true);if(f>=0&&f<c.rows.length){h=c.rows[f].offsetTop;if(c.cellSpacing!=null)h-=parseInt(c.cellSpacing)}}var e=this._GetSafeScrollingArea(),g=parseInt(this.GetAttribute("__defaultPageHeight")),d=j.scrollTop,k=parseInt(this.GetAttribute("pageCount")),b=this.GetAttribute("currentPageIndex");b=b!=null?parseInt(b):0;if(d<e.min)a.ToPage=Math.max(0,b-Math.ceil((e.min-d)/g));else if(d>e.max)a.ToPage=Math.min(k-1,b+Math.ceil((d-e.max)/g));if(a.ToPage!=-1&&a.ToPage!=b)a.canMove=true;else a.ToPage=-1;return a},_GetSafeScrollingArea:function(){var b=this._GetHorizontalScrollingViewport(),h=b.parentNode;if(b==null||h==null||this.GetAttribute("virtualPaging")!="true")return{min:0,max:Number.MAX_VALUE};var a=this._SafeScrollingArea||{min:Number.MAX_VALUE,max:0};if(a.min==null)a.min=Number.MAX_VALUE;if(a.max==null)a.max=0;var c=0,g=this.GetAttribute("topRow");if(g!=null){var d=this._GetKeyedTableRowIndex(g,true);if(d>=0&&d<b.rows.length){c=b.rows[d].offsetTop;if(b.cellSpacing!=null)c-=parseInt(b.cellSpacing)}}var f=b.offsetHeight-c-h.clientHeight,e=this.Spread.virtualTop,i=f>0?e+c+f:e+c;a.min=Math.min(a.min,e);a.max=Math.max(a.max,i);return a},_SetSafeScrollingMIN:function(a){if(this._SafeScrollingArea==null)this._SafeScrollingArea={min:a};else this._SafeScrollingArea.min=a},_SetSafeScrollingMAX:function(a){if(this._SafeScrollingArea==null)this._SafeScrollingArea={max:a};else this._SafeScrollingArea.max=a},_GetViewportByPart:function(b){var a=this.Spread.id+"_viewport";if(b>-1)a=a+b.toString();var c=this.document.getElementById(a);return c},_GetNoRow:function(b,d){if(!d&&this.ColumnCount>0){var a=this._GetViewportByPart(b);if(a&&a.rows.length>0&&this.GetSpreadContext().getColGroup(a).childNodes.length>0)return null}var c=this.Spread.id+"_NoRow";if(b>-1)c=c+b.toString();var e=this.document.getElementById(c);return e},_RemoveNoRow:function(c){var a=this._GetNoRow(c,true);if(a!=null){var b=a.parentNode;b.removeChild(a)}},AllowNonEditValidation:function(){return this.Parent!=null?this.GetTopSpreadView().AllowNonEditValidation():this.Spread.getAttribute("DisableNonEditModeValidation")==null},GetValidationMessage:function(){if(this.Parent!=null)return this.GetTopSpreadView().GetValidationMessage();var a=this.Spread.getAttribute("lcidMsg");if(a==null){var b=GcResources[this.GetCulture(this.Spread)];a=b.Common.InvalidCellValue||"Can't set the data into the cell. The data type is not correct for the cell."}return a},HasValidators:function(a){if(a==null)return false;var b=a.getAttribute("FpValidatorID");return b!=null&&b!=""},GetInvalidValidator:function(cell,value,event){if(cell==null)return null;var idList,ids=cell.getAttribute("FpValidatorID");if(ids==null)return null;if(ids!=null&&ids!="")idList=ids.split(";");for(var validators=[],i=0;i<idList.length;i++){var validator=this.document.getElementById(idList[i]);if(validator==null)continue;validator.isvalid=true;validator.style.display="none";validators.push(validator)}var ctx=this.GetSpreadContext(),editingInfo=this.Spread.getEditingInfo(),editor=editingInfo!=null&&$$.utils.contains(cell,editingInfo.Editor)?editingInfo.Editor:null;if(editor!=null||this.AllowNonEditValidation()){if(editor==null){editor=ctx.getEditor(cell);if(editor==null){var editorId=ctx.getCellEditorID(cell);if(editorId!=null)editor=ctx.getCellEditor(editorId,true)}}for(var tempEditorCreated=false,i=0;i<validators.length;i++){var validator=validators[i];if(typeof validator.evaluationfunction=="string"){var func=validator.evaluationfunction;validator.evaluationfunction=eval(func);if(validator.evaluationfunction==undefined)eval("document.getElementById('"+validator.id+"').evaluationfunction = "+func)}if(typeof validator.evaluationfunction=="function"){if(validator.oldControlToValidate==null||!$$.utils.contains(document.body,document.getElementById(validator.oldControlToValidate))){if(validator.oldControlToValidate!=null&&!$$.utils.contains(this.Spread,validator))validator.oldControlToValidate=null;else validator.oldControlToValidate=validator.controltovalidate;if(editor==null){tempEditorCreated=true;editor=document.createElement("INPUT");editor.type="text";editor.id=this.Spread.id+"_temporaryValidatorTarget";editor.style.display="none";this.Spread.appendChild(editor)}validator.controltovalidate=editor.id}var tmp=this.document.getElementById(validator.controltovalidate);if(tmp!=null){var bkVal=value;if(editingInfo!=null&&editingInfo.Editor!=null)if(editingInfo.Editor.getAttribute("enf")!=null||editingInfo.Editor.getAttribute("efp")!=null){var isCurrency=new GCWS.Cell(cell).GetCellType()=="CurrencyCellType",num=this.Spread.fpSpreadJS.getNumber(editingInfo.Editor,value,true,isCurrency);if(num!=null)value=num}else if(editingInfo.Editor.getAttribute("edf")!=null||editingInfo.Editor.getAttribute("ef")!=null){var objDate=this.Spread.fpSpreadJS.parseDate(editingInfo.Editor,value,true);if(objDate!=null)value=this.Spread.fpSpreadJS.formatDateToFormatString(objDate,"d")}var currentTargetValue=null;if(tmp.value!=value){currentTargetValue=tmp.value;tmp.value=value==null?"":value}validator.isvalid=validator.evaluationfunction(validator,event);if(bkVal!=value&&bkVal!=null)tmp.value=bkVal;else if(currentTargetValue!=null)tmp.value=currentTargetValue;value=bkVal}if(validator.isvalid&&validator.oldControlToValidate!=null){validator.controltovalidate=validator.oldControlToValidate;validator.oldControlToValidate=null}}tempEditorCreated&&editor!=null&&editor.parentNode.removeChild(editor);if(!validator.isvalid)return validator}}return null},_ResetValidatorStates:function(e){if(e==null)return null;var c,b=e.getAttribute("FpValidatorID");if(b==null)return null;if(b!=null&&b!="")c=b.split(";");for(var d=0;d<c.length;d++){var a=this.document.getElementById(c[d]);if(a==null)continue;a.isvalid=true;a.style.display="none";if(a.oldControlToValidate!=null){a.controltovalidate=a.oldControlToValidate;a.oldControlToValidate=null}}},_SetTargetInputOldValue:function(e,f){if(e==null)return;var c,a=e.getAttribute("FpValidatorID");if(a==null)return;if(a!=null&&a!="")c=a.split(";");for(var d=0;d<c.length;d++){var b=this.document.getElementById(c[d]);b!=null&&typeof b.SetTargetInputOldValue!="undefined"&&b.SetTargetInputOldValue(f)}},_DisableSpreadValidators:function(){if(typeof Page_Validators=="undefined")return;for(var c=this.GetSpreadContext(),f=null,d=0;d<Page_Validators.length;d++){var a=Page_Validators[d];if(a!=null&&a.getAttribute("__FpSpread")=="1"){var e=c.getSpreadControl(a,true);if(e==null)continue;if(e.id!=this.Spread.id){if(f==null)f=c.getTopSpread(this.document.getElementById(this.Spread.id));var j=c.getTopSpread(this.document.getElementById(e.id));if(f!=j)continue}if(!a.isSpreadValidatorWrapper){var i=this.document.getElementById(a.controltovalidate),h=c.getCell(i,true),g=c.getEditor(h);if(g!=null)continue;if(a.enabled!=null)a.oldEnabled=a.enabled;typeof ValidatorEnable!="undefined"&&ValidatorEnable(a,false);a.style.display="none";var b=this.document.createElement("span");b.id=a.id;b.controltovalidate=a.controltovalidate;b.isSpreadValidatorWrapper=true;b.isvalid=true;b.validator=a;b.spreadId=this.Spread.id;b.enabled=false;b.setAttribute("__FpSpread","1");Page_Validators[d]=b}else a.validator.style.display="none"}}},_EnableSpreadValidators:function(){if(typeof Page_Validators=="undefined")return;for(var d=this.GetSpreadContext(),c=null,b=0;b<Page_Validators.length;b++){var a=Page_Validators[b];if(a!=null&&a.isSpreadValidatorWrapper){if(a.spreadId!=this.Spread.id){if(c==null)c=d.getTopSpread(this.document.getElementById(this.Spread.id));var e=d.getTopSpread(this.document.getElementById(a.spreadId));if(c!=e)continue}if(a.validator.oldEnabled!=null){a.validator.enabled=a.validator.oldEnabled;a.validator.oldEnabled=null}else a.validator.enabled=true;Page_Validators[b]=a.validator}}},_CleanValidators:function(){if(typeof Page_Validators=="undefined")return;for(var a=0;a<Page_Validators.length;){var b=Page_Validators[a];if(b==null){Page_Validators.splice(a,1);continue}a++}},_DoExtendedSelect:function(b,a){var c=this.GetSpreadContext();c.ClearSelection(false,null,false);var e=Math.min(b,a),d=Math.abs(b-a)+1;c.selectRow(e,d,true,true)},_GetFirstCellFromLayoutCol:function(h,g,c){var a=this.GetSpreadContext(),b=g?a.getColHeader():null;if(g&&b==null)return null;var j=b!=null?b.rows.length:a.GetRowCountInternal(),i=b!=null?a.getColGroup(b).childNodes.length:a.GetColCount();if(c==null||c<0)c=0;for(var f=c;f<j;f++)for(var e=0;e<i;e++){var d=g?a.getHeaderCellFromRowCol(f,e,true):a.getCellFromRowCol(f,e);if(d!=null&&d.getAttribute("col")==h){if(d.getAttribute("group")!=null)break;return d}}return null},_GetHeaderCellFromViewportCell:function(g){var a=this.GetSpreadContext(),c=a.getColHeader();if(c==null)return null;for(var f=a.getColFromCell(g),i=g.parentNode.getAttribute("row"),b=null,d=0;d<c.rows.length;d++)if(c.rows[d].getAttribute("row")==i){b=d;break}if(b==null)return null;var h=a.getSpanCells(c),e=a.getSpanCell(b,f,h);return e==null||e.row==b&&e.col==f?a.getHeaderCellFromRowCol(b,f,true):null},_GetViewportCellFromHeaderCell:function(i,b){var a=this.GetSpreadContext(),f=a.frzRowCount(),h=a.getColFromCell(i),d=b==null?a.getViewport1()||a.getViewport():b<f?a.getViewport1():a.getViewport();if(d==null)return null;if(b==null||b<0)b=0;else if(b>=f)b-=f;for(var k=i.parentNode.getAttribute("row"),c=null,e=b;e<d.rows.length;e++)if(d.rows[e].getAttribute("row")==k){c=e;break}if(c==null)return null;if(d==a.getViewport())c+=a.frzRowCount();var j=a.getSpanCells(d),g=a.getSpanCell(c,h,j);return g==null||g.row==c&&g.col==h?a.getCellFromRowCol(c,h):null},_IsColumnHeaderCell:function(a){var b=this.GetSpreadContext(),d=b.getColHeader(),c=b.getFrozColHeader();return d!=null&&$$.utils.contains(d,a)||c!=null&&$$.utils.contains(c,a)},_getPreferredCellWidth:function(c,f){var e=this.Spread.getSpreadView().GetSpreadContext().getPreferredCellWidth(c,f);if(c.getAttribute("cdf")=="1"){var a=this.GetCellCDFs(c),d=a.length;if(a!=null&&d>0)for(var b=0;b<d;b++)if(a[b].Type=="i")e+=a[b].Holder.offsetWidth}return e},HideFloatingElements:function(){var b=false;if(this.ActiveContextMenu){b=$$.utils.contains(this.ActiveContextMenu.Holder,document.activeElement)||this.ActiveContextMenu.Holder==document.activeElement;this.ActiveContextMenu.Hide()}var a=GrapeCity.Web.DatePicker.GetInstance();if(a!=null&&!$$.utils.contains(document.body,a.Target)){var c=a._GetDatePickerContainer();b|=$$.utils.contains(c,document.activeElement)||c==document.activeElement;a.Hide()}if(b){var d=document.getElementById(this.Spread.id+"_textBox");d!=null&&d.focus()}},ProcessResize:function(){this.Spread.getSpreadView().GetSpreadContext().processResize()},GetViewportFromPoint:function(e,f,g){var a=this.Viewports;if(g){if(this.RowHeaders)a=a.concat(this.RowHeaders);if(this.ColumnHeaders)a=a.concat(this.ColumnHeaders)}for(var d=0;d<a.length;d++){var c=a[d];if(c){view=c.parentNode;var b=view.getBoundingClientRect();if(b.left<=e&&e<b.right&&b.top<=f&&f<b.bottom)return c}}return null},GetCellFromPoint:function(j,g,n){var a=this.GetViewportFromPoint(j,g,n);if(a==null||a.rows.length==0)return null;var b=a.getBoundingClientRect();j-=b.left;g-=b.top;for(var m=parseInt(a.cellSpacing),I=a.rows.length,i=null,C=false,b=0;r=a.rows.length,b<r;b++){i=a.rows[b];var K=i.offsetTop,B=b==I-1,u=B?a.clientHeight:a.rows[b+1].offsetTop;if(K<=g)if(g<u||B&&g==u){if(i.getAttribute("previewrow")!=null||this._IsChildSpreadRow(b))return null;C=true;break}}if(C)for(var c=this.GetSpreadContext(),e=this.Spread,f=n&&(a==e.getFrozColHeader()||a==e.getColHeader()||a==e.getFrozColFooter()||a==e.getColFooter()),k=n&&(a==e.getFrozRowHeader()||a==e.getRowHeader()),v=a==this.Viewport0||a==this.Viewport2||f&&(a==e.getFrozColHeader()||a==e.getFrozColFooter()),D=a==this.Viewport0||a==this.Viewport1||k&&a==e.getFrozRowHeader(),x=c.frzColCount(),G=c.frzRowCount(),H=k||v?0:x,t=k?c.getColGroup(a).children.length:v?x:c.GetColCount(),r=f?a.rows.length:D?G:c.GetRowCountInternal(),o=k||f,b=f?i.rowIndex:c.getRowIndexFromRow(i),h=H;h<t;h++){var d=o?c.getHeaderCellFromRowCol(b,h,f):c.getCellFromRowCol(b,h);if(d==null)continue;var w=parseInt(d.colSpan),A=parseInt(d.rowSpan),s=d.offsetLeft;if(s<=j){var J=d.offsetTop,E=h+w>=t,F=b+A>=r,q,p;if(E)q=a.clientWidth-m;else{var y=h+w,l=o?c.getHeaderCellFromRowCol(b,y,f):c.getCellFromRowCol(b,y);q=l?l.offsetLeft-m:d.offsetLeft+d.offsetWidth}if(F)p=a.clientHeight-m;else{var z=b+A,l=o?c.getHeaderCellFromRowCol(z,0,f):c.getCellFromRowCol(z,0);p=l?l.offsetTop-m:d.offsetTop+d.offsetHeight}if(s<=j&&j<=q&&J<=g&&g<=p)return d}}return null},_GetViewportFromCell:function(e,d){var b=[this.Viewport,this.Viewport2,this.Viewport1,this.Viewport0];if(d){if(this.RowHeaders!=null)for(var a=0;a<this.RowHeaders.length;a++)b.push(this.RowHeaders[a]);if(this.ColumnHeaders!=null)for(var a=0;a<this.ColumnHeaders.length;a++)b.push(this.ColumnHeaders[a])}for(var f=this.GetSpreadContext(),a=0;a<b.length;a++){var c=b[a];if(c==null)continue;if($$.utils.contains(c,e))return c}return null},_UpdateEmptyViewportsHeight:function(){for(var k=this.Spread,b=this.GetSpreadContext(),n=b.getViewport0(),o=b.getViewport1(),i=b.getViewport2(),c=b.getViewport(),m=[n,o,i,c],l=[0,1,2,-1],g=false,f=0;f<l.length;f++){var d=l[f],h=b.getNoRow(d),c=m[f];if(h!=null){var j=parseInt(c.cellSpacing),e=Math.max($$.browser.mb?1:0,c.parentNode.clientHeight-c.offsetHeight-j);if(d==-1&&i!=null)e=Math.max(e,i.offsetHeight-c.offsetHeight-j);h.style.height=e+"px";if(e>0)h.innerHTML="&nbsp;";g=true}var a=null;if(d==-1)a=this.document.getElementById(k.id+"_VirtualPaging_Bottom");else if(d==2)a=this.document.getElementById(k.id+"_VirtualPaging_Bottom2");if(a!=null){a.style.display=a!=null&&parseInt(a.style.height)==0&&a.offsetHeight>0?"none":"";g=true}}g&&this._UpdateDummyHeight()},_UpdatePaddingDivs:function(){if($$.browser.webkit&&!FarPoint.Web.Spread.SafariPatch.EnableWebkitScroll)for(var m=[this.Viewport,this.Viewport2,this.Viewport1],j=0;j<m.length;j++){var n=m[j];if(n==null)continue;var b=m[j].parentNode,a=null,i=-1,l=-1;if(b.scrollWidth>b.clientWidth&&b.scrollHeight<=b.clientHeight)l=b.clientHeight-n.offsetHeight+1;else if(n.scrollHeight>b.clientHeight&&b.scrollWidth<=b.clientWidth)i=b.clientWidth+1;a=window.document.getElementById(b.id+"_forcer");if(i>0||l>0){if(a==null){a=document.createElement("DIV");a.id=b.id+"_forcer";a.style.backgroundColor="transparent";a.style.color="transparent";a.style.borderStyle="none";b.appendChild(a)}a.setAttribute("direction",i>0?"horizontal":"vertical");a.style.height=Math.max(l,1)+"px";a.style.width=Math.max(i,1)+"px"}else a&&a.parentNode.removeChild(a)}var g=this.GetSpreadContext(),f=this._GetViewportSize(),e=g.getRowHeader();if(g.getParentSpread()==null&&e!=null)if(this.IsMultiBrowserMode()){var h=this.RowHeader.GrayArea;if(h){var d=Math.max(f.height,(this.Viewport||this.Viewport2).parentNode.offsetHeight)-(e.offsetHeight+h.offsetHeight);if(d>0)h.style.height=Math.max(e.parentNode.offsetHeight,parseInt(h.style.height)+d*2)+"px"}}else if(e.rows.length>0){var d=f.height-e.offsetHeight;if(d>0){var o=e.rows[e.rows.length-1];o.style.height=parseInt(o.style.height)+d+"px"}}if(typeof g.hasChart=="undefined"||!g.hasChart())return;if(this.Viewport1!=null){var c=document.getElementById(this.Spread.id+"_scroll_padding1");if(c!=null)if(!$$.browser.mb){var p=Math.max(this.Viewport1.offsetWidth,c.offsetWidth),d=f.width-p;if(d>0)c.style.width=p+d+"px"}else{var r=Math.max(this.Viewport1.offsetWidth,f.width);c.style.width=r+"px"}}if(this.Viewport2!=null){var c=document.getElementById(this.Spread.id+"_scroll_padding2");if(c!=null)if(!$$.browser.mb){var q=Math.max(this.Viewport2.offsetHeight,c.offsetHeight),d=f.height-q;if(d>0)c.style.height=q+d+"px"}else{var k=Math.max(this.Viewport2.offsetHeight,f.height)-this.Viewport2.offsetHeight;k=Math.ceil(k);c.style.height=k+"px"}}},HasChart:function(){if(this.Parent!=null)return this.GetTopSpreadView().HasChart();if(this._hasChart!=null)return this._hasChart;this._hasChart=typeof FpChartUtil!=="undefined"&&FpChartUtil.getChartsIdCollection(this.Spread).length>0;return this._hasChart},GetCharts:function(){if(this.HasChart()){if(typeof this.chartCollection=="undefined")this.chartCollection=FpChartUtil.getChartsIdCollection(this.Spread);return this.chartCollection}return[]},HasChildViews:function(){return this.Spread.fpSpreadJS.childViewIndexes.length},_UpdateDummyHeight:function(g){var a=this.GetSpreadContext(),n=a.isSmartPaint()||a.isMBSmartPaint&&a.isMBSmartPaint(),o=a.GetRowCountInternal(),b=a.getDummy();if(b==null)return;if(this.GetAttribute("ClientAutoSize")=="True"&&this.ClientAutoSizeMaxHeight()==0&&this.ClientAutoSizeMaxWidth()==0){b.style.height="0px";b.style.width="0px";return}if(this.IsMultiBrowserMode()){var C=this._CalculateViewportSizes();b.style.height=C.Height+"px";b.style.width=C.Width+"px";if(!n&&o==0)b.style.width="0px"}else{var A=a.getFrozColHeader(),f=a.getColHeader(),z=a.getFrozColFooter(),e=a.getColFooter(),K=a.getFrozRowHeader(),j=a.getRowHeader(),p=a.getNoRow(0),q=a.getNoRow(1),B=a.getNoRow(2),J=a.getNoRow(-1),H=a.frzRowCount(),G=a.frzColCount(),F=a.getScrollvp(),x=0,w=0,t=null;if($$.browser.ie&&$$.browser.ieversion==10&&a.backupTablePositions){var k=[];this.Viewport0&&(this.Viewport0.offsetHeight<=1||this.Viewport0.offsetWidth<=1)&&k.push(this.Viewport0);this.Viewport1&&(this.Viewport1.offsetHeight<=1||this.Viewport1.offsetWidth<=1)&&k.push(this.Viewport1);this.Viewport2&&(this.Viewport2.offsetHeight<=1||this.Viewport2.offsetWidth<=1)&&k.push(this.Viewport2);this.Viewport&&(this.Viewport.offsetHeight<=1||this.Viewport.offsetWidth<=1)&&k.push(this.Viewport);t=a.backupTablePositions(k)}var s=this._GetViewportSize(g);if(!n&&o==0)b.style.width="0px";else{var c=0;if(!n||o>0){if(!g&&p!=null)c=Math.max(c,p.offsetWidth);if(this.Viewport0!=null)c=Math.max(c,this.Viewport0.offsetWidth);if(!g&&B!=null)c=Math.max(c,B.offsetWidth);if(this.Viewport2!=null)c=Math.max(c,this.Viewport2.offsetWidth);if(A!=null)c=Math.max(c,A.offsetWidth);if(z!=null)c=Math.max(c,z.offsetWidth)}var d=s.width;if(!g&&q!=null)d=Math.max(d,q.offsetWidth);if(this.Viewport1!=null)d=Math.max(d,this.Viewport1.offsetWidth);if(f!=null){var h=a.getColGroup(f);if(h.children.length>0){x=f.offsetWidth-parseInt(h.children[h.children.length-1].width)-parseInt(f.cellSpacing);d=Math.max(d,x)}}if(e!=null){var h=a.getColGroup(e);if(h.children.length>0){w=e.offsetWidth-parseInt(h.children[h.children.length-1].width)-parseInt(e.cellSpacing);d=Math.max(d,w)}}if(G>0&&d>0){var r=c+d-parseInt(this.Viewport.cellSpacing);if(n&&o==0){var v=0;if(f||e){var E=r-F.clientWidth,m;if(f)m=x-f.parentNode.clientWidth;if(e)m=Math.max(m,w-e.parentNode.clientWidth);v=m-E}if(v>0)r+=v;J.style.width=r+"px"}b.style.width=r+"px"}else if(d>0)b.style.width=d+"px";else b.style.width="0px"}var l=0;if(this.Viewport0!=null)l=this.Viewport0.offsetHeight;if(!g&&p!=null)l+=p.offsetHeight;var y=0;if(this.Viewport1!=null)y=this.Viewport1.offsetHeight;if(!g&&q!=null)y+=q.offsetHeight;l=Math.max(l,y);var i=s.height;if(j!=null&&j.rows.length>0){var I=j.offsetHeight-j.rows[j.rows.length-1].offsetHeight-parseInt(j.cellSpacing);i=Math.max(i,I)}var u=parseInt(this.Viewport.cellSpacing);if(H>0&&i>0){var D=l+i-u;if(!s.heightExtendByChart)D-=u;b.style.height=D+"px"}else if(i>0)b.style.height=i-u+"px";else b.style.height="0px";t&&a.restoreTablePositions&&a.restoreTablePositions(t)}},RelayoutViewport:function(){var d=this.GetSpreadContext();if(this.IsClientAutoSize())this.Spread.sizeSpread(true);else if(this.FrozenTableColumnCount!=0||this.FrozenTableRowCount!=0||this.UIVirtualization()){var a=d.getScrollvp(),h=d.getViewportHolder(),f=this.Viewport0||this.Viewport1,j=a.offsetHeight-(f?f.parentNode.offsetHeight:0);f=this.Viewport0||this.Viewport2;var k=a.offsetWidth-(f?f.parentNode.offsetWidth:0),i=0,g=0;this._UpdateDummyHeight(true);g=a.offsetHeight-a.clientHeight;i=a.offsetWidth-a.clientWidth;h.style.width=a.clientWidth+"px";h.style.height=a.clientHeight+"px";h.style.marginBottom=g+"px";var m=d.getColHeader(),l=d.getColFooter(),b=[m,this.Viewport1,this.Viewport,l];$$.utils.cleanArray(b);if(b.length>0)for(var e=0;e<b.length;e++){var c=b[e];if(c==m||c==l)c.parentNode.style.width=k+"px";else c.parentNode.style.width=Math.max(1,k-i)+"px"}var n=d.getRowHeader();b=[n,this.Viewport2,this.Viewport];$$.utils.cleanArray(b);for(var e=0;e<b.length;e++){var c=b[e];if(c==n)c.parentNode.style.height=Math.max(1,j)+"px";else c.parentNode.style.height=Math.max(1,j-g)+"px"}this._UpdateEmptyViewportsHeight();this._UpdatePaddingDivs()}else d.GetRowCountInternal()==0&&this._UpdateEmptyViewportsHeight()},_GetViewportSize:function(n){if(this.IsMultiBrowserMode()){var a=this._CalculateViewportSizes();if(a.ViewHeight>1)a.ViewHeight+=this.CellSpacing;var m=this.Spread,o={top:m.virtualTop,left:0,width:a.ViewWidth,height:a.ViewHeight,right:a.ViewWidth,bottom:m.virtualTop+a.ViewHeight};return o}var l=this.GetSpreadContext(),g=l.getViewport(),j=this.Spread.virtualTop,i=0,c=$$.browser.quirksMode&&$$.browser.ie&&$$.browser.ieversion<10?g.offsetHeight:Math.max(1,g.offsetHeight),f=g.offsetWidth;if(g.rows.length==0&&!n){var h=l.getNoRow(-1);if(h!=null){c+=h.offsetHeight;f=h.offsetWidth}}var k=false,e=i+f,b=j+c;if(typeof FpChartUtil!="undefined"){var d=FpChartUtil.getUnionChartsBounds(this.Spread);if(d!=null){e=Math.max(e,d.right);k=d.bottom>b;b=Math.max(b,d.bottom);c=b-j;f=e-i}}return{top:j,left:i,height:c,width:f,right:e,bottom:b,heightExtendByChart:k}},_CalculateViewportSizes:function(){var e={FrozenWidth:0,FrozenHeight:0,ViewWidth:0,ViewHeight:0,Width:0,Height:0,IsWidthExtended:false,IsHeightExtended:false},h=this,c=window.FpChartUtil?window.FpChartUtil.getUnionChartsBounds(h.Spread):null;if(c){c.top=Math.max(0,c.top);c.left=Math.max(0,c.left)}var d=h.GetSpreadContext(),b=1,a;a=[d.getFrozColHeader(),d.getViewport0(),d.getViewport2(),d.getFrozColFooter()];$$.utils.cleanArray(a);if(a.length>0){b=1;for(var f=0;f<a.length;f++){var g=a[f];if(g)b=Math.max(b,g.offsetWidth-h.CellSpacing)}e.FrozenWidth=b}a=[d.getFrozRowHeader(),d.getViewport0(),d.getViewport1()];$$.utils.cleanArray(a);if(a.length>0){b=1;for(var f=0;f<a.length;f++){var g=a[f];if(g)b=Math.max(b,g.offsetHeight-h.CellSpacing)}e.FrozenHeight=b}a=[d.getColHeader(),d.getViewport1(),d.getViewport(),d.getColFooter()];$$.utils.cleanArray(a);if(a.length>0){b=1;for(var f=0;f<a.length;f++){var g=a[f];if(g)b=Math.max(b,g.offsetWidth)}if(c&&b<c.right-c.left){b=c.right-c.left;e.IsWidthExtended=true}e.ViewWidth=b}a=[d.getRowHeader(),d.getViewport2(),d.getViewport()];$$.utils.cleanArray(a);if(a.length>0){b=1;for(var f=0;f<a.length;f++){var g=a[f];if(g)b=Math.max(b,g.offsetHeight-h.CellSpacing)}if(c&&b<c.bottom-c.top){b=c.bottom-c.top;e.IsHeightExtended=true}e.ViewHeight=b}e.Width=e.FrozenWidth+e.ViewWidth;e.Height=e.FrozenHeight+e.ViewHeight;return e},_IsGrayArea:function(a,f,g){var b=this.GetSpreadContext();if(g){var c=b.getSpreadControl(a,true);if(c==null||!c.getSpreadView)return false;if(c!=this.Spread)return c.getSpreadView()._IsGrayArea(a,f)}if(this.GetCommandBar().Contains(a,g))return true;if(a==null||a.tagName=="BODY"||a.tagName=="FORM"||a.tagName=="HTML"||$$.utils.isNativeControl(a))return false;if(a.getAttribute)if(a.getAttribute("ControlType")=="chgrayarea"||a.getAttribute("ControlType")=="chgrayarea_container"||a.getAttribute("ControlType")=="footergrayarea"||a.getAttribute("FpSpread")=="rowpadding")return true;for(var j=["view","vp0","vp1","vp2"],e=0;e<j.length;e++)if(a==document.getElementById(this.Spread.id+"_"+j[e]))return true;if(!f){var i=b.getTitleBar()||b.getSubTitleBar();if(i==a||$$.utils.contains(i,a))return true}var h=b.getChartObj(a);if(h&&!h.canSelect())return true;var k=b.getRowHeader(),d=FpSpreadJS.getTableRow(a);if($$.utils.contains(k,d)&&d.getAttribute("FpSpread")=="rh")if(this._IsChildSpreadRow(d.rowIndex))return true;if($$.browser.mb)if(this.Parent&&($$.utils.contains(a,b.getColHeader())||$$.utils.contains(a,b.getViewport()))&&b.getSpreadControl(a)==this.Spread)return true;return false},_IsDragableSupport:function(b){if(b==null||!this.IsMultiBrowserMode())return false;var e=this.GetTopSpreadView();if(e.Pager.Contains(b)||e.GroupBar.Contains(b))return true;var f=this.GetSpreadContext(),a=f.getChartObj(b);if(a&&a.canSelect()&&a.isActived){var d=a.container,c=a.isResizeHandler(b);if(c&&d.getAttribute("sizeChart")!="false"||!c&&d.getAttribute("moveChart")!="false")return true}return false},_HookDocumentFocusInEvent:function(){if(this._OnDocumentFocusIn==null){var a=this;this._OnDocumentFocusIn=function(k){if(a.Spread!=a.document.getElementById(a.Spread.id)){a._DetachDocumentFocusIn();a._OnDocumentFocusIn=null;a=null;return}var h=a.document.FpActiveSpread;if(h==null||a.Spread!=h)return;var c=a.GetSpreadContext(),d=a.Spread,i=d.getSpreadView(),b=FarPoint.System.GetTarget(k);if(c.getSpreadControl(b)==null){var f=GrapeCity.Web.DatePicker.GetInstance();if(f!=null&&f._isActivated()){var j=c.getSpreadControl(f.Target);if(c.getTopSpread(j)==c.getTopSpread(a.Spread))return}if(b!=null&&b!=a.document&&b.tagName!="BODY"&&!$$.utils.contains(d,b)&&(i.ActiveDialog==null||!$$.utils.contains(i.ActiveDialog.Dialog,b))){a._DetachDocumentFocusIn();var e=a.GetHostSpread(b);if(e==null)(document.FpActiveSpread==d||c.isChild(document.FpActiveSpread,d))&&a.GetMultiColumnComboBoxContainer(b)==null&&document.FpActiveSpread.getSpreadView().ActivateSpread(null,true);else{var g=e.getSpreadView();g.ActiveDialog!=null&&$$.utils.contains(g.ActiveDialog.Dialog,b)&&document.FpActiveSpread.getSpreadView().ActivateSpread(e,true)}}}}}var b=$$.j(document);b.off("focusin",this._OnDocumentFocusIn);b.on("focusin",this._OnDocumentFocusIn)},_DetachDocumentFocusIn:function(){if(this._OnDocumentFocusIn){var a=$$.j(document);a.off("focusin",this._OnDocumentFocusIn)}},_HookFormOnSubmit:function(){var b=$$(this.Spread).getParent("FORM");if(b==null||this._OnFormSubmit!=null)return true;var a=this,c=this._GetPageRequestManager();this._OnFormSubmitOriginal=c!=null?c._onsubmit:b.onsubmit;this._OnFormSubmit=function(){if(a==null||!a.document.getElementById)return true;var b=true;if(a.Spread==a.document.getElementById(a.Spread.id)){a.SaveAllXmlData();var c=a._OnFormSubmitOriginal;a._UnHookFormOnSubmit();a._OnFormSubmit=null;if(c!=null)b=c.apply(this,arguments);if(!b)a._HookFormOnSubmit();else a=null}return b};if(c!=null)c._onsubmit=this._OnFormSubmit;else{b.onsubmit=null;b.onsubmit=this._OnFormSubmit}},_UnHookFormOnSubmit:function(){var a=$$(this.Spread).getParent("FORM");if(a==null)return;var b=this._GetPageRequestManager();if(b!=null)b._onsubmit=this._OnFormSubmitOriginal;else{if(a.onsubmit==this._OnFormSubmit)a.onsubmit=null;FarPoint.System.DetachEvent(a,"submit",this._OnFormSubmit,false);if(this._OnFormSubmitOriginal!=null)a.onsubmit=this._OnFormSubmitOriginal}this._OnFormSubmitOriginal=null;this._OnFormSubmit=null},_GetPageRequestManager:function(){return typeof Sys!="undefined"&&Sys.WebForms&&Sys.WebForms.PageRequestManager&&Sys.WebForms.PageRequestManager.getInstance?Sys.WebForms.PageRequestManager.getInstance():null},__Dispose:function(e,f,g){this.UnRegisterObservers();if(f&&this.ChildSpreadViews!=null)for(var a=0;a<this.ChildSpreadViews.length;a++)this.ChildSpreadViews[a].__Dispose(null,true);if(!this.IsMultiColumnComboBox){this._UnHookFormOnSubmit();this.Parent!=null&&this.IsMultiBrowserMode()&&$$.j(this.Parent.Spread).off("ColWidthChanged",this._parentColWidthChangedHandler)}this._DetachDocumentFocusIn();var c=e=="LoadOnDemand";if(!c)if(this.FilterEditors!=null)for(var a=0;a<this.FilterEditors.length;a++)this.FilterEditors[a].__Dispose();if(this.ContextMenus!=null){var b=[this.Viewport0,this.Viewport1,this.Viewport2,this.Viewport,this.Spread.getRowHeader(),this.Spread.getFrozRowHeader(),this.Spread.getColHeader(),this.Spread.getFrozColHeader()];$$.utils.cleanArray(b);for(var a=0;a<b.length;a++)FarPoint.System.DetachEvent(b[a].parentNode,"contextmenu",this.__menuDel,false)}this.ClearIntervalTasks();this.Touch!=null&&this.Touch.Dispose(!c||g);for(var a=this.ManagedObjects.length-1;a>=0;a--){var d=this.ManagedObjects[a];if(typeof d.Dispose=="function")try{d.Dispose();this.ManagedObjects.splice(a,1)}catch(h){throw"Exception when dispose object "+h.message;}}},GetTopSpreadView:function(){if(this.__topSpreadView==null)if(this.IsMultiBrowserMode()){if(this.IsMultiColumnComboBox)this.__topSpreadView=this;else{var b=this.Spread.getTopSpread();this.__topSpreadView=b.getSpreadView?b.getSpreadView():null}if(this.__topSpreadView==null&&$$.IS_DEBUG)throw"Top SpreadView is NULL!";}else{var a=this;while(a.Parent!=null)a=a.Parent;if(!a.Spread.initialized||this.Spread.getParentSpread()!=null)return a;this.__topSpreadView=a}return this.__topSpreadView||this},_DetectSpreadLocation:function(){var b=this.GetActiveSpreadView(false,true,false)||this,d=b.Spread;if(!$$.utils.contains(document.body,d)){this.ClearIntervalTasks();return}var a=d.getBoundingClientRect(),c=b.__oldSpreadBound;if(c==null||a.left!=c.left||a.right!=c.right||a.bottom!=c.bottom||a.top!=c.top){b.OnSpreadLocationChaged(b.__oldSpreadBound,a);b.__oldSpreadBound=a}},StartTrackingLocation:function(a){if(this.Parent!=null){this.GetTopSpreadView().StartTrackingLocation(a);return}this.__trackingLocation=true;var b=this.LOCATION_TRACK_INTERVAL_TYPE;this.IsIntervalRegistered(b)&&this.StopIntervalTasks(b,true);if($$.browser.webkit){if(this.__trackLocationHandler==null){this.__trackLocationHandler=Function.CreateDelegate(this,this._DetectSpreadLocation);FarPoint.Web.Timers.Timer.GetSystemTimer().AddElapsedHandler(this.__trackLocationHandler)}}else{var c=this;this.RegisterIntervalTask({Context:c,Func:c._DetectSpreadLocation},a!=null?a:this.LOCATION_TRACK_INTERVAL,b)}},StopTrackingLocation:function(){if(this.Parent!=null){this.GetTopSpreadView().StopTrackingLocation();return}var b=this.LOCATION_TRACK_INTERVAL_TYPE;this.StopIntervalTasks(b);var a=this.GetActiveSpreadView(false,true,false)||this;if(a.__oldSpreadBound)a.__oldSpreadBound=null;this.__trackingLocation=false;this.__trackLocationHandler!=null&&FarPoint.Web.Timers.Timer.GetSystemTimer().RemoveElapsedHandler(this.__trackLocationHandler)},IsTrackingLocation:function(){return this.GetTopSpreadView().__trackingLocation},RequireTrackingLocation:function(){return this.IsInTouchMode()},IsAllSpreadLoaded:function(c){if(!c.initialized)return false;for(var b=FpSpreadJS.getAllChildViews(c),a=0;a<b.length;a++)if(!b[a].initialized)return false;return true},RegisterObservers:function(){if(typeof MutationObserver=="undefined")return;var a=$$(this.Spread);this.setting={Width:a.style("width"),Height:a.style("height")};this.settingObserver=new MutationObserver(Function.CreateDelegate(this,this.SettingChanged));var b={attributes:true,substree:false,attributeFilter:["style"],attributeOldValue:true};this.settingObserver.observe(this.Spread,b)},UnRegisterObservers:function(){this.settingObserver&&this.settingObserver.disconnect()},SettingChanged:function(f){if(this.IsClientAutoSize()||this.IsSuspendedAction(this.Spread,GCWS.Actions.OBSERVER))return;var c=f[0];if(c.type=="attributes"&&c.attributeName=="style"&&c.target==this.Spread){var b=$$(this.Spread);if(b.style("width")!=this.setting.Width||b.style("height")!=this.setting.Height){var a=this.GetSpreadContext(),d=0,e=oh=-1;do{e=this.Spread.offsetWidth;oh=this.Spread.offsetHeight;if(a.sizeSpread)a.sizeSpread(true);else if(a.SizeSpread){a.SizeSpread(this.Spread,true);a.setTextBoxPosition(this.__GetSpreadTextBox())}if(this.Spread.style.width.indexOf("px")!=-1&&this.Spread.style.height.indexOf("px")!=-1)break;d++}while(d<2&&(e!=this.Spread.offsetWidth||oh!=this.Spread.offsetHeight));this.setting={Width:b.style("width"),Height:b.style("height")}}}},OnSpreadInitialized:function(d){if(!this.IsMultiColumnComboBox){if(this.Parent==null&&typeof d=="undefined"){for(var e=["_gcFilterDialog","_gcFilterColorDialog","_gcFilterIconDialog","_gcFilterTop10Dialog"],h=["_filterDialog","_filterColorDialog","_filterIconDialog","_top10filterDialog"],g=false,c=null,b=0;b<e.length;b++){if(this.Spread[h[b]]!=null)continue;var a=document.getElementById(this.Spread.id+e[b]+"_TopDiv");if(a!=null){a.Behavior!=null&&a.Behavior.Dispose();a.parentNode.removeChild(a);g=true}}g&&(c=document.getElementById(this.Spread.id+"_mask"))!=null&&c.parentNode.removeChild(c)}var f=this.Spread.getAttribute("spreadcontextmenucss");f!=null&&$$.utils.registerCss("spreadcontextmenucss",f)}if(this.IsInitialized)return;this._enableNewModel&&this._InitDataModel();!this.IsMultiColumnComboBox&&this.Spread.getParentSpread&&this.Spread.getParentSpread()==null&&this._HookFormOnSubmit();if(!this.IsMultiColumnComboBox){this.BuildContextMenu();if(d!="LoadOnDemand"){!this.IsMultiBrowserMode()&&this.InitFilterUI(d);this.RetrieveFilterBarMenus()}else $$.browser.ie&&(window.parent==window||document.readyState=="complete")&&document.activeElement!=null&&this.IsFilterBarTextBox(document.activeElement)&&$$(document.activeElement).focus(true);if(!this.__cdfsInited){this._getCDFs();this.RepaintCDFs();if((!$$.browser.ie||$$.browser.version>7)&&this.LastCDFRow!=-1)if(this.Spread.sizeSpread)if($$.browser.ie&&$$.browser.version>=9)this.Spread.sizeSpread(false,true);else this.Spread.sizeSpread();else this.Spread.SizeSpread(this.Spread)}this.AttachEvents();(this.FilterEditors!=null||this.ContextMenus!=null)&&this.__AddClientBasedStyle();this._LoadOnDemandInitialization();this.__oldSpreadBound=this.Spread.getBoundingClientRect();if($$.browser.mb)if(this.IsRoot)this.RegisterObservers();else if(this.Parent&&this.TitleBar.IsVisible()){this._parentColWidthChangedHandler=Function.CreateDelegate(this,function(){this.Spread.sizeSpread(true)});$$.j(this.Parent.Spread).on("ColWidthChanged",this._parentColWidthChangedHandler)}}this.IsInitialized=true},OnSpreadLocationChaged:function(){this.IsInTouchMode()&&this.GetTopSpreadView().Spread.GetActiveChartObj()==null&&(this.IsSpreadActive(true)||this.IsRetainSelection())&&this.Spread.offsetParent!=null&&this.ShowFocusRectangle(true);var a=this.GetTopSpreadView();a.ActiveDialog!=null&&a.ActiveDialog._SetMaskLocation()},OnSpreadMouseUp:function(a){var a=a||window.event,d=this.IsRightClick(a),e=a.srcElement||a.target,c=$$.utils.getDocActiveElement();if(this.__justFiltered){if(!d||this.ContextMenus==null||this.FindContextMenu(e)==null)this.__justFiltered=null;$$.browser.ie&&d&&this.IsFilterBarTextBox(c)&&setTimeout(function(){$$(c).focus(true)},0);return $$.utils.cancelBubble(a)}var f=this.GetTopSpreadView();if(d&&f!=this)return false;var b,g;return this._GetWorkingSpread()==null&&this.IsInFilterBar(c)||(b=this.GetActiveSpread())!=null&&b!=this.Spread&&b.getSpreadView&&b.getSpreadView().IsFilterBarTextBox(c)&&this.GetTopSpreadView().Spread!=b.getSpreadView().GetTopSpreadView().Spread?$$.utils.cancelBubble(a):!$$.browser.ie&&this.ActiveContextMenu!=null&&this.IsChild(this.ActiveContextMenu.Holder,e)?$$.utils.cancelBubble(a,false):true},OnSpreadMouseDown:function(a,h){var g=a.srcElement?a.srcElement:a.target,f=this.IsRightClick(a);this.ClearFilterFlags();this.HidePopup();var b=this.GetTopSpreadView();if(b.ContextMenus!=null&&f&&b!=this){var d=this.GetActiveSpread();if(d!=null&&d.getSpreadView().GetTopSpreadView()==b)return false}if(f&&this.IsControl(g))this._ignoreMenu=true;if(!h&&$$.browser.quirksMode&&$$.browser.ie&&$$.browser.ieversion<10){var c=$$.utils.getDocActiveElement();c!=null&&this.IsFilterBarTextBox(c)&&c.blur()}var i=this.GetSpreadContext();if(!this.IsInTouchMode()&&!this.Spread.isEditing()){var e=i.getEditor(this.Spread.getAnchorCell());e!=null&&$$.utils.contains(e,document.activeElement,true)&&$$.utils.isOverScrollbar(a)&&this.FocusSpread()}return true},OnContextMenu:function(a){if(this.__justFiltered){this.__justFiltered=null;return $$.utils.cancelBubble(a)}if(this.Touch&&this.Touch.IgnoreContextMenuEvent)return $$.utils.cancelBubble(a);var b=a.srcElement||a.target,i=this.GetSpreadContext().GetActiveChartObj(this.Spread);if(i!=null)if(this.IsChild(i.container,b))return;else this.GetSpreadContext().inactiveAllChart(this.Spread);var e=GCWS.FilterEditor.GetEditor(b),g=null;if(e!=null&&e.Behavior!=null&&e.Behavior.IsFilterBar||b.getAttribute("FpSpread")=="fb"||(g=$$(b).getParent("TR"))!=null&&g.getAttribute("FpSpread")=="fb")return;var c=this.FindContextMenu(b);if(c!=null){var d=!$$.utils.isOverScrollbar(a);if(!d&&b.clientHeight==0&&$$.browser.ie&&$$.browser.version<8){var h=$$(b).style("overflow");d=h!="auto"&&h!="scroll"}var f=this.GetTopSpreadView();if(d&&(f.GetEditingSpread()==null||this.IsInTouchMode()&&!$$.utils.isNativeControl(a.target,true)&&f.TryStopEditing(true,false))){var j=window.event||a;if(j.type=="contextmenu")if(!this._ignoreMenu&&!this.IsControl(b)){c.EnableTouchMode(this.IsInTouchMode());if(c.Show(a)||c.Holder.getAttribute("showBrowserMenu")==null){this.UnregisterTimeoutTask("CorrectFocusOnActiveCell");if(this.Spread.isEditing()){this.Spread.EndEdit();this.Spread.isEditing()&&c.Hide()}FarPoint.System.CancelDefault(a)}}}}if(this._ignoreMenu)this._ignoreMenu=false;return true},IsPopupOpened:function(b){var a=this.GetTopSpreadView();return a.ActiveContextMenu!=null||a.ActiveDialog!=null||GrapeCity.Web.DatePicker.IsShowing()||this.Touch!=null&&(FarPoint.Web.Spread.TouchController.ActiveTouchStrip!=null||b&&this.Touch.IsTouchStripOpening)},HidePopup:function(){var a=false;if(this.IsInTouchMode())if(this.Touch.IsTouchStripOpening){this.Touch.HideTouchStrip();a=true}var b=this.GetTopSpreadView();if(b.ActiveContextMenu){b.ActiveContextMenu.Hide();a=true}if(GrapeCity.Web.DatePicker.IsShowing()){GrapeCity.Web.DatePicker.GetInstance().Hide();a=true}return a},_PerformTouchTranslateKey:function(b){if(this.Touch!=null&&document.FpActiveSpread!=null&&this.Spread==document.FpActiveSpread&&this.GetTopSpreadView()==document.FpActiveSpread.getSpreadView().GetTopSpreadView()){if(this.Touch.IsProcessing){$$.utils.cancelDefault(b);return true}var c=this.GetTopSpreadView(),a=FarPoint.Web.Spread.TouchController.ActiveTouchStrip;if(a!=null&&a.DroppedDownMenu==null&&a.Area!=FarPoint.Web.Spread.TouchStripShowingArea.Chart){b.isFromTouchStrip=a.Holder==document.activeElement||$$.utils.contains(a.Holder,document.activeElement);this.Touch.IsInTouchMode=false;if(this.Spread.GetActiveChartObj()==null&&(!$$.browser.webkit||!$$.utils.isNativeControl(document.activeElement))){(document.activeElement==null||document.activeElement!=this.Spread&&!$$.utils.contains(this.Spread,document.activeElement))&&this.FocusSpread();(document.activeElement==this.__GetSpreadTextBox()||document.activeElement==this.Spread||$$.utils.contains(this.Spread,document.activeElement))&&this.GetSpreadContext().correctFocusOnActiveCell()}if(b.keyCode==GCWS.Keys.ESCAPE){$$.utils.cancelDefault(b);return true}}else if(!this.IsPopupOpened())this.Touch.IsInTouchMode=false}return false},IsSpreadHandleKeyboardDirectly:function(){var a=this.GetTopSpreadView();if(document.FpActiveSpread==null||a!=document.FpActiveSpread.getSpreadView().GetTopSpreadView())return false;if(a.ActiveContextMenu!=null)return false;if(GrapeCity.Web.DatePicker.IsShowing()){var b=GrapeCity.Web.DatePicker.GetInstance();if($$.utils.contains(this.Spread,b.Target))return false}return a.ActiveDialog!=null?false:this.IsInTouchMode()&&this.Touch.IsTouchStripOpened?false:true},OnSpreadTranslateKey:function(a){a!=null&&a.keyCode==GCWS.Keys.TAB&&!this.Spread.isEditing()&&this.IsInTouchMode()&&(document.activeElement==this._GetScrollableView()||this.GetCommandBar().Contains(document.activeElement))&&this.GetSpreadContext().setTextBoxFocus();if(a.keyCode!=GCWS.Keys.TAB)if(this.IsMultiColumnComboBox)return false;else if(this.Spread.isEditing()){var b=this.Spread.getEditingInfo();if(b!=null&&$$.utils.isShowingMultiColumnComboBox(b.Editor)){var d=a.keyCode;if(a.ctrlKey&&(d==67||d==86||d==88))return true;if(document.activeElement==b.Editor||$$.utils.contains(b.Editor,document.activeElement)){var i=b.Editor.getAttribute("mccbId");if(i!=null){var h=window[i+"_Obj"];if(h!=null&&h.IsInputKey(a))return false}}}}if(this._PerformTouchTranslateKey(a))return false;var c=this.GetTopSpreadView();if(c.ActiveContextMenu!=null){var j=typeof FarPoint!="undefined"&&FarPoint.Web!=null&&FarPoint.Web.Spread!=null&&FarPoint.Web.Spread.TouchController!=null,f=j&&c.ActiveContextMenu==FarPoint.Web.Spread.TouchController.ActiveTouchStrip;if($$.browser.ie&&this.Parent!=null&&!f||(f&&c.ActiveContextMenu.Spread!=this.Spread?false:!c.ActiveContextMenu.OnKeyDown(a)))return false}if(GrapeCity.Web.DatePicker.IsShowing()){var g=GrapeCity.Web.DatePicker.GetInstance();if(this.IsChild(this.Spread,g.Target)&&!g.OnKeyDown(a))return false}var k=a.target||a.srcElement,e=GCWS.FilterEditor.GetEditor(k);return e!=null&&e.Behavior.Spread==this.Spread&&!e.Behavior.OnKeyDown(a)?false:true},OnSpreadKeyDown:function(a){this.ClearFilterFlags();if(a!=null&&this.ContextMenus!=null&&a.cancelBubble)return false;var b=a!=null?a.target?a.target:a.srcElement:null,c=this.GetTopSpreadView().ActiveContextMenu;return c!=null?$$.utils.cancelBubble(a):b!=null&&GCWS.FilterEditor.IsFilterControl(b)?false:true},OnSpreadInitSmartPaint:function(){this._getCDFs();var a=this.Viewport2||this.Viewport,b=this.FrozenTableRowCount+(a!=null?a.rows.length:0);this.RepaintCDFs(0,b);this.__cdfsInited=true;return true},OnSpreadAddRowToView:function(m,l,c,h){if(!this.IsInitialized)return;if(c==this.Viewport||c==this.Viewport2)for(var j=c==this.Viewport?this.FrozenTableColumnCount:0,b=-1,f=0;f<h.length;f++){var a=h[f];if(a.getAttribute("previewRow")!=null)continue;b=b<0?this._GetRowIndexByViewIndex(a.rowIndex+this.FrozenTableRowCount):b+1;var d=this._GetRow(b);if(d!=null){d.HtmlRow=a;for(var e=0,k=c==this.Viewport?d.Cells.length:this.FrozenTableColumnCount,g=j;g<k;g++){var i=d.Cells[g];if(i!=null){this.OnSpreadNewCellCreated(a.cells[e]);i.HtmlCell=a.cells[e];e++}}}}},OnSpreadNewCellCreated:function(b){if($$.browser.ieversion>=11){var c=this.GetSpreadContext(),d=c.getCellType(b,true);if(d=="TextCellType"){var a=c.getEditor(b,true);if(a&&(a.tagName=="TEXTAREA"||a.tagName=="INPUT"))a.style.width=b.clientWidth-6+"px"}}},OnSpreadCallbackStart:function(command){this.StopTrackingLocation();if(command=="LoadOnDemand"&&this.IsInTouchMode()&&!this.IsBackgroundMode){if(this.Touch.IsProcessing){this.Touch.StopProcessing();var lastRange=this.Spread.GetSelectedRange();lastRange!=null&&lastRange.row>=0&&this.GetSpreadContext().paintSelection(lastRange.row,lastRange.col,lastRange.rowCount,lastRange.colCount,false)}$$.browser.mb&&this.Touch.DisableWebkitScroll()}if(this.IsInTouchMode()){var anchorCell=this.Spread.getAnchorCell();if(anchorCell!=null&&(command!="LoadOnDemand"||!this.IsBackgroundMode||this.LoadOnDemandInterval==null||this.LoadOnDemandInterval<0)){var mccbId=this.GetSpreadContext().getMccbID(anchorCell,this.Spread);if(mccbId!=null){var mccbObj=eval(mccbId+"_Obj");if(mccbObj!=null&&mccbObj.getIsDrop())mccbObj.ShowHideContainer(false);else this.UnregisterTimeoutTask("ShowHideContainer")}}}if($$.browser.ie&&$$.browser.version>10){var currentActive=$$.utils.getDocActiveElement();GCWS.FilterEditor.IsFilterCommand(command)&&currentActive!=null&&this.IsFilterBarTextBox(currentActive)&&this.FocusSpread()}},OnSpreadCallbackStopped:function(a){if($$.utils.stringEndsWith(a,",fb")||$$.utils.stringEndsWith(a,",ch"))if(this.FilterEditors!=null){var b=this.GetFilterEditor(a);if(b!=null){this.Spread.isEditing()&&this.Spread.EndEdit({IgnoreFocus:true});if(!this.Spread.isEditing()){!$$.browser.ie&&this.SuspendPaintSelection();!$$.browser.webkit&&b.TakeFocus();if(this.OperationMode==$$.OperationModes.NORMAL||this.OperationMode==$$.OperationModes.ROW_MODE){!$$.browser.ie&&this.ResumePaintSelection();this.SelectFilterColumn(b.Editor.parentNode,null,true)}this.__justFiltered=true;!$$.browser.ie&&this.ResumePaintSelection()}}}this.IsInTouchMode()&&this.StartTrackingLocation()},OnSetTextBoxFocus:function(c){var d=this.IsSpreadActive(),b=c||window.event,a=b!=null&&(b.type=="activate"||!$$.browser.ie&&b.type=="focusin")?b.srcElement||b.target:null;if(c!=null||a!=null){if(a!=null)if(!this.IsInFilterBar(a,true)&&(!this.IsInTouchMode()||!this.Touch.IsTouchHandle(a))){if(!this.IsInTouchMode()||!$$.utils.isNativeControl(a)||!a.disabled)(this.Touch==null||!this.Touch.IsTouchHandle(a))&&this.ShowEditingFilterIndicator(false)}else return false;if(this.ActiveDialog!=null&&this.ActiveDialog.isShowing){this.ActiveDialog.Focus(true);if(d)return false}}if(!$$.browser.ie&&this.__justFiltered&&(a=document.activeElement)!=null&&this.IsFilterBarTextBox(a)){this.__justFiltered=null;return false}return true},OnSpreadLostActive:function(d){this.HasFilterBar()&&this.ShowEditingFilterIndicator(false);var a=this.GetTopSpreadView();if(a.ActiveContextMenu!=null&&!a.ActiveContextMenu.IsMenuElement(d)){var c=null,b=!a.IsInTouchMode()||(c=this.GetActiveSpread())==null||c.getSpreadView().GetTopSpreadView()!=a;if(!b)b=a.ActiveContextMenu.Spread!=c;b&&a.ActiveContextMenu.Hide(true)}},AfterSpreadStartEdit:function(h,f,c,d,b){if(c.getAttribute("cdf")!=null){var g=$$.utils,e=this.Spread.getSpreadJS().context;if(b!=null&&d==$$.CellTypes.LISTBOX){var a=b.getAttribute("__height");if(a==null){a=Number(b.style.height);if(isNaN(a)||a==0)a=b.offsetHeight;b.setAttribute("__height",a)}b.style.height=Math.min(c.clientHeight,a)+"px"}}if(this.IsInTouchMode()){this.Touch.HideTouchHandles(true);this.Touch.UpdateResizeLocation(true,true)}},AfterSpreadEndEdit:function(b){if((b==null||b)&&this.IsInTouchMode())if(this.GetTopSpreadView().Spread.GetActiveChartObj()==null){var a=!this.Spread.isEditing();if(a){var c=this.GetActiveSpreadView(false,true);if(c!=this||!this.IsRetainSelection()&&!this.IsSpreadActive())a=false}this.Touch.ShowTouchHandles(true,a)}else this.Touch.HideTouchHandles()},ReInitLayout:function(){var a=FpSpreadJS.getChildViews(this.Spread);if(a&&a.length>0)for(var b=0;b<a.length;b++){var c=a[b].initialized?a[b].getSpreadView():null;if(c==null)continue;c.ReInitLayout()}this.GetSpreadContext().initLayout(true,null,null,{ReInitLayout:true})},UpdateUI:function(){if(this.IsInTouchMode())if(this.GetTopSpreadView().Spread.GetActiveChartObj()==null){var a=this.IsSpreadActive();if(!a)a=this.GetActiveSpreadView(false,true)==this&&this.IsRetainSelection();this.ShowFocusRectangle(a)}},OnSpreadChartClick:function(){this.ActiveContextMenu!=null&&this.ActiveContextMenu.Hide(true);var d=this.GetSpreadContext(),a=document.FpActiveSpread||d.GetPageActiveSpread();if(a!=null&&a!=this.Spread&&a.getTopSpread()!=this.Spread.getTopSpread()){var b=a.getSpreadView().GetTopSpreadView().ActiveContextMenu;b!=null&&b.Hide(true)}if(GrapeCity.Web.DatePicker.IsShowing()){var c=GrapeCity.Web.DatePicker.GetInstance();c!=null&&c.Hide()}},OnSpreadChartKeyDown:function(a){if(a.keyCode==GCWS.Keys.ESCAPE)this.ActiveContextMenu!=null&&this.ActiveContextMenu.Hide(true)},ClearFilterFlags:function(a){if(a==null)a=this.GetTopSpreadView();if(a.__justFiltered){a.__justFiltered=null;return true}var b=a.ChildSpreadViews;if(b!=null)for(var c=0;c<b.length;c++)if(this.ClearFilterFlags(b[c]))return true;return false},InitFilterUI:function(e){if(this.ColumnHeaders!=null&&e!="LoadOnDemand"&&!this.IsMultiColumnComboBox)for(var g=this.Spread.parentNode,b=0;b<this.ColumnHeaders.length;b++)for(var f=this.ColumnHeaders[b],d=f.getElementsByTagName("DIV"),c=0;c<d.length;c++){var a=d[c];if(a.getAttribute("fe")!=null){if(this.FilterEditors==null)this.FilterEditors=[];a.Behavior=new GrapeCity.Web.Spread.FilterEditor(this.Spread,a,e);this.FilterEditors.push(a.Behavior)}}},SetFilterEditors:function(b){if(b==null||b.length==0)return;this.FilterEditors=b;for(var a=0;a<this.FilterEditors.length;a++){this.FilterEditors[a].__SpreadView=this;this.FilterEditors[a].FilterMenu!=null&&this.FilterEditors[a].FilterMenu._SetSpreadView(this)}},LayoutEnhacedFilterCells:function(){if(this.FilterEditors==null)return;for(var a=0;a<this.FilterEditors.length;a++){var b=this.FilterEditors[a];b!=null&&b.LayoutEnhancedCell()}},RelayoutFilterBarWithResize:function(d){var f=this.GetSpreadContext(),g=this.Spread.getAttribute("HasTemplateWithSpan")!=null;if(!g){var a=parseInt(d.getAttribute("index"));if(!isNaN(a)){var b=$$(d).getParent("table");if(b==f.getColHeader())a-=f.frzColCount();for(var c=b.rows.length-1;c>=0;c--){var e=b.rows[c];if(e.getAttribute("FpSpread")!="fb")break;this.LayoutFilterBarCell(e.cells[a])}}}else this.LayoutFilterBar()},LayoutFilterBar:function(c){if(this.FilterEditors==null)return;for(var b=0;b<this.FilterEditors.length;b++){var a=this.FilterEditors[b];if(a!=null){if(!a.IsFilterBar)return;a.LayoutFilterBar(c)}}},LayoutFilterBarCell:function(a){if(a==null||a.parentNode.getAttribute("FpSpread")!="fb")return;var b=$$(a).firstChild("DIV");if(b!=null){var c=this.GetFilterEditor(b.id);c!=null&&c.LayoutFilterBar()}},LayoutEditingFilterIndicator:function(){if(this.ColumnHeaders==null)return;var a=this.GetSpreadContext().getCorner(),f=this.ColumnHeaders[0];if(a!=null&&a.nextSibling!=null&&a.nextSibling.getAttribute("fb")=="1"){var d=a.nextSibling;if(d!=null){var j=$$(d).firstChild("TABLE");j.style.width="";for(var c=null,b=a.rows.length-1;b>=0;b--){c=a.rows[b];if(c.getAttribute("FpSpread")!="fb"&&c.cells.length>0)break}var g=c!=null?c.cells[0]:null;d.style.bottom="0px";for(var e=null,b=f.rows.length-1;b>=0;b--){var i=f.rows[b];if(i.getAttribute("FpSpread")=="fb")e=i;else break}var k=$$(d).firstChild("TR"),h=e!=null?f.offsetHeight-e.offsetTop:0;h+=(!this.IsMultiBrowserMode()||$$.browser.mozilla)&&g!=null?parseInt($$(g).style("border-bottom-width")):0;k.style.height="";d.style.height=h+"px";j.style.width="100%"}}},SyncCornerWithFilterBar:function(a,c){if(a==null||a.getAttribute("allowTableCorner")!=null||c==null)return;if(parseInt(a.cellSpacing)>0&&c!=null&&c.rows[0].getAttribute("FpSpread")!="fb"){for(var b=a.rows[0],g=null,e=c.rows.length-1;e>=0;e--){if(c.rows[e].getAttribute("FpSpread")!="fb")break;g=c.rows[e]}if(this.IsMultiBrowserMode()&&this.ColumnHeader.GrayAreas!=null){var m=a.style.height;a.style.height="";var l=a.parentNode.style.height;a.parentNode.style.height="";b.style.height="";var j=this.ColumnHeader.GetHeaderRowsHeight();if(j>b.offsetHeight)b.style.height=j+"px";a.style.height=m;var k=this.ColumnHeader.GetGrayAreaHeight(true),d=b.nextSibling;d.style.height="";if(k>d.offsetHeight)d.style.height=k+"px";a.parentNode.style.height=l}else{var i=c.rows[0],f=!this.IsMultiBrowserMode()?i.cells[i.cells.length-1]:null;if(f!=null){b.style.height="";if(f.offsetHeight>b.offsetHeight)b.style.height=f.offsetHeight+"px"}var h=g.cells[g.cells.length-1],d=b.nextSibling;if(h!=null){d.style.height="";if(h.offsetHeight>d.offsetHeight)d.style.height=h.offsetHeight+"px"}}}},ShowEditingFilterIndicator:function(b){var f=this.GetSpreadContext(),a=f.getCorner();if(this.feIndicator==null&&a!=null)if(a.nextSibling!=null&&a.nextSibling.getAttribute("fb")=="1")this.feIndicator=$$(a.nextSibling).firstChild("DIV");else for(var c=a.rows.length-1;c>=0;c--){var e=a.rows[c];if(e.getAttribute("FpSpread")==null||(this.feIndicator=$$(e).firstChild("DIV"))!=null)break}if(this.feIndicator!=null){var d=true;if(b&&$$(this.feIndicator).style("display")=="none"){this.feIndicator.style.display="block";if(!$$.browser.ie||$$.browser.version>8)this.feIndicator.style.position="relative"}else if(!b&&$$(this.feIndicator).style("display")!="none")this.feIndicator.style.display="none";else d=false;if(d)if($$.browser.ie&&$$.browser.version>9)if(b)this.Spread.Behavior.syncRowHeaderWidth();else this.Spread.Behavior.sizeSpread(true)}},RefreshLayout:function(){var b=null;if(arguments.length>0)if(typeof arguments[0]=="string")b=arguments[0];else b="opacity";if(b==null){var e=this.Viewport.parentNode,c=document.createElement("span");c.style.position="absolute";e.appendChild(c);e.removeChild(c)}else if(b=="opacity"){var f=this.Spread.style.opacity;this.Spread.style.opacity=.99;this.Spread.style.opacity=f}else if(b=="scrollTop"){var d=this.GetSpreadContext(),a=d.getScrollvp()||this.Viewport.parentNode;if(a.scrollTop==0&&a.scrollHeight>a.clientHeight){d.detachScrollEvents();a.scrollTop=1;setTimeout(function(){a.scrollTop=0;d.attachScrollEvents()},25)}}},ScrollToHeaderCell:function(b){if(b==null)return false;var a=this.Spread.getColHeader();if(a==null)return false;var g=$$.utils.contains(a,b),c=false;if(g&&this._IsCellHidden(b,true,a.parentNode)){a=a.parentNode;var f=b.offsetWidth<a.clientWidth;if(f&&b.offsetLeft+b.offsetWidth>a.scrollLeft+a.clientWidth){var e=b.offsetLeft+b.offsetWidth-a.clientWidth;if(a.scrollLeft!=e){a.scrollLeft=e;c=true}}var d;if((d=b.offsetParent!=null?Math.floor(b.getBoundingClientRect().left-b.offsetParent.getBoundingClientRect().left):b.offsetLeft)<a.scrollLeft){c=a.scrollLeft!=d;if(c)a.scrollLeft=d}if(c)if($$.browser.ieversion>9)this.GetSpreadContext().scrollView({target:a});else this.Viewport.parentNode.scrollLeft=a.scrollLeft}return c},SelectFilterColumn:function(c,C,t,z){t&&this.SuspendSpreadFocus();this.Spread._noNumericCellTypeWorkaround=true;var j=this.IsInTouchMode(),a=this.GetSpreadContext(),e=a.getColFromCell(c),o=false;if(j||a.GetRowCountInternal()>0){var i=this.IsRowLayoutMode?parseInt(c.parentNode.getAttribute("row")):-1;if(j){var g=this._GetColumnIndex(c);this.__matchingSelection=this.Spread.GetSelectedRange();!this.SelectionModel.IsEmpty()&&this.Spread.ClearSelection(false,null,false);var f=c;if(this.IsInFilterBar(f)){var w=$$(f).getParent("TABLE");if(!this.IsInFilterBar(w.rows[0])){var B=f.parentNode.rowIndex-Math.floor(w.rows.length/2),A=this._GetColumnIndex(f);f=this.ColumnHeader._GetHtmlCell(B,A)}}this.__matchingAnchorCell=this.Spread.getAnchorCell();this.SetAnchorCell(f,true);if(this.OperationMode==$$.OperationModes.NORMAL&&(this.SelectionBlockOptions&GCWS.SelectionBlockOptions.Columns)==GCWS.SelectionBlockOptions.Columns)a.selectColumn(!this.IsRowLayoutMode?g:parseInt(c.getAttribute("col")),1,true,false,true);else{var l=this.OperationMode==$$.OperationModes.ROW_MODE,d=this._FindColumnActiveCell(g,1,i);if(d==null&&this.RowCount>0)d=this.GetCell(0,g,true);if(d!=null){this.SetAnchorCell(d,true,d.HtmlCell!=this.__matchingAnchorCell);this.Spread.AddSelection(a.getActiveRow(),l?-1:g,1,l?-1:1,i);if(this.Spread.getAnchorCell()!=d.HtmlCell){this.SetAnchorCell(d,true);this.GetSpreadContext().paintAnchorCell(true,true)}}else if(this.RowCount==0)this.SetAnchorCell(null);else this.IsViewportCell(this.Spread.getAnchorCell())&&this.Spread.AddSelection(a.getActiveRow(),l?-1:g,1,l?-1:1,i)}this.__matchingAnchorCell=null;this.__matchingSelection=null;this.SelectionModel.IsEmpty()&&!this.IsViewportCell(this.Spread.getAnchorCell())&&this.ShowFocusRectangle();this.Touch.ResizeLocation=null;this.Touch.UpdateResizeLocation(true)}else{var x=-1,h=null,v=null;do{a.moveDown(x,e,false,false,true);var h=this.Spread.getAnchorCell();if(h==null||v==h)break;x=a.getRowFromCell(h);v=h}while(i!=-1&&parseInt(h.parentNode.getAttribute("row"))!=i);var b=this.Spread.getAnchorCell();if(b&&C!=b&&b.getAttribute("canFocus")!="false"){var s=b!=null?parseInt(b.parentNode.getAttribute("row")):-1,r=a.getActiveRow();if(this.OperationMode==$$.OperationModes.NORMAL)if(j&&this.SelectionModel.Contains(r,e))this.Spread.getSpreadJS().keepGeneratedSelectionFromAnchorCell();else this.Spread.AddSelection(r,e,1,1,s);a.fireActiveCellChangedEvent(r,a.getActiveCol(),this.Spread,s,true)}else{var u=b!=null?a.getColFromCell(b):0;o=b==null||b.getAttribute("canFocus")=="false"||u>e||u+b.colSpan<=e}}}else o=true;if(o&&this.Spread.getAttribute("OperationMode")=="Normal")if(c.parentNode.rowIndex!=0){var m=$$(c).getParent("TABLE"),n=null;a.ClearSelection(false,null,false);if(this.IsRowLayoutMode){if(this.__firstFBRowIndex==null){this.__firstFBRowIndex=m.rows.length-1;while(this.__firstFBRowIndex>1){if(m.rows[this.__firstFBRowIndex-1].getAttribute("FpSpread")!="fb")break;this.__firstFBRowIndex--}}n=m.rows[c.parentNode.rowIndex-this.__firstFBRowIndex]}else n=m.rows[0];var s=-1;if(n!=null){var p=n.cells[c.cellIndex];if(p!=null){a.setAnchorCell(p);s=parseInt(p.parentNode.getAttribute("row"))}else a.setAnchorCell(null)}a.setActiveRow(-1,true);a.setActiveCol(e);a.selectColumn(e,1,true)}$$.browser.mb&&this.GetTopSpreadView().GetCommandBar().UpdateCopyCutPaste();if(z){var k=this.Spread.getAnchorCell(),q=k!=null&&this._IsCellHidden(k,true);if(q&&j){var y=this.Viewport.parentNode||a.getViewportHolder();if(y!=null&&y.getBoundingClientRect().left<=k.getBoundingClientRect().left)q=false}q&&a.scrollToCell(k)}this.Spread._noNumericCellTypeWorkaround=false;t&&this.ResumeSpreadFocus()},EnsureFilteringState:function(){var a=this.GetTopSpreadView();if(this.GetEditingSpread()==null&&a.IsFilterBarTextBox(document.activeElement)){var b=a.IsReadyToFilter();this.FocusSpread();if(b)return false}return true},RetrieveFilterBarMenus:function(){if(window.fpPostOn!=null||this._isRetrievingFilterBarMenus)return;var b=this.__GetUnInitializedFilterEditors(false);if(b==null||b.length==0)return;this._isRetrievingFilterBarMenus=true;var a=this;if(!this._hasRequestFilterBarMenus){this._hasRequestFilterBarMenus=true;this.SyncData(this.Spread.getAttribute("name"),"RetrieveFilterBarMenus",true,null,c)}function c(){a._isRetrievingFilterBarMenus=false;a._hasRequestFilterBarMenus=false;a.__ReInitializeFilterEditors();var c=a.PopDelayedRequest();c!=null&&c();if(this.ChildSpreadViews!=null)for(var b=0;b<this.ChildSpreadViews.length;b++)this.ChildSpreadViews[b].RetrieveFilterBarMenus()}},__GetUnInitializedFilterEditors:function(b){var a=this.__uninitializedFilterEditors;if(b&&a==null){a=[];this.__uninitializedFilterEditors=a}return a},__ReInitializeFilterEditors:function(){var a=this.__GetUnInitializedFilterEditors(false);if(a!=null){for(var c=a.length-1;c>=0;c--){var b=a[c];if(b!=null){var d=document.getElementById(b.Editor.getAttribute("id")+"_CM");if(d!=null||b.Editor.getAttribute("UpdateFilterMenuType")!=null){b.__Initialize(true);a.splice(c,1)}}}if(a==null||a.length==0)this.__uninitializedFilterEditors=null}},ReceiveFilterBarPackage:function(e,f){var h=$$.browser.securityWarning,g=this.Spread.document||document;if(!f)f=$$(g.body).getChildTag("FORM");var d=[];$$.utils.removeBackgroundImages(e,true);for(var b=e.childNodes.length-1;b>=0;b--){var a=e.childNodes[b];if(a.nodeType==1&&a.tagName!="INPUT"){var c=g.getElementById(a.id);if(c){$$.utils.removeBackgroundImages(c);c.parentNode.removeChild(c)}f.appendChild(a);h&&d.push(a)}}for(var b=0;b<d.length;b++){var a=d[b];$$.utils.restoreBackgroundImages(a)}},ClearFilterHiddenValueFields:function(){if(this.Spread.isMVCSpread()&&this.FilterEditors!=null){for(var a=[],b=0;b<this.FilterEditors.length;b++){var f=this.FilterEditors[b];if(f==null||f.FilterMenu==null)continue;var g=$$(f.FilterMenu.Holder).getChildTag("DIV","class","TreeHolder"),d=null;if(g!=null&&(d=$$(g).firstChild("DIV"))!=null){a.push(d.id+"_ExpandState");a.push(d.id+"_SelectedNode");a.push(d.id+"_PopulateLog")}}if(a.length>0)for(var h=document.getElementsByTagName("INPUT"),b=h.length-1;b>=0;b--){var c=h[b];if(c.type=="hidden"&&c.id.indexOf(this.Spread.id)!=-1)for(var e=a.length-1;e>=0;e--)if(c.id==a[e]){c.parentNode.removeChild(c);a.splice(e,1);break}}}},LoadFilterHiddenValueFields:function(l,s,o){var i=this.Spread.document||this.Spread.ownerDocument,e=null;if(!s)e=$$(i.body).firstChild("FORM");var h=this.Spread.isMVCSpread();if(e==null&&h)e=i.body;if(e!=null){var f=l.getElementsByTagName("INPUT");if(f.length==0)return;if(o)for(var d=null,t=null,c=f.length-1;c>=0;c--){var a=f[c].id;if(a=="__VALIDATORSCRIPTBLOCK"||a=="__SCRIPTBLOCK"||a=="__ARRAYDECLARES"||a=="__ARRAYDECLARES_LIST"||a=="__EXPANDOSCRIPT"||a=="__STARTUPSCRIPT")continue;(d=i.getElementById(a))!=null&&d.parentNode.removeChild(d);e.appendChild(f[c])}else{if(this.__removedFormElements)this.__removedFormElements=null;for(var m=l.getElementsByTagName("DIV"),j=0;j<m.length;j++){var n=m[j];if(n.className!="TreeHolder")continue;var k=$$(n).firstChild("DIV");if(k!=null){var g=this.__GetFilterTreeHiddenFieldPrefix(k)||k.id;if(g==null||g.length==0)continue;for(var r=g+"_ExpandState",p=g+"_SelectedNode",q=g+"_PopulateLog",d=null,c=f.length-1;c>=0;c--){var b=f[c];if(b.type=="hidden"&&(!h&&b.id.indexOf(g)==0||h&&(b.id==r||b.id==p||b.id==q))){if((d=window.document.getElementById(b.id))!=null){d.parentNode.removeChild(d);this.__removedFormElements=true}e.appendChild(b)}}}}}}},HasFilterBar:function(){if(typeof this.__hasFilterBar=="undefined")if(this.ColumnHeaders!=null){this.__hasFilterBar=false;for(var b=0;b<this.ColumnHeaders.length;b++){var a=this.ColumnHeaders[b];if(a.rows.length>0){this.__hasFilterBar=a.rows[a.rows.length-1].getAttribute("FpSpread")=="fb";break}}}return this.__hasFilterBar},GetFilterBarEditor:function(b){var a=GCWS.FilterEditor.GetEditor(b);if(a==null)if(b.childNodes.length>0)a=a=GCWS.FilterEditor.GetEditor(b.childNodes[0]);return a},IsInFilterBar:function(c,f){if(this.Parent!=null)return this.GetTopSpreadView().IsInFilterBar(c,f);if(c==null)return false;if(this.ColumnHeaders!=null)for(var e=0;e<this.ColumnHeaders.length;e++){var b=this.ColumnHeaders[e].rows;if(b.length>0)for(var a=b.length-1;a>=0;a--)if(b[a].getAttribute("FpSpread")=="fb"){if($$.utils.contains(b[a],c)||b[a]==c)return true}else break}if(f){var d=this.GetSpreadContext().getCorner();if(d!=null)if(d.nextSibling!=null&&d.nextSibling.getAttribute("fb")=="1")return d.nextSibling==c||$$.utils.contains(d.nextSibling,c);else for(var b=d.rows,a=b.length-1;a>=0;a--)if(b[a].getAttribute("FpSpread")=="fb"){if($$.utils.contains(b[a],c)||b[a]==c)return true}else break}return false},IsFilterBarTextBox:function(a){return!this.HasFilterBar()||this.FilterEditors==null||a==null||a.tagName!="INPUT"||a.type!="text"?false:this.IsChild(this.Spread,a)&&a.className=="FilterBarTextBox"},IsReadyToFilter:function(){if(!this.HasFilterBar())return false;var b=$$.utils.getDocActiveElement();if(b!=null){var a=GCWS.FilterEditor.GetEditor(b);return a!=null&&a.Behavior!=null&&a.Behavior.__CanFilterByTextBoxBlur()}return false},GetCulture:function(){var a=this.Spread.getAttribute("culture");if(a==null||a.length==0)a="en";return a},__PrepairScripts:function(a){a=$$.utils.replaceAll(a,"var FpSpread1_","window.FpSpread1_");return a},__RelayoutEnhancedFilters:function(){if(this.FilterEditors!=null)for(var c in this.FilterEditors){var a=this.FilterEditors[c];if(a==null)continue;if(a.IsFilterBar)break;a=a.Editor;var b=a.style.top;a.style.top="0px";a.style.top=b}},__GetFilterTreeHiddenFieldPrefix:function(f){var a=$$(f).firstChild("A");if(a!=null){var e="javascript:TreeView_ToggleNode(",d=a.href.indexOf(e);if(d==0){var c=a.href.indexOf(",",d);if(c!=-1){var b=a.href.substring(e.length,c);if(b.length>0)return b.replace("_Data","")}}}return null},__SetDialogLocation:function(a){var c=this.Spread.getBoundingClientRect(),d=document.documentElement.scrollLeft||document.body.scrollLeft,e=document.documentElement.scrollTop||document.body.scrollTop,b=a.style.display=="none";if(b){a.style.opacity=0;a.style.display="block"}var f=d+c.left+Math.round((this.Spread.offsetWidth-a.offsetWidth)/2),g=e+c.top+Math.round((this.Spread.offsetHeight-a.offsetHeight)/2);a.style.left=Math.max(f,0)+"px";a.style.top=Math.max(g,0)+"px";if(b){a.style.opacity=1;a.style.display="none"}},__AddClientBasedStyle:function(){if(!window.__GCStyleRegistered&&document.getElementById("GC_ClientBaseStyle")==null){var b=$$.browser,e=document.getElementsByTagName("head")[0],c=document.createElement("STYLE"),a="";if(b.quirksMode){a+=GrapeCity.Web.Spread.__QuirksModeStyle;if(b.ie){if(b.ieversion<10)a+=GrapeCity.Web.Spread.__QuirksModeStyleIE9Below;if(b.ieversion==7)a+=GrapeCity.Web.Spread.__QuirksModeStyleIE7}}else if(b.ie)if(b.version==7)a+=GrapeCity.Web.Spread.__StyleIE7;else if(b.version>9)a+=GrapeCity.Web.Spread.__StyleIE10Above;if(a.length>0){c.type="text/css";c.id="GC_ClientBaseStyle";var d=c.sheet||c.styleSheet;if(d)d.cssText=a;else c.appendChild(document.createTextNode(a));e.appendChild(c);window.__GCStyleRegistered=true}}},ShowCustomAutoFilter:function(f,e,d){var c=this.Spread.getTopSpread(),a=c._filterDialog,b;if(!a){a=new GrapeCity.Web.Spread.FilterDialog(c);c._filterDialog=a;b=a.Dialog}else b=a.Dialog;a.HostSpread=this.Spread;this.__SetDialogLocation(b);a.Show(parseInt(b.style.left),parseInt(b.style.top),f,e,d);return a},ShowTop10Filter:function(e,d){var c=this.Spread.getTopSpread(),a=c._top10filterDialog,b;if(!a){a=new GrapeCity.Web.Spread.Top10FilterDialog(c);c._top10filterDialog=a;var f=this.Spread.getBoundingClientRect();b=a.Dialog}else b=a.Dialog;a.HostSpread=this.Spread;this.__SetDialogLocation(b);a.Show(parseInt(b.style.left),parseInt(b.style.top),e,d);return a},ShowFilterColorPicker:function(e,g,d,f){var c=this.Spread.getTopSpread(),a=c._filterColorDialog,b;if(!a){a=new GrapeCity.Web.Spread.FilterColorDialog(c);c._filterColorDialog=a;var h=this.Spread.getBoundingClientRect();b=a.Dialog}else b=a.Dialog;a.HostSpread=this.Spread;this.__SetDialogLocation(b);a.Show(parseInt(b.style.left),parseInt(b.style.top),e,g,d,f);return a},ShowFilterIconPicker:function(f,c,e){var d=this.Spread.getTopSpread(),a=d._filterIconDialog,b;if(!a){a=new GrapeCity.Web.Spread.FilterIconDialog(d);d._filterIconDialog=a;var g=this.Spread.getBoundingClientRect();b=a.Dialog}else b=a.Dialog;a.HostSpread=this.Spread;this.__SetDialogLocation(b);if(c!=null)c=parseInt(c);a.Show(parseInt(b.style.left),parseInt(b.style.top),f,c,e);return a},GetFilterColumn:function(a){if(a!=null&&a.length>0){a=a.replace(this.Spread.id,"");if($$.utils.stringEndsWith(a,",fb")){var d=a.indexOf(",");if(d>=0){var c=a.substring(1,d);c=parseInt(c);return c}}else{var b=a.split(",");if(b.length>2&&b[2]=="ch")return parseInt(b[1])}}return-1},GetFilterEditor:function(a){if(this.FilterEditors!=null){if(typeof a=="string")a=this.GetFilterColumn(a);if(!isNaN(a))for(var b=0;b<this.FilterEditors.length;b++)if(this.FilterEditors[b].Column==a)return this.FilterEditors[b]}return null},GetSpreadContext:function(){return this.Spread.fpSpreadJS.context},OnCellResize:function(a){var c=null;if(typeof a.tagName!="undefined")c=a;else c=a.target?a.target:a.srcElement;var b=c.ConditionalFormatting;if(b)for(var d=0;d<b.length;d++)b[d].Repaint()},RepaintCDFs:function(c,e){if(this.CDF==null)return;if(typeof c=="undefined")c=0;if(typeof e=="undefined")e=this.LastCDFRow;for(var f=c;f<=e;f++){var d=this.CDF[f];if(d!=null)for(var g=0;g<d.length;g++){var b=d[g];if(b==null)continue;for(var a=0;a<b.length;a++)b[a].Repaint(a==0)}}},GetCellCDFs:function(a,c){if(this.CDF==null)return null;if(arguments.length==1&&typeof a=="object"){var d=this.GetCellTableIndexes(a);a=d.Row;c=d.Column}var b=this.CDF[a];return b!=null?b[c]:null},_getCDFs:function(b,c){if(b==null){this.LastCDFRow=-1;this.LastCheckedCDFRow=-1}var a;if(this.FrozenTableRowCount>0&&b==null){a=[this.Viewport0,this.Viewport1];$$.utils.cleanArray(a);a.length>0&&this._getViewCDFs(a)}a=[this.Viewport2,this.Viewport];$$.utils.cleanArray(a);a.length>0&&this._getViewCDFs(a,true,b,c)},_getViewCDFs:function(d,h,b,c){if(this.Viewports==null)return;if(b==null){b=0;c=d[0].rows.length-1}else if(b>c)return;for(var g=-1,e=b;e<=c;e++)for(var f=0;f<d.length;f++){var a=d[f],j=a==this.Viewport0||a==this.Viewport1,i=a==this.Viewport2||a==this.Viewport0,k=a.rows[e];g=this.__GetCDFsInRow(a.id,k,j,i,false);this.LastCDFRow=Math.max(this.LastCDFRow,g)}if(h)this.LastCheckedCDFRow=Math.max(this.LastCheckedCDFRow,c)},__GetCDFsInRange:function(d,h,i,f,e,g){for(var c=-1,a=h;a<i;a++){var b=this.__GetCDFsInRow(d.id,d.rows[a],f,e,g);if(b!=-1)c=b}return c},__GetCDFsInRow:function(o,d,m,l,n){for(var e=false,a=d.rowIndex+(m?0:this.FrozenTableRowCount),g=0;g<d.cells.length;g++){var c=d.cells[g];if(c.getAttribute("cdf")==null)continue;var i=c.cellIndex+(l?0:this.FrozenTableColumnCount),f=c.getElementsByTagName("DIV");if(f.length>0)for(var h=0;h<f.length;h++){var k=f[h];if(k.getAttribute("cdfh")!=null){var j=new GrapeCity.Web.Spread.ConditionalFormatting(this.Spread,k,o,d.rowIndex,c.cellIndex);if(this.CDF==null)this.CDF=[];if(this.CDF[a]==null)this.CDF[a]=[];var b=this.CDF[a][i];if(b==null){b=[];this.CDF[a][i]=b}b.push(j);n&&j.Repaint(b.length==1);if(!e)e=true}}}return e?a:-1},CDF_OnLoadRowStop:function(){if(this.__oldRowCount!=null)try{var c=this.Viewport2||this.Viewport,d=c.rows.length,a=-1,b=-1;if(this.Viewport2!=null)a=this.__GetCDFsInRange(this.Viewport2,this.__oldRowCount,this.Viewport2.rows.length,false,true,true);if(this.Viewport!=null)b=this.__GetCDFsInRange(this.Viewport,this.__oldRowCount,this.Viewport.rows.length,false,false,true);this.LastCDFRow=Math.max(this.LastCDFRow,Math.max(a,b))}catch(e){window.$DEBUG&&alert("Error when update CDF after load row!\n"+e.message)}},StartEditCDFCell:function(d,c,e){var m=this.GetSpreadContext(),h=this.GetCellTableIndexes(d),l=h.Row,k=h.Column,f=this.GetCellCDFs(l,k);if(f!=null)for(var b=0;b<f.length;b++)f[b].Hide();var g=$$(d).getChildTag("DIV","gc","1");if(g!=null)for(var b=0;b<g.childNodes.length;b++){var i=g.childNodes[b];if(i.nodeType==1)i.style.display="none"}var a=$$(d).getChildTag("DIV","cfContentBound"),j=c!=null?$$.utils.contains(document.body,c)?$$(c).style("position"):c.style.position:"";if(j!="absolute")if(a!=null&&a.style.display!="none"&&a.getAttribute("hideText")==null)a.style.display="none";if(typeof e=="undefined")e=this.GetSpreadContext().getCellType(d);if(a!=null&&e=="MultiColumnComboBoxCellType")a.innerHTML=""},EndEditCDFCell:function(e,d){var j=-1,i=-1,h=this.GetCellTableIndexes(e),j=h.Row,i=h.Column,c=this.GetCellCDFs(j,i);if(c!=null)for(var b=0;b<c.length;b++)c[b].Show();var f=$$(e).getChildTag("DIV","gc","1");if(f!=null)for(var b=0;b<f.childNodes.length;b++){var g=f.childNodes[b];if(g.nodeType==1&&g.style.display=="none")g.style.display="block"}var a=$$(e).getChildTag("DIV","cfContentBound");if(d!=a&&d.style.display=="none")d.style.display=$$.browser.ie?"":"inline";if(a!=null&&a.getAttribute("hideText")==null)if(!$$.browser.ie||$$.browser.version>7)a.style.display="";else a.style.display=a.style.overflow!="hidden"?"inline":""},GetCellTableIndexes:function(a){var d=a.parentNode.rowIndex,c=a.cellIndex,b=false;if((b=this.IsChild(this.Viewport,a))||this.IsChild(this.Viewport2,a))d+=this.FrozenTableRowCount;if(b||this.IsChild(this.Viewport1,a))c+=this.FrozenTableColumnCount;return{Row:d,Column:c}},GetCDF:function(c){var d=this.GetSpreadContext(),a=this.GetCellTableIndexes(c),b=this.GetCellCDFs(a.Row,a.Column);return b},RepaintCellCDF:function(c){var b=this.GetCDF(c);if(b!=null)for(var a=0;a<b.length;a++)b[a].Repaint(a==0)},AttachEvents:function(){if(this.ContextMenus!=null){var a=[this.Viewport0,this.Viewport1,this.Viewport2,this.Viewport,this.Spread.getRowHeader(),this.Spread.getFrozRowHeader(),this.Spread.getColHeader(),this.Spread.getFrozColHeader()];$$.utils.cleanArray(a);var b=this.GetSpreadContext().getViewportHolder?this.GetSpreadContext().getViewportHolder():null;if(this.__menuDel!=null){FarPoint.System.DetachEvent(a[c].parentNode,"contextmenu",this.__menuDel,false);b!=null&&FarPoint.System.DetachEvent(b,"contextmenu",this.__menuDel,false)}this.__menuDel=Function.CreateDelegate(this,this.OnContextMenu);for(var c=0;c<a.length;c++)FarPoint.System.AttachEvent(a[c].parentNode,"contextmenu",this.__menuDel,false);b!=null&&FarPoint.System.AttachEvent(b,"contextmenu",this.__menuDel,false)}},FindContextMenu:function(a){if(!a||this.ContextMenus==null)return null;for(var f=[this.Viewports,this.RowHeaders,this.ColumnHeaders],h=[GrapeCity.Web.Spread.ContextMenuType.Viewport,GrapeCity.Web.Spread.ContextMenuType.RowHeader,GrapeCity.Web.Spread.ContextMenuType.ColumnHeader],b=0;b<f.length;b++){var d=f[b];if(d==null)continue;for(var e=0;e<d.length;e++){var g=d[e].parentNode;if(a==g||this.IsChild(g,a))return this.ContextMenus[h[b]]}}var c=this.GetSpreadContext().getViewportHolder?this.GetSpreadContext().getViewportHolder():null;return c!=null&&(c==a||$$.utils.contains(c,a))?this.ContextMenus[GrapeCity.Web.Spread.ContextMenuType.Viewport]:null},IsChild:function(a,b){return FarPoint.System.IsChild(a,b)},BuildContextMenu:function(){var c=$$.utils;for(area in GCWS.ContextMenuType){var a=GCWS.ContextMenuType[area],b=document.getElementById(this.Spread.id+"_Menu_"+a),e=c.firstTaggedChild(b,"UL");if(b!=null){var d=new GrapeCity.Web.Spread.ContextMenu(this.Spread,a,e,null);if(this.ContextMenus==null)this.ContextMenus=[];this.ContextMenus[a]=d}}},RemoveMenus:function(b){if(this._menuHolders==null)return;for(var a=this._menuHolders.length-1;a>=0;a--)if(!b||!$$(this._menuHolders[a]).firstChild("UL").Behavior.IsFilterMenu)this._menuHolders[a].parentNode&&this._menuHolders[a].parentNode.removeChild(this._menuHolders[a]);this._menuHolders=null},IsControl:function(a){return a!=null&&(a.tagName=="INPUT"||a.tagName=="TEXTAREA"||a.tagName=="SELECT")},IsRightClick:function(a){return $$.utils.isRightClick(a)},InSelection:function(a,b,h,g){var c=this.GetSpreadContext(),i=this.IsColumnHeaderCell(a),j=this.IsRowHeaderCell(a);if(typeof b=="undefined"){b=c.getRowFromCell(a);b=this.Spread.GetSheetIndex(b);h=c.getColFromCell(a);g=this.IsRowLayoutMode?parseInt(a.parentNode.getAttribute("row")):-1}var d=c.GetSelectedRanges();if(d.length>0){for(var l=new GCWS.CellRange(!i?b:-1,!j?h:-1,1,1,g),f=false,e=0;e<d.length;e++){var m=d[e],k=this.__CovertRange(m);if(k.IsCoverable(l)){f=true;break}}if(f)return true}},IsColumnHeaderCell:function(a){return a!=null&&a.tagName=="TD"&&a.parentNode.getAttribute("FpSpread")=="ch"},IsRowHeaderCell:function(a,c){if(a==null)return false;if(!c)return a.parentNode.getAttribute("FpSpread")=="rh";else if(this.RowHeaders!=null)for(var b=0;b<this.RowHeaders.length;b++)if($$.utils.contains(this.RowHeaders[b],a))return true;return false},__CovertRange:function(a){var b=null;if(this.IsRowLayoutMode&&a.col==-1&&a.row!=-1)b=new GCWS.CellRange(a.row,a.col,a.rowCount*this.LayoutRowCount,a.colCount,a.innerRow);else b=new GCWS.CellRange(a.row,a.col,a.rowCount,a.colCount,a.innerRow);return b},__MoveDown:function(a,e,c,b){a.moveDown(e,c,false,false,true);if(this.IsRowLayoutMode){var f=a.getCellFromRowCol(this.Spread.ActiveRow,this.Spread.ActiveCol),d=parseInt(f.getAttribute("col"));!isNaN(d)&&d!=b&&this.__MoveDown(a,this.Spread.ActiveRow,c,b);return}},GetComboBoxBehavior:function(){if(typeof this.__comboBoxBehavior=="undefined")this.__comboBoxBehavior=FarPoint.System.WebControl.MultiColumnComboBoxCellType.GetMcctObject(this.Spread.id);return this.__comboBoxBehavior},RegisterDelayedRequest:function(a){this.__delayedDelegate=a},PopDelayedRequest:function(){var a=this.__delayedDelegate;this.__delayedDelegate=null;return a},CloseEditorDropDown:function(){var e=this.Spread.getEditingInfo();if(e!=null){var a=this.Spread.getAnchorCell(),f=this.GetSpreadContext().getCellType(a);if(f=="MultiColumnComboBoxCellType")d(e.Editor.id);else if(a.querySelectorAll&&a.getAttribute("RowEditTemplate")=="true"){var b=a.querySelectorAll("DIV[FpEditor='MultiColumnComboBoxCellType']");if(b&&b.length>0)for(var c=0;c<b.length;c++)if(d(b[c].id))break}}function d(b){var a=window[b+"_Obj"];if(a&&a.getIsDrop()){a.ShowHideContainer(false,true);return true}return false}},DetachScrollEvents:function(){for(var a=this.GetSpreadContext(),c=[a.getScrollvp(),a.getViewport1(),a.getViewport2(),a.getViewport(),a.getRowHeader(),a.getColHeader(),a.getColFooter()],d=[],b=0;b<c.length;b++)if(c[b]!=null){d.push({target:c[b].parentNode,handler:c[b].parentNode.onscroll});c[b].parentNode.onscroll=null}return d},AttachScrollEvents:function(b){for(var a=0;a<b.length;a++){var c=b[a];c.target.onscroll=c.handler}},SuspendSpreadFocus:function(){if(this.__suspendFocusCount==null)this.__suspendFocusCount=1;else this.__suspendFocusCount++},ResumeSpreadFocus:function(){if(this.__suspendFocusCount!=null&&this.__suspendFocusCount>0)this.__suspendFocusCount--},IsSuspendFocusSpread:function(){return this.__suspendFocusCount>0},SuspendShowFocusRectangle:function(){if(this.Parent!=null){var a=this.GetTopSpreadView();a.SuspendShowFocusRectangle();return}if(this.__suspendShowFocusRectCount==null)this.__suspendShowFocusRectCount=1;else this.__suspendShowFocusRectCount++},ResumeShowFocusRectangle:function(){if(this.Parent!=null){var a=this.GetTopSpreadView();a.ResumeShowFocusRectangle();return}if(this.__suspendShowFocusRectCount!=null&&this.__suspendShowFocusRectCount>0)this.__suspendShowFocusRectCount--},IsSuspendShowFocusRectangle:function(){if(this.Parent!=null){var a=this.GetTopSpreadView();return a.IsSuspendShowFocusRectangle()}return this.__suspendShowFocusRectCount>0},SuspendPaintSelection:function(){if(this.Parent!=null){var a=this.GetTopSpreadView();a.SuspendPaintSelection();return}if(this.__suspendPaintSelectionCount==null)this.__suspendPaintSelectionCount=1;else this.__suspendPaintSelectionCount++},ResumePaintSelection:function(){if(this.Parent!=null){var a=this.GetTopSpreadView();a.ResumePaintSelection();return}if(this.__suspendPaintSelectionCount!=null&&this.__suspendPaintSelectionCount>0)this.__suspendPaintSelectionCount--},IsSuspendPaintSelection:function(){if(this.Parent!=null){var a=this.GetTopSpreadView();return a.IsSuspendPaintSelection()}return this.__suspendPaintSelectionCount>0},SuspendAction:function(c,b){if(b==null)return;var a=c.getSpreadView();if(!a.__suspendActions)a.__suspendActions=[];if(!a.__suspendActions[b])a.__suspendActions[b]=1;else a.__suspendActions[b]=a.__suspendActions[b]+1},ResumeAction:function(c,a){var b=c.getSpreadView();if(a==null||!b.__suspendActions||!b.__suspendActions[a])return;if(b.__suspendActions[a]>0)b.__suspendActions[a]=b.__suspendActions[a]-1},IsSuspendedAction:function(c,a){var b=c.getSpreadView();return a==null||!b.__suspendActions||!b.__suspendActions[a]?false:b.__suspendActions[a]>0},RegisterTimeoutTask:function(e,d,f,b,g){var i=this.GetTopSpreadView();if(this!=i)return i.RegisterTimeoutTask(e,d,f,b,b?g||this:null);var c=setTimeout(Function.CreateDelegate(this,function(){this._RemoveTimeoutTask(c);e()}),d);if(this.__TimeOutTasks==null)this.__TimeOutTasks=[];var a={TimeoutId:c,Type:f,Delay:d};if(b)a.SpreadView=g||this;var h=this;a.ReRegister=function(){h.UnregisterTimeoutTask(f);h.RegisterTimeoutTask(e,d,f,b,g)};a.Execute=function(){clearTimeout(c);h._RemoveTimeoutTask(c);e()};this.__TimeOutTasks.push(a);return a},_GetTimeoutTask:function(c){if(this.__TimeOutTasks!=null)for(var b=0;b<this.__TimeOutTasks.length;b++){var a=this.__TimeOutTasks[b];if(a.Type==c&&(a.SpreadView==null||a.SpreadView==this))return a}return null},_RemoveTimeoutTask:function(c){var d=this.GetTopSpreadView();if(this!=d)return d._RemoveTimeoutTask(c);if(this.__TimeOutTasks==null)return;for(var b=-1,a=0;a<this.__TimeOutTasks.length;a++)if(this.__TimeOutTasks[a].TimeoutId==c){b=a;break}if(b!=-1){this.__TimeOutTasks.splice(b,1);return true}return false},UnregisterTimeoutTask:function(){var b=arguments.length;if(b==0)return;var g=this.GetTopSpreadView();if(this!=g){for(var e=[],a=0;a<b;a++)e.push(arguments[a]);e.push(this);this.UnregisterTimeoutTask.apply(g,e)}else if(this.__TimeOutTasks!=null){var d;if(typeof arguments[b-1]!="string"){b--;d=arguments[b]}else d=this;for(var a=this.__TimeOutTasks.length-1;a>=0;a--)for(var c=this.__TimeOutTasks[a],f=0;f<b;f++)if(c.Type==arguments[f]&&(c.SpreadView==null||c.SpreadView==d)){clearTimeout(c.TimeoutId);this.__TimeOutTasks.splice(a,1)}}},ClearTimeoutTasks:function(){var b=arguments.length>0?arguments[0]:null,c=this.GetTopSpreadView();if(this!=c)return c.ClearTimeoutTasks(b);if(this.__TimeOutTasks!=null){for(var a=this.__TimeOutTasks.length-1;a>=0;a--){var d=this.__TimeOutTasks[a];if(b!=null&&d.Type!=b)continue;try{clearTimeout(d.TimeoutId);this.__TimeOutTasks.splice(a,1)}catch(e){}}if(this.__TimeOutTasks.length==0)this.__TimeOutTasks=null;return true}return false},RegisterIntervalTask:function(a,b,c){var d=this.GetTopSpreadView();if(this!=d)return d.RegisterIntervalTask(a,b,c);var f=setInterval(Function.CreateDelegate(this,function(){if(typeof a=="function")a();else{var c=a.Context,b=a.Func;typeof b=="function"&&b.apply(c)}}),b);if(this.__IntervalTasks==null)this.__IntervalTasks=[];var e={IntervalId:f,Type:c,Func:a,Interval:b};this.__IntervalTasks.push(e);return e},UnregisterIntervalTask:function(b){var d=this.GetTopSpreadView();if(this!=d)return d.UnregisterIntervalTask(b);if(this.__IntervalTasks==null)return;for(var c=-1,a=0;a<this.__IntervalTasks.length;a++)if(!isNaN(b)&&this.__IntervalTasks[a].IntervalId==b||this.__IntervalTasks[a].Type==b){c=a;break}if(c!=-1){this.__IntervalTasks.splice(c,1);return true}return false},ClearIntervalTasks:function(){var b=arguments.length>0?arguments[0]:null,c=this.GetTopSpreadView();if(this!=c)return c.ClearIntervalTasks(b);if(this.__IntervalTasks!=null){for(var a=this.__IntervalTasks.length-1;a>=0;a--){var d=this.__IntervalTasks[a];if(b!=null&&d.Type!=b)continue;try{clearInterval(d.IntervalId);this.__IntervalTasks.splice(a,1)}catch(e){}}if(this.__IntervalTasks.length==0)this.__IntervalTasks=null;return true}return false},StopIntervalTasks:function(b,e){var d=this.GetTopSpreadView();if(this!=d)return d.StopIntervalTasks(b);if(this.__IntervalTasks!=null){for(var a=this.__IntervalTasks.length-1;a>=0;a--){var c=this.__IntervalTasks[a];if(b!=null&&c.Type!=b)continue;try{clearInterval(c.IntervalId);c.IntervalId=-1;e&&this.__IntervalTasks.splice(a,1)}catch(f){}}return true}return false},StartIntervalTasks:function(c){var e=this.GetTopSpreadView();if(this!=e)return e.StartIntervalTasks(c);if(this.__IntervalTasks!=null){for(var d=0;d<this.__IntervalTasks.length;d++){var a=this.__IntervalTasks[d];if(c!=null&&a.Type!=c||a.IntervalId!=-1)continue;try{var b=a.Func,f=setInterval(Function.CreateDelegate(this,function(){if(typeof b=="function")b();else{var c=b.Context,a=b.Func;typeof a=="function"&&a.apply(c)}}),a.Interval);a.IntervalId=f}catch(g){}}return true}return false},IsIntervalRegistered:function(a){var d=this.GetTopSpreadView();if(this!=d)return d.IsIntervalRegistered(a);var b=false;if(this.__IntervalTasks!=null)for(var f=typeof a=="function",c=0;c<this.__IntervalTasks.length;c++){var e=this.__IntervalTasks[c];b=e.Type==a||f&&e.Func==a;if(b)break}return b},IsSpreadActive:function(a){return this.Spread==this.GetActiveSpread(a)},ContainsActive:function(){if(this.IsSpreadActive())return true;var b=this.GetActiveSpread();if(b!=null){var a=b.getSpreadView();if(a.GetTopSpreadView()==this.GetTopSpreadView()){while(a!=null&&a!=this)a=a.Parent;if(a!=null)return true}}return false},GetActiveSpreadView:function(c,b,d){var a=c?this.GetActiveSpread(d):(b?this.GetTopSpreadView().Spread:this.Spread).GetActiveChildSheetView(true);return a==null||!a.initialized?!c&&b?this.GetTopSpreadView():null:a.getSpreadView()},GetActiveSpread:function(b){var a=document.FpActiveSpread;if(!b&&a!=null&&typeof a.getAttribute!="unknown"&&a.getAttribute("mcctCellType")!=null)if(a.getAttribute("EnableClientScript")=="0")return null;else a=document.getElementById(a.getAttribute("hostspread"));return a},IsTextBoxActive:function(){var a=this.__GetSpreadTextBox();return a!=null&&a==document.activeElement},FocusSpread:function(j,k,f,e){var b=this.GetSpreadContext();if(this.IsSuspendFocusSpread())return;var d=this.Spread.GetActiveChart();if(d!=null)d!=document.activeElement&&d.focus();else{var a=j?b.getEditor(this.Spread.getAnchorCell()):null;if(a==null){a=this.__GetSpreadTextBox();var h,g,i;if(this.IsMultiBrowserMode())b.detachOnActiveEvents();else{var h=this.Spread.onactivate,g=a.onactivate,i=a.onfocus;this.Spread.onactivate=null;a.onactivate=null;a.onfocus=null}if($$.browser.ie||!this.IsInTouchMode()&&!$$.browser.webkit){if(document.activeElement!=null&&document.activeElement!=a&&document.activeElement.blur)$$.utils.contains(document.body,document.activeElement)&&document.activeElement.blur()}else this.IsInTouchMode()&&$$.browser.isTouchEventModel&&this.EditModePermanent&&typeof e!="undefined"&&b.switchHiddenTextBox(e);if(this.RequireUpdateTextBoxLocation()){var c=this.Spread.getAnchorCell();this.UpdateTextBoxLocation(c&&this.IsViewportCell(c)?c:null)}a.focus();k&&a.focus();!$$.browser.ie&&this.ResumePaintSelection();if(this.IsMultiBrowserMode())b.attachOnActiveEvents();else{this.Spread.onactivate=h;a.onactivate=g;a.onfocus=i}}else{this.NeedSetEditorFocusOnActiveCell()&&b.setEditorFocus(a);f&&!this.Spread.isEditing()&&this.Spread.StartEdit(this.Spread.getAnchorCell())}}},SetControlFocus:function(c,a){var b;if(!a){b=this.Spread.onactivate;this.Spread.onactivate=null}$$(c).focus(true);if(!a)this.Spread.onactivate=b},__GetSpreadTextBox:function(){if(this.__textbox==null||$$.browser.webkit&&this.EditModePermanent){var a=this.Spread.getTopSpread();this.__textbox=document.getElementById(a.id+"_textBox")}return this.__textbox},RequireUpdateTextBoxLocation:function(){return!$$.browser.ie},UpdateTextBoxLocation:function(b,f){var c=this.GetTopSpreadView(),a=this.__GetSpreadTextBox();if(a==null||!this.RequireUpdateTextBoxLocation()||c.Spread.ignoreUpdateTextBoxLocation&&!$$.utils.isElementHidden(a,c.Spread,true))return;if(a!=null){if(this.IsInTouchMode()&&this.Touch.lastPointerDownEvent&&!this.IsInViewport(this.Touch.lastPointerDownEvent.target)&&window.parent!=window)b={left:this.Touch.lastPointerDownEvent.clientX+5,top:this.Touch.lastPointerDownEvent.clientY+5};var d=b&&b.nodeType==1?!this._IsCellHidden(b)?$$.utils.getViewArea(b):null:b;if(d)$$(a).moveToPosition(d.left,d.top);else{var e=$$.utils.getViewArea(c.Spread);if(e)$$(a).moveToPosition(e.left,e.top);else f&&$$(a).moveToPosition((window.innerWidth||window.clientWidth)/2,(window.innerHeight||window.clientHeight)/2)}}},IsProcessTab:function(){var b=this.GetTopSpreadView().Spread,a=b.getAttribute("ProcessTab");return a!=null&&a.toLowerCase()=="true"},ChangeCursor:function(a,c){if(!a||a.nodeType!=1)return;var b=$$.utils.GetCell(a);if(b!=null)a=b;if(a.__cursor==null)a.__cursor=a.style.cursor;a.style.cursor=c;if(this.__changedCursorElemnts==null)this.__changedCursorElemnts=[];if(this.IsMultiBrowserMode())this.__changedCursorElemnts.indexOf(a)==-1&&this.__changedCursorElemnts.push(a);else this.__changedCursorElemnts.push(a)},RestoreCursor:function(c){if(this.__changedCursorElemnts!=null&&this.__changedCursorElemnts.length>0){for(var d=this.__changedCursorElemnts.length,e=$$.browser.ie&&$$.browser.version==7||$$.browser.quirksMode,b=c?1:0;b<d;b++){var a=this.__changedCursorElemnts[b];if(a.__cursor!=null&&a.__cursor!=""){a.style.cursor=a.__cursor;a.__cursor=null}else a.style.cursor=!e?this.IsMultiBrowserMode()?"":"inherit":"default"}if(!c)this.__changedCursorElemnts=null;else this.__changedCursorElemnts.splice(1,d-1)}},GetMultiColumnComboBoxContainer:function(a){do{if(!a.getAttribute)break;var b=a.getAttribute("FpSpread");if(b!=null)return b=="mccbContainer"?a:null;a=a.parentNode}while(a!=null);return null},GetHostSpread:function(b){var g=this.GetSpreadContext(),a,c=this.GetTopSpreadView();if(c.ActiveDialog!=null)if($$.utils.contains(c.ActiveDialog.Dialog,b))a=c.ActiveDialog.HostSpread||c.ActiveDialog.Control;else{var d=GrapeCity.Web.DatePicker.GetInstance();if(d!=null&&$$.utils.contains(c.ActiveDialog.Dialog,d.Target)){var f=d._GetDatePickerContainer();if(f==b||$$.utils.contains(f,b))a=c.ActiveDialog.HostSpread||c.ActiveDialog.Control}}else{var d=GrapeCity.Web.DatePicker.GetInstance();if(d!=null){a=g.getSpreadControl(d.Target);var f=d._GetDatePickerContainer();if(a!=null&&f!=b&&!$$.utils.contains(f,b))a=null}}if(a!=null)return a;a=g.getSpreadControl(b);if(a!=null)return a;if(b==null)return document.getElementById(this.Spread.getAttribute("hostspread"));var e=b;while(e!=null){if(e.getAttribute&&e.getAttribute("HostSpreadID")!=null)return document.getElementById(e.getAttribute("HostSpreadID"));e=e.parentNode}return null},SaveAllXmlData:function(a){var e=!a||!a.spreadView?this:a.spreadView;this.GetSpreadContext().saveData(a);var b=e.ChildSpreadViews;if(b!=null&&b.length>0)for(var c=0;c<b.length;c++){var d=b[c].GetSpreadContext();(!a||!a.dirtyCheck||!d.isDirty||d.isDirty())&&d.saveData(a);this.SaveAllXmlData({spreadView:b[c]})}},_InitAnchorCell:function(b){if(b!=null){var a=b.getSpreadView();if(a.GetTopSpreadView()==this.GetTopSpreadView())b.getAnchorCell()==null&&(a.OperationMode==$$.OperationModes.NORMAL||a.OperationMode==$$.OperationModes.ROW_MODE)&&b.GetActiveChart()==null&&a.GetSpreadContext().initAnchorCell()}},SetAnchorCell:function(b,u,f,j){var a=this.GetSpreadContext();if(this.Spread.getAnchorCell()==b||b!=null&&b.HtmlCell!=null&&b.HtmlCell==this.Spread.getAnchorCell())return false;for(var r=a.getXmlActiveRow(),p=a.getXmlActiveCol(),h=a.getSelection(),i=0;i<h.childNodes.length;i++)if(h.childNodes[i].getAttribute("anchor")!=null){h.removeChild(h.childNodes[i]);break}if(b!=null){if(j==null)j=true;var m,l;if(b.nodeName==null){m=b.Row;l=b.Column;b=b.HtmlCell}var n=false,e=-1,g=m!=null?this._GetRow(m):null,d=l!=null?l:this._GetColumnIndex(b),c=-1,o=this.IsInFilterBar(b),k=this.IsColumnHeaderCell(b)||o;if(!k)c=g?g.ViewIndex:this._GetRowViewIndex(b);if(this.IsRowLayoutMode)if(!k)e=g!=null?g.LayoutIndex:this._GetRowByViewIndex(c).LayoutIndex;else e=parseInt(b.parentNode.getAttribute("row"));if(f==null)f=true;var q=k||this.RowHeader.Contains(b);f=f&&!q;if(f)if(this.Spread.fireActiveCellChangingEvent)n=this.Spread.fireActiveCellChangingEvent(c,d,this.Spread,e,true);else if(a.fireActiveCellChangingEvent)n=a.fireActiveCellChangingEvent(c,d,this.Spread,e,true);if(n)return false;a.setAnchorCell(b,true);if(a.isSmartPaint()&&!q){a.setActiveRow(g!=null?g.DataIndex:this._GetRowByViewIndex(c).DataIndex);a.setActiveCol(!this.IsRowLayoutMode?a.getColKeyFromCol(d):d)}else a.saveAnchorCell(b);var t=a.getRowFromCell(b),s=a.getColFromCell(b);j&&a.setLeadingCell(t,s);a.setStartSelectLocation(t,s);u&&this.__ClearOldAnchorCell(r,p);!o&&a.paintAnchorCell(true,true);if(f)if(a.fireActiveCellChangedEvent)a.fireActiveCellChangedEvent(c,d,this.Spread,e,true,true);else this.Spread.fireActiveCellChangedEvent(c,d,this.Spread,e,true,true);return true}else{a.setAnchorCell(null,true);a.setActiveRow(-1);a.setActiveCol(-1);this.__ClearOldAnchorCell(r,p);return false}},__ClearOldAnchorCell:function(f,e,k){if(this.OperationMode!=$$.OperationModes.NORMAL&&this.OperationMode!=$$.OperationModes.ROW_MODE)return;var b=this.GetSpreadContext();if(f==null)f=b.getXmlActiveRow();if(e==null)e=b.getXmlActiveCol();if(f!=-1&&e!=-1){var m=false,j=b.GetSelectedRanges(true),h=b.getRowByKey(f),g=b.getColByKey(e),c=b.getCellFromRowCol(h,g);if(c!=null){var i=[];if(!k&&j!=null)for(var l=this.OperationMode!=$$.OperationModes.ROW_MODE?c.rowSpan:1,d=0;d<j.length;d++){var a=j[d];!a.anchor&&a.IsIntersectWith(h,g,l,c.colSpan)&&i.push(a)}b.paintSelectedCell(c,false,false);this.ColumnHeader.RowCount>0;b.paintHeaderSelection(h,g,1,!this.IsInTouchMode?1:c.colSpan,false,true);this.RowHeader.ColumnCount>0&&b.paintHeaderSelection(h,g,!this.IsInTouchMode||this.OperationMode==$$.OperationModes.ROW_MODE?1:c.rowSpan,1,false,false);for(var d=0;d<i.length;d++){var a=i[d];if(!this.IsRowLayoutMode||!(a.row==-1&&a.col>-1))b.paintSelection(a.row,a.col,a.rowCount,a.colCount,true,true);else{if(a.innerRow==null||a.innerRow==-1)a.innerRow=0;b.paintMultipleRowSelection(a.innerRow,a.col,-1,a.colCount,true,true)}}}}},FindExpandRowColumnRange:function(h,c){var b=null,d=false,a=this.Spread.getAnchorCell();if(h){d=a!=null&&a.colSpan>1;if(d)if(a.colSpan!=this.ColumnCount||a.rowSpan!=this.RowCount){var g=this._GetRowIndex(a),f=this._GetColumnIndex(a);b=this.SpanModel.Find(g,f);if(b!=null&&(b.Column<c.Column||b.Column+b.ColumnCount>c.Column+c.ColumnCount)){var e=this._FindColumnActiveCell(c.Column,c.ColumnCount,-1);if(e!=null){e.HtmlCell!=a&&this.SetAnchorCell(e,true,true);d=false}}else d=false}else b=new GCWS.CellRange(0,0,this.RowCount,this.ColumnCount)}else{d=a!=null&&a.rowSpan>1;if(d)if(a.rowSpan!=this.RowCount||a.colSpan!=this.ColumnCount){var g=this._GetRowIndex(a),f=this._GetColumnIndex(a);b=this.SpanModel.Find(g,f);if(b!=null&&(b.Row<c.Row||b.Row+b.RowCount>c.Row+c.RowCount)){var e=this._FindRowActiveCell(c.Row,c.RowCount);if(e!=null){e.HtmlCell!=a&&this.SetAnchorCell(e,true,true);d=false}}else d=false}else b=new GCWS.CellRange(0,0,this.RowCount,this.ColumnCount)}return d?b:null},GetActiveSpanCellRange:function(a){if(this.SpanModel.length==0)return null;if(a==null)a=this.Spread.getAnchorCell();var c=this._GetRowIndex(a),b=this._GetColumnIndex(a);return this.SpanModel.Find(c,b)},CorrectPaintSelection:function(){var c=false,d=this.GetSpreadContext(),a=this.Spread.getAnchorCell();if(!this.IsRowLayoutMode&&a!=null&&this.OperationMode==$$.OperationModes.ROW_MODE&&a.rowSpan>1){var b=this.GetActiveSpanCellRange(a);if(b!=null){var e=this.SelectionModel.GetFocusCellRange();if(b.Row!=e.Row){d.paintHeaderSelection(d.getRowFromCell(a),-1,1,-1,false,false);c=true}}}return c},CorrectSelection:function(n){var i=false;if(this.OperationMode==$$.OperationModes.NORMAL&&!this.IsRowLayoutMode&&this.SpanModel.length>0){var h=this.GetSpreadContext(),j=h.getSelection(),f=this.Spread.getAnchorCell(),m=this.IsViewportCell(f);if(j.childNodes.length==0)return false;var e=j.childNodes[j.childNodes.length-1],d=new GCWS.Range;h.getRangeFromNode(e,d);var a=new GCWS.CellRange(d.row!=-1?this._GetRowIndexByViewIndex(d.row):d.row,d.col,d.rowCount,d.colCount),b,g=a.Row!=-1&&a.Column!=-1,c=null,k=false;if(!g&&this.OperationMode==$$.OperationModes.NORMAL&&m){c=this.GetActiveSpanCellRange(f);if(f.rowSpan>1&&a.Row!=-1&&a.Column==-1)g=c.Row<a.Row||c.Row+c.RowCount>a.Row+a.RowCount;else if(f.colSpan>1&&a.Column!=-1&&a.Row==-1){g=c.Column<a.Column||c.Column+c.ColumnCount>a.Column+a.ColumnCount;k=true}}if(g){b=!n||c==null?this._FindExpandedSelection(a):c.UnionWith(a);if(b!=a){var l=b.Row!=-1?this._GetRow(b.Row).ViewIndex:b.Row;e.setAttribute("row",l);e.setAttribute("col",b.Column);e.setAttribute("rowIndex",l);e.setAttribute("colIndex",b.Column);e.setAttribute("rowcount",b.RowCount);e.setAttribute("colcount",b.ColumnCount);i=true}}i&&k&&h.syncColSelection()}return i},CorrectAnchorCell:function(n,j,h){var f=this.GetSpreadContext(),a=n||this.SelectionModel._GetFocusRange();if(a!=null){var m=a.Row==-1&&a.Column>-1,o=a.Column==-1&&a.Row>-1,b,c=null;if(m){if(!h){b=this._FindColumnActiveCell(a.Column,a.ColumnCount,a.LayoutRow,true);if(b==null&&this.RowCount>0)b=this.GetCell(0,a.Column,true)}else b=this.GetCell(Math.max(a.LayoutRow,0),a.Column,true);if(b==null&&this.ColumnHeader.RowCount>0){if(a.LayoutRow==-1)a.LayoutRow=0;var k=this.IsRowLayoutMode?a.LayoutRow:this.ColumnHeader.RowCount-1;c=this.ColumnHeader._GetHtmlCell(k,a.Column)}}else if(o){if(!h){b=this._FindRowActiveCell(a.Row,a.RowCount,true);if(this.OperationMode!=$$.OperationModes.EXTENDED_SELECT&&b==null&&this.ColumnCount>0)b=this.GetCell(a.Row,0,true)}else b=this.GetCell(a.Row,0,true);if(b==null&&this.RowHeader.ColumnCount>0)for(var g=this.RowHeader.ColumnCount-1;g>=0;g--){var i=this.RowHeader._GetHtmlCell(a.Row,g);if(i!=null){c=i;break}}}else if(a.Column==-1&&a.Row==-1)b=this._FindSheetActiveCell();else if(!j)b=this.GetCell(a.Row,a.Column,true);var e=false,d=this.Spread.getAnchorCell();if(c==null&&b!=null)c=b.HtmlCell;if(c!=null)if((d==null||$$.utils.contains(this.Spread,d))&&$$.utils.contains(this.Spread,c)){if(d!=c){this.SetAnchorCell(c,true);e=true}}else if(b!=null){var l=this._GetRow(b.Row).DataIndex,p=b.Column;if(f.getXmlActiveRow()!=l||f.getXmlActiveCol()!=b.Column){this.SetAnchorCell(b,true);e=true}}else this.SetAnchorCell(null);else this.SetAnchorCell(null);(e||this.ColumnHeader.Contains(d)||this.RowHeader.Contains(d))&&f.paintAnchorCell(true)}},RepaintIntersectRanges:function(n,l,k,j,a){for(var h=this.GetSpreadContext(),i=h.getSelection(),m=new GCWS.CellRange(n,l,k,j),g=0;g<i.childNodes.length;g++){var b=i.childNodes[g],d=parseInt(b.getAttribute("rowIndex")),c=parseInt(b.getAttribute("colIndex")),f=d!=-1?parseInt(b.getAttribute("rowcount")):-1,e=c!=-1?parseInt(b.getAttribute("colcount")):-1;m.IsIntersectWith(d,c,f,e)&&(a==null||d!=a.row||c!=a.col||f!=a.rowCount||e!=a.colCount)&&h.paintSelection(d,c,f,e,true)}},SwapSelectedRange:function(f,e,l,k){var m=this.GetSpreadContext(),d=m.getSelection(),j=null;if(d!=null&&d.childNodes.length>1)for(var g=0;g<d.childNodes.length;g++){var a=d.childNodes[g],c=parseInt(a.getAttribute("rowIndex")),b=parseInt(a.getAttribute("colIndex"));if(isNaN(c))c=parseInt(a.getAttribute("row"));if(isNaN(b))b=parseInt(a.getAttribute("col"));var i=parseInt(a.getAttribute("rowcount")),h=parseInt(a.getAttribute("colcount"));if((f==c&&e==b&&l==i&&k==h||f==c&&c==-1&&k==1&&b<=e&&e<b+h||l==1&&c<=f&&f<c+i&&b==-1&&e==b)&&g!=d.childNodes.length-1){d.removeChild(a);d.appendChild(a);j=new GCWS.CellRange(c,b,i,h,-1);break}}return j},CanSelectMultiRange:function(d){if(this._canSelectMultiRange==null){var b=this.OperationMode,a=$$.OperationModes,c=this.SelectionModel._ConvertSelectionPolicy();this._canSelectMultiRange=b!=a.MULTI_SELECT&&!(this.IsColumnHeaderCell(d)&&b==a.EXTENDED_SELECT)&&b!=a.SINGLE_SELECT&&b!=a.ROW_MODE&&!(b==a.NORMAL&&c==GCWS.SelectionPolicy.Single)&&!this.IsRowLayoutMode}return this._canSelectMultiRange},GetPreviewRow:function(b){if(b==null)return null;if($$.utils.contains(this.Spread,b)){var a=b;while(a!=null){if(a.tagName&&a.tagName=="TR"&&a.getAttribute("previewRow")=="true")return a;a=a.parentNode}}return null},IsUnSelectableCell:function(b){if(b==null||!$$.utils.contains(this.Spread,b))return false;var h=this.GetSpreadContext(),d=h.getCell(b);if(d!=null)return d.parentNode.getAttribute("FpKey")==null&&d.getAttribute("controltype")!="chgrayarea"&&d.getAttribute("fpspread")!="rowpadding";else{if(b.tagName=="TD"){row=b.parentNode;var a=row.cells[0];if(a==null&&row.childNodes.length>1)for(var c=1;c<row.childNodes.length;c++){a=row.childNodes[c];if(a!=null&&a.tagName=="TD")break}if(a!=null&&a.childNodes.length>0)for(var c=0;c<a.childNodes.length;c++){var g=a.childNodes[c];if(g.nodeType==1)if(g.getAttribute("FpSpread")=="Spread")return true;else break}}var f=h.getSpreadControl(b);if(f!=null&&f.GetParentSpread()!=null){var e=this._FindParentCell(f,this.Spread);return e!=null&&e.parentNode.getAttribute("FpKey")==null&&e.getAttribute("controltype")!="chgrayarea"&&e.getAttribute("fpspread")!="rowpadding"}else return false}},LoadCss:function(buff){var cssField="__CSSLINKS",head=document.getElementsByTagName("head");if(head==null){head=document.createElement("head");if(this.IsMultiBrowserMode())$$.j(head).insertBefore(document.body);else document.documentElement.insertBefore(head,document.body)}else head=head[0];var curCssLinks=[],links=head.getElementsByTagName("link");if(links!=null)for(var i=0;i<links.length;i++){var link=links[i];link.getAttribute("type")=="text/css"&&curCssLinks.push(link.getAttribute("href"))}if(buff.tagName=="IFRAME")buff=buff.contentDocument.documentElement;var cssLinks=$$(buff).getChildTag("INPUT","id",cssField);if(cssLinks){cssLinks=eval("("+cssLinks.value+")");cssLinks=cssLinks.cssLinks;for(var i=0;i<cssLinks.length;i++){var cssLink=cssLinks[i];if($$(curCssLinks).indexOf(cssLink)==-1){var link=document.createElement("link");link.type="text/css";link.rel="stylesheet";link.href=cssLink;head.appendChild(link)}}}},_GetImportRules:function(a){if(a.imports)return a.imports;for(var d=this._GetCssRules(a,false),e=[],c=0;c<d.length;c++){var b=d[c];b.type==this.CSS_IMPORT_RULE&&e.push({cssText:b.cssText,href:b.href})}return e},_GetStyleSheet:function(a){return a.styleSheet?a.styleSheet:a.sheet},_GetCssStyles:function(){for(var a=[],c=this.Spread.getElementsByTagName("style"),b=0;b<c.length;b++)a.push(this._GetStyleSheet(c[b]));var d=this.document.getElementById(this.Spread.id+"_style");d&&a.push(this._GetStyleSheet(d));return a},_GetCssRules:function(b,f){var c=b.cssRules?b.cssRules:b.rules;if(!f)return c;for(var e=[],d=0;d<c.length;d++){var a=c[d];if(a.selectorText==null||a.style==null)continue;var g={selectorText:a.selectorText,style:{cssText:a.style.cssText}};e.push(g)}return e},_GetCssRule:function(f){for(var d=this._GetCssStyles(),b=0;b<d.length;b++)for(var g=d[b],e=this._GetCssRules(g),c=0;c<e.length;c++){var a=e[c];if(a.selectorText==null)continue;if(a.selectorText.toLowerCase()==f.toLowerCase())return a}return null},_UpdateCssStyles:function(n){var m=$$.browser.chrome||$$.browser.webkit,e=[],h=n.getElementsByTagName("style");if(h.length>0){for(var i="",c=0;c<h.length;c++)i+=h[c].innerHTML;if(m){var b=document.createElement("style");b.innerHTML=i;document.body.appendChild(b);var k=this._GetStyleSheet(b);e=this._GetCssRules(k,true);b.parentNode.removeChild(b)}else{var d=this.document.createElement("iframe");this.document.body.appendChild(d);d.contentWindow.document.body.innerHTML='<style type="text/css">'+i+"</style>";var b=d.contentDocument.getElementsByTagName("style")[0],k=this._GetStyleSheet(b);e=this._GetCssRules(k,true);d.parentNode.removeChild(d)}}var l=this.Spread.id,a=this.document.getElementById(l+"_style");if(a==null){a=this.document.createElement("style");a.id=l+"_style";this.document.body.appendChild(a)}for(var f="",c=0;c<e.length;c++){var g=e[c],j=this._GetCssRule(g.selectorText);if(j)j.style.cssText=g.style.cssText;else f+=this.CorrectCssSelector(g.selectorText)+"{"+g.style.cssText+"}"}if(f!="")if(a.styleSheet)a.styleSheet.cssText+=f;else a.innerHTML+=f},_UpdateCssImports:function(d){var c=this.Spread.getTopSpread(),a=document.styleSheets.FpSpread_CssReferences;if(!a){a=document.getElementById("FpSpread_CssReferences");if(!a){a=document.createElement("style");a.id="FpSpread_CssReferences";c.parentNode.insertBefore(a,c)}a=this._GetStyleSheet(a)}if(a){var e=this.GetSpreadContext().getElementById(d.parentNode,"FpSpread_CssReferences");if(e!=null)if(!$$.browser.ie){oldImports=this._GetImportRules(a);var b=document.getElementById(c.id+"_temporary_import_holder");b&&$$.j(b).remove();b=document.createElement("style");b.id=c.id+"_temporary_import_holder";b.innerHTML=e.innerHTML;$$.j(b).one("load",$$.j.proxy(function(a){this._StartImportCssRefs(d,a.target)},this));document.body.appendChild(b)}else this._StartImportCssRefs(d)}},_StartImportCssRefs:function(k,h){var a=document.getElementById("FpSpread_CssReferences");a=this._GetStyleSheet(a);var b=this.GetSpreadContext().getElementById(k.parentNode,"FpSpread_CssReferences"),c,d;if($$.browser.ie){c=a.imports;d=this._GetStyleSheet(b).imports}else{c=this._GetImportRules(a);d=this._GetImportRules(this._GetStyleSheet(h),true);h.innerHTML=""}for(var f=0;f<d.length;f++){for(var i=false,e=d[f],g=0;g<c.length;g++){var l=c[g];if(l.href==e.href){i=true;break}}if(!i){if(a.addImport)a.addImport(e.href);else{var j=document.getElementById("FpSpread_CssReferences");j.textContent+="\r\n"+e.cssText;a=this._GetStyleSheet(j)}c=!$$.browser.ie?this._GetImportRules(a):a.imports}}if(b)if(b.styleSheet)b.styleSheet.cssText="";else b.innerHTML=""},CorrectCssSelector:function(a){if(a==null||a.length==0)return a;for(var d=this.GetSpreadContext().getSpreadTables(),e=a,c=0;c<d.length;c++){var b=d[c];if(b.id==null||b.id.length==0)continue;var f=new RegExp("#"+b.id+"\\s","ig");if(f.test(a)){e="#"+this.Spread.id+" "+a.replace(f,"#"+b.id+" ");break}}return e},GenerateBrowserBaseCssClass:function(a){return $$.browser.getName()+"_"+a},GetTopZIndexChart:function(){for(var b=0,d=this.Spread.getElementsByTagName("DIV"),c=0;c<d.length;c++){var a=d[c];if(a.id.indexOf("_chartContainer")>0&&a.style["z-index"]!=null&&parseInt(a.style["z-index"])>b)b=parseInt(a.style["z-index"])}return b},SetLastMouseDownEvent:function(a){this.GetTopSpreadView()._lastPointerDownEvent=a},GetLastMouseDownEvent:function(){return this.GetTopSpreadView()._lastPointerDownEvent},GetTabIndex:function(){if(this.Parent!=null)return this.GetTopSpreadView().GetTabIndex();var a=this.__GetSpreadTextBox()?this.__GetSpreadTextBox().getAttribute("tabIndex"):null;return a?a:this.Spread.getAttribute("tabIndex")},ApplyDefaultCssStyles:function(){var c=["hct","fct","fcht","cht","fcft","cft","frh","rh","viewport0","viewport1","viewport2","viewport"];this.Spread.style.margin="0px";this.Spread.style.padding="0px";var a=this.Spread.childNodes;if($$.browser.mb){var b=document.getElementById(this.Spread.id+"_top_table");if(b)a=[b.parentNode]}else a=[$$(this.Spread).firstChild("TABLE")];this._ApplyDefaultCssStyles(a,c)},_ApplyDefaultCssStyles:function(i,c){for(var g=0;g<i.length;g++){var a=i[g];if(a.nodeType!=1)continue;var f=a.id,e=a.tagName,d=false,j=a.className,b="";if(f==this.Spread.id+"_cmdTable")b="all_no_margin all_no_padding";else if(e=="DIV"||e=="TABLE"){b="no_margin no_padding";if(f!="")for(var h=0;h<c.length;h++){var k=this.Spread.id+"_"+c[h];if(f==k){d=true;break}}if(!d&&e=="TABLE")b+=" no_td_padding"}if(b!="")if(j!="")a.className=b+" "+j;else a.className=b;!d&&typeof a.getAttribute!="unknown"&&a.getAttribute("FpSpread")!="Spread"&&this._ApplyDefaultCssStyles(a.childNodes,c)}},UseWorkArroundClipboard:function(){var b=this.GetTopSpreadView().Spread,a=b.getAttribute("clipboard")==null;return a&&!$$.browser.ie&&(window.clipboardData==null||typeof window.clipboardData.getData!="function"||typeof window.clipboardData.setData!="function")},_PrepairPasteData:function(h){var p=new RegExp("\x0d\x0a","g");h=h.replace(p,"\n");var b=new String(h),f=b.lastIndexOf("\n");if(b.length==0||f==0)return[[null]];if(f>0&&f==b.length-1){b=b.substring(0,f);b=new String(b)}var d=[],g=[],j='"',m='"',i="\t",k="\n",o=[i,k],e=0,a=0,c=b.length;while(a<c)if(a<c-1&&b.charAt(a)==j)while(a<c){a++;a=b.indexOf(j,a);if(a==-1){a=c-1;break}else if(a+1<c){a++;if(b.charAt(a)==m)continue;else break}}else{a=$$.utils.indexOfAny(b,o,a);var l=false;if(a==-1){d.push(this._CorrectCellValue(b.substr(e)));break}d.push(this._CorrectCellValue(b.substr(e,a-e)));l=b.charAt(a)==k;var n=b.charAt(a)==i;a++;if(l){g.push(d);d=[]}e=a;n&&c==a&&d.push(null)}g.push(d);return g},_CorrectCellValue:function(a){if(a==null||a.length==0)return null;if(a.charAt(0)!='"')return a;var d=true,c="",b=1,e=a.length;while(true){if(b>=e)break;if(a.charAt(b)=='"')if(d){d=false;if(b+1<e&&a.charAt(b+1)!='"'){c+=a.substr(b+1);break}}else{c+=a.charAt(b);d=true}else c+=a.charAt(b);b++}return c},_PrepairValueToCopy:function(a,d){if(a==null)a="";var b=new RegExp("\x0d\x0a","g");if(!d){var e=a.length;a=a.replace(b,"\n");if(a.length<e)a='"'+a+'"'}else{a=a.replace(b,"\n");b=new RegExp('"',"g");a=a.replace(b,'""');c=["\n",'"'];var c=["\n",'"'];if($$.utils.indexOfAny(a,c)>-1)a='"'+a+'"'}return a},_NeedUseBrowserBehavior:function(){var a=this.Spread.isEditing()?this.GetSpreadContext().getEditor(this.Spread.getAnchorCell()):null;return this.Spread.isEditing()&&(a==null||$$.utils.isTextControl(a)||$$.utils.isTextControl(document.activeElement)&&$$.utils.contains(a,document.activeElement))},NeedSetEditorFocusOnActiveCell:function(){return!$$.browser.webkit},UpdateThemeCss:function(){var d=this.GetTopSpreadView().Spread,j=d.id,k=j+"_tmpDivJQueryTheme",a=document.getElementById(k);if(!a){var a=document.createElement("DIV");a.id=k;a.className="ui-state-highlight";a.bkStyle=["","",""];a.style.display="none";d.appendChild(a)}for(var f=["background-image","background-color","color"],e="",b="",h=false,c=0;c<f.length;c++){b=$$(a).style(f[c]);e+=f[c]+":"+b+";";if(a.bkStyle[c]!=b){a.bkStyle[c]=b;h=true}}if(h){var g=j+"_tmpStyleJQueryTheme",b=document.getElementById(g);if(!b){b=document.createElement("Style");b.id=g;d.appendChild(b)}if($$.browser.ie&&$$.browser.version<9)$$.j("#"+g).prop("styleSheet").cssText=i("#"+d.id+" table td.ui-state-highlight",e);else b.textContent=i("#"+d.id+" table td.ui-state-highlight",e)}function i(b,a){return b+" {"+a+"}"}},RegisterManagedObject:function(a){if(a==null)return;this.ManagedObjects.push(a)},InitCellType:function(b){var a=FarPoint.Web.Spread.CellTypeFactory.GetCellType(this.Spread,b);a&&a.Initialize()},SyncBorderTop:function(b){$$.utils.cleanArray(b);if(b.length>0)for(var e=b.length-1;e>=0;e--)b[e].rules!="all"&&b[e].rules!="rows"&&b.splice(e,1);if(b.length<=1||this.CellSpacing>0)return;for(var d=[],f=0,a=0;a<b.length;a++){var i=b[a],g=this.GetMaxTopBorder(i.rows[0]),h=parseInt($$(i).style("border-top-width"));f=Math.max(f,g.maxBorderTop,h);d.push({cell:g.cellMaxBorder,cellBorder:g.maxBorderTop,tableBorder:h,max:Math.max(g.maxBorderTop,h)})}for(var a=0;a<b.length;a++){var i=b[a];if(f>d[a].max&&(f-d[a].max)%2==1){var c;if(d[a].cellBorder<=d[a].tableBorder)c=i;else if(d[a].cell)c=d[a].cell;if(c){c.style.borderTopWidth=parseInt($$(c).style("border-top-width"))+1+"px";if($$(c).style("border-top-style")=="none")c.style.borderTopStyle="solid"}}}},GetMaxTopBorder:function(b){var a=0,d;if(b!=null)for(var c=0;c<b.cells.length;c++){var f=b.cells[c],e=parseInt($$(f).style("border-top-width"));if(e>a){a=e;d=f}}return{maxBorderTop:a,cellMaxBorder:d}},InvalidateLayout:function(){var a=false,d=this.GetTopSpreadView(),b=d._GetTimeoutTask("StartEdit.LayoutSpread");if(b){a=true;b.Execute()}var c=d._GetTimeoutTask("EndEdit.LayoutSpread");if(c){a=true;c.Execute()}return a}};GrapeCity.Web.Spread.ConditionalFormatting=function(d,a,b,e,c){this.Spread=d;this.Holder=a;this.Bound=$$.utils.firstTaggedChild(a);this.Bar=$$.utils.firstTaggedChild(this.Bound);this.Type;this.__viewportId=b;this.Row=e;this.Column=c;this.__InitFields()};GrapeCity.Web.Spread.ConditionalFormatting.prototype={__InitFields:function(){this.Type=this.Holder.getAttribute("type");this.Holder.style.top="0px";this.Holder.style.left="0px";this.Holder.style.position="absolute";var a=this.Holder.parentNode.parentNode;if(this.Type=="i"){switch($$(a).style("vertical-align")){case"middle":this.Bound.style.top="50%";this.Bound.style.marginTop="-8px";break;case"bottom":this.Bound.style.top="100%";this.Bound.style.marginTop="-17px";break;default:this.Bound.style.marginTop="1px"}if($$(a).style("text-align")!="left")this.Bound.style.left="0px"}},Repaint:function(w){if(!this.IsShowing()||this.Spread.clientWidth==0)return;this.__ValidateFields();var m=this.Spread.getSpreadView(),z=m.GetSpreadContext(),b=z.getCell(this.Holder),x=null;if(b==null||(x=m._GetViewportFromCell(b))==null)return;var c=$$.browser,b=this.Holder.parentNode.parentNode,a=this.__findContentBound(b);if(c.mozilla&&b.offsetParent==null)return;if(a.__woverflow!=null){a.style.overflow=a.__woverflow;a.__woverflow=null}w&&this.__AdjustCDFBound();var B=$$.utils,y=c.ie&&c.version<8,j=b.clientHeight,e=b.clientWidth,A=parseInt(this.Holder.style.height)!=j;this.Holder.style.height=j+"px";e=b.clientWidth;var f=0,q=$$(b).getPaddingLeft(),n=$$(b).getAlignment();if(!this.Type){this.Holder.style.width=e+"px";var d=this.Bound.getAttribute("widthPercent");if(d==null){d=Number(this.Bound.style.width.replace("%",""));this.Bound.setAttribute("widthPercent",d)}var u=$$(this.Bound).getBorderWidth(),l=d*e/100;this.Bound.style.width=Math.max(Math.ceil(l)-u,l>.25?1:0)+"px";var s=$$(this.Bound).getPadding(true,false,true,false);this.Bar.style.height=j-s-$$(this.Bar).getBorderHeight()+"px";var g=this.Bar.getAttribute("widthPercent");if(g==null){g=Number(this.Bar.style.width.replace("%",""));this.Bar.setAttribute("widthPercent",g)}var r=$$(this.Bar).getBorderWidth(),p=!(c.ie&&c.ieversion<10&&c.quirksMode)?this.Bound.clientWidth:parseInt(this.Bound.style.width);this.Bar.style.width=Math.max(Math.ceil(g*p/100)-r,0)+"px";var t=(this.Bound.style.float||this.Bound.style.styleFloat||$$(this.Bound).style("float"))=="left"?d:100-d;if(e*t<52){if(this.Bound.__axisColor==null)this.Bound.__axisColor=this.Bound.style.borderColor;this.Bound.style.borderColor="transparent"}else if(this.Bound.__axisColor!=null)this.Bound.style.borderColor=this.Bound.__axisColor}else if(this.Type=="i"){if(!y){f=this.Holder.offsetWidth+1;a.style.marginLeft=f+"px"}else{f=this.Holder.offsetWidth+1;if(n=="left"||n=="justify")a.style.left=f+"px"}this.Bound.style.width=Math.min(16,e)+"px"}if(c.ie&&c.version<8){a.style.width="";var i,v=f+q;i=a.offsetWidth+v-e;if(i>0){a.style.width=Math.max(a.offsetWidth-i,0)+"px";if(a.style.display=="inline")a.style.display="";if(c.quirksMode&&a.style.overflow!="hidden"){a.__woverflow=a.style.overflow;a.style.overflow="hidden";this.__AdjustContentHolderHeight(a,b)}}}for(var o=this.Holder.parentNode,k=0;k<o.childNodes.length;k++){var h=o.childNodes[k];if(h.nodeType==1&&h.getAttribute("cdfh")==null){h.style.width=b.clientWidth+"px";h.style.height=b.clientHeight+"px"}}},Hide:function(){this.Holder.style.display="none"},Show:function(){this.Holder.style.display="block"},IsShowing:function(){return this.Holder.style.display!="none"},__ValidateFields:function(){var a=this.Holder.parentNode!=null;if(a)a=this.Spread.getSpreadView()._GetViewportFromCell(this.Holder.parentNode.parentNode)!=null;!a&&this.__ReInitFields()},__ReInitFields:function(){var e=document.getElementById(this.__viewportId);if(e!=null){var c=e.rows[this.Row].cells[this.Column];if(c==null)return;for(var d=c.getElementsByTagName("DIV"),b=0;b<d.length;b++){var a=d[b];if(a.getAttribute("cdfh")!=null&&a.id==this.Holder.id){this.Holder=a;this.Bound=$$.utils.firstTaggedChild(a);this.Bar=$$.utils.firstTaggedChild(this.Bound);break}}}},__findContentBound:function(a){if(a!=null)for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(b.nodeType==1&&b.getAttribute("cfContentBound")!=null)return b}return null},__AdjustContentHolderHeight:function(a,c){var b=a.offsetHeight-(c.clientHeight-$$(c).getPaddingTop());if(b>0)if(a.offsetHeight<=b){a.__visibility=a.style.visibility;a.style.visibility="hidden"}else{a.style.height=a.offsetHeight-b+"px";a.__overflow=a.style.overflow;a.style.overflow="hidden"}},__AdjustCDFBound:function(){var a=this.Holder.parentNode.parentNode,b=this.__findContentBound(a),d=this.Holder.parentNode,c=0,m=$$(a),i=m.getPaddingTop(),k=m.getPaddingBottom(),h=m.getPaddingLeft(),p=m.getPaddingRight(),j=$$(a).border("left");if(isNaN(j))j=0;var g=a.style.verticalAlign;if(g==null||g=="")g=$$(a).style("vertical-align");if(g==null||g=="")g=a.getAttribute("valign");var e=$$.browser,n=e.ie&&e.version<8,v=e.ie&&e.version==8,o=e.ie&&e.ieversion<10&&e.quirksMode;if(b.style.display=="none"){var u=$$(a).getChildTag("DIV","mock");b=u||b;if(u!=null&&!this.__checkedDecoration){var s=$$(a).style("text-decoration");if(s!=""&&s!="none"){a.style.textDecoration="none";this.__checkedDecoration=true}}}var r=this.Spread.getSpreadView();if(e.chrome&&r.IsLayoutInitialized()){var t=r._GetViewportFromCell(a);if(t){var l=t.getElementsByTagName("COLGROUP")[0];if(l){var q=parseInt(l.childNodes[a.cellIndex].width);if(!isNaN(q)){l.childNodes[a.cellIndex].width=q-1+"px";l.childNodes[a.cellIndex].width=q+"px"}}b.style.position="static"}}d.style.left="";b.style.left="";d.style.top=d.style.marginTop="";if(n)b.style.top=b.style.marginTop="1px";b.style.top=b.style.marginTop="";if(b.__overflow!=null){b.style.overflow=b.__overflow;b.__overflow=null;b.style.height=""}if(b.__visibility!=null){b.style.visibility=b.__visibility;b.__visibility=null}if(o&&b.offsetHeight>a.clientHeight-i-k)c=i;else switch(g){case"middle":c=Math.floor((a.clientHeight-b.offsetHeight)/2);c+=Math.floor((i-k)/2);break;case"bottom":c=a.clientHeight-b.offsetHeight;if(k>1)c-=k;break;default:if(i>1)c=i}o&&this.__AdjustContentHolderHeight(b,a);if(c>0)if(!n){d.style.marginTop=-c+"px";b.style.marginTop=c+"px"}else d.style.top=-c+"px";else if(!n){d.style.marginTop="";b.style.marginTop=c+"px"}else d.style.top=!o?"":c+"px";c=0;if(e.ie){if(n){var f=a.style.textAlign;if(f==null||f=="")f=$$(a).style("text-align");if(f==null||f=="")f=a.getAttribute("align");switch(f){case"center":c=Math.floor((a.clientWidth+h-p)/2);break;case"right":if(a.clientWidth>h+p){c=a.clientWidth;c-=p}else c=h;break;default:c=h;if(this.Type=="i"&&f=="justify")b.style.left=16+h+"px"}}else if(!v||h>1)c=d.offsetLeft-a.offsetLeft-j}else if(d.offsetParent==a.offsetParent.parentNode)c=d.offsetLeft-a.offsetLeft-j;else c=h;if(c>0)d.style.left=-c+"px";if(e.chrome)b.style.position=""}};GCWS.SelectionBlockOptions={None:0,Cells:1,Rows:2,Columns:4,Sheet:8};GCWS.SelectionPolicy={Single:0,Range:1,MultiRange:2};GCWS.ScrollPosition={TopLeft:0,BottomLeft:1,TopRight:2,BottomRight:3};GCWS.Keys={LEFT:37,RIGHT:39,UP:38,DOWN:40,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,TAB:9,ENTER:13,SPACE:32,ESCAPE:27,SHIFT:16,BACKSPACE:8,ALT:18};GCWS.Actions={OBSERVER:"observer",SWITCH_KEYBOARD:"switch_keyboard",ACTIVE_CELL_CHANGING:"FireActiveCellChanging",ACTIVE_CELL_CHANGED:"FireActiveCellChanged"};GCWS.ZIndex={POPUP:9999999};GCWS.SpreadView.prototype._InitDataModel=function(){if(this._isDataModelLoaded)return;this._isDataModelLoaded=true;this.Rows=new GCWS.RowCollection(this);for(var a=0,c=0;c<this.Rows.length;c++){var f=this.Rows[c];if(f.LayoutRows!=null)a+=f.LayoutRows.length;else a++}this.RowCount=a;this.Columns=new GCWS.ColumnCollection(this);this.ColumnCount=this.Columns.length;for(var e=0,h=this.Viewport0||this.Viewport1,b=0;b<this.FrozenTableRowCount;b++){var g=h.rows[b];if(g.getAttribute("FpKey")!=null)e++}this.FrozenRowCount=e;this.SpanModel.BuildQuadTree();this.FlattenRows=d(this);function d(g,h){for(var d=h!=null,a=!d?[]:g.FlattenRows,i=g.Rows,f=!d?0:h,k=i.length;f<k;f++){var e=i[f],c=e.LayoutRows;if(c)for(var b=0,j=c.length;b<j;b++){c[b].FlattenIndex=a.length;c[b].LayoutIndex=b;a.push(c[b])}else{e.FlattenIndex=a.length;a.push(e)}}if(!d)a.binarySearch=$$.utils.binarySearch2;return a}this.Rows.AddOnChanged(Function.CreateDelegate(this,function(a){if(a.Type==GCWS.Collection.ChangeType.Add){if(!this.IsRowLayoutMode)this.RowCount++;else this.RowCount+=this.LayoutRowCount;d(this,this.Rows.length-1)}}))};GCWS.SpreadView.prototype._GetRowViewIndex=function(d,i){if($$.browser.mb)while(true){var f=this.Spread.GetSpread(d);if(f&&$$.utils.contains(this.Spread,f,false))d=f.parentNode;else break}var a=FpSpreadJS.getTableRow(d);if(a.getAttribute("fpspread")==null){var h=$$.utils.GetCell(d);if(h==null)return-1;a=FpSpreadJS.getTableRow(h)}if(a==null)return-1;if(!i&&this.FrozenTableRowCount>0){var j=this.Spread,c=this.GetSpreadContext(),e=c.isSmartPaint(),b,g=j.getRowHeader();if(this.Viewport2!=null&&($$.utils.contains(this.Viewport2,a)||e&&(b=c.getUIViewport2List())!=null&&this.IsChild(b.table,a))||this.Viewport!=null&&($$.utils.contains(this.Viewport,a)||e&&(b=c.getUIViewportList())!=null&&this.IsChild(b.table,a))||g!=null&&($$.utils.contains(g,a)||e&&(b=c.getUIRowHeaderList())!=null&&this.IsChild(b.table,a)))return a.rowIndex+this.FrozenTableRowCount}return a.rowIndex};GCWS.SpreadView.prototype._GetRowIndexByViewIndex=function(a){return a==null||a==-1?a:this.FlattenRows.binarySearch(a,function(b,a){return b.ViewIndex===a?0:b.ViewIndex>a?1:-1})};GCWS.SpreadView.prototype._GetRowByViewIndex=function(c,b){var a=this._GetRowIndexByViewIndex(c);return a!=-1?this._GetRow(a,b):null};GCWS.SpreadView.prototype._GetRow=function(b,c,d){if(arguments.length<2)c=false;if(d)b=Math.min(this.FlattenRows.length-1,b);var a=this.FlattenRows[b];return c&&this.IsRowLayoutMode&&a.LayoutIndex!=null?a.Owner[0]:a};GCWS.SpreadView.prototype._GetRowIndex=function(a,d,g,w){var m=a.target!=null,e=-1,u=a.target!=null&&a.type!=null&&a.type!="",k;if(m&&w&&(d||g||!this.IsInViewport(a.target)||(k=$$.utils.GetCell(a.target))!=null&&k.rowSpan>1)||a.y!=null||u){var c=a.target;if(c==null){if(a.x!=null)c=document.elementFromPoint(a.x,a.y);if(!this.IsInViewport(c)){var b=this._GetRowIndexFromPoint(a.y);if(b>=0)return b;else{b=-(b+2);return b>=0&&a.target!=null&&Math.floor(a.target.getBoundingClientRect().bottom)>Math.floor(this._GetRow(b).HtmlRow.getBoundingClientRect().bottom)?b:-1}}}var h,o=a.offsetY;if(m&&!d&&!g){if(this.FrozenRowCount>0){var p=this.Viewport0||this.Viewport1,q=p.getBoundingClientRect();if(a.clientY<q.bottom){c=this._FindCellFromPoint(Math.max(q.left,0)+1,a.clientY);if(c==null||$$.utils.contains(p,c)){if(c==null||c.rowSpan>1){var b=this._GetRowIndexFromPoint(a.clientY);if(b>=0)return b;else{b=-(b+2);return b>=0&&a.target!=null&&Math.floor(a.target.getBoundingClientRect().bottom)>Math.floor(this._GetRow(b).HtmlRow.getBoundingClientRect().bottom)?b:-1}}o=1;h=p}}}if(h==null){var n=this.Viewport2||this.Viewport;if(this.ColumnCount==0&&this.Spread.getRowHeader()!=null){n=this.Spread.getRowHeader();g=true}var i=n.parentNode.getBoundingClientRect();if(a.clientY>=i.top&&a.clientY<=i.bottom){c=this._FindCellFromPoint(Math.max(i.left,0)+1,a.clientY);if(c==null||c.rowSpan>1){var b=this._GetRowIndexFromPoint(a.clientY);if(b>=0)return b;else{b=-(b+2);return b>=0&&a.target!=null&&Math.floor(a.target.getBoundingClientRect().bottom)>Math.floor(this._GetRow(b).HtmlRow.getBoundingClientRect().bottom)?b:-1}}o=1;h=n}else return a.clientY>=i.bottom?this._GetRowBottom():this._GetRowTop()}}if(c==null)return-1;e=this._GetRowViewIndex(c,d);if(e==-1)return-1;var f,l=false;if(d)f=this.ColumnHeaders[1]||this.ColumnHeaders[0];else if(e>=this.FrozenTableRowCount&&this.FrozenTableRowCount>0){f=g?this.RowHeaders[1]:h;l=true}else f=g?this.RowHeaders[0]:h;var b=!d?e-(l?this.FrozenTableRowCount:0):e;if(b>=0&&b<f.rows.length){if((k=$$.utils.GetCell(a.target))==null||k.rowSpan>1){var j;if(a.clientY!=null)j=a.clientY;else{var x=$$.utils.contains($$.utils.GetCell(a.target),a.target.offsetParent)||$$.utils.GetCell(a.target)==a.target.offsetParent?Math.floor(a.target.offsetParent.getBoundingClientRect().top):Math.floor(a.target.getBoundingClientRect().top);j=x+o}var r=f.rows[b].getBoundingClientRect(),s=Math.floor(j)-Math.floor(r.top);if(!$$.browser.mb||j>r.bottom){var t,v=f.rows.length-1;while(b<v&&s>=(t=f.rows[b].offsetHeight)){s-=t+this.CellSpacing;b++}}}e=b+(!d&&l?this.FrozenTableRowCount:0)}else return-1}else{var c=m?a.target:a;if(!d)c=$$.utils.GetCell(c);e=c?this._GetRowViewIndex(c,d):null}return!d?this._GetRowIndexByViewIndex(e):e};GCWS.SpreadView.prototype._GetRowIndexFromPoint=function(d,e){var f=this._GetRowTop();if(f==-1)return-1;if(e==null)e=true;var i=(this.GetSpreadContext().getViewportHolder()||this.Viewport.parentNode).getBoundingClientRect(),b=i.top,m=b,c;if(d<b)return e?f:-1;else if(d>i.bottom)return e?this._GetRowBottom():-1;else{var a=f;b=this._GetRow(f).HtmlRow.getBoundingClientRect().top;while(a<this.RowCount){if(a==0||a!=this.FrozenRowCount)c=this._GetRow(a);else{a=Math.max(a,this._GetRowTop(true));if(a>=this.RowCount)break;c=this._GetRow(a);b=c.HtmlRow.getBoundingClientRect().top}b+=c.HtmlRow.offsetHeight+this.CellSpacing;if(b>=d)return b-d>=this.CellSpacing?a:-2-a;for(var k=$$(c.HtmlRow).getParent("TABLE"),h=a+1<this.RowCount?this._GetRow(a+1):null,j=h!=null?h.ViewIndex:this.ViewRowCount,g=c.HtmlRow.rowIndex+1,l=c.HtmlRow.rowIndex+j-c.ViewIndex;g<l;g++){b+=k.rows[g].offsetHeight+this.CellSpacing;if(b>=d)return b-d>=this.CellSpacing?a:-2-a}a++}if(e)return this._GetRowBottom()}return-1};GCWS.SpreadView.prototype._GetRowIndexFromNonSelectableRow=function(a){if(isNaN(a)){var b=a.previousSibling;if(b==null)return-1;do{var d=this._GetRowIndexByViewIndex(this._GetRowViewIndex(b)),a=this._GetRow(d);if(a!=null){if(this.IsRowLayoutMode)a=a.Owner[0];return a.FlattenIndex}b=b.previousSibling}while(b!=null)}else{while(a>0){a--;var c=this._GetRow(this._GetRowIndexByViewIndex(a));if(c!=null)return this.IsRowLayoutMode?c.Owner[0].FlattenIndex:c.FlattenIndex}return-1}};GCWS.SpreadView.prototype._TranslateToSpread=function(e,c,d){var b=e.getBoundingClientRect(),a=this.Spread.getBoundingClientRect();c+=b.left-a.left;d+=b.top-a.top;return{x:c,y:d}};GCWS.SpreadView.prototype._TranslateToViewport=function(o,e,f,l,m){if(arguments.length>2){var g=o.getBoundingClientRect(),d=this.Spread.getBoundingClientRect(),a=this.GetSpreadContext(),c,b;if(!l){e+=g.left-d.left;b=a.getFrozColHeader()||a.getViewport2()||a.getViewport0()||a.getColHeader()||a.getViewport()||a.getViewport1();if(b!=null)e-=b.getBoundingClientRect().left-d.left;else{c=a.getRowHeader()||a.getFrozRowHeader()||a.getCorner();var n=c!=null?c.offsetWidth:0;e-=n}}if(!m){f+=g.top-d.top;c=a.getFrozRowHeader()||a.getViewport1()||a.getViewport0()||a.getRowHeader()||a.getViewport()||a.getViewport2();if(c!=null)f-=c.getBoundingClientRect().top-d.top;else{b=a.getColHeader()||a.getFrozColHeader()||a.getCorner();var i=b!=null?b.offsetHeight:0;f-=i}}return{x:e,y:f}}else{var j=arguments[0],k=arguments[1],a=this.GetSpreadContext(),p=a.getViewportHolder()||this.Viewport.parentNode,h=p.getBoundingClientRect();return{x:Math.floor(j)-Math.floor(h.left),y:Math.floor(k)-Math.floor(h.top)}}};GCWS.SpreadView.prototype._GetColumnIndex=function(b,p,m){if(!b)return-1;var k=this.GetSpreadContext(),l=b.target!=null;if(!p&&(l||b.x!=null&&b.y!=null)){if(b.target.tagName=="TABLE")return-1;var e;if(l){var o={x:b.clientX,y:b.clientY};e=this._TranslateToViewport(o.x,o.y).x;if(e<0)return m?this._GetColumnLeft():-1}else e=b.x;var n=0,i=null;if(this.FrozenColumnCount>0){var i=this.Spread.getFrozColHeader()||this.Viewport0||this.Viewport2;if(i.rows.length>0&&i.rows[0].cells.length>0){var h=i.rows[0].cells[0];n=Math.floor(h.getBoundingClientRect().left)-Math.floor(h.offsetParent.getBoundingClientRect().left)}}for(var c=n,a=-1,j=0;j<this.FrozenColumnCount;j++){c+=this.Columns[j].Width+this.CellSpacing;if(e<c){a=j;break}}if(a==-1){a=this.FrozenColumnCount-1;if(this.FrozenColumnCount>0)c=i.parentNode.offsetWidth;var d=k.getColHeader();if(d==null){d=k.getViewport1();if(d==null)d=k.getViewport()}var g=d.parentNode.scrollLeft;if(d.rows.length>0&&d.rows[0].cells.length>0){var h=d.rows[0].cells[0];g-=Math.floor(h.getBoundingClientRect().left)-Math.floor(h.offsetParent.getBoundingClientRect().left)}while(g>0&&a<this.ColumnCount-1){a++;g-=this.Columns[a].Width+this.CellSpacing}c-=g;while(e>=c&&a<this.ColumnCount-1){a++;c+=this.Columns[a].Width+this.CellSpacing}if(e>=c)a=m?this._GetColumnRight():-1}return a}else if(l){var e=b.offsetX+Math.floor(b.target.getBoundingClientRect().left)-Math.floor((this.RowHeaders[1]||this.RowHeaders[0]).getBoundingClientRect().left),f=0,c;while(this.RowHeader.ColumnCount>f&&e>=(c=this.RowHeader.GetColumnWidth(f)+this.CellSpacing)){e-=c;f++}return Math.min(f,this.RowHeader.ColumnCount-1)}else return this.Spread.getSpreadContext().getColFromCell(b)};GCWS.SpreadView.prototype.GetCanFocus=function(b,a){return this.GetCell(b,a,true).CanFocus};GCWS.SpreadView.prototype._GetVerticalScrollableHtmlTable=function(){var c=this.Spread,b=this.GetCell(this.ActiveRow,this.ActiveColumn,true).HtmlCell,a;if($$.utils.contains(this.Viewport,b))a=this.Viewport;else if($$.utils.contains(this.Viewport2,b))a=this.Viewport2;if(!a)a=this.Viewport||this.Viewport2||c.getRowHeader();return a};GCWS.SpreadView.prototype._GetRangeHeight=function(a,j,i,h){if(a<this.FrozenRowCount)return 0;var g=this.Viewport;if(this.Viewport2!=null&&this.Viewport!=null&&this.Viewport2.rows.length>this.Viewport.rows.length)g=this.Viewport2;var c=this.FrozenTableRowCount,f=this._GetRow(a).ViewIndex-c,d=this._GetRow(Math.min(a+j-1,this.RowCount-1)).ViewIndex-c;if(i)d--;if(h)f++;for(var e=0,b=f;b<=d;b++)e+=g.rows[b].offsetHeight;return e};GCWS.SpreadView.prototype._GetPreviousFocusableCell=function(d,c,a,b){return this._GetNextFocusableCell(d,c,a,b,-1,false)};GCWS.SpreadView.prototype._GetNextFocusableCell=function(f,e,t,l,o,d,v){var j=this.RowCount,h=this.ColumnCount;if(f<0||e<0||f>=j||e>=h)return new GCWS._CellLocation(-1,-1);var q=arguments.length;if(q<4)l=1;if(q<5)o=-1;if(q<6)d=true;var i,g;if(d)if(t){i=j;g=Math.min(e+l,h)}else{i=Math.min(f+l,j);g=h}else if(t){i=-1;g=Math.max(e-l,-1)}else{i=Math.max(f-l,-1);g=-1}var a=f,b=e;if(f>=j)f=0;if(e>=h)e=0;var n=this.ActiveRow,m=this.ActiveColumn,s=this.SpanModel,w=n>=0&&m>=0?this.GetCell(n,m):null,u=this.IsRowLayoutMode&&o>=0,k,r;do{if(u||v){k=this._GetRow(a);if(k!=null&&k.IsGroup){a++;continue}r=k.LayoutIndex||k.LayoutIndex==0;if(r)a=k.Owner[o].FlattenIndex}var p=this.GetCell(a,b);if(p==null){var c;if(w!=null)c=s.Find(a,b);else{var x=s.Find(n,m);c=s.Find(a,b);if(x==c)c=null}if(c&&!c.Contains(n,m))p=this.GetCell(c.Row,c.Column)}if(p!=null&&p.CanFocus)return new GCWS._CellLocation(a,b);if(t){if(u)if(r)a+=this.LayoutRowCount-o;else a++;else if(d)a++;else a--;if(d){if(a>=j){a=0;b++}}else if(a<0){a=j-1;b--}}else if(d){b++;if(b>=h){b=0;a++}}else{b--;if(b<0){b=h-1;a--}}}while(d&&a<i&&b<g||!d&&a>i&&b>g);return new GCWS._CellLocation(-1,-1)};GCWS.SpreadView.prototype.GetCell=function(f,e,d){var a=this._GetRow(f,false,d);if(!a||!a.Cells)return null;var b=a.Cells[e];if(d&&b==null){var c=this.SpanModel.Find(f,e);b=c!=null?this._GetRow(c.Row).Cells[c.Column]:null}return b};GCWS.SpreadView.prototype._GetHtmlCell=function(b,a,d){if(b==null||a==null||b<0||a<0||this.RowCount==0||this.ColumnCount==0)return null;else{var c=this.GetCell(b,a,d);return c==null?null:c.HtmlCell}};GCWS.SpreadView.prototype._GetViewport=function(c,b){var a=this.FrozenTableColumnCount;return c>=this.FrozenTableRowCount?b>=a?this.Viewport:this.Viewport2:b>=a?this.Viewport1:this.Viewport0};GCWS.SpreadView.prototype.GetValue=function(d,c,b){var a=this.GetCell(d,c,b);return a!=null?a.Value:null};GCWS.SpreadView.prototype.SetValue=function(d,c,b){var a=this.GetCell(d,c);if(a!=null){a.Value=b;return true}else return false};GCWS.SpreadView.prototype._PaintActiveCell=function(s){if(!this.Options.ReplacePaintSelection)return;if(this._IsOnlySelectRow)return;var o=this.OperationMode==$$.OperationModes.ROW_MODE,i=this._oldActiveRow,f=this._oldActiveColumn,j=this._oldActiveLayoutRow,d=this.ActiveRow,c=this.ActiveColumn,n=this.ActiveLayoutRow;if(!s&&i==d&&f==c)return;var t=this._GetHtmlCell(i,f,true),m=this._GetHtmlCell(d,c,true),r=this.SpanModel,a=!o?r.Find(i,f):null,b=!o?r.Find(d,c):null,p=this.Spread,k=this.IsRowLayoutMode,l=this.ColumnHeader,q=this.RowHeader,u=this.Options.ReplacePaintSelection;this.Options.ReplacePaintSelection=false;var e=[null,null,null];if(t){p.paintSelectedCell(t,false,true);e[2]=new GCWS.CellRange(this._oldActiveRow,this._oldActiveColumn,1,1)}if(f>=0&&(f!=c||k&&j!=n||a!=null))if(k)if(a==null){this._PaintActiveHeader(j,f,1,1,false,true);e[0]=new GCWS.CellRange(-1,this._oldActiveColumn,-1,1,j)}else{this._PaintActiveHeader(j,a.Column,1,a.ColumnCount,false,true);e[0]=new GCWS.CellRange(-1,a.Column,-1,a.ColumnCount,j)}else if(a==null){this._PaintActiveHeader(0,f,l.RowCount,1,false,true);e[0]=new GCWS.CellRange(-1,this._oldActiveColumn,-1,1)}else{this._PaintActiveHeader(0,a.Column,l.RowCount,a.ColumnCount,false,true);e[0]=new GCWS.CellRange(-1,a.Column,-1,a.ColumnCount)}if(i>=0&&(i!=d||a!=null)){var h=i,g=1;if(a!=null){h=a.Row;g=a.RowCount}this._PaintActiveHeader(h,0,g,q.ColumnCount,false,false);e[1]=new GCWS.CellRange(h,-1,g,-1)}(o||this.SelectionModel.SelectionPolicy==GCWS.SelectionPolicy.MultiRange)&&this._RepaintSelectionCoveredByOldAnchor(e);if(s){this._oldActiveHtmlCell=null;this.Options.ReplacePaintSelection=u;return}this._oldActiveRow=d;this._oldActiveColumn=c;if(k)this._oldActiveLayoutRow=n;if(m!=null){m.paintSelected&&p.paintSelectedCell(m,false,false);!this.IsShowFocusRectangle()&&p.paintSelectedCell(m,true,true)}if(c>=0)if(k)if(b==null)this._PaintActiveHeader(n,c,1,1,true,true);else this._PaintActiveHeader(n,b.Column,1,b.ColumnCount,true,true);else if(b==null)this._PaintActiveHeader(0,c,l.RowCount,1,true,true);else this._PaintActiveHeader(0,b.Column,l.RowCount,b.ColumnCount,true,true);if(d>=0){var h,g;if(b!=null){h=b.Row;g=b.RowCount}else{var v=this._GetRow(d);h=d;g=v.LayoutRows?this.LayoutRowCount:1}this._PaintActiveHeader(h,0,g,q.ColumnCount,true,false)}this.Options.ReplacePaintSelection=u};GCWS.SpreadView.prototype._RepaintSelectionCoveredByOldAnchor=function(g){var n=this.Spread,h=this.SelectionModel,i=this.IsRowLayoutMode,m=this.OperationMode,l=$$.OperationModes;if(!this._IsFullRowSelectable){var d=g[0];if(d!=null){var a=h.IntersectWith(d.Row,d.Column,d.RowCount,d.ColumnCount,d.LayoutRow);if(a!=null)for(var j=i?1:this.ColumnHeader.RowCount,c=0;c<a.length;c++){var b=a[c],k=i?b.LayoutRow:0;this._PaintActiveHeader(k,b.Column,j,b.ColumnCount,true,true)}}}var e=g[1];if(e!=null){var a=h.IntersectWith(e.Row,e.Column,e.RowCount,e.ColumnCount);if(a!=null)for(var c=0;c<a.length;c++){var b=a[c];this._PaintActiveHeader(b.Row,0,b.RowCount,this.RowHeader.ColumnCount,true,false)}}var f=g[2];if(f!=null){var a=h.IntersectWith(f.Row,f.Column,f.RowCount,f.ColumnCount);if(a!=null)for(var c=0;c<a.length;c++){var b=a[c];this.PaintSelection(b.Row,b.Column,b.RowCount,b.ColumnCount)}}};GCWS.SpreadView.prototype._PaintActiveHeader=function(i,h,k,j,f,g){for(var m=this.Spread,l=g?this.ColumnHeader:this.RowHeader,b=i,o=i+k;b<o;b++)for(var d=h,n=h+j;d<n;d++){var a=l._GetHtmlCell(b,d);if(a!=null){var c=false;if(g)c=this._GetColumnIndex(a)!=d;else{var e=this._GetRowIndex(a);if(this.IsRowLayoutMode)c=!(e<=b&&e+a.rowSpan>b);else c=e!=b}!c&&(f&&!a.paintSelected||!f&&a.paintSelected)&&m.paintSelectedCell(a,f,false)}}};GCWS.SpreadView.prototype._LoadSelection=function(d){var f=this.SelectionModel,b=$$.browser;if(b.ie&&b.version>=9){var c=this.Spread.getXmlDataObject(),a=c.firstChild(d);while(a!=null){var e=this._ConvertOldSelectionRange(a);f.AddSelection(e);a=c.nextSibling(a)}}};GCWS.SpreadView.prototype._SaveSelection=function(){};GCWS.SpreadView.prototype._GetColumnIndexFromKey=function(e){if(e<0)return-1;if(this.IsRowLayoutMode)for(var d=0;d<this.LayoutRowCount;d++)for(var g=this._GetRow(d),b=0;b<g.Cells.length;b++){var i=g.Cells[b];if(i!=null&&i.DataIndex==e)return b}else{var c=[],a=this.Viewport0;if(a==null)a=this.Viewport2;a!=null&&c.push(a);a=this.Viewport1;if(a==null)a=this.Viewport;a!=null&&c.push(a);for(var h=0,f=0;f<c.length;f++){a=c[f];for(var j=a.getElementsByTagName("COLGROUP")[0],b=0;b<j.childNodes.length;b++){var k=j.childNodes[b],l=parseInt(k.getAttribute("FpCol"));if(l==e)return h;h++}}}return-1};GCWS.SpreadView.prototype._GetCellLocation=function(i,e){var g=this._GetColumnIndexFromKey(e);if(i==-1)return new GCWS._CellLocation(-1,g);for(var c=0;c<this.Rows.length;c++){var a=this.Rows[c];if(a.DataIndex==i){if(!this.IsRowLayoutMode)return new GCWS._CellLocation(c,g);if(e==-1)return new GCWS._CellLocation(a.LayoutRows[0].FlattenIndex,-1);for(var f=0;f<a.LayoutRows.length;f++)for(var d=a.LayoutRows[f],b=0;b<d.Cells.length;b++){var h=d.Cells[b];if(h!=null&&h.DataIndex==e)return new GCWS._CellLocation(d.FlattenIndex,b)}}}return null};GCWS.SpreadView.prototype._ConvertOldSelectionRange=function(a){var f=a.getAttribute("row")!="newrow"?parseInt(a.getAttribute("row")):-2,e=parseInt(a.getAttribute("col")),b=this._GetCellLocation(f,e);if(b==null)return;var d=f!=-2?parseInt(a.getAttribute("rowcount")):1;if(this.IsRowLayoutMode&&e==-1)d=d*this.LayoutRowCount;var h=parseInt(a.getAttribute("colcount")),g=-1;this.IsRowLayoutMode;var c=new GCWS.CellRange(b.Row,b.Column,d,h,g);if(!this.IsRowLayoutMode&&f!=-1&&e!=-1)c=this._FindExpandedSelection(c);return c};GCWS.SpreadView.prototype.HideSelections=function(){for(var b=0;b<this.SelectionModel.length;b++){var a=this.SelectionModel[b];this._DoPaintSelection(a.Row,a.Column,a.RowCount,a.ColumnCount,a.LayoutRow,false,this._IsFullRowSelectable,false,false)}};GCWS.SpreadView.prototype.PaintSelections=function(){for(var b=this.Spread.getSpreadContext(),a=0;a<this.SelectionModel.length;a++)this.PaintSelection(this.SelectionModel[a])};GCWS.SpreadView.prototype.PaintSelection=function(b,f,e,d,c){if(arguments.length==1){var a=b;b=a.Row;f=a.Column;e=a.RowCount;d=a.ColumnCount;c=a.LayoutRow}this._DoPaintSelection(b,f,e,d,c,false,this._IsFullRowSelectable,false,true)};GCWS.SpreadView.prototype.HideSelection=function(k,j,i,h,g,l,e,f){if(arguments.length==4){var a=arguments[0],b=arguments[1],d=arguments[2],c=arguments[3];this._DoPaintSelection(a.Row,a.Column,a.RowCount,a.ColumnCount,a.LayoutRow,b,d,c,false)}else this._DoPaintSelection(k,j,i,h,g,false,e,f,false)};GCWS.SpreadView.prototype._DoPaintSelection=function(d,b,t,s,m,y,p,q,a){var w=this.Options.ReplacePaintSelection;this.Options.ReplacePaintSelection=false;var l=this.Spread.getSpreadContext(),c=d,f=b,j=t,i=s;if(d<0){c=0;j=this.RowCount}if(b<0){f=0;i=this.ColumnCount}var o=1,n=c;if(a&&this.IsRowLayoutMode&&d==-1&&b>=0){o=this.LayoutRowCount;n=m}for(var g=n,v=c+j;g<v;g+=o)for(var h=f,u=f+i;h<u;h++){var e=this._GetHtmlCell(g,h);if(e!=null&&(g!=this.ActiveRow||h!=this.ActiveColumn))(a&&!e.paintSelected||!a&&e.paintSelected)&&l.paintSelectedCell(e,a)}if(!p&&this.ColumnHeader!=null){var k=0;if(a&&this.IsRowLayoutMode&&b!=-1)if(d!=-1){var r=this._GetRow(c);k=r.LayoutIndex}else k=m;var x=this.IsRowLayoutMode&&b!=-1&&a?1:this.ColumnHeader.RowCount;this._PaintActiveHeader(k,f,x,i,a,true)}!q&&this.RowHeader!=null&&this._PaintActiveHeader(c,0,j,this.RowHeader.ColumnCount,a,false);d<0&&b<0&&l.paintCornerSelection(a);this.Options.ReplacePaintSelection=w};GCWS.SpreadView.prototype.SelectRow=function(a){this.HideSelection();this.SelectionModel.SetSelection(a,-1,1,-1);this.PaintSelection()};GCWS.SpreadView.prototype.IsChildSpreadView=function(){return this.Parent!=null};GCWS.SpreadView.prototype._GetTopDisplayedRowIndex=function(b){if(b==null){var c=this.Viewport.parentNode;b=c.scrollTop-this.VirtualTop}for(var a=this.FrozenRowCount;a<this.RowCount;a++){var e=this._GetRow(a),d=e.Cells[0];if(d.HtmlCell.offsetTop>=b)return a}return Math.max(0,this.RowCount-1)};GCWS.SpreadView.prototype._GetLastDisplayedRowIndex=function(d){var e=this.FrozenRowCount,c=this.FlattenRows;if(c.length<=e)return-1;var h=this.Viewport,i=h.parentNode,g=i.clientHeight,j=null,a=d!=null&&d>=e?d:this.TopRow;if(a==-1)a=this._GetTopDisplayedRowIndex();for(var f=0,b=a;b<c.length;b++){f+=this._GetRangeHeight(b,2,true);if(f>g)return Math.max(a,b-1)}return c.length-1};GCWS.SpreadView.prototype._GetScrollableView=function(){var b=this.Spread.getSpreadContext(),a=b.getScrollvp?b.getScrollvp():null;if(a==null)a=this.Viewport.parentNode;return a};GCWS.SpreadView.prototype.ScrollTo=function(p,o,r){var b=Math.max(p,0),e=Math.max(o,0),h=this.FrozenColumnCount,a=this.FrozenRowCount;if(b<a&&e<h)return;var l=this._GetRow(b),d=l.Cells[e];if(d==null){var j=this.SpanModel.Find(b,e);if(j!=null){l=this._GetRow(j.Row);d=l.Cells[j.Column]}}if(d!=null){var f=r||GCWS.ScrollPosition.TopLeft,s=f==GCWS.ScrollPosition.TopLeft||f==GCWS.ScrollPosition.BottomLeft,t=f==GCWS.ScrollPosition.TopLeft||f==GCWS.ScrollPosition.TopRight,i=d.HtmlCell,c=this._GetScrollableView(),q=b==a?0:i.offsetTop,n=e==h?0:i.offsetLeft;if(p>=a)if(t)c.scrollTop=this.VirtualTop+q;else{for(var m=Math.max(0,q+this._GetRangeHeight(b,2,true)-this.Viewport.parentNode.clientHeight),k=0,g=a;g<this.RowCount;g++){k+=this._GetRangeHeight(g,2,true);if(k>=m){m=g>a?k:0;break}}c.scrollTop=this.VirtualTop+m}if(o>=h)if(s)c.scrollLeft=n;else{var u=Math.max(0,n+i.offsetWidth-this.Viewport.parentNode.clientWidth);c.scrollLeft=u}}};GCWS.SpreadView.prototype.SaveXmlData=function(){};GCWS.SpreadView.prototype._FindExpandedSelection=function(f,e,h,g){var b=arguments[0];if(arguments.length==1){f=b.Row;e=b.Column;h=b.RowCount;g=b.ColumnCount}var j=this.SpanModel,a=arguments.length>1?new GCWS.CellRange(f,e,h,g):b;if((f!=-1||e!=-1)&&j.length>0){var c=this._GetExpandableRanges(f,e,h,g);while(c.length>0){for(var i=0;i<c.length;i++){var d=c[i];a=a.UnionWith(d.Row,d.Column,d.RowCount,d.ColumnCount)}c=this._GetExpandableRanges(a.Row,a.Column,a.RowCount,a.ColumnCount)}}return a};GCWS.SpreadView.prototype._GetExpandableRanges=function(h,g,e,d){for(var c=this.SpanModel,f=[],i=new GCWS.CellRange(h,g,e,d),b=0;b<c.length;b++){var a=c[b];a.IsIntersectWith(h,g,e,d)&&!i.IsCoverable(a.Row,a.Column,a.RowCount,a.ColumnCount)&&f.push(c[b])}return f};GCWS.SpreadView.prototype._MoveSelectionLead=function(i,t,k,m){var a=this.SelectionModel,u=GCWS.SelectionPolicy,o=$$.OperationModes,q=this.OperationMode,n=this._IsFullRowSelectable,p=q==o.SINGLE_SELECT,g=i,f=n?-1:t;if(!k&&i!=-1)var c=this._GetRow(i),k=this.IsRowLayoutMode?c.LayoutIndex:-1;if(p){this.HideSelections();var j=i,l=1;if(this.IsRowLayoutMode){var c=this._GetRow(i);j=c.Owner[0].FlattenIndex;l=this.LayoutRowCount}a.SetAnchor(j,0);a.SetLead(j+l-1,this.ColumnCount-1);a.SetSelection(j,-1,l,-1,-1);this.PaintSelection(j,-1,l,-1,-1);return}a.SetLead(g,f);(m||a.AnchorRow==-1&&a.AnchorColumn==-1)&&a.SetAnchor(Math.max(g,0),Math.max(f,0));var s=a.length>0?a[a.length-1]:null,e=a.AnchorRow,d=Math.max(g,0);if(this.IsRowLayoutMode&&n)if(e<d){var c=this._GetRow(e);e=c.Owner[0].FlattenIndex;c=this._GetRow(d);d=c.Owner[c.Owner.length-1].FlattenIndex}else if(e>d){var c=this._GetRow(e);e=c.Owner[c.Owner.length-1].FlattenIndex;c=this._GetRow(d);d=c.Owner[0].FlattenIndex}else{var c=this._GetRow(e);e=c.Owner[0].FlattenIndex;c=this._GetRow(d);d=c.Owner[0].FlattenIndex}var h=-1;if(a.AnchorRow>=0&&g>=0)if(e!=d&&!m)h=Math.abs(e-d)+1;else h=this.IsRowLayoutMode&&(n||f==-1)?this.LayoutRowCount:1;var r=a.AnchorColumn>=0&&f>=0?a.AnchorColumn!=f?Math.abs(a.AnchorColumn-f)+1:1:-1;if((this.OperationMode==o.MULTI_SELECT||this.OperationMode==o.EXTENDED_SELECT)&&a.IsSelected(g,f)){a.RemoveSelection(d,-1,h,-1,k);this.HideSelection(d,-1,h,-1,k,false,a.length>0,false)}else{var b=new GCWS.CellRange(Math.min(e,g),Math.min(a.AnchorColumn,f),h,r,k);if(a.Contains(b))return;if(!this.IsRowLayoutMode&&f!=-1&&g!=-1)b=this._FindExpandedSelection(b.Row,b.Column,b.RowCount,b.ColumnCount);if(a.length>0&&!m){a[a.length-1]=b;this._PaintUpdatedSelection(s,b)}else{a.AddSelection(b.Row,b.Column,b.RowCount,b.ColumnCount,b.LayoutRow);this.PaintSelection(b.Row,b.Column,b.RowCount,b.ColumnCount,b.LayoutRow)}}};GCWS.SpreadView.prototype._MoveSelectionLeadByHitCell=function(f,g,q,r){var a=this.SelectionModel,c=$$.OperationModes,d=this.OperationMode,t=GCWS.SelectionPolicy,i=this.Spread.getSpreadContext();if(r){if(d==c.NORMAL)if(a.length>1||!a.Contains(-1,-1,-1,-1)){this.HideSelections();a.ClearSelection();a.AddSelection(-1,-1,-1,-1);this.PaintSelection(-1,-1,-1,-1,-1)}return}var h=$$.utils.contains(i.getColHeader(),f)||$$.utils.contains(i.getFrozColHeader(),f),o=!h&&($$.utils.contains(i.getRowHeader(),f)||$$.utils.contains(i.getFrozRowHeader(),f)),s=d==c.SINGLE_SELECT||d==c.ROW_MODE||d==c.MULTI_SELECT||d==c.EXTENDED_SELECT,b=-1;if(h)if(g.type=="mousemove")b=a.LeadRow;else b=-1;else b=this._GetRowIndex(f);var e=-1;if(o)if(g.type=="mousemove")e=a.LeadColumn;else e=-1;else e=this._GetColumnIndex(f);var l=-1;if(this.IsRowLayoutMode&&h)l=f.parentNode.rowIndex;if(this.IsRowLayoutMode&&h&&this.ColumnHeader.GetColumnDataIndex(l,e)==-1)return;var k=d==c.SINGLE_SELECT||d==c.ROW_MODE;if(k)if(b==this.ActiveRow&&this.SelectionModel.Contains(b,-1,1,-1))return;q&&this.SelectionModel.SetAnchor(-1,-1);var m=g.type=="mousemove"&&!k,n=g.type=="mousedown"&&g.ctrlKey||k,p=m||n&&a.SelectionPolicy==GCWS.SelectionPolicy.MultiRange;if(a.length>0&&m){var j=a[a.length-1];if(j.Row==-1&&j.Column==-1){b=-1;e=-1}else if(j.Row==-1)b=-1;else if(j.Column==-1)e=-1}if(g==null||!p){this.HideSelections();a.ClearSelection()}this._MoveSelectionLead(b,e,l,n);a.LeadRow!=-1&&a.LeadColumn!=-1&&this._CorrectSelectionLead()};GCWS.SpreadView.prototype._GetSpansInRange=function(e){for(var c=this.SpanModel,a=[],b=0;b<c.length;b++){var d=c[b];e.IsCoverable(d)&&a.push(d)}return a.length>0?a:null};GCWS.SpreadView.prototype._MoveSelectionByKey=function(o,h){var l=this.OperationMode==$$.OperationModes.SINGLE_SELECT;if(this._IsFullRowSelectable&&h)return;var a=this.SelectionModel;a.LeadRow==-1&&a.LeadColumn==-1&&a.SetLead(this.ActiveRow,this.ActiveColumn);var e=GCWS.Keys,n=a.LeadRow,m=a.LeadColumn,c=false;switch(o){case e.LEFT:if(this._IsOnlySelectRow)return;if(a.LeadColumn<=a.AnchorColumn||this.SpanModel.length==0){if(a.LeadColumn>0){a.LeadColumn--;c=true}}else if(a.LeadColumn>a.AnchorColumn){var b=a[a.length-1].Clone(),g=a.LeadColumn,d=false;do{b.ColumnCount--;g--;d=b.Contains(this.ActiveRow,this.ActiveColumn)}while(b.ColumnCount!=0&&this.SpanModel.IsPartialIntersectedWith(b)&&d);if(b.ColumnCount==0||!d){if(a.AnchorColumn>0){var j=a.AnchorColumn;a.AnchorColumn=a.LeadColumn;a.LeadColumn=j-1;c=true}}else a.LeadColumn=g}break;case e.RIGHT:if(this._IsOnlySelectRow)return;if(a.LeadColumn>=a.AnchorColumn||this.SpanModel.length==0){if(a.LeadColumn<this.ColumnCount-1){a.LeadColumn++;c=true}}else if(a.LeadColumn<a.AnchorColumn){var b=a[a.length-1].Clone(),g=a.LeadColumn,d=false;do{b.Column++;b.ColumnCount--;g++;d=b.Contains(this.ActiveRow,this.ActiveColumn)}while(b.ColumnCount!=0&&this.SpanModel.IsPartialIntersectedWith(b)&&d);if(b.ColumnCount==0||!d){if(a.AnchorColumn<this.ColumnCount-1){var j=a.AnchorColumn;a.AnchorColumn=a.LeadColumn;a.LeadColumn=j+1;c=true}}else a.LeadColumn=g}break;case e.UP:if(this._IsOnlySelectRow){if(a.LeadRow>(!this.IsRowLayoutMode?0:this.LayoutRowCount))a.LeadRow=!this.IsRowLayoutMode?a.LeadRow-1:a.LeadRow-this.LayoutRowCount}else if(a.LeadRow<=a.AnchorRow||this.SpanModel.length==0){if(a.LeadRow>0){a.LeadRow--;c=true}}else if(a.LeadRow>a.AnchorRow){var b=a[a.length-1].Clone(),f=a.LeadRow,d=false;do{b.RowCount--;f--;d=b.Contains(this.ActiveRow,this.ActiveColumn)}while(b.ColumnCount!=0&&this.SpanModel.IsPartialIntersectedWith(b)&&d);if(b.RowCount==0||!d){if(a.AnchorRow>0){var k=a.AnchorRow;a.AnchorRow=a.LeadRow;a.LeadRow=k-1;c=true}}else a.LeadRow=f}break;case e.DOWN:if(this._IsOnlySelectRow){if(a.LeadRow<this.RowCount-1)a.LeadRow++}else if(a.LeadRow>=a.AnchorRow||this.SpanModel.length==0){if(a.LeadRow<this.RowCount-1){a.LeadRow++;c=true}}else if(a.LeadRow<a.AnchorRow){var b=a[a.length-1].Clone(),f=a.LeadRow,d=false;do{b.Row++;b.RowCount--;f++;d=b.Contains(this.ActiveRow,this.ActiveColumn)}while(b.RowCount!=0&&this.SpanModel.IsPartialIntersectedWith(b)&&d);if(b.RowCount==0||!d){if(a.AnchorRow<this.RowCount-1){var k=a.AnchorRow;a.AnchorRow=a.LeadRow;a.LeadRow=k+1;c=true}}else a.LeadRow=f}break;case e.HOME:if(this._IsOnlySelectRow)return;if(a.LeadColumn>0)a.LeadColumn=0;break;case e.END:if(l)return;if(a.LeadColumn!=this.ColumnCount-1)a.LeadColumn=this.ColumnCount-1;break;case e.PAGE_UP:if(a.LeadRow<=a.AnchorRow)c=true;a.LeadRow=this._DoPageUp(a.LeadRow,a.LeadColumn,true);if(this._IsOnlySelectRow)break;if(this.SpanModel.length>0&&!c){var i=a.GetOnFlySelectionRange();if(this.SpanModel.IsPartialIntersectedWith(i)){this._MoveSelectionByKey(e.UP,h);return}}break;case e.PAGE_DOWN:if(a.LeadRow>=a.AnchorRow)c=true;a.LeadRow=this._DoPageDown(a.LeadRow,a.LeadColumn,true);if(this._IsOnlySelectRow)break;if(this.SpanModel.length>0&&!c){var i=a.GetOnFlySelectionRange();if(this.SpanModel.IsPartialIntersectedWith(i)){this._MoveSelectionByKey(e.DOWN,h);return}}}if(n!=a.LeadRow||m!=a.LeadColumn){if(this._IsOnlySelectRow){a.SetAnchor(a.LeadRow,a.LeadColumn);this.HideSelections();a.ClearSelection()}this._MoveSelectionLead(a.LeadRow,a.LeadColumn,-1,false);c&&this._CorrectSelectionLead()}};GCWS.SpreadView.prototype._CorrectSelectionLead=function(){var a=this.SelectionModel;if(a.length==0)return;var b=a[a.length-1];if(a.LeadColumn<a.AnchorColumn)a.LeadColumn=Math.min(a.LeadColumn,b.Column);else a.LeadColumn=b.Column+b.ColumnCount-1;if(a.LeadRow<a.AnchorRow)a.LeadRow=Math.min(a.LeadRow,b.Row);else a.LeadRow=b.Row+b.RowCount-1};GCWS.SpreadView.prototype._PaintUpdatedSelection=function(b,a){var i=this.SelectionModel,d=[];if(a.Column>b.Column){var c=new GCWS.CellRange(b.Row,b.Column,b.RowCount,a.Column-b.Column),m=i.IsIntersectWith(-1,c.Column,-1,c.ColumnCount);this.HideSelection(c,false,m,true);d.push(c)}else a.Column<b.Column&&this.PaintSelection(a.Row,a.Column,a.RowCount,b.Column-a.Column);var h=a.Column+a.ColumnCount,f=b.Column+b.ColumnCount;if(h<f){var c=new GCWS.CellRange(b.Row,h,b.RowCount,f-h),m=i.IsIntersectWith(-1,c.Column,-1,c.ColumnCount);this.HideSelection(c,false,m,true);d.push(c)}else h>f&&this.PaintSelection(a.Row,f,a.RowCount,h-f);if(a.Row>b.Row){var c=new GCWS.CellRange(b.Row,b.Column,a.Row-b.Row,b.ColumnCount),n=i.IsIntersectWith(c.Row,-1,c.RowCount,-1);this.HideSelection(c,false,true,n);d.push(c)}else a.Row<b.Row&&this.PaintSelection(a.Row,a.Column,b.Row-a.Row,a.ColumnCount);var g=a.Row+a.RowCount,e=b.Row+b.RowCount;if(g<e){var c=new GCWS.CellRange(g,b.Column,e-g,b.ColumnCount),n=i.IsIntersectWith(c.Row,-1,c.RowCount,-1);this.HideSelection(c,false,true,n);d.push(c)}else g>e&&this.PaintSelection(e,a.Column,g-e,a.ColumnCount);for(var k=0;k<d.length;k++){var j=i.IntersectWith(d[k]);if(j!=null)for(var l=0;l<j.length;l++)this.PaintSelection(j[l])}};GCWS.SpreadView.prototype.AddSelection=function(a,c,b,d,f){if(this.IsRowLayoutMode)if(a>=0&&c==-1&&d==-1){if(b!=1)return;b=this.LayoutRowCount;a=this._GetRow(a,true).FlattenIndex}else if(c>=0&&a==-1&&b==-1){if(d!=1||f==-1)return}else if(a>=0&&c>=0&&(b>1||d>1))return;var e=new GCWS.CellRange(a,c,b,d,f);if(!this.IsRowLayoutMode&&c!=-1&&a!=-1)e=this._FindExpandedSelection(e);this.SelectionModel.AddSelection(e);this.PaintSelection(e)};GCWS.SpreadView.prototype.GetBoundingRectangle=function(){if(this.Parent==null)return this.Spread.getBoundingClientRect();else{var b=this.Spread.getBoundingClientRect(),c=this.ColumnHeaders[1]||this.ColumnHeaders[0],d=this.Viewport1||this.Viewport0,e=this.Viewport||this.Viewport2,a=b.right;if(c!=null&&c.getBoundingClientRect().right>a)a=c.getBoundingClientRect().right;if(d!=null&&d.getBoundingClientRect().right>a)a=d.getBoundingClientRect().right;if(e!=null&&e.getBoundingClientRect().right>a)a=e.getBoundingClientRect().right;return{left:b.left,right:a,top:b.top,bottom:b.bottom}}};GCWS.RowHeader=function(b){var c=b.Spread;this.ColumnCount=0;var a=c.getRowHeader();if(b.IsMultiBrowserMode())this.GrayArea=a&&b.Parent==null?$$.j("#"+a.parentNode.id+" > DIV[ControlType='chgrayarea']")[0]:null;if(a==null)a=c.getFrozRowHeader();if(a!=null)this.ColumnCount=a.getElementsByTagName("COLGROUP")[0].childNodes.length;this.SpreadView=b};GCWS.RowHeader.prototype={_GetHtmlCell:function(c,b){var a=this.SpreadView._GetRow(c).ViewIndex;return this.SpreadView.GetSpreadContext().getHeaderCellFromRowCol(a,b,false)},_GetMostTopRowIndex:function(a,e){var b=this._GetHtmlCell(a,e);if(b!=null&&b.rowSpan>1){var d=b.parentElement,c=d.rowIndex;if(a>=this.SpreadView.FrozenRowCount)c+=this.SpreadView.FrozenTableRowCount;a=this.SpreadView._GetRowIndexByViewIndex(c)}return a},GetColumnWidth:function(d){var b=this.SpreadView.RowHeaders[1]||this.SpreadView.RowHeaders[0];if(b!=null){var c=this.SpreadView.GetSpreadContext().getColGroup(b).childNodes[d],a=c.getAttribute("__originalWidth");return parseInt(a!=null?a:c.width)}return 0},Contains:function(c,d){var a=this.SpreadView.RowHeaders;if(a!=null){for(var b=0;b<a.length;b++)if($$.utils.contains(a[b],c))return true;if(!d&&this.SpreadView.Parent==null&&this.GrayArea&&$$.utils.contains(this.GrayArea,c,true))return true}return false},GetSizable:function(c){var b=this.SpreadView.Spread,a=b.getRowHeader();if(a==null)a=b.getFrozRowHeader();return a!=null?this.SpreadView.GetSpreadContext().getColGroup(a).childNodes[c].getAttribute("Sizable")!="false":true},IsVisible:function(){return this.SpreadView.Parent==null?this.SpreadView.RowHeaders!=null:this.SpreadView.RowHeaders[0].parentNode.getAttribute("rhVisible")!="false"},ApplyStyle:function(){if(this.SpreadView.RowHeaders==null)return;for(var a=this.SpreadView,b=0;b<a.RowHeaders.length;b++){var c=a.RowHeaders[b];if(c)c.parentNode.style.overflow="hidden"}if(this.GrayArea)this.GrayArea.style.left=a.CellSpacing+"px"},Layout:function(){if(this.SpreadView.RowHeaders==null)return;var a=this.SpreadView;if(this.GrayArea!=null){var c=$$.j(this.GrayArea),d=a.RowHeaders.length>1?a.RowHeaders[1]:a.RowHeaders[0],b=a.RowCount>0?d.offsetWidth:-1;if(b==-1&&a.Corner)b=a.Corner.Corner.offsetWidth;b=Math.max(b,parseInt(d.parentNode.style.width));c.css("width",b-2*a.CellSpacing+"px");var e=a._GetVirtualPagingBottomElements();e.length>0&&c.css("height",c.height()+e[0].offsetHeight+"px")}}};GCWS.SheetCorner=function(a){this.SpreadView=a;this.AllowTableCorner=false;this.Corner=this.SpreadView.Spread.getCorner();if(this.Corner&&this.Corner.rows.length==0)this.Corner=null;this.AllowTableCorner=this.Corner&&this.Corner.getAttribute("allowTableCorner")!=null};GCWS.SheetCorner.prototype={ApplyStyle:function(){if(this.Corner==null)return;if(!this.AllowTableCorner){var d=this.SpreadView.GetSpreadContext(),b=d.getColGroup(this.Corner);if(b==null){b=document.createElement("COLGROUP");var c=document.createElement("COL");b.appendChild(c);var a=this.Corner.getElementsByTagName("TBODY");if(a!=null&&a.length>0){a=a[0];$$.j(b).insertBefore(a)}else this.Corner.appendChild(b)}this.Corner.style.width="";var e=this.Corner.offsetHeight;this.Corner.style.width=this.Corner.offsetWidth+"px";this.Corner.parentNode.style.overflow="hidden"}else this.Corner.style.width="1px"},Layout:function(){if(this.Corner&&!this.AllowTableCorner){var a=this.Corner.rows[0];if(a.getAttribute("FpSpread")!="fb"&&a.offsetHeight<this.SpreadView.ColumnHeader.GetHeaderRowsHeight())a.style.height=""}},Contains:function(b,c){var a=c?this.SpreadView.GetSpreadContext().getFooterCorner():this.SpreadView.GetSpreadContext().getCorner();return a!=null&&(a==b||$$.utils.contains(a,b))}};GCWS.TitleBar=function(a){this.SpreadView=a;var b=a.GetSpreadContext();this.TitleBars=[b.getTitleBar(),b.getSubTitleBar()];$$.utils.cleanArray(this.TitleBars)};GCWS.TitleBar.prototype={IsVisible:function(){return this.TitleBars.length>0}};GCWS.Pager=function(a){this.SpreadView=a;var b=a.GetSpreadContext();this.Pagers=[b.getPager1(),b.getPager2()]};GCWS.Pager.prototype={Contains:function(c){for(var b=0;b<this.Pagers.length;b++){var a=this.Pagers[b];if(a!=null&&(a==c||$$.utils.contains(a,c)))return true}return false},IsVisible:function(){for(var a=0;a<this.Pagers.length;a++)if(this.Pagers[a]!=null)return true;return false},GetHeight:function(){var b=arguments.length>0?arguments[0]:-1;if(!isNaN(b)&&b!=-1){var a=this.Pagers[b];return a?a.offsetHeight:0}for(var d=0,c=0;c<this.Pagers.length;c++){var a=this.Pagers[c];d+=a?a.offsetHeight:0}return d},ApplyStyle:function(){if(!this.IsVisible())return;for(var c=0;c<this.Pagers.length;c++){var a=this.Pagers[c];if(a!=null){var b=$$.j(a).find("TABLE");if(b.length>0){b=b[0];b.style.margin=""}a.style.position="relative";a.style.overflow="hidden";if(this.GetSlideBar(a)!=null){a.style.paddingTop=b.style.paddingBottom="0px";a.style.height="30px"}else{a.style.height="20px";if(a.getAttribute("ButtonType")=="ImageButton")if(!$$.browser.ie){var d=$$.j(a).find("IMG");d.css("width","22px");d.css("height","22px")}}}}},Layout:function(){if(!this.IsVisible())return;for(var a=0;a<this.Pagers.length;a++){var b=this.Pagers[a];b!=null&&this._LayoutPager(b)}},GetSlideBar:function(b){var a=$$.j(b).find("*[name='"+this.SpreadView.Spread.id+"_slideBar']");return a!=null&&a.length>0?a:null},GetSlidePosition:function(){return{Left:this.slideLeft,Right:this.slideRight}},_LayoutPager:function(d){var p=this.SpreadView.Spread,a=this.GetSlideBar(d);if(a){a=a[0];var f=d.getElementsByTagName("TABLE");if(f!=null&&f.length>0){var e=f[0].rows[0].cells[0],c=e.getElementsByTagName("IMG");if(c.length==0)return;for(var g=[],b=0;b<c.length;b++)!c[b].complete&&g.push(c[b]);if(g.length>0){this._WaitForImagesLoaded(g,Function.CreateDelegate(this,this.Layout));return}var m=$$(d).offset(),n=$$(a.offsetParent).offset(),j=a.offsetParent.scrollLeft,o=a.offsetParent.scrollTop;e=f[0].rows[0].cells[1];var k=e.offsetLeft;this.slideLeft=k;this.slideRight=e.offsetLeft+e.offsetWidth-a.offsetWidth;var h=m.left-n.left+this.slideLeft+j,l=parseInt(d.getAttribute("curPage")),i=parseInt(d.getAttribute("totalPage"))-1;if(i>0)h+=l/i*(this.slideRight-this.slideLeft);a.style.left=h+"px";a.style.top=Math.floor(d.clientHeight/2)-Math.floor(a.childNodes[0].clientHeight/2)+"px";for(var b=0;b<c.length;b++)c[b].style.verticalAlign="middle"}}},_WaitForImagesLoaded:function(a,f){var g=a.length,d=0;function c(){d++;if(d==g)f&&f()}for(var b=0;b<a.length;b++){var e=a[b];if(e.complete)c();else e.addEventListener("load",c,false)}}};GCWS.ColumnHeader=function(b){var c=b.Spread;this.RowCount=0;this.SpreadView=b;var a=c.getColHeader();if(b.IsMultiBrowserMode()){this.GrayAreas=a&&b.Parent==null?$$.j("#"+a.parentNode.id+" > DIV[ControlType='chgrayarea_container'] > DIV[ControlType='chgrayarea']"):null;if(this.GrayAreas&&this.GrayAreas.length<=0)this.GrayAreas=null}if(a==null)a=c.getFrozColHeader();if(a!=null)this.RowCount=a.rows.length-b.FilterBarRowCount};GCWS.ColumnHeader.prototype={_GetHtmlCell:function(b,a){return this.SpreadView.GetSpreadContext().getHeaderCellFromRowCol(b,a,true)},_GetMostLeftColumnIndex:function(c,b){var a=this._GetHtmlCell(c,b);if(a!=null&&a.colSpan>1)b=this.SpreadView._GetColumnIndex(a);return b},_GetMostTopRowIndex:function(c,b){var a=this._GetHtmlCell(c,b);return a!=null?a.parentNode.rowIndex:b},GetColumnDataIndex:function(b,a){return parseInt(this.SpreadView.GetSpreadContext().getHeaderCellFromRowCol(b,a,true).getAttribute("col"))},GetIndexesFromColumnDataIndex:function(f){if(f>=0)for(var e=this.SpreadView.Spread.getColHeader(),b=0;b<e.rows.length;b++)for(var c=e.rows[b],a=0;a<c.cells.length;a++){var d=parseInt(c.cells[a].getAttribute("col"));if(!isNaN(d)&&d==f)return{Row:b,Column:parseInt(c.cells[a].getAttribute("scol"))}}return null},Contains:function(c,d){var b=this.SpreadView.ColumnHeaders;if(b!=null){for(var a=0;a<b.length;a++)if($$.utils.contains(b[a],c))return true;if(!d&&this.SpreadView.Parent==null&&this.GrayAreas)for(var a=0;a<this.GrayAreas.length;a++)if($$.utils.contains(this.GrayAreas[a],c,true))return true}return false},GetSizable:function(c){var b=this.SpreadView.Spread,a=b.getColHeader();if(a==null)a=b.getFrozColHeader();return a!=null&&a.rows.length>c?a.rows[c].getAttribute("Sizable")!="false":true},IsVisible:function(){return this.SpreadView.ColumnHeaders!=null},ApplyStyle:function(){if(!this.IsVisible())return;for(var b=this.SpreadView,a=0;a<b.ColumnHeaders.length;a++){var c=b.ColumnHeaders[a];c.style.width="1px"}},Layout:function(){if(!this.IsVisible())return;var a=this.SpreadView,b=a.ColumnHeaders.length>1?a.ColumnHeaders[1]:a.ColumnHeaders[0],c=a.CellSpacing;if(a.Parent==null&&this.GrayAreas){var d=a.HasFilterBar(),h=this.GetHeaderRowsHeight()+(c>0?0:1),f=!d||b.rows.length>a.FilterBarRowCount,g=f?1:0;if(f)this.GrayAreas[0].style.height=h+"px";if(d)this.GrayAreas[g].style.height=a.FilterBarHeight-c+"px";var e=this.GrayAreas[0].parentNode,i=b.offsetHeight-(c>0?c:Math.round($$.utils.getRowOffsetTop(b.rows[0],b)));e.style.top=-i+"px";e.style.left=b.offsetWidth+"px";if(d)this.GrayAreas[g].style.top=c+"px"}},GetWidth:function(){if(!this.IsVisible())return 0;for(var b=this.SpreadView,c=0,a=0;a<b.ColumnHeaders.length;a++)c+=b.ColumnHeaders[a].offsetWidth;return c},GetHeaderRowsHeight:function(){if(!this.IsVisible())return 0;for(var c=this.SpreadView.ColumnHeaders.length>1?this.SpreadView.ColumnHeaders[1]:this.SpreadView.ColumnHeaders[0],a=0,b=0;b<c.rows.length;b++){var d=c.rows[b];if(d.getAttribute("fpspread")=="fb")break;a+=d.offsetHeight}a+=(this.RowCount-1)*this.SpreadView.CellSpacing;return a},GetGrayAreaHeight:function(a){return this.IsVisible()&&this.GrayAreas?!a?this.GrayAreas[0].offsetHeight:this.GrayAreas.length>1?this.GrayAreas[1].offsetHeight:0:0},SetColumnWidth:function(b,g,d){if(!this.IsVisible())return;var a=this.SpreadView,c;if(b<a.FrozenTableColumnCount||a.FrozenTableColumnCount==0)c=a.ColumnHeaders[0];else c=a.ColumnHeaders[1];var f=c.getElementsByTagName("COLGROUP")[0];if(b>=a.FrozenTableColumnCount)b-=a.FrozenTableColumnCount;var e=f.children[b];e.width=g;!d&&this.Layout()}};GCWS.ColumnFooter=function(b){var c=b.Spread;this.RowCount=0;this.SpreadView=b;var a=c.getColFooter();if(b.IsMultiBrowserMode())this.GrayArea=a&&b.Parent==null?$$.j("#"+a.parentNode.id+" DIV[ControlType='footergrayarea']")[0]:null;else this.GrayArea=a&&b.Parent==null?$$.j("#"+a.id+" td[ControlType='chgrayarea']")[0]:null;if(a==null)a=c.getFrozColFooter();if(a!=null)this.RowCount=a.rows.length};GCWS.ColumnFooter.prototype={IsVisible:function(){return this.SpreadView.ColumnFooters!=null},ApplyStyle:function(){if(!this.IsVisible())return;for(var b=this.SpreadView,a=0;a<b.ColumnFooters.length;a++){var c=b.ColumnFooters[a];c.style.width="1px"}},Layout:function(){if(!this.IsVisible())return;var a=this.SpreadView,c=a.Spread,b=c.getColFooter()||c.getFrozColFooter();if(a.Parent==null){var d=b.offsetHeight-2*a.CellSpacing;this.GrayArea.style.height=d+"px";var e=b.offsetHeight-a.CellSpacing;this.GrayArea.style.top=-e+"px";this.GrayArea.style.left=b.offsetWidth+"px"}},SetColumnWidth:function(b,d,e){if(!this.IsVisible())return;var a=this.SpreadView,c;if(b<a.FrozenTableColumnCount||a.FrozenTableColumnCount==0)c=a.ColumnFooters[0];else c=a.ColumnFooters[1];var g=c.getElementsByTagName("COLGROUP")[0];if(b>=a.FrozenTableColumnCount)b-=a.FrozenTableColumnCount;d=Math.max(d,10);var f=g.childNodes[b];f.width=d;!e&&this.Layout()},Contains:function(c,d){var a=this.SpreadView.ColumnFooters;if(a!=null){for(var b=0;b<a.length;b++)if($$.utils.contains(a[b],c))return true;if(!d&&this.SpreadView.Parent==null&&this.GrayArea)return $$.utils.contains(this.GrayArea,c,true)}return false}};GCWS.CommandButton=function(){function a(a,b){this.element=a;this.name=b}a.prototype.getName=function(){return this.name};a.prototype.getElement=function(){return this.element};return a}();GCWS.CommandButton.FindButton=function(c,b){var a=document.getElementById(c.id+"_"+b);return a!=null?new GCWS.CommandButton(a,b):null};GCWS.CommandBar=function(){function a(a,b){this.spread=a.Spread;this.spreadView=a;this.element=b;this.CollectButtons();this._buttonsOnClickHandler=Function.CreateDelegate(this,this.CommandButtonOnClick)}a.prototype.__Dispose=function(){$$.j.each(this.buttons,function(e,d){var b=d.getElement(),c=$$.j(b),a=c.data("oOnClick");if(a){b.onclick=a;c.removeData("oOnClick")}})};a.prototype.OnMouseDown=function(e){this.spreadView.HidePopup();var a=e.target,c=$$.j(a),d=false,f=a?c.attr("disabled")=="disabled":false,g=this._getChangeSheetButton(a);if(a&&(a.onclick||g&&g.attr("onclick"))){if(a.onclick&&a.onclick!=this._buttonsOnClickHandler){!c.data("oOnClick")&&c.data("oOnClick",a.onclick);a.onclick=this._buttonsOnClickHandler}d=true}if(f){a.ignoreClick=true;d=false}else a.ignoreClick=false;var b=this.spreadView.GetTopSpreadView().GetEditingSpread(),h=a&&(a.tagName=="IMG"||$$.utils.isNativeControl(a));if(b!=null&&!b.EndEdit({SafeEditorRemove:true})||h&&!f&&$$.utils.contains(this.spreadView.Spread,this.spreadView.GetActiveSpread()))if(b&&!b.IsValid())$$.utils.cancelBubble(e,true);else $$.utils.cancelDefault(e);if($$.browser.isTouchEventModel&&h&&this.spreadView.EditModePermanent&&this.spreadView.GetTopSpreadView().GetEditingSpread()==null){var i=this;setTimeout(function(){i.spreadView.GetSpreadContext().switchHiddenTextBox(true)},0)}return d};a.prototype.OnMouseUp=function(a){var c=a.target,b=this.spreadView.GetSpreadContext();if(this.spreadView._GetWorkingSpread()==null){this.spread.focus(null,null,{Event:a});b.setIgnoreBlur(false);!this.spread.isEditing()&&document.activeElement==this.spreadView.Spread&&b.setTextBoxFocus();return true}return false};a.prototype.CommandButtonOnClick=function(a){var b=this.spreadView.GetEditingSpread(),d=$$.j(a.target),c=d.data("oOnClick");if(c&&(!b||b.EndEdit()))return!a.target.ignoreClick?c.apply(a.target,arguments):false};a.prototype.CollectButtons=function(){var a=this.spread.id;this.buttons=[GCWS.CommandButton.FindButton(this.spread,"Update"),GCWS.CommandButton.FindButton(this.spread,"Cancel"),GCWS.CommandButton.FindButton(this.spread,"Copy"),GCWS.CommandButton.FindButton(this.spread,"Clear"),GCWS.CommandButton.FindButton(this.spread,"Paste"),GCWS.CommandButton.FindButton(this.spread,"Prev"),GCWS.CommandButton.FindButton(this.spread,"Next"),GCWS.CommandButton.FindButton(this.spread,"Print"),GCWS.CommandButton.FindButton(this.spread,"Insert"),GCWS.CommandButton.FindButton(this.spread,"Add"),GCWS.CommandButton.FindButton(this.spread,"Delete")];$$.utils.cleanArray(this.buttons)};a.prototype.GetClipboardState=function(){var f=this.spread.GetActiveChildSheetView(true)||this.spread,a=f.getSpreadView(),c=a.GetSpreadContext(),d=f.getAnchorCell(),j=c.getCellType(d),i=c.getSelection(),b=i.lastChild,h=a.OperationMode==3||a.OperationMode==4||a.OperationMode==5;if(h)return{Copy:b!=null,Cut:false,Paste:false};else{var g=a.OperationMode==1||j=="readonly";if(!g)g=c.anyReadOnlyCell(b);if(a.EnableRowEditTemplate&&d!=null)if(d.getAttribute("RowEditTemplate")=="true")return{Copy:false,Cut:false,Paste:false};else if(a.OperationMode==2){var e=document.getElementById(f.id+"_editRow");if(e&&d.parentElement.rowIndex==e.rowIndex&&e.cells.length>0&&e.cells[0].getAttribute("RowEditTemplate")=="true")return{Copy:false,Cut:false,Paste:false}}return g?{Copy:b!=null,Cut:false,Paste:b!=null&&c.getClipboardData()!=null}:{Copy:b!=null,Cut:b!=null,Paste:b!=null&&c.getClipboardData()!=null}}};a.prototype.UpdateCopyCutPaste=function(){var a=this.GetClipboardState();this.EnableButton("Copy",a.Copy);this.EnableButton("Paste",a.Paste);this.EnableButton("Clear",a.Cut)};a.prototype.EnableDataButtons=function(a){this.EnableButton("Update",a);this.EnableButton("Cancel",a)};a.prototype.EnableButton=function(h,e){var g=this.GetButton(h);if(g!=null){var a=g.getElement(),f=$$.j(a);if(f.attr("disabled")=="disabled"&&!e)return;if(!e)a.setAttribute("disabled",true);else f.removeAttr("disabled");if(a.tagName=="IMG"){var b=a,c=a.getAttribute("disabledImg");if(!e&&c!=null){if(b.src.indexOf(c)<0)b.src=c}else{var d=a.getAttribute("enabledImg");if(d!=null&&b.src.indexOf(d)<0)b.src=d}}}};a.prototype.UpdateButtonImageSource=function(a,e){if(a==null||a.tagName!="IMG")return;switch(e){case"enable":var c=a.getAttribute("enabledImg");if(c!=null&&a.src.indexOf(c)<0)a.src=c;break;case"disable":var b=a.getAttribute("disabledImg");if(b!=null&&a.src.indexOf(b)<0)a.src=b;break;case"hover":var d=a.getAttribute("hoverImg");if(d!=null&&a.src.indexOf(d)<0)a.src=d}};a.prototype.GetButton=function(b){if(b==null||b.length==0)return null;for(var a=0;a<this.buttons.length;a++)if(this.buttons[a].getName()==b)return this.buttons[a];return null};a.prototype.Contains=function(a,b){return this.element!=null&&a!=null?$$.utils.contains(this.element,a,b):false};a.prototype.ApplyStyle=function(){if(this.element){this.element.style.position="relative";if($$.browser.mb){var a=this.element.getElementsByTagName("table");a&&a.length>0&&$$.j(a[0]).css("margin-top")=="0px"&&$$.j(a[0]).css("margin-top","1px")}}};a.prototype.Layout=function(){if(this.element!=null)this.element.style.width=this.spread.clientWidth+"px"};a.prototype.UpdateHoverButtonState=function(a,c){if(a==null||a.tagName!="IMG")return;var b="";if(c){var d=document.getElementById(this.spread.id+"_commandBar");b=d!=null?d.getAttribute("hovercolor"):""}a.style.backgroundColor=b;this.UpdateButtonImageSource(a,c?"hover":"enable")};a.prototype.Dispose=function(){this.__Dispose()};a.prototype._getChangeSheetButton=function(b){var a=$$.j(b).closest("TD");return a&&a.attr("isButton")=="1"?a:null};return a}();GCWS.Collection=function(){this.OnChanged=null};GCWS.Collection.prototype=[];GCWS.Collection.prototype.constructor=GCWS.Collection;GCWS.Collection.prototype.Add=function(a){if(a!=null)a.Owner=this;var b=this.push(a)-1;this.__FireChanged({Type:GCWS.Collection.ChangeType.Add,NewIndex:b,Item:a});return b};GCWS.Collection.prototype.Insert=function(a,b){if(a>=0&&a<=this.length){b.Owner=this;this.splice(a,0,b);this.__FireChanged({Type:GCWS.Collection.ChangeType.Add,NewIndex:a,Item:b});return true}else return false};GCWS.Collection.prototype.RemoveAt=function(a){if(a>=0&&a<this.length){var b=this.splice(a,1);this.__FireChanged({Type:GCWS.Collection.ChangeType.Remove,Index:a,Item:b[0]});return true}else return false};GCWS.Collection.prototype.Remove=function(a){return this.RemoveAt(this.indexOf(a))};GCWS.Collection.prototype.Clear=function(){this.splice(0,this.length);this.__FireChanged({Type:GCWS.Collection.ChangeType.Clear})};GCWS.Collection.prototype.AddOnChanged=function(a){if(this.OnChanged==null)this.OnChanged=[];this.OnChanged.push(a)};GCWS.Collection.prototype.RemoveOnChanged=function(b){if(this.OnChanged==null)return;for(var a=this.OnChanged.length-1;a>=0;a--)if(b==this.OnChanged[a]){this.OnChanged.splice(a,1);break}};GCWS.Collection.prototype.__FireChanged=function(b){if(this.OnChanged!=null)for(var a=0;a<this.OnChanged.length;a++){var c=this.OnChanged[a];c(b)}};GCWS.Collection.ChangeType={Add:0,Insert:1,Remove:2,Clear:3};GCWS.SpreadViewCollection=function(){};GCWS.SpreadViewCollection.prototype=new GCWS.Collection;GCWS.SpreadViewCollection.prototype.constructor=GCWS.SpreadViewCollection;GCWS.SpreadViewCollection.prototype.GetSpreadView=function(){};GCWS.Column=function(b,a){this.HtmlColumn=b;this.Sizable=a==null?true:a};GCWS.Column.prototype.SetWidth=function(a){this.Width=a};if(Object.defineProperty&&!GCWS.Column.prototype.hasOwnProperty("Width"))try{Object.defineProperty(GCWS.Column.prototype,"Width",{"get":function(){var a=this.HtmlColumn.getAttribute("__originalWidth");return a!=null?parseInt(a):parseInt(this.HtmlColumn.width)},enumerable:true,configurable:true})}catch(e){}GCWS.ColumnCollection=function(i){this.SpreadView=i;var a=this.SpreadView.GetSpreadContext(),e=[],d=[],b=a.getViewport0();if(b==null)b=a.getViewport2();if(b!=null){e.push(b);d.push(a.getColGroup(a.getFrozColHeader()))}b=a.getViewport1();if(b==null)b=a.getViewport();if(b!=null){e.push(b);d.push(a.getColGroup(a.getColHeader()))}for(var c=0;c<e.length;c++)for(var j=e[c],g=a.getColGroup(j).childNodes,f=0;f<g.length;f++){var h=g[f];this.Add(new GCWS.Column(h,(d[c]!=null?d[c].childNodes[f]:h).getAttribute("Sizable")!="false"))}};GCWS.ColumnCollection.prototype=new GCWS.Collection;GCWS.ColumnCollection.prototype.constructor=GCWS.ColumnCollection;GCWS.ColumnCollection.prototype.AddColumn=function(a){this.push(new GCWS.Column(a))};GCWS.RowCollection=function(a){this.SpreadView=a;this._Initialize()};GCWS.RowCollection.prototype=new GCWS.Collection;GCWS.RowCollection.prototype.constructor=GCWS.RowCollection;GCWS.RowCollection.prototype._Initialize=function(){this._LoadRows(-1)};GCWS.RowCollection.prototype._LoadRows=function(r,q,u){var t=this.SpreadView.IsRowLayoutMode,p=this.SpreadView.LayoutRowCount,s=this.SpreadView.LayoutColumnCount,d=this.SpreadView.GetSpreadContext(),w=d.GetColCount(),y=d.frzColCount(),v=d.frzRowCount(),h=r==-1,j=[];if(h){var b=d.getViewport0();if(b==null)b=d.getViewport1();b!=null&&j.push(b);b=d.getViewport2();if(b==null)b=d.getViewport();b!=null&&j.push(b)}else j.push(u);var i=[];if(h){var k=d.getFrozRowHeader();k!=null&&i.push(k);k=d.getRowHeader();k!=null&&i.push(k)}else q!=null&&i.push(q);for(var a,l=h?-1:this.SpreadView.RowCount-1,g=0;g<j.length;g++){b=j[g];var e=h?0:r,x=g>0||!h?v:0;while(e<b.rows.length){var n=x+e,c=b.rows[e],f=c.getAttribute("FpKey");if(f!=null){if(f=="newRow")f=-2;else f=parseInt(f);if(a==null||a.DataIndex!=f){a=new GCWS.Row(f);a.ViewIndex=n;a.IsGroup=c.cells.length>0&&c.cells[0].getAttribute("group")!=null;a.Sizable=!this.SpreadView.IsRowLayoutMode&&i[g]!=null&&i[g].rows[e].getAttribute("Sizable")!="false";if(t&&!a.IsGroup){a.LayoutRows=new GCWS.LayoutRowCollection(a);for(var o=0;o<p;o++){l++;var z=e+o,m=new GCWS.LayoutRow;m.ViewIndex=n;m.HtmlRow=c;do c=c.nextSibling;while(c&&c.tagName!="TR");a.LayoutRows.Add(m);this._LoadCells(m,0,s,l);n++}e+=p}else{l++;a.HtmlRow=c;a.Cells=new GCWS.CellCollection(a);a.ViewIndex=n;this._LoadCells(a,0,w,l);e++}this.Add(a)}else e++}else{if(!this.SpreadView.HasPreviewRow&&c.getAttribute("previewRow")!=null)this.SpreadView.HasPreviewRow=true;e++}}}};GCWS.RowCollection.prototype._LoadCells=function(e,q,t,f){for(var s=e.ViewIndex,i=this.SpreadView,m=i.GetSpreadContext(),n=i.SpanModel,c=q;c<t;c++){var d=n.Find(f,c);if(d==null||d.Row==f&&d.Column==c){var b=m.getCellFromRowCol(s,c);if(b==null){e.Cells.Add(null);continue}(b.rowSpan>1||b.colSpan>1)&&n.Add(f,c,b.rowSpan,b.colSpan);var a=new GCWS.Cell(b);a.Locked=b.getAttribute("locked")=="true";a.CanFocus=b.getAttribute("canFocus")!="false";a.TabStop=b.getAttribute("TabStop")!="false";var j=b.getAttribute("FpFormula");if(j!=null&&j.length>0)a.Formula=j;var h=b.getAttribute("col");if(h==null)h=m.getColKeyFromCell(b);var r=h!=null?parseInt(h):-1;a.DataIndex=r;a.Row=f;a.Column=c;e.Cells.Add(a);a.IsReadOnly=a.Locked||!a.CanFocus;var p="";if(!a.IsReadOnly){var g=a.HtmlCell;if(g.getAttribute("FpRef")!=null)g=document.getElementById(g.getAttribute("FpRef"));p=g.getAttribute("FpCellType");if(p=="readonly")a.IsReadOnly=true}var k=FarPoint.Web.Spread.CellTypeFactory.GetCellType(i.Spread,b);k&&k.Initialize();if(d!=null){for(var l=d.ColumnCount,o=1;o<l;o++)e.Cells.Add(null);c+=l-1}}else e.Cells.Add(null)}};GCWS.Row=function(a){this.Cells=null;this.LayoutRows=null;this.DataIndex=a;this.ChildSpreadViews=new GCWS.SpreadViewCollection;this.Height=0;this.Sizable=true;this.ViewIndex=-1;this.IsGroup=false};GCWS.Row.prototype.get_html_row=function(){var e=this._htmlRow;if(e!=null&&e.rowIndex==-1){var a=this.Owner.SpreadView,b=a.GetSpreadContext(),c=b.getRowByKey(this.DataIndex);if(c>=0){var d=b.getCellFromRowCol(c,0);if(d){this._htmlRow=d.parentNode;this.Cells=new GCWS.CellCollection(this);if(a.IsRowLayoutMode&&!this.IsGroup)this.Owner._LoadCells(this,0,a.LayoutColumnCount,this.FlattenIndex);else this.Owner._LoadCells(this,0,b.GetColCount(),this.FlattenIndex)}}}return this._htmlRow};GCWS.Row.prototype.set_html_row=function(a){this._htmlRow=a};if(Object.defineProperty)try{Object.defineProperty(GCWS.Row.prototype,"HtmlRow",{"get":GCWS.Row.prototype.get_html_row,"set":GCWS.Row.prototype.set_html_row})}catch(e){}GCWS.Row.prototype.GetChildSpreadView=function(a){return this.ChildSpreadViews.GetSpreadView(a)};GCWS.Row.prototype.SetHeight=function(a){this.Height=a};GCWS.LayoutRowCollection=function(a){this.Owner=a};GCWS.LayoutRowCollection.prototype=new GCWS.Collection;GCWS.LayoutRowCollection.prototype.constructor=GCWS.LayoutRowCollection;GCWS.LayoutRow=function(){this.Cells=new GCWS.CellCollection(this);this.LayoutIndex=-1};if(Object.defineProperty)try{Object.defineProperty(GCWS.LayoutRow.prototype,"HtmlRow",{"get":GCWS.Row.prototype.get_html_row,"set":GCWS.Row.prototype.set_html_row})}catch(e){}GCWS.CellCollection=function(a){this.Owner=a};GCWS.CellCollection.prototype=new GCWS.Collection;GCWS.CellCollection.prototype.constructor=GCWS.CellCollection;GCWS.Cell=function(a){this.Row=null;this.Column=null;this.Value=null;this.Formula=null;this.Locked=false;this.CanFocus=true;this.HtmlCell=a;this.IsReadOnly=false;this.DataIndex=-1};GCWS.Cell.prototype={SetValue:function(a){this.Value=a},GetCellType:function(){var a=this.HtmlCell;if(a.getAttribute("FpRef")!=null)a=document.getElementById(a.getAttribute("FpRef"));var b=a.getAttribute("FpCellType");if(b==null||b=="readonly")b=a.getAttribute("CellType");return b=="text"?"GeneralCellType":b}};if(Object.defineProperty)try{Object.defineProperty(GCWS.Cell.prototype,"Editable",{"get":function(){return this.HtmlCell.getAttribute("FpCellType")!="readonly"}})}catch(e){}GCWS._CellLocation=function(b,a){this.Row=b;this.Column=a};GCWS._CellLocation.prototype.IsValid=function(){return this.Row>=0&&this.Column>=0};GCWS._CellLocation.prototype.Reset=function(){this.Row=-1;this.Column=-1};GCWS.CellRange=function(c,b,e,d,a){this.Row=c;this.Column=b;this.RowCount=c==-1?-1:e;this.ColumnCount=b==-1?-1:d;this.LayoutRow=a||a==0?a:-1};GCWS.CellRange.prototype.Contains=function(c,b,d,e,a){if(this.Column==-1&&this.Row==-1)return true;if(arguments.length<4){a=d;return c==-1?this.Row==-1&&this.Column>=0&&this.Column<=b&&this.Column+this.ColumnCount>b&&(a==null||a==-1||this.LayoutRow==-1||this.LayoutRow==a):b==-1?this.Column==-1&&this.Row>=0&&this.Row<=c&&this.Row+this.RowCount>c&&(a==null||a==-1||this.LayoutRow==-1||this.LayoutRow==a):(this.Row==-1||this.Row<=c&&this.Row+this.RowCount>c)&&(this.Column==-1||this.Column<=b&&this.Column+this.ColumnCount>b)&&(a==null||a==-1||this.LayoutRow==-1||this.LayoutRow==a)}else return this.Contains(c,b,a)&&(d==1&&e==1||this.Contains(c+d-1,b+e-1))};GCWS.CellRange.prototype.IsCoverable=function(b,a,f,e,d){if(arguments.length==1){var c=arguments[0];return this.IsCoverable(c.Row,c.Column,c.RowCount,c.ColumnCount,c.LayoutRow)}return this.LayoutRow!=-1&&d!=-1&&this.LayoutRow!=d?false:b==-1&&a==-1?this.Row==-1&&this.Column==-1:b==-1?this.Row==-1&&this.Column<=a&&this.Column+this.ColumnCount>=a+e:a==-1?this.Column==-1&&this.Row<=b&&this.Row+this.RowCount>=b+f:(this.Row==-1||this.Row<=b&&this.Row+this.RowCount>=b+f)&&(this.Column==-1||this.Column<=a&&this.Column+this.ColumnCount>=a+e)};GCWS.CellRange.prototype.IsIntersectWith=function(c,b,f,e,d){if(arguments.length==1){var a=arguments[0];c=a.Row;b=a.Column;f=a.RowCount;e=a.ColumnCount;d=a.LayoutRow}else if(arguments.length==2){if(c>=0&&b>=0){f=1;e=1}d=-1}if(this.LayoutRow!=-1&&d!=-1&&this.LayoutRow!=d)return false;var g=this.Column==-1||b==-1||Math.max(this.Column,b)<=Math.min(this.Column+this.ColumnCount-1,b+e-1),h=this.Row==-1||c==-1||Math.max(this.Row,c)<=Math.min(this.Row+this.RowCount-1,c+f-1);return g&&h};GCWS.CellRange.prototype.IntersectWith=function(e,d,j,i,f){if(arguments.length==1){var c=arguments[0];return this.IntersectWith(c.Row,c.Column,c.RowCount,c.ColumnCount,c.LayoutRow)}if(this.LayoutRow!=-1&&f!=-1&&this.LayoutRow!=f)return null;var g=Math.max(this.Column,d),a;if(this.Column<0)a=d;else{a=this.Column+this.ColumnCount-1;if(d>=0)a=Math.min(a,d+i-1)}var h=Math.max(this.Row,e),b;if(this.Row<0)b=e;else{b=this.Row+this.RowCount-1;if(e>=0)b=Math.min(b,e+j-1)}return b<h||a<g?null:new GCWS.CellRange(h,g,b-h+1,a-g+1,f)};GCWS.CellRange.prototype.UnionWith=function(b,a,f,e){if(arguments.length==1){a=arguments[0].Column;f=arguments[0].RowCount;e=arguments[0].ColumnCount;b=arguments[0].Row}var c=this.Column!=-1&&a!=-1?Math.min(this.Column,a):-1,g=c!=-1?Math.max(this.Column+this.ColumnCount,a+e):-1,d=this.Row!=-1&&b!=-1?Math.min(this.Row,b):-1,h=d!=-1?Math.max(this.Row+this.RowCount,b+f):-1;return new GCWS.CellRange(d,c,h!=-1?h-d:-1,g!=-1?g-c:-1)};GCWS.CellRange.prototype.Clone=function(){return new GCWS.CellRange(this.Row,this.Column,this.RowCount,this.ColumnCount,this.LayoutRow)};GCWS.CellRange.prototype.Equals=function(){var a=arguments[0];return a!=null&&this.Row==a.Row&&this.RowCount==a.RowCount&&this.Column==a.Column&&this.ColumnCount==a.ColumnCount&&this.LayoutRow==a.LayoutRow};GCWS.SelectionModel=function(a){this.SpreadView=a;this.Spread=a.Spread;this.SelectionPolicy=this._ConvertSelectionPolicy();this.AnchorColumn=-1;this.AnchorRow=-1;this.LeadRow=-1;this.LeadColumn=-1};GCWS.SelectionModel.prototype=new GCWS.Collection;GCWS.SelectionModel.prototype.constructor=GCWS.SelectionModel;GCWS.SelectionModel.prototype._ConvertViewRangeToDataRange=function(b,m,o,n){var j=this.Spread,a=this.SpreadView,c;if(b.rowCount==0&&b.colCount==0&&b.row==-1&&b.col==-1){if(!o){var e=j.ActiveRow,h=j.ActiveCol,i=j.getAnchorCell();if(i!=null&&(a.RowHeader.Contains(i)&&(a.SelectionBlockOptions&GCWS.SelectionBlockOptions.Rows)!=GCWS.SelectionBlockOptions.Rows||a.ColumnHeader.Contains(i)&&(a.SelectionBlockOptions&GCWS.SelectionBlockOptions.Columns)!=GCWS.SelectionBlockOptions.Columns))e=h=-1;if(e!=-1||h!=-1){c={top:-1,left:-1,bottom:-1,right:-1,layoutRow:-1};if(e!=-1){e=a._GetTableRowIndex(e);e=a._GetRowIndexByViewIndex(e)}var l=a.IsRowLayoutMode?0:-1;if(a.OperationMode==$$.OperationModes.NORMAL)c={top:e,left:h,bottom:e,right:h,layoutRow:l};else{if(a.IsRowLayoutMode)e=a._GetRow(e,true).FlattenIndex;c={top:e,left:-1,bottom:e,right:-1,layoutRow:l}}}}}else{var d=left=bottom=right=-1,g=b.rowCount;switch(b.type){case"Cell":d=b.row;left=b.col;right=b.col+b.colCount-1;break;case"Row":if(a.IsRowLayoutMode){var q=a._GetTableRowIndex(b.row),p=a._GetRowIndexByViewIndex(q);d=a._GetRow(p,true).ViewIndex;d=this.Spread.GetSheetIndex(d)}else d=b.row;left=-1;break;case"Column":d=-1;left=b.col;right=b.col+b.colCount-1;break;case"Table":d=-1;left=-1}if(d!=-1){var k=a._GetTableRowIndex(d);d=a._GetRowIndexByViewIndex(k);var f=k;if(g>1){if(!a.HasPreviewRow&&(a.ChildSpreadViews==null||a.ChildSpreadViews.length==0))bottom=d+g-1;else{while(g>1){f++;if(a._IsChildSpreadRow(f))continue;g--}bottom=a._GetRowIndexByViewIndex(f);if(bottom==null||bottom==-1)bottom=a._GetRowIndexFromNonSelectableRow(f)}if(!n&&bottom>=a.RowCount)bottom=a.RowCount-1}else bottom=d}c={top:d,left:left,bottom:bottom,right:right,layoutRow:b.innerRow}}if(m&&c!=null)c=new GCWS.CellRange(c.top,c.left,c.top==-1?-1:c.bottom-c.top+1,c.left==-1?-1:c.right-c.left+1,c.layoutRow);return c};GCWS.SelectionModel.prototype._CorrectRangeInRowLayoutMode=function(a){var b=this.SpreadView;if(a.col<0&&a.colCount<0&&a.row>=0){var d=b._GetTableRowIndex(a.row),c=b._GetRowByViewIndex(d);if(c!=null&&!c.IsGroup)a.rowCount=b.LayoutRowCount}};GCWS.SelectionModel.prototype._GetFocusRange=function(a){return this._ConvertViewRangeToDataRange(this.Spread.GetSelectedRange(),false,false,a)};GCWS.SelectionModel.prototype.GetFocusCellRange=function(b){var a=this.Spread.GetSelectedRange();this.SpreadView.IsRowLayoutMode&&this._CorrectRangeInRowLayoutMode(a);return this._ConvertViewRangeToDataRange(a,true,false,b)};GCWS.SelectionModel.prototype.AddSelection=function(b,f,e,d,c){if(arguments.length==1){var a=b;b=a.Row;f=a.Column;e=a.RowCount;d=a.ColumnCount;c=a.LayoutRow}if(this.Contains(b,f,e,d,c))return;this.push(new GCWS.CellRange(b,f,e,d,c))};GCWS.SelectionModel.prototype.SetSelection=function(e,d,c,b,a){this.Clear();this.AddSelection(e,d,c,b,a)};GCWS.SelectionModel.prototype.Contains=function(h,g,b,f,e,j){if(arguments.length<=3){var a=arguments[0];if(a.Row){j=arguments.length>1?arguments[1]:false;h=a.Row;g=a.Column;b=a.RowCount;f=a.ColumnCount;e=a.LayoutRow}else{h=arguments[0];g=arguments[1];e=b!=null?b:-1;b=1;f=1}}for(var d=this.SpreadView.GetSpreadContext().GetSelectedRanges(),i=0,k=!j?d.length:d.length-1;i<k;i++){var c=d[i];this.SpreadView.IsRowLayoutMode&&this._CorrectRangeInRowLayoutMode(c);c=this._ConvertViewRangeToDataRange(c,true,true);if(c.Contains(h,g,b,f,e))return true}return false};GCWS.SelectionModel.prototype.ClearSelection=function(){this.SpreadView.Spread.ClearSelection(false,null,false)};GCWS.SelectionModel.prototype.RemoveSelection=function(g,f,e,d,c){for(var b=0;b<this.length;b++){var a=this[b];if(a.Row==g&&a.Column==f&&a.RowCount==e&&a.ColumnCount==d&&a.LayoutRow==c){this.RemoveAt(b);return true}}return false};GCWS.SelectionModel.prototype.GetSelections=function(f,e){for(var b=[],d=this.SpreadView.GetSpreadContext().GetSelectedRanges(),g=f==null||e==null,c=0,h=d.length;c<h;c++){var a=d[c];this.SpreadView.IsRowLayoutMode&&this._CorrectRangeInRowLayoutMode(a);a=this._ConvertViewRangeToDataRange(a,true);(g||a.InIntersectWith(f,e))&&b.push(a)}return b.length>0?b:null};GCWS.SelectionModel.prototype.ContainsSheetSelectionOnly=function(){var a=this.GetSelections();if(a==null)return false;for(var b=0;b<a.length;b++){var c=a[b];if(c.Row>=0||c.Column>=0)return false}return true};GCWS.SelectionModel.prototype.ContainsColumnSelectionOnly=function(){var a=this.GetSelections();if(a==null)return false;for(var b=0;b<a.length;b++){var c=a[b];if(c.Row>=0)return false}return true};GCWS.SelectionModel.prototype.ContainsRowSelectionOnly=function(){var a=this.GetSelections();if(a==null)return false;for(var b=0;b<a.length;b++){var c=a[b];if(c.Column>=0)return false}return true};GCWS.SelectionModel.prototype.IsEmpty=function(){var a=this.Spread.GetSelectedRange();return a.rowCount==0&&a.colCount==0&&a.row==-1&&a.col==-1};GCWS.SelectionModel.prototype.SetAnchor=function(b,a){this.AnchorRow=b;this.AnchorColumn=a};GCWS.SelectionModel.prototype.SetLead=function(b,a){this.LeadRow=b;this.LeadColumn=a};GCWS.SelectionModel.prototype.Reset=function(){this.ClearSelection();this.SetLead(-1,-1);this.SetAnchor(-1,-1)};GCWS.SelectionModel.prototype.GetOnFlySelectionRange=function(){if(this.AnchorRow==-1||this.AnchorColumn==-1||this.LeadRow==-1||this.LeadColumn==-1)return null;var a=Math.min(this.LeadColumn,this.AnchorColumn),b=Math.min(this.LeadRow,this.AnchorRow);return new GCWS.CellRange(b,a,Math.abs(this.LeadRow-this.AnchorRow)+1,Math.abs(this.LeadColumn-this.AnchorColumn)+1)};GCWS.SelectionModel.prototype.GetExtendedSelection=function(){};GCWS.SelectionModel.prototype.IsSelected=function(c,b){for(var a=0;a<this.length;a++)if(this[a].Contains(c,b))return true;return false};GCWS.SelectionModel.prototype.IsIntersectWith=function(g,f,e,d,c,i){if(arguments.length<=2){var a=arguments[0];if(a.Row!=null){i=arguments.length>1?arguments[1]:false;g=a.Row;f=a.Column;e=a.RowCount;d=a.ColumnCount;c=a.LayoutRow}else{g=arguments[0];f=arguments[1];e=1;d=1;c=-1}}for(var b=this.SpreadView.GetSpreadContext().GetSelectedRanges(),h=0,k=!i?b.length:b.length-1;h<k;h++){var j=this._ConvertViewRangeToDataRange(b[h],true);if(j.IsIntersectWith(g,f,e,d,c))return true}return false};GCWS.SelectionModel.prototype.IsIntersectWithRange=function(b,a){return this.IsIntersectWith(b,a)};GCWS.SelectionModel.prototype.IntersectWith=function(j,i,g,f,e){if(arguments.length==1){var a=arguments[0];return this.IntersectWith(a.Row,a.Column,a.RowCount,a.ColumnCount,a.LayoutRow)}for(var b=[],c=0,h=this.length;c<h;c++){var d=this[c].IntersectWith(j,i,g,f,e);d!=null&&b.push(d)}return b.length>0?b:null};GCWS.SelectionModel.prototype._ConvertSelectionPolicy=function(){var a=this.Spread.getAttribute("SelectionPolicy");return a=="MultiRange"||this.Spread.getAttribute("multiRange")=="true"?GCWS.SelectionPolicy.MultiRange:a=="Range"?GCWS.SelectionPolicy.Range:a=="Single"?GCWS.SelectionPolicy.Single:void 0};GCWS.SpanModel=function(a){this.SpreadView=a};GCWS.SpanModel.prototype=new GCWS.Collection;GCWS.SpanModel.prototype.constructor=GCWS.SpanModel;GCWS.SpanModel.prototype.Add=function(e,d,c,b){var a=new GCWS.CellRange(e,d,c,b);if(this._quadTree)return this._quadTree.Retrieve(a);else this.push(a)};GCWS.SpanModel.prototype.Find=function(c,b){if(c==null||b==null||c<0||b<0)return null;var a;if(this._quadTree)a=this._quadTree.Retrieve(new GCWS.CellRange(c,b,1,1));else a=this;for(var d=0;d<this.length;d++)if(a[d].Contains(c,b))return a[d];return null};GCWS.SpanModel.prototype.IsPartialIntersectedWith=function(b){for(var a=0;a<this.length;a++){var c=this[a];if(c.IsIntersectWith(b)&&!b.IsCoverable(c))return true}return false};GCWS.SpanModel.prototype.BuildQuadTree=function(){if(this.SpreadView.Options.UseQuadTree){this._quadTree=new GCWS.QuadTree;for(var a=0;a<this.length;a++)this._quadTree.Insert(this[a])}};GCWS.QuadTree=function(c,b,a){this.Root=new GCWS.QuadTreeNode(c,0,b,a)};GCWS.QuadTree.prototype.Insert=function(a){this.Root.Insert(a)};GCWS.QuadTree.prototype.Clear=function(){this.Root.Clear()};GCWS.QuadTree.prototype.Retrieve=function(a){return this.Root.Retrieve(a).slice(0)};GCWS.QuadTreeNode=function(c,d,b,a){this._bounds=c;this._childNodes=[];this._nodes=[];this._stuckChildNodes=[];this._maxChildNode=arguments.length<4?8:a;this._maxDepth=arguments.length<3?4:b;this._depth=d};GCWS.QuadTreeNode.TOP_LEFT=0;GCWS.QuadTreeNode.TOP_RIGHT=1;GCWS.QuadTreeNode.BOTTOM_LEFT=2;GCWS.QuadTreeNode.BOTTOM_RIGHT=3;GCWS.QuadTreeNode.prototype.Insert=function(a){if(this._nodes.length){var d=this._FindIndex(a),f=this._nodes[d],b=f._bounds;if(a.Column>=b.Column&&a.Colum+a.ColumnCount<=b.Column+b.ColumnCount&&a.Row>=b.Row&&a.Row+a.RowCount<=b.Row+b.RowCount)this._nodes[d].Insert(a);else this._stuckChildNodes.push(a)}else{this._childNodes.push(a);var e=this._childNodes.length;if(this._depth<this._maxDepth&&e>this._maxChildNode){this._Split();for(var c=0;c<e;c++)this.Insert(this._childNodes[c]);this._childNodes.length=0}}};GCWS.QuadTreeNode.prototype._FindIndex=function(b){var a=this._bounds,d=b.Column<=a.Column+a.ColumnCount/2,c=b.Row<=a.Row+a.RowCount/2;return d?c?GCWS.QuadTreeNode.TOP_LEFT:GCWS.QuadTreeNode.BOTTOM_LEFT:c?GCWS.QuadTreeNode.TOP_RIGHT:GCWS.QuadTreeNode.BOTTOM_RIGHT};GCWS.QuadTreeNode.prototype._Split=function(){var d=this._depth+1,c=this._bounds,e=c.Column,f=c.Row,b=c.ColumnCount/2|0,a=c.RowCount/2|0,g=e+b,h=f+a;this._nodes[GCWS.QuadTreeNode.TOP_LEFT]=new GCWS.QuadTreeNode(new GCWS.CellRange(e,f,b,a),d);this._nodes[GCWS.QuadTreeNode.TOP_RIGHT]=new GCWS.QuadTreeNode(new GCWS.CellRange(g,f,b,a),d);this._nodes[GCWS.QuadTreeNode.BOTTOM_LEFT]=new GCWS.QuadTreeNode(new GCWS.CellRange(e,h,b,a),d);this._nodes[GCWS.QuadTreeNode.BOTTOM_RIGHT]=new GCWS.QuadTreeNode(new GCWS.CellRange(g,h,b,a),d)};GCWS.QuadTreeNode.prototype.Retrieve=function(b){if(!this._out)this._out=[];var a=this._out;a.length=0;if(this._nodes.length){var c=this._FindIndex(b);a.push.apply(a,this._nodes[c].Retrieve(b))}a.push.apply(a,this._stuckChildNodes);a.push.apply(a,this._childNodes);return a};GCWS.QuadTreeNode.Clear=function(){this._stuckChildNodes.length=0;this._childNodes.length=0;var b=this._nodes.length;if(b)for(var a=0;a<b;a++)this._nodes[a].Clear();this._nodes.length=0};GrapeCity.Web.Spread.__QuirksModeStyle="  UL.SpreadContextMenu LI.item DIV.icon { z-index:2;}  UL.SpreadContextMenu DIV.TreeHolder {width:220px;}  UL.SpreadContextMenu DIV.TreeHolder SPAN { font-size:12px;}   UL.SpreadContextMenu DIV.DropDownTextBox INPUT {height:18px;}";GrapeCity.Web.Spread.__QuirksModeStyleIE9Below="  UL.SpreadContextMenu LI.item A.aspNetDisabled {z-index:1;}  UL.SpreadContextMenu LI.item A.itemLink {z-index:1;}  UL.SpreadContextMenu LI.item A.TopItem {width:100%;}  UL.SpreadContextMenu LI.item A.popout {width:auto;}  DIV.FilterEditor DIV.FilterEditorDropDown { width:16px;height:16px;}  DIV.DropDownTextBox .DropDownButton { width:14px;height:20px;}  TABLE.FilterBar INPUT.FilterBarTextBox {height:19px}  UL.SpreadContextMenu LI.item {height:19px;}";GrapeCity.Web.Spread.__StyleIE7="  DIV.FilterEditor {overflow:hidden;}  DIV.FilterEditor DIV.FilterBarDropDown { bottom:2px;}";GrapeCity.Web.Spread.__StyleIE10Above="  UL.SpreadContextMenu.touch LI.item DIV.checked {margin-left:3px;margin-top:4px;}  UL.SpreadContextMenu LI.item DIV.checked {margin-left:2px;margin-top:3px}  UL.SpreadContextMenu LI.item .icon {margin-top:4px}";GrapeCity.Web.Spread.__QuirksModeStyleIE7="  DIV.FilterEditor DIV.FilterBarDropDown { bottom:-2px !important;}  TABLE.FilterBar INPUT.FilterBarTextBox {height:18px !important;}";var GcResources={"en-US":{FilterDialog:{Operators:["equals","does not equal","is greater than","is greater than or equal to","is less than","is less than or equal to","begins with","does not begin with","ends with","does not end with","contains","does not contain"],DateOperators:["is after","is after or equal to","is before","is before or equal to"],Description:"Use ? to represent any single character<br/>Use * to represent any series of characters",And:"<span style='text-decoration: underline'>A</span>nd",Or:"<span style='text-decoration: underline'>O</span>r",Header:"Show rows where:",Title:"Custom AutoFilter",ColorTitle:"Available Cell Colors",ColorHeader:"Select a cell color to filter by:",ColorForeTitle:"Available Font Colors",ColorForeHeader:"Select a font color to filter by:",ColorSelected:"Selected:",ColorNoFill:"No Fill",ColorAutomatic:"Automatic",IconTitle:"Available Cell Icons",IconHeader:"Select a cell icon to filter by:",IconNone:"No Cell Icon",Top10Title:"Top 10 AutoFilter",Top10Header:"Show",Top10Directions:{Top:"Top",Bottom:"Bottom"},Top10Types:{Items:"Items",Percent:"Percent"},Top10InvalidData:"Integer is not valid.",Top10InvalidRangePercent:"The number must be between 1 and 100. Try again by entering a number in this range.",Top10InvalidRangeItems:"The number must be greater than 0 and less than 2147483648. Try again by entering a valid number.",Width:410,DatePicker:"Date Picker",MsgInvalid:"Error in parse line!"},Common:{OK:"OK",Cancel:"Cancel",Close:"Close"},FilterEditor:{CustomFilter:"Custom Filter",ColorFilter:"Color Filter",IconFilter:"Icon Filter",Top10Filter:"Top 10 Filter",DynamicFilter:"Dynamic Filter",MultiValuesFilter:"Multi Values Filter"}},"ja-JP":{FilterDialog:{Operators:["と等しい","と等しくない","より大きい","以上","より小さい","以下","で始まる","で始まらない","で終わる","で終わらない","を含む","を含まない"],DateOperators:["より後","以降","より前","以前"],Description:"?を使って、任意の１文字を表すことができます。<br/>*を使って、任意の文字列を表すことができます。",And:"<span style='text-decoration: underline'>A</span>ND",Or:"<span style='text-decoration: underline'>O</span>R",Header:"抽出条件の指定:",Title:"オートフィルタ オプション",ColorTitle:"利用可能なセルの色",ColorHeader:"フィルタの基準にするセルの色を選択してください:",ColorForeTitle:"利用可能なフォントの色",ColorForeHeader:"フィルタの基準にするフォントの色を選択してください:",ColorSelected:"選択済み:",ColorNoFill:"塗りつぶしなし",ColorAutomatic:"自動",IconTitle:"利用可能なセルのアイコン",IconHeader:"フィルタの基準にするセルのアイコンを選択してください:",IconNone:"セルのアイコンなし",Top10Title:"トップテン オートフィルタ",Top10Header:"表示",Top10Directions:{Top:"上位",Bottom:"下位"},Top10Types:{Items:"項目",Percent:"パーセント"},Top10InvalidData:"整数が正しくありません。",Top10InvalidRangePercent:"数値は 1 から 100 の範囲でなければなりません。この数値の範囲で入力し直し、もう一度行ってください。",Top10InvalidRangeItems:"数値は 1 から 2147483647 の範囲でなければなりません。この数値の範囲で入力し直し、もう一度行ってください。",Width:465,DatePicker:"日付ピッカー",MsgInvalid:"パースラインのエラー!"},Common:{OK:"OK",Cancel:"キャンセル",Close:"閉じる"},FilterEditor:{CustomFilter:"カスタムフィルタ",ColorFilter:"カラーフィルター",IconFilter:"アイコンフィルタ",Top10Filter:"トップ10フィルタ",DynamicFilter:"動的フィルタ",MultiValuesFilter:"複数の値をフィルタ"}},GetCulture:function(a){if(a!=null&&a.getAttribute("FpSpread")!="Spread"){var b=a.parentNode;while(b!=null){if(b.getAttribute&&b.getAttribute("FpSpread")=="Spread"){a=b;break}b=b.parentNode}}var c=a?a.getAttribute("culture"):null;if(c==null||c.length==0||GcResources[c]==null)c="en-US";return c}};GCWS.Range=function(b,a,d,c){if(arguments.length<4){this.type="Cell";this.row=-1;this.col=-1;this.rowCount=0;this.colCount=0}else{this.row=b;this.col=a;this.rowCount=d;this.colCount=c;if(b==-1)this.type=a==-1?"Table":"Column";else if(a==-1)this.type="Row";else this.type="Cell"}this.innerRow=0};GCWS.Range.prototype={Set:function(a,d,c,f,e,b){this.type=a;this.row=d;this.col=c;this.rowCount=f;this.colCount=e;this.innerRow=b;if(a=="Row")this.col=this.colCount=-1;else if(a=="Column")this.row=this.rowCount=-1;else if(a=="Table")this.col=this.colCount=this.row=this.rowCount=-1},Equal:function(a){return a==null?false:this.type==a.type&&this.row==a.row&&this.col==a.col&&this.rowCount==a.rowCount&&this.colCount==a.colCount&&this.innerRow==a.innerRow},IsIntersectWith:function(c,e,b,a){if(arguments.length<3)b=1;if(arguments.length<4)a=1;if(this.row==-1&&this.rowCount!=-1||this.col==-1&&this.colCount!=-1)return false;var d=new GCWS.CellRange(this.row,this.col,this.rowCount,this.colCount,-1);return d.IsIntersectWith(c,e,b,a,c)}};GCWS.StyleManipulator=function(){this.items={}};GCWS.StyleManipulator.prototype={Clear:function(b){for(var a=1;a<arguments.length;a++){var c=arguments[a];b.style[c]=""}},Backup:function(d){var f=this._GetId(d),a=this.items[f];if(a==null){a={};this.items[f]=a}for(var c=1;c<arguments.length;c++){var b=arguments[c];if(a[b]!=null)continue;var e=d.style[b];if(e!=null)a[b]=e}},BackupAndClear:function(b){var f=this._GetId(b),a=this.items[f];if(a==null){a={};this.items[f]=a}for(var d=1;d<arguments.length;d++){var c=arguments[d],e=b.style[c];if(e!=null){a[c]=e;b.style[c]=""}}},Restore:function(d){var f=this._GetId(d),a=this.items[f];if(a)for(var c=1;c<arguments.length;c++){var b=arguments[c],e=a[b];if(e!=null){d.style[b]=e;a[b]=null}}},RemoveBackup:function(e){var d=this._GetId(e),a=this.items[d];if(a)if(arguments.length==1)a[d]=null;else for(var b=1;b<arguments.length;b++){var c=arguments[b];if(a[c]!=null)a[c]=null}},GetStyle:function(e){var g=this._GetId(e),b=this.items[g],a=null;if(b)if(arguments.length==2)a=b[arguments[1]];else{a={};for(var d=1;d<arguments.length;d++){var c=arguments[d],f=b[c];if(b[c]!=null)a[c]=f}}return a},_GetId:function(a){return typeof a=="string"?a:a.id}};GCWS.JQueryThemeSupporter=function(){this.activeElement=null};GCWS.JQueryThemeSupporter.prototype={RegisterClickableItem:function(a,b){if(!a)return;$$.j(a).each(function(){!$$(this).hasCssClass("ui-state-default")&&$$(this).appendCssClass("ui-state-default");this.checkEnabled=b})},MouseDown:function(b){var a=b?b.target||b.srcElement:null;if(a&&$$(a).hasCssClass("ui-state-default")&&(a.checkEnabled==false||a.checkEnabled&&a.checkEnabled()||a.checkEnabled==null&&a.getAttribute("disabled")!="true"&&a.getAttribute("disabled")!="disabled"&&!$$(a).hasCssClass("aspNetDisabled"))){this.activeElement&&$$(this.activeElement).removeCssClass("ui-state-active");$$(a).appendCssClass("ui-state-active");this.activeElement=a}},MouseUp:function(){if(this.activeElement){$$(this.activeElement).removeCssClass("ui-state-active");this.activeElement=null}},MouseOver:function(b){var a=b?b.target||b.srcElement:null;a&&$$(a).hasCssClass("ui-state-default")&&(a.checkEnabled==false||a.checkEnabled&&a.checkEnabled()||a.checkEnabled==null&&a.getAttribute("disabled")!="true"&&a.getAttribute("disabled")!="disabled"&&!$$(a).hasCssClass("aspNetDisabled"))&&$$(a).appendCssClass("ui-state-hover")},MouseOut:function(b){var a=b?b.target||b.srcElement:null;a&&$$(a).hasCssClass("ui-state-default")&&$$(a).removeCssClass("ui-state-hover")}};GCWS.ImageTracker=function(a){this.TIMEOUT_PER_IMAGE=5e3;this.Spread=a;this.Parent=null;this.images=[];this.imageTimer=null;this.Initialize()};GCWS.ImageTracker.Track=function(a){return new GCWS.ImageTracker(a)};GCWS.ImageTracker.prototype={Initialize:function(){var b=this.Spread.getSpreadView(),c=[b.Viewport0,b.Viewport1,b.Viewport2,b.Viewport],a=this;$$.j.each(c,function(d,b){if(b){var c=$$.j(b).find("IMG");c.length>0&&$$.j.each(c,function(c,b){if(!b.complete){a.images.push(b);$$.j(b).on("load.spread",function(b){a.images=$$.j.grep(a.images,function(a){return a.src!=b.target.src});$$.j(b.target).off("load.spread");a.images.length==0&&a.OnFinish()})}})}});if(a.images.length>0)this.imageTimer=new FarPoint.Web.Timers.Timer(a.images.length*this.TIMEOUT_PER_IMAGE,$$.j.proxy(this.Dispose,this),false)},IsPending:function(){return this.images&&this.images.length>0},OnFinish:function(){$$.utils.contains(window.document.body,this.Spread)&&this.Spread.sizeSpread();this.imageTimer.Stop();this.images=null;this.Spread=null},Dispose:function(){if(this.images&&this.images.length>0){$$.j.each(this.images,function(b,a){$$.j(a).off("load.spread")});this.images=null}this.imageTimer=null}};if(typeof JSON=="undefined")JSON={};if(typeof JSON.parse=="undefined")JSON.parse=function(fi){try{return eval("("+fi+")")}catch(e){return null}}